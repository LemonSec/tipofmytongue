1
00:00:00,080 --> 00:00:01,839
marcos you have the floor thank you very

2
00:00:01,839 --> 00:00:02,960
much

3
00:00:02,960 --> 00:00:05,200
hello everybody my name is marcus

4
00:00:05,200 --> 00:00:06,319
alvarez

5
00:00:06,319 --> 00:00:09,440
i work as a security researcher at

6
00:00:09,440 --> 00:00:10,880
crowdstrike

7
00:00:10,880 --> 00:00:12,960
and this talk is going to be

8
00:00:12,960 --> 00:00:15,200
about smokeloader but

9
00:00:15,200 --> 00:00:17,440
first i would like to do

10
00:00:17,440 --> 00:00:20,240
a really quick quiz

11
00:00:20,240 --> 00:00:21,680
here and

12
00:00:21,680 --> 00:00:23,600
just the first question is going to be

13
00:00:23,600 --> 00:00:25,439
like how many of you have heard about

14
00:00:25,439 --> 00:00:28,400
smoke loader can you just

15
00:00:28,400 --> 00:00:31,119
all right and how many of you have

16
00:00:31,119 --> 00:00:34,399
reversed smoke loader

17
00:00:34,559 --> 00:00:35,920
all right and

18
00:00:35,920 --> 00:00:38,000
how many of you have reversed

19
00:00:38,000 --> 00:00:41,600
all the versions of smoke loader

20
00:00:42,079 --> 00:00:43,760
okay all right

21
00:00:43,760 --> 00:00:45,200
so yeah

22
00:00:45,200 --> 00:00:46,559
um

23
00:00:46,559 --> 00:00:48,480
i don't know if you heard about it but

24
00:00:48,480 --> 00:00:51,840
last year 2021 was the 10th anniversary

25
00:00:51,840 --> 00:00:53,680
of smokeloader

26
00:00:53,680 --> 00:00:56,640
and i've been tracking this family for

27
00:00:56,640 --> 00:01:01,199
some time now like since 2016 2017

28
00:01:01,199 --> 00:01:04,159
i've been writing some reports and

29
00:01:04,159 --> 00:01:08,560
reading like many of them around as well

30
00:01:08,560 --> 00:01:09,840
and

31
00:01:09,840 --> 00:01:12,000
yeah but this time for this talk i

32
00:01:12,000 --> 00:01:13,760
decided just to write down a historic

33
00:01:13,760 --> 00:01:15,280
overview

34
00:01:15,280 --> 00:01:16,080
on

35
00:01:16,080 --> 00:01:18,080
tactics and some of the data i have been

36
00:01:18,080 --> 00:01:21,119
collecting during this period

37
00:01:21,119 --> 00:01:24,159
so let's start just to talk a little bit

38
00:01:24,159 --> 00:01:26,000
about motivations

39
00:01:26,000 --> 00:01:27,520
and yeah

40
00:01:27,520 --> 00:01:30,079
that's in my scale smoke loader is

41
00:01:30,079 --> 00:01:32,640
really like a successful more family you

42
00:01:32,640 --> 00:01:33,439
know

43
00:01:33,439 --> 00:01:35,520
we talk about 10 years in active

44
00:01:35,520 --> 00:01:37,520
inactivity being used

45
00:01:37,520 --> 00:01:40,560
as part as the distribution

46
00:01:40,560 --> 00:01:42,880
uh scheme of many high-profile marvel

47
00:01:42,880 --> 00:01:45,119
families it's a red like a good

48
00:01:45,119 --> 00:01:46,640
indicator of of

49
00:01:46,640 --> 00:01:49,520
of success you know like if you even dig

50
00:01:49,520 --> 00:01:51,680
a little bit deeper

51
00:01:51,680 --> 00:01:54,560
you can extend that to any piece of

52
00:01:54,560 --> 00:01:56,880
software you know like if uh

53
00:01:56,880 --> 00:01:58,240
that's managed

54
00:01:58,240 --> 00:02:00,320
in piece of software that managed to

55
00:02:00,320 --> 00:02:03,840
uh be relevant for 10 years

56
00:02:03,840 --> 00:02:05,200
it's like a red

57
00:02:05,200 --> 00:02:07,759
like a big success

58
00:02:07,759 --> 00:02:09,598
but i would like to highlight some more

59
00:02:09,598 --> 00:02:12,080
specific reasons behind this success of

60
00:02:12,080 --> 00:02:13,360
smokeloader

61
00:02:13,360 --> 00:02:15,280
the first one that i would like to talk

62
00:02:15,280 --> 00:02:17,280
is about the business model

63
00:02:17,280 --> 00:02:20,160
uh smokeload is sold as a as a product

64
00:02:20,160 --> 00:02:22,400
in underground forums

65
00:02:22,400 --> 00:02:26,560
by this user and known as smoke ldr

66
00:02:26,560 --> 00:02:28,400
smoke loader

67
00:02:28,400 --> 00:02:31,360
and this guy he's like it's

68
00:02:31,360 --> 00:02:34,959
really cautious and low profile

69
00:02:34,959 --> 00:02:37,680
and he just pops up in these forums like

70
00:02:37,680 --> 00:02:39,280
from time to time they publish this

71
00:02:39,280 --> 00:02:42,000
advertisement containing this general

72
00:02:42,000 --> 00:02:43,360
description

73
00:02:43,360 --> 00:02:46,000
some change log about the

74
00:02:46,000 --> 00:02:48,840
that specific release and some buy

75
00:02:48,840 --> 00:02:50,480
information

76
00:02:50,480 --> 00:02:52,160
and that the relationship the the

77
00:02:52,160 --> 00:02:55,040
contact between uh

78
00:02:55,040 --> 00:02:57,920
buyers and the seller it's really really

79
00:02:57,920 --> 00:03:00,640
uh direct you know like you pay you get

80
00:03:00,640 --> 00:03:03,200
that package and like each one of us

81
00:03:03,200 --> 00:03:05,760
like follow like our own path

82
00:03:05,760 --> 00:03:06,800
then

83
00:03:06,800 --> 00:03:09,519
he really doesn't leave that much space

84
00:03:09,519 --> 00:03:11,599
for long-term like business

85
00:03:11,599 --> 00:03:13,040
relationships

86
00:03:13,040 --> 00:03:15,680
uh like we see in other more families

87
00:03:15,680 --> 00:03:17,920
that provides also infrastructure or

88
00:03:17,920 --> 00:03:20,159
also or they also provide some kind of

89
00:03:20,159 --> 00:03:22,800
like affiliation program in this guy

90
00:03:22,800 --> 00:03:25,519
yeah he just managed to reduce his own

91
00:03:25,519 --> 00:03:28,720
risks to to get caught

92
00:03:28,720 --> 00:03:32,799
the second point um is smoke loader is

93
00:03:32,799 --> 00:03:34,879
really cheap you know if you think about

94
00:03:34,879 --> 00:03:35,760
it

95
00:03:35,760 --> 00:03:38,720
um you can get a full package

96
00:03:38,720 --> 00:03:39,959
with all

97
00:03:39,959 --> 00:03:42,640
functionalities ready to go for less

98
00:03:42,640 --> 00:03:44,480
than 1 000

99
00:03:44,480 --> 00:03:47,519
us dollars and this makes smokeloader

100
00:03:47,519 --> 00:03:49,599
quite affordable

101
00:03:49,599 --> 00:03:52,400
and there is smoke loaded it's a really

102
00:03:52,400 --> 00:03:53,920
simple

103
00:03:53,920 --> 00:03:56,319
uh more family if you think about smoke

104
00:03:56,319 --> 00:03:58,560
load the package it's really simple we

105
00:03:58,560 --> 00:04:01,120
have the exact exact folder

106
00:04:01,120 --> 00:04:05,360
uh uh panel written in php that we use

107
00:04:05,360 --> 00:04:06,799
in mysql

108
00:04:06,799 --> 00:04:11,760
and like these huge uh not like this big

109
00:04:11,760 --> 00:04:16,478
blob of data that's just packaged

110
00:04:16,478 --> 00:04:18,959
dlls that are the beauty modules of

111
00:04:18,959 --> 00:04:20,639
smoke loader

112
00:04:20,639 --> 00:04:24,070
and also get some documentation

113
00:04:24,070 --> 00:04:26,000
[Music]

114
00:04:26,000 --> 00:04:30,080
yeah if you uh look at the architecture

115
00:04:30,080 --> 00:04:32,880
of the bot like smoke loader is also

116
00:04:32,880 --> 00:04:35,120
a quite simple boat you know like uh if

117
00:04:35,120 --> 00:04:37,919
you think about like uh it has like all

118
00:04:37,919 --> 00:04:40,720
basic components you can find in modern

119
00:04:40,720 --> 00:04:42,560
mar family

120
00:04:42,560 --> 00:04:45,280
but smokeloader really emphasizes in

121
00:04:45,280 --> 00:04:46,440
the

122
00:04:46,440 --> 00:04:48,880
anti-analysis component in the payload

123
00:04:48,880 --> 00:04:50,720
injection components like it's like it's

124
00:04:50,720 --> 00:04:52,240
a downloader

125
00:04:52,240 --> 00:04:53,280
and

126
00:04:53,280 --> 00:04:56,080
we can see like along the history all in

127
00:04:56,080 --> 00:05:00,479
all their all its updates then they keep

128
00:05:00,479 --> 00:05:03,199
implementing new analysis new analysis

129
00:05:03,199 --> 00:05:05,759
anti-analysis techniques and

130
00:05:05,759 --> 00:05:09,199
new and keep switching

131
00:05:09,680 --> 00:05:10,560
over

132
00:05:10,560 --> 00:05:14,080
a different process injection techniques

133
00:05:14,080 --> 00:05:16,880
and these just like makes it like just

134
00:05:16,880 --> 00:05:18,479
makes it a pain to

135
00:05:18,479 --> 00:05:21,120
to people to researchers analyze it

136
00:05:21,120 --> 00:05:24,000
analyzing it

137
00:05:24,000 --> 00:05:25,199
um

138
00:05:25,199 --> 00:05:27,759
just talking a little bit more about

139
00:05:27,759 --> 00:05:30,960
their operation operational and how

140
00:05:30,960 --> 00:05:34,560
smoke load as user is used in campaigns

141
00:05:34,560 --> 00:05:36,840
like in the wild by the the

142
00:05:36,840 --> 00:05:39,600
buyers yeah of course like this is gonna

143
00:05:39,600 --> 00:05:41,919
be like a general picture because like

144
00:05:41,919 --> 00:05:45,120
if with smoke loader you can just change

145
00:05:45,120 --> 00:05:48,560
uh as many stages as you you want and

146
00:05:48,560 --> 00:05:49,680
you can just

147
00:05:49,680 --> 00:05:52,880
build up like customize like logics and

148
00:05:52,880 --> 00:05:55,199
you can just like do your own strategy

149
00:05:55,199 --> 00:05:57,919
but usually what i see is then after a

150
00:05:57,919 --> 00:05:59,759
smoke load is deployed you see this is

151
00:05:59,759 --> 00:06:02,000
the initial

152
00:06:02,000 --> 00:06:05,199
initial step that does this initial

153
00:06:05,199 --> 00:06:08,160
reconnaissance and collect like few

154
00:06:08,160 --> 00:06:10,960
uh environment like a small amount of

155
00:06:10,960 --> 00:06:14,560
environmental data about the host

156
00:06:14,560 --> 00:06:15,520
then

157
00:06:15,520 --> 00:06:17,520
the the infected machine contacted

158
00:06:17,520 --> 00:06:20,400
contacted the controller and

159
00:06:20,400 --> 00:06:22,800
fetch some modules

160
00:06:22,800 --> 00:06:24,240
and deploy those modules that are just

161
00:06:24,240 --> 00:06:27,039
like the dlls encrypted dlls

162
00:06:27,039 --> 00:06:29,039
the second

163
00:06:29,039 --> 00:06:32,080
step that usually happens the

164
00:06:32,080 --> 00:06:34,639
smoke just delivers this second stage

165
00:06:34,639 --> 00:06:36,000
that usually

166
00:06:36,000 --> 00:06:39,520
is uh like an info stealer

167
00:06:39,520 --> 00:06:41,600
just to harvesting more data about the

168
00:06:41,600 --> 00:06:43,039
host and see

169
00:06:43,039 --> 00:06:46,240
and try to prioritize or try to figure

170
00:06:46,240 --> 00:06:48,000
out what's what what they are going to

171
00:06:48,000 --> 00:06:49,840
do next hope like sometimes they just

172
00:06:49,840 --> 00:06:52,000
like to want just to collect like random

173
00:06:52,000 --> 00:06:53,199
data

174
00:06:53,199 --> 00:06:55,520
um from these effects these infected

175
00:06:55,520 --> 00:06:58,240
machines but yeah usually like from the

176
00:06:58,240 --> 00:06:59,840
infostillers

177
00:06:59,840 --> 00:07:02,639
i i have seen like the ones i can i can

178
00:07:02,639 --> 00:07:04,479
mention it's just like like red line

179
00:07:04,479 --> 00:07:07,599
like vidar like raccoon

180
00:07:07,599 --> 00:07:10,400
before when it was active

181
00:07:10,400 --> 00:07:12,720
and finally uh

182
00:07:12,720 --> 00:07:15,039
it delivers like a final payload that's

183
00:07:15,039 --> 00:07:17,599
just like has a more

184
00:07:17,599 --> 00:07:20,800
it's just like an another stage that uh

185
00:07:20,800 --> 00:07:23,520
contained it another like more family

186
00:07:23,520 --> 00:07:27,280
the main one that has this more specific

187
00:07:27,280 --> 00:07:28,160
uh

188
00:07:28,160 --> 00:07:31,919
goal like any like banking trojan or

189
00:07:31,919 --> 00:07:33,199
like us or

190
00:07:33,199 --> 00:07:34,720
all right

191
00:07:34,720 --> 00:07:37,840
families and i can't i can't i can't

192
00:07:37,840 --> 00:07:41,199
mention like a isfb silent knight tridex

193
00:07:41,199 --> 00:07:42,720
trick bots then

194
00:07:42,720 --> 00:07:45,440
you see that like all these kind of like

195
00:07:45,440 --> 00:07:48,240
big fishes have been using smoke loader

196
00:07:48,240 --> 00:07:50,240
along the time

197
00:07:50,240 --> 00:07:52,319
and for them is really

198
00:07:52,319 --> 00:07:53,440
kind of

199
00:07:53,440 --> 00:07:55,039
um

200
00:07:55,039 --> 00:07:56,000
good

201
00:07:56,000 --> 00:07:57,599
leverage

202
00:07:57,599 --> 00:08:00,639
on these like kind of

203
00:08:00,639 --> 00:08:04,960
cheap but like well well retained

204
00:08:04,960 --> 00:08:08,160
layer to protect the

205
00:08:08,160 --> 00:08:09,759
final payload

206
00:08:09,759 --> 00:08:11,599
and they can just kind of outsource in

207
00:08:11,599 --> 00:08:15,919
some kind of environmental checks

208
00:08:16,479 --> 00:08:19,840
before delivering the main board

209
00:08:21,280 --> 00:08:24,560
now i'm going to talk a little bit about

210
00:08:24,560 --> 00:08:25,680
smoke load

211
00:08:25,680 --> 00:08:28,479
assembly code and tactics

212
00:08:28,479 --> 00:08:30,400
when i start to do this research then i

213
00:08:30,400 --> 00:08:32,240
i just decide okay

214
00:08:32,240 --> 00:08:34,000
i'm gonna

215
00:08:34,000 --> 00:08:38,000
try to draw a timeline

216
00:08:38,000 --> 00:08:40,559
and even though like i did research on

217
00:08:40,559 --> 00:08:43,039
smoke loads like since i have been doing

218
00:08:43,039 --> 00:08:46,080
research on smoke loaded since 2016 2017

219
00:08:46,080 --> 00:08:47,760
as i mentioned before

220
00:08:47,760 --> 00:08:50,000
uh smoke has been around for like a long

221
00:08:50,000 --> 00:08:52,000
time you know and i try to

222
00:08:52,000 --> 00:08:54,160
to figure out who when when was the

223
00:08:54,160 --> 00:08:56,800
starting point you know then

224
00:08:56,800 --> 00:08:59,360
i i went through the literature and i

225
00:08:59,360 --> 00:09:02,240
and i saw all these articles mentioning

226
00:09:02,240 --> 00:09:05,680
that smoke loader created in 2011 was

227
00:09:05,680 --> 00:09:07,760
like first uh

228
00:09:07,760 --> 00:09:10,880
discovered in 2011 it was emerged from

229
00:09:10,880 --> 00:09:13,680
the underground in 2011

230
00:09:13,680 --> 00:09:14,560
then

231
00:09:14,560 --> 00:09:17,440
i just started digging and training and

232
00:09:17,440 --> 00:09:19,600
i tried to find like okay the the first

233
00:09:19,600 --> 00:09:21,680
reference or the first detection to

234
00:09:21,680 --> 00:09:22,959
smoke loader

235
00:09:22,959 --> 00:09:27,360
and i managed to find these really old

236
00:09:27,360 --> 00:09:29,440
tweets from microsoft security

237
00:09:29,440 --> 00:09:30,880
intelligence

238
00:09:30,880 --> 00:09:31,680
uh

239
00:09:31,680 --> 00:09:33,839
talking about the about these new

240
00:09:33,839 --> 00:09:36,399
detections on dof foil that's like an

241
00:09:36,399 --> 00:09:38,959
alias for foreign

242
00:09:38,959 --> 00:09:42,800
and in this tweet i could find

243
00:09:42,800 --> 00:09:44,480
this link to this

244
00:09:44,480 --> 00:09:45,760
blog

245
00:09:45,760 --> 00:09:47,279
and this blog was pointing to another

246
00:09:47,279 --> 00:09:50,800
blog and the blog was offline and but

247
00:09:50,800 --> 00:09:53,680
the internet archive saved me and

248
00:09:53,680 --> 00:09:54,800
and

249
00:09:54,800 --> 00:09:57,200
checking this snapshot

250
00:09:57,200 --> 00:09:59,200
of this blog i couldn't find like a

251
00:09:59,200 --> 00:10:03,200
really really old sample of smoke loader

252
00:10:03,200 --> 00:10:06,240
yeah and this sample was like uh upx

253
00:10:06,240 --> 00:10:07,760
packet uh

254
00:10:07,760 --> 00:10:08,640
uh

255
00:10:08,640 --> 00:10:10,240
portable exactable

256
00:10:10,240 --> 00:10:11,600
file

257
00:10:11,600 --> 00:10:12,959
and

258
00:10:12,959 --> 00:10:16,000
and uh really old and was connecting

259
00:10:16,000 --> 00:10:19,680
back to these domains the falcon fly in

260
00:10:19,680 --> 00:10:22,959
2006 and 2007

261
00:10:22,959 --> 00:10:25,440
that was resolving to this ip hosted in

262
00:10:25,440 --> 00:10:27,440
ukraine back then

263
00:10:27,440 --> 00:10:30,480
and yeah i did i reversed this sample

264
00:10:30,480 --> 00:10:33,200
and yeah it it really is like a

265
00:10:33,200 --> 00:10:34,480
downloader

266
00:10:34,480 --> 00:10:35,360
and

267
00:10:35,360 --> 00:10:38,720
it just uh downloads like uh

268
00:10:38,720 --> 00:10:40,880
also like a encrypted

269
00:10:40,880 --> 00:10:44,640
pack of dlls in inject in the victims in

270
00:10:44,640 --> 00:10:47,680
the victim pros uh some processes in the

271
00:10:47,680 --> 00:10:49,839
infected machine

272
00:10:49,839 --> 00:10:52,800
and but like i couldn't even i couldn't

273
00:10:52,800 --> 00:10:55,360
i really find any connection between

274
00:10:55,360 --> 00:10:59,519
these or this really old version

275
00:10:59,760 --> 00:11:01,839
with like what i know about smoke loader

276
00:11:01,839 --> 00:11:03,360
like in modern versions you know like

277
00:11:03,360 --> 00:11:04,959
just like i mean it's so different maybe

278
00:11:04,959 --> 00:11:07,200
this is something else in in okay

279
00:11:07,200 --> 00:11:08,800
they're just like

280
00:11:08,800 --> 00:11:10,160
uh

281
00:11:10,160 --> 00:11:11,920
i just just like

282
00:11:11,920 --> 00:11:14,079
something was wrong you know then i

283
00:11:14,079 --> 00:11:15,279
continued

284
00:11:15,279 --> 00:11:17,839
digging these data i collected and i

285
00:11:17,839 --> 00:11:20,079
could find another domain

286
00:11:20,079 --> 00:11:22,560
uh resolving to this same ip address in

287
00:11:22,560 --> 00:11:24,480
that same period like this live group

288
00:11:24,480 --> 00:11:26,160
128

289
00:11:26,160 --> 00:11:28,959
back then and this time i managed to

290
00:11:28,959 --> 00:11:32,160
find like a budget a bunch of samples

291
00:11:32,160 --> 00:11:34,399
connecting to these connecting back to

292
00:11:34,399 --> 00:11:39,120
this domain and this time those samples

293
00:11:39,120 --> 00:11:43,360
were like creating these mutex uh that

294
00:11:43,360 --> 00:11:44,959
was like the smoke load demo text that

295
00:11:44,959 --> 00:11:46,959
you can see there

296
00:11:46,959 --> 00:11:50,079
and that the code of this simple uh

297
00:11:50,079 --> 00:11:52,160
these these samples are connected to

298
00:11:52,160 --> 00:11:54,160
live group will just like really similar

299
00:11:54,160 --> 00:11:56,399
to the first one then i could tie

300
00:11:56,399 --> 00:11:58,000
both campaigns you know they're just

301
00:11:58,000 --> 00:12:00,079
like they are kind of like like a new

302
00:12:00,079 --> 00:12:01,839
version of

303
00:12:01,839 --> 00:12:03,600
these second ones just a kind of a new

304
00:12:03,600 --> 00:12:05,120
version

305
00:12:05,120 --> 00:12:07,920
then i just okay now i have a start

306
00:12:07,920 --> 00:12:09,680
point and i'm gonna call those two guys

307
00:12:09,680 --> 00:12:10,639
as

308
00:12:10,639 --> 00:12:12,560
the beta version

309
00:12:12,560 --> 00:12:14,480
and they are going to be like the

310
00:12:14,480 --> 00:12:16,800
prototype

311
00:12:16,800 --> 00:12:17,600
and

312
00:12:17,600 --> 00:12:20,480
the the first uh prototype that i found

313
00:12:20,480 --> 00:12:22,240
like i mentioned that is like a

314
00:12:22,240 --> 00:12:25,519
upx um

315
00:12:25,519 --> 00:12:27,760
upx uh

316
00:12:27,760 --> 00:12:30,560
exact acceptable pack the acceptable and

317
00:12:30,560 --> 00:12:32,160
this guy just like

318
00:12:32,160 --> 00:12:34,959
compressed the the payload in start like

319
00:12:34,959 --> 00:12:38,079
a service host process inject itself

320
00:12:38,079 --> 00:12:40,399
sides

321
00:12:40,880 --> 00:12:42,959
inside this process

322
00:12:42,959 --> 00:12:44,880
it's really simple then it checks some

323
00:12:44,880 --> 00:12:46,560
connections connecting to some random

324
00:12:46,560 --> 00:12:51,200
sites in sdn like mozilla google etc

325
00:12:51,200 --> 00:12:53,120
and then

326
00:12:53,120 --> 00:12:56,480
and then it connects back to to the

327
00:12:56,480 --> 00:12:59,360
controller using http http

328
00:12:59,360 --> 00:13:02,639
everything in plain text and

329
00:13:02,639 --> 00:13:05,680
and and just like just visible and

330
00:13:05,680 --> 00:13:07,120
cacheable

331
00:13:07,120 --> 00:13:09,360
and this is like an example of the

332
00:13:09,360 --> 00:13:12,720
beacon for the sample i was analyzing

333
00:13:12,720 --> 00:13:13,920
and then the

334
00:13:13,920 --> 00:13:15,600
the controller is just gonna send back

335
00:13:15,600 --> 00:13:19,279
some that big package like exo encrypted

336
00:13:19,279 --> 00:13:21,760
contain like some dlls and those the lls

337
00:13:21,760 --> 00:13:23,200
are going to be

338
00:13:23,200 --> 00:13:26,639
saved the second version

339
00:13:26,639 --> 00:13:28,800
things got a little bit more interesting

340
00:13:28,800 --> 00:13:30,639
and this is the version that smoke

341
00:13:30,639 --> 00:13:32,240
loader

342
00:13:32,240 --> 00:13:34,160
start to create that

343
00:13:34,160 --> 00:13:36,639
mutex that i i mentioned before this

344
00:13:36,639 --> 00:13:39,279
much loader uh mutex but

345
00:13:39,279 --> 00:13:41,120
my reasoning

346
00:13:41,120 --> 00:13:43,760
for these versions is just that okay

347
00:13:43,760 --> 00:13:47,040
this guy he had a red like a like a

348
00:13:47,040 --> 00:13:49,440
like a bot that he could just send this

349
00:13:49,440 --> 00:13:50,560
packet

350
00:13:50,560 --> 00:13:53,240
uh dlls and this bot was able to

351
00:13:53,240 --> 00:13:54,560
[Music]

352
00:13:54,560 --> 00:13:56,079
to load these

353
00:13:56,079 --> 00:13:58,399
dlls in the

354
00:13:58,399 --> 00:14:00,160
in the effect machine he just like

355
00:14:00,160 --> 00:14:03,199
created like a comment this comment

356
00:14:03,199 --> 00:14:05,680
uh he called it like get load

357
00:14:05,680 --> 00:14:07,920
and he just uh kind of automated you

358
00:14:07,920 --> 00:14:09,760
know like he added a new functionality

359
00:14:09,760 --> 00:14:11,360
in the panel that you're gonna just

360
00:14:11,360 --> 00:14:13,519
upload your

361
00:14:13,519 --> 00:14:17,600
your exactable or your dll and then and

362
00:14:17,600 --> 00:14:20,720
the the uh the controller gonna just

363
00:14:20,720 --> 00:14:24,000
uh send these uh these exact board this

364
00:14:24,000 --> 00:14:26,480
dll to to be installed like in the in

365
00:14:26,480 --> 00:14:28,000
the box

366
00:14:28,000 --> 00:14:31,279
and this is this was when start uh

367
00:14:31,279 --> 00:14:32,560
we could see

368
00:14:32,560 --> 00:14:34,800
the first advertisements of smoke load

369
00:14:34,800 --> 00:14:37,440
and smoke loader start to get commercial

370
00:14:37,440 --> 00:14:40,720
back in 2011.

371
00:14:40,880 --> 00:14:41,920
um

372
00:14:41,920 --> 00:14:43,360
then

373
00:14:43,360 --> 00:14:45,519
like smoke loads spend some time just

374
00:14:45,519 --> 00:14:49,279
like building up the customer base

375
00:14:49,279 --> 00:14:54,160
and you could see a new update in 2013

376
00:14:54,160 --> 00:14:56,800
and these these new updates could see a

377
00:14:56,800 --> 00:14:59,600
red like smoke loader doing some

378
00:14:59,600 --> 00:15:01,920
house cleaning and cleaning something

379
00:15:01,920 --> 00:15:03,920
fingerprints

380
00:15:03,920 --> 00:15:06,000
we could see that smoke loader replaces

381
00:15:06,000 --> 00:15:06,800
the

382
00:15:06,800 --> 00:15:08,800
that mutex the smoke load the mood text

383
00:15:08,800 --> 00:15:10,800
by the bot id

384
00:15:10,800 --> 00:15:13,199
and this kind of like may made it like

385
00:15:13,199 --> 00:15:15,680
less detectable but updated the protocol

386
00:15:15,680 --> 00:15:18,480
a little bit had these uh hard coded

387
00:15:18,480 --> 00:15:20,000
string uh

388
00:15:20,000 --> 00:15:22,240
with the version of the bot back then

389
00:15:22,240 --> 00:15:23,920
and

390
00:15:23,920 --> 00:15:26,079
and and yeah but you can you could see

391
00:15:26,079 --> 00:15:29,199
that is still like a very simple and in

392
00:15:29,199 --> 00:15:31,120
uh piece of matter you could see that

393
00:15:31,120 --> 00:15:33,600
the all the protocol

394
00:15:33,600 --> 00:15:35,759
and the communication were like sent

395
00:15:35,759 --> 00:15:38,320
through http get and everything goes in

396
00:15:38,320 --> 00:15:41,199
plain text

397
00:15:41,199 --> 00:15:43,519
in 2014 was the first time that smoke

398
00:15:43,519 --> 00:15:46,639
loader started to inject itself

399
00:15:46,639 --> 00:15:48,360
inside

400
00:15:48,360 --> 00:15:51,759
explorer.exe and this is

401
00:15:51,759 --> 00:15:53,680
the same target process that we see

402
00:15:53,680 --> 00:15:55,759
nowadays

403
00:15:55,759 --> 00:15:57,120
and

404
00:15:57,120 --> 00:15:59,040
and yeah basically that's what's

405
00:15:59,040 --> 00:16:00,680
happening in 2014

406
00:16:00,680 --> 00:16:03,839
2015 we got like really like big changes

407
00:16:03,839 --> 00:16:05,680
you know fights much loader

408
00:16:05,680 --> 00:16:06,839
and

409
00:16:06,839 --> 00:16:10,720
they really it's it's really like

410
00:16:10,720 --> 00:16:12,240
interesting because they start to get a

411
00:16:12,240 --> 00:16:15,120
lot of feedback from customers and

412
00:16:15,120 --> 00:16:17,600
and also like uh from

413
00:16:17,600 --> 00:16:19,600
people detecting

414
00:16:19,600 --> 00:16:21,120
detecting uh

415
00:16:21,120 --> 00:16:22,560
detecting it

416
00:16:22,560 --> 00:16:24,880
and they strike they try to really start

417
00:16:24,880 --> 00:16:27,839
to hide itself in in in and like clean

418
00:16:27,839 --> 00:16:29,759
up like some fingerprints the first

419
00:16:29,759 --> 00:16:31,040
thing that uh

420
00:16:31,040 --> 00:16:33,120
spoke a little loader did was encrypted

421
00:16:33,120 --> 00:16:35,199
encrypting all the resources you know

422
00:16:35,199 --> 00:16:38,160
now if you

423
00:16:38,160 --> 00:16:39,279
like uh

424
00:16:39,279 --> 00:16:42,079
unpack like one uh one smoke load a

425
00:16:42,079 --> 00:16:43,360
sample

426
00:16:43,360 --> 00:16:45,759
and you you look at that at that payload

427
00:16:45,759 --> 00:16:47,759
you're not gonna see any kind of hard

428
00:16:47,759 --> 00:16:50,399
coded strings anymore everything is

429
00:16:50,399 --> 00:16:52,079
encrypted

430
00:16:52,079 --> 00:16:53,279
and

431
00:16:53,279 --> 00:16:55,199
they also

432
00:16:55,199 --> 00:16:59,519
start to use http post in instead of get

433
00:16:59,519 --> 00:17:02,000
and these would just like avoid like

434
00:17:02,000 --> 00:17:04,640
some of those requests to get cached in

435
00:17:04,640 --> 00:17:06,799
some web process and and this kind of

436
00:17:06,799 --> 00:17:09,760
stuff they got a little bit more stealth

437
00:17:09,760 --> 00:17:12,400
if you if you can say that like back

438
00:17:12,400 --> 00:17:13,599
then

439
00:17:13,599 --> 00:17:17,039
and they also refactor the

440
00:17:17,039 --> 00:17:19,599
the protocol you know now

441
00:17:19,599 --> 00:17:23,039
it uh they created these kind of like

442
00:17:23,039 --> 00:17:24,400
placeholder

443
00:17:24,400 --> 00:17:26,559
placeholders like basic protocol that

444
00:17:26,559 --> 00:17:28,000
you just have like

445
00:17:28,000 --> 00:17:29,520
basically the same information you can

446
00:17:29,520 --> 00:17:32,080
find it in the in the url but separated

447
00:17:32,080 --> 00:17:34,559
by these these hashes

448
00:17:34,559 --> 00:17:36,559
and for the first time smoke loaders

449
00:17:36,559 --> 00:17:39,200
start to encrypt the

450
00:17:39,200 --> 00:17:41,440
uh that like that communication you know

451
00:17:41,440 --> 00:17:43,679
like then but it was like really like

452
00:17:43,679 --> 00:17:45,600
broken crypto scheme back then but it

453
00:17:45,600 --> 00:17:47,520
was good enough for them to

454
00:17:47,520 --> 00:17:49,440
to breathe a little bit like further

455
00:17:49,440 --> 00:17:52,640
like uh back then and and come up with

456
00:17:52,640 --> 00:17:54,640
something more sophisticated

457
00:17:54,640 --> 00:17:57,200
but yeah they were just like rc phone

458
00:17:57,200 --> 00:17:58,720
these

459
00:17:58,720 --> 00:18:01,120
the payload with these four bytes rc4

460
00:18:01,120 --> 00:18:02,960
key

461
00:18:02,960 --> 00:18:05,679
and but the things that the key was just

462
00:18:05,679 --> 00:18:07,840
uh appended to the beginning of the

463
00:18:07,840 --> 00:18:11,360
payload you know then you could just

464
00:18:11,440 --> 00:18:13,039
inspect any

465
00:18:13,039 --> 00:18:16,480
all the communication just just by

466
00:18:16,480 --> 00:18:18,880
inspecting network network traffic you

467
00:18:18,880 --> 00:18:20,720
know then you don't need really to to

468
00:18:20,720 --> 00:18:23,520
reverse them out to

469
00:18:23,520 --> 00:18:24,240
to

470
00:18:24,240 --> 00:18:26,799
to see what they're like doing

471
00:18:26,799 --> 00:18:28,559
back again

472
00:18:28,559 --> 00:18:32,880
then in 2016 we didn't have any

473
00:18:32,880 --> 00:18:34,880
major release of smoke loader they had

474
00:18:34,880 --> 00:18:37,520
like a break or like some vacations i

475
00:18:37,520 --> 00:18:38,640
don't know

476
00:18:38,640 --> 00:18:40,240
but yeah

477
00:18:40,240 --> 00:18:43,440
in 2017 they came back

478
00:18:43,440 --> 00:18:45,360
full power and

479
00:18:45,360 --> 00:18:48,559
we could start to and start to get in

480
00:18:48,559 --> 00:18:51,440
shape to what we we know and what we

481
00:18:51,440 --> 00:18:53,760
understand as like the modern versions

482
00:18:53,760 --> 00:18:55,039
of smoke loader what you can see

483
00:18:55,039 --> 00:18:57,760
nowadays they started to implement these

484
00:18:57,760 --> 00:19:00,960
watch dog treads just to check

485
00:19:00,960 --> 00:19:02,799
some uh

486
00:19:02,799 --> 00:19:03,280
some

487
00:19:03,280 --> 00:19:04,559
[Music]

488
00:19:04,559 --> 00:19:07,120
analysis attempts

489
00:19:07,120 --> 00:19:07,919
like

490
00:19:07,919 --> 00:19:10,559
try to check process names try to check

491
00:19:10,559 --> 00:19:13,440
foreground windows titles try they try

492
00:19:13,440 --> 00:19:17,039
to check also like load loaded dlls

493
00:19:17,039 --> 00:19:17,840
and

494
00:19:17,840 --> 00:19:19,520
and if they detect something they're

495
00:19:19,520 --> 00:19:21,360
just just gonna like

496
00:19:21,360 --> 00:19:23,280
exit

497
00:19:23,280 --> 00:19:24,960
and they also like update the crypto

498
00:19:24,960 --> 00:19:28,160
scheme uh this time they they got to

499
00:19:28,160 --> 00:19:30,720
that that what we know nowadays that

500
00:19:30,720 --> 00:19:32,400
that like famous

501
00:19:32,400 --> 00:19:36,160
scheme using two rc4 crypto

502
00:19:36,160 --> 00:19:38,720
uh two two four bytes

503
00:19:38,720 --> 00:19:42,400
uh rc4 keys uh they use one for

504
00:19:42,400 --> 00:19:43,919
encrypting

505
00:19:43,919 --> 00:19:46,960
outgoing uh traffic and another one for

506
00:19:46,960 --> 00:19:50,799
decrypting incoming uh traffic

507
00:19:50,799 --> 00:19:52,160
and they also like remove the

508
00:19:52,160 --> 00:19:54,720
placeholders then we don't have any more

509
00:19:54,720 --> 00:19:56,720
if you manage to decrypt it

510
00:19:56,720 --> 00:19:58,799
to the crypt like at the the

511
00:19:58,799 --> 00:20:00,320
the checking or any kind of

512
00:20:00,320 --> 00:20:02,799
communication you don't see any models

513
00:20:02,799 --> 00:20:05,520
nicely a plain text

514
00:20:05,520 --> 00:20:07,679
messages but now you see

515
00:20:07,679 --> 00:20:11,919
these binary based protocol

516
00:20:11,919 --> 00:20:14,240
and yeah they just asked to follow this

517
00:20:14,240 --> 00:20:17,440
guy in in in sent to to the controller

518
00:20:17,440 --> 00:20:19,039
and they also implemented support to

519
00:20:19,039 --> 00:20:21,520
name coins to dot bit domains using

520
00:20:21,520 --> 00:20:22,960
openik

521
00:20:22,960 --> 00:20:24,559
and that the the check him back

522
00:20:24,559 --> 00:20:27,760
then like in 2017 had fixed

523
00:20:27,760 --> 00:20:28,640
fixed

524
00:20:28,640 --> 00:20:31,760
uh 63 bytes you know and they knecked

525
00:20:31,760 --> 00:20:32,880
actually

526
00:20:32,880 --> 00:20:35,360
these was a problem because people start

527
00:20:35,360 --> 00:20:37,440
a problem for them the people start to

528
00:20:37,440 --> 00:20:38,880
fingerprint

529
00:20:38,880 --> 00:20:43,120
uh smoke loader based on on the size

530
00:20:43,120 --> 00:20:46,000
fingerprint network traffic

531
00:20:46,000 --> 00:20:47,360
and

532
00:20:47,360 --> 00:20:51,440
in 2008 it uh we had the first six four

533
00:20:51,440 --> 00:20:54,880
bits versions of smoke loader

534
00:20:54,880 --> 00:20:55,679
and

535
00:20:55,679 --> 00:20:57,760
it's below the start also to

536
00:20:57,760 --> 00:21:00,480
to use propagate as process injection

537
00:21:00,480 --> 00:21:01,600
technique

538
00:21:01,600 --> 00:21:03,679
and therefore back then it was quite new

539
00:21:03,679 --> 00:21:05,180
and this kind of

540
00:21:05,180 --> 00:21:06,720
[Music]

541
00:21:06,720 --> 00:21:09,679
made smoke loader evade some some

542
00:21:09,679 --> 00:21:11,520
sandboxes

543
00:21:11,520 --> 00:21:13,679
and they they just keep switching the

544
00:21:13,679 --> 00:21:14,799
kind of

545
00:21:14,799 --> 00:21:19,520
the technique used for process injection

546
00:21:21,120 --> 00:21:24,320
in 2019

547
00:21:24,320 --> 00:21:26,960
we got a little bit more of

548
00:21:26,960 --> 00:21:30,720
anti-analysis techniques implemented

549
00:21:30,720 --> 00:21:33,840
smokeloader decide to just do a copy of

550
00:21:33,840 --> 00:21:35,600
ntdll

551
00:21:35,600 --> 00:21:38,080
and they load this copy and then start

552
00:21:38,080 --> 00:21:41,678
to use this copy you know then

553
00:21:41,760 --> 00:21:43,840
doing that they managed to bypass some

554
00:21:43,840 --> 00:21:46,320
hooking mechanisms of some sandbox

555
00:21:46,320 --> 00:21:48,159
because you didn't get in logs

556
00:21:48,159 --> 00:21:52,720
behavioral logs like about api calls in

557
00:21:52,720 --> 00:21:55,919
in the in their reports

558
00:21:55,919 --> 00:21:56,840
and

559
00:21:56,840 --> 00:21:58,480
also uh

560
00:21:58,480 --> 00:22:02,000
they also decided to paint some random

561
00:22:02,000 --> 00:22:04,159
sized uh

562
00:22:04,159 --> 00:22:05,120
uh

563
00:22:05,120 --> 00:22:07,840
rondo bytes array like on at the end of

564
00:22:07,840 --> 00:22:08,880
the

565
00:22:08,880 --> 00:22:10,840
of the of their

566
00:22:10,840 --> 00:22:13,919
messages and these also kind of

567
00:22:13,919 --> 00:22:16,080
uh

568
00:22:17,039 --> 00:22:19,280
managed to defeat the detection that

569
00:22:19,280 --> 00:22:21,200
were using the

570
00:22:21,200 --> 00:22:26,000
the six the fixed 63 bytes

571
00:22:29,840 --> 00:22:30,799
before

572
00:22:30,799 --> 00:22:33,039
and also like in 2019 you could see the

573
00:22:33,039 --> 00:22:35,280
first cracked version of smoke loader

574
00:22:35,280 --> 00:22:36,720
you know like some

575
00:22:36,720 --> 00:22:38,400
customer just decided okay i'm not going

576
00:22:38,400 --> 00:22:40,880
to buy i'm gonna not gonna pay back

577
00:22:40,880 --> 00:22:43,200
again for this guy to

578
00:22:43,200 --> 00:22:46,080
to just replace my controller uh url

579
00:22:46,080 --> 00:22:49,200
that got that got like that have some

580
00:22:49,200 --> 00:22:51,919
takeover happen or just got down

581
00:22:51,919 --> 00:22:54,799
i'm gonna just unpack smoke loader patch

582
00:22:54,799 --> 00:22:57,520
it and pack it again and i have my my

583
00:22:57,520 --> 00:22:58,880
kind of my

584
00:22:58,880 --> 00:23:01,840
my own version cracked version of smoke

585
00:23:01,840 --> 00:23:03,600
loading

586
00:23:03,600 --> 00:23:06,240
but we could spot this variation

587
00:23:06,240 --> 00:23:09,760
in 2020s few more

588
00:23:09,760 --> 00:23:10,880
internal

589
00:23:10,880 --> 00:23:13,919
tests uh auto checks uh

590
00:23:13,919 --> 00:23:15,660
smoke loader started to

591
00:23:15,660 --> 00:23:17,280
[Music]

592
00:23:17,280 --> 00:23:19,440
to do some kind of geofencing

593
00:23:19,440 --> 00:23:21,760
client-side geofencing and start to

594
00:23:21,760 --> 00:23:24,559
check for for keyboard layout

595
00:23:24,559 --> 00:23:28,559
layout back then uh specifically some

596
00:23:28,559 --> 00:23:32,080
ukrainian in russian russia

597
00:23:32,080 --> 00:23:35,039
layouts named

598
00:23:35,360 --> 00:23:37,039
yep and

599
00:23:37,039 --> 00:23:40,320
also implement some vm uh some checks

600
00:23:40,320 --> 00:23:43,120
for uh against like vm agents like as if

601
00:23:43,120 --> 00:23:44,880
you install if you try to analyze a

602
00:23:44,880 --> 00:23:46,559
smoke load inside

603
00:23:46,559 --> 00:23:48,559
a virtual machine of these know

604
00:23:48,559 --> 00:23:50,720
technologies like uh

605
00:23:50,720 --> 00:23:53,679
like vmware or vitor box

606
00:23:53,679 --> 00:23:55,120
and if you have the agent install it

607
00:23:55,120 --> 00:23:56,640
there then

608
00:23:56,640 --> 00:23:58,320
smoke is gonna it's gonna it's not gonna

609
00:23:58,320 --> 00:24:01,279
detonate correctly

610
00:24:02,000 --> 00:24:04,080
after all this time also they decided to

611
00:24:04,080 --> 00:24:06,080
stop to check in the internet connection

612
00:24:06,080 --> 00:24:07,760
because this was also like quite

613
00:24:07,760 --> 00:24:09,600
fingerprintable

614
00:24:09,600 --> 00:24:11,120
and they were just like doing these

615
00:24:11,120 --> 00:24:12,080
random

616
00:24:12,080 --> 00:24:14,960
connections to mozilla to google or to

617
00:24:14,960 --> 00:24:16,159
ms team

618
00:24:16,159 --> 00:24:18,400
just to check if they bot could reach

619
00:24:18,400 --> 00:24:20,320
the internet and before connecting to

620
00:24:20,320 --> 00:24:23,760
the c2 and now smoke loaded just

621
00:24:23,760 --> 00:24:25,440
connects directly to the to the

622
00:24:25,440 --> 00:24:27,039
controller url

623
00:24:27,039 --> 00:24:30,799
and also in 2020 they

624
00:24:30,799 --> 00:24:33,360
removed the support dot beat because uh

625
00:24:33,360 --> 00:24:35,600
openik just dropped support to name

626
00:24:35,600 --> 00:24:37,520
coins like in 2019 they just did that

627
00:24:37,520 --> 00:24:39,840
clean up but it's really nice to see

628
00:24:39,840 --> 00:24:41,039
them

629
00:24:41,039 --> 00:24:43,279
uh really like uh

630
00:24:43,279 --> 00:24:45,600
the dead development life cycle and they

631
00:24:45,600 --> 00:24:47,279
really like removing features that are

632
00:24:47,279 --> 00:24:48,640
not like

633
00:24:48,640 --> 00:24:50,559
they uh use it

634
00:24:50,559 --> 00:24:52,240
not like important anymore and adding

635
00:24:52,240 --> 00:24:54,320
adding new ones like like like a proper

636
00:24:54,320 --> 00:24:57,279
like software development

637
00:24:57,279 --> 00:24:58,960
company or a small company or something

638
00:24:58,960 --> 00:25:00,799
like that

639
00:25:00,799 --> 00:25:05,520
and in 2021 and 2022 we didn't have any

640
00:25:05,520 --> 00:25:08,240
major releases of smoke loader

641
00:25:08,240 --> 00:25:10,080
and this made me wonder you know like

642
00:25:10,080 --> 00:25:11,840
why you didn't have any

643
00:25:11,840 --> 00:25:13,279
uh

644
00:25:13,279 --> 00:25:18,159
like releases in in 2016 2021 2022 then

645
00:25:18,159 --> 00:25:20,080
i start to think about like how maybe

646
00:25:20,080 --> 00:25:21,840
this could be like some stretch but i

647
00:25:21,840 --> 00:25:23,760
could kind of connect

648
00:25:23,760 --> 00:25:24,720
and

649
00:25:24,720 --> 00:25:27,279
these breaks to

650
00:25:27,279 --> 00:25:29,919
like the conflicts that happened and

651
00:25:29,919 --> 00:25:32,559
it's happening in between

652
00:25:32,559 --> 00:25:35,279
russia and ukraine uh actually like if

653
00:25:35,279 --> 00:25:38,320
you think about back then in 2014 that

654
00:25:38,320 --> 00:25:40,960
had that annexation of crimea

655
00:25:40,960 --> 00:25:42,240
but they

656
00:25:42,240 --> 00:25:44,559
that conflict kind of like

657
00:25:44,559 --> 00:25:48,159
unfolded to two years like after that

658
00:25:48,159 --> 00:25:50,159
then this could be one of the reasons

659
00:25:50,159 --> 00:25:54,240
then i i i like i think like the

660
00:25:54,240 --> 00:25:58,080
smoke loader actor is based in

661
00:25:58,080 --> 00:25:59,760
some of

662
00:25:59,760 --> 00:26:02,320
that region

663
00:26:02,320 --> 00:26:04,080
and then i did some

664
00:26:04,080 --> 00:26:08,320
statistics on on the assembly code

665
00:26:08,320 --> 00:26:11,679
on the top left is just like the average

666
00:26:11,679 --> 00:26:12,960
cycle

667
00:26:12,960 --> 00:26:15,360
cyclomatic complexity

668
00:26:15,360 --> 00:26:17,679
of functions

669
00:26:17,679 --> 00:26:18,480
in

670
00:26:18,480 --> 00:26:21,679
uh in history like like it's

671
00:26:21,679 --> 00:26:24,559
this is all based on ida

672
00:26:24,559 --> 00:26:26,159
these are symbols

673
00:26:26,159 --> 00:26:27,120
and

674
00:26:27,120 --> 00:26:29,840
on the top left the average cyclomat

675
00:26:29,840 --> 00:26:33,039
complexity of functions top right

676
00:26:33,039 --> 00:26:35,760
the counting of basic blocks

677
00:26:35,760 --> 00:26:38,640
bottom left the count of functions

678
00:26:38,640 --> 00:26:41,200
bottom right the imports that smoke

679
00:26:41,200 --> 00:26:44,000
loaded just dynamically

680
00:26:44,000 --> 00:26:46,480
resolving creates this important table

681
00:26:46,480 --> 00:26:48,720
there

682
00:26:49,279 --> 00:26:51,120
and the first thing that i want to

683
00:26:51,120 --> 00:26:53,200
highlight is these

684
00:26:53,200 --> 00:26:54,720
at the beginning of smoke loader the

685
00:26:54,720 --> 00:26:57,200
prototyping phase the beta the beta

686
00:26:57,200 --> 00:26:59,200
version that i mentioned before because

687
00:26:59,200 --> 00:27:00,799
you can really see that

688
00:27:00,799 --> 00:27:02,960
it was really a prototyping like with

689
00:27:02,960 --> 00:27:04,240
all these

690
00:27:04,240 --> 00:27:05,840
high complexities

691
00:27:05,840 --> 00:27:08,799
amount of functions and a big amount of

692
00:27:08,799 --> 00:27:10,799
basic blocks we're talking here about

693
00:27:10,799 --> 00:27:11,919
those

694
00:27:11,919 --> 00:27:14,559
huge um

695
00:27:14,559 --> 00:27:17,039
monolithic blocks that's just like

696
00:27:17,039 --> 00:27:19,520
a pain to to follow or to reverse but

697
00:27:19,520 --> 00:27:21,600
they were still like prototyping stuff

698
00:27:21,600 --> 00:27:23,279
for prototype

699
00:27:23,279 --> 00:27:24,080
uh

700
00:27:24,080 --> 00:27:27,039
functionalities and and testing stuff

701
00:27:27,039 --> 00:27:29,360
and we could see that like uh the

702
00:27:29,360 --> 00:27:31,840
following versions things got like

703
00:27:31,840 --> 00:27:33,520
really like more stable and you could

704
00:27:33,520 --> 00:27:35,440
see that they did a big refactoring

705
00:27:35,440 --> 00:27:36,559
before

706
00:27:36,559 --> 00:27:39,520
before start to come commercializing

707
00:27:39,520 --> 00:27:41,760
smoke loader and you can you can see

708
00:27:41,760 --> 00:27:45,760
uh complexity increasing in a linear

709
00:27:45,760 --> 00:27:48,080
way and this is quite normal because you

710
00:27:48,080 --> 00:27:50,240
have functionalities being developed

711
00:27:50,240 --> 00:27:52,080
like over time

712
00:27:52,080 --> 00:27:53,120
and

713
00:27:53,120 --> 00:27:53,919
it's

714
00:27:53,919 --> 00:27:56,640
normal and healthy

715
00:27:56,640 --> 00:27:59,039
the other point to highlight is the in

716
00:27:59,039 --> 00:28:03,360
2070 2018 18 we could see

717
00:28:03,360 --> 00:28:04,159
uh

718
00:28:04,159 --> 00:28:07,360
these spike that just smoke loader just

719
00:28:07,360 --> 00:28:10,240
like uh decided to use like a different

720
00:28:10,240 --> 00:28:11,200
compile

721
00:28:11,200 --> 00:28:12,559
compiler

722
00:28:12,559 --> 00:28:13,520
and then

723
00:28:13,520 --> 00:28:15,520
the code was segmented like in a

724
00:28:15,520 --> 00:28:17,279
different way

725
00:28:17,279 --> 00:28:19,600
these like messed up a little bit mighty

726
00:28:19,600 --> 00:28:21,520
theme but yeah this

727
00:28:21,520 --> 00:28:23,679
attained at the end like functionality

728
00:28:23,679 --> 00:28:26,320
wise were like the same in conceiving

729
00:28:26,320 --> 00:28:28,159
the complexity of the code like remain

730
00:28:28,159 --> 00:28:29,600
the same even though

731
00:28:29,600 --> 00:28:34,000
regard is increasing in basic block

732
00:28:34,240 --> 00:28:35,840
so now we're going to talk a little bit

733
00:28:35,840 --> 00:28:38,240
about the data i've been collecting

734
00:28:38,240 --> 00:28:41,200
we're talking about data collected from

735
00:28:41,200 --> 00:28:45,679
2017 until until 2020 that was like when

736
00:28:45,679 --> 00:28:47,279
the last

737
00:28:47,279 --> 00:28:49,840
major release of smoke loader

738
00:28:49,840 --> 00:28:53,039
uh showed uh like appeared

739
00:28:53,039 --> 00:28:56,320
and yeah but i i i did these

740
00:28:56,320 --> 00:28:57,120
this

741
00:28:57,120 --> 00:28:58,960
range because

742
00:28:58,960 --> 00:29:01,600
you can really see like i spike on usage

743
00:29:01,600 --> 00:29:03,520
of smoke loader

744
00:29:03,520 --> 00:29:05,840
when you have a new release because you

745
00:29:05,840 --> 00:29:09,760
see these big actors just

746
00:29:09,760 --> 00:29:13,200
trying to take advantage of those new

747
00:29:13,200 --> 00:29:15,360
all the new features that smoke loader

748
00:29:15,360 --> 00:29:16,640
can provide and

749
00:29:16,640 --> 00:29:18,880
okay before detection is implemented i'm

750
00:29:18,880 --> 00:29:19,919
gonna just

751
00:29:19,919 --> 00:29:22,799
buy it and use it as my first stage

752
00:29:22,799 --> 00:29:25,360
and you see like a big a big

753
00:29:25,360 --> 00:29:27,200
uh spike every time you get a new

754
00:29:27,200 --> 00:29:28,159
release

755
00:29:28,159 --> 00:29:30,960
of usage of stomach automatic release

756
00:29:30,960 --> 00:29:35,279
and the first data set i i want to to to

757
00:29:35,279 --> 00:29:39,520
to show to you is about infrastructure

758
00:29:39,520 --> 00:29:42,240
we're talking here about geolocation of

759
00:29:42,240 --> 00:29:44,080
domains hosting

760
00:29:44,080 --> 00:29:47,679
responsive uh smoke loader controllers

761
00:29:47,679 --> 00:29:49,520
we're not talking here about

762
00:29:49,520 --> 00:29:51,919
just like extracting config and get and

763
00:29:51,919 --> 00:29:54,880
get all the urls there and in in

764
00:29:54,880 --> 00:29:57,679
and trying to check like uh

765
00:29:57,679 --> 00:30:00,880
uh if this guy is resolving to some ip

766
00:30:00,880 --> 00:30:02,960
and try to plot these

767
00:30:02,960 --> 00:30:05,440
the geolocation of this ip in the in the

768
00:30:05,440 --> 00:30:07,760
in the shot but we're talking about

769
00:30:07,760 --> 00:30:09,679
controllers that we

770
00:30:09,679 --> 00:30:12,399
we really uh communicate with these

771
00:30:12,399 --> 00:30:14,080
controllers and we know that they are

772
00:30:14,080 --> 00:30:15,760
like smoke loader

773
00:30:15,760 --> 00:30:19,600
and we had like 98 unique domains

774
00:30:19,600 --> 00:30:22,480
located in 17 different countries

775
00:30:22,480 --> 00:30:25,520
you can see that is a little bit not

776
00:30:25,520 --> 00:30:28,000
really intuitive like if you if you had

777
00:30:28,000 --> 00:30:30,480
like our assumptions that smoke loader

778
00:30:30,480 --> 00:30:33,360
is is mcleod actor and customers are

779
00:30:33,360 --> 00:30:36,640
mainly based in in like russian speak

780
00:30:36,640 --> 00:30:37,760
countries

781
00:30:37,760 --> 00:30:39,919
you can see that

782
00:30:39,919 --> 00:30:42,399
these controllers are really like spread

783
00:30:42,399 --> 00:30:43,600
around

784
00:30:43,600 --> 00:30:45,440
and you can see like

785
00:30:45,440 --> 00:30:48,000
nearly like 45 percent like hosted in

786
00:30:48,000 --> 00:30:50,240
germany in u.s

787
00:30:50,240 --> 00:30:52,159
you can see like also like a big amount

788
00:30:52,159 --> 00:30:54,320
like hosted in the netherlands

789
00:30:54,320 --> 00:30:57,360
and do we see that as mooc loader it's

790
00:30:57,360 --> 00:30:59,360
kind of like has an international

791
00:30:59,360 --> 00:31:01,279
presence you can see even

792
00:31:01,279 --> 00:31:03,679
a few campaigns happening in latin

793
00:31:03,679 --> 00:31:08,640
america in in argentina in mexico

794
00:31:09,120 --> 00:31:12,720
some in brazil also in north africa like

795
00:31:12,720 --> 00:31:17,440
we saw some happening also in nigeria

796
00:31:17,440 --> 00:31:19,679
and then you see that smoke loader is

797
00:31:19,679 --> 00:31:22,559
really popular

798
00:31:23,440 --> 00:31:25,840
yeah we saw that like they really spread

799
00:31:25,840 --> 00:31:27,840
it around but if you look at historical

800
00:31:27,840 --> 00:31:30,840
data you can see that it was

801
00:31:30,840 --> 00:31:33,679
it this is this is not the case like in

802
00:31:33,679 --> 00:31:35,279
the past you know then you can see like

803
00:31:35,279 --> 00:31:36,159
a

804
00:31:36,159 --> 00:31:37,279
uh

805
00:31:37,279 --> 00:31:40,159
a change in in

806
00:31:40,159 --> 00:31:42,080
where these uh

807
00:31:42,080 --> 00:31:44,960
uh pine these controllers have been

808
00:31:44,960 --> 00:31:46,880
hosted like in time

809
00:31:46,880 --> 00:31:49,679
you can see that in 2017 uh those

810
00:31:49,679 --> 00:31:51,919
pioneer those controllers were mainly

811
00:31:51,919 --> 00:31:55,120
hosted like in russian speak countries

812
00:31:55,120 --> 00:31:56,080
in

813
00:31:56,080 --> 00:31:59,120
in ukraine russia in that area there and

814
00:31:59,120 --> 00:32:01,840
you can see these increasingly change

815
00:32:01,840 --> 00:32:04,720
like along the time in 2020

816
00:32:04,720 --> 00:32:06,240
we saw it that

817
00:32:06,240 --> 00:32:07,919
it got like

818
00:32:07,919 --> 00:32:10,000
much more international international

819
00:32:10,000 --> 00:32:12,320
and much more like widespread around the

820
00:32:12,320 --> 00:32:14,880
globe

821
00:32:14,880 --> 00:32:19,279
now uh talk a little bit about payloads

822
00:32:19,279 --> 00:32:23,200
in 2020 we could see

823
00:32:23,200 --> 00:32:26,960
around like 14 000 unique files being

824
00:32:26,960 --> 00:32:30,000
delivered by smokeloader

825
00:32:30,000 --> 00:32:33,840
and from these 14 unique files we could

826
00:32:33,840 --> 00:32:37,360
kind of in the identifying edit file

827
00:32:37,360 --> 00:32:40,640
4 300 of those files

828
00:32:40,640 --> 00:32:44,080
and we could it could like identify

829
00:32:44,080 --> 00:32:46,720
18 different families and you can see

830
00:32:46,720 --> 00:32:49,120
like a lot of like big families like

831
00:32:49,120 --> 00:32:51,200
popular families there

832
00:32:51,200 --> 00:32:53,200
and

833
00:32:53,200 --> 00:32:54,399
of course

834
00:32:54,399 --> 00:32:57,279
this is just a small

835
00:32:57,279 --> 00:33:00,159
ice a small portion or small section of

836
00:33:00,159 --> 00:33:02,240
the big picture you know like this is

837
00:33:02,240 --> 00:33:04,080
what we could of course like what we

838
00:33:04,080 --> 00:33:07,360
could like observe like in our data set

839
00:33:07,360 --> 00:33:09,679
but yeah smoke loader like i think it's

840
00:33:09,679 --> 00:33:12,559
much bigger than these

841
00:33:12,559 --> 00:33:14,720
and

842
00:33:14,720 --> 00:33:17,120
i would like to highlight those four

843
00:33:17,120 --> 00:33:18,880
families that they're

844
00:33:18,880 --> 00:33:23,200
seeing for the first time in 2020

845
00:33:23,279 --> 00:33:25,840
i had been dropped by smokeloader and

846
00:33:25,840 --> 00:33:28,960
now i just broke down these data uh

847
00:33:28,960 --> 00:33:30,799
along the year like two months and you

848
00:33:30,799 --> 00:33:32,159
can see that

849
00:33:32,159 --> 00:33:34,080
smokeloader had like

850
00:33:34,080 --> 00:33:37,200
had like a big it was like really active

851
00:33:37,200 --> 00:33:38,399
in

852
00:33:38,399 --> 00:33:41,200
in like july uh june july in august

853
00:33:41,200 --> 00:33:43,919
that's kind of uh summer in the in the

854
00:33:43,919 --> 00:33:46,799
northern hemisphere then this kind of

855
00:33:46,799 --> 00:33:49,120
kind of narrow down

856
00:33:49,120 --> 00:33:51,360
our possibilities we assume that i don't

857
00:33:51,360 --> 00:33:53,519
know they get more active

858
00:33:53,519 --> 00:33:55,200
in summer

859
00:33:55,200 --> 00:33:59,120
but yeah this is the hypothesis but

860
00:33:59,120 --> 00:34:01,919
you can see look at the data

861
00:34:01,919 --> 00:34:06,080
and this is the same if you see all the

862
00:34:06,080 --> 00:34:08,239
previews here you know this is kind of a

863
00:34:08,239 --> 00:34:10,320
pattern

864
00:34:10,320 --> 00:34:13,839
and if you break down these by

865
00:34:13,839 --> 00:34:15,679
by family

866
00:34:15,679 --> 00:34:18,480
we can see some interesting

867
00:34:18,480 --> 00:34:23,359
points as well the first one is about

868
00:34:23,520 --> 00:34:26,480
these campaigns happening

869
00:34:26,480 --> 00:34:27,440
in

870
00:34:27,440 --> 00:34:28,560
in mars

871
00:34:28,560 --> 00:34:32,159
in april and in june

872
00:34:32,159 --> 00:34:34,879
these isfb campaigns

873
00:34:34,879 --> 00:34:37,599
mainly mailing targeting targeting

874
00:34:37,599 --> 00:34:39,599
australia and japan

875
00:34:39,599 --> 00:34:41,440
and these

876
00:34:41,440 --> 00:34:42,320
these

877
00:34:42,320 --> 00:34:45,918
campaigns were they were using the

878
00:34:45,918 --> 00:34:47,760
the geofencing capabilities of

879
00:34:47,760 --> 00:34:50,800
smokeloader to just

880
00:34:50,800 --> 00:34:52,560
to just narrow down

881
00:34:52,560 --> 00:34:54,799
uh

882
00:34:54,960 --> 00:34:55,839
who

883
00:34:55,839 --> 00:34:56,960
would be

884
00:34:56,960 --> 00:34:58,800
received the final

885
00:34:58,800 --> 00:35:01,359
the final payload in this case the sfb

886
00:35:01,359 --> 00:35:03,200
and the interesting things that's in the

887
00:35:03,200 --> 00:35:05,599
same this same campaign was also

888
00:35:05,599 --> 00:35:06,800
delivering

889
00:35:06,800 --> 00:35:08,560
silent night

890
00:35:08,560 --> 00:35:11,119
and then we could see these two like

891
00:35:11,119 --> 00:35:12,960
kind of big families

892
00:35:12,960 --> 00:35:16,480
uh sharing distribution infrastructure

893
00:35:16,480 --> 00:35:19,280
and this was like some kind of like cool

894
00:35:19,280 --> 00:35:20,800
to to

895
00:35:20,800 --> 00:35:23,280
to observe

896
00:35:23,280 --> 00:35:25,440
uh the second point we're talking we're

897
00:35:25,440 --> 00:35:27,359
going to talk about silent night that in

898
00:35:27,359 --> 00:35:30,000
2020 it was like the first time we could

899
00:35:30,000 --> 00:35:31,920
observe these

900
00:35:31,920 --> 00:35:35,920
family this family being distributed by

901
00:35:35,920 --> 00:35:37,680
smoke loader

902
00:35:37,680 --> 00:35:40,560
and you see that they were like really

903
00:35:40,560 --> 00:35:42,960
constant along the year

904
00:35:42,960 --> 00:35:46,160
and in this case silent knight was also

905
00:35:46,160 --> 00:35:48,160
using uh

906
00:35:48,160 --> 00:35:50,720
smoke loaded geo fancy capability

907
00:35:50,720 --> 00:35:53,200
geofacing capabilities to target to

908
00:35:53,200 --> 00:35:55,920
target victims in japan

909
00:35:55,920 --> 00:35:59,680
and we could confirm that by uh obs by

910
00:35:59,680 --> 00:36:02,800
looking at their like web injects

911
00:36:02,800 --> 00:36:04,320
and

912
00:36:04,320 --> 00:36:06,320
and you could see like they selected all

913
00:36:06,320 --> 00:36:09,200
the the japanese banks and and

914
00:36:09,200 --> 00:36:10,880
that the guys also like talked about

915
00:36:10,880 --> 00:36:12,880
about silent night like early in the

916
00:36:12,880 --> 00:36:14,880
morning

917
00:36:14,880 --> 00:36:18,560
um yeah and these uh silent night

918
00:36:18,560 --> 00:36:21,040
campaigns were like the same uh there

919
00:36:21,040 --> 00:36:23,359
that were dropping

920
00:36:23,359 --> 00:36:25,440
isfb

921
00:36:25,440 --> 00:36:27,839
before

922
00:36:29,520 --> 00:36:31,040
the last

923
00:36:31,040 --> 00:36:32,079
case

924
00:36:32,079 --> 00:36:34,720
is the the system bc

925
00:36:34,720 --> 00:36:36,000
these

926
00:36:36,000 --> 00:36:37,040
red

927
00:36:37,040 --> 00:36:39,040
that has been also dropped by

928
00:36:39,040 --> 00:36:41,520
smokeloader and also by

929
00:36:41,520 --> 00:36:44,079
several other

930
00:36:44,079 --> 00:36:46,560
loaders

931
00:36:47,599 --> 00:36:50,160
and yeah like we

932
00:36:50,160 --> 00:36:52,960
we could see also this training of of

933
00:36:52,960 --> 00:36:55,040
dropping these red

934
00:36:55,040 --> 00:36:56,160
and

935
00:36:56,160 --> 00:36:58,880
and then after drop this right

936
00:36:58,880 --> 00:37:01,680
drop in some kind of hunts or you know

937
00:37:01,680 --> 00:37:05,599
we saw like some hunts or families using

938
00:37:05,599 --> 00:37:06,640
a

939
00:37:06,640 --> 00:37:09,359
system bc and you guys you you we can

940
00:37:09,359 --> 00:37:11,520
see that also like in a very nice

941
00:37:11,520 --> 00:37:12,560
article

942
00:37:12,560 --> 00:37:17,440
published by sophos also in 2020 about

943
00:37:17,440 --> 00:37:20,800
about uh han solo family's leverage on

944
00:37:20,800 --> 00:37:22,560
system bc

945
00:37:22,560 --> 00:37:25,280
but yeah we could see

946
00:37:25,280 --> 00:37:27,920
these guys shaming

947
00:37:27,920 --> 00:37:30,960
these families using smoke loader

948
00:37:30,960 --> 00:37:34,560
and now like just like some takeaways

949
00:37:34,560 --> 00:37:36,960
the first one is that like we can

950
00:37:36,960 --> 00:37:39,599
collect a information of like high

951
00:37:39,599 --> 00:37:41,520
profile like groups

952
00:37:41,520 --> 00:37:42,400
to

953
00:37:42,400 --> 00:37:45,760
distribu to their distribution scheme

954
00:37:45,760 --> 00:37:48,079
uh you can like like observing the

955
00:37:48,079 --> 00:37:49,359
geofencing

956
00:37:49,359 --> 00:37:52,160
setup in what kind of targets they are

957
00:37:52,160 --> 00:37:54,160
they are

958
00:37:54,160 --> 00:37:55,520
interested

959
00:37:55,520 --> 00:37:56,800
on and

960
00:37:56,800 --> 00:37:59,440
the second one we can

961
00:37:59,440 --> 00:38:02,480
build up connections among like families

962
00:38:02,480 --> 00:38:04,880
sharing the same distribution method

963
00:38:04,880 --> 00:38:05,680
like

964
00:38:05,680 --> 00:38:08,880
we saw in isfb in

965
00:38:08,880 --> 00:38:10,079
silent night

966
00:38:10,079 --> 00:38:12,240
example

967
00:38:12,240 --> 00:38:15,920
we can we can see also smoke loader

968
00:38:15,920 --> 00:38:18,730
being increasingly increasingly used to

969
00:38:18,730 --> 00:38:20,160
[Music]

970
00:38:20,160 --> 00:38:20,960
buy

971
00:38:20,960 --> 00:38:24,560
uh hunsor like families

972
00:38:24,560 --> 00:38:27,280
to try ash potential targets like avadon

973
00:38:27,280 --> 00:38:30,000
roger and lockbeat

974
00:38:30,000 --> 00:38:31,680
and you can see also like uh the

975
00:38:31,680 --> 00:38:33,520
international presence of smokeloader

976
00:38:33,520 --> 00:38:34,880
that smoke loading is getting more and

977
00:38:34,880 --> 00:38:38,000
more international and this is the train

978
00:38:38,000 --> 00:38:39,839
i don't think this is going to change

979
00:38:39,839 --> 00:38:41,680
a lot of presence in latin america a lot

980
00:38:41,680 --> 00:38:42,400
of

981
00:38:42,400 --> 00:38:45,040
some presence in africa as well

982
00:38:45,040 --> 00:38:46,960
and yeah i

983
00:38:46,960 --> 00:38:49,839
don't think like a smoke load director

984
00:38:49,839 --> 00:38:51,839
has any kind of like

985
00:38:51,839 --> 00:38:55,280
like big reason to hit retire like right

986
00:38:55,280 --> 00:38:58,480
now and i think smoke loaded is gonna be

987
00:38:58,480 --> 00:39:01,920
still be around for for some time

988
00:39:01,920 --> 00:39:03,839
and

989
00:39:03,839 --> 00:39:06,720
yep that's uh i would like to thank like

990
00:39:06,720 --> 00:39:07,839
my

991
00:39:07,839 --> 00:39:10,640
my team at crowdstrike

992
00:39:10,640 --> 00:39:12,880
attack team and also would like to

993
00:39:12,880 --> 00:39:14,960
thanks the guys from the tcr team at

994
00:39:14,960 --> 00:39:16,960
mandiant

995
00:39:16,960 --> 00:39:19,200
and

996
00:39:19,200 --> 00:39:21,839
yeah that's all from me thank you very

997
00:39:21,839 --> 00:39:24,839
much

998
00:39:26,450 --> 00:39:29,620
[Applause]

999
00:39:29,839 --> 00:39:33,040
okay i can i can take one question

1000
00:39:33,040 --> 00:39:36,480
otherwise we're going to be late

1001
00:39:36,480 --> 00:39:38,720
yes

1002
00:39:39,200 --> 00:39:42,680
it's not fall

1003
00:39:42,880 --> 00:39:44,800
chris franklin brief point uh have you

1004
00:39:44,800 --> 00:39:47,200
analyzed the modules that get downloaded

1005
00:39:47,200 --> 00:39:51,200
um i actually i did it uh they uh

1006
00:39:51,200 --> 00:39:53,440
if you think like about like like number

1007
00:39:53,440 --> 00:39:55,760
wise like like they had like

1008
00:39:55,760 --> 00:39:58,400
eight back then you know and then they

1009
00:39:58,400 --> 00:40:02,400
grew up for 15 or 16 but i just

1010
00:40:02,400 --> 00:40:04,720
realized that we have so many like so

1011
00:40:04,720 --> 00:40:05,839
many

1012
00:40:05,839 --> 00:40:08,000
articles about it you know around i'm

1013
00:40:08,000 --> 00:40:09,440
gonna leave

1014
00:40:09,440 --> 00:40:10,640
eventually i'm gonna publish these

1015
00:40:10,640 --> 00:40:12,960
slides i'm gonna add some references to

1016
00:40:12,960 --> 00:40:14,800
those articles talking about the modules

1017
00:40:14,800 --> 00:40:16,400
and i just thought okay i'm gonna just

1018
00:40:16,400 --> 00:40:18,319
focus in the in the timeline in the

1019
00:40:18,319 --> 00:40:20,240
history you know that's that's something

1020
00:40:20,240 --> 00:40:22,480
that you cannot find online that that

1021
00:40:22,480 --> 00:40:24,400
that easy but yeah

1022
00:40:24,400 --> 00:40:26,400
i did some analysis on the modules and

1023
00:40:26,400 --> 00:40:30,079
it's like a key logs like password grabs

1024
00:40:30,079 --> 00:40:33,520
and like like remote uh uh desktop and

1025
00:40:33,520 --> 00:40:35,760
this kind of stuff in c proxy

1026
00:40:35,760 --> 00:40:37,839
yeah they had they provide those modules

1027
00:40:37,839 --> 00:40:39,440
but

1028
00:40:39,440 --> 00:40:41,200
that's it

1029
00:40:41,200 --> 00:40:43,640
thank you thank you

1030
00:40:43,640 --> 00:40:50,279
[Applause]

