1
00:00:00,880 --> 00:00:03,760
mature i'll let you introduce yourself

2
00:00:03,760 --> 00:00:05,600
and you have the floor thank you thank

3
00:00:05,600 --> 00:00:07,120
you

4
00:00:07,120 --> 00:00:07,839
so

5
00:00:07,839 --> 00:00:10,639
hi everyone thanks for being here

6
00:00:10,639 --> 00:00:13,440
this morning even though the gala was

7
00:00:13,440 --> 00:00:15,599
yesterday evening

8
00:00:15,599 --> 00:00:17,760
unless you are living in a desert island

9
00:00:17,760 --> 00:00:19,680
with no internet access during the last

10
00:00:19,680 --> 00:00:22,800
year you have probably heard about quite

11
00:00:22,800 --> 00:00:24,880
some big issues around

12
00:00:24,880 --> 00:00:27,039
microsoft exchange

13
00:00:27,039 --> 00:00:30,880
the attacks were deemed so important by

14
00:00:30,880 --> 00:00:33,120
the fbi that they decided

15
00:00:33,120 --> 00:00:35,040
to remove themselves the malicious web

16
00:00:35,040 --> 00:00:37,600
shells on compromised servers located in

17
00:00:37,600 --> 00:00:40,079
the u.s

18
00:00:40,160 --> 00:00:42,239
in this presentation i'm going to

19
00:00:42,239 --> 00:00:45,039
present a year in review of

20
00:00:45,039 --> 00:00:47,680
microsoft exchange exploitation and i

21
00:00:47,680 --> 00:00:49,920
will discuss both the proxy logon and

22
00:00:49,920 --> 00:00:52,160
the proxial vulnerabilities and their

23
00:00:52,160 --> 00:00:54,000
variations

24
00:00:54,000 --> 00:00:56,160
we will discuss how multiple cyber

25
00:00:56,160 --> 00:00:57,920
espionage groups abused these

26
00:00:57,920 --> 00:01:00,160
vulnerabilities to take over thousands

27
00:01:00,160 --> 00:01:02,640
of mail servers in particular in march

28
00:01:02,640 --> 00:01:04,879
and august

29
00:01:04,879 --> 00:01:07,840
i'm matthew tartar and i'm a malware

30
00:01:07,840 --> 00:01:11,119
researcher at eset

31
00:01:11,119 --> 00:01:13,600
so let's start with the proxy logon

32
00:01:13,600 --> 00:01:15,920
vulnerability

33
00:01:15,920 --> 00:01:19,520
this microsoft exchange vulnerability is

34
00:01:19,520 --> 00:01:21,600
actually not one single vulnerability

35
00:01:21,600 --> 00:01:23,600
but a set of four different

36
00:01:23,600 --> 00:01:26,080
vulnerabilities that together are known

37
00:01:26,080 --> 00:01:28,000
as proxy logon

38
00:01:28,000 --> 00:01:30,720
when they are chained together we get a

39
00:01:30,720 --> 00:01:32,799
pre-authentication remote code execution

40
00:01:32,799 --> 00:01:35,360
vulnerability meaning that the attackers

41
00:01:35,360 --> 00:01:38,000
don't need a valid user account to be

42
00:01:38,000 --> 00:01:40,640
able to execute arbitrary commands on an

43
00:01:40,640 --> 00:01:43,600
unpatched action server

44
00:01:43,600 --> 00:01:46,240
these vulnerabilities affect the three

45
00:01:46,240 --> 00:01:48,720
most recent versions of microsoft

46
00:01:48,720 --> 00:01:50,240
exchange namely

47
00:01:50,240 --> 00:01:51,840
microsoft exchange

48
00:01:51,840 --> 00:01:55,119
2013 16 and 19.

49
00:01:55,119 --> 00:01:57,119
the cloud versions

50
00:01:57,119 --> 00:01:59,680
exchange online are

51
00:01:59,680 --> 00:02:02,000
outlook 365 are not affected by these

52
00:02:02,000 --> 00:02:03,680
vulnerabilities

53
00:02:03,680 --> 00:02:05,920
so let's have a look at the timeline of

54
00:02:05,920 --> 00:02:07,119
events

55
00:02:07,119 --> 00:02:10,399
so according to valekcity the earliest

56
00:02:10,399 --> 00:02:13,040
in the wild exploitation of proxy logan

57
00:02:13,040 --> 00:02:16,319
happened on the 3rd of january

58
00:02:16,319 --> 00:02:19,520
and an important point to note is that

59
00:02:19,520 --> 00:02:22,720
this was before the vulnerabilities were

60
00:02:22,720 --> 00:02:25,840
reported to microsoft by oran chai who

61
00:02:25,840 --> 00:02:26,640
is

62
00:02:26,640 --> 00:02:29,520
a security researcher

63
00:02:29,520 --> 00:02:31,120
on

64
00:02:31,120 --> 00:02:34,879
february 2021 we started seeing more apt

65
00:02:34,879 --> 00:02:37,360
groups that started to exploit the

66
00:02:37,360 --> 00:02:39,840
vulnerability and

67
00:02:39,840 --> 00:02:42,879
on march 2nd microsoft finally released

68
00:02:42,879 --> 00:02:45,040
an out-of-band patch

69
00:02:45,040 --> 00:02:46,480
that was

70
00:02:46,480 --> 00:02:49,040
initially scheduled for the week after

71
00:02:49,040 --> 00:02:50,480
in the regular

72
00:02:50,480 --> 00:02:52,000
thursday

73
00:02:52,000 --> 00:02:54,800
the very next day on

74
00:02:54,800 --> 00:02:58,080
march march 3rd we observed the start of

75
00:02:58,080 --> 00:03:00,879
mass exploitation of proxy logan so it

76
00:03:00,879 --> 00:03:03,920
was no longer no longer targeted and

77
00:03:03,920 --> 00:03:06,159
multiple different attackers were trying

78
00:03:06,159 --> 00:03:08,879
to take over as many vulnerable servers

79
00:03:08,879 --> 00:03:11,680
as possible before they were patched

80
00:03:11,680 --> 00:03:12,560
and

81
00:03:12,560 --> 00:03:15,120
that timeline suggests that

82
00:03:15,120 --> 00:03:17,440
apneam got the vulnerability first and

83
00:03:17,440 --> 00:03:21,120
that the other apt groups that exploited

84
00:03:21,120 --> 00:03:23,680
the vulnerabilities that starting on the

85
00:03:23,680 --> 00:03:27,040
28th of february got it in a separate

86
00:03:27,040 --> 00:03:30,000
league or from a different source but we

87
00:03:30,000 --> 00:03:33,200
cannot know for sure

88
00:03:33,200 --> 00:03:35,200
so let's have a look at some statistics

89
00:03:35,200 --> 00:03:38,239
this graph represents essence detection

90
00:03:38,239 --> 00:03:40,080
for the web shells

91
00:03:40,080 --> 00:03:42,000
that were dropped by the attacker during

92
00:03:42,000 --> 00:03:44,239
the exploitation of vulnerable exchange

93
00:03:44,239 --> 00:03:45,760
servers

94
00:03:45,760 --> 00:03:46,640
so

95
00:03:46,640 --> 00:03:49,360
before the patch released the volume

96
00:03:49,360 --> 00:03:50,159
was

97
00:03:50,159 --> 00:03:53,360
quite limited and even null before

98
00:03:53,360 --> 00:03:55,680
february 28th

99
00:03:55,680 --> 00:03:57,920
but as you can see on that graph just

100
00:03:57,920 --> 00:03:59,439
after the release of the patch the

101
00:03:59,439 --> 00:04:01,680
number of exploitation attempts

102
00:04:01,680 --> 00:04:04,319
strongly increased and it was pretty

103
00:04:04,319 --> 00:04:06,640
high during the next few days following

104
00:04:06,640 --> 00:04:07,360
the

105
00:04:07,360 --> 00:04:10,239
release of the patch

106
00:04:10,879 --> 00:04:12,560
on march 4th

107
00:04:12,560 --> 00:04:15,840
shodan published some statistics about

108
00:04:15,840 --> 00:04:18,079
vulnerable exchange servers

109
00:04:18,079 --> 00:04:20,798
that were accessible from the internet

110
00:04:20,798 --> 00:04:23,759
so you see that the number is quite high

111
00:04:23,759 --> 00:04:25,520
and

112
00:04:25,520 --> 00:04:26,840
more than

113
00:04:26,840 --> 00:04:30,240
250 000 servers were vulnerable

114
00:04:30,240 --> 00:04:31,120
so

115
00:04:31,120 --> 00:04:33,840
since attackers were doing mass scanning

116
00:04:33,840 --> 00:04:36,400
to find such a server it's quite likely

117
00:04:36,400 --> 00:04:40,479
that most of them were compromised

118
00:04:40,800 --> 00:04:44,080
the fact that this vulnerability didn't

119
00:04:44,080 --> 00:04:47,199
require any valid credentials

120
00:04:47,199 --> 00:04:49,440
is the reason that allowed attackers to

121
00:04:49,440 --> 00:04:52,320
perform mass scanning and that allowed

122
00:04:52,320 --> 00:04:53,759
them to compromise

123
00:04:53,759 --> 00:04:55,680
very quickly most of the unpatched

124
00:04:55,680 --> 00:04:57,840
server

125
00:04:58,720 --> 00:04:59,520
so

126
00:04:59,520 --> 00:05:02,080
how are the oh is the proxy logon

127
00:05:02,080 --> 00:05:04,960
vulnerability used by the attacker

128
00:05:04,960 --> 00:05:07,520
first the attacker need to exploit cv

129
00:05:07,520 --> 00:05:11,360
2021 26 855 which is a vulnerability

130
00:05:11,360 --> 00:05:14,160
that allows an attacker to authenticate

131
00:05:14,160 --> 00:05:15,039
into

132
00:05:15,039 --> 00:05:17,520
any reachable action servers without any

133
00:05:17,520 --> 00:05:18,880
credentials

134
00:05:18,880 --> 00:05:21,199
then chain with the three other

135
00:05:21,199 --> 00:05:23,440
vulnerabilities it allows the attacker

136
00:05:23,440 --> 00:05:24,560
to install

137
00:05:24,560 --> 00:05:27,840
a webshell which is a small aspx script

138
00:05:27,840 --> 00:05:29,280
on the server

139
00:05:29,280 --> 00:05:30,080
and

140
00:05:30,080 --> 00:05:32,080
these web shells which are of the china

141
00:05:32,080 --> 00:05:33,680
chopper family

142
00:05:33,680 --> 00:05:36,240
were typically installed in the asp.net

143
00:05:36,240 --> 00:05:39,199
client folder under a vast variety of

144
00:05:39,199 --> 00:05:41,840
names as you can see there

145
00:05:41,840 --> 00:05:42,960
so

146
00:05:42,960 --> 00:05:44,880
since the file names are attacker

147
00:05:44,880 --> 00:05:48,000
control we can use these file names to

148
00:05:48,000 --> 00:05:53,400
cluster and then attribute these attacks

149
00:05:53,759 --> 00:05:55,520
an interesting characteristics of the

150
00:05:55,520 --> 00:05:58,880
web cells that were deployed that are

151
00:05:58,880 --> 00:06:01,120
once again from the china chopra family

152
00:06:01,120 --> 00:06:03,520
is that they were stored in

153
00:06:03,520 --> 00:06:06,400
an exchange offline address book in the

154
00:06:06,400 --> 00:06:10,639
external url field as you can see there

155
00:06:10,639 --> 00:06:13,520
and in that particular example example

156
00:06:13,520 --> 00:06:15,520
the attackers can execute arbitrary

157
00:06:15,520 --> 00:06:21,479
commands using the htpost field load

158
00:06:22,400 --> 00:06:25,360
but dropping that web shell is

159
00:06:25,360 --> 00:06:28,000
just the first step for the attackers

160
00:06:28,000 --> 00:06:29,759
the attackers can then

161
00:06:29,759 --> 00:06:32,560
come back a few minutes or sometimes

162
00:06:32,560 --> 00:06:35,199
even a few days after the exploitation

163
00:06:35,199 --> 00:06:37,360
in order to execute commands on the

164
00:06:37,360 --> 00:06:38,400
server

165
00:06:38,400 --> 00:06:40,800
so to do so the attacker

166
00:06:40,800 --> 00:06:42,000
browses

167
00:06:42,000 --> 00:06:44,000
to the url where the web shell is

168
00:06:44,000 --> 00:06:48,240
located and they send a post

169
00:06:48,240 --> 00:06:50,240
they they send their command embedded

170
00:06:50,240 --> 00:06:52,319
into a post parameter to that particular

171
00:06:52,319 --> 00:06:53,280
url

172
00:06:53,280 --> 00:06:56,080
this command is then interpreted by the

173
00:06:56,080 --> 00:06:58,479
web server that is running on the

174
00:06:58,479 --> 00:07:00,639
exchange server

175
00:07:00,639 --> 00:07:01,440
and

176
00:07:01,440 --> 00:07:03,599
these commands can then be used by the

177
00:07:03,599 --> 00:07:06,319
attacker to drop some additional

178
00:07:06,319 --> 00:07:08,960
executables for example to install a

179
00:07:08,960 --> 00:07:11,360
complex backdoor on the server

180
00:07:11,360 --> 00:07:13,440
but the attacker can

181
00:07:13,440 --> 00:07:15,440
also choose to

182
00:07:15,440 --> 00:07:18,960
not deploy any malware on the server and

183
00:07:18,960 --> 00:07:22,080
just directly dump full mailboxes from

184
00:07:22,080 --> 00:07:24,479
the server without the need of

185
00:07:24,479 --> 00:07:28,318
any additional malware component

186
00:07:29,759 --> 00:07:31,520
now that we've seen how this

187
00:07:31,520 --> 00:07:33,360
vulnerability work

188
00:07:33,360 --> 00:07:35,599
let's move on to the in the wide reality

189
00:07:35,599 --> 00:07:38,160
by looking into more details at the

190
00:07:38,160 --> 00:07:40,160
three tectors we've observed exploiting

191
00:07:40,160 --> 00:07:42,639
the vulnerability

192
00:07:42,639 --> 00:07:45,360
so during the first week of exploitation

193
00:07:45,360 --> 00:07:48,080
we uncovered an entire bestiary of

194
00:07:48,080 --> 00:07:50,319
tratactors with at least 10 different

195
00:07:50,319 --> 00:07:52,240
apt groups that were exploiting the

196
00:07:52,240 --> 00:07:54,960
proxion vulnerability

197
00:07:54,960 --> 00:07:56,080
on

198
00:07:56,080 --> 00:07:58,879
several occurrences we even saw multiple

199
00:07:58,879 --> 00:08:01,360
transactors deploying their malware on

200
00:08:01,360 --> 00:08:04,639
the very same exchange server and

201
00:08:04,639 --> 00:08:06,800
since the vulnerability is a

202
00:08:06,800 --> 00:08:08,800
pre-authentication vulnerability once

203
00:08:08,800 --> 00:08:11,360
again any trade actor could in the

204
00:08:11,360 --> 00:08:13,680
internet to find vulnerable election

205
00:08:13,680 --> 00:08:15,599
server which means that multiple trade

206
00:08:15,599 --> 00:08:17,280
actors may attempt to compromise the

207
00:08:17,280 --> 00:08:19,280
same server at the same time

208
00:08:19,280 --> 00:08:21,280
or they can also scan the internet to

209
00:08:21,280 --> 00:08:22,479
find

210
00:08:22,479 --> 00:08:24,639
web shells deployed on exchange server

211
00:08:24,639 --> 00:08:26,560
and take a

212
00:08:26,560 --> 00:08:28,560
take advantage of these already

213
00:08:28,560 --> 00:08:31,360
exploited servers

214
00:08:31,520 --> 00:08:34,000
the first known tratactor that exploited

215
00:08:34,000 --> 00:08:36,399
the vulnerability was attributed by

216
00:08:36,399 --> 00:08:39,440
microsoft to a group they called

217
00:08:39,440 --> 00:08:42,640
athenium and we believe that

218
00:08:42,640 --> 00:08:46,240
none of the 10 apts we've observed and

219
00:08:46,240 --> 00:08:50,080
that i will present afterward

220
00:08:50,080 --> 00:08:52,399
we've observed in march are actually

221
00:08:52,399 --> 00:08:54,560
athenian so most of the time when you

222
00:08:54,560 --> 00:08:57,600
hear about proxy logon you hear about

223
00:08:57,600 --> 00:09:00,080
the apneam apt group but there are

224
00:09:00,080 --> 00:09:03,120
actually a whole heap of apt groups that

225
00:09:03,120 --> 00:09:05,839
exploited it

226
00:09:05,920 --> 00:09:08,000
and if you want more detail about

227
00:09:08,000 --> 00:09:10,959
ethnium you can refer to the mst blog

228
00:09:10,959 --> 00:09:12,000
post

229
00:09:12,000 --> 00:09:14,640
for more details

230
00:09:14,640 --> 00:09:17,839
so let's start with the first group that

231
00:09:17,839 --> 00:09:19,680
we've seen exploiting the the

232
00:09:19,680 --> 00:09:21,920
vulnerability which is tick

233
00:09:21,920 --> 00:09:23,279
tick

234
00:09:23,279 --> 00:09:25,680
started exploiting the vulnerability in

235
00:09:25,680 --> 00:09:28,720
february 28th and they compromised the

236
00:09:28,720 --> 00:09:30,959
mail servers the mail server of a

237
00:09:30,959 --> 00:09:34,080
company based in east asia that provide

238
00:09:34,080 --> 00:09:36,640
provide i.t services

239
00:09:36,640 --> 00:09:38,880
since the patch was released on march

240
00:09:38,880 --> 00:09:39,839
2nd

241
00:09:39,839 --> 00:09:41,920
once again it means that

242
00:09:41,920 --> 00:09:44,320
tick had prior knowledge of the

243
00:09:44,320 --> 00:09:47,040
vulnerability

244
00:09:47,519 --> 00:09:48,959
tick is a

245
00:09:48,959 --> 00:09:52,160
pretty old cyber espionage group that is

246
00:09:52,160 --> 00:09:55,600
active since at least 2008 and their

247
00:09:55,600 --> 00:09:57,120
main objectives

248
00:09:57,120 --> 00:10:00,800
are iep and classified information theft

249
00:10:00,800 --> 00:10:01,920
and

250
00:10:01,920 --> 00:10:03,760
in the past we've seen them

251
00:10:03,760 --> 00:10:06,160
targeting the industrial sector

252
00:10:06,160 --> 00:10:08,880
the defense and and military sector as

253
00:10:08,880 --> 00:10:11,360
well as government organization

254
00:10:11,360 --> 00:10:13,680
and the victims are mostly but not

255
00:10:13,680 --> 00:10:15,920
exclusively based

256
00:10:15,920 --> 00:10:16,839
in

257
00:10:16,839 --> 00:10:21,279
russia japan and south korea

258
00:10:22,240 --> 00:10:26,079
so tick tool set include the royal road

259
00:10:26,079 --> 00:10:29,360
rtf weaponizer but they have some custom

260
00:10:29,360 --> 00:10:31,839
backdoors as such as desert

261
00:10:31,839 --> 00:10:35,279
they also use xxmm

262
00:10:35,279 --> 00:10:37,279
they make use also the lily trap which

263
00:10:37,279 --> 00:10:39,920
is an open source rat and there are no

264
00:10:39,920 --> 00:10:41,920
parts of the group that have access to

265
00:10:41,920 --> 00:10:44,560
the shadow pad backdoor

266
00:10:44,560 --> 00:10:46,560
on the compromised

267
00:10:46,560 --> 00:10:47,760
mail server

268
00:10:47,760 --> 00:10:50,000
they deployed their webshell under the

269
00:10:50,000 --> 00:10:53,040
file name asp.net.aspx

270
00:10:53,040 --> 00:10:54,160
and

271
00:10:54,160 --> 00:10:56,880
we managed to attribute that compromise

272
00:10:56,880 --> 00:10:59,680
to tick because they tried to deploy

273
00:10:59,680 --> 00:11:02,640
a delphi backdoor that they

274
00:11:02,640 --> 00:11:04,880
they are they've already used in the

275
00:11:04,880 --> 00:11:07,200
past

276
00:11:08,320 --> 00:11:09,839
one day after tick

277
00:11:09,839 --> 00:11:11,760
on march 1st

278
00:11:11,760 --> 00:11:14,320
lucky mouse joined the party and they

279
00:11:14,320 --> 00:11:16,320
started to exploit the vulnerability by

280
00:11:16,320 --> 00:11:18,959
compromising the email server of

281
00:11:18,959 --> 00:11:23,119
a governmental entity in the middle east

282
00:11:23,600 --> 00:11:27,360
the keymouse is also known as apt-27

283
00:11:27,360 --> 00:11:30,000
are emissary panda this is an apt group

284
00:11:30,000 --> 00:11:32,320
that i have quite some good technical

285
00:11:32,320 --> 00:11:33,680
capabilities

286
00:11:33,680 --> 00:11:36,000
and they are known for

287
00:11:36,000 --> 00:11:37,200
targeting

288
00:11:37,200 --> 00:11:39,279
government organizations in the middle

289
00:11:39,279 --> 00:11:42,320
east central asia east asia and they

290
00:11:42,320 --> 00:11:43,920
also have

291
00:11:43,920 --> 00:11:45,279
compromised

292
00:11:45,279 --> 00:11:47,760
the civil aviation organization in

293
00:11:47,760 --> 00:11:50,240
canada

294
00:11:52,160 --> 00:11:54,160
so lucky mouse

295
00:11:54,160 --> 00:11:56,800
has a set of custom implants they use

296
00:11:56,800 --> 00:11:59,519
their hyperbole back door sysup date

297
00:11:59,519 --> 00:12:01,200
backdoor they also

298
00:12:01,200 --> 00:12:04,480
make use of plugix and they also have

299
00:12:04,480 --> 00:12:07,360
their own rootkit which is called nds

300
00:12:07,360 --> 00:12:08,480
proxy

301
00:12:08,480 --> 00:12:11,440
and they also like to use the rigid web

302
00:12:11,440 --> 00:12:13,680
shell

303
00:12:15,200 --> 00:12:17,760
the main action we observed on the

304
00:12:17,760 --> 00:12:19,920
compromised mail server was that they

305
00:12:19,920 --> 00:12:22,959
tried to deploy npt scan in the program

306
00:12:22,959 --> 00:12:24,800
data folder and

307
00:12:24,800 --> 00:12:28,320
they use the redirect web shell

308
00:12:28,320 --> 00:12:31,120
additionally they try to deploy their

309
00:12:31,120 --> 00:12:33,839
sysupdate backdoor which is a modular

310
00:12:33,839 --> 00:12:35,519
implant

311
00:12:35,519 --> 00:12:37,680
the implant is loaded using dll search

312
00:12:37,680 --> 00:12:40,079
order hijacking and you will never see

313
00:12:40,079 --> 00:12:43,040
the the payload uh on disk it's only

314
00:12:43,040 --> 00:12:45,279
encrypted on disk and the plain text

315
00:12:45,279 --> 00:12:47,040
payload is only

316
00:12:47,040 --> 00:12:49,519
in memory

317
00:12:49,760 --> 00:12:52,320
on the same day lucky mouse was quickly

318
00:12:52,320 --> 00:12:54,560
followed by calypso who compromised the

319
00:12:54,560 --> 00:12:57,440
email servers of governmental entities

320
00:12:57,440 --> 00:13:00,079
in the middle east and south america

321
00:13:00,079 --> 00:13:02,160
in the following days calypso operators

322
00:13:02,160 --> 00:13:05,120
also targeted servers of governmental

323
00:13:05,120 --> 00:13:08,480
entities and private companies in africa

324
00:13:08,480 --> 00:13:11,519
asia and europe

325
00:13:12,160 --> 00:13:14,399
calypso was first documented by positive

326
00:13:14,399 --> 00:13:18,000
technologies in 2019 it's a cyber

327
00:13:18,000 --> 00:13:19,760
exchange group that is believed to be

328
00:13:19,760 --> 00:13:23,680
active since 2017 and they are mostly

329
00:13:23,680 --> 00:13:27,680
targeting government organization

330
00:13:27,680 --> 00:13:29,920
their tool set includes

331
00:13:29,920 --> 00:13:31,920
the calipso rat which

332
00:13:31,920 --> 00:13:34,480
gave them their name they also use

333
00:13:34,480 --> 00:13:38,720
plugix and the whiteboard backdoor

334
00:13:38,720 --> 00:13:42,959
on the compromised email server they

335
00:13:42,959 --> 00:13:45,199
they tried to load some dll using the

336
00:13:45,199 --> 00:13:47,519
led search order hijacking with the

337
00:13:47,519 --> 00:13:50,240
following dlc loading holes that you can

338
00:13:50,240 --> 00:13:51,440
see there

339
00:13:51,440 --> 00:13:54,639
and the implants they used are plugix

340
00:13:54,639 --> 00:13:57,360
and white bird

341
00:13:57,839 --> 00:13:59,920
still the 1st of march another group

342
00:13:59,920 --> 00:14:02,399
which we call webseek also started

343
00:14:02,399 --> 00:14:04,079
exploiting the vulnerability they

344
00:14:04,079 --> 00:14:06,480
targeted several email servers belonging

345
00:14:06,480 --> 00:14:08,320
to private companies in i.t

346
00:14:08,320 --> 00:14:09,920
telecommunications

347
00:14:09,920 --> 00:14:13,440
and engineering mostly in asia but also

348
00:14:13,440 --> 00:14:17,839
a governmental body in eastern europe

349
00:14:18,480 --> 00:14:21,519
we didn't manage to tie webseek to any

350
00:14:21,519 --> 00:14:24,079
known tradactor but it's a cyber

351
00:14:24,079 --> 00:14:26,639
espionage group that is active since at

352
00:14:26,639 --> 00:14:29,120
least 2021 and once again it's a group

353
00:14:29,120 --> 00:14:30,480
that mostly targets

354
00:14:30,480 --> 00:14:33,360
government organization

355
00:14:33,360 --> 00:14:36,000
and their tool set includes the website

356
00:14:36,000 --> 00:14:38,320
backdoor

357
00:14:38,320 --> 00:14:41,120
so on the compromised mail server we've

358
00:14:41,120 --> 00:14:42,079
seen them

359
00:14:42,079 --> 00:14:43,360
deploying

360
00:14:43,360 --> 00:14:45,079
the web cells under

361
00:14:45,079 --> 00:14:49,680
google.aspx and google.log file names

362
00:14:49,680 --> 00:14:52,399
the first stage is they use is a loader

363
00:14:52,399 --> 00:14:54,959
that's loaded an encrypted configuration

364
00:14:54,959 --> 00:14:57,279
with filename access.log

365
00:14:57,279 --> 00:15:00,560
and their second stage is once again a

366
00:15:00,560 --> 00:15:02,000
loader that was

367
00:15:02,000 --> 00:15:04,880
deployed at the following location

368
00:15:04,880 --> 00:15:07,360
but we didn't manage to get the first

369
00:15:07,360 --> 00:15:09,680
stage so we don't actually know what

370
00:15:09,680 --> 00:15:12,399
they intended to deploy on on the

371
00:15:12,399 --> 00:15:15,120
victim's machine

372
00:15:15,120 --> 00:15:17,519
and last but not least among the group

373
00:15:17,519 --> 00:15:20,320
that exploited the vulnerability before

374
00:15:20,320 --> 00:15:22,560
the release of the patch by microsoft

375
00:15:22,560 --> 00:15:24,639
meaning the groups that had access to

376
00:15:24,639 --> 00:15:27,600
the vulnerability prior to that patch

377
00:15:27,600 --> 00:15:30,880
the winning tier group on march 2nd

378
00:15:30,880 --> 00:15:33,519
a few hours before the release of the

379
00:15:33,519 --> 00:15:35,600
patch they compromised the email server

380
00:15:35,600 --> 00:15:37,680
of annoying company and a construction

381
00:15:37,680 --> 00:15:39,920
equipment company both based in east

382
00:15:39,920 --> 00:15:42,240
asia

383
00:15:42,399 --> 00:15:44,720
the win ntl group is also a cyber

384
00:15:44,720 --> 00:15:47,360
espionage group that is active since at

385
00:15:47,360 --> 00:15:48,160
least

386
00:15:48,160 --> 00:15:50,399
2011 2012

387
00:15:50,399 --> 00:15:52,639
and their targeting is

388
00:15:52,639 --> 00:15:55,120
very broad so i won't even show a map

389
00:15:55,120 --> 00:15:57,759
because most countries will be colored

390
00:15:57,759 --> 00:16:00,160
and they are targeting a broad range of

391
00:16:00,160 --> 00:16:01,759
organization

392
00:16:01,759 --> 00:16:04,000
and one characteristic of the winning ti

393
00:16:04,000 --> 00:16:06,800
group is that they also very frequently

394
00:16:06,800 --> 00:16:07,680
use

395
00:16:07,680 --> 00:16:09,600
stolen certificate stolen code signing

396
00:16:09,600 --> 00:16:11,680
certificates from previous campaigns to

397
00:16:11,680 --> 00:16:14,560
sign their malware

398
00:16:14,800 --> 00:16:17,279
so the win nti use makes makes use of

399
00:16:17,279 --> 00:16:20,320
course of the win nti malware they also

400
00:16:20,320 --> 00:16:21,440
use

401
00:16:21,440 --> 00:16:23,120
zedik shell they

402
00:16:23,120 --> 00:16:26,160
have custom implants such as the portry

403
00:16:26,160 --> 00:16:29,279
use passive backdoor pipeman that we

404
00:16:29,279 --> 00:16:31,920
both documented on relief security

405
00:16:31,920 --> 00:16:34,720
they frequently use a credential dumper

406
00:16:34,720 --> 00:16:36,800
that is called ace ash

407
00:16:36,800 --> 00:16:39,360
and it's the the first group that had

408
00:16:39,360 --> 00:16:42,959
access to the shadow pad back door

409
00:16:43,600 --> 00:16:45,920
they deployed their webshell in the

410
00:16:45,920 --> 00:16:49,519
caches dot aspx and shell. as with fine

411
00:16:49,519 --> 00:16:52,000
name caches.spx and shell detail specs

412
00:16:52,000 --> 00:16:54,480
and the implant they used uh on the

413
00:16:54,480 --> 00:16:57,040
compromised mail server uh we saw the

414
00:16:57,040 --> 00:16:59,680
win and tie loader plugix rat

415
00:16:59,680 --> 00:17:02,560
the spider back door and mimikats and

416
00:17:02,560 --> 00:17:07,119
some other custom password dumping tools

417
00:17:08,640 --> 00:17:10,240
one day after the release of the patch

418
00:17:10,240 --> 00:17:12,880
by microsoft tonto team joined the party

419
00:17:12,880 --> 00:17:14,880
and they compromised the email servers

420
00:17:14,880 --> 00:17:17,520
of a procurement company

421
00:17:17,520 --> 00:17:19,919
and a consulting company specialized in

422
00:17:19,919 --> 00:17:22,160
software development and cyber security

423
00:17:22,160 --> 00:17:24,880
in eastern europe

424
00:17:24,880 --> 00:17:27,039
tomtom team mostly targets

425
00:17:27,039 --> 00:17:30,400
government institutions based mostly but

426
00:17:30,400 --> 00:17:33,840
not exclusively in russia mongolia and

427
00:17:33,840 --> 00:17:36,559
japan it's a cyber espionage group and

428
00:17:36,559 --> 00:17:38,960
like tik it's a pretty old

429
00:17:38,960 --> 00:17:41,840
apt group as they are active since at

430
00:17:41,840 --> 00:17:44,960
least 2009.

431
00:17:44,960 --> 00:17:47,520
they have their own set of custom

432
00:17:47,520 --> 00:17:49,520
backdoor their flagship backdoor is

433
00:17:49,520 --> 00:17:52,400
called bizonal and they have been using

434
00:17:52,400 --> 00:17:55,120
that backdoor for more than 10 10 years

435
00:17:55,120 --> 00:17:57,440
so there are a lot of evolution since

436
00:17:57,440 --> 00:17:59,440
the first variant

437
00:17:59,440 --> 00:18:01,760
was first observed

438
00:18:01,760 --> 00:18:04,960
they also used the railroad rtf

439
00:18:04,960 --> 00:18:06,480
weaponizer

440
00:18:06,480 --> 00:18:09,520
dexbia and they are now also part of the

441
00:18:09,520 --> 00:18:14,120
group that have access to shadowpad

442
00:18:14,799 --> 00:18:17,200
the main action we've observed is that

443
00:18:17,200 --> 00:18:19,200
they deployed their web shell with some

444
00:18:19,200 --> 00:18:20,960
pretty particular name

445
00:18:20,960 --> 00:18:24,840
decay by sss.aspx

446
00:18:25,280 --> 00:18:27,679
and they tried to deploy some powershell

447
00:18:27,679 --> 00:18:29,520
downloader used to

448
00:18:29,520 --> 00:18:31,200
download

449
00:18:31,200 --> 00:18:34,160
and load the bizonal rats and also

450
00:18:34,160 --> 00:18:36,720
shadowpad

451
00:18:40,640 --> 00:18:43,039
speaking of shadow pad

452
00:18:43,039 --> 00:18:45,679
on the very same day we observed some

453
00:18:45,679 --> 00:18:48,799
shadow pad related activity on email

454
00:18:48,799 --> 00:18:52,320
servers at a software company based

455
00:18:52,320 --> 00:18:54,720
in east asia and a real estate company

456
00:18:54,720 --> 00:18:56,720
based in the middle east

457
00:18:56,720 --> 00:18:59,200
shadopat was dropped by the attacker but

458
00:18:59,200 --> 00:19:00,880
we are not able to conclusively

459
00:19:00,880 --> 00:19:03,520
attribute that activity to

460
00:19:03,520 --> 00:19:06,320
any known group

461
00:19:06,320 --> 00:19:08,960
so shadowpad is now shared among

462
00:19:08,960 --> 00:19:11,760
multiple trade actors since

463
00:19:11,760 --> 00:19:13,520
2019

464
00:19:13,520 --> 00:19:15,679
for example tonto team have access to it

465
00:19:15,679 --> 00:19:18,799
with nti group tier 428 tick sparkling

466
00:19:18,799 --> 00:19:20,559
goblin red foxtrot credit card

467
00:19:20,559 --> 00:19:22,080
fishmonger

468
00:19:22,080 --> 00:19:24,400
you name it it's not even an existing

469
00:19:24,400 --> 00:19:25,360
list

470
00:19:25,360 --> 00:19:26,720
and

471
00:19:26,720 --> 00:19:29,600
to attribute shadowpad to a particular

472
00:19:29,600 --> 00:19:31,039
apt group

473
00:19:31,039 --> 00:19:32,799
you can use

474
00:19:32,799 --> 00:19:34,400
because it's a modular backdoor so you

475
00:19:34,400 --> 00:19:36,240
can use the number of modules because

476
00:19:36,240 --> 00:19:37,919
different groups don't have access to

477
00:19:37,919 --> 00:19:40,480
the same number of modules the the

478
00:19:40,480 --> 00:19:43,600
encryption algorithm that is used

479
00:19:43,600 --> 00:19:45,520
the content of the encrypted

480
00:19:45,520 --> 00:19:48,160
configuration but also the the cnc

481
00:19:48,160 --> 00:19:50,080
server so there are many different way

482
00:19:50,080 --> 00:19:50,840
to

483
00:19:50,840 --> 00:19:53,039
attribute a

484
00:19:53,039 --> 00:19:54,480
shadow pad

485
00:19:54,480 --> 00:19:57,200
implant to to to a particular group but

486
00:19:57,200 --> 00:19:59,760
in that case weren't able to

487
00:19:59,760 --> 00:20:04,159
conclusively attribute these compromises

488
00:20:04,159 --> 00:20:06,880
still on march 3rd we noticed

489
00:20:06,880 --> 00:20:09,120
a cluster of cobalt strike related

490
00:20:09,120 --> 00:20:11,679
malicious activities worldwide that

491
00:20:11,679 --> 00:20:15,600
without the opera cobalt strike

492
00:20:16,000 --> 00:20:18,320
the targeting was quite broad we saw

493
00:20:18,320 --> 00:20:20,039
more than

494
00:20:20,039 --> 00:20:23,679
750 targets all around the world

495
00:20:23,679 --> 00:20:26,400
we believe that that cluster of activity

496
00:20:26,400 --> 00:20:29,120
is likely a cyber espionage group but we

497
00:20:29,120 --> 00:20:30,480
don't know for sure

498
00:20:30,480 --> 00:20:31,840
and

499
00:20:31,840 --> 00:20:35,120
they are active since uh 2021 because

500
00:20:35,120 --> 00:20:39,200
that's the first time we we saw them and

501
00:20:39,200 --> 00:20:40,799
the targeting was

502
00:20:40,799 --> 00:20:44,400
quite broad uh and but not

503
00:20:44,400 --> 00:20:46,880
a lot of machines received the the next

504
00:20:46,880 --> 00:20:49,440
stage like they targeted like 50

505
00:20:49,440 --> 00:20:52,559
machines around the 750 machines to

506
00:20:52,559 --> 00:20:55,679
deploy their next stage

507
00:20:55,679 --> 00:20:58,880
so as their name suggests uh the the

508
00:20:58,880 --> 00:21:02,799
implant they use is cobalt strike

509
00:21:02,799 --> 00:21:05,280
and they deployed their web cells

510
00:21:05,280 --> 00:21:08,080
in a different folder than

511
00:21:08,080 --> 00:21:09,600
the asp.net

512
00:21:09,600 --> 00:21:10,799
client

513
00:21:10,799 --> 00:21:12,799
that you've seen previously they use the

514
00:21:12,799 --> 00:21:16,080
http proxy or wa oauth folder with the

515
00:21:16,080 --> 00:21:18,320
file name that you can see on the slides

516
00:21:18,320 --> 00:21:21,520
and to deploy cobalt strike they used a

517
00:21:21,520 --> 00:21:24,559
kuber powershell script and

518
00:21:24,559 --> 00:21:26,880
to load the payload they use dll social

519
00:21:26,880 --> 00:21:29,679
hijacking on the opera browser

520
00:21:29,679 --> 00:21:32,000
executable and that's why we call that

521
00:21:32,000 --> 00:21:34,640
cluster of activity the the opera cabal

522
00:21:34,640 --> 00:21:37,039
track

523
00:21:37,200 --> 00:21:40,159
the day after on march 4th we observed

524
00:21:40,159 --> 00:21:42,080
the microsynapt group starting to

525
00:21:42,080 --> 00:21:43,440
exploit the vulnerability and

526
00:21:43,440 --> 00:21:45,919
compromising the exchange server of a

527
00:21:45,919 --> 00:21:48,799
utility company in central asia

528
00:21:48,799 --> 00:21:51,520
and microsyn is once again a cyber

529
00:21:51,520 --> 00:21:53,919
espionage group that is active since

530
00:21:53,919 --> 00:21:55,360
2017

531
00:21:55,360 --> 00:21:57,440
they are also known as six little

532
00:21:57,440 --> 00:21:58,960
monkeys and

533
00:21:58,960 --> 00:22:02,080
they mainly target governmental

534
00:22:02,080 --> 00:22:04,400
institutions and telecommunication

535
00:22:04,400 --> 00:22:07,280
operators in central asia russia and

536
00:22:07,280 --> 00:22:09,760
mongolia

537
00:22:09,760 --> 00:22:13,039
their arsenal includes the microscene

538
00:22:13,039 --> 00:22:14,880
backdoor but also

539
00:22:14,880 --> 00:22:17,120
the ghost rat

540
00:22:17,120 --> 00:22:19,919
on the compromised mail server they used

541
00:22:19,919 --> 00:22:22,000
different file names as you can see

542
00:22:22,000 --> 00:22:25,039
there they try to deploy the micro scene

543
00:22:25,039 --> 00:22:29,280
rat and also a custom proxy named calcx

544
00:22:29,280 --> 00:22:31,440
dot exe with the following command line

545
00:22:31,440 --> 00:22:32,880
that you can see there

546
00:22:32,880 --> 00:22:35,919
and mimikatz

547
00:22:35,919 --> 00:22:38,159
and finally on march

548
00:22:38,159 --> 00:22:40,960
4th and 5th we detected the deployment

549
00:22:40,960 --> 00:22:43,120
of some powershell downloaders related

550
00:22:43,120 --> 00:22:43,919
to

551
00:22:43,919 --> 00:22:47,679
a group we called glt miner on multiple

552
00:22:47,679 --> 00:22:50,320
email servers around the world

553
00:22:50,320 --> 00:22:52,080
so here it's

554
00:22:52,080 --> 00:22:54,640
the first financially motivated group

555
00:22:54,640 --> 00:22:58,320
that we've seen exploiting proxilogon

556
00:22:58,320 --> 00:22:59,840
they are

557
00:22:59,840 --> 00:23:02,080
known as sapphire python

558
00:23:02,080 --> 00:23:04,880
and they are active since at least 2019

559
00:23:04,880 --> 00:23:06,799
and they don't have any particular

560
00:23:06,799 --> 00:23:09,200
targeting

561
00:23:09,200 --> 00:23:11,600
an interesting point is that the ltminer

562
00:23:11,600 --> 00:23:15,840
was active on march 4th and 5th only

563
00:23:15,840 --> 00:23:18,080
then we didn't see any activity from

564
00:23:18,080 --> 00:23:19,360
that group on

565
00:23:19,360 --> 00:23:22,400
action server after that that date

566
00:23:22,400 --> 00:23:24,799
they tried to deploy some powershell

567
00:23:24,799 --> 00:23:27,360
downloader but also mimikats

568
00:23:27,360 --> 00:23:28,720
and

569
00:23:28,720 --> 00:23:29,679
we are

570
00:23:29,679 --> 00:23:30,960
not sure

571
00:23:30,960 --> 00:23:34,559
if they had access to the exploit or if

572
00:23:34,559 --> 00:23:38,240
they actually hijack existing previously

573
00:23:38,240 --> 00:23:40,480
deployed web shells

574
00:23:40,480 --> 00:23:42,640
we are not sure because the web shell's

575
00:23:42,640 --> 00:23:45,360
file names were different between each

576
00:23:45,360 --> 00:23:46,480
victims

577
00:23:46,480 --> 00:23:48,960
so usually we use the file names to do

578
00:23:48,960 --> 00:23:50,720
our first clustering but in that case

579
00:23:50,720 --> 00:23:53,039
the file names were different in every

580
00:23:53,039 --> 00:23:54,960
cases and they were not following

581
00:23:54,960 --> 00:23:57,120
following any particular pattern so

582
00:23:57,120 --> 00:23:58,880
that's why we believe that it's quite

583
00:23:58,880 --> 00:24:01,919
likely that this group just hijacked

584
00:24:01,919 --> 00:24:05,840
previously deployed websites

585
00:24:06,640 --> 00:24:09,919
if you want to know more about

586
00:24:09,919 --> 00:24:12,080
these apt groups that exploited

587
00:24:12,080 --> 00:24:14,080
microsoft exchange you can have a look

588
00:24:14,080 --> 00:24:15,039
at

589
00:24:15,039 --> 00:24:17,039
the blog post we published last year

590
00:24:17,039 --> 00:24:18,720
about

591
00:24:18,720 --> 00:24:21,200
about it

592
00:24:21,360 --> 00:24:25,039
but is it just the tip of the iceberg

593
00:24:25,039 --> 00:24:27,520
a presentation from orange side we

594
00:24:27,520 --> 00:24:29,760
discovered proxilogon

595
00:24:29,760 --> 00:24:33,919
was scheduled on august 5th last year

596
00:24:33,919 --> 00:24:34,640
and

597
00:24:34,640 --> 00:24:36,320
that and it was

598
00:24:36,320 --> 00:24:38,480
meant to present a new critical exchange

599
00:24:38,480 --> 00:24:40,400
vulnerability

600
00:24:40,400 --> 00:24:43,679
so at that time we believe that while

601
00:24:43,679 --> 00:24:45,440
it was actually just the tip of the

602
00:24:45,440 --> 00:24:47,520
iceberg because

603
00:24:47,520 --> 00:24:50,480
one day before aransas presentation some

604
00:24:50,480 --> 00:24:53,279
researchers started to notice some

605
00:24:53,279 --> 00:24:55,440
exchange servers exploitation attempts

606
00:24:55,440 --> 00:24:58,640
using what seemed like a new technique

607
00:24:58,640 --> 00:25:00,880
and it appears that this new

608
00:25:00,880 --> 00:25:02,640
vulnerability was

609
00:25:02,640 --> 00:25:04,240
actually the same vulnerability that

610
00:25:04,240 --> 00:25:06,559
will be presented the day after by

611
00:25:06,559 --> 00:25:09,120
orientai at blackcat usa

612
00:25:09,120 --> 00:25:11,520
and this vulnerability was named proxy

613
00:25:11,520 --> 00:25:12,880
shell

614
00:25:12,880 --> 00:25:15,919
so let's have a look at proxy shell and

615
00:25:15,919 --> 00:25:18,320
its variations

616
00:25:18,320 --> 00:25:20,159
so proxy shell as in the case of

617
00:25:20,159 --> 00:25:22,799
proxylogon is actually a vulnerability

618
00:25:22,799 --> 00:25:25,120
chain which consists in three different

619
00:25:25,120 --> 00:25:26,960
vulnerabilities

620
00:25:26,960 --> 00:25:29,200
when chained together these three

621
00:25:29,200 --> 00:25:31,279
vulnerabilities led to

622
00:25:31,279 --> 00:25:33,760
pre-authentication remote code execution

623
00:25:33,760 --> 00:25:36,480
was once again as in the case of proxy

624
00:25:36,480 --> 00:25:37,679
logon

625
00:25:37,679 --> 00:25:39,120
and

626
00:25:39,120 --> 00:25:40,080
again

627
00:25:40,080 --> 00:25:42,720
the vulnerability server where exchange

628
00:25:42,720 --> 00:25:47,120
2013 16 and 19.

629
00:25:47,120 --> 00:25:50,320
here uh the exploitation is a little bit

630
00:25:50,320 --> 00:25:52,720
different but it still looks quite

631
00:25:52,720 --> 00:25:54,960
familiar to what i showed you regarding

632
00:25:54,960 --> 00:25:57,600
proxy logon first

633
00:25:57,600 --> 00:25:59,919
the attacker needs to exploit a

634
00:25:59,919 --> 00:26:01,679
server-side

635
00:26:01,679 --> 00:26:04,320
request for re-bypass to be able to

636
00:26:04,320 --> 00:26:06,799
interface with the powershell back-end

637
00:26:06,799 --> 00:26:08,880
and then a privileged escalation to be

638
00:26:08,880 --> 00:26:11,679
able to execute arbitrary commands

639
00:26:11,679 --> 00:26:14,000
then the attacker can exploit the last

640
00:26:14,000 --> 00:26:16,039
vulnerability which is a

641
00:26:16,039 --> 00:26:19,360
post-authentication arbitrary file right

642
00:26:19,360 --> 00:26:20,480
which

643
00:26:20,480 --> 00:26:22,159
will

644
00:26:22,159 --> 00:26:24,559
allow to use the mailbox new mailbox

645
00:26:24,559 --> 00:26:26,240
export request to

646
00:26:26,240 --> 00:26:29,120
export our mailbox where the attacker

647
00:26:29,120 --> 00:26:31,360
previously created an email that

648
00:26:31,360 --> 00:26:34,400
contained an encoded webshield

649
00:26:34,400 --> 00:26:36,080
that mailbox

650
00:26:36,080 --> 00:26:39,760
will be then exported as a pst file with

651
00:26:39,760 --> 00:26:41,400
a webfile

652
00:26:41,400 --> 00:26:44,640
extension.aspx and this will lead to the

653
00:26:44,640 --> 00:26:46,720
decoding of that malicious web shell

654
00:26:46,720 --> 00:26:49,520
that will be written on disk with

655
00:26:49,520 --> 00:26:51,840
different file name and once again these

656
00:26:51,840 --> 00:26:54,000
file names are attacker control so it

657
00:26:54,000 --> 00:26:57,039
allows it will help us to

658
00:26:57,039 --> 00:27:01,279
clusterize and attribute the campaigns

659
00:27:01,279 --> 00:27:03,600
but there are also some alternative

660
00:27:03,600 --> 00:27:05,760
explosive exploitation paths where

661
00:27:05,760 --> 00:27:09,120
instead of making use of a malicious pst

662
00:27:09,120 --> 00:27:12,640
file the attacker can also use a

663
00:27:12,640 --> 00:27:14,960
certificate request to achieve the same

664
00:27:14,960 --> 00:27:16,960
goal by using the new exchange

665
00:27:16,960 --> 00:27:18,799
certificate commandlet

666
00:27:18,799 --> 00:27:20,960
in that case the webshell will have the

667
00:27:20,960 --> 00:27:24,640
the aspx dot rec extension but at the

668
00:27:24,640 --> 00:27:27,039
end you end up with a web shell on on

669
00:27:27,039 --> 00:27:30,240
the exchange server the same way

670
00:27:30,240 --> 00:27:32,480
an attacker can also choose to just

671
00:27:32,480 --> 00:27:34,480
exploit the two first vulnerability to

672
00:27:34,480 --> 00:27:36,159
be able to create

673
00:27:36,159 --> 00:27:38,240
new mailboxes with full access

674
00:27:38,240 --> 00:27:40,480
permissions using the following

675
00:27:40,480 --> 00:27:42,480
commandlet so a new mailbox new world

676
00:27:42,480 --> 00:27:45,679
group number and i'll add the mailbox

677
00:27:45,679 --> 00:27:48,000
permissions

678
00:27:48,000 --> 00:27:49,919
now that we've seen the different

679
00:27:49,919 --> 00:27:51,760
exploitation path let's have a look at

680
00:27:51,760 --> 00:27:53,520
the timeline

681
00:27:53,520 --> 00:27:56,399
in march 2021 orange site discovered the

682
00:27:56,399 --> 00:27:59,039
proxy shell vulnerability chain and in

683
00:27:59,039 --> 00:28:00,640
march and

684
00:28:00,640 --> 00:28:02,240
may

685
00:28:02,240 --> 00:28:04,799
microsoft published

686
00:28:04,799 --> 00:28:07,360
published a security update addressing

687
00:28:07,360 --> 00:28:10,000
these new abilities

688
00:28:10,000 --> 00:28:14,159
then on the second of august

689
00:28:14,159 --> 00:28:16,640
some unsuccessful social exploitation

690
00:28:16,640 --> 00:28:19,440
attempts were observed

691
00:28:19,440 --> 00:28:22,640
and the day after rnsi presentation took

692
00:28:22,640 --> 00:28:24,799
place at black hats

693
00:28:24,799 --> 00:28:27,919
then on the 12th of august we started

694
00:28:27,919 --> 00:28:29,200
seeing the first proxy shell

695
00:28:29,200 --> 00:28:30,640
exploitation

696
00:28:30,640 --> 00:28:33,279
and finally a few days after that the

697
00:28:33,279 --> 00:28:35,120
caesar released

698
00:28:35,120 --> 00:28:36,799
their alert

699
00:28:36,799 --> 00:28:38,720
so let's have a look at the exploitation

700
00:28:38,720 --> 00:28:40,559
statistics

701
00:28:40,559 --> 00:28:45,039
this graph represents asset detection

702
00:28:45,039 --> 00:28:46,159
once again

703
00:28:46,159 --> 00:28:47,760
for the websites they were dropped by

704
00:28:47,760 --> 00:28:49,520
the attacker during the exploitation of

705
00:28:49,520 --> 00:28:51,279
the vulnerable exchange server but for

706
00:28:51,279 --> 00:28:54,159
proxy shell this time so what can when

707
00:28:54,159 --> 00:28:55,679
we can see that

708
00:28:55,679 --> 00:28:57,520
we started seeing the first exploitation

709
00:28:57,520 --> 00:29:00,240
attempt on august 12th

710
00:29:00,240 --> 00:29:01,360
and that

711
00:29:01,360 --> 00:29:03,279
one week later the the proxial

712
00:29:03,279 --> 00:29:05,360
vulnerability started to be massively

713
00:29:05,360 --> 00:29:08,159
exploited by both cyber crime and cyber

714
00:29:08,159 --> 00:29:10,880
experience group and let's have a look

715
00:29:10,880 --> 00:29:12,960
at the few groups that we've seen

716
00:29:12,960 --> 00:29:15,279
exploiting the vulnerability during the

717
00:29:15,279 --> 00:29:18,159
first month of exploitation

718
00:29:18,159 --> 00:29:20,240
here we'll focus only on the first month

719
00:29:20,240 --> 00:29:24,159
as i said and on august 12th we observed

720
00:29:24,159 --> 00:29:27,120
the proxy shell vulnerability being

721
00:29:27,120 --> 00:29:29,679
exploited by a tradactor we are not able

722
00:29:29,679 --> 00:29:31,120
to conclusively

723
00:29:31,120 --> 00:29:33,520
attribute to any known groups and we

724
00:29:33,520 --> 00:29:35,120
named that cluster of activity

725
00:29:35,120 --> 00:29:36,640
application update

726
00:29:36,640 --> 00:29:38,720
that threat actor targeted several

727
00:29:38,720 --> 00:29:40,480
exchange servers

728
00:29:40,480 --> 00:29:43,039
all based in the u.s and the targeted

729
00:29:43,039 --> 00:29:44,399
organizations

730
00:29:44,399 --> 00:29:45,279
were

731
00:29:45,279 --> 00:29:47,120
from the health sector construction and

732
00:29:47,120 --> 00:29:49,360
engineering and some government

733
00:29:49,360 --> 00:29:51,120
organizations

734
00:29:51,120 --> 00:29:53,520
so as i said we didn't currently tied

735
00:29:53,520 --> 00:29:55,600
application update to any known threat

736
00:29:55,600 --> 00:29:56,480
actor

737
00:29:56,480 --> 00:29:59,520
and on the compromised mail server they

738
00:29:59,520 --> 00:30:00,880
deployed

739
00:30:00,880 --> 00:30:04,080
two executables one called create i task

740
00:30:04,080 --> 00:30:06,559
which is used to create a scheduled task

741
00:30:06,559 --> 00:30:08,080
that is responsible for loading the

742
00:30:08,080 --> 00:30:10,480
second executable application update

743
00:30:10,480 --> 00:30:13,919
which is responsible for downloading

744
00:30:13,919 --> 00:30:16,000
the the next stage so it will contact

745
00:30:16,000 --> 00:30:18,159
the staging server that you can see on

746
00:30:18,159 --> 00:30:19,440
the slide

747
00:30:19,440 --> 00:30:22,320
but unfortunately weren't able to

748
00:30:22,320 --> 00:30:26,799
retrieve the next stage from that server

749
00:30:27,120 --> 00:30:30,480
you may remember ta-410 from alex and

750
00:30:30,480 --> 00:30:34,000
matt presentation from wednesday

751
00:30:34,000 --> 00:30:34,799
so

752
00:30:34,799 --> 00:30:36,880
well the day after application update on

753
00:30:36,880 --> 00:30:39,520
august 13th we they compromised our

754
00:30:39,520 --> 00:30:43,120
religious organization in central europe

755
00:30:43,120 --> 00:30:44,000
and

756
00:30:44,000 --> 00:30:45,520
apt

757
00:30:45,520 --> 00:30:46,720
for 10

758
00:30:46,720 --> 00:30:47,840
as

759
00:30:47,840 --> 00:30:49,679
you've seen during the previous

760
00:30:49,679 --> 00:30:52,640
presentation they are targeting the

761
00:30:52,640 --> 00:30:55,760
industrial and academic sector mostly

762
00:30:55,760 --> 00:30:57,679
it's a cyberspecialist group active

763
00:30:57,679 --> 00:31:00,080
since 2018

764
00:31:00,080 --> 00:31:02,240
and

765
00:31:02,240 --> 00:31:04,080
it's uh com

766
00:31:04,080 --> 00:31:08,720
it's three different subgroups actually

767
00:31:09,200 --> 00:31:11,760
uh they use different implants such as

768
00:31:11,760 --> 00:31:13,840
flow cloud loopback

769
00:31:13,840 --> 00:31:16,799
x4 but they also use the plug extract

770
00:31:16,799 --> 00:31:20,240
quasar rat and as many groups as you've

771
00:31:20,240 --> 00:31:22,080
seen previously they use the railroad

772
00:31:22,080 --> 00:31:26,080
document rtf weaponizer

773
00:31:26,640 --> 00:31:29,039
on the the compromised mail server they

774
00:31:29,039 --> 00:31:31,039
tried to deploy

775
00:31:31,039 --> 00:31:33,600
the plugix loader which uses

776
00:31:33,600 --> 00:31:37,200
lokt that ine as log file and that

777
00:31:37,200 --> 00:31:39,519
particular file name was

778
00:31:39,519 --> 00:31:41,960
used in the past by

779
00:31:41,960 --> 00:31:43,679
ta410

780
00:31:43,679 --> 00:31:46,159
they also try to deploy the loopback

781
00:31:46,159 --> 00:31:47,519
backdoor

782
00:31:47,519 --> 00:31:51,279
which is a modified lip called dll and

783
00:31:51,279 --> 00:31:53,760
they try to drop it at the following

784
00:31:53,760 --> 00:31:55,919
location

785
00:31:55,919 --> 00:31:57,760
if you want to know more about

786
00:31:57,760 --> 00:32:01,279
ta410 you can have a look at the blog

787
00:32:01,279 --> 00:32:03,360
post that was published

788
00:32:03,360 --> 00:32:05,840
on wednesday right after

789
00:32:05,840 --> 00:32:09,439
matt and alex presentation

790
00:32:10,480 --> 00:32:11,519
then

791
00:32:11,519 --> 00:32:12,480
on

792
00:32:12,480 --> 00:32:14,399
august 24th

793
00:32:14,399 --> 00:32:17,039
we observed ta for 28 exploiting the

794
00:32:17,039 --> 00:32:19,519
vulnerability and they targeted our

795
00:32:19,519 --> 00:32:22,960
european ministry of foreign affairs

796
00:32:22,960 --> 00:32:26,320
so tier 428 is once again a cyberspinach

797
00:32:26,320 --> 00:32:28,480
group they are they are active since at

798
00:32:28,480 --> 00:32:30,080
least 2014

799
00:32:30,080 --> 00:32:32,640
and they are targetly targeting mostly

800
00:32:32,640 --> 00:32:35,600
government organizations based

801
00:32:35,600 --> 00:32:38,480
in russia and mongolia and

802
00:32:38,480 --> 00:32:40,559
they are also responsible for a supply

803
00:32:40,559 --> 00:32:42,559
chain attack against a software

804
00:32:42,559 --> 00:32:46,399
development company in mongolia

805
00:32:47,440 --> 00:32:52,000
their tool set includes the railroad rtf

806
00:32:52,000 --> 00:32:53,919
weaponizer you're

807
00:32:53,919 --> 00:32:56,480
probably quite familiar with it now they

808
00:32:56,480 --> 00:32:59,760
have some custom backdoor such as the

809
00:32:59,760 --> 00:33:02,720
team manager backdoor and albanitas they

810
00:33:02,720 --> 00:33:05,039
also make use of plugix and they are

811
00:33:05,039 --> 00:33:06,880
part of the group that have access to

812
00:33:06,880 --> 00:33:09,279
shadowpad

813
00:33:09,279 --> 00:33:12,000
on the compromised

814
00:33:12,000 --> 00:33:15,840
mail server they deployed some net and

815
00:33:15,840 --> 00:33:18,799
vm protected loaders that are used to

816
00:33:18,799 --> 00:33:21,440
deploy some encrypted failed payload

817
00:33:21,440 --> 00:33:22,720
with various

818
00:33:22,720 --> 00:33:25,360
file names but since the first stage was

819
00:33:25,360 --> 00:33:28,000
blocked we weren't able to collect such

820
00:33:28,000 --> 00:33:30,960
encrypted payloads

821
00:33:31,600 --> 00:33:34,880
and a few days after tfr 28

822
00:33:34,880 --> 00:33:35,760
on

823
00:33:35,760 --> 00:33:38,960
august 21st we observe sparkling goblins

824
00:33:38,960 --> 00:33:40,720
starting to exploit the vulnerability

825
00:33:40,720 --> 00:33:43,279
against hong kong university

826
00:33:43,279 --> 00:33:45,679
which is quite a common target for that

827
00:33:45,679 --> 00:33:47,840
trait actor

828
00:33:47,840 --> 00:33:51,080
sparkling goblin mostly overlaps with

829
00:33:51,080 --> 00:33:55,200
apt-41 and barium and so it's a cyber

830
00:33:55,200 --> 00:33:57,519
espionage group that is active since at

831
00:33:57,519 --> 00:34:00,640
least 2018 and

832
00:34:00,640 --> 00:34:03,600
they are targeting a broad range of

833
00:34:03,600 --> 00:34:06,960
organizations mostly based in east and

834
00:34:06,960 --> 00:34:08,960
south east asia and their targets

835
00:34:08,960 --> 00:34:10,320
include

836
00:34:10,320 --> 00:34:12,719
religious organization the industrial

837
00:34:12,719 --> 00:34:14,719
sector the academic sector government

838
00:34:14,719 --> 00:34:17,359
organization media outlet e-commerce

839
00:34:17,359 --> 00:34:18,639
platform

840
00:34:18,639 --> 00:34:20,079
you name it there are a lot of

841
00:34:20,079 --> 00:34:22,000
organizations that are targeted by that

842
00:34:22,000 --> 00:34:24,000
group

843
00:34:24,000 --> 00:34:26,719
they make use of some installation based

844
00:34:26,719 --> 00:34:29,119
loader they have some custom backdoors

845
00:34:29,119 --> 00:34:31,119
such as the crosswalk backdoor and its

846
00:34:31,119 --> 00:34:34,000
little sister sidewalk

847
00:34:34,000 --> 00:34:36,879
they make use of cobalt strike and

848
00:34:36,879 --> 00:34:39,760
plugix quite interchangeably and they

849
00:34:39,760 --> 00:34:40,879
also use

850
00:34:40,879 --> 00:34:42,320
shadowpad

851
00:34:42,320 --> 00:34:45,918
and on the compromised mail server we

852
00:34:45,918 --> 00:34:48,800
saw them trying to deploy their

853
00:34:48,800 --> 00:34:50,800
usual install util

854
00:34:50,800 --> 00:34:53,760
based dot net loader

855
00:34:53,760 --> 00:34:57,040
and finally one month after orange size

856
00:34:57,040 --> 00:35:00,000
presentation at black at usa we observed

857
00:35:00,000 --> 00:35:01,680
red foxtrot targeting the exchange

858
00:35:01,680 --> 00:35:04,160
server of an i.t company

859
00:35:04,160 --> 00:35:06,800
in pakistan which is a

860
00:35:06,800 --> 00:35:08,720
country that is commonly targeted by red

861
00:35:08,720 --> 00:35:10,800
foxford

862
00:35:10,800 --> 00:35:11,920
and

863
00:35:11,920 --> 00:35:13,760
it's a cyber espionage group that is

864
00:35:13,760 --> 00:35:15,839
active since 2018

865
00:35:15,839 --> 00:35:18,960
they target the research sector aviation

866
00:35:18,960 --> 00:35:21,040
mining companies telecommunication

867
00:35:21,040 --> 00:35:24,480
operators governmental organizations

868
00:35:24,480 --> 00:35:27,280
all based in central asia

869
00:35:27,280 --> 00:35:30,000
and on the compromised mail server they

870
00:35:30,000 --> 00:35:33,359
tried to deploy a shadow pad and in that

871
00:35:33,359 --> 00:35:35,280
case we were able to attribute that

872
00:35:35,280 --> 00:35:37,040
particular shadow pad activity to red

873
00:35:37,040 --> 00:35:39,520
foxtrot because they reused

874
00:35:39,520 --> 00:35:41,680
a domain name that they

875
00:35:41,680 --> 00:35:45,799
used in previous campaigns

876
00:35:46,560 --> 00:35:48,480
so if you want to know more about the

877
00:35:48,480 --> 00:35:51,359
apt group that exploited the proxy shell

878
00:35:51,359 --> 00:35:54,160
vulnerability we can have a look at the

879
00:35:54,160 --> 00:35:56,800
public threat report we published at the

880
00:35:56,800 --> 00:36:01,200
beginning of the year on relief security

881
00:36:01,280 --> 00:36:04,560
so to conclude let's discuss the

882
00:36:04,560 --> 00:36:07,920
mitigations of such attacks

883
00:36:07,920 --> 00:36:11,359
so first thing first if you haven't done

884
00:36:11,359 --> 00:36:14,079
so yet please patch your microsoft

885
00:36:14,079 --> 00:36:16,160
exchange servers

886
00:36:16,160 --> 00:36:19,119
in case of a compromise which is quite

887
00:36:19,119 --> 00:36:21,440
likely if you didn't patch

888
00:36:21,440 --> 00:36:23,599
patching is of course

889
00:36:23,599 --> 00:36:26,400
not enough and sorry uh first thing

890
00:36:26,400 --> 00:36:27,280
first

891
00:36:27,280 --> 00:36:29,280
also avoid to

892
00:36:29,280 --> 00:36:33,119
expose your outlook uh web app uh

893
00:36:33,119 --> 00:36:35,040
directly to internet because that's how

894
00:36:35,040 --> 00:36:36,560
the attackers manage to scan the

895
00:36:36,560 --> 00:36:38,960
internet to find victims and if you were

896
00:36:38,960 --> 00:36:40,880
compromised

897
00:36:40,880 --> 00:36:42,400
of course change

898
00:36:42,400 --> 00:36:43,920
your credentials

899
00:36:43,920 --> 00:36:45,200
and

900
00:36:45,200 --> 00:36:47,760
of course look for web shells that are

901
00:36:47,760 --> 00:36:49,200
present on

902
00:36:49,200 --> 00:36:52,079
the exchange server and remove them but

903
00:36:52,079 --> 00:36:55,200
also investigate malicious activity on

904
00:36:55,200 --> 00:36:56,960
your network because it's quite likely

905
00:36:56,960 --> 00:36:58,880
that the operators

906
00:36:58,880 --> 00:37:01,920
pivoted on on other machines in your

907
00:37:01,920 --> 00:37:03,119
network

908
00:37:03,119 --> 00:37:06,190
so that's pretty much it for me

909
00:37:06,190 --> 00:37:09,280
[Music]

910
00:37:09,280 --> 00:37:11,830
if you have any question

911
00:37:11,830 --> 00:37:21,280
[Applause]

912
00:37:21,280 --> 00:37:24,400
it was a great overview

913
00:37:24,400 --> 00:37:27,440
any questions yes sir

914
00:37:27,440 --> 00:37:30,480
you moved in the room

915
00:37:34,079 --> 00:37:35,200
thank you

916
00:37:35,200 --> 00:37:36,800
uh thanks a lot for the talk very

917
00:37:36,800 --> 00:37:39,440
interesting and indeed as eric said a

918
00:37:39,440 --> 00:37:41,520
really nice overview

919
00:37:41,520 --> 00:37:44,560
one comment on the like how to defend uh

920
00:37:44,560 --> 00:37:47,040
basically this is also i think i believe

921
00:37:47,040 --> 00:37:49,200
it's part of microsoft strategy as you

922
00:37:49,200 --> 00:37:50,960
said microsoft

923
00:37:50,960 --> 00:37:52,079
on-prem

924
00:37:52,079 --> 00:37:54,960
is available but not on cloud and we had

925
00:37:54,960 --> 00:37:56,720
several constituents that have moved to

926
00:37:56,720 --> 00:37:59,440
the cloud as a result of this okay so

927
00:37:59,440 --> 00:38:02,800
vendor lock-in uh one way to

928
00:38:02,800 --> 00:38:06,240
free yourself of proxy local proxy shell

929
00:38:06,240 --> 00:38:09,119
and now one question or like um

930
00:38:09,119 --> 00:38:10,560
as you are clearly highlighted in your

931
00:38:10,560 --> 00:38:13,200
talk uh several trade actors starting by

932
00:38:13,200 --> 00:38:16,160
havenium got access to the vulnerability

933
00:38:16,160 --> 00:38:17,119
before

934
00:38:17,119 --> 00:38:19,040
it was patched

935
00:38:19,040 --> 00:38:21,520
so in your um in your opinion

936
00:38:21,520 --> 00:38:23,359
would it mean that for example they have

937
00:38:23,359 --> 00:38:25,119
targeted security researchers such as

938
00:38:25,119 --> 00:38:28,240
orange tsai himself to get access

939
00:38:28,240 --> 00:38:30,480
or could it be that they had independent

940
00:38:30,480 --> 00:38:31,920
i would say

941
00:38:31,920 --> 00:38:34,320
research that got them access to this

942
00:38:34,320 --> 00:38:35,200
chain

943
00:38:35,200 --> 00:38:37,520
of variabilities not only one

944
00:38:37,520 --> 00:38:39,920
so i would be curious to

945
00:38:39,920 --> 00:38:42,320
get your educated guesses into that

946
00:38:42,320 --> 00:38:43,359
thank you

947
00:38:43,359 --> 00:38:44,800
so

948
00:38:44,800 --> 00:38:46,880
there are different hypotheses and

949
00:38:46,880 --> 00:38:49,040
probably different detectors didn't have

950
00:38:49,040 --> 00:38:50,960
access to the vulnerability the same way

951
00:38:50,960 --> 00:38:52,880
for example probably ethnium didn't get

952
00:38:52,880 --> 00:38:54,880
the vulnerability by the same mean as

953
00:38:54,880 --> 00:38:56,880
the other groups because you can see

954
00:38:56,880 --> 00:38:59,119
that there is clearly a time gap between

955
00:38:59,119 --> 00:39:00,560
the exploitation

956
00:39:00,560 --> 00:39:01,520
so

957
00:39:01,520 --> 00:39:03,680
a possibility as you mentioned is that

958
00:39:03,680 --> 00:39:05,359
some uh

959
00:39:05,359 --> 00:39:06,560
some

960
00:39:06,560 --> 00:39:09,119
rnsi was targeted and they stole the

961
00:39:09,119 --> 00:39:13,359
exploit from him it could be that

962
00:39:13,359 --> 00:39:16,480
the the exploit was shared by microsoft

963
00:39:16,480 --> 00:39:18,079
uh through map

964
00:39:18,079 --> 00:39:21,040
to some security company that leaked the

965
00:39:21,040 --> 00:39:23,200
exploits to some uh

966
00:39:23,200 --> 00:39:25,680
to some threat actors

967
00:39:25,680 --> 00:39:28,320
so everything is possible and of course

968
00:39:28,320 --> 00:39:30,560
we we never know for sure for every

969
00:39:30,560 --> 00:39:32,400
cases so

970
00:39:32,400 --> 00:39:34,720
thank you

971
00:39:35,040 --> 00:39:36,880
thank you there's another question up

972
00:39:36,880 --> 00:39:40,280
there helen

973
00:39:43,839 --> 00:39:45,440
thank you for the talk

974
00:39:45,440 --> 00:39:46,800
uh you

975
00:39:46,800 --> 00:39:48,560
uh mentioned that hafnium was the first

976
00:39:48,560 --> 00:39:51,520
protector and uh for proxy logon

977
00:39:51,520 --> 00:39:52,880
availability in

978
00:39:52,880 --> 00:39:56,960
january and i think in your graphical uh

979
00:39:56,960 --> 00:39:58,240
chart you

980
00:39:58,240 --> 00:40:00,560
there were some detections prior to

981
00:40:00,560 --> 00:40:02,560
third of january so

982
00:40:02,560 --> 00:40:05,040
did you see something prior to that or

983
00:40:05,040 --> 00:40:05,760
no

984
00:40:05,760 --> 00:40:08,640
we didn't see anything prior to

985
00:40:08,640 --> 00:40:11,280
to to this and then a second question

986
00:40:11,280 --> 00:40:12,880
about the shadow pad

987
00:40:12,880 --> 00:40:14,400
that shadow pad

988
00:40:14,400 --> 00:40:16,400
samples that you could not attribute

989
00:40:16,400 --> 00:40:18,880
are there those that you listed in your

990
00:40:18,880 --> 00:40:20,880
blog post uh

991
00:40:20,880 --> 00:40:21,760
yeah

992
00:40:21,760 --> 00:40:23,839
okay so but in my personal opinion i

993
00:40:23,839 --> 00:40:26,720
think they are from calipso tradactor so

994
00:40:26,720 --> 00:40:28,400
one group that you already listed

995
00:40:28,400 --> 00:40:30,400
exploiting this okay so maybe it was

996
00:40:30,400 --> 00:40:32,960
also and it was also based on what you

997
00:40:32,960 --> 00:40:35,119
meant on the encryption algorithm that

998
00:40:35,119 --> 00:40:36,880
was used so because of the encryption

999
00:40:36,880 --> 00:40:38,400
algorithm you manage to attribute to

1000
00:40:38,400 --> 00:40:40,160
clips okay that's that's interesting i

1001
00:40:40,160 --> 00:40:43,920
will recheck these samples thanks

1002
00:40:47,359 --> 00:40:48,319
okay

1003
00:40:48,319 --> 00:40:52,279
any other question

1004
00:40:54,640 --> 00:40:56,160
don't be shy

1005
00:40:56,160 --> 00:40:57,040
one

1006
00:40:57,040 --> 00:40:58,079
two

1007
00:40:58,079 --> 00:40:59,200
three

1008
00:40:59,200 --> 00:41:03,480
okay thank you very much matthew

