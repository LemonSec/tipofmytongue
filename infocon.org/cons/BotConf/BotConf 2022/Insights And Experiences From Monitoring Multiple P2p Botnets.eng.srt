1
00:00:00,160 --> 00:00:02,159
you have the floor thank you very much

2
00:00:02,159 --> 00:00:04,319
welcome everybody to my talk on insights

3
00:00:04,319 --> 00:00:06,399
and experiences from monitoring multiple

4
00:00:06,399 --> 00:00:08,880
peer-to-peer botnets this is joint work

5
00:00:08,880 --> 00:00:11,360
between me leon duck shankar karupaya

6
00:00:11,360 --> 00:00:13,440
valentin sundermann max mulheiser and

7
00:00:13,440 --> 00:00:15,759
dave levin so we come from three

8
00:00:15,759 --> 00:00:17,920
universities i'm from theo darmstadt in

9
00:00:17,920 --> 00:00:19,039
germany

10
00:00:19,039 --> 00:00:21,119
and dave is from university of maryland

11
00:00:21,119 --> 00:00:23,519
and chanka is from university since

12
00:00:23,519 --> 00:00:26,000
malaysia

13
00:00:26,720 --> 00:00:28,560
so maybe you heard about the tale of the

14
00:00:28,560 --> 00:00:30,800
blind man and the elephant and it goes

15
00:00:30,800 --> 00:00:32,800
something like that that there is a

16
00:00:32,800 --> 00:00:34,559
elephant coming into town and there are

17
00:00:34,559 --> 00:00:36,559
six blind men that are supposed to

18
00:00:36,559 --> 00:00:38,960
describe what is an elephant and each of

19
00:00:38,960 --> 00:00:40,239
them touches a different part of the

20
00:00:40,239 --> 00:00:42,960
elephant like the face the lag the tail

21
00:00:42,960 --> 00:00:44,320
or the body of the elephant and they

22
00:00:44,320 --> 00:00:46,239
each describe a different thing even

23
00:00:46,239 --> 00:00:47,600
though it's all the elephant but they

24
00:00:47,600 --> 00:00:50,160
just don't see the big picture

25
00:00:50,160 --> 00:00:50,960
so

26
00:00:50,960 --> 00:00:53,120
from our past research into peer-to-peer

27
00:00:53,120 --> 00:00:55,760
botnets we have the feeling that this is

28
00:00:55,760 --> 00:00:58,320
a similar analogy there where looking at

29
00:00:58,320 --> 00:01:00,399
a single botnet doesn't tell you the

30
00:01:00,399 --> 00:01:02,559
whole picture and you may

31
00:01:02,559 --> 00:01:04,479
think that a specific thing of that

32
00:01:04,479 --> 00:01:06,320
botnet is generalizable even though it

33
00:01:06,320 --> 00:01:08,799
isn't so some of the questions we would

34
00:01:08,799 --> 00:01:11,040
really like to answer in our research is

35
00:01:11,040 --> 00:01:13,520
how similar or how dissimilar are

36
00:01:13,520 --> 00:01:16,720
peer-to-peer botnets in respects to like

37
00:01:16,720 --> 00:01:19,119
which devices are affected how is the

38
00:01:19,119 --> 00:01:21,920
behavior over time what are the affected

39
00:01:21,920 --> 00:01:23,920
regions and what are the dynamics in

40
00:01:23,920 --> 00:01:26,159
terms of what's coming online going

41
00:01:26,159 --> 00:01:28,560
offline new ip addresses being assigned

42
00:01:28,560 --> 00:01:29,840
etc

43
00:01:29,840 --> 00:01:31,920
so there have been two great works in

44
00:01:31,920 --> 00:01:33,759
the research community namely peer to

45
00:01:33,759 --> 00:01:35,920
point by russo adele and long-term

46
00:01:35,920 --> 00:01:37,280
tracking and characterization of

47
00:01:37,280 --> 00:01:39,520
peer-to-peer botnets by janet all but

48
00:01:39,520 --> 00:01:42,320
those are almost 10 years back now and a

49
00:01:42,320 --> 00:01:43,600
lot of things have changed in the

50
00:01:43,600 --> 00:01:46,320
peer-to-peer and botnet

51
00:01:46,320 --> 00:01:47,920
world in general

52
00:01:47,920 --> 00:01:49,759
specifically when it comes to iot

53
00:01:49,759 --> 00:01:51,840
botnets so we want to investigate them

54
00:01:51,840 --> 00:01:55,159
in more detail

55
00:01:55,520 --> 00:01:57,360
however when it comes to monitoring many

56
00:01:57,360 --> 00:01:59,520
many botnets at the same time there are

57
00:01:59,520 --> 00:02:01,280
significant challenges that are mainly

58
00:02:01,280 --> 00:02:03,439
related to effort so the first one is

59
00:02:03,439 --> 00:02:05,680
human effort for any botnet that is out

60
00:02:05,680 --> 00:02:07,759
there we need to reverse it figure out

61
00:02:07,759 --> 00:02:09,440
what's the peer-to-peer communication

62
00:02:09,440 --> 00:02:11,520
protocol then we implement crawlers and

63
00:02:11,520 --> 00:02:13,599
sensors and then we analyze the data

64
00:02:13,599 --> 00:02:16,640
this requires lots of human effort and

65
00:02:16,640 --> 00:02:18,080
is not always available and then

66
00:02:18,080 --> 00:02:20,239
secondly we have resource constraints

67
00:02:20,239 --> 00:02:22,560
such as if we monitor a lot of botnets

68
00:02:22,560 --> 00:02:24,480
of significant size we need many

69
00:02:24,480 --> 00:02:26,800
machines many ip addresses and lots of

70
00:02:26,800 --> 00:02:28,959
network resources to cover all these

71
00:02:28,959 --> 00:02:31,680
botnets at a high enough speed

72
00:02:31,680 --> 00:02:34,160
and then comes another problem of

73
00:02:34,160 --> 00:02:36,160
anti-monitoring mechanisms where some of

74
00:02:36,160 --> 00:02:38,000
these bot masters implement rate

75
00:02:38,000 --> 00:02:40,319
limiting features or even block lists

76
00:02:40,319 --> 00:02:42,239
based on crawlers requesting too

77
00:02:42,239 --> 00:02:46,080
frequently so that again requires us to

78
00:02:46,080 --> 00:02:48,080
add additional crawlers and sensors to

79
00:02:48,080 --> 00:02:51,840
not be detected and blocked

80
00:02:52,720 --> 00:02:53,519
so

81
00:02:53,519 --> 00:02:55,040
we developed a system called abundant

82
00:02:55,040 --> 00:02:56,640
monitoring system where we try to

83
00:02:56,640 --> 00:02:58,879
address these five

84
00:02:58,879 --> 00:03:00,879
problems highlighted in blue

85
00:03:00,879 --> 00:03:02,560
by making

86
00:03:02,560 --> 00:03:04,720
a generic approach to as much as

87
00:03:04,720 --> 00:03:06,400
possible so we only have to do the

88
00:03:06,400 --> 00:03:09,519
detailed work for as little as possible

89
00:03:09,519 --> 00:03:10,879
i don't know where the flickering comes

90
00:03:10,879 --> 00:03:13,040
from

91
00:03:13,040 --> 00:03:15,200
but just a quick recap on peer-to-peer

92
00:03:15,200 --> 00:03:17,519
botnets so we're all on the same page

93
00:03:17,519 --> 00:03:20,319
generally we can structure can

94
00:03:20,319 --> 00:03:22,480
like categorize them based on how they

95
00:03:22,480 --> 00:03:23,920
are built so there's unstructured

96
00:03:23,920 --> 00:03:25,599
peer-to-peer botnets where there's

97
00:03:25,599 --> 00:03:28,799
usually a custom gossiping protocol that

98
00:03:28,799 --> 00:03:30,560
creates more or less random connections

99
00:03:30,560 --> 00:03:32,799
between bots and each error

100
00:03:32,799 --> 00:03:35,040
denotes that one of these bots knows one

101
00:03:35,040 --> 00:03:37,040
of the other bots then we have

102
00:03:37,040 --> 00:03:39,120
structured peer-to-peer botnets that for

103
00:03:39,120 --> 00:03:43,120
example we use the academia dht to build

104
00:03:43,120 --> 00:03:45,360
a more structured and well-defined

105
00:03:45,360 --> 00:03:47,680
peer-to-peer network and there is also

106
00:03:47,680 --> 00:03:50,480
parasitic botnets where the bots just

107
00:03:50,480 --> 00:03:53,040
leverage one of the existing

108
00:03:53,040 --> 00:03:54,480
peer-to-peer networks such as the

109
00:03:54,480 --> 00:03:57,040
bittorrent dht to forward their commands

110
00:03:57,040 --> 00:04:00,640
and exfiltrate data

111
00:04:00,640 --> 00:04:03,280
so how do we collect our data we mainly

112
00:04:03,280 --> 00:04:05,439
use crawlers and sensors and what a

113
00:04:05,439 --> 00:04:08,000
crawler does is that given a bootstrap

114
00:04:08,000 --> 00:04:10,720
here we just start asking that peer what

115
00:04:10,720 --> 00:04:12,640
other bots do you know in the network

116
00:04:12,640 --> 00:04:14,480
and they will eventually reply to us and

117
00:04:14,480 --> 00:04:16,720
we can iterately

118
00:04:16,720 --> 00:04:18,798
do that with all the bots we know and

119
00:04:18,798 --> 00:04:21,358
eventually enumerate the entire botnet

120
00:04:21,358 --> 00:04:23,280
sensors following a similar pattern but

121
00:04:23,280 --> 00:04:26,639
they are more passive and initially

122
00:04:26,639 --> 00:04:29,520
initiate connections

123
00:04:29,520 --> 00:04:31,680
and then wait for bots to actually

124
00:04:31,680 --> 00:04:33,040
communicate to them

125
00:04:33,040 --> 00:04:35,919
and they act more like they are a real

126
00:04:35,919 --> 00:04:39,600
bot and forward and discuss like

127
00:04:39,600 --> 00:04:41,280
actually look at the commands and

128
00:04:41,280 --> 00:04:43,919
forward them eventually and

129
00:04:43,919 --> 00:04:45,919
interact with the bots where a crawler

130
00:04:45,919 --> 00:04:46,880
just

131
00:04:46,880 --> 00:04:51,040
requests and handles the replies

132
00:04:52,320 --> 00:04:53,919
so now coming to the botnet monitoring

133
00:04:53,919 --> 00:04:56,240
system i told you that we're trying to

134
00:04:56,240 --> 00:04:58,160
like

135
00:04:58,160 --> 00:04:59,840
remove redundant effort wherever

136
00:04:59,840 --> 00:05:01,600
possible and on the left side here

137
00:05:01,600 --> 00:05:03,759
called bms abundant monitoring system we

138
00:05:03,759 --> 00:05:05,520
have a back end that consists of several

139
00:05:05,520 --> 00:05:07,520
docker containers such as grafana

140
00:05:07,520 --> 00:05:10,320
visualization a database component and

141
00:05:10,320 --> 00:05:12,880
several analytics

142
00:05:12,880 --> 00:05:15,360
containers that run automatically on all

143
00:05:15,360 --> 00:05:17,280
the data we collect and

144
00:05:17,280 --> 00:05:19,520
provide it to us to easily look at

145
00:05:19,520 --> 00:05:22,000
what's going on then we have an api

146
00:05:22,000 --> 00:05:24,240
through which the end communicates with

147
00:05:24,240 --> 00:05:25,919
the crawlers and sensors

148
00:05:25,919 --> 00:05:28,160
and then we have like generic

149
00:05:28,160 --> 00:05:30,000
implementations for the crawlers or the

150
00:05:30,000 --> 00:05:32,639
sensors where the entire connection to

151
00:05:32,639 --> 00:05:35,840
the back end the cueing of of the peers

152
00:05:35,840 --> 00:05:37,520
and the removal of inactive peers

153
00:05:37,520 --> 00:05:39,919
everything like that is taken care of so

154
00:05:39,919 --> 00:05:42,320
we only have to implement the protocol

155
00:05:42,320 --> 00:05:45,039
specific parts for any of these botnets

156
00:05:45,039 --> 00:05:48,560
to start tracking them more quickly

157
00:05:48,560 --> 00:05:50,320
i will go to into a little more details

158
00:05:50,320 --> 00:05:53,840
of all these components but before that

159
00:05:53,840 --> 00:05:55,759
i will try to give you a live overview

160
00:05:55,759 --> 00:05:59,039
of the data we're collecting

161
00:06:03,360 --> 00:06:05,520
so here you can see one of our main

162
00:06:05,520 --> 00:06:08,880
dashboards where i'm showing you on top

163
00:06:08,880 --> 00:06:10,960
the number of unique ips our entire

164
00:06:10,960 --> 00:06:13,680
system gets on a daily basis so we have

165
00:06:13,680 --> 00:06:15,759
an average of 50 000 unique ips that

166
00:06:15,759 --> 00:06:17,039
we're tracking

167
00:06:17,039 --> 00:06:19,840
and we get a total of 12 million replies

168
00:06:19,840 --> 00:06:23,039
to the requests we send out

169
00:06:23,039 --> 00:06:24,319
coming to the botnets that we're

170
00:06:24,319 --> 00:06:26,319
tracking currently we're tracking five

171
00:06:26,319 --> 00:06:28,240
bonus the first one is a mozi botnet

172
00:06:28,240 --> 00:06:30,080
which is a mirai like

173
00:06:30,080 --> 00:06:31,919
iot botnet that uses peer-to-peer for

174
00:06:31,919 --> 00:06:34,560
communication hajime once again is a

175
00:06:34,560 --> 00:06:37,039
mirai like peer-to-peer bonnet using

176
00:06:37,039 --> 00:06:39,199
peer-to-peer for communication and then

177
00:06:39,199 --> 00:06:41,199
we have three smaller botnets namely

178
00:06:41,199 --> 00:06:44,400
hide and seek ddg and celite that are

179
00:06:44,400 --> 00:06:46,080
also peer-to-peer botnets but much

180
00:06:46,080 --> 00:06:48,800
smaller than the former two so one thing

181
00:06:48,800 --> 00:06:50,479
that we find very interesting looking at

182
00:06:50,479 --> 00:06:53,120
these graphs over the last six months is

183
00:06:53,120 --> 00:06:55,120
that we can only see a decline for the

184
00:06:55,120 --> 00:06:57,199
sality botnet which has been around

185
00:06:57,199 --> 00:06:59,680
since 2008 and since then

186
00:06:59,680 --> 00:07:01,120
from what we have seen over the past

187
00:07:01,120 --> 00:07:04,080
years has been steadily declining

188
00:07:04,080 --> 00:07:05,039
but

189
00:07:05,039 --> 00:07:07,199
what confuses us a lot is that for

190
00:07:07,199 --> 00:07:08,880
example the mosibotnet the botmasters

191
00:07:08,880 --> 00:07:11,039
have been arrested last year and we

192
00:07:11,039 --> 00:07:13,599
don't see any significant downtrend here

193
00:07:13,599 --> 00:07:15,680
the first initial jump

194
00:07:15,680 --> 00:07:18,560
in the beginning of or end of november

195
00:07:18,560 --> 00:07:20,400
is because we updated our crawler and it

196
00:07:20,400 --> 00:07:22,560
got more efficient and then the same for

197
00:07:22,560 --> 00:07:24,319
the hajime.net we haven't seen any

198
00:07:24,319 --> 00:07:27,199
updates from the botmaster since 2018

199
00:07:27,199 --> 00:07:29,440
but yet it's still seemingly not going

200
00:07:29,440 --> 00:07:32,080
down at all

201
00:07:32,400 --> 00:07:34,880
however

202
00:07:34,880 --> 00:07:36,880
i want to go into another dashboard that

203
00:07:36,880 --> 00:07:38,479
is more in line with what i wanted to

204
00:07:38,479 --> 00:07:40,560
show you today and that is the

205
00:07:40,560 --> 00:07:42,800
comparison dashboard that we have so

206
00:07:42,800 --> 00:07:45,280
here you can select two botnets that you

207
00:07:45,280 --> 00:07:47,199
want to compare against each other like

208
00:07:47,199 --> 00:07:49,199
right now mosi and hajime are selected

209
00:07:49,199 --> 00:07:50,879
because those are the biggest botnets

210
00:07:50,879 --> 00:07:52,800
that we're tracking currently and the

211
00:07:52,800 --> 00:07:54,479
first thing that i want to talk about is

212
00:07:54,479 --> 00:07:57,520
up here in the aggregate statistics

213
00:07:57,520 --> 00:07:58,720
that

214
00:07:58,720 --> 00:07:59,919
mosey has

215
00:07:59,919 --> 00:08:02,720
50 15 000 unique ips

216
00:08:02,720 --> 00:08:04,720
per hour on average

217
00:08:04,720 --> 00:08:06,560
and not on average maximum unique ips

218
00:08:06,560 --> 00:08:09,039
was 15 000 but the maximum unique ids we

219
00:08:09,039 --> 00:08:12,080
observed was only 13 795.

220
00:08:12,080 --> 00:08:13,919
so why are there less ids than ip

221
00:08:13,919 --> 00:08:16,400
addresses this is probably related to ip

222
00:08:16,400 --> 00:08:18,560
address reassignment policies from many

223
00:08:18,560 --> 00:08:20,400
isps out there

224
00:08:20,400 --> 00:08:22,960
and by itself it isn't very confusing

225
00:08:22,960 --> 00:08:24,800
however if we then look at hajime which

226
00:08:24,800 --> 00:08:26,879
has the statistics down here we actually

227
00:08:26,879 --> 00:08:28,000
see that it's

228
00:08:28,000 --> 00:08:30,400
fewer unique ip addresses than unique

229
00:08:30,400 --> 00:08:34,080
ids so why is this

230
00:08:34,080 --> 00:08:36,159
turned around in this case and what

231
00:08:36,159 --> 00:08:37,919
we're assuming is that hajime is

232
00:08:37,919 --> 00:08:40,479
affecting more carry great nut

233
00:08:40,479 --> 00:08:42,479
autonomous systems where multiple

234
00:08:42,479 --> 00:08:44,959
infections share one public ip among

235
00:08:44,959 --> 00:08:46,959
each other and another explanation could

236
00:08:46,959 --> 00:08:48,959
be that the instability of the hajime

237
00:08:48,959 --> 00:08:50,399
botnet

238
00:08:50,399 --> 00:08:52,800
it crashes sometimes and then if it

239
00:08:52,800 --> 00:08:54,480
crashes it will have a new id upon

240
00:08:54,480 --> 00:08:57,680
reboot and re-infection

241
00:08:58,160 --> 00:09:00,560
but nevertheless we can save just from

242
00:09:00,560 --> 00:09:02,399
looking at this that an apple to apple's

243
00:09:02,399 --> 00:09:04,560
comparison of let's say ip addresses or

244
00:09:04,560 --> 00:09:06,720
even ids is not always an accurate

245
00:09:06,720 --> 00:09:08,640
comparison when we look at the size of

246
00:09:08,640 --> 00:09:11,440
peer-to-peer botnets

247
00:09:11,440 --> 00:09:13,040
the second thing i want to talk about is

248
00:09:13,040 --> 00:09:14,880
a very interesting pattern that we see

249
00:09:14,880 --> 00:09:16,800
for mozy

250
00:09:16,800 --> 00:09:17,920
where

251
00:09:17,920 --> 00:09:20,880
like once daily we have this spike where

252
00:09:20,880 --> 00:09:23,120
we almost get twice as many replies back

253
00:09:23,120 --> 00:09:25,040
from the bots than at any other time

254
00:09:25,040 --> 00:09:27,040
during the day and we don't see a

255
00:09:27,040 --> 00:09:29,680
similar behavior for hajime

256
00:09:29,680 --> 00:09:31,360
so when we were investigating this we

257
00:09:31,360 --> 00:09:33,600
actually found that it's just a single

258
00:09:33,600 --> 00:09:36,800
isp in china causing most of this

259
00:09:36,800 --> 00:09:38,480
these spikes here

260
00:09:38,480 --> 00:09:41,040
and looking further we found out that

261
00:09:41,040 --> 00:09:43,040
other have others have reported already

262
00:09:43,040 --> 00:09:45,760
that some isps in china throttle the

263
00:09:45,760 --> 00:09:48,320
internet bandwidths to the outside world

264
00:09:48,320 --> 00:09:50,399
during china day time

265
00:09:50,399 --> 00:09:51,200
so

266
00:09:51,200 --> 00:09:54,240
this is actually happening from 8 00 p.m

267
00:09:54,240 --> 00:09:56,640
to 1 a.m in europe

268
00:09:56,640 --> 00:10:00,160
but that matches 2 a.m to 7 00 a.m in

269
00:10:00,160 --> 00:10:02,880
china and is most likely because the

270
00:10:02,880 --> 00:10:05,040
throttling is not active during these

271
00:10:05,040 --> 00:10:08,320
times which is allowing us to get about

272
00:10:08,320 --> 00:10:11,360
twice as many requests in

273
00:10:11,360 --> 00:10:13,440
once again we don't see it for hajime

274
00:10:13,440 --> 00:10:15,760
because hajime is actually not infecting

275
00:10:15,760 --> 00:10:17,680
many devices in that autonomous system

276
00:10:17,680 --> 00:10:20,719
so it's not very pronounced

277
00:10:21,200 --> 00:10:22,480
the second thing that i want to talk

278
00:10:22,480 --> 00:10:24,880
about is that we see like a clear

279
00:10:24,880 --> 00:10:26,880
diurnal pattern in the number of unique

280
00:10:26,880 --> 00:10:29,839
ips we see for mosey on a daily basis

281
00:10:29,839 --> 00:10:31,440
but once again we don't see it at all

282
00:10:31,440 --> 00:10:33,120
for hajime

283
00:10:33,120 --> 00:10:35,360
so when we investigated this we once

284
00:10:35,360 --> 00:10:38,000
again found that it's related to a

285
00:10:38,000 --> 00:10:40,240
single country in that case which is

286
00:10:40,240 --> 00:10:42,320
india that has

287
00:10:42,320 --> 00:10:45,200
a diurnal pattern that matches the

288
00:10:45,200 --> 00:10:46,399
global pattern

289
00:10:46,399 --> 00:10:48,399
seen in the hadamard plot very

290
00:10:48,399 --> 00:10:50,720
accurately

291
00:10:50,720 --> 00:10:51,519
so

292
00:10:51,519 --> 00:10:53,440
seeing this we were expecting okay let's

293
00:10:53,440 --> 00:10:55,040
let's look at what's going on in hajime

294
00:10:55,040 --> 00:10:56,800
because we would expect to see this once

295
00:10:56,800 --> 00:10:57,600
again

296
00:10:57,600 --> 00:11:00,480
but if we now look at the unique

297
00:11:00,480 --> 00:11:03,200
eyepiece for india and hajime we once

298
00:11:03,200 --> 00:11:04,640
again see that there's almost no

299
00:11:04,640 --> 00:11:06,800
discernible diurnal pattern and only

300
00:11:06,800 --> 00:11:08,240
artifacts from our crawler and the

301
00:11:08,240 --> 00:11:10,720
crashes

302
00:11:11,200 --> 00:11:13,200
so once again what we learned from this

303
00:11:13,200 --> 00:11:15,760
is just because two botnets in fact

304
00:11:15,760 --> 00:11:17,680
machines in the same country doesn't

305
00:11:17,680 --> 00:11:19,279
mean that the behavior of the machines

306
00:11:19,279 --> 00:11:21,519
that are affected are equal and

307
00:11:21,519 --> 00:11:23,519
comparable at all cases and you

308
00:11:23,519 --> 00:11:25,440
oftentimes have to dig much deeper if

309
00:11:25,440 --> 00:11:27,200
you want to understand the botnets in

310
00:11:27,200 --> 00:11:29,839
detail

311
00:11:30,959 --> 00:11:32,320
so the last thing that i want to talk

312
00:11:32,320 --> 00:11:34,800
about is the world maps that you can see

313
00:11:34,800 --> 00:11:35,920
here

314
00:11:35,920 --> 00:11:38,640
and once again mosey and hajime are very

315
00:11:38,640 --> 00:11:42,079
different here so for mozi we see that 8

316
00:11:42,079 --> 00:11:44,399
000 of the infections are located in

317
00:11:44,399 --> 00:11:46,560
china whereas for hajime we actually

318
00:11:46,560 --> 00:11:49,920
only have below 100 average infections

319
00:11:49,920 --> 00:11:52,000
that we can observe in china

320
00:11:52,000 --> 00:11:53,279
contrary

321
00:11:53,279 --> 00:11:55,360
china has a lot of infection hajime has

322
00:11:55,360 --> 00:11:57,279
a lot of infections in iran where once

323
00:11:57,279 --> 00:11:59,360
again mosey almost has no infections at

324
00:11:59,360 --> 00:12:01,680
all and apart from these like big

325
00:12:01,680 --> 00:12:03,839
focused countries from for each of these

326
00:12:03,839 --> 00:12:06,399
malware types we can see that hajime is

327
00:12:06,399 --> 00:12:08,240
much more spread across the entire world

328
00:12:08,240 --> 00:12:09,920
with several countries having more than

329
00:12:09,920 --> 00:12:13,120
100 infections and mosey being almost

330
00:12:13,120 --> 00:12:15,120
only located in these three hot spots

331
00:12:15,120 --> 00:12:16,880
that we can see which are india russia

332
00:12:16,880 --> 00:12:19,680
and china with very few infections

333
00:12:19,680 --> 00:12:23,239
outside of that

334
00:12:24,800 --> 00:12:27,040
so with that i'll jump back to my

335
00:12:27,040 --> 00:12:30,040
presentation

336
00:12:38,160 --> 00:12:40,079
so once again here i just wanted to show

337
00:12:40,079 --> 00:12:41,519
you some of the investigations that

338
00:12:41,519 --> 00:12:43,760
weren't done on the dashboard and we can

339
00:12:43,760 --> 00:12:46,399
see that the autonomous system with 4837

340
00:12:46,399 --> 00:12:48,639
which is located in china

341
00:12:48,639 --> 00:12:51,360
shows these spikes in green which which

342
00:12:51,360 --> 00:12:52,800
we've seen previously in the dashboard

343
00:12:52,800 --> 00:12:54,399
for the replies

344
00:12:54,399 --> 00:12:56,560
and here's the work by zouad al which

345
00:12:56,560 --> 00:12:59,519
have observed this great bottleneck of

346
00:12:59,519 --> 00:13:01,200
china which they call it which is

347
00:13:01,200 --> 00:13:02,320
related to

348
00:13:02,320 --> 00:13:04,560
internet traffic going to outside of

349
00:13:04,560 --> 00:13:08,239
china being throttled during day time

350
00:13:09,760 --> 00:13:11,200
so coming back to some of the details

351
00:13:11,200 --> 00:13:14,639
for the button monitoring system

352
00:13:17,120 --> 00:13:18,880
some of the things like the one of the

353
00:13:18,880 --> 00:13:20,480
very first things we had to do when we

354
00:13:20,480 --> 00:13:21,279
we

355
00:13:21,279 --> 00:13:23,120
embarked upon this work is

356
00:13:23,120 --> 00:13:25,519
how do we analyze all of these botnets

357
00:13:25,519 --> 00:13:27,920
at the same time in a meaningful way

358
00:13:27,920 --> 00:13:28,959
and

359
00:13:28,959 --> 00:13:30,880
what we came towards is that we need a

360
00:13:30,880 --> 00:13:33,120
common database format so what we would

361
00:13:33,120 --> 00:13:34,959
usually love to have all the information

362
00:13:34,959 --> 00:13:36,560
we could possibly get

363
00:13:36,560 --> 00:13:38,079
to make them comparable and easily

364
00:13:38,079 --> 00:13:40,399
storable in the same database we decided

365
00:13:40,399 --> 00:13:42,480
to have a common database format that is

366
00:13:42,480 --> 00:13:44,639
similar across all botnets so one of the

367
00:13:44,639 --> 00:13:47,519
things we're storing are called replies

368
00:13:47,519 --> 00:13:49,600
which is just any kind of interaction

369
00:13:49,600 --> 00:13:52,000
with the bot at the specified time so

370
00:13:52,000 --> 00:13:54,079
this could be collected by a crawler

371
00:13:54,079 --> 00:13:55,360
sending out a request and getting a

372
00:13:55,360 --> 00:13:57,839
valid reply by a sensor being contacted

373
00:13:57,839 --> 00:14:00,000
by one of the infected machines by a

374
00:14:00,000 --> 00:14:02,320
honeypot getting a valid interaction or

375
00:14:02,320 --> 00:14:03,680
like a

376
00:14:03,680 --> 00:14:05,519
network telescope being attacked by a

377
00:14:05,519 --> 00:14:08,079
known fingerprint of a malware that

378
00:14:08,079 --> 00:14:09,600
could all be stored in there and then

379
00:14:09,600 --> 00:14:11,600
easily be replicated to be shown and

380
00:14:11,600 --> 00:14:14,480
compared in these dashboards that we use

381
00:14:14,480 --> 00:14:16,320
and also a lot of our aggregate

382
00:14:16,320 --> 00:14:18,240
functions and analysis

383
00:14:18,240 --> 00:14:21,120
uh works on this data type

384
00:14:21,120 --> 00:14:24,240
and then the second more specific to

385
00:14:24,240 --> 00:14:26,800
peer-to-peer botnets are edges where we

386
00:14:26,800 --> 00:14:29,839
actually record that about x was

387
00:14:29,839 --> 00:14:31,760
connected to about y

388
00:14:31,760 --> 00:14:33,920
at a certain point in time which helps

389
00:14:33,920 --> 00:14:36,160
us to look at how the messages spread

390
00:14:36,160 --> 00:14:38,320
within these peer-to-peer networks

391
00:14:38,320 --> 00:14:41,040
and general graph analysis and analysis

392
00:14:41,040 --> 00:14:43,199
of the resilience of these botnets and

393
00:14:43,199 --> 00:14:44,399
potential

394
00:14:44,399 --> 00:14:46,639
sinkholing or partitioning attacks and

395
00:14:46,639 --> 00:14:48,160
this kind of data is usually only

396
00:14:48,160 --> 00:14:51,199
collected by crawlers

397
00:14:53,279 --> 00:14:55,440
so one of the the questions you may ask

398
00:14:55,440 --> 00:14:57,519
is why didn't we just go for the simple

399
00:14:57,519 --> 00:14:59,199
solution with our back end and set up

400
00:14:59,199 --> 00:15:01,279
like a database where all of our

401
00:15:01,279 --> 00:15:04,000
crawlers can connect too easily

402
00:15:04,000 --> 00:15:05,279
and there

403
00:15:05,279 --> 00:15:06,959
there are several drawbacks which is why

404
00:15:06,959 --> 00:15:09,040
we didn't choose that so the first one

405
00:15:09,040 --> 00:15:09,760
is

406
00:15:09,760 --> 00:15:11,600
that we wouldn't have any way of

407
00:15:11,600 --> 00:15:14,160
validating or authenticating

408
00:15:14,160 --> 00:15:16,639
the data that's coming in so if we want

409
00:15:16,639 --> 00:15:18,480
to open up this system to have

410
00:15:18,480 --> 00:15:21,360
collaboration across our universities

411
00:15:21,360 --> 00:15:23,199
and with people we don't know we want to

412
00:15:23,199 --> 00:15:24,959
have the ability to validate the data

413
00:15:24,959 --> 00:15:27,040
that is coming in so we don't put a lot

414
00:15:27,040 --> 00:15:27,839
of

415
00:15:27,839 --> 00:15:29,759
wrong data into our database

416
00:15:29,759 --> 00:15:31,360
which is one of the reason

417
00:15:31,360 --> 00:15:32,160
then

418
00:15:32,160 --> 00:15:34,320
just having a database would be

419
00:15:34,320 --> 00:15:36,000
a kind of one-way communication where

420
00:15:36,000 --> 00:15:37,759
you can deliver data but you cannot tell

421
00:15:37,759 --> 00:15:40,800
the crawlers what to do and so no

422
00:15:40,800 --> 00:15:42,800
coordination would be possible which is

423
00:15:42,800 --> 00:15:45,519
one of our plan next steps where we want

424
00:15:45,519 --> 00:15:47,519
to actually use the back end to tell the

425
00:15:47,519 --> 00:15:49,759
crawlers what to do and how to do it so

426
00:15:49,759 --> 00:15:51,519
we can circumvent counter measures like

427
00:15:51,519 --> 00:15:53,440
rate limiting by spreading out the load

428
00:15:53,440 --> 00:15:55,759
among many crawlers at the same time or

429
00:15:55,759 --> 00:15:58,079
dynamic resource allocation in the sense

430
00:15:58,079 --> 00:16:00,320
that if one botnet starts to grow

431
00:16:00,320 --> 00:16:02,079
significantly and we need more crawlers

432
00:16:02,079 --> 00:16:03,759
focusing on that we can do it

433
00:16:03,759 --> 00:16:06,079
automatically from the back end and

434
00:16:06,079 --> 00:16:09,120
kind of tell the satellites what to do

435
00:16:09,120 --> 00:16:10,720
and that's why we chose to implement a

436
00:16:10,720 --> 00:16:12,079
custom api

437
00:16:12,079 --> 00:16:16,880
which is written in golang using grpc

438
00:16:18,399 --> 00:16:20,079
then i've talked about how the base

439
00:16:20,079 --> 00:16:21,600
crawler

440
00:16:21,600 --> 00:16:24,079
is supposed to be as generic as possible

441
00:16:24,079 --> 00:16:25,440
and cover all these things that you

442
00:16:25,440 --> 00:16:27,839
would have to implement multiple times

443
00:16:27,839 --> 00:16:29,519
and among these features that we've

444
00:16:29,519 --> 00:16:32,480
implemented there is the backend and api

445
00:16:32,480 --> 00:16:36,000
connection to talk to the bms backend we

446
00:16:36,000 --> 00:16:37,440
have implemented queuing and

447
00:16:37,440 --> 00:16:39,360
parallelized crawling so we can run

448
00:16:39,360 --> 00:16:42,720
easily 20 000 simultaneous connections

449
00:16:42,720 --> 00:16:43,600
and

450
00:16:43,600 --> 00:16:45,839
not be slowed down too much by peers

451
00:16:45,839 --> 00:16:48,160
responding very slowly

452
00:16:48,160 --> 00:16:50,560
we also implemented a logic that's uh

453
00:16:50,560 --> 00:16:53,040
parameterized to remove un uh

454
00:16:53,040 --> 00:16:55,440
unresponsive peers so let's say

455
00:16:55,440 --> 00:16:57,279
an infected machine changes its ip

456
00:16:57,279 --> 00:16:59,360
address we don't want to indefinitely

457
00:16:59,360 --> 00:17:01,199
spam the old ip address with our

458
00:17:01,199 --> 00:17:03,600
requests so we have put some logic there

459
00:17:03,600 --> 00:17:05,839
on when to get rid of that

460
00:17:05,839 --> 00:17:08,000
we also support tcp and udp based

461
00:17:08,000 --> 00:17:10,400
peer-to-peer botnets and for udp we

462
00:17:10,400 --> 00:17:13,039
implemented a custom retry mechanism

463
00:17:13,039 --> 00:17:14,000
that is

464
00:17:14,000 --> 00:17:17,280
similar to tcp retries so if one message

465
00:17:17,280 --> 00:17:19,359
gets dropped because of network outages

466
00:17:19,359 --> 00:17:21,839
or general network issues we will try

467
00:17:21,839 --> 00:17:23,839
again and try again just to verify that

468
00:17:23,839 --> 00:17:25,599
the peer is actually offline if we don't

469
00:17:25,599 --> 00:17:28,480
get a reply in that case

470
00:17:28,480 --> 00:17:30,480
and then lastly we use

471
00:17:30,480 --> 00:17:32,480
a two-queue system which i will explain

472
00:17:32,480 --> 00:17:33,919
in a little more detail on the next

473
00:17:33,919 --> 00:17:35,039
slide

474
00:17:35,039 --> 00:17:37,120
because in the past we have realized

475
00:17:37,120 --> 00:17:40,000
that unresponsive peers can slow down

476
00:17:40,000 --> 00:17:42,160
our crawling by so much that we wanted

477
00:17:42,160 --> 00:17:46,080
to get a way around that

478
00:17:46,080 --> 00:17:46,960
so

479
00:17:46,960 --> 00:17:49,679
the the idea that we have is we we split

480
00:17:49,679 --> 00:17:51,919
the monitoring into two loops and we

481
00:17:51,919 --> 00:17:54,400
have a discovery loop that is fed with

482
00:17:54,400 --> 00:17:56,160
either a seed list of peers when we

483
00:17:56,160 --> 00:17:58,640
first start crawling and after that we

484
00:17:58,640 --> 00:18:00,640
put in all newly found peers into that

485
00:18:00,640 --> 00:18:02,080
discovery loop

486
00:18:02,080 --> 00:18:04,240
and the discovery loop is kind of like

487
00:18:04,240 --> 00:18:07,200
it can be slow we don't mind too much

488
00:18:07,200 --> 00:18:10,000
but it essentially tries to do the first

489
00:18:10,000 --> 00:18:11,679
connection to any of the infected

490
00:18:11,679 --> 00:18:13,760
devices and as soon as we get a valid

491
00:18:13,760 --> 00:18:15,520
reply we will put it into the tracking

492
00:18:15,520 --> 00:18:18,000
loop which is only full of responsive

493
00:18:18,000 --> 00:18:19,919
peers so we don't have long response

494
00:18:19,919 --> 00:18:21,760
times and wait for inactive peers to

495
00:18:21,760 --> 00:18:23,120
never respond

496
00:18:23,120 --> 00:18:24,799
and there we can even increase the

497
00:18:24,799 --> 00:18:27,840
crawling speed at which we're working

498
00:18:27,840 --> 00:18:30,559
and once we

499
00:18:30,720 --> 00:18:33,440
we observe appear going inactive it will

500
00:18:33,440 --> 00:18:35,600
go back into the discovery loop where it

501
00:18:35,600 --> 00:18:38,000
will eventually be removed if it hasn't

502
00:18:38,000 --> 00:18:40,480
been seen for whatever specified time

503
00:18:40,480 --> 00:18:42,480
period

504
00:18:42,480 --> 00:18:44,160
so the spike that i've shown you

505
00:18:44,160 --> 00:18:47,039
previously where our mosi crawler got

506
00:18:47,039 --> 00:18:49,200
about five thousand piers more per hour

507
00:18:49,200 --> 00:18:51,039
is actually due to a change in this base

508
00:18:51,039 --> 00:18:53,520
crawler

509
00:18:55,039 --> 00:18:58,240
and then last but not least for that um

510
00:18:58,240 --> 00:19:00,240
just a quick example of what we can do

511
00:19:00,240 --> 00:19:02,640
with this space crawler setup and for

512
00:19:02,640 --> 00:19:04,480
the hide-and-seek bonnet which has

513
00:19:04,480 --> 00:19:06,960
arguably a very simple protocol what you

514
00:19:06,960 --> 00:19:08,799
see on the right is the entirety of the

515
00:19:08,799 --> 00:19:10,799
code to make the crawler work with hide

516
00:19:10,799 --> 00:19:12,799
and seek where we simply implement the

517
00:19:12,799 --> 00:19:15,360
send peer request and read reply methods

518
00:19:15,360 --> 00:19:17,200
which are then called from the base

519
00:19:17,200 --> 00:19:19,919
crawler and automatically processed and

520
00:19:19,919 --> 00:19:23,480
sent to the database

521
00:19:24,400 --> 00:19:26,000
so what are some of the ongoing and

522
00:19:26,000 --> 00:19:28,240
future work that we're doing with

523
00:19:28,240 --> 00:19:30,480
bonding monitoring system the first

524
00:19:30,480 --> 00:19:32,400
thing we're looking into is automating

525
00:19:32,400 --> 00:19:34,160
the measurement of churn and lifetimes

526
00:19:34,160 --> 00:19:37,039
so we want to know for how long do bots

527
00:19:37,039 --> 00:19:39,600
stay up in one of these botnets and when

528
00:19:39,600 --> 00:19:40,960
do they leave

529
00:19:40,960 --> 00:19:43,280
and at what rates and what patterns do

530
00:19:43,280 --> 00:19:44,880
they do that

531
00:19:44,880 --> 00:19:46,799
and then the second thing is

532
00:19:46,799 --> 00:19:48,400
implement some of the sensor and crawler

533
00:19:48,400 --> 00:19:49,919
detection work that we've done in the

534
00:19:49,919 --> 00:19:51,280
past

535
00:19:51,280 --> 00:19:52,880
firstly to analyze if we can actually

536
00:19:52,880 --> 00:19:55,039
detect ourselves and if this is the case

537
00:19:55,039 --> 00:19:57,280
then the bad guys can probably detect us

538
00:19:57,280 --> 00:19:59,440
as well if they wanted to so we can try

539
00:19:59,440 --> 00:20:02,000
to be more stealthy in that sense and we

540
00:20:02,000 --> 00:20:03,840
can also filter out the activities of

541
00:20:03,840 --> 00:20:06,159
other researchers which are sometimes

542
00:20:06,159 --> 00:20:09,520
very noisy in the data set and actually

543
00:20:09,520 --> 00:20:12,799
mess up some of the analytics

544
00:20:12,799 --> 00:20:15,200
and lastly one of the most thought after

545
00:20:15,200 --> 00:20:17,840
features for this system is coordination

546
00:20:17,840 --> 00:20:19,919
where we want to implement like dynamic

547
00:20:19,919 --> 00:20:22,720
load allocation to the crawlers so we

548
00:20:22,720 --> 00:20:24,640
can share the load and circumvent

549
00:20:24,640 --> 00:20:26,799
anti-monitoring mechanisms like rate

550
00:20:26,799 --> 00:20:31,080
limiting or black listing features

551
00:20:34,320 --> 00:20:36,159
if you like what you're seeing

552
00:20:36,159 --> 00:20:37,919
we're happy to collaborate directly with

553
00:20:37,919 --> 00:20:39,919
you give you access to the data we're

554
00:20:39,919 --> 00:20:41,280
not making it public because i would

555
00:20:41,280 --> 00:20:43,280
like to check that the person asking for

556
00:20:43,280 --> 00:20:46,720
the data is actually not a criminal

557
00:20:46,720 --> 00:20:48,240
we're also happy to share the source

558
00:20:48,240 --> 00:20:49,280
code with you if you don't want to

559
00:20:49,280 --> 00:20:51,600
collaborate with us on on our system you

560
00:20:51,600 --> 00:20:53,440
could set up your own system

561
00:20:53,440 --> 00:20:54,880
and run it

562
00:20:54,880 --> 00:20:57,280
we will make dashboards publicly

563
00:20:57,280 --> 00:20:59,679
available soon after this talk

564
00:20:59,679 --> 00:21:01,919
and just contact us at bonnette

565
00:21:01,919 --> 00:21:04,919
tk.tioministarte

566
00:21:05,600 --> 00:21:07,360
thank you very much and i'm happy to

567
00:21:07,360 --> 00:21:09,190
take your questions

568
00:21:09,190 --> 00:21:16,320
[Applause]

569
00:21:16,320 --> 00:21:20,080
okay questions on the left

570
00:21:24,640 --> 00:21:27,760
keep your content raised

571
00:21:29,120 --> 00:21:30,720
a quick question thank you for the talk

572
00:21:30,720 --> 00:21:32,240
amazing graphics by the way uh

573
00:21:32,240 --> 00:21:34,640
visualization is cool uh

574
00:21:34,640 --> 00:21:36,480
question is have you ever experienced

575
00:21:36,480 --> 00:21:38,240
any kind of active counter measures from

576
00:21:38,240 --> 00:21:41,360
the bot headers to kind of try and

577
00:21:41,360 --> 00:21:43,679
prevent you from conducting information

578
00:21:43,679 --> 00:21:45,600
about the botnet size and so on and

579
00:21:45,600 --> 00:21:47,440
maybe if you may another question at the

580
00:21:47,440 --> 00:21:49,120
same time

581
00:21:49,120 --> 00:21:50,799
do you also track the commands that are

582
00:21:50,799 --> 00:21:52,480
issued to the bots and how quickly they

583
00:21:52,480 --> 00:21:54,080
are propagated across different types of

584
00:21:54,080 --> 00:21:56,559
botnets

585
00:21:56,559 --> 00:21:58,559
so regarding the first question the two

586
00:21:58,559 --> 00:22:01,360
big ones we're tracking right now are

587
00:22:01,360 --> 00:22:03,120
seemingly dead or dead for sure because

588
00:22:03,120 --> 00:22:04,880
the bot masters have been arrested so i

589
00:22:04,880 --> 00:22:06,559
don't i don't see any active push back

590
00:22:06,559 --> 00:22:07,679
there

591
00:22:07,679 --> 00:22:10,000
but for the ddg botnet they did a lot of

592
00:22:10,000 --> 00:22:11,679
evolutions in the peer-to-peer protocol

593
00:22:11,679 --> 00:22:13,919
when we first started looking at it and

594
00:22:13,919 --> 00:22:16,159
the hide-and-seek botnet for example

595
00:22:16,159 --> 00:22:17,360
implements

596
00:22:17,360 --> 00:22:19,360
rate limiting based on the requesting ip

597
00:22:19,360 --> 00:22:20,400
addresses

598
00:22:20,400 --> 00:22:22,240
so so there are countermeasures but we

599
00:22:22,240 --> 00:22:26,320
haven't been targeted specifically yet

600
00:22:26,320 --> 00:22:29,678
and the second question was

601
00:22:30,240 --> 00:22:32,480
i the the command tracking so for the

602
00:22:32,480 --> 00:22:34,320
salary button we're actually

603
00:22:34,320 --> 00:22:35,679
checking when a new command is being

604
00:22:35,679 --> 00:22:37,919
spread and when we see it first but we

605
00:22:37,919 --> 00:22:41,200
haven't analyzed the data in detail yet

606
00:22:41,200 --> 00:22:43,679
and for the other ones as i said they're

607
00:22:43,679 --> 00:22:45,520
not being developed actively so we have

608
00:22:45,520 --> 00:22:49,039
a difficult time doing that right now

609
00:22:51,280 --> 00:22:55,480
okay another question

610
00:22:59,200 --> 00:23:00,159
one

611
00:23:00,159 --> 00:23:01,200
two

612
00:23:01,200 --> 00:23:03,520
three

613
00:23:04,000 --> 00:23:07,320
wake up

614
00:23:08,400 --> 00:23:11,040
okay thank you very much

615
00:23:11,040 --> 00:23:17,920
[Applause]

