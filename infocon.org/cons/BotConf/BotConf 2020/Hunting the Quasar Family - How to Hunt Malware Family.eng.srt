1
00:00:04,880 --> 00:00:08,320
thank you for watching i am kotakunov

2
00:00:06,799 --> 00:00:12,639
from jp sat

3
00:00:08,320 --> 00:00:12,639
our presentation today is about faiza

4
00:00:13,920 --> 00:00:16,960
before we get started i would like to

5
00:00:16,239 --> 00:00:20,400
give a brief

6
00:00:16,960 --> 00:00:24,400
introduction about faiza fresa is a very

7
00:00:20,400 --> 00:00:24,400
famous slot published on github

8
00:00:25,760 --> 00:00:30,480
pesa has a lot of future required for a

9
00:00:28,000 --> 00:00:34,000
lot the latest version works on windows

10
00:00:30,480 --> 00:00:34,000
vista and later versions

11
00:00:35,200 --> 00:00:38,879
tesla is using many attack operations

12
00:00:38,000 --> 00:00:42,079
for example

13
00:00:38,879 --> 00:00:44,800
an apt group called apt-10 use it in

14
00:00:42,079 --> 00:00:46,879
targeted attacks it has also been

15
00:00:44,800 --> 00:00:49,440
deported by security vendors

16
00:00:46,879 --> 00:00:50,239
that quasar is being used by many other

17
00:00:49,440 --> 00:00:53,280
apts

18
00:00:50,239 --> 00:00:53,279
and criminal groups

19
00:00:55,039 --> 00:00:59,520
so the goal of this presentation is to

20
00:00:57,280 --> 00:01:02,960
share the internal of the quasar family

21
00:00:59,520 --> 00:01:02,960
and seeds hunting results

22
00:01:04,000 --> 00:01:07,760
here's the agenda for today's

23
00:01:05,438 --> 00:01:09,520
presentation first

24
00:01:07,760 --> 00:01:10,880
we would like to talk about crystal

25
00:01:09,520 --> 00:01:13,520
internals

26
00:01:10,880 --> 00:01:15,280
secondly we would show love belonging to

27
00:01:13,520 --> 00:01:17,840
crazy family

28
00:01:15,280 --> 00:01:21,600
sadly we will introduce a campaign of

29
00:01:17,840 --> 00:01:23,680
targeted attacks diabetes using quasar

30
00:01:21,600 --> 00:01:27,520
finally we will share our method for

31
00:01:23,680 --> 00:01:31,520
hunting fraser family seeds

32
00:01:27,520 --> 00:01:31,520
so let's move on to the first topic

33
00:01:32,400 --> 00:01:37,119
crystal client is coded in c sharp

34
00:01:34,880 --> 00:01:41,439
therefore it can be decompiled using a

35
00:01:37,119 --> 00:01:43,360
tool such as dns file

36
00:01:41,439 --> 00:01:44,720
the history of quesado's version goes

37
00:01:43,360 --> 00:01:47,840
like this

38
00:01:44,720 --> 00:01:49,600
early on it was called extract followed

39
00:01:47,840 --> 00:01:52,799
by peter 1.0

40
00:01:49,600 --> 00:01:55,520
1.1 1.3 1.3

41
00:01:52,799 --> 00:01:58,320
and the lattice 1.4 was released in june

42
00:01:55,520 --> 00:01:58,320
of this year

43
00:01:59,520 --> 00:02:03,679
here's how quizzer communicates the

44
00:02:02,079 --> 00:02:05,679
first one is extract

45
00:02:03,680 --> 00:02:06,799
but this one contains the data size in

46
00:02:05,680 --> 00:02:10,239
the first 4 byte

47
00:02:06,799 --> 00:02:12,640
color by 16 bytes of initial vector

48
00:02:10,239 --> 00:02:14,400
and finally the data encrypted in aes

49
00:02:12,640 --> 00:02:16,720
cvc mode

50
00:02:14,400 --> 00:02:18,319
the encrypted data contains the one byte

51
00:02:16,720 --> 00:02:19,920
commands and the argument for the

52
00:02:18,319 --> 00:02:22,958
commands

53
00:02:19,920 --> 00:02:25,920
also the as key use md5 hash value of

54
00:02:22,959 --> 00:02:25,920
the encryption key

55
00:02:26,959 --> 00:02:31,920
next is the quasar 1.3 it is similar in

56
00:02:30,319 --> 00:02:35,679
structure to extract

57
00:02:31,920 --> 00:02:38,079
but hmac is used in addition the data is

58
00:02:35,680 --> 00:02:38,560
alias encrypted with an additional quick

59
00:02:38,080 --> 00:02:41,360
reset

60
00:02:38,560 --> 00:02:43,680
compilation process furthermore the

61
00:02:41,360 --> 00:02:45,760
method of generating as key has been

62
00:02:43,680 --> 00:02:50,560
changed from md5 hash value

63
00:02:45,760 --> 00:02:53,280
to a method using pvk dxc

64
00:02:50,560 --> 00:02:55,680
finally laser 1.4 the communication

65
00:02:53,280 --> 00:02:57,440
method has changed significantly from

66
00:02:55,680 --> 00:02:59,920
the previous version

67
00:02:57,440 --> 00:03:00,959
the previous areas and prepared are no

68
00:02:59,920 --> 00:03:03,359
longer used

69
00:03:00,959 --> 00:03:04,239
and instead the data is serialized

70
00:03:03,360 --> 00:03:06,640
serialized

71
00:03:04,239 --> 00:03:08,400
using protocol buffer which is developed

72
00:03:06,640 --> 00:03:10,159
by google

73
00:03:08,400 --> 00:03:14,720
in addition the communication is

74
00:03:10,159 --> 00:03:14,720
encrypted using tls 1.2

75
00:03:15,519 --> 00:03:20,959
the communication between the queso 1.3

76
00:03:18,239 --> 00:03:23,200
client and the server goes like this

77
00:03:20,959 --> 00:03:24,640
first when crazy clients connect to the

78
00:03:23,200 --> 00:03:26,319
server the server requests

79
00:03:24,640 --> 00:03:28,399
authentication

80
00:03:26,319 --> 00:03:30,079
the client then sends the authentication

81
00:03:28,400 --> 00:03:31,840
information to the server

82
00:03:30,080 --> 00:03:34,080
and the server returns the response of

83
00:03:31,840 --> 00:03:36,560
authentication success

84
00:03:34,080 --> 00:03:40,799
after the authentication is complete its

85
00:03:36,560 --> 00:03:40,799
data including commands are exchanged

86
00:03:42,159 --> 00:03:45,679
next the communication between the

87
00:03:43,760 --> 00:03:48,480
quasar 1.4 client

88
00:03:45,680 --> 00:03:50,000
and the server goes like this unlike

89
00:03:48,480 --> 00:03:52,959
quasar 1.3

90
00:03:50,000 --> 00:03:54,560
in 1.4 authentication will use qrs

91
00:03:52,959 --> 00:03:57,200
handshake

92
00:03:54,560 --> 00:04:01,840
after the tls handshake is completed

93
00:03:57,200 --> 00:04:01,839
data including commands are exchanged

94
00:04:02,239 --> 00:04:05,519
next let's take a look at the quasar

95
00:04:04,159 --> 00:04:07,840
configuration

96
00:04:05,519 --> 00:04:09,280
the first one is x-rays but this one

97
00:04:07,840 --> 00:04:12,560
encrypts the configuration

98
00:04:09,280 --> 00:04:15,519
using as and basic c4

99
00:04:12,560 --> 00:04:19,040
the asd user md5 has value of the key as

100
00:04:15,519 --> 00:04:19,040
well as the communication methods

101
00:04:20,079 --> 00:04:23,520
the next one is quasa and like the

102
00:04:22,400 --> 00:04:26,638
communication method

103
00:04:23,520 --> 00:04:27,919
hmac is used here as well the method of

104
00:04:26,639 --> 00:04:30,800
generating asg

105
00:04:27,919 --> 00:04:34,960
also has been changed from md5 has value

106
00:04:30,800 --> 00:04:34,960
to a method using pvk dxc

107
00:04:36,000 --> 00:04:40,000
here is a list of configuration in

108
00:04:38,400 --> 00:04:42,400
extract there are ports

109
00:04:40,000 --> 00:04:43,440
and enable uac exploration configuration

110
00:04:42,400 --> 00:04:46,560
value

111
00:04:43,440 --> 00:04:48,240
but after quesa 1.0 they have been

112
00:04:46,560 --> 00:04:50,639
removed

113
00:04:48,240 --> 00:04:53,120
also in quasar 1.4 some new

114
00:04:50,639 --> 00:04:55,199
configuration value related to tls

115
00:04:53,120 --> 00:04:56,320
tls communication such as the server

116
00:04:55,199 --> 00:05:00,160
signature and

117
00:04:56,320 --> 00:05:00,159
server certificate have been added

118
00:05:01,600 --> 00:05:04,880
next let's take a look at the quasar

119
00:05:03,440 --> 00:05:06,960
commands

120
00:05:04,880 --> 00:05:08,320
increaser each command is defined with

121
00:05:06,960 --> 00:05:10,320
typo

122
00:05:08,320 --> 00:05:13,919
and the command set is built using the

123
00:05:10,320 --> 00:05:13,919
commands defined in typo

124
00:05:15,280 --> 00:05:18,559
a decoded creator traffic will look like

125
00:05:17,600 --> 00:05:20,320
this

126
00:05:18,560 --> 00:05:22,800
the command will be sent in one byte

127
00:05:20,320 --> 00:05:24,320
format and depend on the command number

128
00:05:22,800 --> 00:05:28,080
the corresponding command from the

129
00:05:24,320 --> 00:05:28,080
command set will be executed

130
00:05:29,039 --> 00:05:34,800
here is a list of commands we can see

131
00:05:31,360 --> 00:05:34,800
that there are various commands

132
00:05:36,560 --> 00:05:41,280
next we would like to introduce to kaza

133
00:05:38,800 --> 00:05:41,280
family

134
00:05:41,600 --> 00:05:46,160
there are so many variant routes in

135
00:05:43,199 --> 00:05:49,280
quasar there are two main type of

136
00:05:46,160 --> 00:05:51,199
projects a clone project

137
00:05:49,280 --> 00:05:52,880
in which some features are added to the

138
00:05:51,199 --> 00:05:54,639
original quiz

139
00:05:52,880 --> 00:05:58,960
and the default project in which the

140
00:05:54,639 --> 00:05:58,960
communication method of phrases are used

141
00:06:00,400 --> 00:06:03,599
here is a list of queso family there are

142
00:06:02,800 --> 00:06:05,440
various slots

143
00:06:03,600 --> 00:06:07,840
out there but they all have

144
00:06:05,440 --> 00:06:10,960
configuration or communication methods

145
00:06:07,840 --> 00:06:12,638
that are consistent with quasar

146
00:06:10,960 --> 00:06:15,440
let's take a look at the summarize of

147
00:06:12,639 --> 00:06:15,440
casa family

148
00:06:17,199 --> 00:06:20,479
first you'd like to look at the

149
00:06:19,199 --> 00:06:23,280
expectora

150
00:06:20,479 --> 00:06:26,240
expectra is using brazil to see the

151
00:06:23,280 --> 00:06:28,719
credential of financial institutions

152
00:06:26,240 --> 00:06:34,319
if we check the configuration we can see

153
00:06:28,720 --> 00:06:35,039
that it's very similar to quasar on this

154
00:06:34,319 --> 00:06:37,520
slide

155
00:06:35,039 --> 00:06:39,199
you could find the command on of x

156
00:06:37,520 --> 00:06:41,919
spectra on the left hand

157
00:06:39,199 --> 00:06:43,440
and the quasar on the right hand most of

158
00:06:41,919 --> 00:06:47,120
the commands in expectra

159
00:06:43,440 --> 00:06:51,039
match with quasar however

160
00:06:47,120 --> 00:06:51,039
few unique commands have been added

161
00:06:52,000 --> 00:06:56,720
next is a lot called golden addition

162
00:06:54,880 --> 00:06:59,680
this one is created by using the

163
00:06:56,720 --> 00:06:59,680
original source code

164
00:07:00,000 --> 00:07:03,680
if we look at the total detection result

165
00:07:02,319 --> 00:07:07,039
forward edition

166
00:07:03,680 --> 00:07:09,199
we can see that it's accepted as quasar

167
00:07:07,039 --> 00:07:10,318
also we look at the version in the

168
00:07:09,199 --> 00:07:13,680
configuration

169
00:07:10,319 --> 00:07:17,680
it has been claimed 1.4.0 since

170
00:07:13,680 --> 00:07:21,680
original had released

171
00:07:17,680 --> 00:07:21,680
next let's look at the generator

172
00:07:22,080 --> 00:07:26,639
if you look at generat server you see

173
00:07:24,479 --> 00:07:29,599
the icon and texture have been changed

174
00:07:26,639 --> 00:07:30,080
compared to the gui of the quasar server

175
00:07:29,599 --> 00:07:32,639
however

176
00:07:30,080 --> 00:07:35,280
the main features of china are unchanged

177
00:07:32,639 --> 00:07:35,280
from hazard

178
00:07:36,720 --> 00:07:41,280
next let's take a look at the venom

179
00:07:38,639 --> 00:07:41,759
route abnormality is advertised on

180
00:07:41,280 --> 00:07:44,559
hacking

181
00:07:41,759 --> 00:07:47,680
program and elsewhere and is sold with a

182
00:07:44,560 --> 00:07:47,680
monthly subscription

183
00:07:48,319 --> 00:07:51,680
when comparing the commands of venomous

184
00:07:50,560 --> 00:07:54,479
and paisa

185
00:07:51,680 --> 00:07:55,440
most commands are common however there

186
00:07:54,479 --> 00:07:58,479
are some additional

187
00:07:55,440 --> 00:07:59,759
unique features such as a commands for

188
00:07:58,479 --> 00:08:04,400
installing rdp

189
00:07:59,759 --> 00:08:04,400
vnc ceiling credential and so on

190
00:08:05,759 --> 00:08:10,160
next let's take a look at the

191
00:08:07,360 --> 00:08:10,160
asynchronous

192
00:08:10,319 --> 00:08:14,639
asynchronous is using the number of

193
00:08:12,080 --> 00:08:16,960
attacks and we have seen case of attacks

194
00:08:14,639 --> 00:08:18,400
if you look at the top ten that reported

195
00:08:16,960 --> 00:08:22,479
weekly by any round

196
00:08:18,400 --> 00:08:22,479
asynchronous open ranks in the top 10.

197
00:08:22,960 --> 00:08:27,198
asynchronous has its open implementation

198
00:08:25,919 --> 00:08:30,240
but it's a use the same

199
00:08:27,199 --> 00:08:32,000
same communication method as quasar

200
00:08:30,240 --> 00:08:34,560
comparing the source code you can see

201
00:08:32,000 --> 00:08:37,279
that the aes 256 short value

202
00:08:34,559 --> 00:08:39,679
used in async cloud is exactly the same

203
00:08:37,279 --> 00:08:41,679
as the quest value

204
00:08:39,679 --> 00:08:44,880
also the communication format is the

205
00:08:41,679 --> 00:08:44,880
same as increaser

206
00:08:45,839 --> 00:08:52,240
finally lets me introduce to godrank

207
00:08:49,920 --> 00:08:53,199
if you look up redraft on theta and

208
00:08:52,240 --> 00:08:55,440
other side

209
00:08:53,200 --> 00:08:58,160
it has been reported that it's actually

210
00:08:55,440 --> 00:09:00,560
using attacks

211
00:08:58,160 --> 00:09:01,920
with is based on the compiled code since

212
00:09:00,560 --> 00:09:04,959
there is no source code

213
00:09:01,920 --> 00:09:05,439
but we can see that the as256 search

214
00:09:04,959 --> 00:09:09,279
value

215
00:09:05,440 --> 00:09:13,120
is used in void route as in asian glass

216
00:09:09,279 --> 00:09:13,120
it's an exact match to quesa

217
00:09:14,399 --> 00:09:17,600
from this section i would like to show

218
00:09:16,720 --> 00:09:19,920
two apt

219
00:09:17,600 --> 00:09:23,040
cases that use quasar for their

220
00:09:19,920 --> 00:09:26,079
attacking campaign in recent days

221
00:09:23,040 --> 00:09:28,640
the apt actor uses open source rep in

222
00:09:26,080 --> 00:09:28,640
general

223
00:09:29,680 --> 00:09:33,279
this table shows the campaign that uses

224
00:09:32,560 --> 00:09:36,319
quasar red

225
00:09:33,279 --> 00:09:38,240
for their attacks from this table

226
00:09:36,320 --> 00:09:39,600
you could find that quasar is a

227
00:09:38,240 --> 00:09:43,279
well-known soul

228
00:09:39,600 --> 00:09:47,680
for apd actors most actors

229
00:09:43,279 --> 00:09:51,120
use the quasar as is for their attacks

230
00:09:47,680 --> 00:09:51,680
on the other hand apt 10 uses the custom

231
00:09:51,120 --> 00:09:54,959
version

232
00:09:51,680 --> 00:09:58,239
of quasar we will show the detail

233
00:09:54,959 --> 00:09:58,239
from the next slides

234
00:09:59,680 --> 00:10:02,839
the first case we introduce is the case

235
00:10:02,480 --> 00:10:05,880
of

236
00:10:02,839 --> 00:10:09,120
apt-33 in the case of

237
00:10:05,880 --> 00:10:12,720
apt-33 they use quasar as

238
00:10:09,120 --> 00:10:13,839
is for their campaign let's dive into

239
00:10:12,720 --> 00:10:18,880
the configuration

240
00:10:13,839 --> 00:10:21,040
they set for quasar client

241
00:10:18,880 --> 00:10:22,800
here is the dump result of quasar

242
00:10:21,040 --> 00:10:24,880
configuration

243
00:10:22,800 --> 00:10:25,839
we dumped this configuration with our

244
00:10:24,880 --> 00:10:29,200
oss tool

245
00:10:25,839 --> 00:10:31,839
welcome scan from this result

246
00:10:29,200 --> 00:10:32,240
you could find that the default value is

247
00:10:31,839 --> 00:10:35,200
set

248
00:10:32,240 --> 00:10:35,200
in the tag field

249
00:10:35,519 --> 00:10:40,160
and use the default log directory name

250
00:10:40,560 --> 00:10:45,119
uses default install subdirectory and

251
00:10:43,519 --> 00:10:48,000
install name

252
00:10:45,120 --> 00:10:49,279
the only modified point is set the

253
00:10:48,000 --> 00:10:53,040
startup name

254
00:10:49,279 --> 00:10:53,040
into their original strings

255
00:10:54,560 --> 00:11:00,880
most attackers use the quizer as is

256
00:10:57,839 --> 00:11:01,519
and use the default configuration it

257
00:11:00,880 --> 00:11:04,079
means

258
00:11:01,519 --> 00:11:05,279
that it makes it easy to detect or hunt

259
00:11:04,079 --> 00:11:08,239
the payload

260
00:11:05,279 --> 00:11:10,000
however it also makes it challenging to

261
00:11:08,240 --> 00:11:15,200
determine the attribution

262
00:11:10,000 --> 00:11:19,200
only using configuration

263
00:11:15,200 --> 00:11:22,399
let's move on to the case of abd10

264
00:11:19,200 --> 00:11:22,959
apd-10 wraps their payload with multiple

265
00:11:22,399 --> 00:11:26,160
packer

266
00:11:22,959 --> 00:11:29,279
layers like matroshka

267
00:11:26,160 --> 00:11:30,880
from there for their persistence they

268
00:11:29,279 --> 00:11:33,279
registered their payload

269
00:11:30,880 --> 00:11:36,320
as a service that executes a custom

270
00:11:33,279 --> 00:11:36,320
quasar loader

271
00:11:37,680 --> 00:11:40,719
quizzer loader reads the encrypted

272
00:11:39,839 --> 00:11:43,839
payload

273
00:11:40,720 --> 00:11:46,320
and unpack it into the memory

274
00:11:43,839 --> 00:11:47,200
this loader exports the external

275
00:11:46,320 --> 00:11:50,480
function

276
00:11:47,200 --> 00:11:52,800
and it decrypts the payload with aescpc

277
00:11:50,480 --> 00:11:52,800
mode

278
00:11:54,160 --> 00:11:59,040
the file path shown on the slide is one

279
00:11:56,959 --> 00:12:02,479
of the samples the actor puts

280
00:11:59,040 --> 00:12:02,480
the encrypted payload

281
00:12:04,560 --> 00:12:08,160
customized apd-10 quasar has several

282
00:12:07,600 --> 00:12:11,360
unique

283
00:12:08,160 --> 00:12:12,560
features there are two new configuration

284
00:12:11,360 --> 00:12:15,600
keys

285
00:12:12,560 --> 00:12:16,880
different encryption algorithms new

286
00:12:15,600 --> 00:12:20,240
commands

287
00:12:16,880 --> 00:12:25,200
a new error log recorder and

288
00:12:20,240 --> 00:12:27,600
a modified communication protocol

289
00:12:25,200 --> 00:12:29,360
this figure shows the difference of

290
00:12:27,600 --> 00:12:32,480
configuration keys

291
00:12:29,360 --> 00:12:35,839
between abd10 quasar and

292
00:12:32,480 --> 00:12:39,839
original quizzer you can find that

293
00:12:35,839 --> 00:12:39,839
two keys are added

294
00:12:40,560 --> 00:12:46,000
download url and proxy have been added

295
00:12:43,839 --> 00:12:49,200
to the configuration

296
00:12:46,000 --> 00:12:51,839
we think the customization is supposed

297
00:12:49,200 --> 00:12:52,959
to use quasar and the network with a

298
00:12:51,839 --> 00:12:57,519
proxy server

299
00:12:52,959 --> 00:12:57,518
such as an enterprise network

300
00:12:58,800 --> 00:13:02,319
here is the dump quasar configuration

301
00:13:01,120 --> 00:13:06,399
that has been used

302
00:13:02,320 --> 00:13:10,560
in the apt-10 campaign

303
00:13:06,399 --> 00:13:10,560
the value of tag is the default

304
00:13:11,440 --> 00:13:14,480
the value of subdirectory and startup

305
00:13:14,000 --> 00:13:17,279
key

306
00:13:14,480 --> 00:13:17,279
is the default

307
00:13:17,920 --> 00:13:22,959
and value of log directory name is

308
00:13:20,399 --> 00:13:22,959
default

309
00:13:23,040 --> 00:13:26,240
the only changed key is the value of

310
00:13:25,600 --> 00:13:30,079
reconnect

311
00:13:26,240 --> 00:13:33,440
delay from default the default value

312
00:13:30,079 --> 00:13:34,000
is 3 seconds but here they said 34

313
00:13:33,440 --> 00:13:37,360
seconds

314
00:13:34,000 --> 00:13:37,360
for the reconnection delay

315
00:13:39,040 --> 00:13:43,120
apt-cam also uses a different encryption

316
00:13:42,320 --> 00:13:46,320
algorithm

317
00:13:43,120 --> 00:13:49,519
to decrypt the configuration payload

318
00:13:46,320 --> 00:13:54,000
the original quasar uses aes with

319
00:13:49,519 --> 00:13:58,079
cbc mode however in the apd-10 quasar

320
00:13:54,000 --> 00:13:58,079
it uses cfd mode

321
00:13:59,360 --> 00:14:05,360
also they have disabled several commands

322
00:14:02,560 --> 00:14:06,319
and added two new commands to plugin

323
00:14:05,360 --> 00:14:09,519
response

324
00:14:06,320 --> 00:14:09,519
and do plugin

325
00:14:10,480 --> 00:14:14,079
do plugin commands loads the plugin

326
00:14:12,959 --> 00:14:17,199
module

327
00:14:14,079 --> 00:14:20,719
and to do plugin response delete

328
00:14:17,199 --> 00:14:23,199
the added plugin we guess that they

329
00:14:20,720 --> 00:14:24,160
removed functions that cause angst virus

330
00:14:23,199 --> 00:14:27,439
section

331
00:14:24,160 --> 00:14:29,519
such as keylogger and replaced it

332
00:14:27,440 --> 00:14:31,839
as a plugin to make it difficult to

333
00:14:29,519 --> 00:14:31,839
detect

334
00:14:33,440 --> 00:14:37,199
they also added an error logging

335
00:14:35,440 --> 00:14:40,000
function

336
00:14:37,199 --> 00:14:41,839
the path of the log file has hard coded

337
00:14:40,000 --> 00:14:44,959
in the source code

338
00:14:41,839 --> 00:14:48,240
so you can use this path as an ioc

339
00:14:44,959 --> 00:14:48,239
for your threat hunting

340
00:14:49,519 --> 00:14:53,839
the communication protocol has been also

341
00:14:51,760 --> 00:14:56,160
modified

342
00:14:53,839 --> 00:14:57,199
they have added a simple xor code

343
00:14:56,160 --> 00:15:00,800
encoding method

344
00:14:57,199 --> 00:15:03,199
to encode the communication payload

345
00:15:00,800 --> 00:15:04,079
also they have changed the aes

346
00:15:03,199 --> 00:15:09,279
encryption

347
00:15:04,079 --> 00:15:09,279
mode from cbc to cfb

348
00:15:11,040 --> 00:15:17,439
okay from this section we will show

349
00:15:14,240 --> 00:15:18,320
share the result of the activity active

350
00:15:17,440 --> 00:15:21,760
probing

351
00:15:18,320 --> 00:15:26,399
of quasar c2 and the points to hunt

352
00:15:21,760 --> 00:15:29,759
malware family seeds

353
00:15:26,399 --> 00:15:31,040
you can hand quasar family c2 with virus

354
00:15:29,759 --> 00:15:34,160
total

355
00:15:31,040 --> 00:15:37,199
iot search engines such as shoden

356
00:15:34,160 --> 00:15:39,519
census or fosa

357
00:15:37,199 --> 00:15:40,240
and whole internet scanning with an

358
00:15:39,519 --> 00:15:43,600
original

359
00:15:40,240 --> 00:15:46,480
scanner let's see how to hunt quizzer

360
00:15:43,600 --> 00:15:46,480
family situ

361
00:15:47,440 --> 00:15:54,800
first let's check the latest quasar 1.4

362
00:15:51,759 --> 00:15:56,639
to hunt the latest version of quasar c2

363
00:15:54,800 --> 00:15:59,040
you only need to check the tls

364
00:15:56,639 --> 00:16:02,720
certification issuer

365
00:15:59,040 --> 00:16:08,480
if the actor uses the default connect

366
00:16:02,720 --> 00:16:11,440
tls session and check the user name

367
00:16:08,480 --> 00:16:12,000
let's search the issuer strings creator

368
00:16:11,440 --> 00:16:16,000
server

369
00:16:12,000 --> 00:16:18,399
ca with the iot search engines

370
00:16:16,000 --> 00:16:19,519
you could find the c2 server with just

371
00:16:18,399 --> 00:16:23,279
few operations

372
00:16:19,519 --> 00:16:25,759
on iot search engines these iot search

373
00:16:23,279 --> 00:16:30,720
engines make it easy to find cto for

374
00:16:25,759 --> 00:16:30,720
us let's thanks to these search engines

375
00:16:31,839 --> 00:16:39,120
let's move on to the crazer family c2

376
00:16:35,600 --> 00:16:43,519
there are several kinds of quasar family

377
00:16:39,120 --> 00:16:46,480
however the critical fact is that

378
00:16:43,519 --> 00:16:48,839
all of these family uses the same

379
00:16:46,480 --> 00:16:51,360
communication

380
00:16:48,839 --> 00:16:53,600
method

381
00:16:51,360 --> 00:16:54,480
the first respond packet has two

382
00:16:53,600 --> 00:16:58,399
characteristic

383
00:16:54,480 --> 00:17:03,360
features first is the payload size

384
00:16:58,399 --> 00:17:06,959
the payload has fixed size 0x44

385
00:17:03,360 --> 00:17:10,559
the second is tcp payload header

386
00:17:06,959 --> 00:17:13,679
this header is always b0x40

387
00:17:10,559 --> 00:17:19,439
with triple nodes you could detect

388
00:17:13,679 --> 00:17:21,839
the c2 server with these two signatures

389
00:17:19,439 --> 00:17:22,799
this diagram shows the initial tcp

390
00:17:21,839 --> 00:17:26,079
negotiation

391
00:17:22,799 --> 00:17:28,319
between the server and the client

392
00:17:26,079 --> 00:17:29,280
if you want to scan cto servers on the

393
00:17:28,319 --> 00:17:32,000
network

394
00:17:29,280 --> 00:17:33,600
all you need to do is create a create a

395
00:17:32,000 --> 00:17:36,400
tcp session

396
00:17:33,600 --> 00:17:37,439
we read the first response payload and

397
00:17:36,400 --> 00:17:40,480
check the size

398
00:17:37,440 --> 00:17:43,039
and the header that's it

399
00:17:40,480 --> 00:17:44,640
the first point to find the c2 server is

400
00:17:43,039 --> 00:17:47,679
finding out the characteristic

401
00:17:44,640 --> 00:17:51,600
features such as tls search name

402
00:17:47,679 --> 00:17:54,000
or payload or payload size

403
00:17:51,600 --> 00:17:55,039
these findings makes it easy to find the

404
00:17:54,000 --> 00:17:57,440
c2 server

405
00:17:55,039 --> 00:17:59,280
or detect rap communications in your

406
00:17:57,440 --> 00:18:02,640
network

407
00:17:59,280 --> 00:18:04,160
the second point is

408
00:18:02,640 --> 00:18:06,960
that find the characteristic

409
00:18:04,160 --> 00:18:10,320
communication in the lower layer like as

410
00:18:06,960 --> 00:18:11,679
tcp if you use a higher layer like an

411
00:18:10,320 --> 00:18:14,879
application layer

412
00:18:11,679 --> 00:18:16,799
the cost to search c2 will increase and

413
00:18:14,880 --> 00:18:19,360
scaling out the scanning will be more

414
00:18:16,799 --> 00:18:19,360
difficult

415
00:18:20,559 --> 00:18:24,160
here is the result of showing search in

416
00:18:23,440 --> 00:18:27,120
this case

417
00:18:24,160 --> 00:18:28,640
we use the payroll size and header for

418
00:18:27,120 --> 00:18:31,600
the search query

419
00:18:28,640 --> 00:18:33,280
at this time we were able to find four

420
00:18:31,600 --> 00:18:36,959
quizer family servers

421
00:18:33,280 --> 00:18:36,960
that were running in japan

422
00:18:37,760 --> 00:18:42,720
and here is the result of our whole

423
00:18:40,880 --> 00:18:45,360
internet scan

424
00:18:42,720 --> 00:18:46,240
76 active quizzes servers were

425
00:18:45,360 --> 00:18:50,240
discovered

426
00:18:46,240 --> 00:18:51,760
in november 2020 equator server number

427
00:18:50,240 --> 00:18:54,799
was not so large

428
00:18:51,760 --> 00:18:58,400
but we suspect that several campaigns

429
00:18:54,799 --> 00:19:01,520
are still undergoing we believe that

430
00:18:58,400 --> 00:19:02,799
this host data will be useful not only

431
00:19:01,520 --> 00:19:10,559
for researchers

432
00:19:02,799 --> 00:19:13,360
but also for blue teams finally

433
00:19:10,559 --> 00:19:16,240
let me introduce the quiz analysis tools

434
00:19:13,360 --> 00:19:16,240
we have released

435
00:19:16,720 --> 00:19:20,720
we published four analysis tools on

436
00:19:19,520 --> 00:19:23,200
github

437
00:19:20,720 --> 00:19:25,520
after this slide i will introduce these

438
00:19:23,200 --> 00:19:28,559
tools

439
00:19:25,520 --> 00:19:29,039
first microscan is a quantity program

440
00:19:28,559 --> 00:19:31,520
that

441
00:19:29,039 --> 00:19:32,720
extracts configuration data of known

442
00:19:31,520 --> 00:19:35,679
marvel

443
00:19:32,720 --> 00:19:37,600
these two searches for mario such as

444
00:19:35,679 --> 00:19:41,360
quasar in memory image

445
00:19:37,600 --> 00:19:44,639
and dumps configuration data

446
00:19:41,360 --> 00:19:46,959
if molecules can find a quasar in memory

447
00:19:44,640 --> 00:19:49,520
the configuration data will be dumped

448
00:19:46,960 --> 00:19:49,520
like this

449
00:19:51,039 --> 00:19:57,520
next question.decode.py

450
00:19:54,880 --> 00:19:58,559
this script can encode and decode

451
00:19:57,520 --> 00:20:01,840
quizzer config

452
00:19:58,559 --> 00:20:04,720
communications when running

453
00:20:01,840 --> 00:20:05,678
it needs a decode key and only module

454
00:20:04,720 --> 00:20:08,480
1.3

455
00:20:05,679 --> 00:20:08,480
is supported

456
00:20:09,840 --> 00:20:16,439
next quarterly panel.py

457
00:20:13,919 --> 00:20:17,600
this script is damaged that

458
00:20:16,440 --> 00:20:20,960
communications

459
00:20:17,600 --> 00:20:24,320
with quasar client for

460
00:20:20,960 --> 00:20:27,039
custom quizzes such as mpd 10

461
00:20:24,320 --> 00:20:29,360
this script is useful because the

462
00:20:27,039 --> 00:20:32,640
photoshop panel does not support the

463
00:20:29,360 --> 00:20:32,639
custom query

464
00:20:33,679 --> 00:20:40,799
finally create alert client dot py

465
00:20:37,919 --> 00:20:42,320
this python script client that

466
00:20:40,799 --> 00:20:45,520
communications with

467
00:20:42,320 --> 00:20:49,280
quasar shi2 memory is

468
00:20:45,520 --> 00:20:52,400
connected to c2 it will be controlled

469
00:20:49,280 --> 00:20:55,120
of the host by the talker but

470
00:20:52,400 --> 00:20:55,840
this script can safely monitor the

471
00:20:55,120 --> 00:20:59,120
commands

472
00:20:55,840 --> 00:20:59,120
sent by the target

473
00:21:01,039 --> 00:21:05,840
in this example you can see that the

474
00:21:04,240 --> 00:21:08,880
attacker sender

475
00:21:05,840 --> 00:21:08,879
from my command

476
00:21:11,200 --> 00:21:14,720
let's talk about how to counter type the

477
00:21:13,679 --> 00:21:19,280
quasar sheets

478
00:21:14,720 --> 00:21:19,280
using the tools i just introduced

479
00:21:20,080 --> 00:21:28,158
quizlet crab.py has a current option

480
00:21:24,799 --> 00:21:32,799
you can you can clone many equation

481
00:21:28,159 --> 00:21:32,799
client by using the current option

482
00:21:34,240 --> 00:21:37,679
you can connect many fake current and

483
00:21:36,480 --> 00:21:45,520
stock sheet 2

484
00:21:37,679 --> 00:21:48,799
like this in this example

485
00:21:45,520 --> 00:21:52,639
you can the

486
00:21:48,799 --> 00:21:59,840
fake client operating system is

487
00:21:52,640 --> 00:21:59,840
android ios or macos

488
00:22:00,240 --> 00:22:04,000
let's move on to demonstration

489
00:22:05,840 --> 00:22:12,639
first i would like to execute with the

490
00:22:08,880 --> 00:22:16,400
encryption key and count option

491
00:22:12,640 --> 00:22:18,640
if the encryption key is correct c2 will

492
00:22:16,400 --> 00:22:20,960
allow the fake client to access like

493
00:22:18,640 --> 00:22:20,960
this

494
00:22:21,120 --> 00:22:26,080
cradle sheet does not check the

495
00:22:23,039 --> 00:22:29,760
information received from the client

496
00:22:26,080 --> 00:22:32,158
so it can be spoofed or used for

497
00:22:29,760 --> 00:22:32,158
talks

498
00:22:36,240 --> 00:22:41,679
all of the tools introduced published in

499
00:22:39,360 --> 00:22:44,479
jp start github registry

500
00:22:41,679 --> 00:22:47,440
please check out our github registry for

501
00:22:44,480 --> 00:22:47,440
my information

502
00:22:48,159 --> 00:22:55,039
i'd like to wrap up today's talks first

503
00:22:51,760 --> 00:22:55,360
we talk how the variant was created from

504
00:22:55,039 --> 00:22:59,200
the

505
00:22:55,360 --> 00:23:02,000
open source quarter second

506
00:22:59,200 --> 00:23:03,760
we introduced detailed analysis results

507
00:23:02,000 --> 00:23:06,640
such as

508
00:23:03,760 --> 00:23:07,360
configuration data and communication

509
00:23:06,640 --> 00:23:11,760
protocol

510
00:23:07,360 --> 00:23:14,760
or of crazy and family

511
00:23:11,760 --> 00:23:16,400
finally we talked how to find the

512
00:23:14,760 --> 00:23:19,919
question with

513
00:23:16,400 --> 00:23:23,840
iot search engine service or broadcast

514
00:23:19,919 --> 00:23:23,840
internet scan

515
00:23:24,559 --> 00:23:29,600
this is the end of our presentation we

516
00:23:27,520 --> 00:23:30,000
are pleasing to give us an opportunity

517
00:23:29,600 --> 00:23:33,360
to

518
00:23:30,000 --> 00:23:36,640
talk at vodka and thank you for watching

519
00:23:33,360 --> 00:23:38,719
our talk

520
00:23:36,640 --> 00:23:38,720
you

