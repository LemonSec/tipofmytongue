1
00:00:00,000 --> 00:00:06,420
okay good morning right into right on

2
00:00:06,420 --> 00:00:10,200
time and right into the topic crypto

3
00:00:10,200 --> 00:00:11,910
well this morning with a unit and

4
00:00:11,910 --> 00:00:16,199
clients ma yeah you have the floor all

5
00:00:16,199 --> 00:00:18,180
right before I start on Krypto a quick

6
00:00:18,180 --> 00:00:20,070
update on pom woke up we actually pissed

7
00:00:20,070 --> 00:00:21,270
them off apparently because they're now

8
00:00:21,270 --> 00:00:23,340
d dancing to single the singles now down

9
00:00:23,340 --> 00:00:25,439
so if you're receiving reports it will

10
00:00:25,439 --> 00:00:28,380
be down for some time so I'm going to be

11
00:00:28,380 --> 00:00:31,050
talking about crypto all but mostly what

12
00:00:31,050 --> 00:00:32,579
this top will be is looking into the

13
00:00:32,579 --> 00:00:33,840
history of these guys so what they've

14
00:00:33,840 --> 00:00:36,090
been doing over all these years because

15
00:00:36,090 --> 00:00:38,399
I know a lot of people are looking at

16
00:00:38,399 --> 00:00:40,710
the latest version are looking at three

17
00:00:40,710 --> 00:00:42,629
point 0 a lot of people jumped in on two

18
00:00:42,629 --> 00:00:44,129
point oh but I don't think a lot of

19
00:00:44,129 --> 00:00:45,270
people actually knew what they were

20
00:00:45,270 --> 00:00:49,170
doing before all those versions so I'll

21
00:00:49,170 --> 00:00:52,559
quickly introduce myself first and then

22
00:00:52,559 --> 00:00:54,809
I'll jump into the history immediately

23
00:00:54,809 --> 00:00:55,949
so i'll start off with the first version

24
00:00:55,949 --> 00:00:58,859
i basically explain how this version

25
00:00:58,859 --> 00:01:00,210
work and then from every version i'll

26
00:01:00,210 --> 00:01:01,949
just show the changes so i'm not going

27
00:01:01,949 --> 00:01:03,420
to explain everything for every version

28
00:01:03,420 --> 00:01:05,459
because then we'll need more than 30

29
00:01:05,459 --> 00:01:08,189
minutes but it's just going to be the

30
00:01:08,189 --> 00:01:11,010
single changes and at the end i also

31
00:01:11,010 --> 00:01:12,390
have a sort of a word of caution about

32
00:01:12,390 --> 00:01:16,799
these guys continuing on I'll show the

33
00:01:16,799 --> 00:01:19,470
infrastructure I'll social interesting

34
00:01:19,470 --> 00:01:21,030
discoveries I made while I was

35
00:01:21,030 --> 00:01:23,369
investigating these guys I'll show some

36
00:01:23,369 --> 00:01:25,409
tools I've made which are going to be in

37
00:01:25,409 --> 00:01:27,570
get up and I'm going to thank some

38
00:01:27,570 --> 00:01:30,020
friends who've been sharing samples or

39
00:01:30,020 --> 00:01:33,479
information so i don't think i need

40
00:01:33,479 --> 00:01:35,070
introduction that much i'm a guy with an

41
00:01:35,070 --> 00:01:36,840
opinion so i have twitter that's sort of

42
00:01:36,840 --> 00:01:37,950
the thing if you're on the internet i

43
00:01:37,950 --> 00:01:42,720
have a blog so let's just start so the

44
00:01:42,720 --> 00:01:44,399
first version of crypto wall when they

45
00:01:44,399 --> 00:01:45,659
started they didn't name themselves

46
00:01:45,659 --> 00:01:47,549
scripta wall they were doing something

47
00:01:47,549 --> 00:01:49,380
everybody was doing at the time which is

48
00:01:49,380 --> 00:01:52,079
cloning cryptolocker so there was back

49
00:01:52,079 --> 00:01:54,180
in november two thousand thirteen and

50
00:01:54,180 --> 00:01:56,759
this basically what you were seeing you

51
00:01:56,759 --> 00:01:58,020
know so kind of similar to what

52
00:01:58,020 --> 00:02:00,000
cryptolocker looked at looked like at

53
00:02:00,000 --> 00:02:01,710
the time they only swapped out the logo

54
00:02:01,710 --> 00:02:04,229
slight modification indie GUI because

55
00:02:04,229 --> 00:02:07,079
they couldn't mimic everything you know

56
00:02:07,079 --> 00:02:08,639
but pretty much the same but they

57
00:02:08,639 --> 00:02:09,869
weren't the only ones you know everybody

58
00:02:09,869 --> 00:02:11,220
was doing this kind of stuff you had

59
00:02:11,220 --> 00:02:13,050
tons of these clones

60
00:02:13,050 --> 00:02:17,040
floating around yeah so encryption at

61
00:02:17,040 --> 00:02:19,680
the time they locally generated in RSA

62
00:02:19,680 --> 00:02:22,560
keep keep air with the link rip to the

63
00:02:22,560 --> 00:02:25,380
windows cryptic crypto API files they

64
00:02:25,380 --> 00:02:27,060
would encrypt we were slightly larger

65
00:02:27,060 --> 00:02:28,410
because they added a small tags that he

66
00:02:28,410 --> 00:02:30,900
could find back to files added to check

67
00:02:30,900 --> 00:02:32,460
some hash from the file and what's

68
00:02:32,460 --> 00:02:34,860
decrypted so you could confirm it was

69
00:02:34,860 --> 00:02:36,600
correctly decrypted and it was basically

70
00:02:36,600 --> 00:02:38,880
it so everything is local even the

71
00:02:38,880 --> 00:02:41,750
private key so it's kind of interesting

72
00:02:41,750 --> 00:02:44,760
what they need it to identify system was

73
00:02:44,760 --> 00:02:47,430
like a unique system ID and this is AF

74
00:02:47,430 --> 00:02:49,500
implemented this in the first version so

75
00:02:49,500 --> 00:02:51,390
the clone and it's still used in the

76
00:02:51,390 --> 00:02:53,190
latest versions of the crypto ball four

77
00:02:53,190 --> 00:02:55,740
point oh if you can call it that and

78
00:02:55,740 --> 00:02:57,120
basically it takes it makes like a

79
00:02:57,120 --> 00:02:59,460
string which is a concatenation of a

80
00:02:59,460 --> 00:03:01,560
bunch of information so the computer

81
00:03:01,560 --> 00:03:04,170
name volume serial number processing

82
00:03:04,170 --> 00:03:05,610
information and your operating system

83
00:03:05,610 --> 00:03:07,950
version take a string take the md5 from

84
00:03:07,950 --> 00:03:10,650
this hex notation and that's your unique

85
00:03:10,650 --> 00:03:12,840
identifier for your system basically so

86
00:03:12,840 --> 00:03:14,550
they could identify multiple system

87
00:03:14,550 --> 00:03:18,180
behind single IP communication protocol

88
00:03:18,180 --> 00:03:22,320
really simple just plain HTTP basically

89
00:03:22,320 --> 00:03:24,420
we need when an infection would start it

90
00:03:24,420 --> 00:03:26,370
would report in with like a campaign ID

91
00:03:26,370 --> 00:03:28,380
which nothing more than an identifier so

92
00:03:28,380 --> 00:03:29,850
on their back end they could just filter

93
00:03:29,850 --> 00:03:31,830
on specific campaigns so let's say

94
00:03:31,830 --> 00:03:33,300
something was being spread via email

95
00:03:33,300 --> 00:03:35,100
they would tag it with email one

96
00:03:35,100 --> 00:03:36,630
something was spread by exploit kids

97
00:03:36,630 --> 00:03:38,940
they would tag at explicate one so they

98
00:03:38,940 --> 00:03:40,050
could just know where it was coming from

99
00:03:40,050 --> 00:03:42,000
and possibly what was the most

100
00:03:42,000 --> 00:03:44,850
successful way to spread around so he

101
00:03:44,850 --> 00:03:46,770
checked in with unique system ID what

102
00:03:46,770 --> 00:03:48,390
happened on the back end is it made an

103
00:03:48,390 --> 00:03:50,040
entering the database with this unique

104
00:03:50,040 --> 00:03:53,640
system ID or to see the scenes he

105
00:03:53,640 --> 00:03:55,200
responded you know I've made his entry

106
00:03:55,200 --> 00:03:58,050
it's okay startup declined did another

107
00:03:58,050 --> 00:04:01,080
request and again with his unique system

108
00:04:01,080 --> 00:04:04,170
ID to identify itself and what did what

109
00:04:04,170 --> 00:04:05,580
the scenes he responded was a download

110
00:04:05,580 --> 00:04:08,700
location with a like a kind of our guys

111
00:04:08,700 --> 00:04:10,950
a foul blob and it contains some I do I

112
00:04:10,950 --> 00:04:13,830
stuff and some other resources for the

113
00:04:13,830 --> 00:04:15,799
payment processing their kind of stuff

114
00:04:15,799 --> 00:04:18,000
after it received it and it you know it

115
00:04:18,000 --> 00:04:19,500
did its thing it would just report back

116
00:04:19,500 --> 00:04:21,120
and say everything you know everything's

117
00:04:21,120 --> 00:04:24,900
fine I'm done so if you look at what it

118
00:04:24,900 --> 00:04:26,400
actually looked like on

119
00:04:26,400 --> 00:04:29,759
the wire was just this so you have a

120
00:04:29,759 --> 00:04:31,979
post other words interesting about this

121
00:04:31,979 --> 00:04:34,680
post the location little sis post URL

122
00:04:34,680 --> 00:04:37,919
it's actually a key it's an RC four key

123
00:04:37,919 --> 00:04:39,720
for the rest of the data only they sort

124
00:04:39,720 --> 00:04:41,220
of scrambled it basically what you have

125
00:04:41,220 --> 00:04:42,990
to do is to solve this you just have to

126
00:04:42,990 --> 00:04:45,210
sort it on s key value of the characters

127
00:04:45,210 --> 00:04:47,699
in its path and then you have to correct

128
00:04:47,699 --> 00:04:49,500
RC four key they just scramble it up a

129
00:04:49,500 --> 00:04:51,300
little bit you know inviting it looks

130
00:04:51,300 --> 00:04:55,560
like this pretty simple the data that's

131
00:04:55,560 --> 00:04:57,360
actually in the post request is just

132
00:04:57,360 --> 00:04:59,760
hacks encoded so you decode from the

133
00:04:59,760 --> 00:05:01,830
hacks takes our c4 and I mean you got

134
00:05:01,830 --> 00:05:05,479
your decrypted request in this case so

135
00:05:05,479 --> 00:05:08,449
sort of the same thing I showed on the

136
00:05:08,449 --> 00:05:10,440
other slide you know you're the first

137
00:05:10,440 --> 00:05:11,669
thing if the brackets the first thing

138
00:05:11,669 --> 00:05:14,490
they have is like a unique I can command

139
00:05:14,490 --> 00:05:17,220
number and you get your campaign ID and

140
00:05:17,220 --> 00:05:19,470
then the system ID which which it checks

141
00:05:19,470 --> 00:05:23,250
in in this case the response one more

142
00:05:23,250 --> 00:05:25,289
this gets the response was actually the

143
00:05:25,289 --> 00:05:27,990
Donald location so the file blob also we

144
00:05:27,990 --> 00:05:29,460
know the encryption on this was using

145
00:05:29,460 --> 00:05:30,750
the same key so the client could also

146
00:05:30,750 --> 00:05:34,680
decrypt it pretty simple protocol small

147
00:05:34,680 --> 00:05:37,530
detail of it is that it does a forum

148
00:05:37,530 --> 00:05:40,380
post so form your own coding and the

149
00:05:40,380 --> 00:05:41,909
actual parameter of the data was just

150
00:05:41,909 --> 00:05:44,159
the last or highest value in the key

151
00:05:44,159 --> 00:05:47,430
after it's been sorted so the protocol

152
00:05:47,430 --> 00:05:49,349
itself is actually pretty simple it's

153
00:05:49,349 --> 00:05:50,849
just the curly brackets in between that

154
00:05:50,849 --> 00:05:52,760
the first thing is always the command ID

155
00:05:52,760 --> 00:05:55,020
and the command ID after that you have

156
00:05:55,020 --> 00:05:56,430
data you can see this parameters to

157
00:05:56,430 --> 00:05:58,199
function so the command ID is basically

158
00:05:58,199 --> 00:05:59,940
a function and whatever it comes after

159
00:05:59,940 --> 00:06:01,289
it with the pipe symbols are just

160
00:06:01,289 --> 00:06:04,590
arguments for these functions pretty

161
00:06:04,590 --> 00:06:07,080
simple so I feel look at an example this

162
00:06:07,080 --> 00:06:08,220
is for example the first check-in

163
00:06:08,220 --> 00:06:12,570
machine ever does so command ID 1 it's

164
00:06:12,570 --> 00:06:15,419
just register decline basically so after

165
00:06:15,419 --> 00:06:16,800
that you get your campaign ID in this

166
00:06:16,800 --> 00:06:19,949
case Wolfgang is the campaign ID they

167
00:06:19,949 --> 00:06:21,780
got your unique system ID and which it

168
00:06:21,780 --> 00:06:24,330
checks in after that there's a there's a

169
00:06:24,330 --> 00:06:25,680
number which is basically an index on

170
00:06:25,680 --> 00:06:27,270
the table said it would know which kind

171
00:06:27,270 --> 00:06:29,070
of system you were running you know if

172
00:06:29,070 --> 00:06:31,220
you're a Windows 7 Windows XP when I say

173
00:06:31,220 --> 00:06:34,650
just for identification after that they

174
00:06:34,650 --> 00:06:36,570
did some stuff for their architecture so

175
00:06:36,570 --> 00:06:37,860
we'd know if you're running 32-bit or

176
00:06:37,860 --> 00:06:39,569
64-bit

177
00:06:39,569 --> 00:06:42,119
they also want to know if it was running

178
00:06:42,119 --> 00:06:44,460
elevated so if it had full privileges on

179
00:06:44,460 --> 00:06:46,860
the machine was running on and in the

180
00:06:46,860 --> 00:06:48,330
beginning it also needed the remote IP

181
00:06:48,330 --> 00:06:52,379
address and the reason why that was is

182
00:06:52,379 --> 00:06:54,029
because they're seen see infrastructure

183
00:06:54,029 --> 00:06:56,369
is on tour so you know they don't get

184
00:06:56,369 --> 00:06:58,289
client at peace it's no remote IP

185
00:06:58,289 --> 00:07:00,389
address they can use and the way they

186
00:07:00,389 --> 00:07:02,189
set it up is that they have a proxy

187
00:07:02,189 --> 00:07:03,959
server which is owned by themselves

188
00:07:03,959 --> 00:07:06,209
which is set up by themselves they run

189
00:07:06,209 --> 00:07:08,369
engines on this with privacy and this is

190
00:07:08,369 --> 00:07:09,839
what it does every request this upstream

191
00:07:09,839 --> 00:07:11,789
to the back end which is inside tour

192
00:07:11,789 --> 00:07:13,979
pretty simple setup but if you kick down

193
00:07:13,979 --> 00:07:16,139
that server it would be done for a while

194
00:07:16,139 --> 00:07:18,539
now in the beginning there were actually

195
00:07:18,539 --> 00:07:20,369
in the payment wise if you wanted to

196
00:07:20,369 --> 00:07:22,020
unlock your files there were a lot of

197
00:07:22,020 --> 00:07:24,689
options which was kind of interesting

198
00:07:24,689 --> 00:07:25,770
you know you could pay with money pack

199
00:07:25,770 --> 00:07:28,830
right going you cash they save Bitcoin

200
00:07:28,830 --> 00:07:30,449
as well but you know there was just a

201
00:07:30,449 --> 00:07:34,740
lot so it started with file types this

202
00:07:34,740 --> 00:07:36,990
whole bunch i'm not going to talk about

203
00:07:36,990 --> 00:07:38,759
all of them basically they're just the

204
00:07:38,759 --> 00:07:40,529
file types you would expect to see on a

205
00:07:40,529 --> 00:07:42,539
normal machine of people using documents

206
00:07:42,539 --> 00:07:44,819
their pictures their you know their

207
00:07:44,819 --> 00:07:48,149
music their videos just to catch

208
00:07:48,149 --> 00:07:51,599
whatever would be interesting or vital

209
00:07:51,599 --> 00:07:54,800
to somebody using his machine so a

210
00:07:54,800 --> 00:07:58,199
little bit later february2014 actually

211
00:07:58,199 --> 00:08:01,409
updated they removed the name they went

212
00:08:01,409 --> 00:08:02,969
on to a different name call themself

213
00:08:02,969 --> 00:08:04,860
script of defense this time so that you

214
00:08:04,860 --> 00:08:05,930
know they picked up their own name

215
00:08:05,930 --> 00:08:08,939
ransom notes kind of changed it wasn't a

216
00:08:08,939 --> 00:08:11,699
GUI you know inside the application they

217
00:08:11,699 --> 00:08:12,959
really made their own design of this

218
00:08:12,959 --> 00:08:14,539
it's no more cloning of cryptolocker

219
00:08:14,539 --> 00:08:18,180
that a small text on their singing or

220
00:08:18,180 --> 00:08:22,110
files are is it basically encrypted

221
00:08:22,110 --> 00:08:25,229
using RSA 2048 the ransom notes will be

222
00:08:25,229 --> 00:08:26,399
dropped in every directory where you had

223
00:08:26,399 --> 00:08:28,169
files that were encrypted with how to

224
00:08:28,169 --> 00:08:32,099
decrypt HTML txt URL at the bottom they

225
00:08:32,099 --> 00:08:33,599
explain how you get on the payment

226
00:08:33,599 --> 00:08:35,370
server to get your files back and you

227
00:08:35,370 --> 00:08:36,750
had something that was a personal code

228
00:08:36,750 --> 00:08:38,729
which they call it which is just a way

229
00:08:38,729 --> 00:08:41,250
to get youtube page specifically for

230
00:08:41,250 --> 00:08:44,639
your key to get your files back now one

231
00:08:44,639 --> 00:08:45,810
thing that change from this version is

232
00:08:45,810 --> 00:08:47,970
that the campaign is were not random

233
00:08:47,970 --> 00:08:50,279
worse or that kind of stuff anymore they

234
00:08:50,279 --> 00:08:51,560
were actually

235
00:08:51,560 --> 00:08:52,580
these kind of things so it was death

236
00:08:52,580 --> 00:08:54,740
with some kind of number behind it these

237
00:08:54,740 --> 00:08:56,720
numbers were incremental and between all

238
00:08:56,720 --> 00:08:57,800
these different numbers you could see

239
00:08:57,800 --> 00:08:59,600
small changes in the binary so this is

240
00:08:59,600 --> 00:09:01,820
just development this is just version

241
00:09:01,820 --> 00:09:03,710
tracking in development of Terran mallar

242
00:09:03,710 --> 00:09:07,279
base t or ransomware this case so slight

243
00:09:07,279 --> 00:09:10,010
change so the red stuff went away which

244
00:09:10,010 --> 00:09:12,860
was the GUI blocking retrieved the first

245
00:09:12,860 --> 00:09:14,870
part is still same it needs to check in

246
00:09:14,870 --> 00:09:18,500
with a unique system ID but what changed

247
00:09:18,500 --> 00:09:21,140
is it now sent away deprived key so the

248
00:09:21,140 --> 00:09:22,940
scenes to serve for now would have the

249
00:09:22,940 --> 00:09:24,440
private key instead of it being still on

250
00:09:24,440 --> 00:09:26,210
the system the server would acknowledge

251
00:09:26,210 --> 00:09:28,130
that the client send the key and it

252
00:09:28,130 --> 00:09:30,260
would purport in how many files had

253
00:09:30,260 --> 00:09:33,440
actually encrypted on the system so net

254
00:09:33,440 --> 00:09:35,360
were wise small change it was an extra

255
00:09:35,360 --> 00:09:36,980
post request you saw some data in there

256
00:09:36,980 --> 00:09:38,990
and quite at least you see some

257
00:09:38,990 --> 00:09:43,690
artifacts dars a file blob basically so

258
00:09:43,690 --> 00:09:45,860
what's kind of interesting the way to

259
00:09:45,860 --> 00:09:47,420
implement this they use the legacy

260
00:09:47,420 --> 00:09:49,940
crypto API from windows and basically

261
00:09:49,940 --> 00:09:52,790
the decrypt apic speech stores keys you

262
00:09:52,790 --> 00:09:55,550
generate in your profile they have like

263
00:09:55,550 --> 00:09:57,350
a certificate management key management

264
00:09:57,350 --> 00:09:59,780
but did you know it's sort of private

265
00:09:59,780 --> 00:10:01,760
key on the system again so a copy would

266
00:10:01,760 --> 00:10:04,580
stay and people might the tool for this

267
00:10:04,580 --> 00:10:06,410
people were decrypting is so nice you

268
00:10:06,410 --> 00:10:08,870
know you could help victims and at some

269
00:10:08,870 --> 00:10:11,839
point semantic published about this and

270
00:10:11,839 --> 00:10:13,400
less than 24 hours and they had a fixed

271
00:10:13,400 --> 00:10:16,550
so they you know they pay attention to

272
00:10:16,550 --> 00:10:18,890
what's being published about them and

273
00:10:18,890 --> 00:10:21,080
with this flaw basically they fixed it

274
00:10:21,080 --> 00:10:23,000
they move the name they trusted name

275
00:10:23,000 --> 00:10:24,560
because you know it was bad people knew

276
00:10:24,560 --> 00:10:25,850
you could decrypt it so they went on

277
00:10:25,850 --> 00:10:27,620
they call themselves scriptable one

278
00:10:27,620 --> 00:10:31,160
point 0 and it was in March 2014 so

279
00:10:31,160 --> 00:10:34,550
pretty quickly campaign IDs changed

280
00:10:34,550 --> 00:10:36,650
again instead of death from crypt of

281
00:10:36,650 --> 00:10:39,440
defense and now is CW again version

282
00:10:39,440 --> 00:10:41,420
numbers would be incremental you would

283
00:10:41,420 --> 00:10:43,820
see slight changes and you could also

284
00:10:43,820 --> 00:10:45,080
see they were experimenting with some

285
00:10:45,080 --> 00:10:46,970
stuff so there were some tour versions

286
00:10:46,970 --> 00:10:49,070
and campaigns and these versions would

287
00:10:49,070 --> 00:10:51,110
actually talk on tour directly so no

288
00:10:51,110 --> 00:10:52,640
more proxy servers it would directly

289
00:10:52,640 --> 00:10:54,830
connect on to tour and they also made a

290
00:10:54,830 --> 00:10:56,930
CW 404 there were no changes they

291
00:10:56,930 --> 00:10:58,339
probably just there was a funny

292
00:10:58,339 --> 00:11:02,330
complaint ID to use again some slight

293
00:11:02,330 --> 00:11:04,579
ransom note updates

294
00:11:04,579 --> 00:11:07,589
major thing blew some small cosmetic

295
00:11:07,589 --> 00:11:09,750
changes now says all of your files are

296
00:11:09,750 --> 00:11:13,589
protected with strong encryption what

297
00:11:13,589 --> 00:11:15,389
encryption also changed so instead of

298
00:11:15,389 --> 00:11:17,820
generating anything locally it would

299
00:11:17,820 --> 00:11:20,040
actually request a public key from ours

300
00:11:20,040 --> 00:11:22,170
a public/private key pair from the C&C

301
00:11:22,170 --> 00:11:23,970
server so no more private key on your

302
00:11:23,970 --> 00:11:27,990
system so again small change in their

303
00:11:27,990 --> 00:11:31,260
protocol first things still the same it

304
00:11:31,260 --> 00:11:32,730
has to check in the surface technology

305
00:11:32,730 --> 00:11:34,980
client existed instead of sending back

306
00:11:34,980 --> 00:11:36,839
deprived kid would actually retrieve a

307
00:11:36,839 --> 00:11:39,389
public key from the back end server and

308
00:11:39,389 --> 00:11:41,820
the server would reply with an md5

309
00:11:41,820 --> 00:11:43,529
checksum from this public key so the

310
00:11:43,529 --> 00:11:45,269
surfer would know that correct one

311
00:11:45,269 --> 00:11:48,959
basically so the server says okay you

312
00:11:48,959 --> 00:11:50,940
got to get the right key clients come

313
00:11:50,940 --> 00:11:52,800
comes back later to reporting how many

314
00:11:52,800 --> 00:11:56,339
files that had and that was it so it

315
00:11:56,339 --> 00:11:57,930
also did something interesting it added

316
00:11:57,930 --> 00:12:00,899
exempted countries so it would not

317
00:12:00,899 --> 00:12:03,680
encrypt if it's any of these countries

318
00:12:03,680 --> 00:12:06,630
being the source of the infection so you

319
00:12:06,630 --> 00:12:07,889
know Russia Belarus Ukraine and

320
00:12:07,889 --> 00:12:09,690
Kazakhstan they were all okay if you

321
00:12:09,690 --> 00:12:11,730
would get an infection you know your IP

322
00:12:11,730 --> 00:12:13,589
would be reported it did a geoip check

323
00:12:13,589 --> 00:12:16,380
would respond with a country code inside

324
00:12:16,380 --> 00:12:18,920
a crypto wall daresay like a crc32

325
00:12:18,920 --> 00:12:21,510
ashing of these country codes and would

326
00:12:21,510 --> 00:12:23,430
check it against the list and this was

327
00:12:23,430 --> 00:12:26,040
the list they implemented in their first

328
00:12:26,040 --> 00:12:27,720
script of all version so they were

329
00:12:27,720 --> 00:12:31,980
excluding all Soviet Union countries so

330
00:12:31,980 --> 00:12:35,640
moving on October 2014 they popped up

331
00:12:35,640 --> 00:12:37,620
again new version crypto a two point oh

332
00:12:37,620 --> 00:12:42,269
so first spotted in emails from IRS just

333
00:12:42,269 --> 00:12:43,890
you know file attachment usual stuff

334
00:12:43,890 --> 00:12:47,940
fake document it's not a document slight

335
00:12:47,940 --> 00:12:49,890
update on the actual ransom notes they

336
00:12:49,890 --> 00:12:51,540
added a two point now behind it just to

337
00:12:51,540 --> 00:12:54,510
identify hey it's a new version they

338
00:12:54,510 --> 00:12:55,500
also did some stuff with the

339
00:12:55,500 --> 00:12:57,149
infrastructure so this was what we had

340
00:12:57,149 --> 00:12:59,399
on the cloned version this is what we

341
00:12:59,399 --> 00:13:02,850
had on the crypto defense but they had

342
00:13:02,850 --> 00:13:04,199
more versions that were running directly

343
00:13:04,199 --> 00:13:07,380
on tour so it wasn't all of them they

344
00:13:07,380 --> 00:13:08,550
were still experimenting with him

345
00:13:08,550 --> 00:13:10,500
because were some issues with it at

346
00:13:10,500 --> 00:13:13,230
times but you had a lot of thorns

347
00:13:13,230 --> 00:13:16,380
directly so now serves to take down they

348
00:13:16,380 --> 00:13:17,939
also went into the affiliate biz

349
00:13:17,939 --> 00:13:19,919
it was kind of interesting it sort of

350
00:13:19,919 --> 00:13:22,289
you know they got in guys who would

351
00:13:22,289 --> 00:13:24,209
spread for them and would get it cut of

352
00:13:24,209 --> 00:13:27,869
the pave somebody actually paid to get

353
00:13:27,869 --> 00:13:29,639
their files back he would see these

354
00:13:29,639 --> 00:13:32,609
crypt 12 it's like currently son like

355
00:13:32,609 --> 00:13:34,979
3,000 or something there are a whole of

356
00:13:34,979 --> 00:13:36,809
a lot you can sort of see that it was

357
00:13:36,809 --> 00:13:38,759
affiliates because in between numbers

358
00:13:38,759 --> 00:13:40,470
would disappear so Phillies would drop

359
00:13:40,470 --> 00:13:42,689
off it wasn't like consecutive version

360
00:13:42,689 --> 00:13:44,339
numbering they would just go off and on

361
00:13:44,339 --> 00:13:46,049
you could see different versions or

362
00:13:46,049 --> 00:13:48,089
different campaign IDs appear something

363
00:13:48,089 --> 00:13:50,909
disappearing over time but that was

364
00:13:50,909 --> 00:13:52,109
basically the whole change so I think

365
00:13:52,109 --> 00:13:53,549
the big exchange here is that they just

366
00:13:53,549 --> 00:13:55,649
implemented an affiliate system so

367
00:13:55,649 --> 00:13:56,729
instead of them spreading around

368
00:13:56,729 --> 00:13:58,559
monitoring their system they would get

369
00:13:58,559 --> 00:14:02,659
other guys who also help with this so

370
00:14:02,659 --> 00:14:05,689
further on January 2015 so this year

371
00:14:05,689 --> 00:14:08,309
they appeared with three-point oh but

372
00:14:08,309 --> 00:14:09,989
before that day sort of took some time

373
00:14:09,989 --> 00:14:12,689
off so you know caffeine also node this

374
00:14:12,689 --> 00:14:15,869
on Twitter 18 of November 2014 was the

375
00:14:15,869 --> 00:14:18,349
last time they updated binaries on their

376
00:14:18,349 --> 00:14:20,699
deployment servers and the that's binary

377
00:14:20,699 --> 00:14:23,429
she would see from exploit kids so they

378
00:14:23,429 --> 00:14:25,019
took some time off like a maybe a

379
00:14:25,019 --> 00:14:27,509
vacation or something you know November

380
00:14:27,509 --> 00:14:30,059
past December past still no samples

381
00:14:30,059 --> 00:14:31,459
still no new stuff from these guys

382
00:14:31,459 --> 00:14:34,009
January came New Year's still nothing

383
00:14:34,009 --> 00:14:36,779
but January thirteenth they were back

384
00:14:36,779 --> 00:14:41,069
three point 0 in this case so they just

385
00:14:41,069 --> 00:14:42,989
took some time off again slight cosmetic

386
00:14:42,989 --> 00:14:45,139
changes on the ransom notes new version

387
00:14:45,139 --> 00:14:48,629
new naming of these ransom notes because

388
00:14:48,629 --> 00:14:49,679
they were quite static you could

389
00:14:49,679 --> 00:14:52,159
actually use this to the texts and stuff

390
00:14:52,159 --> 00:14:55,199
internally they made a change in the

391
00:14:55,199 --> 00:14:57,329
protocol that when it responded with the

392
00:14:57,329 --> 00:14:59,189
check some of the public key it will

393
00:14:59,189 --> 00:15:00,989
also respond with a lock screen so

394
00:15:00,989 --> 00:15:02,099
instead of the malware having this

395
00:15:02,099 --> 00:15:03,989
embedded it would generate this on the

396
00:15:03,989 --> 00:15:06,089
server side which means they didn't have

397
00:15:06,089 --> 00:15:08,489
to build new binaries every time when

398
00:15:08,489 --> 00:15:10,439
they had new domains for the payment

399
00:15:10,439 --> 00:15:12,720
system it would just generate this on

400
00:15:12,720 --> 00:15:14,449
the fly so they could use old samples

401
00:15:14,449 --> 00:15:16,709
this was all dynamically generated on

402
00:15:16,709 --> 00:15:20,459
the back end again network can change

403
00:15:20,459 --> 00:15:21,809
they like to play around they like to

404
00:15:21,809 --> 00:15:23,729
develop this kind of stuff so they

405
00:15:23,729 --> 00:15:25,109
didn't do tour they didn't do their own

406
00:15:25,109 --> 00:15:29,189
proxies they move to ITP which was kind

407
00:15:29,189 --> 00:15:31,260
of interesting so I know it set up

408
00:15:31,260 --> 00:15:33,750
to this only problem was didn't really

409
00:15:33,750 --> 00:15:36,570
work so well I tepees doesn't seem to

410
00:15:36,570 --> 00:15:38,760
skill for them because their servers

411
00:15:38,760 --> 00:15:41,250
went down the whole time like every time

412
00:15:41,250 --> 00:15:43,290
we just go down this Li the decrypt

413
00:15:43,290 --> 00:15:44,610
surface so basically the surface where

414
00:15:44,610 --> 00:15:48,330
you could go to pay to get your to get

415
00:15:48,330 --> 00:15:51,960
the key to get your files back but it

416
00:15:51,960 --> 00:15:53,580
just didn't work you would get errors

417
00:15:53,580 --> 00:15:59,150
from time to time like this in Russian

418
00:15:59,150 --> 00:16:01,740
so infrastructure change after the ITP

419
00:16:01,740 --> 00:16:03,360
stuff they figured out you know this

420
00:16:03,360 --> 00:16:05,130
doesn't work we need something that's

421
00:16:05,130 --> 00:16:07,590
good so the old the old proxy servers

422
00:16:07,590 --> 00:16:09,300
they would maintain themselves you could

423
00:16:09,300 --> 00:16:10,920
take them down and then it would be done

424
00:16:10,920 --> 00:16:13,260
for a while so what they did is they

425
00:16:13,260 --> 00:16:14,550
employed something they're currently

426
00:16:14,550 --> 00:16:17,010
still doing they would hack websites so

427
00:16:17,010 --> 00:16:19,440
old wordpress joomla drupal and it would

428
00:16:19,440 --> 00:16:21,660
food small PHP files under which were

429
00:16:21,660 --> 00:16:24,450
just proxy scripts small scripts using

430
00:16:24,450 --> 00:16:27,060
curl to upstream requests and this

431
00:16:27,060 --> 00:16:28,770
helped because talking to all these

432
00:16:28,770 --> 00:16:30,300
individual holsters to take this stuff

433
00:16:30,300 --> 00:16:32,250
down takes forever and some of them

434
00:16:32,250 --> 00:16:34,410
don't even reply and at the same time

435
00:16:34,410 --> 00:16:35,820
you actually want a copy of this because

436
00:16:35,820 --> 00:16:37,410
you want to know you know what is that

437
00:16:37,410 --> 00:16:38,670
real server they're owning you want to

438
00:16:38,670 --> 00:16:42,180
take this down it just improved from it

439
00:16:42,180 --> 00:16:46,130
helped them to stay active much longer

440
00:16:46,130 --> 00:16:48,810
they also maybe they got a new partner

441
00:16:48,810 --> 00:16:51,570
i'm not sure but they added armenia to

442
00:16:51,570 --> 00:16:53,910
the white listing of exempted countries

443
00:16:53,910 --> 00:16:57,030
it was kind of interesting I you know

444
00:16:57,030 --> 00:16:58,320
maybe they had a new partner in which as

445
00:16:58,320 --> 00:16:59,550
you know i'm not going to spread it and

446
00:16:59,550 --> 00:17:01,410
don't want to be having issues in my own

447
00:17:01,410 --> 00:17:03,330
country could be and in some versions

448
00:17:03,330 --> 00:17:05,040
they also had i ran in there but not all

449
00:17:05,040 --> 00:17:06,630
versions i only found a couple of

450
00:17:06,630 --> 00:17:08,459
samples that had this kind of white

451
00:17:08,459 --> 00:17:10,980
listing so i'm not sure what was going

452
00:17:10,980 --> 00:17:15,300
on there one thing day also added was

453
00:17:15,300 --> 00:17:17,760
that they changed the crypto they made

454
00:17:17,760 --> 00:17:18,869
it faster actually they did some

455
00:17:18,869 --> 00:17:21,209
optimizations so instead of using the

456
00:17:21,209 --> 00:17:23,579
RSA Keith actually encrypted files they

457
00:17:23,579 --> 00:17:26,540
were generating aes-256 key / file I

458
00:17:26,540 --> 00:17:29,610
didn't use this to actually encrypt the

459
00:17:29,610 --> 00:17:31,470
file then they used the public key they

460
00:17:31,470 --> 00:17:33,330
could get from the server to encrypt AES

461
00:17:33,330 --> 00:17:35,700
key it was faster streaming cipher is

462
00:17:35,700 --> 00:17:39,180
way faster on big files you know if some

463
00:17:39,180 --> 00:17:41,880
guy was connected to a file share this

464
00:17:41,880 --> 00:17:43,800
was way faster you didn't have to hear a

465
00:17:43,800 --> 00:17:44,550
machine

466
00:17:44,550 --> 00:17:45,900
buzzing up because it was encrypting all

467
00:17:45,900 --> 00:17:49,140
the files they also slightly had to

468
00:17:49,140 --> 00:17:51,000
change the file format of course so

469
00:17:51,000 --> 00:17:52,890
every file was prepended with an md5

470
00:17:52,890 --> 00:17:54,840
from the public key so it could confirm

471
00:17:54,840 --> 00:17:56,940
if it had the key if it was right then

472
00:17:56,940 --> 00:17:59,280
the encrypted a s key and then the

473
00:17:59,280 --> 00:18:02,130
encrypted file data and they also

474
00:18:02,130 --> 00:18:05,310
expanded their list of targets so 312

475
00:18:05,310 --> 00:18:09,030
instead of 146 they have had since the

476
00:18:09,030 --> 00:18:11,040
beginning you know there was a lot of

477
00:18:11,040 --> 00:18:13,140
obscure files lot of stuff for

478
00:18:13,140 --> 00:18:15,740
photography so raw files for Fatah

479
00:18:15,740 --> 00:18:18,500
photograph files a bunch of design

480
00:18:18,500 --> 00:18:21,090
documents some programming file so you

481
00:18:21,090 --> 00:18:25,890
know dhcp HP HP also some back up back

482
00:18:25,890 --> 00:18:28,020
at DBS sequel I'd database that kind of

483
00:18:28,020 --> 00:18:30,150
stuff these role in their target is now

484
00:18:30,150 --> 00:18:34,890
they were expanding so moving on the

485
00:18:34,890 --> 00:18:35,880
current version which they're now using

486
00:18:35,880 --> 00:18:38,820
I've updated these slides I think four

487
00:18:38,820 --> 00:18:40,290
days ago before I came here so they're

488
00:18:40,290 --> 00:18:44,040
as recent as I could get them this is

489
00:18:44,040 --> 00:18:46,500
November so last month for the November

490
00:18:46,500 --> 00:18:50,430
that isn't change so cosmetic changes on

491
00:18:50,430 --> 00:18:53,280
this part the version number is gone so

492
00:18:53,280 --> 00:18:55,350
there's no 2.9 no three-point oh people

493
00:18:55,350 --> 00:18:57,450
are calling this 24 point no just four

494
00:18:57,450 --> 00:18:59,190
consecutive numbering and I think it's

495
00:18:59,190 --> 00:19:01,890
good to identify this new version we

496
00:19:01,890 --> 00:19:03,150
don't know what what they're calling

497
00:19:03,150 --> 00:19:06,140
this version so slight change in the

498
00:19:06,140 --> 00:19:08,400
naming of the ransom notes you know help

499
00:19:08,400 --> 00:19:10,530
your files but they were also quite

500
00:19:10,530 --> 00:19:11,730
confident about what they were doing

501
00:19:11,730 --> 00:19:14,100
they were saying you have become a part

502
00:19:14,100 --> 00:19:15,470
of large community encrypted law

503
00:19:15,470 --> 00:19:17,370
congratulations you know they were

504
00:19:17,370 --> 00:19:20,370
mocking whoever they were infecting and

505
00:19:20,370 --> 00:19:22,440
they would continue it on in a message

506
00:19:22,440 --> 00:19:24,840
they would also say unfortunately these

507
00:19:24,840 --> 00:19:26,760
sites so basically the sites they were

508
00:19:26,760 --> 00:19:28,080
referring to were the payment websites

509
00:19:28,080 --> 00:19:30,960
and firstly these sites are temporary

510
00:19:30,960 --> 00:19:32,730
because the end of our companies are

511
00:19:32,730 --> 00:19:34,380
interested that you cannot restore your

512
00:19:34,380 --> 00:19:36,150
files but continue to buy their products

513
00:19:36,150 --> 00:19:39,630
you know they were mocking the industry

514
00:19:39,630 --> 00:19:40,650
and mocking the people they were

515
00:19:40,650 --> 00:19:43,560
encrypting their files from doing even

516
00:19:43,560 --> 00:19:45,390
more crypt all projects not malicious

517
00:19:45,390 --> 00:19:47,280
and not intended to harm a person in his

518
00:19:47,280 --> 00:19:49,770
or her information data now they were

519
00:19:49,770 --> 00:19:51,630
just mocking they were nobody seemed to

520
00:19:51,630 --> 00:19:54,300
do anything against them they were just

521
00:19:54,300 --> 00:19:57,660
having fun however the four-point-oh

522
00:19:57,660 --> 00:19:58,410
change wasn't

523
00:19:58,410 --> 00:20:00,210
on all affiliates some are still using

524
00:20:00,210 --> 00:20:01,530
three-point know some are using four

525
00:20:01,530 --> 00:20:04,620
point oh sometimes it drops this you

526
00:20:04,620 --> 00:20:06,150
know the ransom notes where they make

527
00:20:06,150 --> 00:20:08,010
fun of people sometimes it doesn't it

528
00:20:08,010 --> 00:20:11,970
depends on on what kind of affiliates

529
00:20:11,970 --> 00:20:13,650
they have so I'm not sure I think

530
00:20:13,650 --> 00:20:15,510
they're also kind of experimenting with

531
00:20:15,510 --> 00:20:17,340
some new stuff they also change the

532
00:20:17,340 --> 00:20:19,710
communication protocol probably because

533
00:20:19,710 --> 00:20:21,000
there were a lot of publications and how

534
00:20:21,000 --> 00:20:24,480
you could decrypt the stuff so for one

535
00:20:24,480 --> 00:20:26,280
part you couldn't plainly just decrypt

536
00:20:26,280 --> 00:20:28,230
it by doing a hex decode and doing the

537
00:20:28,230 --> 00:20:30,510
same scrambling what they did is if you

538
00:20:30,510 --> 00:20:33,330
look on the PHP files they have on their

539
00:20:33,330 --> 00:20:37,020
proxies they did a nasty trick that

540
00:20:37,020 --> 00:20:39,270
first trip me up as well basically they

541
00:20:39,270 --> 00:20:41,970
take this key and they conferred so in

542
00:20:41,970 --> 00:20:43,350
this case it changed from just a post

543
00:20:43,350 --> 00:20:45,420
location judicial parameters to the last

544
00:20:45,420 --> 00:20:48,390
part and this thing it's the key what

545
00:20:48,390 --> 00:20:50,760
they do is they convert every character

546
00:20:50,760 --> 00:20:53,700
in a string to an integer so apparently

547
00:20:53,700 --> 00:20:56,450
PHP which I'm not really a fan of one of

548
00:20:56,450 --> 00:20:58,560
when it gets a character you cast it to

549
00:20:58,560 --> 00:21:00,360
an integer it just says hey that's not a

550
00:21:00,360 --> 00:21:02,760
number I'll make it zero so instead of

551
00:21:02,760 --> 00:21:04,200
giving any exceptions I was doing you

552
00:21:04,200 --> 00:21:05,550
some pie tin a bite and it's a lot more

553
00:21:05,550 --> 00:21:07,140
compliant that way and starts

554
00:21:07,140 --> 00:21:09,960
complaining about this stuff so what

555
00:21:09,960 --> 00:21:11,880
we're doing if you walk down that string

556
00:21:11,880 --> 00:21:13,410
basically all the characters became zero

557
00:21:13,410 --> 00:21:15,540
and then you had an eight and a five in

558
00:21:15,540 --> 00:21:18,060
there a plus 5 to 13 and this was

559
00:21:18,060 --> 00:21:19,650
basically an offset in the actual hacks

560
00:21:19,650 --> 00:21:21,810
data now you could do decode and you get

561
00:21:21,810 --> 00:21:24,630
the rc4 again just a slight change to

562
00:21:24,630 --> 00:21:27,480
I'm guessing stop automation of this

563
00:21:27,480 --> 00:21:30,810
stuff kind of knowing but fixed it I

564
00:21:30,810 --> 00:21:32,670
have a tool for this I'm going to Lee's

565
00:21:32,670 --> 00:21:35,400
letter and you can just calculate offset

566
00:21:35,400 --> 00:21:36,840
really easily but just you know it broke

567
00:21:36,840 --> 00:21:40,560
a lot of tools for people now through

568
00:21:40,560 --> 00:21:42,900
all this history I want to give a word

569
00:21:42,900 --> 00:21:45,240
of caution basically these guys learn

570
00:21:45,240 --> 00:21:46,710
and profits from everything you publish

571
00:21:46,710 --> 00:21:48,990
on I know it's fun publishing about this

572
00:21:48,990 --> 00:21:50,730
stuff it's fun pointing out stuff that's

573
00:21:50,730 --> 00:21:53,370
wrong but they learn from this so the

574
00:21:53,370 --> 00:21:55,290
first cryptolocker clone they probably

575
00:21:55,290 --> 00:21:56,820
stopped it because of the takedown you

576
00:21:56,820 --> 00:21:58,860
know they wouldn't refer to the name I'm

577
00:21:58,860 --> 00:22:00,720
not completely sure but they change from

578
00:22:00,720 --> 00:22:02,850
Krypto defense 24 script a while because

579
00:22:02,850 --> 00:22:03,930
somebody pointed out there was a

580
00:22:03,930 --> 00:22:06,240
flounder crypto the fixed it meant a new

581
00:22:06,240 --> 00:22:07,560
version because the name was sort of

582
00:22:07,560 --> 00:22:09,480
tainted because people saw it in the

583
00:22:09,480 --> 00:22:11,520
news as being bad

584
00:22:11,520 --> 00:22:12,990
encryption you could just decrypt all

585
00:22:12,990 --> 00:22:16,710
the files so from Krypto one point oh

586
00:22:16,710 --> 00:22:18,540
they sort of moved to the heck website

587
00:22:18,540 --> 00:22:22,260
system and did some tour stuff just

588
00:22:22,260 --> 00:22:23,790
because of frequent takedowns was pretty

589
00:22:23,790 --> 00:22:25,590
easy to kick them down you just took

590
00:22:25,590 --> 00:22:27,720
this proxy server you got to take him

591
00:22:27,720 --> 00:22:29,130
down and then for a while they can do

592
00:22:29,130 --> 00:22:36,120
much and from two point oh they did the

593
00:22:36,120 --> 00:22:37,980
same thing they tried some tour stuff

594
00:22:37,980 --> 00:22:40,230
ITP this wasn't related to publications

595
00:22:40,230 --> 00:22:42,060
but their own findings you know so the

596
00:22:42,060 --> 00:22:43,860
ITP stuff didn't work out was kind of

597
00:22:43,860 --> 00:22:45,420
bugging they move the three-point oh

598
00:22:45,420 --> 00:22:47,150
they went back to the hacked websites

599
00:22:47,150 --> 00:22:49,200
and then from three point out to the

600
00:22:49,200 --> 00:22:51,090
current version they made a change

601
00:22:51,090 --> 00:22:52,350
because somebody made a publication

602
00:22:52,350 --> 00:22:54,090
about them there was a flaw and

603
00:22:54,090 --> 00:22:56,310
basically out of their proxy servers

604
00:22:56,310 --> 00:22:58,080
with filter requests so it could send

605
00:22:58,080 --> 00:23:00,270
stuff like a server stage request it

606
00:23:00,270 --> 00:23:01,620
would upstream to one of the backhands

607
00:23:01,620 --> 00:23:02,820
you would get a server stage page from

608
00:23:02,820 --> 00:23:05,010
the back end they figure this out and

609
00:23:05,010 --> 00:23:06,690
overnight it changed it fix everything

610
00:23:06,690 --> 00:23:09,750
so you know these guys are smart they

611
00:23:09,750 --> 00:23:11,610
adapt quickly they read what people are

612
00:23:11,610 --> 00:23:14,640
publishing about them and if you find

613
00:23:14,640 --> 00:23:16,860
any floss I should just not publishing

614
00:23:16,860 --> 00:23:19,200
these I know it's fun you know it's like

615
00:23:19,200 --> 00:23:21,360
kind of cool when you find something but

616
00:23:21,360 --> 00:23:23,520
these guys they really closely monitor

617
00:23:23,520 --> 00:23:25,080
this stuff you really want don't want to

618
00:23:25,080 --> 00:23:26,400
explain to them what they have to do to

619
00:23:26,400 --> 00:23:28,200
fix stuff you don't want to give them a

620
00:23:28,200 --> 00:23:30,420
free pen test or you know free advice

621
00:23:30,420 --> 00:23:33,180
how to improve their operation so if you

622
00:23:33,180 --> 00:23:34,800
do find something and I shared with

623
00:23:34,800 --> 00:23:36,500
trusted partners or interest groups

624
00:23:36,500 --> 00:23:38,850
there is law enforcement working on a

625
00:23:38,850 --> 00:23:41,670
case can say who what if you want to

626
00:23:41,670 --> 00:23:43,440
work with those send me a message I'll

627
00:23:43,440 --> 00:23:46,080
forward you to some guys where it can

628
00:23:46,080 --> 00:23:47,640
help out do something about these guys

629
00:23:47,640 --> 00:23:50,700
instead of helping them with their

630
00:23:50,700 --> 00:23:55,370
operation basically so infrastructure

631
00:23:55,370 --> 00:23:57,870
this is the generic infrastructure

632
00:23:57,870 --> 00:24:00,000
they've had for a long time to just did

633
00:24:00,000 --> 00:24:01,590
some layering on the top so connect

634
00:24:01,590 --> 00:24:03,900
directly on tour ITP which option to the

635
00:24:03,900 --> 00:24:06,900
tour service or their direct proxy

636
00:24:06,900 --> 00:24:08,460
servers so on the left you have the

637
00:24:08,460 --> 00:24:10,860
proxy server which is just the upstream

638
00:24:10,860 --> 00:24:12,960
requesting to tour this can be the

639
00:24:12,960 --> 00:24:15,390
public payment systems they have or when

640
00:24:15,390 --> 00:24:17,460
a client initially checks in so the

641
00:24:17,460 --> 00:24:18,960
initial check in is actually into the

642
00:24:18,960 --> 00:24:22,380
backend server it has the blue icon if

643
00:24:22,380 --> 00:24:24,180
you find it the fav icon is actually

644
00:24:24,180 --> 00:24:24,930
this blue

645
00:24:24,930 --> 00:24:27,090
thing don't know where they got it the

646
00:24:27,090 --> 00:24:29,700
payment website is in between that's

647
00:24:29,700 --> 00:24:31,710
orange icon you connect to it but it

648
00:24:31,710 --> 00:24:32,820
would actually upstream to the backend

649
00:24:32,820 --> 00:24:35,340
so you know it's just another proxy in

650
00:24:35,340 --> 00:24:37,650
their whole system of proxies and the

651
00:24:37,650 --> 00:24:39,560
operators would also connect on several

652
00:24:39,560 --> 00:24:42,150
separate backends these were also up

653
00:24:42,150 --> 00:24:46,530
streaming on to the other back-end you

654
00:24:46,530 --> 00:24:48,150
know and if you find this login page you

655
00:24:48,150 --> 00:24:49,920
know you found one of the backends that

656
00:24:49,920 --> 00:24:51,210
you can do all kinds of management they

657
00:24:51,210 --> 00:24:52,650
have account management for their

658
00:24:52,650 --> 00:24:54,960
affiliates they can build new samples

659
00:24:54,960 --> 00:24:57,330
they see geographic locations where they

660
00:24:57,330 --> 00:25:01,430
had infections statistics all that stuff

661
00:25:01,430 --> 00:25:03,630
but you know there's more behind it

662
00:25:03,630 --> 00:25:06,360
these guys love proxies like seriously

663
00:25:06,360 --> 00:25:07,470
everything in their whole infrastructure

664
00:25:07,470 --> 00:25:09,750
is proxies they proxy all the things

665
00:25:09,750 --> 00:25:11,520
with layers and layers so it's really

666
00:25:11,520 --> 00:25:13,530
hard to find out where they are and what

667
00:25:13,530 --> 00:25:16,740
you can do about it so you need to

668
00:25:16,740 --> 00:25:18,870
explore it is if find every next hop to

669
00:25:18,870 --> 00:25:21,450
actually get to the backend some

670
00:25:21,450 --> 00:25:23,070
information the outside proxies are

671
00:25:23,070 --> 00:25:25,320
engines with privacy to upstream to

672
00:25:25,320 --> 00:25:27,240
specific 8 and services so either the

673
00:25:27,240 --> 00:25:30,540
affiliate page or the payment wall and

674
00:25:30,540 --> 00:25:32,190
the back end as far as I got is actually

675
00:25:32,190 --> 00:25:35,190
Debian machine running PHP Apache with

676
00:25:35,190 --> 00:25:37,950
my sequel they also have some validation

677
00:25:37,950 --> 00:25:39,990
in this infrastructure so the tier 1

678
00:25:39,990 --> 00:25:42,900
actually decrypter requests they check

679
00:25:42,900 --> 00:25:45,270
if it's valid dear to validate sexual

680
00:25:45,270 --> 00:25:47,280
request post locations so you cannot do

681
00:25:47,280 --> 00:25:49,200
server stage stuff anymore and the back

682
00:25:49,200 --> 00:25:50,850
end completely parser in order to

683
00:25:50,850 --> 00:25:52,830
confirm what you're doing and the

684
00:25:52,830 --> 00:25:54,390
payment wall and affiliate stuff is

685
00:25:54,390 --> 00:25:56,880
similar to your too so just filtering on

686
00:25:56,880 --> 00:25:59,480
specific stuff they don't want to pop up

687
00:25:59,480 --> 00:26:04,560
so interesting discoveries i made over

688
00:26:04,560 --> 00:26:06,990
time so they have this really unique

689
00:26:06,990 --> 00:26:08,940
logo they put on the first version ever

690
00:26:08,940 --> 00:26:12,420
and they put on every payment website is

691
00:26:12,420 --> 00:26:14,700
this just a lock simply part of a big

692
00:26:14,700 --> 00:26:16,980
set of icons and it's just an icon pack

693
00:26:16,980 --> 00:26:18,480
they stole from somebody who made this

694
00:26:18,480 --> 00:26:20,310
so soumya graphic so i won't name them

695
00:26:20,310 --> 00:26:22,110
name of the guy because he doesn't need

696
00:26:22,110 --> 00:26:23,220
to be affiliated with this they just

697
00:26:23,220 --> 00:26:25,380
stole his work and put it on my

698
00:26:25,380 --> 00:26:29,220
ransomware a while ago about a year ago

699
00:26:29,220 --> 00:26:31,170
they were screwing up some internal

700
00:26:31,170 --> 00:26:33,780
systems in their infrastructure so if

701
00:26:33,780 --> 00:26:35,250
you did the server stage request you saw

702
00:26:35,250 --> 00:26:37,140
this so just a normal serve stage

703
00:26:37,140 --> 00:26:38,279
request only

704
00:26:38,279 --> 00:26:40,229
you looked at it I you would see there

705
00:26:40,229 --> 00:26:41,669
was actually up streaming so we get

706
00:26:41,669 --> 00:26:43,200
server status pages from different

707
00:26:43,200 --> 00:26:46,019
backends depending on which Brock's you

708
00:26:46,019 --> 00:26:48,330
would ask this stuff too it's kind of

709
00:26:48,330 --> 00:26:49,469
interesting you could figure out their

710
00:26:49,469 --> 00:26:53,609
proxies this way at some point they were

711
00:26:53,609 --> 00:26:56,039
also putting messages so in their

712
00:26:56,039 --> 00:26:58,679
initial Packer wrapper around the whole

713
00:26:58,679 --> 00:27:00,779
core of crypto wall so here's our crypt

714
00:27:00,779 --> 00:27:03,210
of our shut up and listen you know they

715
00:27:03,210 --> 00:27:06,119
like to have fun make fun of people but

716
00:27:06,119 --> 00:27:07,919
one thing they also do just like they

717
00:27:07,919 --> 00:27:09,299
check up with people write about them

718
00:27:09,299 --> 00:27:12,179
they keep track of new techniques so in

719
00:27:12,179 --> 00:27:14,999
November 2014 power tool guy over in

720
00:27:14,999 --> 00:27:17,419
China he made this proof concept to run

721
00:27:17,419 --> 00:27:20,369
code or actually execute something if I

722
00:27:20,369 --> 00:27:22,739
compiled HTML files and he uploaded a

723
00:27:22,739 --> 00:27:26,059
park of this on mega no fe detected is

724
00:27:26,059 --> 00:27:29,789
USC doesn't pop up and anything so then

725
00:27:29,789 --> 00:27:32,399
februari 2015 came and these guys were

726
00:27:32,399 --> 00:27:34,320
using this they used this to spread and

727
00:27:34,320 --> 00:27:36,929
they went as far as to not even remove

728
00:27:36,929 --> 00:27:38,940
the name of the original guy so they

729
00:27:38,940 --> 00:27:41,099
just took the proof concept they pasted

730
00:27:41,099 --> 00:27:43,229
it in some stuff to just download crypto

731
00:27:43,229 --> 00:27:45,330
law and executed and the guys name was

732
00:27:45,330 --> 00:27:50,519
still in there one more thing this if

733
00:27:50,519 --> 00:27:52,409
you go if you decode the whole Corps you

734
00:27:52,409 --> 00:27:54,869
get to the school of I which is just you

735
00:27:54,869 --> 00:27:57,059
know if you want to insult somebody say

736
00:27:57,059 --> 00:28:00,919
to him it's in there I don't know why

737
00:28:00,919 --> 00:28:03,450
it's if somebody if you're looking at

738
00:28:03,450 --> 00:28:05,460
this if you get into the whole Corps

739
00:28:05,460 --> 00:28:07,289
there's the file names of the ransom

740
00:28:07,289 --> 00:28:09,960
notes and if you go 16 bytes up there

741
00:28:09,960 --> 00:28:11,879
are four bytes which if you decode it is

742
00:28:11,879 --> 00:28:14,009
this I have no clue there's no reference

743
00:28:14,009 --> 00:28:17,339
to it but what was interesting at some

744
00:28:17,339 --> 00:28:18,389
point where i found is that they made

745
00:28:18,389 --> 00:28:20,429
the slip up and i made to slip up all

746
00:28:20,429 --> 00:28:22,979
the way in the beginning so i said there

747
00:28:22,979 --> 00:28:24,330
was this compressed blob witcha

748
00:28:24,330 --> 00:28:27,619
cryptolocker clone downloaded right

749
00:28:27,619 --> 00:28:29,999
which was this thing now if you looked

750
00:28:29,999 --> 00:28:32,399
at it you saw some artifacts from a PNG

751
00:28:32,399 --> 00:28:34,289
header it's kind of compressed you know

752
00:28:34,289 --> 00:28:36,359
there was some stuff missing now what it

753
00:28:36,359 --> 00:28:38,700
actually was it was like a like a small

754
00:28:38,700 --> 00:28:40,559
data container so the first four bytes

755
00:28:40,559 --> 00:28:42,029
with the size they can get the whole

756
00:28:42,029 --> 00:28:44,099
size you could decompress it with rtl

757
00:28:44,099 --> 00:28:46,109
you compress you could get sort of a

758
00:28:46,109 --> 00:28:48,450
list of small file blobs indicated with

759
00:28:48,450 --> 00:28:49,920
it checksum

760
00:28:49,920 --> 00:28:51,780
we did a size and then the actual data

761
00:28:51,780 --> 00:28:54,810
so made a small script to decode is

762
00:28:54,810 --> 00:28:56,430
because I was interested in what was

763
00:28:56,430 --> 00:28:59,100
actually inside was a bunch of PNG files

764
00:28:59,100 --> 00:29:02,730
some text files and if you looked at the

765
00:29:02,730 --> 00:29:04,950
images you got this it's kind of

766
00:29:04,950 --> 00:29:06,240
interesting they weren't on the actual

767
00:29:06,240 --> 00:29:08,520
locker they weren't used in the locker

768
00:29:08,520 --> 00:29:10,680
at any point if you look at the HTML

769
00:29:10,680 --> 00:29:12,030
file so you fix it up a little bit you

770
00:29:12,030 --> 00:29:14,220
saw this now that's even more interested

771
00:29:14,220 --> 00:29:15,650
these are the police lockers

772
00:29:15,650 --> 00:29:17,670
specifically the ones from a group

773
00:29:17,670 --> 00:29:19,770
called elevate on which is a group that

774
00:29:19,770 --> 00:29:21,990
has doing been doing this these lockers

775
00:29:21,990 --> 00:29:25,350
on Android and you know web page lockers

776
00:29:25,350 --> 00:29:27,660
for a long time the actual code from

777
00:29:27,660 --> 00:29:29,460
processing these payments was the same

778
00:29:29,460 --> 00:29:31,020
as the guys from Quebec on the first

779
00:29:31,020 --> 00:29:32,730
version of crypto all you know you could

780
00:29:32,730 --> 00:29:35,130
pay money back you cash this exact same

781
00:29:35,130 --> 00:29:37,080
payments you could do with these guys to

782
00:29:37,080 --> 00:29:40,170
locker but you know this this

783
00:29:40,170 --> 00:29:42,540
disappeared day went on to Bitcoin ever

784
00:29:42,540 --> 00:29:44,370
since crypto defense what's kind of

785
00:29:44,370 --> 00:29:46,890
interesting there was you know the code

786
00:29:46,890 --> 00:29:48,960
the these foul blobs were also used for

787
00:29:48,960 --> 00:29:51,120
these lockers first day with the old

788
00:29:51,120 --> 00:29:52,380
lockers which just request all the

789
00:29:52,380 --> 00:29:54,600
different images from the lock page from

790
00:29:54,600 --> 00:29:56,610
a server but this one would actually get

791
00:29:56,610 --> 00:29:58,710
a foul blob the latest version which was

792
00:29:58,710 --> 00:30:01,470
similar to the crypto wall stuff so

793
00:30:01,470 --> 00:30:03,750
maybe lead to the author's so quickly

794
00:30:03,750 --> 00:30:06,000
I've got some tools I made a request

795
00:30:06,000 --> 00:30:08,850
decrypter a client in the server I'm not

796
00:30:08,850 --> 00:30:10,170
going to release the server simply

797
00:30:10,170 --> 00:30:12,210
because I said this one's on Twitter I'm

798
00:30:12,210 --> 00:30:13,620
not going to release something with

799
00:30:13,620 --> 00:30:15,210
which you can patch old samples and

800
00:30:15,210 --> 00:30:16,350
actually run your own ransom or

801
00:30:16,350 --> 00:30:18,240
operation I don't like that stuff I

802
00:30:18,240 --> 00:30:19,680
don't like Elvis or transfer so I'm not

803
00:30:19,680 --> 00:30:23,940
going to help them so this tool you can

804
00:30:23,940 --> 00:30:25,920
just rip the responder requests and

805
00:30:25,920 --> 00:30:27,750
responses so you know you give to post

806
00:30:27,750 --> 00:30:29,790
location key parameter key would decrypt

807
00:30:29,790 --> 00:30:32,610
response i made a client allows you to

808
00:30:32,610 --> 00:30:33,840
communicate with the proxies or the

809
00:30:33,840 --> 00:30:37,410
backend servers it's all inviting you

810
00:30:37,410 --> 00:30:38,910
can do it interactively and I just use

811
00:30:38,910 --> 00:30:41,250
it to explore these command IDs so it's

812
00:30:41,250 --> 00:30:43,050
currently broken because a four-point-oh

813
00:30:43,050 --> 00:30:46,320
I'll fix it later it's on get up I'll

814
00:30:46,320 --> 00:30:48,510
publish it tonight or something so

815
00:30:48,510 --> 00:30:50,220
quickly thank you to some friends spread

816
00:30:50,220 --> 00:30:52,290
from our traffic analysis go to his

817
00:30:52,290 --> 00:30:53,700
website there's tons of resources if you

818
00:30:53,700 --> 00:30:55,500
want to do analysis and stuff Nick

819
00:30:55,500 --> 00:30:56,760
Hoffman for sharing some old samples

820
00:30:56,760 --> 00:30:58,680
check helpless there's a guy in Twitter

821
00:30:58,680 --> 00:31:00,480
who shares a ton of information in his

822
00:31:00,480 --> 00:31:03,510
free time awesome guy and there's

823
00:31:03,510 --> 00:31:06,480
tons more unnamed people and I'm just in

824
00:31:06,480 --> 00:31:21,660
time I had too many slides sorry papa I

825
00:31:21,660 --> 00:31:31,290
on the diseased tree enjoys it um any

826
00:31:31,290 --> 00:31:37,620
questions oh very oh this one it's 0 x3

827
00:31:37,620 --> 00:31:40,080
a which is accident ation of a column 0

828
00:31:40,080 --> 00:31:48,840
x3 a tom has a question hi morning nah

829
00:31:48,840 --> 00:31:51,870
nothin and have you looked into Tesla

830
00:31:51,870 --> 00:31:54,870
crypt we've seen it very actively being

831
00:31:54,870 --> 00:31:56,580
distributed in Switzerland just very

832
00:31:56,580 --> 00:31:59,910
recently I have some what I've been

833
00:31:59,910 --> 00:32:01,230
looking at some of the proxy stuff

834
00:32:01,230 --> 00:32:02,430
because what they're doing is to mimic

835
00:32:02,430 --> 00:32:04,080
encrypt a while so the lock screen

836
00:32:04,080 --> 00:32:06,000
decoupling from Krypto all the backend

837
00:32:06,000 --> 00:32:08,040
server do you know the looks stolen from

838
00:32:08,040 --> 00:32:10,050
Krypto all and there now also doing the

839
00:32:10,050 --> 00:32:12,660
heck proxy stuff all crypto wall so

840
00:32:12,660 --> 00:32:14,580
maybe my next thing next to still

841
00:32:14,580 --> 00:32:16,020
tracking these guys because I've looking

842
00:32:16,020 --> 00:32:19,140
at the these guys since 2013 I'm kind of

843
00:32:19,140 --> 00:32:21,750
done with them so I haven't looked at it

844
00:32:21,750 --> 00:32:26,300
too much now whatever okay thanks

845
00:32:26,410 --> 00:32:37,960
okay thank you I nailed it

