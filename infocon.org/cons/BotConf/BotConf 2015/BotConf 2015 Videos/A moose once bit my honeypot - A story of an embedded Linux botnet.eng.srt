1
00:00:00,000 --> 00:00:03,149
okay this is just silly it's not the

2
00:00:03,149 --> 00:00:05,310
like the the title of the talk is this

3
00:00:05,310 --> 00:00:10,679
yeah um so will you explain what the

4
00:00:10,679 --> 00:00:14,759
Moose is yes okay new animals for us you

5
00:00:14,759 --> 00:00:16,170
know we don't have them here I know I

6
00:00:16,170 --> 00:00:20,820
know okay Olivia Bilodeau from Canada I

7
00:00:20,820 --> 00:00:27,680
said yeah represent you have the floor

8
00:00:27,680 --> 00:00:31,949
so I presented about IOT in a local

9
00:00:31,949 --> 00:00:34,350
conference and Quebec in French called

10
00:00:34,350 --> 00:00:36,840
hackfest and so I had one of my

11
00:00:36,840 --> 00:00:40,200
colleagues from Estep market Ian did a

12
00:00:40,200 --> 00:00:43,920
nice fake shutterstock photo for the

13
00:00:43,920 --> 00:00:46,410
talk which I decided to share because

14
00:00:46,410 --> 00:00:50,219
it's featuring the cyber team and has

15
00:00:50,219 --> 00:00:52,620
French in it and also mentions

16
00:00:52,620 --> 00:00:54,559
shell-shocked photos instead of

17
00:00:54,559 --> 00:00:57,539
shutterstock photos anyway so just a

18
00:00:57,539 --> 00:01:00,480
little aside here so today I'm going to

19
00:01:00,480 --> 00:01:03,090
present about linux moves which is an

20
00:01:03,090 --> 00:01:06,479
embedded Linux but net the agenda will

21
00:01:06,479 --> 00:01:09,869
be embedded Linux now we're in general

22
00:01:09,869 --> 00:01:11,549
just a little bit of the description

23
00:01:11,549 --> 00:01:14,220
moves DNA so description of the malware

24
00:01:14,220 --> 00:01:17,580
the operation and then a few updates

25
00:01:17,580 --> 00:01:19,740
what's new regarding this but net and

26
00:01:19,740 --> 00:01:22,049
some takeaways throughout the

27
00:01:22,049 --> 00:01:24,240
presentation it will be sprinkled with

28
00:01:24,240 --> 00:01:28,829
lessons learned of the of our story if

29
00:01:28,829 --> 00:01:31,409
you want looking and investigating this

30
00:01:31,409 --> 00:01:34,049
button and also some design decisions

31
00:01:34,049 --> 00:01:36,990
that we will highlight of the done by

32
00:01:36,990 --> 00:01:40,770
the malware operators good and bad also

33
00:01:40,770 --> 00:01:43,860
some code snippet we shared a lot of our

34
00:01:43,860 --> 00:01:46,979
code for this research on github so we

35
00:01:46,979 --> 00:01:51,060
will plug it and so yeah so before we

36
00:01:51,060 --> 00:01:54,840
dive into the subject why am I here so

37
00:01:54,840 --> 00:01:58,020
I'm a malware researcher at ISA I now I

38
00:01:58,020 --> 00:01:59,880
switched jobs since then I work for go

39
00:01:59,880 --> 00:02:03,240
secure now which is I I starting a new

40
00:02:03,240 --> 00:02:04,950
research department in this small

41
00:02:04,950 --> 00:02:06,869
Canadian company but all of this

42
00:02:06,869 --> 00:02:10,110
research was done as ISA and is

43
00:02:10,110 --> 00:02:11,940
presented as

44
00:02:11,940 --> 00:02:15,550
i did some lectures at ets in montreal

45
00:02:15,550 --> 00:02:18,820
also I was before involved a lot in

46
00:02:18,820 --> 00:02:21,040
Linux systems as an infosec developer

47
00:02:21,040 --> 00:02:24,100
network administrator for core internet

48
00:02:24,100 --> 00:02:27,280
working at the bell canada ISP and linux

49
00:02:27,280 --> 00:02:29,830
assignment for bill also we we have a

50
00:02:29,830 --> 00:02:32,530
few things in Montreal which are worth

51
00:02:32,530 --> 00:02:34,870
of mention if you ever come by Montreal

52
00:02:34,870 --> 00:02:37,450
which is munch react which our hands on

53
00:02:37,450 --> 00:02:39,280
security workshops or three hours of

54
00:02:39,280 --> 00:02:43,030
hands-on CTF solving challenges and also

55
00:02:43,030 --> 00:02:47,110
I do the north sac hacker jeopardy every

56
00:02:47,110 --> 00:02:49,480
year and I'm also in charge of the North

57
00:02:49,480 --> 00:02:51,850
SEC trainings so if any of one of you is

58
00:02:51,850 --> 00:02:53,530
a trainer and still has time and doesn't

59
00:02:53,530 --> 00:02:55,239
leave right after the conference come

60
00:02:55,239 --> 00:02:56,830
and see me I might be interested in

61
00:02:56,830 --> 00:03:00,090
having you give a training in Montreal

62
00:03:00,090 --> 00:03:03,370
so what is embedded Linux malware what

63
00:03:03,370 --> 00:03:05,770
marketing or the Internet as all likes

64
00:03:05,770 --> 00:03:08,470
to call Internet of Things malware well

65
00:03:08,470 --> 00:03:10,570
basically it's now we're running on an

66
00:03:10,570 --> 00:03:13,090
embedded Linux system right nothing to

67
00:03:13,090 --> 00:03:14,950
learn here so what kind of embedded

68
00:03:14,950 --> 00:03:17,560
Linux system mostly consumer routers but

69
00:03:17,560 --> 00:03:21,400
some DVR some smart TVs IP cameras etc a

70
00:03:21,400 --> 00:03:23,110
lot of stuff what are the

71
00:03:23,110 --> 00:03:24,910
characteristics of embedded Linux

72
00:03:24,910 --> 00:03:26,709
systems well there is not a lot of

73
00:03:26,709 --> 00:03:29,620
memory not a lot of flash rarely there

74
00:03:29,620 --> 00:03:32,680
is a hard drive usually it's not on

75
00:03:32,680 --> 00:03:35,410
running on 8686 architectures so our

76
00:03:35,410 --> 00:03:39,280
Maps some PowerPC super h there's a wide

77
00:03:39,280 --> 00:03:41,620
variety of lipstick emitations and

78
00:03:41,620 --> 00:03:45,400
version you can have very it's like

79
00:03:45,400 --> 00:03:47,290
almost never the new lipsy which is

80
00:03:47,290 --> 00:03:51,480
there it always using a linux kernel and

81
00:03:51,480 --> 00:03:54,579
well because it's an embedded linux in

82
00:03:54,579 --> 00:03:56,350
this case the specific case i'm covering

83
00:03:56,350 --> 00:03:59,290
today which is very important is that

84
00:03:59,290 --> 00:04:01,840
the ABI is compatible so Cisco's are

85
00:04:01,840 --> 00:04:04,090
always compatible which means that as

86
00:04:04,090 --> 00:04:07,540
we'll see later we rely on this to do

87
00:04:07,540 --> 00:04:10,030
statically linked binaries which make

88
00:04:10,030 --> 00:04:12,160
reverse-engineering a bit more complex

89
00:04:12,160 --> 00:04:13,570
because there are a lot of code to look

90
00:04:13,570 --> 00:04:16,540
at it supports health binaries there's

91
00:04:16,540 --> 00:04:20,680
rarely a UI and it's networked so

92
00:04:20,680 --> 00:04:22,599
attractive because there would be a lot

93
00:04:22,599 --> 00:04:25,190
of potential victims also maybe

94
00:04:25,190 --> 00:04:26,920
I should have added here is that

95
00:04:26,920 --> 00:04:29,450
security usually is an afterthought in

96
00:04:29,450 --> 00:04:31,760
these systems it's not really designed

97
00:04:31,760 --> 00:04:36,050
with security in mind so why threats on

98
00:04:36,050 --> 00:04:38,150
these system matters well as I mentioned

99
00:04:38,150 --> 00:04:41,750
there is no UI or rarely a UI besides a

100
00:04:41,750 --> 00:04:43,790
web interface which means that it's hard

101
00:04:43,790 --> 00:04:46,610
to detect and also hard to remediate how

102
00:04:46,610 --> 00:04:49,160
hard to have access to the system and do

103
00:04:49,160 --> 00:04:52,460
some like computer type task unless you

104
00:04:52,460 --> 00:04:55,040
solder you know pins and you get access

105
00:04:55,040 --> 00:04:58,250
with a server connection on it it's hard

106
00:04:58,250 --> 00:05:01,010
to fix problem also vendor updates are

107
00:05:01,010 --> 00:05:03,580
non-existent or mostly in existent and

108
00:05:03,580 --> 00:05:06,080
right now it's been a low-hanging fruit

109
00:05:06,080 --> 00:05:08,540
for bad guys if you put something

110
00:05:08,540 --> 00:05:10,970
listening on telnet port on the internet

111
00:05:10,970 --> 00:05:12,380
you will notice that there's a lot of

112
00:05:12,380 --> 00:05:15,410
things going on trying to attack routers

113
00:05:15,410 --> 00:05:17,780
on ternet port with default credentials

114
00:05:17,780 --> 00:05:22,390
and then push binaries and leverage the

115
00:05:22,390 --> 00:05:26,600
your device so it's real also several

116
00:05:26,600 --> 00:05:28,190
cases were disclosed in the last two

117
00:05:28,190 --> 00:05:30,919
years a lot of the same stuff Saudi does

118
00:05:30,919 --> 00:05:33,200
mostly some Bitcoin mining but they soon

119
00:05:33,200 --> 00:05:34,970
realize it was not efficient to do

120
00:05:34,970 --> 00:05:37,669
Bitcoin mining on consumer routers and

121
00:05:37,669 --> 00:05:40,400
things are only getting worse so just a

122
00:05:40,400 --> 00:05:42,470
few of the things we saw if you've been

123
00:05:42,470 --> 00:05:44,740
watching this space for the last month's

124
00:05:44,740 --> 00:05:49,640
sadity had a dns change your name win32

125
00:05:49,640 --> 00:05:51,590
are brute which a colleague of mine

126
00:05:51,590 --> 00:05:53,030
bedroom i talked about which is so

127
00:05:53,030 --> 00:05:58,130
related to the sanity malware that was

128
00:05:58,130 --> 00:06:00,710
the previous presentation other stuff

129
00:06:00,710 --> 00:06:02,840
found by a vast so hiding with an

130
00:06:02,840 --> 00:06:06,230
embedded rootkit also the lizard squad

131
00:06:06,230 --> 00:06:08,990
group was found to use embedded malware

132
00:06:08,990 --> 00:06:12,110
to do d dust so controlled by a panel

133
00:06:12,110 --> 00:06:14,990
but still running on which it's called

134
00:06:14,990 --> 00:06:18,110
laser stressor also lately there was

135
00:06:18,110 --> 00:06:20,660
four virus bulletin simon pegg published

136
00:06:20,660 --> 00:06:23,990
about why fetch which was a vigilant a

137
00:06:23,990 --> 00:06:26,240
worm that of IOT which was cleaning the

138
00:06:26,240 --> 00:06:29,720
other infections and lately we saw that

139
00:06:29,720 --> 00:06:32,419
it could have future targets like the

140
00:06:32,419 --> 00:06:34,580
hello Barbie which has Wi-Fi and which

141
00:06:34,580 --> 00:06:37,039
has been proven to be insecure already

142
00:06:37,039 --> 00:06:38,849
so no malware I think

143
00:06:38,849 --> 00:06:40,889
yet on this one but it's definitely a

144
00:06:40,889 --> 00:06:44,610
future target so we're taught we say i

145
00:06:44,610 --> 00:06:47,069
OT but is this really about things right

146
00:06:47,069 --> 00:06:49,409
now so no the point i want to make here

147
00:06:49,409 --> 00:06:51,569
is not yet coyote has been mostly

148
00:06:51,569 --> 00:06:53,699
collateral damage so that's why the

149
00:06:53,699 --> 00:06:55,679
focus of this talk is embedded linux

150
00:06:55,679 --> 00:06:58,349
which is i feel more accurate

151
00:06:58,349 --> 00:07:01,409
description of where the malware is so

152
00:07:01,409 --> 00:07:03,300
what is affected again you know

153
00:07:03,300 --> 00:07:05,939
leveraging very the network capabilities

154
00:07:05,939 --> 00:07:07,919
and the position and the weak security

155
00:07:07,919 --> 00:07:12,029
is consumer routers or how i would

156
00:07:12,029 --> 00:07:13,949
prefer to present them based on their

157
00:07:13,949 --> 00:07:19,469
security a ton of crap so I understand

158
00:07:19,469 --> 00:07:21,269
it's not that great security is not

159
00:07:21,269 --> 00:07:22,769
great there's market pressure and

160
00:07:22,769 --> 00:07:24,869
everything but still things will have to

161
00:07:24,869 --> 00:07:26,519
change and they started changing which

162
00:07:26,519 --> 00:07:31,289
is good but the industry or I don't know

163
00:07:31,289 --> 00:07:34,319
something we'll still have to to improve

164
00:07:34,319 --> 00:07:36,979
for example and men and men as a

165
00:07:36,979 --> 00:07:39,449
password things will have to change

166
00:07:39,449 --> 00:07:42,389
because right now the there is a cafe

167
00:07:42,389 --> 00:07:45,300
and blogged about AC surf payload which

168
00:07:45,300 --> 00:07:48,329
leveraged the so kind of defeating your

169
00:07:48,329 --> 00:07:50,789
firewall going to your router from the

170
00:07:50,789 --> 00:07:52,800
inside and then changing your

171
00:07:52,800 --> 00:07:53,909
configuration your DNS configuration

172
00:07:53,909 --> 00:07:57,809
which means that if you can randomize

173
00:07:57,809 --> 00:08:00,659
the password for the wpa key randomize

174
00:08:00,659 --> 00:08:02,249
the password for the end min please

175
00:08:02,249 --> 00:08:05,789
stuff like that you know so what kind of

176
00:08:05,789 --> 00:08:07,769
man where can we find on such insecure

177
00:08:07,769 --> 00:08:09,929
devices this is a list of this stuff I

178
00:08:09,929 --> 00:08:12,179
looked at while looking for a new

179
00:08:12,179 --> 00:08:14,759
version of Linux moose here you can see

180
00:08:14,759 --> 00:08:16,679
that lizard stressors actually gasket

181
00:08:16,679 --> 00:08:19,409
which has been which is more or less

182
00:08:19,409 --> 00:08:22,740
clear if you read crib cribs post but is

183
00:08:22,740 --> 00:08:24,990
clear when you look at the binary but

184
00:08:24,990 --> 00:08:26,879
these are all mostly Forks because they

185
00:08:26,879 --> 00:08:28,529
had access to source code so they are

186
00:08:28,529 --> 00:08:30,419
copy each other and add their own thing

187
00:08:30,419 --> 00:08:34,169
in it with this behind us let's dive

188
00:08:34,169 --> 00:08:37,259
into the Linux move story so first thing

189
00:08:37,259 --> 00:08:39,929
we learn analyzing Linux moves is the

190
00:08:39,929 --> 00:08:42,688
statically linked stripped binaries so

191
00:08:42,688 --> 00:08:44,480
statically linked means that the

192
00:08:44,480 --> 00:08:47,010
libraries are in lined into the binary

193
00:08:47,010 --> 00:08:49,319
and strip means no debugging symbols for

194
00:08:49,319 --> 00:08:51,190
all those who are not from

195
00:08:51,190 --> 00:08:54,520
so no imports means everything is inside

196
00:08:54,520 --> 00:08:57,230
and everything is bundled down to the

197
00:08:57,230 --> 00:09:00,050
colonel Cisco and the disassembler even

198
00:09:00,050 --> 00:09:02,360
if you have one so if an if you have the

199
00:09:02,360 --> 00:09:04,940
big ass version of either with the arm

200
00:09:04,940 --> 00:09:07,280
disassembler it doesn't help you because

201
00:09:07,280 --> 00:09:09,560
there is just a ton of C code and

202
00:09:09,560 --> 00:09:11,360
nothing makes any sense beside the

203
00:09:11,360 --> 00:09:13,160
Cisco's which are hard-coded and which

204
00:09:13,160 --> 00:09:16,160
either doesn't even map you need to look

205
00:09:16,160 --> 00:09:17,870
at the dot H file for the Linux kernel

206
00:09:17,870 --> 00:09:20,390
and then manually or through an either

207
00:09:20,390 --> 00:09:24,320
script Matt them so just to give you a

208
00:09:24,320 --> 00:09:28,850
sense this this is how the Linux smooth

209
00:09:28,850 --> 00:09:31,280
binary looks in either so this as you

210
00:09:31,280 --> 00:09:34,150
can see is we see in those three pages

211
00:09:34,150 --> 00:09:37,430
33 lines of functions out of 500

212
00:09:37,430 --> 00:09:39,800
functions so this is only the beginning

213
00:09:39,800 --> 00:09:44,330
of the of the whole thing now the the

214
00:09:44,330 --> 00:09:46,520
code is not simple to analyze let's take

215
00:09:46,520 --> 00:09:49,010
as an example if you try to debug the

216
00:09:49,010 --> 00:09:51,170
printf just so you get a sense of how

217
00:09:51,170 --> 00:09:53,360
complicated it is to do to deal with

218
00:09:53,360 --> 00:09:56,060
statically linked to binaries so this is

219
00:09:56,060 --> 00:09:58,070
the printf family of course in this

220
00:09:58,070 --> 00:09:59,780
there is no Cisco that are directly

221
00:09:59,780 --> 00:10:01,520
everything will go through that puts the

222
00:10:01,520 --> 00:10:03,860
skull which is really deeper and

223
00:10:03,860 --> 00:10:07,220
anything so this small piece of the

224
00:10:07,220 --> 00:10:09,320
proximity graph of either is part of

225
00:10:09,320 --> 00:10:11,990
this larger as you can see the pattern

226
00:10:11,990 --> 00:10:16,880
the middle so this is still all printf

227
00:10:16,880 --> 00:10:19,220
and nut functions but group of functions

228
00:10:19,220 --> 00:10:21,800
and you can see the vb printf enter know

229
00:10:21,800 --> 00:10:24,410
so most of the external interfaces SN

230
00:10:24,410 --> 00:10:26,960
printf s printf are all calling at some

231
00:10:26,960 --> 00:10:29,090
point V print underscore VF printf

232
00:10:29,090 --> 00:10:32,750
internal this function we have to go

233
00:10:32,750 --> 00:10:35,960
deeper to reach it is like looks like

234
00:10:35,960 --> 00:10:39,080
this so again I want to stress that you

235
00:10:39,080 --> 00:10:42,350
this is all there is no single sis

236
00:10:42,350 --> 00:10:45,380
called in this code so you you're not

237
00:10:45,380 --> 00:10:47,060
sure if you are in malware code or if

238
00:10:47,060 --> 00:10:49,820
you are in in library code at this point

239
00:10:49,820 --> 00:10:51,790
unless you know your printf

240
00:10:51,790 --> 00:10:53,690
implementation by the look of its graph

241
00:10:53,690 --> 00:10:57,140
and so you have to look it up the echo

242
00:10:57,140 --> 00:10:59,360
systemics makes it even worse because

243
00:10:59,360 --> 00:11:01,810
the lipsy are always changing so

244
00:11:01,810 --> 00:11:04,579
compiled binaries will change often

245
00:11:04,579 --> 00:11:06,470
and the either flirt signatures for

246
00:11:06,470 --> 00:11:10,009
these type of architecture is I it never

247
00:11:10,009 --> 00:11:11,869
worked in my in all the samples I looked

248
00:11:11,869 --> 00:11:13,910
at so it might there might be some

249
00:11:13,910 --> 00:11:15,649
tricks I don't know and I'm open to

250
00:11:15,649 --> 00:11:18,920
suggestions if there's any also there

251
00:11:18,920 --> 00:11:21,739
are variable various see library so you

252
00:11:21,739 --> 00:11:25,670
have new see lipsy a jdbc jdbc muzzle

253
00:11:25,670 --> 00:11:28,009
and a lot of other see libraries which

254
00:11:28,009 --> 00:11:31,009
again any binary which you have C code

255
00:11:31,009 --> 00:11:33,110
can be linked against and so it would

256
00:11:33,110 --> 00:11:35,360
have you start your analysis from

257
00:11:35,360 --> 00:11:38,329
scratch if it's a different c library so

258
00:11:38,329 --> 00:11:41,269
the lesson that we learned here is what

259
00:11:41,269 --> 00:11:44,059
we tried at first to map the cisco with

260
00:11:44,059 --> 00:11:47,689
an Ida script but there was still too

261
00:11:47,689 --> 00:11:49,639
much a code to reverse engineer because

262
00:11:49,639 --> 00:11:52,100
as the example I just gave going back

263
00:11:52,100 --> 00:11:54,470
through the put Cisco up to the printf

264
00:11:54,470 --> 00:11:56,899
we were still not sure in which part of

265
00:11:56,899 --> 00:11:58,970
the code we were we win malware Cole who

266
00:11:58,970 --> 00:12:01,579
were we in a printf it wasn't clear so

267
00:12:01,579 --> 00:12:03,559
we still provide the tool just in case

268
00:12:03,559 --> 00:12:06,079
if anyone wants to use it but we found a

269
00:12:06,079 --> 00:12:08,720
better solution so what we did is we

270
00:12:08,720 --> 00:12:10,549
reproduce the environment so the

271
00:12:10,549 --> 00:12:12,499
architecture lipstick and compiler

272
00:12:12,499 --> 00:12:15,019
version we built libraries with symbol

273
00:12:15,019 --> 00:12:17,149
under the same condition and then we

274
00:12:17,149 --> 00:12:19,209
used in diff to map library functions

275
00:12:19,209 --> 00:12:22,519
and then we were able to focus on an

276
00:12:22,519 --> 00:12:25,009
hour code so it sounds easier than it

277
00:12:25,009 --> 00:12:29,029
actually is but maybe maybe not maybe we

278
00:12:29,029 --> 00:12:31,160
find we think we're clever but we were

279
00:12:31,160 --> 00:12:33,649
not it's actually market seems idea

280
00:12:33,649 --> 00:12:36,379
another colleague at ISA and here's what

281
00:12:36,379 --> 00:12:38,989
it looks like so in this specific case

282
00:12:38,989 --> 00:12:42,100
of Linux moves we used you see lipsy

283
00:12:42,100 --> 00:12:47,360
0909 that 33 which we compiled using the

284
00:12:47,360 --> 00:12:49,309
open wrt tool chain so this is probably

285
00:12:49,309 --> 00:12:51,199
what the malware author are using to

286
00:12:51,199 --> 00:12:56,179
compile the solution more than 225

287
00:12:56,179 --> 00:12:58,699
functions were mapped with a high

288
00:12:58,699 --> 00:13:04,850
confidence and high similarity rating so

289
00:13:04,850 --> 00:13:07,069
we didn't even have to think about like

290
00:13:07,069 --> 00:13:08,839
oh should we import it or should we look

291
00:13:08,839 --> 00:13:11,509
at it like 225 we're done like select

292
00:13:11,509 --> 00:13:13,819
all and then just import and so stuff

293
00:13:13,819 --> 00:13:16,860
like str n compare f gets

294
00:13:16,860 --> 00:13:18,870
I net-net top opens ear we're all

295
00:13:18,870 --> 00:13:21,870
straight imported into the moose library

296
00:13:21,870 --> 00:13:24,510
and so it really really helped us kick

297
00:13:24,510 --> 00:13:26,880
start this investigation so the lesson

298
00:13:26,880 --> 00:13:30,300
zero is going down to Siskel is too long

299
00:13:30,300 --> 00:13:33,090
and large binaries find a close match of

300
00:13:33,090 --> 00:13:34,770
a seal of your c library build it with

301
00:13:34,770 --> 00:13:36,720
symbols and then build if it or maybe we

302
00:13:36,720 --> 00:13:38,520
could have flirted at this point which

303
00:13:38,520 --> 00:13:40,620
is something I'm not familiar with this

304
00:13:40,620 --> 00:13:42,600
is why we went with winzip since we had

305
00:13:42,600 --> 00:13:45,860
licenses and we were comfortable with

306
00:13:45,860 --> 00:13:48,150
another lesson that we learned is be

307
00:13:48,150 --> 00:13:50,370
careful of strings and AV variant names

308
00:13:50,370 --> 00:13:53,790
so in the specific linux moose case the

309
00:13:53,790 --> 00:13:56,610
AV variant names were all might be a

310
00:13:56,610 --> 00:13:58,250
little bit small so I'll spread it out

311
00:13:58,250 --> 00:14:01,830
so a Bitcoin miner or Bitcoin miner

312
00:14:01,830 --> 00:14:05,700
related ESET had the agent that p but so

313
00:14:05,700 --> 00:14:07,590
when we first look at it we were like

314
00:14:07,590 --> 00:14:09,750
okay so this is a minor thing so we were

315
00:14:09,750 --> 00:14:11,820
really looking for Bitcoin mining

316
00:14:11,820 --> 00:14:15,120
features and the the binary only to

317
00:14:15,120 --> 00:14:17,760
realize that it was killing Bitcoin

318
00:14:17,760 --> 00:14:23,190
miners inside the feature set of the

319
00:14:23,190 --> 00:14:25,710
demo where it was actually looking for

320
00:14:25,710 --> 00:14:27,780
processes of Bitcoin miners and killing

321
00:14:27,780 --> 00:14:30,150
them and it was flagged as other AV as a

322
00:14:30,150 --> 00:14:32,040
Bitcoin miner because of those strings

323
00:14:32,040 --> 00:14:36,450
which again is Miss classification so

324
00:14:36,450 --> 00:14:38,430
everyone gets bad Intel we think it's a

325
00:14:38,430 --> 00:14:41,820
minor but it's not actually another

326
00:14:41,820 --> 00:14:44,280
thing that happened is we found a

327
00:14:44,280 --> 00:14:49,410
hostname inside the strings so at some

328
00:14:49,410 --> 00:14:50,610
point we were collaborating with

329
00:14:50,610 --> 00:14:53,850
external entities on the research and we

330
00:14:53,850 --> 00:14:56,040
they told us after the fact that they

331
00:14:56,040 --> 00:14:58,740
requested a takedown on the get cool

332
00:14:58,740 --> 00:15:00,810
calm domain which is in the strings that

333
00:15:00,810 --> 00:15:04,710
is here and so I was like first this is

334
00:15:04,710 --> 00:15:07,170
not cool your iShare you a sample and

335
00:15:07,170 --> 00:15:09,030
you go and take down a domain without

336
00:15:09,030 --> 00:15:11,700
asking asking me first not cool and

337
00:15:11,700 --> 00:15:15,420
which like the it was funny because in

338
00:15:15,420 --> 00:15:16,860
the end it turns out that this was

339
00:15:16,860 --> 00:15:20,100
completely unrelated it's a fixed host

340
00:15:20,100 --> 00:15:22,680
header used by them our so the lesson

341
00:15:22,680 --> 00:15:25,380
again is you know be careful with the

342
00:15:25,380 --> 00:15:28,370
strings that you see and also don't do

343
00:15:28,370 --> 00:15:30,600
stuff or take down bay

344
00:15:30,600 --> 00:15:32,459
than other people's research please get

345
00:15:32,459 --> 00:15:36,480
in touch first so now going into the

346
00:15:36,480 --> 00:15:39,029
design of the malware first thumbs up

347
00:15:39,029 --> 00:15:41,190
for them our operators misleading

348
00:15:41,190 --> 00:15:43,620
strings it creates confusion in the

349
00:15:43,620 --> 00:15:48,000
industry good job now if we look at the

350
00:15:48,000 --> 00:15:51,060
DNA our description the gory details of

351
00:15:51,060 --> 00:15:52,860
this are all and the report that we

352
00:15:52,860 --> 00:15:56,100
released in may end of may but will

353
00:15:56,100 --> 00:15:59,430
summarize some of it so Lenox mousse was

354
00:15:59,430 --> 00:16:02,339
discovered in November 2014 thoroughly

355
00:16:02,339 --> 00:16:04,620
analyzed in early 2015 and we publish

356
00:16:04,620 --> 00:16:06,300
the report as I just said in late May

357
00:16:06,300 --> 00:16:09,810
and then after i went to recon and it

358
00:16:09,810 --> 00:16:12,480
was but conf cfp right after the recon

359
00:16:12,480 --> 00:16:14,339
hangover so i was like oh cool i never

360
00:16:14,339 --> 00:16:15,540
presented this know where i need to

361
00:16:15,540 --> 00:16:19,350
write the cfp that's why I'm here so

362
00:16:19,350 --> 00:16:21,899
Linux moves just get this out of the way

363
00:16:21,899 --> 00:16:24,959
why moves well it's named after a string

364
00:16:24,959 --> 00:16:27,569
Ilan present and the malware is acute

365
00:16:27,569 --> 00:16:31,829
able Ilan is French for moose so Ella

366
00:16:31,829 --> 00:16:37,829
which I would see in French illa illa so

367
00:16:37,829 --> 00:16:42,660
there's the French Canadian French

368
00:16:42,660 --> 00:16:47,399
Canadian is illa a yellow in the French

369
00:16:47,399 --> 00:16:49,850
French

370
00:16:53,769 --> 00:16:58,279
which is this animal and so I know you

371
00:16:58,279 --> 00:17:00,740
don't have around here I don't think

372
00:17:00,740 --> 00:17:04,280
there's many so but after we released

373
00:17:04,280 --> 00:17:06,799
the paper some other people had better

374
00:17:06,799 --> 00:17:11,839
ideas for the l a-- string which was the

375
00:17:11,839 --> 00:17:14,720
Lotus Ella so thanks to internet

376
00:17:14,720 --> 00:17:18,290
crowdsourcing or also there is a slavic

377
00:17:18,290 --> 00:17:22,939
rock band from the 70's late 60s called

378
00:17:22,939 --> 00:17:28,910
Ella hat hat tip to robert Lepofsky for

379
00:17:28,910 --> 00:17:32,559
this less obvious reference for canadian

380
00:17:32,559 --> 00:17:37,010
yeah so but joking aside the sample

381
00:17:37,010 --> 00:17:38,929
itself is a statically linked strip of

382
00:17:38,929 --> 00:17:43,610
binary day we found arm at the 22

383
00:17:43,610 --> 00:17:47,660
variants of targeting to a bis mmm it's

384
00:17:47,660 --> 00:17:50,059
in both little and big engine variants

385
00:17:50,059 --> 00:17:53,540
we found absolutely nothing no x86

386
00:17:53,540 --> 00:17:58,880
sample so no x-rays for us and the cnc

387
00:17:58,880 --> 00:18:01,730
IP was an integral form buried in the

388
00:18:01,730 --> 00:18:03,980
code so no no strings to reveal the cnc

389
00:18:03,980 --> 00:18:05,990
IP like most of the lizard squad stuff

390
00:18:05,990 --> 00:18:09,409
hat still has so thumbs up MIPS arm

391
00:18:09,409 --> 00:18:12,620
statically linked strip no x86 good job

392
00:18:12,620 --> 00:18:16,370
it took it a long time bad job the

393
00:18:16,370 --> 00:18:18,500
strings were not associated you can do

394
00:18:18,500 --> 00:18:21,770
better next time so on a more serious

395
00:18:21,770 --> 00:18:24,980
note without the network capabilities it

396
00:18:24,980 --> 00:18:27,970
can pivot through firewall so it's

397
00:18:27,970 --> 00:18:30,140
infecting routers so that the routers

398
00:18:30,140 --> 00:18:33,590
are besides the network and it will it

399
00:18:33,590 --> 00:18:36,950
has a stun type net reversal capability

400
00:18:36,950 --> 00:18:40,580
so if you have 10 telnet listening host

401
00:18:40,580 --> 00:18:43,520
it could even if you are firewall like

402
00:18:43,520 --> 00:18:46,460
DMZ style with like no outbound access

403
00:18:46,460 --> 00:18:51,200
it could use randevu of itself if you

404
00:18:51,200 --> 00:18:53,750
want like kind of peer-to-peer to get

405
00:18:53,750 --> 00:18:56,000
deeper into your network stuff that we

406
00:18:56,000 --> 00:18:58,350
didn't see really and use when we did

407
00:18:58,350 --> 00:19:01,049
analysis but it's it's possible by the

408
00:19:01,049 --> 00:19:03,600
by the design there's also a custom-made

409
00:19:03,600 --> 00:19:05,700
proxy service this is the main pillow

410
00:19:05,700 --> 00:19:09,150
that is used by the criminals and it's

411
00:19:09,150 --> 00:19:11,250
the the proxy service is only available

412
00:19:11,250 --> 00:19:13,410
to a set of authorized IP addresses

413
00:19:13,410 --> 00:19:16,799
which are decided by the CNC so there's

414
00:19:16,799 --> 00:19:19,590
no way to fingerprint the internet

415
00:19:19,590 --> 00:19:22,770
because of this list of authorized IP

416
00:19:22,770 --> 00:19:24,690
any connection that is not in that list

417
00:19:24,690 --> 00:19:27,090
will simply get a closed port and if you

418
00:19:27,090 --> 00:19:30,270
scan on a it's by the way listening on a

419
00:19:30,270 --> 00:19:34,549
specific port which is 10,000 and 0 73

420
00:19:34,549 --> 00:19:37,080
so if you scan the internet on this port

421
00:19:37,080 --> 00:19:38,850
and you see any firewall which do a

422
00:19:38,850 --> 00:19:41,460
close it will be have the same behavior

423
00:19:41,460 --> 00:19:43,650
as this proxy if you are not authorized

424
00:19:43,650 --> 00:19:46,280
so there was no way for us to map a

425
00:19:46,280 --> 00:19:48,450
population of the botnet using that

426
00:19:48,450 --> 00:19:50,760
feature it also has a remotely

427
00:19:50,760 --> 00:19:52,799
configured generic sniffer so it can

428
00:19:52,799 --> 00:19:56,429
sniff traffic and it's the strengths

429
00:19:56,429 --> 00:19:58,620
that it's interested in are provided by

430
00:19:58,620 --> 00:20:00,690
the command and control server and it

431
00:20:00,690 --> 00:20:05,070
has DNS hijacking features so lesson

432
00:20:05,070 --> 00:20:07,230
learn number two don't assume it's

433
00:20:07,230 --> 00:20:08,700
custom when it can be a standard

434
00:20:08,700 --> 00:20:10,650
protocol so I spent a lot of time

435
00:20:10,650 --> 00:20:14,929
looking at this reversing it and and

436
00:20:14,929 --> 00:20:18,450
like writing in the report in big

437
00:20:18,450 --> 00:20:21,840
details what was the proxy how it was

438
00:20:21,840 --> 00:20:24,090
supported I was interested by it because

439
00:20:24,090 --> 00:20:26,880
it's supported both sucks four and five

440
00:20:26,880 --> 00:20:30,809
and HTTP HTTPS at the same time but the

441
00:20:30,809 --> 00:20:33,390
sucks part was all documented by hand

442
00:20:33,390 --> 00:20:35,760
like oh the first byte is this after

443
00:20:35,760 --> 00:20:37,500
there is the IP after there's the port

444
00:20:37,500 --> 00:20:39,840
and then when we entered the peer review

445
00:20:39,840 --> 00:20:43,200
stage of the of the report a colleague

446
00:20:43,200 --> 00:20:44,820
of mine told me oh you know what you

447
00:20:44,820 --> 00:20:47,309
thoroughly described is actually a socks

448
00:20:47,309 --> 00:20:51,840
proxy just normal sucks so though I

449
00:20:51,840 --> 00:20:54,020
spent all this time writing all that

450
00:20:54,020 --> 00:20:56,610
description of sucks where I could so a

451
00:20:56,610 --> 00:20:59,159
lot of delete afterwards delete 23 pages

452
00:20:59,159 --> 00:21:03,710
and just it sucks d4 and d5

453
00:21:04,240 --> 00:21:07,190
so thumbs up for the design of having

454
00:21:07,190 --> 00:21:09,320
authorized IPS only as I said we

455
00:21:09,320 --> 00:21:11,120
couldn't fingerprint scan the internet

456
00:21:11,120 --> 00:21:12,530
because of that we tried some things

457
00:21:12,530 --> 00:21:14,690
with the rapid seven folks like if their

458
00:21:14,690 --> 00:21:16,670
net is present and the port is a shot

459
00:21:16,670 --> 00:21:18,800
and not estelle but it didn't work like

460
00:21:18,800 --> 00:21:24,080
we had crazy amounts of hosts so good

461
00:21:24,080 --> 00:21:27,440
job bad job cnc IP is our coded no

462
00:21:27,440 --> 00:21:30,080
fallback domain or no DGA we I know how

463
00:21:30,080 --> 00:21:34,730
much we all love djs now and it it was

464
00:21:34,730 --> 00:21:39,230
not there so yeah surprising so another

465
00:21:39,230 --> 00:21:41,810
thing that the linux moose does is the

466
00:21:41,810 --> 00:21:43,910
trying to spread itself through a

467
00:21:43,910 --> 00:21:46,730
worm-like behavior so this is a kind of

468
00:21:46,730 --> 00:21:48,920
a rough map of everything it will try to

469
00:21:48,920 --> 00:21:51,080
scan so it will try scan Internet at

470
00:21:51,080 --> 00:21:54,110
large but it will dedicate a lot of

471
00:21:54,110 --> 00:21:58,070
threads to scan the closely related IP

472
00:21:58,070 --> 00:22:01,430
addresses so not wide internet but

473
00:22:01,430 --> 00:22:03,530
really close and we assume that this is

474
00:22:03,530 --> 00:22:06,020
in order to find mistakes in firewall

475
00:22:06,020 --> 00:22:08,420
configuration who will who would block

476
00:22:08,420 --> 00:22:10,580
you know a lot of the IPS but if it's

477
00:22:10,580 --> 00:22:13,160
inside or nearby in ISPs for example

478
00:22:13,160 --> 00:22:15,560
then it would be allowed and in our

479
00:22:15,560 --> 00:22:19,190
monitoring we let the telnet a brute

480
00:22:19,190 --> 00:22:22,190
forcer run for a few days and we notice

481
00:22:22,190 --> 00:22:23,990
the success rate of the completely

482
00:22:23,990 --> 00:22:27,110
random scan versus the close by IPS and

483
00:22:27,110 --> 00:22:29,480
we notice that it it is effective it is

484
00:22:29,480 --> 00:22:31,700
something that seems to be bypassing

485
00:22:31,700 --> 00:22:34,760
some firewall rules and again another

486
00:22:34,760 --> 00:22:37,250
thread per each line interface where it

487
00:22:37,250 --> 00:22:41,860
will linear release can for telnet all

488
00:22:41,860 --> 00:22:48,440
of the thumbnail attack vector is a

489
00:22:48,440 --> 00:22:50,300
telnet credential brute force using a

490
00:22:50,300 --> 00:22:53,360
word list of 300 304 user and password

491
00:22:53,360 --> 00:22:56,360
entries which are provided by the cnc we

492
00:22:56,360 --> 00:22:59,570
monitored the cnc for a few months and

493
00:22:59,570 --> 00:23:02,060
the word list never changed and it was

494
00:23:02,060 --> 00:23:03,890
easy to find it on the internet so we

495
00:23:03,890 --> 00:23:08,000
use the list online here's a roughly the

496
00:23:08,000 --> 00:23:10,250
compromise protocol so what is really

497
00:23:10,250 --> 00:23:12,950
intriguing is that the cnc is actively

498
00:23:12,950 --> 00:23:16,510
involved during the compromise

499
00:23:16,700 --> 00:23:18,740
which is again and you know a design

500
00:23:18,740 --> 00:23:21,320
decision that will discuss but so what

501
00:23:21,320 --> 00:23:23,450
happens is victim information is sent to

502
00:23:23,450 --> 00:23:25,400
the C&C server and then the CNC sends

503
00:23:25,400 --> 00:23:28,280
obfuscated it commands with like Bozo

504
00:23:28,280 --> 00:23:32,510
crypto the the the router performing the

505
00:23:32,510 --> 00:23:34,070
infection will unscramble them and then

506
00:23:34,070 --> 00:23:36,050
send the commands directly to the victim

507
00:23:36,050 --> 00:23:39,020
via telnet to different mechanism to

508
00:23:39,020 --> 00:23:41,390
deliver the payload one was a double you

509
00:23:41,390 --> 00:23:44,540
get on the DM the router which means you

510
00:23:44,540 --> 00:23:46,670
can do we play attack and then obtain

511
00:23:46,670 --> 00:23:49,220
the binary but the other one was using

512
00:23:49,220 --> 00:23:52,700
echo with X escape character so so

513
00:23:52,700 --> 00:23:55,160
sending through the middle router a lot

514
00:23:55,160 --> 00:23:57,440
of echo echo echo echo and append on the

515
00:23:57,440 --> 00:24:00,230
file up until when the file would be

516
00:24:00,230 --> 00:24:03,680
complete on the victim and then enabling

517
00:24:03,680 --> 00:24:06,080
execution and executing it which is nice

518
00:24:06,080 --> 00:24:07,850
because there's no replay attack if

519
00:24:07,850 --> 00:24:10,250
you're not if you don't have full packet

520
00:24:10,250 --> 00:24:13,610
capture you cannot extract the binary so

521
00:24:13,610 --> 00:24:16,670
good design you it can perform cross

522
00:24:16,670 --> 00:24:19,100
arch infection meaning a mid sample can

523
00:24:19,100 --> 00:24:21,110
compromise an arm router and still

524
00:24:21,110 --> 00:24:25,850
deliver the right binary but if the CNC

525
00:24:25,850 --> 00:24:27,980
is down there is no more infection so

526
00:24:27,980 --> 00:24:30,290
cnc is really again a key witness in

527
00:24:30,290 --> 00:24:33,590
this design and something weird there's

528
00:24:33,590 --> 00:24:36,950
no persistence persistence sorry it's

529
00:24:36,950 --> 00:24:38,510
probably hard to do in a portable

530
00:24:38,510 --> 00:24:40,370
fashion this is something I was told

531
00:24:40,370 --> 00:24:42,440
after the virus bulletin where I gave a

532
00:24:42,440 --> 00:24:45,800
small talk on Linux moves it's true the

533
00:24:45,800 --> 00:24:47,570
flash memory and stuff like that

534
00:24:47,570 --> 00:24:50,300
probably makes it complicated and it's

535
00:24:50,300 --> 00:24:52,270
probably the reason why it's not done

536
00:24:52,270 --> 00:24:55,100
and also they can always come back they

537
00:24:55,100 --> 00:24:57,020
got in through week credentials and it

538
00:24:57,020 --> 00:24:59,720
was available from the internet it means

539
00:24:59,720 --> 00:25:03,860
that they can come back and another good

540
00:25:03,860 --> 00:25:06,050
design of Linux was it literally kills

541
00:25:06,050 --> 00:25:08,450
the competition so it will look for but

542
00:25:08,450 --> 00:25:11,540
Bitcoin miners did us anything that will

543
00:25:11,540 --> 00:25:14,060
fight for resources on the malware side

544
00:25:14,060 --> 00:25:16,420
and it will try to kill all of these

545
00:25:16,420 --> 00:25:19,630
processes every hour so in a nutshell

546
00:25:19,630 --> 00:25:22,850
this is how the the thing is laid out

547
00:25:22,850 --> 00:25:26,270
and on the purely from our analysis of

548
00:25:26,270 --> 00:25:30,520
the sample so propagation proxy server

549
00:25:30,520 --> 00:25:33,830
natura verso and also the generics Nefer

550
00:25:33,830 --> 00:25:37,700
that eavesdrop on the network lessons

551
00:25:37,700 --> 00:25:39,200
learned number three less reverse

552
00:25:39,200 --> 00:25:41,750
engineering more honey pot because we

553
00:25:41,750 --> 00:25:45,560
were stuck we we had all this

554
00:25:45,560 --> 00:25:47,300
understanding but we still didn't know

555
00:25:47,300 --> 00:25:49,580
what was going on with the threat what

556
00:25:49,580 --> 00:25:54,230
was the goal so we deployed a Q mu vm in

557
00:25:54,230 --> 00:25:59,480
the cloud so Debian maps q mu image have

558
00:25:59,480 --> 00:26:01,310
it reachable from the internet before it

559
00:26:01,310 --> 00:26:02,810
it was reachable from the internet we

560
00:26:02,810 --> 00:26:04,520
had nothing when it wants it became

561
00:26:04,520 --> 00:26:07,630
reachable things really start the moving

562
00:26:07,630 --> 00:26:09,680
so we watched it behave and we

563
00:26:09,680 --> 00:26:11,750
firewalled it to avoid infecting other

564
00:26:11,750 --> 00:26:15,950
people with our our things so if you

565
00:26:15,950 --> 00:26:17,960
want some hints the RL images are

566
00:26:17,960 --> 00:26:20,630
already pre-done prepackaged and here's

567
00:26:20,630 --> 00:26:23,090
a cue a new command which is the nice

568
00:26:23,090 --> 00:26:25,580
way to use and easy to deploy in the

569
00:26:25,580 --> 00:26:27,620
cloud so you can copy that once the

570
00:26:27,620 --> 00:26:30,050
slide will be available so the lesson

571
00:26:30,050 --> 00:26:32,060
that we've learned here was we were too

572
00:26:32,060 --> 00:26:35,030
careful I like coded a fake server and

573
00:26:35,030 --> 00:26:36,740
had like everything done in isolated

574
00:26:36,740 --> 00:26:38,870
environment and at the end in the end we

575
00:26:38,870 --> 00:26:41,270
went yellow and we gathered a lot of

576
00:26:41,270 --> 00:26:43,310
information and it really helped DNA

577
00:26:43,310 --> 00:26:47,030
analysis so thumbs up it was a hard to

578
00:26:47,030 --> 00:26:50,060
track malware we had a hard time

579
00:26:50,060 --> 00:26:52,040
reproducing the environment necessary to

580
00:26:52,040 --> 00:26:54,800
be able to understand the operation so

581
00:26:54,800 --> 00:26:59,240
moves hurting so it has a potential for

582
00:26:59,240 --> 00:27:01,280
espionage because of the packet sniffer

583
00:27:01,280 --> 00:27:03,590
it has infiltration capabilities because

584
00:27:03,590 --> 00:27:06,830
of natural versa land and spreading past

585
00:27:06,830 --> 00:27:09,160
firewalls what are they using it for

586
00:27:09,160 --> 00:27:11,960
fortunately well first thing realize it

587
00:27:11,960 --> 00:27:15,860
is it was sniffing cookies for social

588
00:27:15,860 --> 00:27:18,980
media sites which we had preferred more

589
00:27:18,980 --> 00:27:21,470
apt type you know the first Linux apt

590
00:27:21,470 --> 00:27:22,850
stuff like that would have been nice but

591
00:27:22,850 --> 00:27:26,210
no social media and we were like what

592
00:27:26,210 --> 00:27:29,810
sniffing HTTPS cookies hmm because all

593
00:27:29,810 --> 00:27:32,600
of these cookies are now all on HTTPS

594
00:27:32,600 --> 00:27:35,690
only so for us it was again a weird

595
00:27:35,690 --> 00:27:38,210
thing you know then we started looking

596
00:27:38,210 --> 00:27:43,610
at the proxy usage so the 1000 73 port

597
00:27:43,610 --> 00:27:44,300
that is you

598
00:27:44,300 --> 00:27:47,300
we in the next few slides we will look

599
00:27:47,300 --> 00:27:48,710
at the nature of the traffic the

600
00:27:48,710 --> 00:27:52,540
protocol the targeted social networks

601
00:27:52,540 --> 00:27:56,150
here in blue the higher line is the

602
00:27:56,150 --> 00:27:59,360
number of requests per day done on the

603
00:27:59,360 --> 00:28:02,420
proxy of our Annie pot and in blue is

604
00:28:02,420 --> 00:28:05,980
social media network related traffic in

605
00:28:05,980 --> 00:28:09,260
the light blue is other so there's none

606
00:28:09,260 --> 00:28:12,770
it's all zeros and it in the orange it's

607
00:28:12,770 --> 00:28:15,710
but net traffic so a little bit of meta

608
00:28:15,710 --> 00:28:17,870
traffic but most of it was social

609
00:28:17,870 --> 00:28:19,880
networks so even throughout the months

610
00:28:19,880 --> 00:28:22,010
that we monitored this threat we didn't

611
00:28:22,010 --> 00:28:24,560
see the operator using it as a VPN we

612
00:28:24,560 --> 00:28:26,810
didn't see any things like that it was

613
00:28:26,810 --> 00:28:31,250
really only doing performing requests on

614
00:28:31,250 --> 00:28:35,240
several social networks so if if we look

615
00:28:35,240 --> 00:28:37,340
at the rundown of the protocol four

616
00:28:37,340 --> 00:28:39,620
percent of operator HTTP eighteen

617
00:28:39,620 --> 00:28:42,950
percent of social network but accessed

618
00:28:42,950 --> 00:28:45,560
through HTTP all of it was Instagram all

619
00:28:45,560 --> 00:28:47,690
of the other social network were all

620
00:28:47,690 --> 00:28:52,340
htps and the HTTPS allowed us to look at

621
00:28:52,340 --> 00:28:54,200
the certificate because due to the

622
00:28:54,200 --> 00:28:55,850
nature of the socks proxy we would only

623
00:28:55,850 --> 00:28:58,640
see the IP addresses and IP addresses

624
00:28:58,640 --> 00:29:01,520
nowadays always or most always resolved

625
00:29:01,520 --> 00:29:04,340
to cloud addresses so you reach AWS

626
00:29:04,340 --> 00:29:06,740
you're not sure who was the original

627
00:29:06,740 --> 00:29:08,720
intention you know was it Instagram was

628
00:29:08,720 --> 00:29:12,320
it Twitter with another or also a lot of

629
00:29:12,320 --> 00:29:16,100
CD ends in that traffic and so https

630
00:29:16,100 --> 00:29:17,840
enabled us because of the certificate

631
00:29:17,840 --> 00:29:20,420
and the CN in the certificate to

632
00:29:20,420 --> 00:29:22,130
understand what social networks were

633
00:29:22,130 --> 00:29:23,930
targeted and here's a rundown of the

634
00:29:23,930 --> 00:29:28,130
HTTPS traffic so the under the right

635
00:29:28,130 --> 00:29:31,520
hand side you see an extrapolation of

636
00:29:31,520 --> 00:29:33,440
the three percent of others so don't get

637
00:29:33,440 --> 00:29:35,810
fooled by that there's a very little Yin

638
00:29:35,810 --> 00:29:40,130
decks it's not a big big part but so the

639
00:29:40,130 --> 00:29:41,720
biggest social network targeted was

640
00:29:41,720 --> 00:29:45,260
Twitter or n vine which they use the C

641
00:29:45,260 --> 00:29:48,550
names are like colliding Instagram

642
00:29:48,550 --> 00:29:51,800
second and then others like YouTube

643
00:29:51,800 --> 00:29:53,990
Yandex yeah who and a quite a lot of

644
00:29:53,990 --> 00:29:56,890
soundcloud also

645
00:29:56,890 --> 00:30:00,610
so yes a lot of HTTPS but we digged into

646
00:30:00,610 --> 00:30:04,960
the HTTP that we saw this is the only

647
00:30:04,960 --> 00:30:07,480
HTTP traffic that was available was as

648
00:30:07,480 --> 00:30:10,290
you can see in number to an upgrade to

649
00:30:10,290 --> 00:30:13,810
https so the the only thing we had was

650
00:30:13,810 --> 00:30:16,270
the the location of the first hit the

651
00:30:16,270 --> 00:30:19,480
first get if you want in number one and

652
00:30:19,480 --> 00:30:22,630
this is how we based our the following

653
00:30:22,630 --> 00:30:26,350
slides of what we think it's doing so as

654
00:30:26,350 --> 00:30:28,510
an example we looked at one of the user

655
00:30:28,510 --> 00:30:30,790
that was fetched and we tracked it

656
00:30:30,790 --> 00:30:33,730
through time so the the pattern was they

657
00:30:33,730 --> 00:30:35,560
are created and then a few hours later

658
00:30:35,560 --> 00:30:39,520
there there is around always below 50

659
00:30:39,520 --> 00:30:41,620
that the accounts that was newly created

660
00:30:41,620 --> 00:30:45,100
follows and then we looked at what they

661
00:30:45,100 --> 00:30:46,780
are following and we notice that they

662
00:30:46,780 --> 00:30:49,150
follow each other so a lot of cross

663
00:30:49,150 --> 00:30:51,820
referencing and once in a while they

664
00:30:51,820 --> 00:30:53,680
will follow some accounts which looks

665
00:30:53,680 --> 00:30:55,720
more like either business or models

666
00:30:55,720 --> 00:30:57,250
there were a lot of traffic around

667
00:30:57,250 --> 00:31:02,050
modeling and so in this case cine seems

668
00:31:02,050 --> 00:31:04,540
to be a kind of a wedding type business

669
00:31:04,540 --> 00:31:07,060
so we looked at it when we first saw it

670
00:31:07,060 --> 00:31:10,170
it was tree they had 2,000 followers and

671
00:31:10,170 --> 00:31:13,150
only seven posts and following seven

672
00:31:13,150 --> 00:31:15,460
people and they have no internet

673
00:31:15,460 --> 00:31:17,470
presence beside their Instagram so it's

674
00:31:17,470 --> 00:31:19,990
not you know oh we have a big business

675
00:31:19,990 --> 00:31:21,820
and we launched something on Instagram

676
00:31:21,820 --> 00:31:23,620
on this side it's more the other way

677
00:31:23,620 --> 00:31:26,140
around Instagram seem to be their main

678
00:31:26,140 --> 00:31:29,590
operation and then one week after so we

679
00:31:29,590 --> 00:31:33,210
went from 3,000 following follower to

680
00:31:33,210 --> 00:31:37,150
11,000 and 600 adding a few pictures and

681
00:31:37,150 --> 00:31:39,190
following one new account and still no

682
00:31:39,190 --> 00:31:41,650
big internet presence so for us it was

683
00:31:41,650 --> 00:31:44,770
enough evidence to without like we did

684
00:31:44,770 --> 00:31:47,380
the best we could but enough evidence to

685
00:31:47,380 --> 00:31:50,320
to assess that it's probably a button

686
00:31:50,320 --> 00:31:52,510
that is used to do social media follows

687
00:31:52,510 --> 00:31:55,810
like views and stuff like that so fraud

688
00:31:55,810 --> 00:31:58,450
hidden and hcps good job because this

689
00:31:58,450 --> 00:32:01,270
really make our job of assessing impact

690
00:32:01,270 --> 00:32:03,340
and convincing people it's important

691
00:32:03,340 --> 00:32:05,890
harder the proof is not as strong as it

692
00:32:05,890 --> 00:32:09,550
could be except Instagram first it sorry

693
00:32:09,550 --> 00:32:11,730
guy you forgot

694
00:32:11,730 --> 00:32:14,980
so in a nutshell what we have in the

695
00:32:14,980 --> 00:32:18,070
operation is stolen cookies social

696
00:32:18,070 --> 00:32:21,640
network fraud and focus on reproduction

697
00:32:21,640 --> 00:32:25,420
spreading these are the operation than

698
00:32:25,420 --> 00:32:27,730
by the thing and you know in here the

699
00:32:27,730 --> 00:32:29,440
victim the guy besides the root the

700
00:32:29,440 --> 00:32:31,990
router is not really a real victim and

701
00:32:31,990 --> 00:32:34,980
this is why the botnet might not be as

702
00:32:34,980 --> 00:32:38,530
interesting for as a takedown or

703
00:32:38,530 --> 00:32:40,990
whatever the as soon as you reboot your

704
00:32:40,990 --> 00:32:43,000
router it's clean right because there's

705
00:32:43,000 --> 00:32:44,950
no persistent mechanism so what happens

706
00:32:44,950 --> 00:32:47,650
when your internet goes bad or you don't

707
00:32:47,650 --> 00:32:49,720
understand and for example what will

708
00:32:49,720 --> 00:32:53,020
happen in this case is the router we run

709
00:32:53,020 --> 00:32:55,540
out of memory because they spawn 35

710
00:32:55,540 --> 00:32:57,220
threads and they do all this kind of

711
00:32:57,220 --> 00:33:00,610
stuff memory management is minimal so so

712
00:33:00,610 --> 00:33:02,170
what will happen is you will start

713
00:33:02,170 --> 00:33:03,550
having problems with your internet you

714
00:33:03,550 --> 00:33:05,290
reboot your router your cleaned and now

715
00:33:05,290 --> 00:33:07,780
you can you can you know move on so no

716
00:33:07,780 --> 00:33:10,600
one it's really designed to stay under

717
00:33:10,600 --> 00:33:13,690
the radar it feels so latest

718
00:33:13,690 --> 00:33:16,690
developments the impact of our

719
00:33:16,690 --> 00:33:19,450
whitepaper a few weeks after the

720
00:33:19,450 --> 00:33:22,780
publication is cnc went dark I wasn't

721
00:33:22,780 --> 00:33:25,660
contacted the hosting provider and I was

722
00:33:25,660 --> 00:33:29,290
trying to help to try to have access to

723
00:33:29,290 --> 00:33:32,290
the ip's i really wanted the eyepiece to

724
00:33:32,290 --> 00:33:33,880
assess the but Annette size and the

725
00:33:33,880 --> 00:33:38,320
impact and I eat only oh it's compromise

726
00:33:38,320 --> 00:33:40,570
its compromise it's not malicious I'm

727
00:33:40,570 --> 00:33:43,180
sure I said okay cool can I help clean

728
00:33:43,180 --> 00:33:44,980
it you know I will do it for free and

729
00:33:44,980 --> 00:33:47,050
you know I will rent you a server we

730
00:33:47,050 --> 00:33:50,320
will move on the side the the the

731
00:33:50,320 --> 00:33:53,110
infected guy and I will install I will

732
00:33:53,110 --> 00:33:56,170
you know take care of the I will rent a

733
00:33:56,170 --> 00:33:58,390
server installed the old I peas in it

734
00:33:58,390 --> 00:34:00,370
and then just you know gather traffic

735
00:34:00,370 --> 00:34:03,880
but it didn't happen I stopped hearing

736
00:34:03,880 --> 00:34:07,000
from him until we published and then

737
00:34:07,000 --> 00:34:08,590
when we publish it came back oh sorry I

738
00:34:08,590 --> 00:34:11,560
wasn't vacation for a long time I missed

739
00:34:11,560 --> 00:34:14,110
I forgot to reply to your email and then

740
00:34:14,110 --> 00:34:16,540
we were again close to have some kind of

741
00:34:16,540 --> 00:34:18,668
arrangement and again he went completely

742
00:34:18,668 --> 00:34:24,099
dark and at the same time this is I NC

743
00:34:24,099 --> 00:34:27,759
I see internet storm center port probe

744
00:34:27,759 --> 00:34:29,679
of the internet so this doesn't mean

745
00:34:29,679 --> 00:34:32,349
much you know but it's still probes that

746
00:34:32,349 --> 00:34:33,849
they have deployed everywhere on the

747
00:34:33,849 --> 00:34:36,009
internet that can roughly tell you the

748
00:34:36,009 --> 00:34:39,248
volume of traffic that they saw and this

749
00:34:39,248 --> 00:34:41,349
is beyond you know internet noise

750
00:34:41,349 --> 00:34:43,149
because internet noise looks like this

751
00:34:43,149 --> 00:34:46,719
you know the july-to-september part of

752
00:34:46,719 --> 00:34:48,609
the chart and so what happens is that

753
00:34:48,609 --> 00:34:50,529
the few weeks I was in contact

754
00:34:50,529 --> 00:34:52,210
afterwards and then at some point they

755
00:34:52,210 --> 00:34:54,279
probably for real clean the machine or

756
00:34:54,279 --> 00:34:57,069
and or remove them but unfortunately I

757
00:34:57,069 --> 00:34:59,109
couldn't get access to the IP addresses

758
00:34:59,109 --> 00:35:02,349
so again no no measure of impact this is

759
00:35:02,349 --> 00:35:04,269
activity on the port ten thousand and

760
00:35:04,269 --> 00:35:07,359
seventy-three so afterwards I was on the

761
00:35:07,359 --> 00:35:09,789
lookout for moose version two so I knew

762
00:35:09,789 --> 00:35:11,529
or I expected that they read the paper

763
00:35:11,529 --> 00:35:16,029
and I knew that they would you know some

764
00:35:16,029 --> 00:35:17,829
of the stuff that we said they would try

765
00:35:17,829 --> 00:35:19,989
to avoid it so that my Yahoo's my

766
00:35:19,989 --> 00:35:22,239
hunting rules must must be like trying

767
00:35:22,239 --> 00:35:24,670
to do you know plan ahead to beat the

768
00:35:24,670 --> 00:35:27,400
guys be cleverer than them but I still

769
00:35:27,400 --> 00:35:29,499
looked at a ton of samples because I

770
00:35:29,499 --> 00:35:31,690
expected them to upx the whole thing

771
00:35:31,690 --> 00:35:35,380
just and so defeat the yagos but still

772
00:35:35,380 --> 00:35:38,880
you know have it like stay the same and

773
00:35:38,880 --> 00:35:41,349
at some point we found an update right

774
00:35:41,349 --> 00:35:46,359
before virus bulletin it's it's using a

775
00:35:46,359 --> 00:35:48,700
new service port as as was expected

776
00:35:48,700 --> 00:35:51,069
since it was highlighted like this and

777
00:35:51,069 --> 00:35:55,390
the report they added cnc selection on

778
00:35:55,390 --> 00:35:58,119
the the CLI so the CNC server is no more

779
00:35:58,119 --> 00:36:00,460
in the binary it's when the malware is

780
00:36:00,460 --> 00:36:03,039
launched and since it has seen seek

781
00:36:03,039 --> 00:36:05,109
cooperation where as we saw in the

782
00:36:05,109 --> 00:36:08,440
compromised slide it will be able it's

783
00:36:08,440 --> 00:36:10,180
packed and Shannon pegar and slightly

784
00:36:10,180 --> 00:36:12,369
office catered so exhort in the code and

785
00:36:12,369 --> 00:36:15,819
it will use this new cnc another thing

786
00:36:15,819 --> 00:36:18,430
they did is the server returns a 404 on

787
00:36:18,430 --> 00:36:21,099
unknown hosts so I was able to get a

788
00:36:21,099 --> 00:36:23,829
sample I was able to get at the integer

789
00:36:23,829 --> 00:36:26,019
that was used to launch the sample but I

790
00:36:26,019 --> 00:36:28,989
tried recreating the an environment from

791
00:36:28,989 --> 00:36:32,380
a different IP and the CNC just never

792
00:36:32,380 --> 00:36:34,750
responded to the request of my new

793
00:36:34,750 --> 00:36:38,860
my new fake client if you want so we're

794
00:36:38,860 --> 00:36:41,020
still trying to get infected at this

795
00:36:41,020 --> 00:36:43,750
point now i have like open honey pots

796
00:36:43,750 --> 00:36:46,960
trying a tie with some passwords that i

797
00:36:46,960 --> 00:36:48,790
know we're in the list trying to be

798
00:36:48,790 --> 00:36:52,990
infected by this threat again and the

799
00:36:52,990 --> 00:36:54,820
goal is to this time do man in the

800
00:36:54,820 --> 00:36:57,880
middle of the ssl traffic and try to see

801
00:36:57,880 --> 00:37:01,470
if if the but will still was still

802
00:37:01,470 --> 00:37:05,890
connect so reading research paper and

803
00:37:05,890 --> 00:37:09,970
adapting thumbs up malware operator if

804
00:37:09,970 --> 00:37:15,100
we look at the traffic of the of the new

805
00:37:15,100 --> 00:37:17,170
version you can see that they had their

806
00:37:17,170 --> 00:37:20,260
kind of a vacation for the summer and

807
00:37:20,260 --> 00:37:22,930
then the the kick started in September

808
00:37:22,930 --> 00:37:25,210
the new version so this is the the port

809
00:37:25,210 --> 00:37:27,280
analysis the previous but Annette and

810
00:37:27,280 --> 00:37:30,660
the new port of the new the new version

811
00:37:30,660 --> 00:37:35,920
some takeaways we released some research

812
00:37:35,920 --> 00:37:37,960
artifacts so Python and shell script

813
00:37:37,960 --> 00:37:41,080
protocol dissectors the fake server code

814
00:37:41,080 --> 00:37:43,690
I've written a lot of it is T shark

815
00:37:43,690 --> 00:37:46,630
wrappers and right yarra rule and I oh

816
00:37:46,630 --> 00:37:50,020
sees everything is in the East sets

817
00:37:50,020 --> 00:37:54,720
github I know it's not a huge value but

818
00:37:54,720 --> 00:37:57,730
anyone like looking to do a net more

819
00:37:57,730 --> 00:38:00,640
network type analysis and research and I

820
00:38:00,640 --> 00:38:02,710
think the T shark stuff is pretty decent

821
00:38:02,710 --> 00:38:05,500
and I'm more of a network background and

822
00:38:05,500 --> 00:38:07,780
really familiar with these things so it

823
00:38:07,780 --> 00:38:10,720
might be some inspiration and you know

824
00:38:10,720 --> 00:38:13,180
if not for professional at least for

825
00:38:13,180 --> 00:38:16,800
someone who is trying to get started

826
00:38:16,800 --> 00:38:20,650
another takeaway is the embedded Linux

827
00:38:20,650 --> 00:38:24,280
malware is not yet complex but still the

828
00:38:24,280 --> 00:38:26,910
tools and the processes need to catch up

829
00:38:26,910 --> 00:38:31,180
the windows the stuff is definitely more

830
00:38:31,180 --> 00:38:33,340
complex advanced and hard to track but

831
00:38:33,340 --> 00:38:36,040
we have absolutely no visibility and

832
00:38:36,040 --> 00:38:37,990
without you know visibility we have a

833
00:38:37,990 --> 00:38:41,140
problem saying the impact or the number

834
00:38:41,140 --> 00:38:43,420
of infected hosts which makes it really

835
00:38:43,420 --> 00:38:46,480
harder to have a good good case and help

836
00:38:46,480 --> 00:38:48,160
convince people of the importance of the

837
00:38:48,160 --> 00:38:48,490
threat

838
00:38:48,490 --> 00:38:51,330
it is still a low-hanging fruit and

839
00:38:51,330 --> 00:38:54,850
prevention is really simple like right

840
00:38:54,850 --> 00:38:56,619
now what I started doing is every time I

841
00:38:56,619 --> 00:38:58,930
get into a new network I look the web

842
00:38:58,930 --> 00:39:01,030
administration interface of the router I

843
00:39:01,030 --> 00:39:04,630
I am I am connecting to and if i can get

844
00:39:04,630 --> 00:39:07,150
in but of course i do this at friend's

845
00:39:07,150 --> 00:39:08,860
home I don't do this in public settings

846
00:39:08,860 --> 00:39:11,830
but if I can get in with admin and men

847
00:39:11,830 --> 00:39:14,260
then I change the password take a post

848
00:39:14,260 --> 00:39:16,240
it right down the new password i chose

849
00:39:16,240 --> 00:39:18,280
for them and put the posted on the

850
00:39:18,280 --> 00:39:21,310
router itself the threats are doing this

851
00:39:21,310 --> 00:39:23,740
from the network from outside if you

852
00:39:23,740 --> 00:39:25,660
have physical access anyway you're

853
00:39:25,660 --> 00:39:27,850
screwed so i think this is just a good

854
00:39:27,850 --> 00:39:29,410
mean to race the security and the

855
00:39:29,410 --> 00:39:32,980
awareness of people around you so yeah I

856
00:39:32,980 --> 00:39:35,650
would say like friends don't let friends

857
00:39:35,650 --> 00:39:40,600
run routers with default credentials any

858
00:39:40,600 --> 00:39:46,410
question oops question

859
00:39:58,750 --> 00:40:03,010
so questions if you want to see the

860
00:40:03,010 --> 00:40:07,460
underwear again yeah sponsors are more

861
00:40:07,460 --> 00:40:17,650
important okay really no question

862
00:40:25,680 --> 00:40:29,970
no over there power is back on on on the

863
00:40:29,970 --> 00:40:33,780
right side um I was just thinking like

864
00:40:33,780 --> 00:40:35,460
would you suggest that maybe people

865
00:40:35,460 --> 00:40:37,740
should have some kind of a V running

866
00:40:37,740 --> 00:40:40,170
anuradha to prevent this in the future

867
00:40:40,170 --> 00:40:42,740
or at least you know detected early on

868
00:40:42,740 --> 00:40:48,809
so is it s secure or who released the

869
00:40:48,809 --> 00:40:53,849
new kind of router who will do f-secure

870
00:40:53,849 --> 00:40:55,619
so there's a new device you know who

871
00:40:55,619 --> 00:40:58,500
will do as suffice or f-secure f-secure

872
00:40:58,500 --> 00:41:01,650
sense so you see that some people and

873
00:41:01,650 --> 00:41:03,270
the market are trying to address this

874
00:41:03,270 --> 00:41:07,380
problem another thing that ESET is is

875
00:41:07,380 --> 00:41:09,359
working on and I know a vast also

876
00:41:09,359 --> 00:41:12,890
presented about it as VB is from the

877
00:41:12,890 --> 00:41:16,740
from your host your AV is trying to

878
00:41:16,740 --> 00:41:18,450
connect on your router and verifies if

879
00:41:18,450 --> 00:41:20,369
it's vulnerable and suggests sends you

880
00:41:20,369 --> 00:41:22,980
pop ups and suggest you to patch it they

881
00:41:22,980 --> 00:41:25,109
are legal you know potential pitfalls

882
00:41:25,109 --> 00:41:28,079
but I guess if you're already choosing

883
00:41:28,079 --> 00:41:30,569
correctly between home network business

884
00:41:30,569 --> 00:41:32,460
network and you know public network and

885
00:41:32,460 --> 00:41:34,920
the ad uses that information to know

886
00:41:34,920 --> 00:41:37,530
okay it's home I can scan and warn you

887
00:41:37,530 --> 00:41:38,849
that you have the false credentials I

888
00:41:38,849 --> 00:41:41,520
think these are like of course it

889
00:41:41,520 --> 00:41:44,010
shouldn't have come to this like this

890
00:41:44,010 --> 00:41:47,280
bad but I think it's a fair solution but

891
00:41:47,280 --> 00:41:49,589
running security solution on routers I

892
00:41:49,589 --> 00:41:56,790
don't think is realistic hi my question

893
00:41:56,790 --> 00:41:58,650
goes to the to the development

894
00:41:58,650 --> 00:42:00,569
environment type of things so you said

895
00:42:00,569 --> 00:42:02,040
you had a bit of a hard time to

896
00:42:02,040 --> 00:42:03,930
reproduce this development environment

897
00:42:03,930 --> 00:42:05,309
do you think there's a lot of

898
00:42:05,309 --> 00:42:07,619
variability in this development

899
00:42:07,619 --> 00:42:11,010
environment and second sub questions so

900
00:42:11,010 --> 00:42:13,380
to speak is have you have you checked if

901
00:42:13,380 --> 00:42:15,599
there's like artifacts between the first

902
00:42:15,599 --> 00:42:18,030
and the second second version of that

903
00:42:18,030 --> 00:42:21,030
threat that you seen which make you like

904
00:42:21,030 --> 00:42:24,540
infer their development environment

905
00:42:24,540 --> 00:42:26,430
things like GCC versions or something

906
00:42:26,430 --> 00:42:30,329
that so for the the first version we saw

907
00:42:30,329 --> 00:42:32,760
we were very sure that they're running

908
00:42:32,760 --> 00:42:35,220
the open wrt toolchain which makes it

909
00:42:35,220 --> 00:42:37,839
pretty you know reproducible and easy

910
00:42:37,839 --> 00:42:41,349
to build this and other samples but the

911
00:42:41,349 --> 00:42:43,239
right libraries and everything for

912
00:42:43,239 --> 00:42:44,579
version two I haven't looked too closely

913
00:42:44,579 --> 00:42:47,380
added because we can still bend zip from

914
00:42:47,380 --> 00:42:48,819
the previous version to the new version

915
00:42:48,819 --> 00:42:51,039
there's a lot of noise more noise but

916
00:42:51,039 --> 00:42:52,930
still we're we're not we don't want to

917
00:42:52,930 --> 00:42:56,109
do as an ass Toro job as we did on the

918
00:42:56,109 --> 00:43:00,460
first time around so I haven't looked at

919
00:43:00,460 --> 00:43:02,380
it deeply enough but in a general

920
00:43:02,380 --> 00:43:04,930
sentence all of the embedded samples I

921
00:43:04,930 --> 00:43:07,420
looked at of course it's crazy the

922
00:43:07,420 --> 00:43:09,640
degree of variability you know they are

923
00:43:09,640 --> 00:43:12,759
I don't know at least ten project who

924
00:43:12,759 --> 00:43:15,489
are bootstrapping embedded the code

925
00:43:15,489 --> 00:43:17,920
initiative some target really low memory

926
00:43:17,920 --> 00:43:19,509
environments and target bigger

927
00:43:19,509 --> 00:43:21,999
environments and like the vendors are

928
00:43:21,999 --> 00:43:25,839
also have all their own SDKs so if you

929
00:43:25,839 --> 00:43:27,849
want to target specifically tp-link or

930
00:43:27,849 --> 00:43:32,049
belkin you can so it's that it would be

931
00:43:32,049 --> 00:43:35,140
nice to have some kind of a project who

932
00:43:35,140 --> 00:43:38,019
would try to map these things and do

933
00:43:38,019 --> 00:43:40,150
something about it definitely it would

934
00:43:40,150 --> 00:43:46,420
be worthwhile I think thanks last minute

935
00:43:46,420 --> 00:43:50,640
question okay thank you

