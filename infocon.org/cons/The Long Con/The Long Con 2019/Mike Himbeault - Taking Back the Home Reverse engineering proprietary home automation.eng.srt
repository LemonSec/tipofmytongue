1
00:00:08,490 --> 00:00:17,170
[Applause]

2
00:00:11,639 --> 00:00:18,250
thank you so my talk today is on that's

3
00:00:17,170 --> 00:00:22,630
not it

4
00:00:18,250 --> 00:00:24,910
this is it there's a microphone you can

5
00:00:22,630 --> 00:00:25,860
use if you talk into it if I talk into

6
00:00:24,910 --> 00:00:31,739
this yeah

7
00:00:25,860 --> 00:00:33,730
no no there we go

8
00:00:31,739 --> 00:00:34,870
why did I think that this was not a

9
00:00:33,730 --> 00:00:37,300
thing okay

10
00:00:34,870 --> 00:00:38,829
so backing up if you've been here the

11
00:00:37,300 --> 00:00:41,760
last two times this would have been

12
00:00:38,829 --> 00:00:45,190
accurate so we're changing it up a bit

13
00:00:41,760 --> 00:00:47,860
so the talk today is about home

14
00:00:45,190 --> 00:00:49,900
automation smart homes we'll talk a bit

15
00:00:47,860 --> 00:00:51,460
about what that means later fair bit of

16
00:00:49,900 --> 00:00:53,650
content you're gonna run through it and

17
00:00:51,460 --> 00:00:55,540
it's gonna be most about my story about

18
00:00:53,650 --> 00:00:57,820
being really disappointed with what I

19
00:00:55,540 --> 00:01:00,940
pay for and then doing something with

20
00:00:57,820 --> 00:01:03,070
that so a little bit about me there is

21
00:01:00,940 --> 00:01:04,509
nothing more there's nothing so cold

22
00:01:03,070 --> 00:01:06,610
unforgiving so dark as the

23
00:01:04,509 --> 00:01:08,079
mathematicians my background is in math

24
00:01:06,610 --> 00:01:10,420
I have no formal training in my day job

25
00:01:08,079 --> 00:01:12,490
I work for the city in the innovation

26
00:01:10,420 --> 00:01:14,350
department if you have a problem with

27
00:01:12,490 --> 00:01:15,818
anything regarding to the city I have a

28
00:01:14,350 --> 00:01:20,859
thing immediately after this and won't

29
00:01:15,819 --> 00:01:22,869
be here so that's that's fun and

30
00:01:20,859 --> 00:01:27,030
contrary to popular belief I can talk

31
00:01:22,869 --> 00:01:29,619
about things that aren't amazon shut up

32
00:01:27,030 --> 00:01:31,450
so today's talk is going to be about one

33
00:01:29,619 --> 00:01:33,520
particular trench it's gonna be about my

34
00:01:31,450 --> 00:01:35,319
experience with my particular home

35
00:01:33,520 --> 00:01:37,658
automation system that I picked up and

36
00:01:35,319 --> 00:01:39,130
it was a good deal at the time and I

37
00:01:37,659 --> 00:01:43,929
thought hey this'll be great and it

38
00:01:39,130 --> 00:01:46,029
turns out it was okay like satisfactory

39
00:01:43,929 --> 00:01:47,709
like this were grade two would be like

40
00:01:46,029 --> 00:01:51,759
satisfactory in terms of plays what

41
00:01:47,709 --> 00:01:53,139
plays well with others so quick poll how

42
00:01:51,759 --> 00:01:53,560
many people have and defined it however

43
00:01:53,139 --> 00:01:56,380
you want

44
00:01:53,560 --> 00:01:59,229
smart home home automation something

45
00:01:56,380 --> 00:02:01,658
like that pay for it or don't okay so

46
00:01:59,229 --> 00:02:03,700
the third ish give or take

47
00:02:01,659 --> 00:02:05,590
how many people subscribe to a smart

48
00:02:03,700 --> 00:02:09,190
home audit or automation or home

49
00:02:05,590 --> 00:02:12,220
security or something awesome like six

50
00:02:09,190 --> 00:02:13,030
ok so a home automation I'm going to

51
00:02:12,220 --> 00:02:15,640
split it into a couple of categories

52
00:02:13,030 --> 00:02:17,200
just because it's convenient and that's

53
00:02:15,640 --> 00:02:20,170
that's really gonna be about it so the

54
00:02:17,200 --> 00:02:22,299
first category is just garbage one-offs

55
00:02:20,170 --> 00:02:25,750
things where people have no business

56
00:02:22,300 --> 00:02:29,260
this stuff like I'm talking about

57
00:02:25,750 --> 00:02:32,110
fridges and freezers like no you make a

58
00:02:29,260 --> 00:02:34,269
cooling thing let someone else make your

59
00:02:32,110 --> 00:02:37,780
smart home thing you have no business in

60
00:02:34,270 --> 00:02:39,940
this space and they don't interrupt well

61
00:02:37,780 --> 00:02:41,920
their cloud services shutdown insignia

62
00:02:39,940 --> 00:02:43,480
right and so now you just lose

63
00:02:41,920 --> 00:02:45,790
functionality for a thing you paid for

64
00:02:43,480 --> 00:02:49,899
so this is stuff that should not exist

65
00:02:45,790 --> 00:02:51,130
and yet it's just so common the next one

66
00:02:49,900 --> 00:02:53,020
is good one offs

67
00:02:51,130 --> 00:02:54,579
you know things where any one device is

68
00:02:53,020 --> 00:02:56,760
kind of worth buying you know your your

69
00:02:54,580 --> 00:02:58,930
Alexa's your Google homes your

70
00:02:56,760 --> 00:03:01,269
grudgingly I'm going to throw logitech

71
00:02:58,930 --> 00:03:02,920
in here because their stuff works but

72
00:03:01,270 --> 00:03:05,470
there's really you only need one of them

73
00:03:02,920 --> 00:03:08,019
right you need one logitech remote

74
00:03:05,470 --> 00:03:09,280
that's kind of their thing and you only

75
00:03:08,020 --> 00:03:13,600
need one and so there's no point in

76
00:03:09,280 --> 00:03:15,520
having to and this is where one device

77
00:03:13,600 --> 00:03:18,010
is worth it but the rest isn't and then

78
00:03:15,520 --> 00:03:20,200
the third category is we're just having

79
00:03:18,010 --> 00:03:21,670
more is more is better one is pretty

80
00:03:20,200 --> 00:03:23,320
much pointless would you throw half a

81
00:03:21,670 --> 00:03:28,299
dozen in there and it's worth something

82
00:03:23,320 --> 00:03:30,790
right so this is this is what I end up

83
00:03:28,300 --> 00:03:32,800
with I've got probably half a dozen or

84
00:03:30,790 --> 00:03:36,310
close to a dozen different things and

85
00:03:32,800 --> 00:03:38,950
you subscribe to your fluence or your

86
00:03:36,310 --> 00:03:40,360
vivint's or even your your normal or

87
00:03:38,950 --> 00:03:42,970
alarm companies are starting to get into

88
00:03:40,360 --> 00:03:45,010
this where it's a curated space of tools

89
00:03:42,970 --> 00:03:46,180
and things you can subscribe to and

90
00:03:45,010 --> 00:03:48,519
they're guaranteed to work together and

91
00:03:46,180 --> 00:03:51,310
it's one app it's one pane of glass it's

92
00:03:48,520 --> 00:03:53,560
supposed to be really nice so smart

93
00:03:51,310 --> 00:03:54,790
devices themselves and the platypus is

94
00:03:53,560 --> 00:03:57,220
up here because then you can't really

95
00:03:54,790 --> 00:04:00,760
even see that because taxonomy be damned

96
00:03:57,220 --> 00:04:02,230
how dare you try to categorize me so

97
00:04:00,760 --> 00:04:05,890
smart devices themselves split into two

98
00:04:02,230 --> 00:04:07,660
one is proprietary cloud this is you

99
00:04:05,890 --> 00:04:09,399
have to have their cloud service and if

100
00:04:07,660 --> 00:04:13,560
they don't run it anymore you are

101
00:04:09,400 --> 00:04:16,269
screwed in singing yeah again right

102
00:04:13,560 --> 00:04:18,459
there great will they work and if you're

103
00:04:16,269 --> 00:04:20,950
not paying a subscription fee or you're

104
00:04:18,459 --> 00:04:22,600
not receiving advertising that's that

105
00:04:20,950 --> 00:04:24,250
service is likely to die unless there's

106
00:04:22,600 --> 00:04:27,730
another revenue stream that pays for it

107
00:04:24,250 --> 00:04:30,280
right I bought my echo once I don't

108
00:04:27,730 --> 00:04:32,410
receive advertising on it but I pray to

109
00:04:30,280 --> 00:04:34,659
God that the advertising and the extra

110
00:04:32,410 --> 00:04:36,160
stuff I pay Amazon for pays for that

111
00:04:34,660 --> 00:04:39,190
ongoing subscription service

112
00:04:36,160 --> 00:04:41,410
by a smart TV once that depends on a

113
00:04:39,190 --> 00:04:42,610
proprietary cloud service they don't

114
00:04:41,410 --> 00:04:44,530
have another line of business that's

115
00:04:42,610 --> 00:04:46,900
going to front the bill for that ongoing

116
00:04:44,530 --> 00:04:48,909
subscription service I'm not paying for

117
00:04:46,900 --> 00:04:50,620
so it's important to think about a bit

118
00:04:48,910 --> 00:04:51,790
of the economics for your provider to

119
00:04:50,620 --> 00:04:54,850
figure out whether or not what you're

120
00:04:51,790 --> 00:04:55,900
buying is gonna work in five years the

121
00:04:54,850 --> 00:04:58,390
other one is the open device

122
00:04:55,900 --> 00:05:00,130
connectivity stuff right it's your your

123
00:04:58,390 --> 00:05:01,840
Bluetooth your Wi-Fi your Laura your

124
00:05:00,130 --> 00:05:04,090
your whatever your ZigBee your Zed wave

125
00:05:01,840 --> 00:05:06,070
where at least it's a known commodity I

126
00:05:04,090 --> 00:05:08,020
know how to talk to this thing I can buy

127
00:05:06,070 --> 00:05:09,820
a bridge for this thing everyone can

128
00:05:08,020 --> 00:05:11,979
talk to this thing and I can just make

129
00:05:09,820 --> 00:05:14,409
it work so these are these are nice

130
00:05:11,980 --> 00:05:16,570
sometimes it's a mix of the two in an

131
00:05:14,410 --> 00:05:19,090
ecosystem because crabbing so vivid

132
00:05:16,570 --> 00:05:21,340
stuff is all Zed wave some of other

133
00:05:19,090 --> 00:05:23,710
stuff is ZigBee some stuff is Bluetooth

134
00:05:21,340 --> 00:05:25,869
some stuff is Wi-Fi so sometimes you'll

135
00:05:23,710 --> 00:05:27,250
get things you can you can work with you

136
00:05:25,870 --> 00:05:28,180
know either through home bridge or

137
00:05:27,250 --> 00:05:32,350
something like that

138
00:05:28,180 --> 00:05:34,570
lots of times though you don't so this

139
00:05:32,350 --> 00:05:37,180
breaks up into two categories I don't

140
00:05:34,570 --> 00:05:39,460
know why it does this we're open and

141
00:05:37,180 --> 00:05:42,250
accessible things were with some intent

142
00:05:39,460 --> 00:05:44,320
the manufacturer says yes please work

143
00:05:42,250 --> 00:05:46,570
with my thing and they they with some

144
00:05:44,320 --> 00:05:48,430
intent allow you to do that maybe it's

145
00:05:46,570 --> 00:05:50,440
through a proprietary tool but at least

146
00:05:48,430 --> 00:05:51,790
it's a tool they make available maybe

147
00:05:50,440 --> 00:05:54,070
it's through adopting an open standard

148
00:05:51,790 --> 00:05:55,120
or an open into communication process or

149
00:05:54,070 --> 00:05:57,400
something like that

150
00:05:55,120 --> 00:05:59,890
and then the other ones are just not

151
00:05:57,400 --> 00:06:01,750
that they're you have to use our pane of

152
00:05:59,890 --> 00:06:03,750
glass and our service talk to our stuff

153
00:06:01,750 --> 00:06:07,270
and that is the end of this story and

154
00:06:03,750 --> 00:06:10,660
that's this is what I'm gonna be that's

155
00:06:07,270 --> 00:06:11,229
what I was dealing with so my story 60

156
00:06:10,660 --> 00:06:14,440
seconds or less

157
00:06:11,230 --> 00:06:16,750
step point get a smart home with device

158
00:06:14,440 --> 00:06:18,700
ecosystem this should be great I pay for

159
00:06:16,750 --> 00:06:21,370
the alarm system I don't pay for any of

160
00:06:18,700 --> 00:06:23,409
the stuff awesome so I live with it for

161
00:06:21,370 --> 00:06:24,790
a bit call it about mmm I got it in the

162
00:06:23,410 --> 00:06:27,970
winter so I lived with it for eight or

163
00:06:24,790 --> 00:06:30,880
ten months and then what huh interesting

164
00:06:27,970 --> 00:06:33,100
I want to do something I want to know

165
00:06:30,880 --> 00:06:35,590
what the history of my house temperature

166
00:06:33,100 --> 00:06:38,680
humidity is it runs my thermostat I

167
00:06:35,590 --> 00:06:40,030
would love to see the history and how

168
00:06:38,680 --> 00:06:41,650
often it's cycling my air conditioning

169
00:06:40,030 --> 00:06:43,450
how often in cycling my furnace because

170
00:06:41,650 --> 00:06:46,650
those have certain efficiency windows

171
00:06:43,450 --> 00:06:50,830
I'd love to see that

172
00:06:46,650 --> 00:06:54,070
so try to do the thing I can't do the

173
00:06:50,830 --> 00:06:56,139
thing and I get sad because it's it it's

174
00:06:54,070 --> 00:06:57,880
collecting the data I can see it in the

175
00:06:56,139 --> 00:07:01,509
app but it's only providing me the

176
00:06:57,880 --> 00:07:03,159
instantaneous value right now and I

177
00:07:01,509 --> 00:07:05,830
realize that this is an arbitrary

178
00:07:03,160 --> 00:07:07,720
decision they've made for no good reason

179
00:07:05,830 --> 00:07:09,849
this is just something that they've

180
00:07:07,720 --> 00:07:11,470
decided they aren't supporting this it's

181
00:07:09,850 --> 00:07:13,210
a function they don't provide even

182
00:07:11,470 --> 00:07:15,460
though they're so close they just don't

183
00:07:13,210 --> 00:07:17,919
do it and it turns out this happens over

184
00:07:15,460 --> 00:07:19,570
and over and over and over with this

185
00:07:17,919 --> 00:07:21,609
platform they're collecting the data

186
00:07:19,570 --> 00:07:24,880
they don't make a certain way to work

187
00:07:21,610 --> 00:07:26,560
with the data available disenchantment

188
00:07:24,880 --> 00:07:29,490
ensues is emilie actually watch this on

189
00:07:26,560 --> 00:07:32,590
Netflix it's hilarious eh

190
00:07:29,490 --> 00:07:35,830
so that's my story so this is gonna be a

191
00:07:32,590 --> 00:07:40,630
bit of a tragedy and about five acts for

192
00:07:35,830 --> 00:07:43,780
large values of five so the motivation

193
00:07:40,630 --> 00:07:44,949
is I have a vivid system at home I want

194
00:07:43,780 --> 00:07:47,830
to track temperature and humidity this

195
00:07:44,949 --> 00:07:49,690
is the first one first use case I want

196
00:07:47,830 --> 00:07:51,190
to be able to stream video clips to

197
00:07:49,690 --> 00:07:53,320
long-term storage currently it only

198
00:07:51,190 --> 00:07:55,150
records clips on specific events I want

199
00:07:53,320 --> 00:07:56,680
full streams because the clips don't

200
00:07:55,150 --> 00:07:58,179
always trigger when I want them to or

201
00:07:56,680 --> 00:08:00,370
it's not good you know

202
00:07:58,180 --> 00:08:02,169
and I can't do that out of the box so

203
00:08:00,370 --> 00:08:03,550
the ultimate goal is I'm just gonna read

204
00:08:02,169 --> 00:08:05,320
from the side here be able to have a

205
00:08:03,550 --> 00:08:06,760
flexibility of integration bridging and

206
00:08:05,320 --> 00:08:09,159
longevity of support that I get from an

207
00:08:06,760 --> 00:08:10,750
open system with the phone support and

208
00:08:09,159 --> 00:08:12,729
guaranteed compatibility of the Vivint

209
00:08:10,750 --> 00:08:15,400
ecosystem I want the best of both worlds

210
00:08:12,729 --> 00:08:17,860
so we all know I'm not gonna get there

211
00:08:15,400 --> 00:08:19,739
but a little bit along the path would

212
00:08:17,860 --> 00:08:24,669
probably be good enough for me

213
00:08:19,740 --> 00:08:28,210
so this is only about software I'm not

214
00:08:24,669 --> 00:08:30,099
like JTAG is that a soup I don't know

215
00:08:28,210 --> 00:08:32,348
right like opening up the hardware is

216
00:08:30,099 --> 00:08:34,630
not a thing I'm not gonna start

217
00:08:32,349 --> 00:08:36,190
soldering anything I'm not I'm not I'm

218
00:08:34,630 --> 00:08:40,419
not going to do that I am likely to

219
00:08:36,190 --> 00:08:43,060
electrocute myself or my cat you know

220
00:08:40,419 --> 00:08:44,770
one of the two so this is entirely a

221
00:08:43,059 --> 00:08:46,630
software endeavor if you want to talk

222
00:08:44,770 --> 00:08:50,209
hardware Troy can do a talk next year

223
00:08:46,630 --> 00:08:53,459
right Troy awesome

224
00:08:50,209 --> 00:08:56,099
so how are we gonna do this how are we

225
00:08:53,459 --> 00:08:58,349
gonna skin the snake so I right I know

226
00:08:56,100 --> 00:09:00,450
Python so I'm thinking a Python module

227
00:08:58,350 --> 00:09:02,700
lets me interact nicely with some of the

228
00:09:00,450 --> 00:09:04,019
stuff I'm gonna have to do some science

229
00:09:02,700 --> 00:09:06,329
we have to do some truck build some

230
00:09:04,019 --> 00:09:08,639
hypotheses test them trial and error

231
00:09:06,329 --> 00:09:13,680
that's gonna be the dominating mechanism

232
00:09:08,639 --> 00:09:15,660
by by how I achieve this science is

233
00:09:13,680 --> 00:09:17,609
science is just magic plus underwear

234
00:09:15,660 --> 00:09:18,899
right like that that's just you just

235
00:09:17,610 --> 00:09:20,220
start you put on there and you do magic

236
00:09:18,899 --> 00:09:22,529
and you get you get science out of this

237
00:09:20,220 --> 00:09:26,310
so that's how this one worked actually

238
00:09:22,529 --> 00:09:28,709
so act one the network and map and TCP

239
00:09:26,310 --> 00:09:30,359
dump all the things so the general

240
00:09:28,709 --> 00:09:31,609
architecture of how this works is and

241
00:09:30,360 --> 00:09:34,230
I'm going to draw with the laser pointer

242
00:09:31,610 --> 00:09:36,180
there's the internet over here there's

243
00:09:34,230 --> 00:09:37,889
the vivid panel over here and then

244
00:09:36,180 --> 00:09:39,630
there's all the devices to connect to

245
00:09:37,889 --> 00:09:41,850
the panel and then the panel connects up

246
00:09:39,630 --> 00:09:43,410
to the internet that's how it works down

247
00:09:41,850 --> 00:09:44,550
it used to work differently and we'll

248
00:09:43,410 --> 00:09:46,350
get into that but that's how it works

249
00:09:44,550 --> 00:09:49,620
now everything runs through a panel

250
00:09:46,350 --> 00:09:52,079
that's connected to my wireless so I own

251
00:09:49,620 --> 00:09:54,540
the network I can stick whatever I want

252
00:09:52,079 --> 00:09:56,040
between the panel and the Internet or in

253
00:09:54,540 --> 00:09:59,069
this case I can just end map and scan

254
00:09:56,040 --> 00:10:00,449
the panel I can TCP dump on the panel

255
00:09:59,070 --> 00:10:02,910
that's really interesting actually

256
00:10:00,449 --> 00:10:05,279
there's a there's a ton of listening

257
00:10:02,910 --> 00:10:10,319
services if you want it will happily be

258
00:10:05,279 --> 00:10:14,550
your recursive DNS resolver hands up if

259
00:10:10,320 --> 00:10:17,040
that one makes sense so it that's

260
00:10:14,550 --> 00:10:19,050
because it's run a DNS mask to run its

261
00:10:17,040 --> 00:10:21,420
internal Wi-Fi access point for the high

262
00:10:19,050 --> 00:10:22,949
bandwidth devices like cameras so it's

263
00:10:21,420 --> 00:10:24,240
running DNS mask and it's just not

264
00:10:22,949 --> 00:10:27,149
filtered for the rest of the network

265
00:10:24,240 --> 00:10:32,160
even though it should be it's listening

266
00:10:27,149 --> 00:10:35,250
on the RTSP alternate port and it speaks

267
00:10:32,160 --> 00:10:38,790
primarily HTTP and open VPN on UDP if it

268
00:10:35,250 --> 00:10:41,940
can to home so the vast majority of the

269
00:10:38,790 --> 00:10:44,250
panels per traffic goes over Open VPN it

270
00:10:41,940 --> 00:10:46,529
doesn't make any attempts to hide it the

271
00:10:44,250 --> 00:10:48,329
rest all goes over HTTP it bootstraps

272
00:10:46,529 --> 00:10:50,939
itself over eight over HTTPS and then

273
00:10:48,329 --> 00:10:53,729
dumps down to open VPN for the rest of

274
00:10:50,940 --> 00:10:54,750
the communication makes sense I guess

275
00:10:53,730 --> 00:10:57,959
fair enough

276
00:10:54,750 --> 00:10:59,459
all right and this is the the key one we

277
00:10:57,959 --> 00:11:03,149
use it later clients if they're on the

278
00:10:59,459 --> 00:11:05,040
same network so while my phone is busy

279
00:11:03,149 --> 00:11:06,300
so my phone if I'm on the same network

280
00:11:05,040 --> 00:11:08,189
is it will attempt a peer-to-peer

281
00:11:06,300 --> 00:11:11,399
connection with the panel it won't

282
00:11:08,189 --> 00:11:12,870
always route through so phone panel they

283
00:11:11,399 --> 00:11:13,920
won't always wrote through the cloud

284
00:11:12,870 --> 00:11:15,749
it doesn't always do the big-ass

285
00:11:13,920 --> 00:11:17,699
horseshoe it'll sometimes just run

286
00:11:15,749 --> 00:11:19,069
directly laterally which is useful we

287
00:11:17,699 --> 00:11:23,069
exploit that later

288
00:11:19,069 --> 00:11:25,439
so network history cameras used to be

289
00:11:23,069 --> 00:11:28,160
directly connected to my wife I call it

290
00:11:25,439 --> 00:11:31,439
a year ago was when I noticed this and

291
00:11:28,160 --> 00:11:33,209
they had open RTSP ports either the

292
00:11:31,439 --> 00:11:34,529
primary the alternate don't recall but

293
00:11:33,209 --> 00:11:35,878
they were listening on RTSP and you

294
00:11:34,529 --> 00:11:38,160
could just you could connect to them

295
00:11:35,879 --> 00:11:41,910
that was all authenticated but they were

296
00:11:38,160 --> 00:11:44,160
there then suddenly they weren't right

297
00:11:41,910 --> 00:11:46,499
there they're not there anymore and I

298
00:11:44,160 --> 00:11:48,689
noticed another hidden SSID so what

299
00:11:46,499 --> 00:11:50,639
happens is those cameras speak z-wave to

300
00:11:48,689 --> 00:11:52,199
the panel and the panel was able to

301
00:11:50,639 --> 00:11:55,439
reconfigure them over a dead wave and

302
00:11:52,199 --> 00:11:57,240
say hey bt-dubs don't talk to this API

303
00:11:55,439 --> 00:11:59,219
anymore talk to this other one and it

304
00:11:57,240 --> 00:12:01,259
pushes out its communication over over

305
00:11:59,220 --> 00:12:04,290
z-wave which once you've paired two

306
00:12:01,259 --> 00:12:06,480
z-wave devices they share a key and you

307
00:12:04,290 --> 00:12:10,079
can't you can't get into that connection

308
00:12:06,480 --> 00:12:12,509
anymore so I'm not here to start digging

309
00:12:10,079 --> 00:12:14,790
into those protocols this is just purely

310
00:12:12,509 --> 00:12:17,550
things I can do without cracking open

311
00:12:14,790 --> 00:12:19,620
hardware or making my own so that

312
00:12:17,550 --> 00:12:21,929
happened through a firmware update super

313
00:12:19,620 --> 00:12:24,149
interesting we'll get back to that so

314
00:12:21,929 --> 00:12:28,290
step two browser apps I can use my phone

315
00:12:24,149 --> 00:12:32,009
app or I can use viven sky.com slash app

316
00:12:28,290 --> 00:12:35,550
or whatever it is the dev tools f12 is

317
00:12:32,009 --> 00:12:37,170
absolutely your friend this got me 95%

318
00:12:35,550 --> 00:12:39,559
of the way to what I wanted to do I just

319
00:12:37,170 --> 00:12:42,719
would do something in the web app and

320
00:12:39,559 --> 00:12:44,850
then I would watch what happened in the

321
00:12:42,720 --> 00:12:46,709
browser and I would reverse engineering

322
00:12:44,850 --> 00:12:48,990
and the results of that are really

323
00:12:46,709 --> 00:12:51,059
interesting right it's it's reasonably

324
00:12:48,990 --> 00:12:53,040
restful it's reasonably well architected

325
00:12:51,059 --> 00:12:55,319
it's all JSON to and from I mean it's

326
00:12:53,040 --> 00:12:57,269
all minified JSON it's completely

327
00:12:55,319 --> 00:12:58,439
unreadable so it's all about dipping it

328
00:12:57,269 --> 00:13:00,269
and figuring out what this means and

329
00:12:58,439 --> 00:13:02,939
there's lots of integers things like

330
00:13:00,269 --> 00:13:05,610
state equals zero not state equals

331
00:13:02,939 --> 00:13:08,099
cooling or state equals off it's state

332
00:13:05,610 --> 00:13:09,990
equals zero there's no excuse for this

333
00:13:08,100 --> 00:13:12,389
other than trying to obfuscate things

334
00:13:09,990 --> 00:13:15,660
because it's all you're saving network

335
00:13:12,389 --> 00:13:17,550
bandwidth all right come on so

336
00:13:15,660 --> 00:13:19,530
but that got me the vast majority of

337
00:13:17,550 --> 00:13:21,229
where I needed to go all right once I

338
00:13:19,530 --> 00:13:22,730
was authenticated I could do the thing

339
00:13:21,230 --> 00:13:26,400
authentication

340
00:13:22,730 --> 00:13:28,110
left to be solved so we back up and we

341
00:13:26,400 --> 00:13:30,150
move back to earth indication this one

342
00:13:28,110 --> 00:13:32,280
was a huge pain in the butt this one was

343
00:13:30,150 --> 00:13:33,720
really frustrating right so there's

344
00:13:32,280 --> 00:13:35,160
almost always I looked at a couple

345
00:13:33,720 --> 00:13:38,670
others there's almost always a third

346
00:13:35,160 --> 00:13:41,579
party in there somewhere so Vivint uses

347
00:13:38,670 --> 00:13:43,680
ping Fed rate for their SSO for their

348
00:13:41,580 --> 00:13:46,050
clients it allows them to unify their

349
00:13:43,680 --> 00:13:47,699
clients their client SSO or provide a

350
00:13:46,050 --> 00:13:49,079
single estação interface to the clients

351
00:13:47,700 --> 00:13:51,120
and to their internal folks and to

352
00:13:49,080 --> 00:13:53,070
different users and different classes so

353
00:13:51,120 --> 00:13:56,610
it was all about how did they do that

354
00:13:53,070 --> 00:13:58,230
and how did they expose that to us in a

355
00:13:56,610 --> 00:13:59,730
way that I could I could exploit in an

356
00:13:58,230 --> 00:14:02,460
automated way as part of a Python

357
00:13:59,730 --> 00:14:05,100
library the nice part it was its

358
00:14:02,460 --> 00:14:08,760
eventually OAuth which is perfect it's

359
00:14:05,100 --> 00:14:11,070
exactly what I want I can do that I did

360
00:14:08,760 --> 00:14:12,360
have to parse out some static keys that

361
00:14:11,070 --> 00:14:14,970
were embedded in some minified

362
00:14:12,360 --> 00:14:17,670
javascript with some truly awful regular

363
00:14:14,970 --> 00:14:18,450
expressions but once you get those they

364
00:14:17,670 --> 00:14:22,229
don't change

365
00:14:18,450 --> 00:14:24,360
ever so I imagine that they're they're

366
00:14:22,230 --> 00:14:29,490
paying Federici which indicates them as

367
00:14:24,360 --> 00:14:31,500
a client great I can use that so this

368
00:14:29,490 --> 00:14:33,410
makes it highly fragile them right

369
00:14:31,500 --> 00:14:35,760
having to parse out minify javascript

370
00:14:33,410 --> 00:14:37,530
with a regular expression as robust as

371
00:14:35,760 --> 00:14:40,560
javascript is I can parse it and do all

372
00:14:37,530 --> 00:14:42,120
that if they change that structure how

373
00:14:40,560 --> 00:14:43,680
they provide that key to the client or

374
00:14:42,120 --> 00:14:46,080
change the client-side code that runs in

375
00:14:43,680 --> 00:14:47,849
your browser like this is a highly

376
00:14:46,080 --> 00:14:50,220
fragile way of doing things again we're

377
00:14:47,850 --> 00:14:52,170
gonna come to this so it works

378
00:14:50,220 --> 00:14:54,270
I can authenticate I can get my Python

379
00:14:52,170 --> 00:14:58,560
module my username my password and I can

380
00:14:54,270 --> 00:15:00,420
get back a nice object structured way to

381
00:14:58,560 --> 00:15:01,770
interface I can say hey give me all

382
00:15:00,420 --> 00:15:03,900
thermostats it says here's a list of

383
00:15:01,770 --> 00:15:05,670
thermostats I said hey thermostat change

384
00:15:03,900 --> 00:15:07,860
the temperature man my temperature

385
00:15:05,670 --> 00:15:09,449
changes perfect like I say hey hey

386
00:15:07,860 --> 00:15:11,250
thermostat give me the current

387
00:15:09,450 --> 00:15:13,560
temperatures and the set points and I

388
00:15:11,250 --> 00:15:15,540
just ran a script that four months on

389
00:15:13,560 --> 00:15:18,030
months on end just would pull that down

390
00:15:15,540 --> 00:15:20,370
every 30 seconds refresh the token has

391
00:15:18,030 --> 00:15:23,000
expired every 12 hours just given my

392
00:15:20,370 --> 00:15:25,050
long-term credentials my name password

393
00:15:23,000 --> 00:15:28,940
and it would just keep doing the thing

394
00:15:25,050 --> 00:15:28,939
beautiful awesome I like it

395
00:15:29,000 --> 00:15:37,370
I couldn't do live video still though

396
00:15:30,800 --> 00:15:39,740
because reasons again we're gonna get to

397
00:15:37,370 --> 00:15:41,210
that so but I could do the thing that I

398
00:15:39,740 --> 00:15:42,800
wanted right I can interact with the

399
00:15:41,210 --> 00:15:45,830
devices I could arm and disarm the house

400
00:15:42,800 --> 00:15:48,680
I could interact I could set privacy

401
00:15:45,830 --> 00:15:50,089
modes on cameras automatically I could

402
00:15:48,680 --> 00:15:51,319
detect when doors are open and closed I

403
00:15:50,089 --> 00:15:53,360
can get all that kind of stuff all

404
00:15:51,320 --> 00:15:55,220
through the API all without really

405
00:15:53,360 --> 00:15:59,270
cracking anything open other than the

406
00:15:55,220 --> 00:16:04,940
dev tools in edge I didn't use Chrome I

407
00:15:59,270 --> 00:16:06,980
used edge and again since the video

408
00:16:04,940 --> 00:16:09,380
devices worked on my Wi-Fi anymore

409
00:16:06,980 --> 00:16:11,089
I'm like wow this is a lot of work I'm

410
00:16:09,380 --> 00:16:14,120
just gonna skip that so I skipped it

411
00:16:11,089 --> 00:16:16,339
and man this is not how I want these

412
00:16:14,120 --> 00:16:18,200
slides to turn out I got to fix this so

413
00:16:16,339 --> 00:16:24,800
now I can infer a bunch of stuff well

414
00:16:18,200 --> 00:16:27,170
through architecture Hey look yeah

415
00:16:24,800 --> 00:16:29,900
so it's interesting cuz they're their

416
00:16:27,170 --> 00:16:31,459
architectures split half on AWS mostly

417
00:16:29,900 --> 00:16:34,220
as three the other half on some on Prem

418
00:16:31,460 --> 00:16:36,080
data center somewhere and which is nice

419
00:16:34,220 --> 00:16:37,520
because now you know if you're really

420
00:16:36,080 --> 00:16:39,530
curious you know it's certain parts of

421
00:16:37,520 --> 00:16:42,500
your more more durable the Amazon side

422
00:16:39,530 --> 00:16:44,510
then their data center side so s3 is for

423
00:16:42,500 --> 00:16:46,460
all their clips all their snapshots all

424
00:16:44,510 --> 00:16:48,260
their media is generally stored in s3 as

425
00:16:46,460 --> 00:16:50,330
well as firmwares we're gonna come to

426
00:16:48,260 --> 00:16:51,740
that that's fun and instead of things

427
00:16:50,330 --> 00:16:53,570
like WebSockets is built before

428
00:16:51,740 --> 00:16:56,839
WebSockets so they use PubNub for long

429
00:16:53,570 --> 00:16:58,460
HTTP polling for real-time updates you

430
00:16:56,839 --> 00:17:01,490
know so that's interesting

431
00:16:58,460 --> 00:17:04,250
ping federated is there a source os3

432
00:17:01,490 --> 00:17:06,920
they do a bit of PGP as well and but

433
00:17:04,250 --> 00:17:08,839
Open VPN is the primary transport for

434
00:17:06,920 --> 00:17:12,920
the panel it's the what the vast

435
00:17:08,839 --> 00:17:13,550
majority of things go over so I stick it

436
00:17:12,920 --> 00:17:14,720
on github

437
00:17:13,550 --> 00:17:17,270
I open source it I write some

438
00:17:14,720 --> 00:17:21,470
documentation it works well I post in

439
00:17:17,270 --> 00:17:23,990
some subreddits I then completely forget

440
00:17:21,470 --> 00:17:25,819
about it it runs it works it's running

441
00:17:23,990 --> 00:17:27,829
on the Raspberry Pi I stopped paying any

442
00:17:25,819 --> 00:17:29,750
attention to this thing whatsoever

443
00:17:27,829 --> 00:17:32,240
because once I'd proven that I'd done it

444
00:17:29,750 --> 00:17:34,600
I mean the mathematician in me says a

445
00:17:32,240 --> 00:17:37,400
solution exists therefore I don't care

446
00:17:34,600 --> 00:17:39,590
right so I'd prove it it was possible

447
00:17:37,400 --> 00:17:41,049
and then stopped caring about the

448
00:17:39,590 --> 00:17:44,320
outputs

449
00:17:41,049 --> 00:17:48,730
so right of course that's how this works

450
00:17:44,320 --> 00:17:50,499
so man this is not so anyway it's fast

451
00:17:48,730 --> 00:17:52,269
forward to about eight months ago

452
00:17:50,499 --> 00:17:54,340
Vivint remember how I mentioned that was

453
00:17:52,269 --> 00:17:56,950
fragile how I was doing off they changed

454
00:17:54,340 --> 00:18:00,668
how off work s-- it's no longer a

455
00:17:56,950 --> 00:18:02,739
JavaScript key it's it's not that

456
00:18:00,669 --> 00:18:04,450
whatever a solution I had doesn't work

457
00:18:02,739 --> 00:18:06,730
anymore and that just happened without

458
00:18:04,450 --> 00:18:08,409
warning overnight so this is one of the

459
00:18:06,730 --> 00:18:09,700
major downfalls to how I've done this is

460
00:18:08,409 --> 00:18:12,220
I don't have an understanding or an

461
00:18:09,700 --> 00:18:14,950
integration with them however I did get

462
00:18:12,220 --> 00:18:16,779
one of the Vivint dev team DM me on

463
00:18:14,950 --> 00:18:20,259
reddit saying hey why did you build this

464
00:18:16,779 --> 00:18:24,070
could be integrated into our app right

465
00:18:20,259 --> 00:18:26,220
so I had a guy I had a good conversation

466
00:18:24,070 --> 00:18:28,989
with them and of course it went nowhere

467
00:18:26,220 --> 00:18:30,279
I'll avoid yeah I'll avoid the salty

468
00:18:28,989 --> 00:18:31,509
language I used at that point but it

469
00:18:30,279 --> 00:18:33,600
went nowhere which was a bit

470
00:18:31,509 --> 00:18:37,119
disappointing cuz like here's a solution

471
00:18:33,600 --> 00:18:38,980
please take it it's free it's all under

472
00:18:37,119 --> 00:18:43,299
like it's licensed openly it's not then

473
00:18:38,980 --> 00:18:44,769
he's weird license so but I had no idea

474
00:18:43,299 --> 00:18:46,179
that had changed until suddenly my

475
00:18:44,769 --> 00:18:49,389
things stopped working and then again

476
00:18:46,179 --> 00:18:50,859
I'd since I didn't care I'm like

477
00:18:49,389 --> 00:18:52,209
whatever if somebody else wants it

478
00:18:50,859 --> 00:18:54,309
they'll fix it because I had open

479
00:18:52,210 --> 00:18:56,859
sourced it and it turns out that someone

480
00:18:54,309 --> 00:18:59,100
did fix it right it actually gained

481
00:18:56,859 --> 00:19:01,509
enough traction within some of the

482
00:18:59,100 --> 00:19:03,070
particularly skilled folks within

483
00:19:01,509 --> 00:19:05,169
different home automation groups that

484
00:19:03,070 --> 00:19:07,359
they were using this and depending on it

485
00:19:05,169 --> 00:19:09,820
so open sourcing it and trying to engage

486
00:19:07,359 --> 00:19:11,590
with community at the start built some

487
00:19:09,820 --> 00:19:13,600
of that momentum it was a baseline level

488
00:19:11,590 --> 00:19:15,039
of momentum that was key to keeping this

489
00:19:13,600 --> 00:19:16,959
thing rolling because someone else

490
00:19:15,039 --> 00:19:19,269
reverse engineered the new way they did

491
00:19:16,960 --> 00:19:21,700
things and forked it and made the pact

492
00:19:19,269 --> 00:19:24,399
and got it working again right that was

493
00:19:21,700 --> 00:19:25,690
really helpful because I simply can't

494
00:19:24,399 --> 00:19:27,639
keep up with everything that I'm gonna

495
00:19:25,690 --> 00:19:32,429
do because I have other things to do in

496
00:19:27,639 --> 00:19:37,330
my life like prepare long con talks so

497
00:19:32,429 --> 00:19:38,499
now you cannot read that at all great so

498
00:19:37,330 --> 00:19:40,449
someone else fix that means I can keep

499
00:19:38,499 --> 00:19:42,820
ignoring it I can keep from completely

500
00:19:40,450 --> 00:19:45,340
forgetting about it until they pick this

501
00:19:42,820 --> 00:19:46,779
talk for me to do and I go hmm I should

502
00:19:45,340 --> 00:19:48,970
really do something with this I need to

503
00:19:46,779 --> 00:19:50,679
pick this back up and hello the return

504
00:19:48,970 --> 00:19:52,779
of the motivation so it's time for live

505
00:19:50,679 --> 00:19:54,549
video it's time for I want to be able to

506
00:19:52,779 --> 00:19:54,820
figure out how to get video get access

507
00:19:54,549 --> 00:19:57,279
to the

508
00:19:54,820 --> 00:19:57,970
livestreaming they're just RTSP this is

509
00:19:57,279 --> 00:20:01,419
not hard

510
00:19:57,970 --> 00:20:03,190
cameras on my network all right back to

511
00:20:01,419 --> 00:20:09,149
the web app there's a live streaming

512
00:20:03,190 --> 00:20:09,149
video button I go and I click the button

513
00:20:15,899 --> 00:20:20,889
all right we're gonna men in the middle

514
00:20:18,730 --> 00:20:22,990
list all right so we crack open mid and

515
00:20:20,889 --> 00:20:25,689
proxy and again since I have I can

516
00:20:22,990 --> 00:20:28,059
control Wi-Fi network connects to I set

517
00:20:25,690 --> 00:20:30,460
my raspberry pi I throw up an access

518
00:20:28,059 --> 00:20:32,019
point and I move the panel over to it

519
00:20:30,460 --> 00:20:34,690
and it's just a straight layer to bridge

520
00:20:32,019 --> 00:20:36,639
between wireless wires Wireless and my

521
00:20:34,690 --> 00:20:39,480
wired but now I can straight man in the

522
00:20:36,639 --> 00:20:42,129
middle of this thing cool what do we get

523
00:20:39,480 --> 00:20:44,049
so I saw the season the the mid-and

524
00:20:42,129 --> 00:20:45,399
proxy cert on my phone so everything

525
00:20:44,049 --> 00:20:47,559
looks like it's authenticated and

526
00:20:45,399 --> 00:20:51,729
trusted everything works great I try the

527
00:20:47,559 --> 00:20:53,620
mobile app and cert pinning which I

528
00:20:51,730 --> 00:20:56,799
found it is very common with Android

529
00:20:53,620 --> 00:20:59,758
apps did anybody else know that it is a

530
00:20:56,799 --> 00:21:02,980
huge pain in my ass

531
00:20:59,759 --> 00:21:05,740
it was I I couldn't get a single app to

532
00:21:02,980 --> 00:21:08,139
work like janky weird one like hundred

533
00:21:05,740 --> 00:21:10,720
installs total like weather apps nope

534
00:21:08,139 --> 00:21:11,949
cert pinning so I not having build

535
00:21:10,720 --> 00:21:14,399
mobile apps I'm guessing it's part of

536
00:21:11,950 --> 00:21:17,019
the tool chain maybe I don't know anyway

537
00:21:14,399 --> 00:21:20,889
not everything was cert pinned

538
00:21:17,019 --> 00:21:23,889
I did get some traffic through in my mid

539
00:21:20,889 --> 00:21:25,000
and proxy that was not pinned and the

540
00:21:23,889 --> 00:21:28,178
Amazon requests

541
00:21:25,000 --> 00:21:29,710
don't have pinned certs so the way it

542
00:21:28,179 --> 00:21:31,870
looks within mid with within mid and

543
00:21:29,710 --> 00:21:34,029
proxy is if there's a pin certificate

544
00:21:31,870 --> 00:21:35,709
certificate it's only inspecting the

545
00:21:34,029 --> 00:21:38,110
HTTP that goes inside the TLS connection

546
00:21:35,710 --> 00:21:39,340
and since the client is pinning a cert

547
00:21:38,110 --> 00:21:41,258
whenever it attempts to make a

548
00:21:39,340 --> 00:21:45,158
connection it bails before sending any

549
00:21:41,259 --> 00:21:46,960
HTTP requests so I crack this open and

550
00:21:45,159 --> 00:21:49,600
you can't know you might be able to see

551
00:21:46,960 --> 00:21:51,370
so these green down the side here means

552
00:21:49,600 --> 00:21:54,969
that this is an HTTP connection and

553
00:21:51,370 --> 00:21:57,729
these are all HTTP requests that I'm

554
00:21:54,970 --> 00:21:59,970
getting from the panel what's wrong with

555
00:21:57,730 --> 00:21:59,970
this

556
00:22:02,640 --> 00:22:10,179
not only is it not pinning certs it's

557
00:22:06,159 --> 00:22:12,850
not validating certs I didn't install

558
00:22:10,179 --> 00:22:15,400
the CA certificate on the panel this is

559
00:22:12,850 --> 00:22:18,399
a closed if you open it the alarm goes

560
00:22:15,400 --> 00:22:20,380
kind of thing closed hardware I didn't

561
00:22:18,400 --> 00:22:22,830
install a certificate on this and I man

562
00:22:20,380 --> 00:22:29,950
in the middling TLS connections and

563
00:22:22,830 --> 00:22:32,770
they're still working like this is not

564
00:22:29,950 --> 00:22:34,500
okay like what makes you think this is

565
00:22:32,770 --> 00:22:37,990
okay

566
00:22:34,500 --> 00:22:41,860
anyway the libs are the two options so

567
00:22:37,990 --> 00:22:43,570
we can either install flash or we can

568
00:22:41,860 --> 00:22:46,000
install VirtualBox we can setup an

569
00:22:43,570 --> 00:22:48,428
android x86 emulator we can get the APK

570
00:22:46,000 --> 00:22:50,110
for some super skeezy site I can silo

571
00:22:48,429 --> 00:22:51,400
the side load the apk into the VM and

572
00:22:50,110 --> 00:22:53,469
then I can grab Frida for runtime

573
00:22:51,400 --> 00:22:56,710
debugging and then at runtime I can fuzz

574
00:22:53,470 --> 00:23:02,590
out the serpent so there is there is a

575
00:22:56,710 --> 00:23:05,470
correct answer here all right so I chose

576
00:23:02,590 --> 00:23:07,629
option 3 to start I know there's our tsp

577
00:23:05,470 --> 00:23:10,360
listening we're just gonna just see what

578
00:23:07,630 --> 00:23:12,309
happens we're gonna give a shot so again

579
00:23:10,360 --> 00:23:14,469
the panel listens on our TSP is

580
00:23:12,309 --> 00:23:15,970
alternate port eight five five four it's

581
00:23:14,470 --> 00:23:17,830
live five five five streaming media

582
00:23:15,970 --> 00:23:19,659
server it's just open it's a standard

583
00:23:17,830 --> 00:23:22,330
project clear this thing is built as

584
00:23:19,659 --> 00:23:26,620
just on rampant violations of the GPL

585
00:23:22,330 --> 00:23:29,110
so whatever not my problem so again I

586
00:23:26,620 --> 00:23:30,639
speculate that the client and the panel

587
00:23:29,110 --> 00:23:33,459
just if they're on the same subnet

588
00:23:30,640 --> 00:23:34,870
attempt to communicate directly this is

589
00:23:33,460 --> 00:23:36,490
my option three I have no idea what's

590
00:23:34,870 --> 00:23:43,570
gonna work haven't tried it yet all

591
00:23:36,490 --> 00:23:47,020
right off we go we're going we're so now

592
00:23:43,570 --> 00:23:48,850
we have nonsti thent occation so I go to

593
00:23:47,020 --> 00:23:51,460
a CENTAC eight the server sends me a

594
00:23:48,850 --> 00:23:52,899
nonce it says use this hash it with your

595
00:23:51,460 --> 00:23:54,520
username and your password and the realm

596
00:23:52,900 --> 00:23:57,460
that I give you and send me the result

597
00:23:54,520 --> 00:23:59,289
back so I can't replay these I can't

598
00:23:57,460 --> 00:24:01,330
really man in the middle of these it

599
00:23:59,289 --> 00:24:05,610
it's a reasonably effective solution if

600
00:24:01,330 --> 00:24:09,039
I don't already know the password so I

601
00:24:05,610 --> 00:24:11,429
give up at this point I give up

602
00:24:09,039 --> 00:24:12,720
so

603
00:24:11,430 --> 00:24:16,500
there's really not much left for me to

604
00:24:12,720 --> 00:24:19,650
do other than install flash so step one

605
00:24:16,500 --> 00:24:21,750
install flash step two take 15 showers

606
00:24:19,650 --> 00:24:24,809
step three get rebaptised because you

607
00:24:21,750 --> 00:24:28,559
just installed flash step 4 install them

608
00:24:24,809 --> 00:24:31,500
in and proxy install the CA cert load up

609
00:24:28,559 --> 00:24:35,190
the web admin panel go back an able

610
00:24:31,500 --> 00:24:38,010
flash through I was using edge dev or

611
00:24:35,190 --> 00:24:39,510
edge dev this time and which is chromium

612
00:24:38,010 --> 00:24:41,220
based and I think there's three or four

613
00:24:39,510 --> 00:24:44,970
times you have to accept yes I really

614
00:24:41,220 --> 00:24:46,320
want to enable flash like I didn't feel

615
00:24:44,970 --> 00:24:47,520
like this was the right thing to do I

616
00:24:46,320 --> 00:24:50,520
wonder if I should just install

617
00:24:47,520 --> 00:24:54,450
VirtualBox start the stream success

618
00:24:50,520 --> 00:24:55,800
awesome excellent perfect so the flash

619
00:24:54,450 --> 00:24:58,830
applet is really just there to be an

620
00:24:55,800 --> 00:25:00,990
RTSP client is what I've determined it's

621
00:24:58,830 --> 00:25:03,919
they're not doing an html5 or JavaScript

622
00:25:00,990 --> 00:25:05,880
the flash is just there to be RTSP cool

623
00:25:03,920 --> 00:25:08,340
because what ends up happening is it

624
00:25:05,880 --> 00:25:10,440
speaks RTSP to the cloud which then I

625
00:25:08,340 --> 00:25:13,169
guess speaks RTSP back to the panel over

626
00:25:10,440 --> 00:25:16,050
OpenVPN I don't I don't want to know I

627
00:25:13,170 --> 00:25:18,390
don't need more showers but I can see

628
00:25:16,050 --> 00:25:20,970
the API call it a API call fly out to

629
00:25:18,390 --> 00:25:24,179
the cloud and come back with user name

630
00:25:20,970 --> 00:25:28,559
and password it's JSON it's just user

631
00:25:24,179 --> 00:25:30,450
name user password blah so my hunch all

632
00:25:28,559 --> 00:25:32,190
along and Travis suggested that I try to

633
00:25:30,450 --> 00:25:34,950
crack the password now that I had the

634
00:25:32,190 --> 00:25:37,410
nonce digest auth hashes and my gut was

635
00:25:34,950 --> 00:25:40,080
like no no so far things have been done

636
00:25:37,410 --> 00:25:41,910
reasonably well I'm not about to try to

637
00:25:40,080 --> 00:25:45,419
crack capacitor that's probably really

638
00:25:41,910 --> 00:25:47,370
high entropy lo and behold I take the

639
00:25:45,420 --> 00:25:49,890
password and the username I get I tried

640
00:25:47,370 --> 00:25:51,989
them out Python I calculate the hash

641
00:25:49,890 --> 00:25:54,000
manually excellent it matches the

642
00:25:51,990 --> 00:25:56,490
response that I saw fly over the wire

643
00:25:54,000 --> 00:25:58,050
between my phone and the panel which

644
00:25:56,490 --> 00:26:00,120
means that the password that username

645
00:25:58,050 --> 00:26:01,470
password I got from the API I now have

646
00:26:00,120 --> 00:26:04,199
the API endpoint all the request

647
00:26:01,470 --> 00:26:07,050
parameters I can fake this using the

648
00:26:04,200 --> 00:26:09,210
existing Python library I can get RTSP

649
00:26:07,050 --> 00:26:13,139
credentials to use from a client to the

650
00:26:09,210 --> 00:26:14,970
panel and I know things like here so

651
00:26:13,140 --> 00:26:17,610
RTSP this is the address of my panel

652
00:26:14,970 --> 00:26:21,720
alternate alternate RTSP port and this

653
00:26:17,610 --> 00:26:23,969
is the video of 31 SD so every camera on

654
00:26:21,720 --> 00:26:25,230
your network has an integer in this case

655
00:26:23,970 --> 00:26:28,380
my

656
00:26:25,230 --> 00:26:29,909
so that the doorbell was 31 and it's

657
00:26:28,380 --> 00:26:31,559
asking for the standard-def stream you

658
00:26:29,909 --> 00:26:35,760
can ask for an HD stream with or without

659
00:26:31,559 --> 00:26:37,230
audio all sort of stuff cool this was

660
00:26:35,760 --> 00:26:38,610
essentially this is not that actually

661
00:26:37,230 --> 00:26:40,559
but this is essentially the password

662
00:26:38,610 --> 00:26:44,809
that I got so I'm glad I didn't try to

663
00:26:40,559 --> 00:26:44,809
crack it I'd still be waiting so

664
00:26:45,080 --> 00:26:50,279
beautiful

665
00:26:46,850 --> 00:26:52,350
all in all this was reasonably

666
00:26:50,279 --> 00:26:54,600
entertaining exercise and it reinforces

667
00:26:52,350 --> 00:26:58,490
the fact that they're not they're not

668
00:26:54,600 --> 00:27:02,129
doing anything wildly offside other than

669
00:26:58,490 --> 00:27:04,620
not hitting or not validating

670
00:27:02,130 --> 00:27:09,929
certificates when you go to get firmware

671
00:27:04,620 --> 00:27:11,959
for the panel you slip right back and

672
00:27:09,929 --> 00:27:15,950
it's something that's not worth it it's

673
00:27:11,960 --> 00:27:19,710
so not worth it but it does mean that

674
00:27:15,950 --> 00:27:22,740
that doesn't mean that you can see and

675
00:27:19,710 --> 00:27:23,700
maybe mangle but the their mitigation I

676
00:27:22,740 --> 00:27:25,289
don't know why they chose not to

677
00:27:23,700 --> 00:27:28,769
validate cert maybe it's just laziness

678
00:27:25,289 --> 00:27:31,320
or intentional they PGP sign it so it's

679
00:27:28,769 --> 00:27:35,130
a signed firmware blob that you can't

680
00:27:31,320 --> 00:27:36,210
fake okay fine I get that but that does

681
00:27:35,130 --> 00:27:37,830
mean that you're listening for long

682
00:27:36,210 --> 00:27:40,950
enough you can get essentially a

683
00:27:37,830 --> 00:27:45,210
firmware dump without needing to dump

684
00:27:40,950 --> 00:27:47,010
the firmware so maybe I haven't seen one

685
00:27:45,210 --> 00:27:50,159
flat across the wire maybe it's PGP

686
00:27:47,010 --> 00:27:53,370
encrypted but that's also not

687
00:27:50,159 --> 00:27:55,919
necessarily great because they're not

688
00:27:53,370 --> 00:27:58,469
putting the private key on the panel

689
00:27:55,919 --> 00:27:59,730
they're putting the public key so I

690
00:27:58,470 --> 00:28:00,720
don't know how they're doing it but it

691
00:27:59,730 --> 00:28:02,789
doesn't mean if you would watch long

692
00:28:00,720 --> 00:28:04,470
enough you will see every time and

693
00:28:02,789 --> 00:28:07,139
that's true of the client as well so on

694
00:28:04,470 --> 00:28:09,809
your on my phone any time it speaks to

695
00:28:07,139 --> 00:28:11,729
Amazon for clips or pictures or whatever

696
00:28:09,809 --> 00:28:14,370
those are all straight man in the middle

697
00:28:11,730 --> 00:28:16,799
of all you can you can feed fake videos

698
00:28:14,370 --> 00:28:18,510
back to people on their mobile phone so

699
00:28:16,799 --> 00:28:20,370
if you wanted to break in and you have

700
00:28:18,510 --> 00:28:23,220
somehow had access to their network you

701
00:28:20,370 --> 00:28:25,649
could do the whole speed insert a loop

702
00:28:23,220 --> 00:28:27,990
in the video stream kind of thing right

703
00:28:25,649 --> 00:28:29,969
by saying no no don't worry about it

704
00:28:27,990 --> 00:28:31,850
there's lots of video clips coming back

705
00:28:29,970 --> 00:28:34,529
to your phone but they're all this clip

706
00:28:31,850 --> 00:28:36,480
so you could man-in-the-middle someone's

707
00:28:34,529 --> 00:28:38,580
phone if you you know if you knew they

708
00:28:36,480 --> 00:28:40,730
were at work and you had access to that

709
00:28:38,580 --> 00:28:43,918
could provide different clips to them

710
00:28:40,730 --> 00:28:45,659
because again those aren't PGP signed

711
00:28:43,919 --> 00:28:46,669
those are straight men in the middle of

712
00:28:45,659 --> 00:28:50,490
all connections

713
00:28:46,669 --> 00:28:52,140
so maybe beyond cell or something I

714
00:28:50,490 --> 00:28:53,340
don't know like that's where it gets all

715
00:28:52,140 --> 00:28:54,779
super weird but generally speaking

716
00:28:53,340 --> 00:28:56,970
they're not the worst in terms of

717
00:28:54,779 --> 00:28:58,590
security they don't have any

718
00:28:56,970 --> 00:28:59,730
fine-grained access controls so through

719
00:28:58,590 --> 00:29:01,860
all of this I had to do it with a

720
00:28:59,730 --> 00:29:02,970
separate account that had admin

721
00:29:01,860 --> 00:29:06,389
privileges to my house

722
00:29:02,970 --> 00:29:08,039
there's admin and not admin and the only

723
00:29:06,390 --> 00:29:09,769
difference is whether or not one of them

724
00:29:08,039 --> 00:29:12,690
can make the others in admit I think

725
00:29:09,769 --> 00:29:13,980
like there's no fine great access

726
00:29:12,690 --> 00:29:16,409
control there's no real privilege

727
00:29:13,980 --> 00:29:17,870
management so it means that if you're

728
00:29:16,409 --> 00:29:20,279
running an automated system like this

729
00:29:17,870 --> 00:29:22,889
you you are giving it access to your

730
00:29:20,279 --> 00:29:24,450
house or your entire IOT set if that's

731
00:29:22,889 --> 00:29:25,769
true if that's what you're doing all

732
00:29:24,450 --> 00:29:27,960
these techniques are portable they

733
00:29:25,769 --> 00:29:32,250
should work for any any vendor pretty

734
00:29:27,960 --> 00:29:34,679
much it's can be really problematic I

735
00:29:32,250 --> 00:29:40,260
don't know if these are TSP credentials

736
00:29:34,679 --> 00:29:42,230
ever rotate I only got them yesterday so

737
00:29:40,260 --> 00:29:45,929
this is a very fresh content by the way

738
00:29:42,230 --> 00:29:47,580
so I they may never ever rotate right

739
00:29:45,929 --> 00:29:50,029
over the course of a 24-hour period I

740
00:29:47,580 --> 00:29:54,240
never saw my phone we request them once

741
00:29:50,029 --> 00:29:56,429
so who knows no idea so what do we

742
00:29:54,240 --> 00:29:58,019
accomplish we can do stuff now we can

743
00:29:56,429 --> 00:30:00,389
reverse-engineer we can go back through

744
00:29:58,019 --> 00:30:02,070
the API we can scrape data that may be

745
00:30:00,389 --> 00:30:03,629
there they are or are not keeping

746
00:30:02,070 --> 00:30:05,519
historically but we can now keep it

747
00:30:03,630 --> 00:30:07,950
historically if we want it we do without

748
00:30:05,519 --> 00:30:09,570
the apps we build our own app if we hate

749
00:30:07,950 --> 00:30:12,000
the one if we hate what there's gives us

750
00:30:09,570 --> 00:30:13,769
and build our own it still depends on

751
00:30:12,000 --> 00:30:15,269
their proprietary cloud service but

752
00:30:13,769 --> 00:30:17,549
again in my case I pay for that as

753
00:30:15,269 --> 00:30:19,980
description service it's unlikely to go

754
00:30:17,549 --> 00:30:21,179
away but if you're not if you buy a

755
00:30:19,980 --> 00:30:23,760
device and you're not paying a

756
00:30:21,179 --> 00:30:26,519
subscription fee this is the the start

757
00:30:23,760 --> 00:30:29,010
to reverse engineering building your own

758
00:30:26,519 --> 00:30:31,169
version of their cloud service right

759
00:30:29,010 --> 00:30:32,669
that if for things like insignia device

760
00:30:31,169 --> 00:30:35,250
you know devices that don't have one

761
00:30:32,669 --> 00:30:37,889
anymore you could have your own this is

762
00:30:35,250 --> 00:30:39,179
this would be the start point didn't if

763
00:30:37,889 --> 00:30:40,620
a crack open anything I didn't have to

764
00:30:39,179 --> 00:30:42,809
burn myself with a soldering iron I

765
00:30:40,620 --> 00:30:46,168
didn't have to do any of that I'll leave

766
00:30:42,809 --> 00:30:48,570
that for Troy so these are all value

767
00:30:46,169 --> 00:30:52,080
judgments these are my opinions no one

768
00:30:48,570 --> 00:30:52,509
else it's not total like it's not the

769
00:30:52,080 --> 00:30:56,109
worst

770
00:30:52,509 --> 00:30:58,539
I've seen like I've seen worse so it's

771
00:30:56,109 --> 00:31:00,698
okay it's annoying to work with it's a

772
00:30:58,539 --> 00:31:03,999
huge pain some of these are like 150

773
00:31:00,699 --> 00:31:06,579
kilobyte minified jason's that's not fun

774
00:31:03,999 --> 00:31:09,399
to go through so dipping them is an

775
00:31:06,579 --> 00:31:11,079
important part of this panel has way too

776
00:31:09,399 --> 00:31:13,178
much listening there's about 12

777
00:31:11,079 --> 00:31:17,440
different services listening on this

778
00:31:13,179 --> 00:31:19,089
panel have no clue what they all do they

779
00:31:17,440 --> 00:31:21,909
don't speak standard stuff an nmap has

780
00:31:19,089 --> 00:31:23,469
no clue so which means I have no clue if

781
00:31:21,909 --> 00:31:26,709
any Matt can figure it out I'm not gonna

782
00:31:23,469 --> 00:31:28,779
bother and a really useful tool would be

783
00:31:26,709 --> 00:31:30,940
some kind of permissions proxy you know

784
00:31:28,779 --> 00:31:32,799
I delegate access to a friend of mine

785
00:31:30,940 --> 00:31:34,629
maybe I can have an app they would say

786
00:31:32,799 --> 00:31:37,059
you can only unlock my house between

787
00:31:34,629 --> 00:31:38,228
this time and this time you can't do

788
00:31:37,059 --> 00:31:40,599
that through the standard system but if

789
00:31:38,229 --> 00:31:43,449
I had some way of bolting that in front

790
00:31:40,599 --> 00:31:47,889
I would totally be open to that right

791
00:31:43,449 --> 00:31:50,440
like so this opens up some options one

792
00:31:47,889 --> 00:31:54,158
notable note from Halloween my doorbell

793
00:31:50,440 --> 00:31:57,940
was completely useless completely and

794
00:31:54,159 --> 00:31:59,919
utterly unresponsive so we got a hundred

795
00:31:57,940 --> 00:32:01,179
and four kids our doorbell rang probably

796
00:31:59,919 --> 00:32:03,699
eighty times over the course of two and

797
00:32:01,179 --> 00:32:08,979
a half hours which means that I got

798
00:32:03,699 --> 00:32:10,509
notifications thrice what is it what

799
00:32:08,979 --> 00:32:12,009
does your cloud provider do or what does

800
00:32:10,509 --> 00:32:15,549
your service writer do if they're if

801
00:32:12,009 --> 00:32:17,979
they suck at cloud and scaling and to

802
00:32:15,549 --> 00:32:20,829
get in three orders of magnitude more

803
00:32:17,979 --> 00:32:22,899
volume for three hours than they're used

804
00:32:20,829 --> 00:32:26,289
to all right my doorbell rings three

805
00:32:22,899 --> 00:32:29,049
times a week maybe it rang eighty times

806
00:32:26,289 --> 00:32:30,789
in two and a half hours right that's not

807
00:32:29,049 --> 00:32:32,139
just me it's everyone else in the city

808
00:32:30,789 --> 00:32:34,119
with Vivint everyone else in North

809
00:32:32,139 --> 00:32:36,129
America and so anywhere that celebrates

810
00:32:34,119 --> 00:32:37,569
Halloween I think Mexico does too right

811
00:32:36,129 --> 00:32:41,349
so anywhere that they're in one of those

812
00:32:37,569 --> 00:32:43,899
markets this is impacting their load I

813
00:32:41,349 --> 00:32:45,218
know some folks that also had Vivint and

814
00:32:43,899 --> 00:32:47,408
they would get notification saying your

815
00:32:45,219 --> 00:32:49,899
door is left open because the door

816
00:32:47,409 --> 00:32:52,089
closed event got lodged in a queue for

817
00:32:49,899 --> 00:32:54,458
too long somewhere right what happens if

818
00:32:52,089 --> 00:32:55,690
I come home it's freezing I wasn't

819
00:32:54,459 --> 00:32:57,879
planning for it to be that cold I don't

820
00:32:55,690 --> 00:33:00,399
have a jacket I can't unlock my house

821
00:32:57,879 --> 00:33:02,059
because there's too many doorbells

822
00:33:00,399 --> 00:33:04,939
ringing

823
00:33:02,059 --> 00:33:07,129
right that this comes like this comes

824
00:33:04,940 --> 00:33:09,739
down to the availability part of the CIA

825
00:33:07,129 --> 00:33:11,299
triad for for security like availability

826
00:33:09,739 --> 00:33:12,799
is an important part in theory your

827
00:33:11,299 --> 00:33:14,479
cloud service should be more available

828
00:33:12,799 --> 00:33:16,999
than anything you run on a Raspberry Pi

829
00:33:14,479 --> 00:33:19,549
in practice well that's only true if

830
00:33:16,999 --> 00:33:20,899
they're good at what they do I'm happy

831
00:33:19,549 --> 00:33:21,859
good at that part of what they do they

832
00:33:20,899 --> 00:33:24,978
can good it they can be good at other

833
00:33:21,859 --> 00:33:26,269
things like sourcing devices and making

834
00:33:24,979 --> 00:33:27,649
sure they all work together but if they

835
00:33:26,269 --> 00:33:29,149
suck at scaling their infrastructure

836
00:33:27,649 --> 00:33:30,709
that's something you have to keep in

837
00:33:29,149 --> 00:33:32,590
mind but it's not something you can

838
00:33:30,710 --> 00:33:34,879
evaluate prior to signing the agreement

839
00:33:32,590 --> 00:33:36,589
so if you're looking at one talk to

840
00:33:34,879 --> 00:33:40,399
someone to find someone that has it ask

841
00:33:36,589 --> 00:33:43,950
them it's the best I can say and by the

842
00:33:40,399 --> 00:33:51,468
grace I'm done that's what I got

843
00:33:43,950 --> 00:33:51,469
[Applause]

