1
00:00:00,030 --> 00:00:01,500
so I appreciate this is one of the last

2
00:00:01,500 --> 00:00:04,500
talks r44 con before we start I wanted

3
00:00:04,500 --> 00:00:05,910
to do a big round of applause to

4
00:00:05,910 --> 00:00:09,150
Adrienne and Steve and volunteers it's

5
00:00:09,150 --> 00:00:11,010
it's very cool to have a conference like

6
00:00:11,010 --> 00:00:13,620
this in the UK that has such good

7
00:00:13,620 --> 00:00:15,990
technical talks and to be honest is a

8
00:00:15,990 --> 00:00:18,240
really good shining star in the calendar

9
00:00:18,240 --> 00:00:25,980
so well don't you back safely so we

10
00:00:25,980 --> 00:00:27,689
appreciate that a few of you look quite

11
00:00:27,689 --> 00:00:30,119
hungover I've just had some vodka from

12
00:00:30,119 --> 00:00:32,000
blad so that's probably not a good idea

13
00:00:32,000 --> 00:00:35,100
and this talk is a story of our little

14
00:00:35,100 --> 00:00:39,000
journey into reliving our past don't

15
00:00:39,000 --> 00:00:40,559
wanna cry on exactly young anymore and

16
00:00:40,559 --> 00:00:43,710
it talks us through our process in our

17
00:00:43,710 --> 00:00:45,030
approach that we've done a sense post

18
00:00:45,030 --> 00:00:47,640
when it comes to pissing around with

19
00:00:47,640 --> 00:00:50,879
Wi-Fi networks now so my name is Daniel

20
00:00:50,879 --> 00:00:54,030
Cuthbert I'm the CEO of sense post I am

21
00:00:54,030 --> 00:00:58,440
Dominic and the CTO since post and as

22
00:00:58,440 --> 00:01:00,420
with anything this there's a legal

23
00:01:00,420 --> 00:01:03,270
disclaimer now with normal things that

24
00:01:03,270 --> 00:01:04,769
you do at cons you know there's a gray

25
00:01:04,769 --> 00:01:07,049
area well unfortunately the fine line in

26
00:01:07,049 --> 00:01:08,850
this is actually non-existent the [ __ ]

27
00:01:08,850 --> 00:01:10,860
that we're gonna present here is kind of

28
00:01:10,860 --> 00:01:13,500
illegal under the CMA and as a result it

29
00:01:13,500 --> 00:01:15,330
presented us with the weird challenge in

30
00:01:15,330 --> 00:01:19,200
that no good talk is good without a demo

31
00:01:19,200 --> 00:01:20,850
but then we thought well hang on a

32
00:01:20,850 --> 00:01:22,860
minute we do this demo we're gonna be

33
00:01:22,860 --> 00:01:25,979
grabbing credentials so it puts it in

34
00:01:25,979 --> 00:01:27,299
this position because we don't wanna

35
00:01:27,299 --> 00:01:28,950
breach the CMA we don't wanna get

36
00:01:28,950 --> 00:01:30,720
arrested it was ten years that last

37
00:01:30,720 --> 00:01:32,100
happened and that [ __ ] was boring so

38
00:01:32,100 --> 00:01:34,470
we've moved on from that so we're going

39
00:01:34,470 --> 00:01:37,770
with a live demo but the live demo is

40
00:01:37,770 --> 00:01:39,689
nothing malicious and you can honestly

41
00:01:39,689 --> 00:01:41,930
trust us we've got faces of saints

42
00:01:41,930 --> 00:01:44,310
so Dominic's gonna do a live demo but

43
00:01:44,310 --> 00:01:46,200
for everything else there will be videos

44
00:01:46,200 --> 00:01:48,149
and when you start to see the videos

45
00:01:48,149 --> 00:01:49,649
you'll appreciate why we're going down

46
00:01:49,649 --> 00:01:50,810
the video route

47
00:01:50,810 --> 00:01:56,009
so why Wi-Fi and we're actually quite

48
00:01:56,009 --> 00:01:57,810
obsessed about Wi-Fi it sounds supposed

49
00:01:57,810 --> 00:02:00,420
you know we love doing the assessments

50
00:02:00,420 --> 00:02:01,829
we love doing the training and to be

51
00:02:01,829 --> 00:02:03,689
honest Wi-Fi is everywhere you know if

52
00:02:03,689 --> 00:02:05,460
you look at devices today everybody has

53
00:02:05,460 --> 00:02:07,200
Wi-Fi and to be honest it's it's

54
00:02:07,200 --> 00:02:09,690
ubiquitous it's every devices got it and

55
00:02:09,690 --> 00:02:10,220
to be

56
00:02:10,220 --> 00:02:12,980
it's quite cool still the problem is the

57
00:02:12,980 --> 00:02:15,350
infoset community looks down upon Wi-Fi

58
00:02:15,350 --> 00:02:18,340
is this skitty's type approach into

59
00:02:18,340 --> 00:02:21,290
penetration testing so you're new to the

60
00:02:21,290 --> 00:02:22,880
industry and you think what I'm gonna do

61
00:02:22,880 --> 00:02:25,280
well I'm gonna write XSS which is

62
00:02:25,280 --> 00:02:27,680
another lame thing or I'll do Wi-Fi

63
00:02:27,680 --> 00:02:30,050
hacking or I become a lock picker and we

64
00:02:30,050 --> 00:02:32,660
think that's a bit unfair because you

65
00:02:32,660 --> 00:02:34,310
can get a lot out of it and

66
00:02:34,310 --> 00:02:36,470
interestingly enough it wasn't just us

67
00:02:36,470 --> 00:02:38,510
who felt the same way at Def Con last

68
00:02:38,510 --> 00:02:41,270
month I hunt pineapples decided to go

69
00:02:41,270 --> 00:02:43,160
around boning all the skinnies that had

70
00:02:43,160 --> 00:02:45,500
bought hak5 pineapples and it was quite

71
00:02:45,500 --> 00:02:47,180
funny because you steal these people on

72
00:02:47,180 --> 00:02:49,580
Twitter going [ __ ] my head my device has

73
00:02:49,580 --> 00:02:51,800
got this weird thing popping up I don't

74
00:02:51,800 --> 00:02:54,290
know why and the one thing there that is

75
00:02:54,290 --> 00:02:56,720
quite thing I'll paraphrase read the

76
00:02:56,720 --> 00:02:58,160
[ __ ] code the next time you buy a

77
00:02:58,160 --> 00:03:00,020
super leets kiddie hacking gear this

78
00:03:00,020 --> 00:03:02,600
[ __ ] is criminally insecure so there's a

79
00:03:02,600 --> 00:03:04,880
lot of unfair abuse when it comes to

80
00:03:04,880 --> 00:03:07,160
messing around with Wi-Fi and we didn't

81
00:03:07,160 --> 00:03:10,220
think that was fair because the promise

82
00:03:10,220 --> 00:03:12,230
of hacking Wi-Fi is actually pretty cool

83
00:03:12,230 --> 00:03:16,220
not only do today gain access to cloud

84
00:03:16,220 --> 00:03:19,280
credentials right most people here I'm

85
00:03:19,280 --> 00:03:20,870
sure in this room have got a smartphone

86
00:03:20,870 --> 00:03:22,880
of sorts and I can guarantee you've got

87
00:03:22,880 --> 00:03:25,070
five or six cloud credentials on that

88
00:03:25,070 --> 00:03:27,290
smartphone but you can also use 20 year

89
00:03:27,290 --> 00:03:29,000
old Ethernet vulnerabilities which is

90
00:03:29,000 --> 00:03:32,209
pretty cool so if you've got

91
00:03:32,209 --> 00:03:34,100
vulnerabilities at every single layer

92
00:03:34,100 --> 00:03:36,950
when it comes to Wi-Fi hacking why have

93
00:03:36,950 --> 00:03:38,540
you not got creds falling from the sky

94
00:03:38,540 --> 00:03:41,360
in the last fourteen years there's been

95
00:03:41,360 --> 00:03:44,180
some serious research pushed out aimed

96
00:03:44,180 --> 00:03:47,870
at the Wi-Fi there but to be honest you

97
00:03:47,870 --> 00:03:49,430
know the things on as good as they

98
00:03:49,430 --> 00:03:51,680
should be so if we look at some of the

99
00:03:51,680 --> 00:03:52,970
attacks that have happened over the last

100
00:03:52,970 --> 00:03:53,950
13 years

101
00:03:53,950 --> 00:03:57,140
the first one is attacks aimed at the

102
00:03:57,140 --> 00:03:59,810
connect layer now Dino and Shawn

103
00:03:59,810 --> 00:04:02,330
released karma in 2004 and that was

104
00:04:02,330 --> 00:04:03,530
pretty cool and it scared a lot of

105
00:04:03,530 --> 00:04:05,600
people we then look at the cracking

106
00:04:05,600 --> 00:04:07,820
layer and you had Josh all right Josh

107
00:04:07,820 --> 00:04:11,330
right with asleep in 2003 then Josh and

108
00:04:11,330 --> 00:04:14,239
Brad again with the free radius WP in

109
00:04:14,239 --> 00:04:17,120
2008 then finally moxie with his cloud

110
00:04:17,120 --> 00:04:19,728
cracker in 2013 and then finally the

111
00:04:19,728 --> 00:04:21,738
interception stuff now the last 18

112
00:04:21,738 --> 00:04:23,160
months two years has been pretty

113
00:04:23,160 --> 00:04:24,600
when it comes to interception because

114
00:04:24,600 --> 00:04:25,890
every government and their dog have been

115
00:04:25,890 --> 00:04:27,990
doing it but we've been able to do that

116
00:04:27,990 --> 00:04:30,510
with Wi-Fi for a while you know Doug

117
00:04:30,510 --> 00:04:32,490
song and if the really old [ __ ] in

118
00:04:32,490 --> 00:04:34,620
this room remember Doug song released D

119
00:04:34,620 --> 00:04:38,700
sniffing mm right Rob Graham released

120
00:04:38,700 --> 00:04:40,830
hamster and ferret in 2007 I mean these

121
00:04:40,830 --> 00:04:44,520
are really old tools moxie release SSL

122
00:04:44,520 --> 00:04:48,240
strip an SSL snip in 2009 and finally

123
00:04:48,240 --> 00:04:50,520
Eric Butler which probably the the most

124
00:04:50,520 --> 00:04:52,290
newest one to the Hall of Fame's release

125
00:04:52,290 --> 00:04:52,920
Firesheep

126
00:04:52,920 --> 00:04:56,490
in 2010 but the problem is is that these

127
00:04:56,490 --> 00:04:59,370
tools don't really work that well

128
00:04:59,370 --> 00:05:04,260
anymore and if every nearly every layer

129
00:05:04,260 --> 00:05:06,990
of the Wi-Fi stack right we can get

130
00:05:06,990 --> 00:05:08,760
crests in the sky why isn't working the

131
00:05:08,760 --> 00:05:10,680
prom is the expectation and the reality

132
00:05:10,680 --> 00:05:12,600
are two different things and this Jeremy

133
00:05:12,600 --> 00:05:14,460
Carl picture kind of sums it up in his

134
00:05:14,460 --> 00:05:15,960
mind he thought he looked pretty cool

135
00:05:15,960 --> 00:05:18,450
but in reality anybody who's done modern

136
00:05:18,450 --> 00:05:21,780
rogue AP and Wi-Fi attacks walk away

137
00:05:21,780 --> 00:05:24,030
feeling a bit like that at it annoyed

138
00:05:24,030 --> 00:05:26,000
and wondering what the hell's going on

139
00:05:26,000 --> 00:05:29,700
so the problem is is that if you look at

140
00:05:29,700 --> 00:05:30,300
the tools

141
00:05:30,300 --> 00:05:33,770
let's take karma okay it's old code and

142
00:05:33,770 --> 00:05:37,560
devices generally probe less right free

143
00:05:37,560 --> 00:05:40,350
radius WP e it's all code and it's

144
00:05:40,350 --> 00:05:42,450
actually a pain in the ass to run it's

145
00:05:42,450 --> 00:05:43,890
not the easiest thing to get up and

146
00:05:43,890 --> 00:05:45,510
running and to integrate it with your

147
00:05:45,510 --> 00:05:47,370
attack suite to be honest it's like pain

148
00:05:47,370 --> 00:05:50,430
in the arse d sniff hamster and ferret

149
00:05:50,430 --> 00:05:54,060
fire sheep well they barely work in the

150
00:05:54,060 --> 00:05:55,830
case of decent if it does still but to

151
00:05:55,830 --> 00:05:58,050
be honest who uses MSN Messenger is this

152
00:05:58,050 --> 00:06:00,630
still around and they're not updated you

153
00:06:00,630 --> 00:06:01,890
know some of this code is eight nine

154
00:06:01,890 --> 00:06:04,890
years old and then find the SSL strip in

155
00:06:04,890 --> 00:06:08,070
Estes and SSL Smith well HSTs kind of

156
00:06:08,070 --> 00:06:09,810
kicked that and then adds and that makes

157
00:06:09,810 --> 00:06:12,390
life a lot harder so with all these

158
00:06:12,390 --> 00:06:14,070
problems and the fact that we really

159
00:06:14,070 --> 00:06:16,950
enjoyed doing Wi-Fi rogue ap's and nasty

160
00:06:16,950 --> 00:06:19,980
stuff dominic and ian and the rest of us

161
00:06:19,980 --> 00:06:22,440
guys sat down a thought let's fix this

162
00:06:22,440 --> 00:06:26,690
let's do something so we've written a

163
00:06:26,690 --> 00:06:29,640
toolkit called manna now some

164
00:06:29,640 --> 00:06:30,930
interesting names about the manner the

165
00:06:30,930 --> 00:06:33,090
whole idea was that fact it was manna

166
00:06:33,090 --> 00:06:33,950
from head

167
00:06:33,950 --> 00:06:36,500
from heaven creds from the sky unforced

168
00:06:36,500 --> 00:06:38,180
in the name manner does sound like a bit

169
00:06:38,180 --> 00:06:40,340
of a gay massage parlor and this is

170
00:06:40,340 --> 00:06:41,720
always one of the hardest parts when you

171
00:06:41,720 --> 00:06:43,850
build a project you come up with a name

172
00:06:43,850 --> 00:06:45,050
you've got to think of a catchy name

173
00:06:45,050 --> 00:06:48,470
people that go you know in 10 years time

174
00:06:48,470 --> 00:06:49,640
they're gonna be putting you in slides

175
00:06:49,640 --> 00:06:51,800
so if you've got any suggestions for the

176
00:06:51,800 --> 00:06:54,620
manner name not MANET or bob's massage

177
00:06:54,620 --> 00:06:56,420
or something by all means Dominic would

178
00:06:56,420 --> 00:07:00,320
love to know so the manor toolkit is us

179
00:07:00,320 --> 00:07:01,100
saying right

180
00:07:01,100 --> 00:07:03,590
we love Wi-Fi we love doing rogue ap and

181
00:07:03,590 --> 00:07:05,510
we love doing evil of stuff when our

182
00:07:05,510 --> 00:07:07,610
clients allow us and this toolkit is now

183
00:07:07,610 --> 00:07:09,170
available and this talk is going to talk

184
00:07:09,170 --> 00:07:10,280
you through the journey that we've taken

185
00:07:10,280 --> 00:07:12,440
to get the toolkit into the area where

186
00:07:12,440 --> 00:07:15,890
we think it's ready so first up we're

187
00:07:15,890 --> 00:07:17,960
talking Wi-Fi right we're not talking

188
00:07:17,960 --> 00:07:20,450
bluetooth we're talking eddo 211 a/b/g/n

189
00:07:20,450 --> 00:07:24,110
and AC and the 2.4 and the 5 gigahertz

190
00:07:24,110 --> 00:07:27,650
range we're not talking anything else so

191
00:07:27,650 --> 00:07:29,990
there are three packets now I appreciate

192
00:07:29,990 --> 00:07:32,390
this is not a introduction level talk

193
00:07:32,390 --> 00:07:35,390
into Wi-Fi hacking so please I'm gonna

194
00:07:35,390 --> 00:07:37,370
paraphrase a lot of stuff here there are

195
00:07:37,370 --> 00:07:38,810
three packets that you are generally

196
00:07:38,810 --> 00:07:40,130
interested in when you're screwing

197
00:07:40,130 --> 00:07:42,790
around with Wi-Fi networks the first is

198
00:07:42,790 --> 00:07:45,350
the management the probes and the

199
00:07:45,350 --> 00:07:47,720
beacons now here's an interesting thing

200
00:07:47,720 --> 00:07:49,580
is that in that first page these are

201
00:07:49,580 --> 00:07:52,760
these are unencrypted the next one we're

202
00:07:52,760 --> 00:07:54,950
talking about is control RTS and CTS

203
00:07:54,950 --> 00:07:57,500
return to sender clear descent now these

204
00:07:57,500 --> 00:07:59,510
deal with collisions stopping collisions

205
00:07:59,510 --> 00:08:02,690
from happening and then finally data for

206
00:08:02,690 --> 00:08:04,700
the subject of manner and the subject of

207
00:08:04,700 --> 00:08:06,470
this talk were only interested in the

208
00:08:06,470 --> 00:08:10,370
management side so if we look at a very

209
00:08:10,370 --> 00:08:13,040
very simplified network diagram when you

210
00:08:13,040 --> 00:08:14,990
walked into the room now I'm sure you're

211
00:08:14,990 --> 00:08:16,820
all security savvy so how many people

212
00:08:16,820 --> 00:08:21,130
here have got Wi-Fi turned off [ __ ]

213
00:08:21,130 --> 00:08:23,170
for the few people that don't you've

214
00:08:23,170 --> 00:08:25,330
walked into the room 44 Khan and your

215
00:08:25,330 --> 00:08:27,730
phone goes who's in the room let's check

216
00:08:27,730 --> 00:08:29,800
some people out who's there and all the

217
00:08:29,800 --> 00:08:31,180
access points act like that awkward

218
00:08:31,180 --> 00:08:33,280
credits cool go hey I'm here

219
00:08:33,280 --> 00:08:35,169
so the phone sends out a probe request

220
00:08:35,169 --> 00:08:38,049
and the access point responds with a

221
00:08:38,049 --> 00:08:40,510
probe response okay that's pretty much

222
00:08:40,510 --> 00:08:44,530
basic if we then look at the next thing

223
00:08:44,530 --> 00:08:47,350
so let's say I'm looking for a favorite

224
00:08:47,350 --> 00:08:49,270
place that I go to often I don't know

225
00:08:49,270 --> 00:08:52,030
Bob's massage my phone goes there it's

226
00:08:52,030 --> 00:08:54,400
in my P&L list it says hey Bob's massage

227
00:08:54,400 --> 00:08:54,970
you there

228
00:08:54,970 --> 00:08:57,670
and Bob's massage goes yep yep that's me

229
00:08:57,670 --> 00:08:59,890
probe responds and I say cool I really

230
00:08:59,890 --> 00:09:00,940
want to get to know you better

231
00:09:00,940 --> 00:09:03,370
an association request goes out and

232
00:09:03,370 --> 00:09:05,170
Bob's goes hey let's talk let's get the

233
00:09:05,170 --> 00:09:07,810
oil lugar off we go remember this is a

234
00:09:07,810 --> 00:09:09,670
very simplified version of what happens

235
00:09:09,670 --> 00:09:12,910
just so we can set the scene so with

236
00:09:12,910 --> 00:09:15,430
tools like karma and now that's Deena

237
00:09:15,430 --> 00:09:17,860
and that's Shawn just a quick thing here

238
00:09:17,860 --> 00:09:19,750
I try to find a really old awkward

239
00:09:19,750 --> 00:09:21,340
picture of Dino which is quite easy I

240
00:09:21,340 --> 00:09:23,320
don't know want to post it Shawn on the

241
00:09:23,320 --> 00:09:25,240
other hand here's the weird one if you

242
00:09:25,240 --> 00:09:28,090
google Shawn McCauley and you'll see a

243
00:09:28,090 --> 00:09:29,890
lot of images of a young gentleman who

244
00:09:29,890 --> 00:09:32,170
poses a lot Instagram showing off his

245
00:09:32,170 --> 00:09:35,680
six-pack it's a bit hard putting that up

246
00:09:35,680 --> 00:09:36,940
there because you wonder how and maybe

247
00:09:36,940 --> 00:09:38,260
Shawn has just gone into a different

248
00:09:38,260 --> 00:09:40,390
line of work or something I mean anyway

249
00:09:40,390 --> 00:09:42,760
so that's a picture of Shaun when karma

250
00:09:42,760 --> 00:09:45,850
was released in 2004 10 years ago it was

251
00:09:45,850 --> 00:09:46,870
well ahead of its time

252
00:09:46,870 --> 00:09:49,360
because Dino and Shawn at the time never

253
00:09:49,360 --> 00:09:51,310
anticipated the fact that we would now

254
00:09:51,310 --> 00:09:52,740
be walking around with mobile devices

255
00:09:52,740 --> 00:09:55,390
that all made use of the Wi-Fi protocol

256
00:09:55,390 --> 00:09:57,520
that had so much information that was so

257
00:09:57,520 --> 00:09:59,980
valuable to attackers back then

258
00:09:59,980 --> 00:10:02,050
effectively you had big chunky laptops

259
00:10:02,050 --> 00:10:05,260
you had massive PCM say Wi-Fi cards and

260
00:10:05,260 --> 00:10:06,670
two minutes it was all a pain in the

261
00:10:06,670 --> 00:10:07,090
arse

262
00:10:07,090 --> 00:10:08,920
whereas Wi-Fi now is available

263
00:10:08,920 --> 00:10:11,260
everywhere so the old kamar attack was

264
00:10:11,260 --> 00:10:13,000
really interesting back in the day so

265
00:10:13,000 --> 00:10:16,270
how karma work was the device will probe

266
00:10:16,270 --> 00:10:18,130
for remember networks in your preferred

267
00:10:18,130 --> 00:10:20,440
network list and even when it's not

268
00:10:20,440 --> 00:10:22,540
nearly and this was the same floor that

269
00:10:22,540 --> 00:10:24,460
Glenn and I exploited when it came to

270
00:10:24,460 --> 00:10:27,040
the Snoopy framework and effectively we

271
00:10:27,040 --> 00:10:29,500
Connell would just respond to saying hey

272
00:10:29,500 --> 00:10:31,300
you know I want my home network and

273
00:10:31,300 --> 00:10:33,850
yep that's me and then the damage would

274
00:10:33,850 --> 00:10:36,339
be done the problem is is that it

275
00:10:36,339 --> 00:10:37,870
doesn't really work like that anymore

276
00:10:37,870 --> 00:10:40,060
and then a few guys came along

277
00:10:40,060 --> 00:10:41,920
afterwards and said listen this is cool

278
00:10:41,920 --> 00:10:43,420
we really like calm but we need to make

279
00:10:43,420 --> 00:10:46,060
it better so Thomas came in with the air

280
00:10:46,060 --> 00:10:48,310
crack stuff and then I earned the Robin

281
00:10:48,310 --> 00:10:49,839
right in the beginning there's a much

282
00:10:49,839 --> 00:10:52,959
younger version up there came up with a

283
00:10:52,959 --> 00:10:55,230
very very cool karma patch for hostapd

284
00:10:55,230 --> 00:10:57,370
now the problem with air crack is that

285
00:10:57,370 --> 00:10:59,410
it's software only so it doesn't require

286
00:10:59,410 --> 00:11:02,170
master mode and makes it slower and then

287
00:11:02,170 --> 00:11:04,630
to be honest hostapd stuff and karma

288
00:11:04,630 --> 00:11:06,610
doesn't really work that well but it was

289
00:11:06,610 --> 00:11:07,779
still quite cool that we're looking at

290
00:11:07,779 --> 00:11:10,750
it and this all led into a serious bag

291
00:11:10,750 --> 00:11:13,870
problem of fail all right because when

292
00:11:13,870 --> 00:11:16,990
you did a karma attack on networks back

293
00:11:16,990 --> 00:11:19,029
then it doesn't look like a real ap it

294
00:11:19,029 --> 00:11:21,880
looks fake and and also it doesn't

295
00:11:21,880 --> 00:11:24,220
respond to broadcast requests which is a

296
00:11:24,220 --> 00:11:25,839
key differentiator of how modern

297
00:11:25,839 --> 00:11:29,800
networks are today so I'm gonna pass

298
00:11:29,800 --> 00:11:32,290
this over to Dominic now okay so the

299
00:11:32,290 --> 00:11:34,000
first thing we built into the laner

300
00:11:34,000 --> 00:11:36,399
toolkit was our improvements to karma

301
00:11:36,399 --> 00:11:38,410
attacks to make them work again and the

302
00:11:38,410 --> 00:11:40,930
the problem we identified was that your

303
00:11:40,930 --> 00:11:43,329
device will find networks doing the

304
00:11:43,329 --> 00:11:45,250
broadcast probe and then it will try and

305
00:11:45,250 --> 00:11:47,680
connect to networks on the PL the

306
00:11:47,680 --> 00:11:49,690
current karma attacks just look at

307
00:11:49,690 --> 00:11:52,329
connecting to the device on the PL they

308
00:11:52,329 --> 00:11:55,120
don't deal with the broadcaster so what

309
00:11:55,120 --> 00:11:56,860
we realize is to be more effective in

310
00:11:56,860 --> 00:11:58,750
our karma taxes we needed to respond to

311
00:11:58,750 --> 00:12:00,910
that broadcast probe but we don't know

312
00:12:00,910 --> 00:12:02,890
what to respond with because we don't

313
00:12:02,890 --> 00:12:04,420
know what's in the piano so our

314
00:12:04,420 --> 00:12:06,220
modifications to hostapd which we put

315
00:12:06,220 --> 00:12:07,709
into a tool called the hostapd manner

316
00:12:07,709 --> 00:12:10,000
which started off with Robyn's patches

317
00:12:10,000 --> 00:12:12,040
and mean the ported it to hostapd 2.2

318
00:12:12,040 --> 00:12:13,890
and then started building from there

319
00:12:13,890 --> 00:12:15,940
what they will do is they'll look for

320
00:12:15,940 --> 00:12:17,829
networks that your device is probing for

321
00:12:17,829 --> 00:12:20,380
and then when you send out a broadcast

322
00:12:20,380 --> 00:12:23,079
probe it'll send probe responses for

323
00:12:23,079 --> 00:12:24,670
each network at scene your device probe

324
00:12:24,670 --> 00:12:27,100
for so I'm gonna run a live demo we

325
00:12:27,100 --> 00:12:28,870
sacrificed a chicken to the demo gods

326
00:12:28,870 --> 00:12:30,699
well we got halfway and then Health and

327
00:12:30,699 --> 00:12:33,279
Safety got involved if you brave I'm

328
00:12:33,279 --> 00:12:36,310
running a comma attack now it's that you

329
00:12:36,310 --> 00:12:37,570
can't connect to the network there's

330
00:12:37,570 --> 00:12:39,699
nothing up stream and I wouldn't want a

331
00:12:39,699 --> 00:12:41,209
tsunami of complaints

332
00:12:41,209 --> 00:12:46,189
a jug and so if you if you want turn on

333
00:12:46,189 --> 00:12:47,720
your Wi-Fi and then have a look at the

334
00:12:47,720 --> 00:12:49,220
networks that are available I promise no

335
00:12:49,220 --> 00:12:51,139
one's doing anything bad and if you're

336
00:12:51,139 --> 00:12:53,600
brave and you'll see networks well you

337
00:12:53,600 --> 00:12:56,240
should see networks that just specific

338
00:12:56,240 --> 00:12:57,619
to your device that you've connected to

339
00:12:57,619 --> 00:12:58,699
beforehand

340
00:12:58,699 --> 00:13:00,319
so you should see your home network your

341
00:13:00,319 --> 00:13:03,379
work network things like that and for

342
00:13:03,379 --> 00:13:07,189
those of you who aren't brave if we if

343
00:13:07,189 --> 00:13:15,079
we look at a video so okay on the right

344
00:13:15,079 --> 00:13:17,899
we've got a device an Android device

345
00:13:17,899 --> 00:13:19,579
this thing here and on the Left we're

346
00:13:19,579 --> 00:13:22,639
running Nana so you'll notice that

347
00:13:22,639 --> 00:13:24,379
there's just one Wi-Fi network available

348
00:13:24,379 --> 00:13:26,509
manna runs we turn it off and then back

349
00:13:26,509 --> 00:13:27,980
on and you'll see the device

350
00:13:27,980 --> 00:13:29,689
automatically connect to one of the

351
00:13:29,689 --> 00:13:31,819
networks in its PNL which is called

352
00:13:31,819 --> 00:13:33,949
sense bus manner not particularly

353
00:13:33,949 --> 00:13:37,429
spectacular the old-style manner

354
00:13:37,429 --> 00:13:41,029
attack still works so if you try and

355
00:13:41,029 --> 00:13:42,470
connect to a network that you've never

356
00:13:42,470 --> 00:13:44,119
connected to before so a probe for a

357
00:13:44,119 --> 00:13:46,399
network here I'm just gonna enter one

358
00:13:46,399 --> 00:13:47,689
called nano sense burst which is

359
00:13:47,689 --> 00:13:49,610
different from the previous one you'll

360
00:13:49,610 --> 00:13:51,259
see it'll automatically connect so you

361
00:13:51,259 --> 00:13:52,790
can do that now that stuff's running if

362
00:13:52,790 --> 00:13:56,360
you probe for a network you guys are

363
00:13:56,360 --> 00:13:58,059
probing some we had networks thanks

364
00:13:58,059 --> 00:14:00,679
you'll see that that network will then

365
00:14:00,679 --> 00:14:02,660
be rebroadcast at to your device and

366
00:14:02,660 --> 00:14:04,819
what this does is it means that when

367
00:14:04,819 --> 00:14:07,429
you're looking for Wi-Fi networks the

368
00:14:07,429 --> 00:14:09,019
networks in your P&L will show up and

369
00:14:09,019 --> 00:14:10,309
they'll get automatically connected to

370
00:14:10,309 --> 00:14:12,290
and that's significantly increased the

371
00:14:12,290 --> 00:14:14,029
success of Commerce acts that just that

372
00:14:14,029 --> 00:14:19,339
single finding thank you the the next

373
00:14:19,339 --> 00:14:21,170
thing we needed to come up against was

374
00:14:21,170 --> 00:14:23,860
the fact that things like Snoopy

375
00:14:23,860 --> 00:14:26,749
resulted in devices probing much less so

376
00:14:26,749 --> 00:14:28,490
between stuff like Snoopy and the bins

377
00:14:28,490 --> 00:14:30,379
in London that supposedly tracked you

378
00:14:30,379 --> 00:14:33,290
around an iOS in particular is probing

379
00:14:33,290 --> 00:14:36,829
much less for doing far fewer directed

380
00:14:36,829 --> 00:14:39,709
probes and leaking networks and European

381
00:14:39,709 --> 00:14:42,230
L and we needed to try and figure out

382
00:14:42,230 --> 00:14:44,509
what to do about that and in doing that

383
00:14:44,509 --> 00:14:47,299
I found out that iOS devices don't seem

384
00:14:47,299 --> 00:14:49,519
to probe for hidden networks now this is

385
00:14:49,519 --> 00:14:52,399
impossible the way hidden networks work

386
00:14:52,399 --> 00:14:54,860
so if you've configured an access point

387
00:14:54,860 --> 00:14:58,160
and you say don't broadcast the SSID for

388
00:14:58,160 --> 00:15:00,050
a device to connect to that Network it

389
00:15:00,050 --> 00:15:02,450
needs to do a directed probe for that

390
00:15:02,450 --> 00:15:03,709
network so it needs to know the name of

391
00:15:03,709 --> 00:15:06,050
the network and what that essentially

392
00:15:06,050 --> 00:15:08,120
means is that while your access point

393
00:15:08,120 --> 00:15:10,339
isn't broadcasting its name devices that

394
00:15:10,339 --> 00:15:12,050
want to connect to those networks need

395
00:15:12,050 --> 00:15:14,450
to constantly broadcast for that world

396
00:15:14,450 --> 00:15:16,550
probe for that so when we looked at iOS

397
00:15:16,550 --> 00:15:18,560
devices they weren't probing for for

398
00:15:18,560 --> 00:15:20,209
hidden networks and I went down a dark

399
00:15:20,209 --> 00:15:24,019
road and I built a PS which I'd drive

400
00:15:24,019 --> 00:15:26,149
around random places and stop on the

401
00:15:26,149 --> 00:15:27,440
highway and see if it would start

402
00:15:27,440 --> 00:15:28,670
probing for the network there maybe it

403
00:15:28,670 --> 00:15:30,260
has something to do with geolocation and

404
00:15:30,260 --> 00:15:31,550
then I thought now I'm definitely gonna

405
00:15:31,550 --> 00:15:33,260
need a Faraday cage so what I'll do is

406
00:15:33,260 --> 00:15:34,820
I'll build a small one to start off with

407
00:15:34,820 --> 00:15:36,649
and then I'll build a really big one so

408
00:15:36,649 --> 00:15:38,180
I bought a ton of chicken wire I've got

409
00:15:38,180 --> 00:15:40,220
this huge roll of chicken wire and I

410
00:15:40,220 --> 00:15:42,350
proudly made my small one crocodile

411
00:15:42,350 --> 00:15:44,450
clips or wired it up to ground put my

412
00:15:44,450 --> 00:15:46,910
phone in beaming with anticipation and

413
00:15:46,910 --> 00:15:49,670
it did nothing and then I realized I'd

414
00:15:49,670 --> 00:15:52,100
confused microns and millimeters and

415
00:15:52,100 --> 00:15:54,019
pretty embarrassing ly so now I just

416
00:15:54,019 --> 00:15:55,279
have a giant roll of chicken wire if

417
00:15:55,279 --> 00:15:57,589
anyone wants it but what I did figure

418
00:15:57,589 --> 00:15:59,990
out is that if I stood behind my geezer

419
00:15:59,990 --> 00:16:01,910
so in South Africa we call boilers

420
00:16:01,910 --> 00:16:03,950
geezers I know it like you say old men

421
00:16:03,950 --> 00:16:06,230
are geezers so there's not an old man in

422
00:16:06,230 --> 00:16:08,329
my wall there is a boiler so if I stood

423
00:16:08,329 --> 00:16:09,980
behind the boiler in the one wall and

424
00:16:09,980 --> 00:16:11,870
then I couldn't get signal for my Wi-Fi

425
00:16:11,870 --> 00:16:14,089
network on the other side so I sat there

426
00:16:14,089 --> 00:16:15,709
with sort of a bunch of devices in my

427
00:16:15,709 --> 00:16:17,649
phone and hiding behind my geezer and

428
00:16:17,649 --> 00:16:20,029
the boiler not the old man and then I'd

429
00:16:20,029 --> 00:16:21,890
sort of go like this and my phone would

430
00:16:21,890 --> 00:16:24,020
pick up the network and that was my my

431
00:16:24,020 --> 00:16:25,790
makeshift Faraday cage anyway what we

432
00:16:25,790 --> 00:16:28,220
figured out is that iOS devices will

433
00:16:28,220 --> 00:16:30,410
only probe for hidden networks if they

434
00:16:30,410 --> 00:16:32,029
see at least one hidden network doesn't

435
00:16:32,029 --> 00:16:33,829
have to be the hidden network they just

436
00:16:33,829 --> 00:16:35,959
have to see a hidden network and in

437
00:16:35,959 --> 00:16:37,190
particular they're looking for the

438
00:16:37,190 --> 00:16:40,339
beacons of so the very simple fix and

439
00:16:40,339 --> 00:16:41,449
whether you're running Snoopy or

440
00:16:41,449 --> 00:16:43,820
something like this and implemented in

441
00:16:43,820 --> 00:16:46,579
the manner toolkit is just to have a

442
00:16:46,579 --> 00:16:48,410
hidden network nearby it and we've got a

443
00:16:48,410 --> 00:16:50,060
config for hidden network you can have a

444
00:16:50,060 --> 00:16:51,980
Wi-Fi card doing that or you can just

445
00:16:51,980 --> 00:16:53,149
have a my fire with a hidden network

446
00:16:53,149 --> 00:16:55,519
anything will work but the the more

447
00:16:55,519 --> 00:16:57,649
important problem is if I OS devices are

448
00:16:57,649 --> 00:16:59,920
probing less and we're not getting those

449
00:16:59,920 --> 00:17:03,170
networks on there PL how do we get them

450
00:17:03,170 --> 00:17:05,540
to connect and interestingly Google has

451
00:17:05,540 --> 00:17:08,130
pushed the patch to WPA supplicant to

452
00:17:08,130 --> 00:17:10,829
fix Android devices probing for metrics

453
00:17:10,829 --> 00:17:12,689
on the P&L so technically stuff like

454
00:17:12,689 --> 00:17:15,829
Snoopy's not going to work too much

455
00:17:15,829 --> 00:17:19,679
anymore and so in looking at that we

456
00:17:19,679 --> 00:17:21,000
implemented something called loud mode

457
00:17:21,000 --> 00:17:24,569
the idea is that maybe your iOS devices

458
00:17:24,569 --> 00:17:26,069
and probing for that network but

459
00:17:26,069 --> 00:17:27,569
possibly you've got another smartphone

460
00:17:27,569 --> 00:17:30,179
or a tablet on you and we've got a

461
00:17:30,179 --> 00:17:32,010
laptop so none of these things have been

462
00:17:32,010 --> 00:17:33,900
implement in laptops laptop still probe

463
00:17:33,900 --> 00:17:37,230
wildly and we can have a look at that so

464
00:17:37,230 --> 00:17:39,390
if I run this in loud mode what you'll

465
00:17:39,390 --> 00:17:41,130
see is it'll now instead of

466
00:17:41,130 --> 00:17:42,870
rebroadcasting individually to your

467
00:17:42,870 --> 00:17:45,210
advice device it'll rebroadcast

468
00:17:45,210 --> 00:17:46,710
everyone's networks to everyone's else

469
00:17:46,710 --> 00:17:48,299
so if you look at the available Wi-Fi

470
00:17:48,299 --> 00:17:50,010
networks right now you're gonna see a

471
00:17:50,010 --> 00:17:52,020
lot like all of the Wi-Fi networks that

472
00:17:52,020 --> 00:17:53,820
each of you are probing for be

473
00:17:53,820 --> 00:17:58,260
rebroadcast thanks Dan so on in the

474
00:17:58,260 --> 00:17:59,850
config file on the Left there's a

475
00:17:59,850 --> 00:18:02,960
configuration option oh I went too far

476
00:18:02,960 --> 00:18:09,330
we've gone too far is it playing ok so

477
00:18:09,330 --> 00:18:10,620
as a configuration option called con

478
00:18:10,620 --> 00:18:12,720
allowed you flip the bit and you start

479
00:18:12,720 --> 00:18:16,159
up comma and what you'll notice on the

480
00:18:16,159 --> 00:18:18,659
device on the right hand side is

481
00:18:18,659 --> 00:18:20,280
initially it's there's a couple of

482
00:18:20,280 --> 00:18:21,659
networks showing up if you pay attention

483
00:18:21,659 --> 00:18:23,549
to which network you'll know where we

484
00:18:23,549 --> 00:18:26,490
were doing this and once we turn it on

485
00:18:26,490 --> 00:18:27,750
you'll see a bunch of networks being

486
00:18:27,750 --> 00:18:29,640
rebroadcast on the left and when we re

487
00:18:29,640 --> 00:18:32,159
scan for Wi-Fi networks on the device

488
00:18:32,159 --> 00:18:34,950
suddenly a whole bunch show up so it's

489
00:18:34,950 --> 00:18:36,240
called loud mode for a reason because

490
00:18:36,240 --> 00:18:38,280
it's pretty damn loud you can spot it

491
00:18:38,280 --> 00:18:40,860
but the idea here is that either you

492
00:18:40,860 --> 00:18:42,390
here with somebody who goes to the same

493
00:18:42,390 --> 00:18:44,250
works at the same place or you've been

494
00:18:44,250 --> 00:18:46,260
to the same hotel or you've been to the

495
00:18:46,260 --> 00:18:48,390
same Airport or something like that and

496
00:18:48,390 --> 00:18:50,429
one of you is going to have a an open

497
00:18:50,429 --> 00:18:52,860
network in common so that's something

498
00:18:52,860 --> 00:18:54,809
else we built into the Karma framework

499
00:18:54,809 --> 00:18:58,350
not Framework toolkit ok then the next

500
00:18:58,350 --> 00:18:59,880
thing we wanted to deal with were

501
00:18:59,880 --> 00:19:02,340
secured networks so karma attacks deal

502
00:19:02,340 --> 00:19:04,020
with open networks they don't deal with

503
00:19:04,020 --> 00:19:07,710
WPA where it or - 1x networks now in

504
00:19:07,710 --> 00:19:09,830
trying to find a picture to represent

505
00:19:09,830 --> 00:19:12,539
802 1x networks daniel had this really

506
00:19:12,539 --> 00:19:15,090
good idea why don't we put the Wi-Fi

507
00:19:15,090 --> 00:19:16,980
card in a condom and we agreed to his

508
00:19:16,980 --> 00:19:19,530
Wi-Fi card not mine and Daniel being a

509
00:19:19,530 --> 00:19:21,070
true gentleman

510
00:19:21,070 --> 00:19:23,200
doesn't buy his own condoms so he sent

511
00:19:23,200 --> 00:19:24,970
Jonathan unused in turn off to go and

512
00:19:24,970 --> 00:19:27,970
buy them which resulted in this very

513
00:19:27,970 --> 00:19:30,790
amusing SMS Jonathan got to Tesco and

514
00:19:30,790 --> 00:19:32,680
we'd forgotten how much condoms cost

515
00:19:32,680 --> 00:19:37,000
evidently worth married and had to send

516
00:19:37,000 --> 00:19:41,980
Daniel this rather awkward SMS said to

517
00:19:41,980 --> 00:19:43,510
our young intern who's only nineteen

518
00:19:43,510 --> 00:19:45,310
listen go out and buy some condoms he

519
00:19:45,310 --> 00:19:47,320
said can have some money please which i

520
00:19:47,320 --> 00:19:48,790
think is a good lesser for kids coming

521
00:19:48,790 --> 00:19:49,960
into the industry when your boss asks

522
00:19:49,960 --> 00:19:52,840
you do do something do it just make sure

523
00:19:52,840 --> 00:19:57,760
he gives you the money and so what we

524
00:19:57,760 --> 00:20:00,280
implement it into into the manna toolkit

525
00:20:00,280 --> 00:20:02,470
to deal with editor 1x networks is

526
00:20:02,470 --> 00:20:05,410
twofold the first is to update free

527
00:20:05,410 --> 00:20:08,530
radius wpe into a modern implementation

528
00:20:08,530 --> 00:20:10,540
so Brad Antonia which one of the authors

529
00:20:10,540 --> 00:20:13,300
of free ideas wpe had started writing a

530
00:20:13,300 --> 00:20:15,880
patch for host APD's radius server and

531
00:20:15,880 --> 00:20:17,890
we took that ported it to the modern

532
00:20:17,890 --> 00:20:20,080
version and then finished it so you now

533
00:20:20,080 --> 00:20:21,820
don't need to jump through the hoops to

534
00:20:21,820 --> 00:20:24,400
get free radius wpe working it just

535
00:20:24,400 --> 00:20:26,320
comes and runs in the manner toolkit so

536
00:20:26,320 --> 00:20:27,580
you don't need a separate radius server

537
00:20:27,580 --> 00:20:30,010
so that's quite useful but the next

538
00:20:30,010 --> 00:20:32,200
thing we did is it's nice to get the

539
00:20:32,200 --> 00:20:33,820
creds and normally their domain creds

540
00:20:33,820 --> 00:20:35,290
you typically don't have people running

541
00:20:35,290 --> 00:20:37,870
a tour to 1x networks just at their home

542
00:20:37,870 --> 00:20:41,230
or at Starbucks is if we can get them to

543
00:20:41,230 --> 00:20:44,440
connect to our network as a secured

544
00:20:44,440 --> 00:20:47,770
network so in one of the the guys that I

545
00:20:47,770 --> 00:20:49,420
did this work with originally he built

546
00:20:49,420 --> 00:20:50,940
something called crack apd and

547
00:20:50,940 --> 00:20:53,230
integrated it with into our hostapd

548
00:20:53,230 --> 00:20:55,330
manner toolkit so what it'll do is it'll

549
00:20:55,330 --> 00:20:57,510
take the relevant mschap and

550
00:20:57,510 --> 00:20:59,740
challenge-response stuff farm it out to

551
00:20:59,740 --> 00:21:02,470
something to crack we're using asleep

552
00:21:02,470 --> 00:21:06,310
with the RockYou database and if it

553
00:21:06,310 --> 00:21:08,140
successfully cracks it quickly it'll

554
00:21:08,140 --> 00:21:10,390
automatically add it to the radius users

555
00:21:10,390 --> 00:21:12,340
list and then if that device tries to

556
00:21:12,340 --> 00:21:15,130
connect again they'll they'll be able to

557
00:21:15,130 --> 00:21:16,690
and we get to they get their domain

558
00:21:16,690 --> 00:21:18,760
creds and to man-in-the-middle them so

559
00:21:18,760 --> 00:21:21,070
over here thank you

560
00:21:21,070 --> 00:21:23,260
we've got the Wi-Fi device on the right

561
00:21:23,260 --> 00:21:24,970
which Ian happened to use his own phone

562
00:21:24,970 --> 00:21:26,590
and you'll see there's a secure network

563
00:21:26,590 --> 00:21:28,840
called always-on secure it's already

564
00:21:28,840 --> 00:21:30,130
configured if you have a look at it it's

565
00:21:30,130 --> 00:21:31,510
peep there's a username and password

566
00:21:31,510 --> 00:21:33,520
already specified

567
00:21:33,520 --> 00:21:36,340
so we want this phone to try and connect

568
00:21:36,340 --> 00:21:39,160
to our network so well if we have a look

569
00:21:39,160 --> 00:21:41,440
at the EEP users file on the Left we're

570
00:21:41,440 --> 00:21:43,000
just tailing it we want to look for

571
00:21:43,000 --> 00:21:44,650
something at being added to the bottom

572
00:21:44,650 --> 00:21:47,970
there on the top we're going to start up

573
00:21:47,970 --> 00:21:51,250
manna toolkit in in each mode and what

574
00:21:51,250 --> 00:21:53,440
you'll notice with the phone after it

575
00:21:53,440 --> 00:21:55,720
fires up is that it'll connect to the

576
00:21:55,720 --> 00:21:57,880
oils on secure network but on the Left

577
00:21:57,880 --> 00:21:59,530
you'll see user and password has been

578
00:21:59,530 --> 00:22:01,630
added to that file and there it connects

579
00:22:01,630 --> 00:22:04,059
so the stuff can be cracked really

580
00:22:04,059 --> 00:22:06,070
quickly and so the fact that is the

581
00:22:06,070 --> 00:22:08,050
password was weak and somewhere near the

582
00:22:08,050 --> 00:22:10,120
top of the rock you database means it

583
00:22:10,120 --> 00:22:12,190
gets cracked quickly and actually quick

584
00:22:12,190 --> 00:22:13,660
enough that we can get that person to

585
00:22:13,660 --> 00:22:14,860
connect to the network and you'll see

586
00:22:14,860 --> 00:22:16,570
they're connected as a secure Network on

587
00:22:16,570 --> 00:22:18,550
the right there's a little lock there so

588
00:22:18,550 --> 00:22:21,220
it's not an open network so this is rad

589
00:22:21,220 --> 00:22:23,080
we now have common attacks working

590
00:22:23,080 --> 00:22:25,600
better and we have them dealing with

591
00:22:25,600 --> 00:22:27,700
secure networks plus we're getting those

592
00:22:27,700 --> 00:22:29,020
domain creds and we get a bunch of

593
00:22:29,020 --> 00:22:32,980
updated cool tools okay now at that

594
00:22:32,980 --> 00:22:35,110
point we should have stopped and for our

595
00:22:35,110 --> 00:22:37,480
sanity for our wives you know I already

596
00:22:37,480 --> 00:22:39,520
have all this chicken wire and and

597
00:22:39,520 --> 00:22:41,920
because we did our research was to make

598
00:22:41,920 --> 00:22:43,690
karma taks work better and and we've

599
00:22:43,690 --> 00:22:46,030
done it and we killed ourselves actually

600
00:22:46,030 --> 00:22:47,980
I think you lost your hair when you

601
00:22:47,980 --> 00:22:49,660
wrote the hostapd patches is that right

602
00:22:49,660 --> 00:22:51,760
it's just like low-level C code with no

603
00:22:51,760 --> 00:22:53,950
comments you have to just sit there

604
00:22:53,950 --> 00:22:55,960
putting debug statements until you

605
00:22:55,960 --> 00:22:57,330
eventually figure out where you are and

606
00:22:57,330 --> 00:22:59,830
so we actually put a lot of work in up

607
00:22:59,830 --> 00:23:02,140
to this point but the promise of the

608
00:23:02,140 --> 00:23:03,940
stuff is that creds come from the sky

609
00:23:03,940 --> 00:23:05,679
and we're not living up to that promise

610
00:23:05,679 --> 00:23:07,570
without like the money shot and that's

611
00:23:07,570 --> 00:23:09,100
going to happen and when we

612
00:23:09,100 --> 00:23:11,200
man-in-the-middle let's start now most

613
00:23:11,200 --> 00:23:12,760
people will get to a point like us

614
00:23:12,760 --> 00:23:14,500
hackers will get to a point where we're

615
00:23:14,500 --> 00:23:16,270
man in the middling something and we'll

616
00:23:16,270 --> 00:23:18,490
go and then we win right we do all of

617
00:23:18,490 --> 00:23:20,410
this stuff man in the middle and then we

618
00:23:20,410 --> 00:23:22,809
win but anyone who's tried to honestly

619
00:23:22,809 --> 00:23:24,010
man in the middle anyone recently

620
00:23:24,010 --> 00:23:25,750
particularly stuff coming off mobile

621
00:23:25,750 --> 00:23:28,480
devices well no it's not that simple you

622
00:23:28,480 --> 00:23:30,280
don't win we've had people like the

623
00:23:30,280 --> 00:23:32,260
Tunisian government man in the middling

624
00:23:32,260 --> 00:23:35,410
their population and Google have put

625
00:23:35,410 --> 00:23:37,420
certificate pinning in Chrome stuff like

626
00:23:37,420 --> 00:23:40,150
HSTs which we'll get into messes with a

627
00:23:40,150 --> 00:23:43,210
lot of the ability to downgrade SSL and

628
00:23:43,210 --> 00:23:45,550
then just as Daniel pointed out things

629
00:23:45,550 --> 00:23:46,840
like decent if

630
00:23:46,840 --> 00:23:48,730
are optimized for MSN Messenger snowin

631
00:23:48,730 --> 00:23:50,650
users so we need to get the the creds

632
00:23:50,650 --> 00:23:54,520
from the sky so what we did is we got a

633
00:23:54,520 --> 00:23:56,080
bunch of tools we either found

634
00:23:56,080 --> 00:23:58,960
configured wrote modified and put them

635
00:23:58,960 --> 00:24:01,030
into the manna toolkit so the first

636
00:24:01,030 --> 00:24:02,620
thing we built this off is a tool called

637
00:24:02,620 --> 00:24:04,780
SSL split we didn't make any changes to

638
00:24:04,780 --> 00:24:06,400
it we just have a configuration for it

639
00:24:06,400 --> 00:24:06,910
that works

640
00:24:06,910 --> 00:24:09,370
what's rad about SSL split is it will

641
00:24:09,370 --> 00:24:11,560
man-in-the-middle clear text and SSL

642
00:24:11,560 --> 00:24:12,820
protocols

643
00:24:12,820 --> 00:24:15,400
it can also man in the middle non-http

644
00:24:15,400 --> 00:24:18,490
SSL protocols so I'm at the s pop s

645
00:24:18,490 --> 00:24:20,440
which are all really useful sources of

646
00:24:20,440 --> 00:24:22,150
domain credentials so we've got a

647
00:24:22,150 --> 00:24:24,610
configuration there that works and it's

648
00:24:24,610 --> 00:24:25,660
written by a guy named Daniel

649
00:24:25,660 --> 00:24:27,730
Roethlisberger so you see it's man in

650
00:24:27,730 --> 00:24:29,140
the middle and then there's a burger

651
00:24:29,140 --> 00:24:30,790
because his name's actor Stephanie

652
00:24:30,790 --> 00:24:32,170
Dominic honestly thought it was quite

653
00:24:32,170 --> 00:24:34,660
funny to draw stick in sex with a

654
00:24:34,660 --> 00:24:36,400
hamburger going in the middle you didn't

655
00:24:36,400 --> 00:24:37,540
give me a chance to laugh this was

656
00:24:37,540 --> 00:24:41,920
coming so Daniel Roethlisberger alright

657
00:24:41,920 --> 00:24:43,630
then the next thing we built into the

658
00:24:43,630 --> 00:24:47,530
the manna toolkit is we want to have

659
00:24:47,530 --> 00:24:49,960
this no upstream version so if you're a

660
00:24:49,960 --> 00:24:51,880
poor African like me when you come to

661
00:24:51,880 --> 00:24:53,440
the UK and you have to spend all these

662
00:24:53,440 --> 00:24:55,480
millions of pounds and like one pound

663
00:24:55,480 --> 00:24:58,780
can feed a family that's just really

664
00:24:58,780 --> 00:25:00,160
expensive so I'd rather man in the

665
00:25:00,160 --> 00:25:01,630
middle of you without having to pay for

666
00:25:01,630 --> 00:25:03,850
your torrents so we built this no

667
00:25:03,850 --> 00:25:06,790
upstream version and in doing that we

668
00:25:06,790 --> 00:25:08,590
realized that some devices so Windows

669
00:25:08,590 --> 00:25:11,110
devices blackberries Androids they'll do

670
00:25:11,110 --> 00:25:12,610
these really simple call-outs to check

671
00:25:12,610 --> 00:25:14,260
if they're online mostly to check if

672
00:25:14,260 --> 00:25:17,470
they're on a captive Network portal iOS

673
00:25:17,470 --> 00:25:20,170
is a little trickier it will query a

674
00:25:20,170 --> 00:25:23,050
random - - quick request to one of 200

675
00:25:23,050 --> 00:25:25,600
sites on a random path and a random file

676
00:25:25,600 --> 00:25:28,240
and it expects a response and so this

677
00:25:28,240 --> 00:25:29,560
stuff it wasn't particularly difficult

678
00:25:29,560 --> 00:25:31,060
to get around we've just built some

679
00:25:31,060 --> 00:25:33,340
Apache vhosts for that which is part of

680
00:25:33,340 --> 00:25:35,620
the the manna toolkit and there's some

681
00:25:35,620 --> 00:25:36,940
other cool vhosts things like

682
00:25:36,940 --> 00:25:49,180
accounts.google.com Alysha cert on the

683
00:25:49,180 --> 00:25:51,250
device because that makes man in the

684
00:25:51,250 --> 00:25:52,960
middling even better and there was a

685
00:25:52,960 --> 00:25:54,580
story that's like really sensational

686
00:25:54,580 --> 00:25:57,090
story that came out like oh my god

687
00:25:57,090 --> 00:26:00,010
gmail on iOS devices does not do

688
00:26:00,010 --> 00:26:00,950
certificate

689
00:26:00,950 --> 00:26:02,570
which is kind of weird because like

690
00:26:02,570 --> 00:26:04,210
certificate pinning I don't thinks a

691
00:26:04,210 --> 00:26:06,830
universal standard just yet but anyway

692
00:26:06,830 --> 00:26:08,419
once we cut through the Fudd what we

693
00:26:08,419 --> 00:26:10,309
realized was these guys were pushing

694
00:26:10,309 --> 00:26:12,740
malicious iOS profiles to the device and

695
00:26:12,740 --> 00:26:14,899
those malicious iOS profiles just had a

696
00:26:14,899 --> 00:26:17,539
root CA and their which they controlled

697
00:26:17,539 --> 00:26:19,909
so one of our interns Chris built that

698
00:26:19,909 --> 00:26:22,549
and he got it working really well so

699
00:26:22,549 --> 00:26:23,960
that if you just connected to the

700
00:26:23,960 --> 00:26:25,999
network those captive network portal

701
00:26:25,999 --> 00:26:26,690
requests

702
00:26:26,690 --> 00:26:28,999
he'd intercept and you'd literally get a

703
00:26:28,999 --> 00:26:30,529
prompt on your phone as you connected

704
00:26:30,529 --> 00:26:32,360
saying do you want to have your settings

705
00:26:32,360 --> 00:26:34,249
Auto configured for this network here is

706
00:26:34,249 --> 00:26:37,730
a helpful profile and there we padded

707
00:26:37,730 --> 00:26:38,600
ourselves on the back we thought it

708
00:26:38,600 --> 00:26:40,100
worked really well but then we chatted

709
00:26:40,100 --> 00:26:41,960
to Etienne over here who builds and runs

710
00:26:41,960 --> 00:26:43,850
on mobile course and he sort of looked

711
00:26:43,850 --> 00:26:45,619
at us and I think in his mind spat and

712
00:26:45,619 --> 00:26:47,869
said why are you loading iOS profiles

713
00:26:47,869 --> 00:26:49,970
why don't you just push assert right but

714
00:26:49,970 --> 00:26:52,789
that's it Ian yes we are pushing it

715
00:26:52,789 --> 00:26:55,220
he's like no no just just serve the file

716
00:26:55,220 --> 00:26:57,409
I could thank you no you're gonna show

717
00:26:57,409 --> 00:26:59,960
me so it turns out thanks to Etienne

718
00:26:59,960 --> 00:27:01,700
that you can just push a certificate

719
00:27:01,700 --> 00:27:03,950
like not with the fancy header just

720
00:27:03,950 --> 00:27:05,869
serve a certificate file to either iOS

721
00:27:05,869 --> 00:27:08,899
and safari or chrome on Android and it

722
00:27:08,899 --> 00:27:10,309
will helpfully prompt to add this to the

723
00:27:10,309 --> 00:27:12,409
root CA like one prompt and if you click

724
00:27:12,409 --> 00:27:13,190
the wrong button

725
00:27:13,190 --> 00:27:15,320
you win forever which is like it's

726
00:27:15,320 --> 00:27:17,090
almost criminally stupid can you imagine

727
00:27:17,090 --> 00:27:19,940
if you're on your laptop if you happen

728
00:27:19,940 --> 00:27:21,470
to go to a site that was serving a

729
00:27:21,470 --> 00:27:22,730
certificate it'll be like or do you want

730
00:27:22,730 --> 00:27:25,460
to add this to your ETA and so that

731
00:27:25,460 --> 00:27:27,200
stuff actually works really well

732
00:27:27,200 --> 00:27:28,850
particularly if you serve it over the

733
00:27:28,850 --> 00:27:30,259
captive Network portal then you get to a

734
00:27:30,259 --> 00:27:33,470
man-in-the-middle even better and so

735
00:27:33,470 --> 00:27:35,299
speaking of captive network portals so

736
00:27:35,299 --> 00:27:37,009
that's a reference to portal the game I

737
00:27:37,009 --> 00:27:38,659
realize some people didn't get that but

738
00:27:38,659 --> 00:27:40,850
when you connect to I find there to work

739
00:27:40,850 --> 00:27:42,320
and you get one of these things that pop

740
00:27:42,320 --> 00:27:44,990
up yeah that's a really useful place to

741
00:27:44,990 --> 00:27:46,730
get creds so you've got a really simple

742
00:27:46,730 --> 00:27:48,679
captive Network portal which pops up a

743
00:27:48,679 --> 00:27:49,879
things saying you can log in with your

744
00:27:49,879 --> 00:27:52,070
Google creds or hotmail or Twitter or

745
00:27:52,070 --> 00:27:53,529
Facebook please type those in and

746
00:27:53,529 --> 00:27:55,820
hopefully somebody will type those in

747
00:27:55,820 --> 00:27:57,889
but it also gives us a place to try and

748
00:27:57,889 --> 00:28:01,029
push that malicious and certificate and

749
00:28:01,029 --> 00:28:03,200
then lastly so this is all the

750
00:28:03,200 --> 00:28:05,360
man-in-the-middle stuff that we did the

751
00:28:05,360 --> 00:28:07,490
the real problem we had was HSTs

752
00:28:07,490 --> 00:28:09,379
if you try and go to a counselor of

753
00:28:09,379 --> 00:28:11,450
google.com on a device even if you type

754
00:28:11,450 --> 00:28:13,040
in HTTP the counselor

755
00:28:13,040 --> 00:28:14,810
google.com it'll force you to go

756
00:28:14,810 --> 00:28:17,030
straight to SSL it doesn't hit it over

757
00:28:17,030 --> 00:28:19,640
HTTP and then follow a 302 redirect to

758
00:28:19,640 --> 00:28:22,670
SSL go straight to SSL and this is

759
00:28:22,670 --> 00:28:24,740
because of something called HSTs which

760
00:28:24,740 --> 00:28:26,720
stands for HTTP strict Transport

761
00:28:26,720 --> 00:28:30,500
Security and it's a new browser a new

762
00:28:30,500 --> 00:28:31,880
thing that pretty much all browsers

763
00:28:31,880 --> 00:28:34,130
support to enable it all you have to do

764
00:28:34,130 --> 00:28:36,260
is have a single header which specifies

765
00:28:36,260 --> 00:28:39,350
your HSCs policy so a guy named Leonardo

766
00:28:39,350 --> 00:28:41,900
nve gave a really cool talk at blackhat

767
00:28:41,900 --> 00:28:44,900
Asia in this year where he wrote a

768
00:28:44,900 --> 00:28:46,490
version of SSL strip which had been

769
00:28:46,490 --> 00:28:48,830
modified and to have a partial HSTs

770
00:28:48,830 --> 00:28:51,020
bypass and what this does which is

771
00:28:51,020 --> 00:28:52,610
pretty cool is it relies on the fact

772
00:28:52,610 --> 00:28:55,280
that HSTs will be specified for an exact

773
00:28:55,280 --> 00:28:57,530
fully qualified domain name so

774
00:28:57,530 --> 00:29:00,440
accounts.google.com will have an HSTs

775
00:29:00,440 --> 00:29:02,330
entry in your browser if you try and go

776
00:29:02,330 --> 00:29:04,610
to there and it'll mess with it so he

777
00:29:04,610 --> 00:29:07,880
wrote an intercepting DNS proxy that if

778
00:29:07,880 --> 00:29:08,810
you try to go to things like

779
00:29:08,810 --> 00:29:10,910
accounts.google.com would actually send

780
00:29:10,910 --> 00:29:13,160
you to web accounts.google.com which

781
00:29:13,160 --> 00:29:15,260
doesn't exist but the DNS proxy would

782
00:29:15,260 --> 00:29:16,700
make it look like it exists and do this

783
00:29:16,700 --> 00:29:19,970
translation or if you try to go to WWE

784
00:29:19,970 --> 00:29:22,700
it'll take you to Quad W Google comm

785
00:29:22,700 --> 00:29:25,460
also doesn't exist but the DNS proxy

786
00:29:25,460 --> 00:29:27,470
would do this translation and that gives

787
00:29:27,470 --> 00:29:30,380
SSL strip a chance to work again so when

788
00:29:30,380 --> 00:29:35,170
you go to www.hsn

789
00:29:36,070 --> 00:29:39,110
and then we can rewrite the page like we

790
00:29:39,110 --> 00:29:41,000
would an SSL strip to prevent it going

791
00:29:41,000 --> 00:29:44,090
to accounts.google.com will rewrite it

792
00:29:44,090 --> 00:29:46,850
to go to web accounts.google.com of HTTP

793
00:29:46,850 --> 00:29:49,280
and have the DNS proxy and SSL strip do

794
00:29:49,280 --> 00:29:51,320
the stuff in the background so we can

795
00:29:51,320 --> 00:29:53,090
keep stuff in clear text and prevent it

796
00:29:53,090 --> 00:29:56,120
getting upgraded to to SSL and it works

797
00:29:56,120 --> 00:30:03,200
gangbusters so here's a video started ok

798
00:30:03,200 --> 00:30:06,200
so we've got our device and this is the

799
00:30:06,200 --> 00:30:07,730
Chrome browser and we're gonna go to a

800
00:30:07,730 --> 00:30:09,380
website called foo comm which doesn't

801
00:30:09,380 --> 00:30:10,940
exist in our upstream so we get the

802
00:30:10,940 --> 00:30:12,710
captive portal if you have a look it's

803
00:30:12,710 --> 00:30:13,760
got a bunch of different providers

804
00:30:13,760 --> 00:30:15,620
hopefully somebody will type in credits

805
00:30:15,620 --> 00:30:18,650
for that it's lame but it'll work it's

806
00:30:18,650 --> 00:30:20,120
got this auto configure button which

807
00:30:20,120 --> 00:30:23,060
we'll get to a little later but quite

808
00:30:23,060 --> 00:30:26,330
simply if we login with our creds

809
00:30:26,330 --> 00:30:28,040
it's gonna go through to the Apache log

810
00:30:28,040 --> 00:30:30,020
file and we can pull those up we're

811
00:30:30,020 --> 00:30:31,610
currently writing some code to scrape

812
00:30:31,610 --> 00:30:33,440
those things out a bit easier so you

813
00:30:33,440 --> 00:30:34,700
don't have to look at things like Apache

814
00:30:34,700 --> 00:30:37,310
log file but there we go username

815
00:30:37,310 --> 00:30:42,200
password no SSL and it was it was the

816
00:30:42,200 --> 00:30:45,110
captive portal okay but now if we go to

817
00:30:45,110 --> 00:30:47,540
something like accounts and google.com

818
00:30:47,540 --> 00:30:49,520
what you'll notice is that your browser

819
00:30:49,520 --> 00:30:51,860
will get redirected to quad w google

820
00:30:51,860 --> 00:30:54,080
comm for which there is no HSTs entry

821
00:30:54,080 --> 00:30:56,870
plus we can rewrite the sign-in link so

822
00:30:56,870 --> 00:30:58,370
that if you click there it keeps us on

823
00:30:58,370 --> 00:31:00,290
quad w rather than going to accounts or

824
00:31:00,290 --> 00:31:02,360
google.com and this is all fake we've

825
00:31:02,360 --> 00:31:04,010
got an Apache V host part of the manor

826
00:31:04,010 --> 00:31:05,900
toolkit it just looks like Google which

827
00:31:05,900 --> 00:31:07,970
average user most likely going to type

828
00:31:07,970 --> 00:31:10,130
in their creds thinking this is what

829
00:31:10,130 --> 00:31:12,160
Google does when I go to it in browsers

830
00:31:12,160 --> 00:31:14,600
and then same thing we can get that out

831
00:31:14,600 --> 00:31:17,510
of the Apache log files and so that's

832
00:31:17,510 --> 00:31:19,400
quite useful if you don't have upstream

833
00:31:19,400 --> 00:31:22,720
internet you're looking for stuff I

834
00:31:23,050 --> 00:31:25,610
spoke too fast for the video okay now if

835
00:31:25,610 --> 00:31:29,150
we go back to the captive portal on food

836
00:31:29,150 --> 00:31:32,420
comm we can go to any URL doesn't exist

837
00:31:32,420 --> 00:31:34,520
on our absent upstream if we click Auto

838
00:31:34,520 --> 00:31:36,020
configure there this is where it pushes

839
00:31:36,020 --> 00:31:37,640
a certificate so just serves the file

840
00:31:37,640 --> 00:31:39,320
and Android will give you this prompt

841
00:31:39,320 --> 00:31:40,790
which asks for a name for the

842
00:31:40,790 --> 00:31:42,500
certificate and it's just got like this

843
00:31:42,500 --> 00:31:44,510
package contains one CA certificate no

844
00:31:44,510 --> 00:31:46,640
like warning user this is a bad idea and

845
00:31:46,640 --> 00:31:48,500
if you click OK you just get this little

846
00:31:48,500 --> 00:31:50,150
warning the top left hand corner see

847
00:31:50,150 --> 00:31:51,650
there's a which says network may be

848
00:31:51,650 --> 00:31:53,210
monitored which you can imagine your

849
00:31:53,210 --> 00:31:54,710
mother will be like yeah but of course

850
00:31:54,710 --> 00:31:57,010
this networks monas at the NSA you know

851
00:31:57,010 --> 00:31:59,390
so I think for us technical users that's

852
00:31:59,390 --> 00:32:02,630
a really useful warning for I think the

853
00:32:02,630 --> 00:32:04,040
average person it's not and it's just

854
00:32:04,040 --> 00:32:06,380
like if they click OK after being served

855
00:32:06,380 --> 00:32:08,210
a file there's a root CA in there and

856
00:32:08,210 --> 00:32:10,550
you win which is pretty ridiculous okay

857
00:32:10,550 --> 00:32:12,530
so at that point we can now man in the

858
00:32:12,530 --> 00:32:16,370
middle pretty spectacularly cool so

859
00:32:16,370 --> 00:32:19,160
we've managed to fix karma so it's

860
00:32:19,160 --> 00:32:22,430
working better with rogue APs and to be

861
00:32:22,430 --> 00:32:24,500
honest a pen test should be where we

862
00:32:24,500 --> 00:32:26,420
just walk outside the building fire up

863
00:32:26,420 --> 00:32:28,340
the laptop get credentials go home in a

864
00:32:28,340 --> 00:32:30,830
comfy chair and go from there and one of

865
00:32:30,830 --> 00:32:32,300
the cool tools that was written years

866
00:32:32,300 --> 00:32:35,090
ago was fire sheep now doesn't work

867
00:32:35,090 --> 00:32:36,590
anymore but fire [ __ ] was really cool

868
00:32:36,590 --> 00:32:37,340
because we could

869
00:32:37,340 --> 00:32:40,280
airport lounges and just fiddle and have

870
00:32:40,280 --> 00:32:41,810
a look at what people doing and it was

871
00:32:41,810 --> 00:32:43,580
quite sad when it didn't work anymore so

872
00:32:43,580 --> 00:32:45,260
young Glenn Wilkinson down in the corner

873
00:32:45,260 --> 00:32:47,930
decided to write fire lamb and fire and

874
00:32:47,930 --> 00:32:49,250
was really cool and we thought we'll

875
00:32:49,250 --> 00:32:51,410
finally needs to come back into mana so

876
00:32:51,410 --> 00:32:52,850
there's a nice picture of fire lamb and

877
00:32:52,850 --> 00:32:55,730
what fire lamp now enables us to do is

878
00:32:55,730 --> 00:32:58,970
use our malicious rogue ap's collect

879
00:32:58,970 --> 00:33:01,280
credentials and push them into a Firefox

880
00:33:01,280 --> 00:33:03,470
profile and then just have a browser who

881
00:33:03,470 --> 00:33:05,450
ever you know goes to a certain bar or

882
00:33:05,450 --> 00:33:09,440
pub or Facebook etc so as with anything

883
00:33:09,440 --> 00:33:11,150
for a good presentation you need the

884
00:33:11,150 --> 00:33:13,430
money shot and we did promise creds from

885
00:33:13,430 --> 00:33:15,200
heaven and we decided to do a video

886
00:33:15,200 --> 00:33:17,600
showing exactly that now just a word of

887
00:33:17,600 --> 00:33:19,250
warning here we also view cookies as

888
00:33:19,250 --> 00:33:21,500
credentials because for most modern web

889
00:33:21,500 --> 00:33:22,970
applications if you've got a cookie with

890
00:33:22,970 --> 00:33:25,400
everything in its kind of game over so

891
00:33:25,400 --> 00:33:27,170
in this case we've installed the

892
00:33:27,170 --> 00:33:31,640
malicious CA and here is our client

893
00:33:31,640 --> 00:33:33,380
victim and he's associated with manna

894
00:33:33,380 --> 00:33:36,980
and we're gonna open up the browser and

895
00:33:36,980 --> 00:33:39,230
that's google chrome for android and

896
00:33:39,230 --> 00:33:41,390
remember the CA is installed and we can

897
00:33:41,390 --> 00:33:43,670
go to accounts google.com now we're

898
00:33:43,670 --> 00:33:45,620
running this with the upstream so this

899
00:33:45,620 --> 00:33:47,900
is the live Google accounts calm

900
00:33:47,900 --> 00:33:49,370
remember we've got the rogue CA

901
00:33:49,370 --> 00:33:54,500
installed so user logs in there's their

902
00:33:54,500 --> 00:33:56,390
details because it's a live site click

903
00:33:56,390 --> 00:34:00,350
sign in and there are the credentials

904
00:34:00,350 --> 00:34:02,660
court now manner now has access to those

905
00:34:02,660 --> 00:34:04,580
okay so that's all well in cute we've

906
00:34:04,580 --> 00:34:06,380
got the root CA but then if we decide

907
00:34:06,380 --> 00:34:07,850
we're hang on let's go to a domain where

908
00:34:07,850 --> 00:34:09,710
we don't have root CA let's go to

909
00:34:09,710 --> 00:34:12,650
facebook.com now HSTs kicks us in the

910
00:34:12,650 --> 00:34:14,120
ass here and we think well let's use our

911
00:34:14,120 --> 00:34:16,790
bypass here so you notice the quad

912
00:34:16,790 --> 00:34:20,000
double intercom pushes it down to sell

913
00:34:20,000 --> 00:34:23,060
now our SSL strip can do it so we enter

914
00:34:23,060 --> 00:34:25,159
in an account that we created just for

915
00:34:25,159 --> 00:34:31,810
this demo very slow typing

916
00:34:32,870 --> 00:34:35,989
make click noises like a like a Zulu

917
00:34:35,989 --> 00:34:42,110
cause or something and once the user

918
00:34:42,110 --> 00:34:45,350
logs in the accounts are saved into mana

919
00:34:45,350 --> 00:34:46,730
so we're already starting to get

920
00:34:46,730 --> 00:34:51,739
credentials okay then I had to do that

921
00:34:51,739 --> 00:34:54,009
in this one

922
00:35:02,120 --> 00:35:05,440
sorry go to the video

923
00:35:09,420 --> 00:35:11,940
we had this huge argument I like

924
00:35:11,940 --> 00:35:13,859
PowerPoint and Daniel likes keynote so

925
00:35:13,859 --> 00:35:15,660
Daniel women were using keynote and this

926
00:35:15,660 --> 00:35:18,569
is giving me great joy who see who

927
00:35:18,569 --> 00:35:21,390
seriously uses PowerPoint in 2014 well

928
00:35:21,390 --> 00:35:22,680
you know we can play a video in

929
00:35:22,680 --> 00:35:36,480
PowerPoint yeah so that what that video

930
00:35:36,480 --> 00:35:38,579
continues showing which Daniel switched

931
00:35:38,579 --> 00:35:39,240
to in a moment

932
00:35:39,240 --> 00:35:41,190
it's just using the device it takes a

933
00:35:41,190 --> 00:35:43,470
long time so it's this device we check

934
00:35:43,470 --> 00:35:45,960
mail we do it via Gmail we do it by the

935
00:35:45,960 --> 00:35:49,559
mail app got Outlook accounts because I

936
00:35:49,559 --> 00:35:53,730
here's sending mail via Gmail yeah so

937
00:35:53,730 --> 00:35:56,460
right now the the account owner on the

938
00:35:56,460 --> 00:35:59,010
victims device itself they're logging in

939
00:35:59,010 --> 00:36:00,269
by their gmail account

940
00:36:00,269 --> 00:36:01,799
they're sending text messages and all

941
00:36:01,799 --> 00:36:03,000
the same time they're running through

942
00:36:03,000 --> 00:36:05,369
our malicious manner egg P and we're

943
00:36:05,369 --> 00:36:07,170
able to grab the credentials from there

944
00:36:07,170 --> 00:36:10,200
so we're gonna open up the Google Mail

945
00:36:10,200 --> 00:36:16,920
now I believe yes so here's the Google

946
00:36:16,920 --> 00:36:19,200
Mac Google Mail account and there's two

947
00:36:19,200 --> 00:36:21,029
mail accounts in there there's both a

948
00:36:21,029 --> 00:36:23,640
gmail one and an Outlook one and at the

949
00:36:23,640 --> 00:36:26,640
same time both credentials are saved so

950
00:36:26,640 --> 00:36:30,509
if I skip forward yeah so in practice

951
00:36:30,509 --> 00:36:33,509
like Exchange ActiveSync creds were them

952
00:36:33,509 --> 00:36:35,400
probably the most common source of

953
00:36:35,400 --> 00:36:37,890
domain credentials when you when you run

954
00:36:37,890 --> 00:36:40,799
this in a an authorized pen test but

955
00:36:40,799 --> 00:36:42,690
with the main thing is we want a whole

956
00:36:42,690 --> 00:36:44,369
lot of credentials so we decided let's

957
00:36:44,369 --> 00:36:46,859
have a look at Glen's new firelamb and

958
00:36:46,859 --> 00:36:48,599
we're going to see the manner run manner

959
00:36:48,599 --> 00:36:50,640
and we go into our interface and you'll

960
00:36:50,640 --> 00:36:52,200
notice there's six options there

961
00:36:52,200 --> 00:36:54,539
now the IP addresses are the firelamb

962
00:36:54,539 --> 00:36:56,759
options and the MAC address is the old

963
00:36:56,759 --> 00:36:58,470
Firesheep so you can still do both

964
00:36:58,470 --> 00:37:00,930
so we now load up our Firefox profile

965
00:37:00,930 --> 00:37:02,430
which has been pre-populated with all

966
00:37:02,430 --> 00:37:03,869
the credentials we've managed to harvest

967
00:37:03,869 --> 00:37:06,119
so we now logged into the guy's gmail

968
00:37:06,119 --> 00:37:10,019
account and if we scroll down I remember

969
00:37:10,019 --> 00:37:11,940
this is every single credential that has

970
00:37:11,940 --> 00:37:14,430
gone through our rogue ap we find pics

971
00:37:14,430 --> 00:37:17,009
or facebook.com/ we click on that and

972
00:37:17,009 --> 00:37:19,000
we've now managed to

973
00:37:19,000 --> 00:37:26,020
or authenticate as that user no warnings

974
00:37:26,020 --> 00:37:28,180
no malicious warnings no certificate

975
00:37:28,180 --> 00:37:34,600
warnings okay yeah so the firelamb stuff

976
00:37:34,600 --> 00:37:38,290
is showing the cookies or creds to they

977
00:37:38,290 --> 00:37:42,330
get a bad rap no it's done it again yeah

978
00:37:42,330 --> 00:37:53,710
max right so one of the things we're

979
00:37:53,710 --> 00:37:55,060
working on at the moment is just

980
00:37:55,060 --> 00:37:57,220
something which will built into firelamb

981
00:37:57,220 --> 00:37:58,810
that'll pull out all the creds instead

982
00:37:58,810 --> 00:38:00,340
of you having to manually go through

983
00:38:00,340 --> 00:38:02,500
some of the files which will be quite

984
00:38:02,500 --> 00:38:05,050
nice but at the moment it's all in one

985
00:38:05,050 --> 00:38:07,750
directory that the various files get

986
00:38:07,750 --> 00:38:09,430
loaded whether it's mail creds or

987
00:38:09,430 --> 00:38:13,390
cookies that you can pull it from and so

988
00:38:13,390 --> 00:38:16,150
the the promise of this stuff was that

989
00:38:16,150 --> 00:38:18,100
it would be creds from heaven and we can

990
00:38:18,100 --> 00:38:21,880
attest to it we've run it it's part of

991
00:38:21,880 --> 00:38:24,070
the reason why we're we're not doing a

992
00:38:24,070 --> 00:38:25,870
live demo here is like the few times

993
00:38:25,870 --> 00:38:27,340
we've tried to run it in controlled

994
00:38:27,340 --> 00:38:28,870
circumstances you still end up with

995
00:38:28,870 --> 00:38:30,910
somebody across the road or in another

996
00:38:30,910 --> 00:38:33,550
rooms like creds coming through at one

997
00:38:33,550 --> 00:38:34,750
point I was wondering why my disk was

998
00:38:34,750 --> 00:38:36,970
getting full and I realized like a head

999
00:38:36,970 --> 00:38:38,500
of a large corporation was sending all

1000
00:38:38,500 --> 00:38:39,670
of their mail like they were just

1001
00:38:39,670 --> 00:38:41,830
updating their entire mailbox through me

1002
00:38:41,830 --> 00:38:45,250
oh I had to kill it really quickly and

1003
00:38:45,250 --> 00:38:48,600
yeah so in summary what we did is we

1004
00:38:48,600 --> 00:38:51,190
updated karma attacks so that they work

1005
00:38:51,190 --> 00:38:53,590
with modern devices and we built that

1006
00:38:53,590 --> 00:38:55,810
into a tool called hostapd Manor which

1007
00:38:55,810 --> 00:38:57,790
we've released it's on our github github

1008
00:38:57,790 --> 00:39:00,660
coms that sense post fort slash Manor

1009
00:39:00,660 --> 00:39:03,370
we've added some new attacks there to

1010
00:39:03,370 --> 00:39:05,920
deal with things like Network Devices

1011
00:39:05,920 --> 00:39:08,770
probing less to deal with 8:02 1x

1012
00:39:08,770 --> 00:39:11,770
networks to get those credentials we

1013
00:39:11,770 --> 00:39:13,120
then took it further onto the

1014
00:39:13,120 --> 00:39:14,230
man-in-the-middle side and we've built

1015
00:39:14,230 --> 00:39:16,870
pre-built configurations which get you

1016
00:39:16,870 --> 00:39:18,430
actual creds from current

1017
00:39:18,430 --> 00:39:21,220
implementations of yet websites like

1018
00:39:21,220 --> 00:39:23,860
Facebook and Google or the way people

1019
00:39:23,860 --> 00:39:25,990
seem to be checking their mail and the

1020
00:39:25,990 --> 00:39:28,270
end result is at least for corporate

1021
00:39:28,270 --> 00:39:30,160
networks is a very good chance that you

1022
00:39:30,160 --> 00:39:31,720
will get some domain creds

1023
00:39:31,720 --> 00:39:33,250
which is going to make the start of a

1024
00:39:33,250 --> 00:39:34,480
pen test much easier now you can just

1025
00:39:34,480 --> 00:39:37,630
connect over the VPN and turn it into an

1026
00:39:37,630 --> 00:39:39,359
internal instead of all that messy

1027
00:39:39,359 --> 00:39:45,490
hacking okay and I'm we're in the

1028
00:39:45,490 --> 00:39:46,720
process of writing a blog entry about

1029
00:39:46,720 --> 00:39:47,230
this

1030
00:39:47,230 --> 00:39:49,000
so we'll publish that on the sense post

1031
00:39:49,000 --> 00:39:57,490
blog but before we go one more thing on

1032
00:39:57,490 --> 00:39:58,690
the right don't look at the left slide

1033
00:39:58,690 --> 00:40:00,069
we finished that one now on the right

1034
00:40:00,069 --> 00:40:03,300
slide yeah we've got 17 minutes left

1035
00:40:03,300 --> 00:40:06,760
okay so the offensive security guys

1036
00:40:06,760 --> 00:40:09,040
contacted us and have been over helpful

1037
00:40:09,040 --> 00:40:12,040
so they wrote an entire package and make

1038
00:40:12,040 --> 00:40:14,410
file to get the stuff working and so we

1039
00:40:14,410 --> 00:40:15,849
had an installer for things like Kylie

1040
00:40:15,849 --> 00:40:17,260
but it's it's gonna be in Kylie

1041
00:40:17,260 --> 00:40:18,730
hopefully in the next next a little

1042
00:40:18,730 --> 00:40:19,930
while it's currently in the Kylie

1043
00:40:19,930 --> 00:40:21,880
proposed repositories if you're familiar

1044
00:40:21,880 --> 00:40:23,890
with Kylie you can add those apt-get

1045
00:40:23,890 --> 00:40:26,349
install Nana - tool kit and it'll come

1046
00:40:26,349 --> 00:40:28,270
down but the stuffs all nicely

1047
00:40:28,270 --> 00:40:29,650
integrated and Kylie puts it in the

1048
00:40:29,650 --> 00:40:31,420
right folders and directories we're

1049
00:40:31,420 --> 00:40:33,339
still actively doing the the code on

1050
00:40:33,339 --> 00:40:35,770
github but it's working well you can use

1051
00:40:35,770 --> 00:40:38,009
it now

1052
00:40:40,920 --> 00:40:50,479
[Applause]

