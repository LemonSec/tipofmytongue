1
00:00:00,030 --> 00:00:04,650
good morning everyone I am glad to see

2
00:00:04,650 --> 00:00:07,020
that so many of you are here despite

3
00:00:07,020 --> 00:00:10,920
last night's challenges I will guarantee

4
00:00:10,920 --> 00:00:14,490
that this presentation looks better when

5
00:00:14,490 --> 00:00:17,609
you're under the influence so that's

6
00:00:17,609 --> 00:00:23,060
good for me well the stock is get this

7
00:00:23,060 --> 00:00:33,630
turned off so this is I hunt TR 69

8
00:00:33,630 --> 00:00:38,040
admins and started off so just a quick

9
00:00:38,040 --> 00:00:41,129
disclaimer know why speeds were harmed

10
00:00:41,129 --> 00:00:42,180
during the making of this presentation

11
00:00:42,180 --> 00:00:46,489
and not because we didn't want you oh

12
00:00:46,489 --> 00:00:50,010
I'd also like to credit my personal role

13
00:00:50,010 --> 00:00:53,430
model which is InfoSec taylor swift for

14
00:00:53,430 --> 00:00:56,010
providing inspiration and words of

15
00:00:56,010 --> 00:00:58,680
wisdom which you've tried to incorporate

16
00:00:58,680 --> 00:01:01,710
into some of the slides seriously if

17
00:01:01,710 --> 00:01:03,930
you're not following this account you

18
00:01:03,930 --> 00:01:09,420
should because it's hilarious so my name

19
00:01:09,420 --> 00:01:11,580
is Chicago tada

20
00:01:11,580 --> 00:01:14,670
yeah such profile pic much coolness very

21
00:01:14,670 --> 00:01:17,520
professional um I have an amazing wife

22
00:01:17,520 --> 00:01:19,380
and daughter waiting for me back home

23
00:01:19,380 --> 00:01:23,610
I've spent 10 years as an officer in the

24
00:01:23,610 --> 00:01:26,340
Israeli Defense Forces last year I

25
00:01:26,340 --> 00:01:28,939
joined checkpoint where I lead a team of

26
00:01:28,939 --> 00:01:31,560
in the malware and vulnerability

27
00:01:31,560 --> 00:01:33,810
research group and we occasionally do

28
00:01:33,810 --> 00:01:35,040
some very interesting things hopefully

29
00:01:35,040 --> 00:01:37,430
you'll get to see more of us this year

30
00:01:37,430 --> 00:01:44,729
this is my right leg yeah so my left one

31
00:01:44,729 --> 00:01:46,680
has a hexadecimal dump um if you want to

32
00:01:46,680 --> 00:01:50,220
see it come after the talk starting off

33
00:01:50,220 --> 00:01:52,860
with an agenda I'm going to give you an

34
00:01:52,860 --> 00:01:56,880
introduction to what TR 69 is I'm going

35
00:01:56,880 --> 00:02:00,000
to tell you why you should care I'm

36
00:02:00,000 --> 00:02:01,920
gonna get try and give you a sense of

37
00:02:01,920 --> 00:02:04,920
what the landscape feels like we'll move

38
00:02:04,920 --> 00:02:08,149
to show a few examples of bone inch

39
00:02:08,149 --> 00:02:11,420
and conclude with a short summary as a

40
00:02:11,420 --> 00:02:13,400
special bonus for those who will make it

41
00:02:13,400 --> 00:02:16,670
to the end I will show Taylor Swift's

42
00:02:16,670 --> 00:02:20,269
licked frontal pics so residential

43
00:02:20,269 --> 00:02:22,819
gateways security so this is sometimes

44
00:02:22,819 --> 00:02:26,510
referred to as routers Soho routers and

45
00:02:26,510 --> 00:02:28,510
we all know that this is an incredibly

46
00:02:28,510 --> 00:02:31,310
unprotected domain recent here is just

47
00:02:31,310 --> 00:02:32,900
give us more and more good examples of

48
00:02:32,900 --> 00:02:35,690
that so we had we've had the internet

49
00:02:35,690 --> 00:02:38,329
census which shows us that there are

50
00:02:38,329 --> 00:02:40,640
literally millions of devices out there

51
00:02:40,640 --> 00:02:42,319
just waiting to be controlled with

52
00:02:42,319 --> 00:02:46,489
default passwords we've seen rapid evans

53
00:02:46,489 --> 00:02:50,000
great coverage of UPnP exploitation i'm

54
00:02:50,000 --> 00:02:51,769
showing us that it's also quite easy to

55
00:02:51,769 --> 00:02:54,440
run code on on so many devices we've

56
00:02:54,440 --> 00:02:56,930
also seen campaigns targeting these

57
00:02:56,930 --> 00:02:59,450
devices for criminal activity team

58
00:02:59,450 --> 00:03:03,950
comedies so farming and you know really

59
00:03:03,950 --> 00:03:05,480
too many to mention but some of these

60
00:03:05,480 --> 00:03:07,909
guys have actually been doing some very

61
00:03:07,909 --> 00:03:08,540
good work

62
00:03:08,540 --> 00:03:10,700
you know demonstrating the state of

63
00:03:10,700 --> 00:03:15,349
affairs in this domain and i'm here to

64
00:03:15,349 --> 00:03:23,150
extend this notion so what is TRS 69 TR

65
00:03:23,150 --> 00:03:25,879
stands for technical report which is

66
00:03:25,879 --> 00:03:28,639
kind of an RFC and and contrary to what

67
00:03:28,639 --> 00:03:30,650
you'd expect the title and numbering

68
00:03:30,650 --> 00:03:33,049
were not given by a giggling teenager

69
00:03:33,049 --> 00:03:35,480
but more or less respectable body called

70
00:03:35,480 --> 00:03:38,150
the broadband forum it's pre-release no

71
00:03:38,150 --> 00:03:40,190
previously known as the DSL forum and

72
00:03:40,190 --> 00:03:42,440
the frame relay forum but this is

73
00:03:42,440 --> 00:03:44,690
basically a consortium of many players

74
00:03:44,690 --> 00:03:46,669
in the broadband market and they're

75
00:03:46,669 --> 00:03:49,280
attempting to define standards in common

76
00:03:49,280 --> 00:03:53,660
and common goals so in 2004 they

77
00:03:53,660 --> 00:03:56,329
released the CPE wanne management

78
00:03:56,329 --> 00:03:59,690
protocol which is TW MP or more commonly

79
00:03:59,690 --> 00:04:03,680
referred to as just TR 69 the

80
00:04:03,680 --> 00:04:05,389
specification went through five

81
00:04:05,389 --> 00:04:08,090
amendments latest of which released late

82
00:04:08,090 --> 00:04:11,840
last year and to tell the truth it's a

83
00:04:11,840 --> 00:04:16,010
pretty boring 228 page document using

84
00:04:16,010 --> 00:04:17,450
fancy words like mechanism

85
00:04:17,450 --> 00:04:20,480
specifications schema definitions

86
00:04:20,480 --> 00:04:23,450
to describe very simple things so let me

87
00:04:23,450 --> 00:04:25,910
try and you know summarize these done

88
00:04:25,910 --> 00:04:30,590
200 pages for you so this is how TR 69

89
00:04:30,590 --> 00:04:32,990
sessions or our provisioning sessions

90
00:04:32,990 --> 00:04:35,720
look like on the right side you have the

91
00:04:35,720 --> 00:04:39,110
CPE which is you know the TR 69 client

92
00:04:39,110 --> 00:04:41,960
that'll be your home router and on the

93
00:04:41,960 --> 00:04:45,560
left side we have the TR 69 server which

94
00:04:45,560 --> 00:04:48,080
is called an ACS the auto configuration

95
00:04:48,080 --> 00:04:51,800
server and you know they talk and soap

96
00:04:51,800 --> 00:04:55,910
are PC which is XML over HTTP headers we

97
00:04:55,910 --> 00:04:57,890
Hayden tells Taylor Swift says it's cool

98
00:04:57,890 --> 00:05:00,800
so you know it's important to mention

99
00:05:00,800 --> 00:05:02,780
that the DES client always initiates the

100
00:05:02,780 --> 00:05:06,860
session which is a single TCP connection

101
00:05:06,860 --> 00:05:08,540
over which our pcs are crawled back and

102
00:05:08,540 --> 00:05:10,640
forth so the client begins within the

103
00:05:10,640 --> 00:05:13,280
forum telling the server why this

104
00:05:13,280 --> 00:05:15,980
session was initiated the ACS follows

105
00:05:15,980 --> 00:05:18,440
with provisioning functions such as get

106
00:05:18,440 --> 00:05:20,840
parameter values or set parameter values

107
00:05:20,840 --> 00:05:26,060
which do exactly these things and there

108
00:05:26,060 --> 00:05:28,220
is so there is a dual of the

109
00:05:28,220 --> 00:05:30,350
authentication mechanism that you know

110
00:05:30,350 --> 00:05:31,940
the CPE should make sure it's talking

111
00:05:31,940 --> 00:05:34,670
with a verified ACS and the ACS should

112
00:05:34,670 --> 00:05:37,310
only accept sessions from verified

113
00:05:37,310 --> 00:05:40,160
consumer premises equipment pretty

114
00:05:40,160 --> 00:05:46,310
simple so here's a quick example so this

115
00:05:46,310 --> 00:05:50,830
is an ACS set parameter values call

116
00:05:50,830 --> 00:05:54,440
which is you know called for certain CPE

117
00:05:54,440 --> 00:05:57,950
and this is assigning a new value to the

118
00:05:57,950 --> 00:06:00,880
management server key which is in fact

119
00:06:00,880 --> 00:06:04,430
updating the configured ACS URL for a

120
00:06:04,430 --> 00:06:09,700
device very simple

121
00:06:09,700 --> 00:06:14,260
so who uses this so this those are only

122
00:06:14,260 --> 00:06:16,960
some of the names but you can see some

123
00:06:16,960 --> 00:06:20,320
pretty big names here with active TR 69

124
00:06:20,320 --> 00:06:22,840
deployments and you know you can

125
00:06:22,840 --> 00:06:25,240
understand this is not an obscure

126
00:06:25,240 --> 00:06:30,310
protocol so there is a growing trend to

127
00:06:30,310 --> 00:06:33,760
adopt it everywhere this is you know the

128
00:06:33,760 --> 00:06:37,030
widely used de facto device management

129
00:06:37,030 --> 00:06:43,450
standard since 2011 the West Was this

130
00:06:43,450 --> 00:06:47,620
research estimated one 150 TR million TR

131
00:06:47,620 --> 00:06:50,800
69 nimble devices online 30 percent of

132
00:06:50,800 --> 00:06:52,600
which are gateways and and that's really

133
00:06:52,600 --> 00:06:56,110
interesting but how about this so some

134
00:06:56,110 --> 00:06:57,700
very interesting results from Zakhar and

135
00:06:57,700 --> 00:06:59,710
his friends and university of michigan

136
00:06:59,710 --> 00:07:02,920
and they you know scanned lots of the

137
00:07:02,920 --> 00:07:05,860
internet at every port and they showed

138
00:07:05,860 --> 00:07:08,020
that port seven five four seven which is

139
00:07:08,020 --> 00:07:10,720
the default CW input and p port is

140
00:07:10,720 --> 00:07:13,660
actually the second most popular open

141
00:07:13,660 --> 00:07:18,490
port in the world so right after HTTP

142
00:07:18,490 --> 00:07:23,020
see that my MP is up there and that's no

143
00:07:23,020 --> 00:07:28,570
joke talking about some of the

144
00:07:28,570 --> 00:07:33,220
functional use cases for a CSS so you

145
00:07:33,220 --> 00:07:35,560
can use it for what you call is zero

146
00:07:35,560 --> 00:07:36,900
touch configuration which is

147
00:07:36,900 --> 00:07:39,070
provisioning devices once you hook up

148
00:07:39,070 --> 00:07:40,810
the device for the first time you get

149
00:07:40,810 --> 00:07:44,530
all the configuration dumped in etc tech

150
00:07:44,530 --> 00:07:47,380
support the remote management when you

151
00:07:47,380 --> 00:07:49,690
call the call center and you tell them

152
00:07:49,690 --> 00:07:51,430
well I'm having this problem and they

153
00:07:51,430 --> 00:07:53,110
tell you okay we're seeing it we're

154
00:07:53,110 --> 00:07:56,350
fixing it so we can use to monitor for

155
00:07:56,350 --> 00:07:58,980
faults errors or malicious activity

156
00:07:58,980 --> 00:08:02,440
diagnostics and performance replace and

157
00:08:02,440 --> 00:08:05,590
fixed faulty configuration and deploy

158
00:08:05,590 --> 00:08:10,150
upgraded firmware so I'm betting at

159
00:08:10,150 --> 00:08:11,910
least some of you are surprised about

160
00:08:11,910 --> 00:08:15,490
that last will at least and and this is

161
00:08:15,490 --> 00:08:17,260
where you start understanding that the

162
00:08:17,260 --> 00:08:20,110
the power that's interested in this

163
00:08:20,110 --> 00:08:21,360
protocol in

164
00:08:21,360 --> 00:08:25,500
and the in these sessions and and this

165
00:08:25,500 --> 00:08:28,500
is a power that service providers don't

166
00:08:28,500 --> 00:08:32,030
necessarily want you to know about

167
00:08:32,419 --> 00:08:35,070
so I mean think about this for a second

168
00:08:35,070 --> 00:08:36,719
without getting too deep into DM

169
00:08:36,719 --> 00:08:39,570
trusting your compiler issues so who do

170
00:08:39,570 --> 00:08:42,179
you really trust to run code on demand

171
00:08:42,179 --> 00:08:44,610
on your devices

172
00:08:44,610 --> 00:08:49,100
what about what it's silent remotely

173
00:08:49,100 --> 00:08:54,060
with elevated permissions so you know I

174
00:08:54,060 --> 00:08:56,040
might trust some of these heavily

175
00:08:56,040 --> 00:08:58,920
protected update mechanisms from Apple

176
00:08:58,920 --> 00:09:01,200
Microsoft Google I mean but what about

177
00:09:01,200 --> 00:09:08,220
my ISP I mean I don't know so here's a

178
00:09:08,220 --> 00:09:12,120
short story this is my home router or at

179
00:09:12,120 --> 00:09:15,240
least it used to be and you know I'm

180
00:09:15,240 --> 00:09:17,370
starting to learn about TRS 69 and an

181
00:09:17,370 --> 00:09:18,839
appropiate around I'm looking for the

182
00:09:18,839 --> 00:09:22,459
chair 69 or CW MP configuration and

183
00:09:22,459 --> 00:09:25,980
there's no evident pages with these

184
00:09:25,980 --> 00:09:30,570
settings so you know I see I go to

185
00:09:30,570 --> 00:09:32,490
expert mode it's okay I'm an expert I

186
00:09:32,490 --> 00:09:36,029
can do that and still nothing like I

187
00:09:36,029 --> 00:09:37,829
don't see anything there

188
00:09:37,829 --> 00:09:40,019
well there's remote management so it

189
00:09:40,019 --> 00:09:43,380
might be under there but nothing this

190
00:09:43,380 --> 00:09:46,470
this is just the the web management you

191
00:09:46,470 --> 00:09:48,870
know the web UI which is properly turned

192
00:09:48,870 --> 00:09:52,140
off externally by the way you know this

193
00:09:52,140 --> 00:09:54,360
doesn't make sense to me because I know

194
00:09:54,360 --> 00:09:56,959
that this devices should have TR 69

195
00:09:56,959 --> 00:10:00,269
enabled I mean sound effects I heard my

196
00:10:00,269 --> 00:10:04,320
my provider was using it so as it turns

197
00:10:04,320 --> 00:10:07,459
out my provider customized the firmware

198
00:10:07,459 --> 00:10:09,660
to hide the fact that they were in

199
00:10:09,660 --> 00:10:13,640
control and this was done using the

200
00:10:13,640 --> 00:10:17,459
highly sophisticated HTML commenting

201
00:10:17,459 --> 00:10:26,160
technique legible so I entered to the

202
00:10:26,160 --> 00:10:28,560
URL and and and there I go and

203
00:10:28,560 --> 00:10:33,060
get the details and you know I look at

204
00:10:33,060 --> 00:10:35,639
it and wait there's the real is no

205
00:10:35,639 --> 00:10:38,959
legitimate way to turn this off so

206
00:10:38,959 --> 00:10:43,259
disabling the informs no just you know

207
00:10:43,259 --> 00:10:45,149
has no real effect it's just like

208
00:10:45,149 --> 00:10:47,100
disabling the hello messages it's still

209
00:10:47,100 --> 00:10:50,100
there in complete control what you could

210
00:10:50,100 --> 00:10:53,220
do actually has changed the ACS URL or

211
00:10:53,220 --> 00:10:55,170
change the ad authentication parameters

212
00:10:55,170 --> 00:10:57,329
and then you could you know kind of find

213
00:10:57,329 --> 00:11:03,600
your way out on how to disable it but

214
00:11:03,600 --> 00:11:06,629
then in the later former version the

215
00:11:06,629 --> 00:11:09,540
screen actually changed to this which

216
00:11:09,540 --> 00:11:13,470
you know now there really is no way you

217
00:11:13,470 --> 00:11:14,759
know unless you get a root shell on your

218
00:11:14,759 --> 00:11:17,009
router which is a whole different story

219
00:11:17,009 --> 00:11:20,389
to disable TR 69 you know the point is

220
00:11:20,389 --> 00:11:23,040
someone knows that they have a lot of

221
00:11:23,040 --> 00:11:25,800
power in their hands and they clearly

222
00:11:25,800 --> 00:11:31,290
don't want me to know about it so with

223
00:11:31,290 --> 00:11:33,660
that context in mind let's take a

224
00:11:33,660 --> 00:11:37,620
broader look on TR 69 architecture so

225
00:11:37,620 --> 00:11:40,860
again on on this island right side we

226
00:11:40,860 --> 00:11:42,660
have the CPE which is a tier six nine

227
00:11:42,660 --> 00:11:45,269
client and it can also act as a proxy

228
00:11:45,269 --> 00:11:47,370
from any other home devices such as um

229
00:11:47,370 --> 00:11:50,629
VoIP phones Nass devices set up boxes

230
00:11:50,629 --> 00:11:53,069
everything that's gr six nine neighbor

231
00:11:53,069 --> 00:11:56,040
basically and on the left side we have

232
00:11:56,040 --> 00:11:58,949
the ACS you know the one server that's

233
00:11:58,949 --> 00:12:03,120
in control on its northbound side it's

234
00:12:03,120 --> 00:12:06,329
attached to all sorts of ISP internal

235
00:12:06,329 --> 00:12:10,889
assets such as the OSS VSS where yes

236
00:12:10,889 --> 00:12:13,829
billing policy the call center that we

237
00:12:13,829 --> 00:12:17,670
mentioned earlier and you know they have

238
00:12:17,670 --> 00:12:21,779
this API to be used internally and so

239
00:12:21,779 --> 00:12:25,800
wait what there is you know there is one

240
00:12:25,800 --> 00:12:29,579
machine in this entire design which is

241
00:12:29,579 --> 00:12:32,300
in control of an entire fleet of devices

242
00:12:32,300 --> 00:12:37,829
for that is B you know it is in fact the

243
00:12:37,829 --> 00:12:41,790
single point of pwnage you know if ever

244
00:12:41,790 --> 00:12:44,790
there was a single high-value target and

245
00:12:44,790 --> 00:12:48,590
a service provider and that would be it

246
00:12:48,590 --> 00:12:52,290
well luckily the southbound interface

247
00:12:52,290 --> 00:12:54,600
you know as using the most trusted and

248
00:12:54,600 --> 00:12:56,190
insecure line that you can think of

249
00:12:56,190 --> 00:13:00,260
which is the public Internet

250
00:13:02,360 --> 00:13:06,600
so look at it from the apt or a

251
00:13:06,600 --> 00:13:09,900
nation-state attacker perspective you

252
00:13:09,900 --> 00:13:12,930
know you take control of this one target

253
00:13:12,930 --> 00:13:17,240
and you're in complete control by design

254
00:13:17,240 --> 00:13:23,540
over a millions of clients interesting

255
00:13:23,600 --> 00:13:27,510
so we all understand the TR 69 is very

256
00:13:27,510 --> 00:13:30,900
powerful by this point and but what what

257
00:13:30,900 --> 00:13:33,810
could you actually do if you had an ACS

258
00:13:33,810 --> 00:13:39,780
API control of an ACS so of course you

259
00:13:39,780 --> 00:13:41,760
could get private data get the SS IDs of

260
00:13:41,760 --> 00:13:44,580
the Wi-Fi get host names get MAC

261
00:13:44,580 --> 00:13:47,040
addresses get user names get the void

262
00:13:47,040 --> 00:13:50,280
numbers that's sometimes you get the

263
00:13:50,280 --> 00:13:51,540
complete configuration including

264
00:13:51,540 --> 00:13:55,710
passwords you could set every parameter

265
00:13:55,710 --> 00:13:57,900
right you can go for the classic you can

266
00:13:57,900 --> 00:14:00,780
change the DNS servers and and and

267
00:14:00,780 --> 00:14:05,340
selectively own traffic you can uh you

268
00:14:05,340 --> 00:14:08,100
can add a new hidden wireless network

269
00:14:08,100 --> 00:14:12,240
which is you know your own hidden way of

270
00:14:12,240 --> 00:14:14,160
connecting to that to the local area

271
00:14:14,160 --> 00:14:16,550
network at that location

272
00:14:16,550 --> 00:14:19,230
you can replace the web service with an

273
00:14:19,230 --> 00:14:22,530
attacker control tunnel you could

274
00:14:22,530 --> 00:14:24,870
download configurations firmware logs

275
00:14:24,870 --> 00:14:29,070
and of course you know it can go all the

276
00:14:29,070 --> 00:14:31,260
way and and custom bake your own

277
00:14:31,260 --> 00:14:34,860
firmware adding that adding that device

278
00:14:34,860 --> 00:14:37,170
to your botnet you know using that

279
00:14:37,170 --> 00:14:39,120
router is an exit node for all your

280
00:14:39,120 --> 00:14:41,520
illegal activities and you know used to

281
00:14:41,520 --> 00:14:42,930
download all the stuff you don't want to

282
00:14:42,930 --> 00:14:44,340
use you know you don't want from your

283
00:14:44,340 --> 00:14:47,750
house so of course you can do this

284
00:14:47,750 --> 00:14:49,830
selectively you can

285
00:14:49,830 --> 00:14:53,460
to everyone and you know with this

286
00:14:53,460 --> 00:14:56,370
understanding that this is a critical

287
00:14:56,370 --> 00:14:58,260
component in modern Internet

288
00:14:58,260 --> 00:15:01,020
infrastructure let's go out and research

289
00:15:01,020 --> 00:15:06,270
TR 69 so but a couple things popping up

290
00:15:06,270 --> 00:15:09,780
at Google there's Luca she's the main

291
00:15:09,780 --> 00:15:11,760
developer for free CW MP that's know

292
00:15:11,760 --> 00:15:14,490
Chris or C or 69 implementation um but

293
00:15:14,490 --> 00:15:15,630
it's talk is mainly about

294
00:15:15,630 --> 00:15:18,540
interoperability issues and you know

295
00:15:18,540 --> 00:15:22,050
almost nothing about security there's

296
00:15:22,050 --> 00:15:24,870
there's a blog post by 3s labs which is

297
00:15:24,870 --> 00:15:26,370
a couple pages long and they actually

298
00:15:26,370 --> 00:15:31,170
have a few neat points but that's I mean

299
00:15:31,170 --> 00:15:32,940
they didn't continue with anything after

300
00:15:32,940 --> 00:15:39,030
that and that's about it so I mean you

301
00:15:39,030 --> 00:15:40,950
know this is why I think this talk is so

302
00:15:40,950 --> 00:15:43,140
important because no one is talking

303
00:15:43,140 --> 00:15:46,260
about this and we think more people

304
00:15:46,260 --> 00:15:50,040
should and why is that so there probably

305
00:15:50,040 --> 00:15:52,380
is this is software in a niche market

306
00:15:52,380 --> 00:15:55,740
you know it's service provider world you

307
00:15:55,740 --> 00:15:58,560
can't just you know download a trial and

308
00:15:58,560 --> 00:16:00,810
then see what he will and start poking

309
00:16:00,810 --> 00:16:03,720
around the software this is out of most

310
00:16:03,720 --> 00:16:07,770
consumers and researchers reach so where

311
00:16:07,770 --> 00:16:10,290
is the TR 69 community right I mean

312
00:16:10,290 --> 00:16:13,700
where are those TR 69 parties I mean

313
00:16:13,700 --> 00:16:16,230
like you haven't Linux and everything

314
00:16:16,230 --> 00:16:17,760
you know how they say like there's a

315
00:16:17,760 --> 00:16:20,070
subreddit for everything on on reddit

316
00:16:20,070 --> 00:16:23,190
well this I mean there was nothing for

317
00:16:23,190 --> 00:16:26,370
TRS 69 and by the way after the first

318
00:16:26,370 --> 00:16:29,820
time I gave this talk so someone

319
00:16:29,820 --> 00:16:31,620
actually opened in TR 6 and 9 subreddit

320
00:16:31,620 --> 00:16:34,070
with my talk being the only thing there

321
00:16:34,070 --> 00:16:37,290
but you know we're looking for you know

322
00:16:37,290 --> 00:16:40,200
we're looking for a TR 69 media outlet

323
00:16:40,200 --> 00:16:42,630
you know it was some sort of coverage of

324
00:16:42,630 --> 00:16:46,290
what's going on and apparently there is

325
00:16:46,290 --> 00:16:49,710
one so there is actually a website and

326
00:16:49,710 --> 00:16:53,520
its called TR 69 central and I mean

327
00:16:53,520 --> 00:16:56,040
don't you laugh I'll have you know that

328
00:16:56,040 --> 00:16:58,680
they have 16 followers on Twitter and

329
00:16:58,680 --> 00:16:59,580
you see

330
00:16:59,580 --> 00:17:01,930
yeah they have 16 followers on Twitter

331
00:17:01,930 --> 00:17:05,730
they're following 23 people including me

332
00:17:05,730 --> 00:17:09,579
and you know but mainly I'm just I'm

333
00:17:09,579 --> 00:17:10,990
kidding cuz because they actually do a

334
00:17:10,990 --> 00:17:13,150
decent job of covering tr6 and 9

335
00:17:13,150 --> 00:17:15,730
happenings with independent reviews and

336
00:17:15,730 --> 00:17:17,380
then such and when I say they I mean a

337
00:17:17,380 --> 00:17:20,770
very nice guy called max but anyway they

338
00:17:20,770 --> 00:17:23,650
compiled lists of ACS vendors you know

339
00:17:23,650 --> 00:17:25,770
some bigger players some smaller ones

340
00:17:25,770 --> 00:17:28,930
but we started browsing the vendor sites

341
00:17:28,930 --> 00:17:33,100
and as we go along we get this certain

342
00:17:33,100 --> 00:17:37,120
feeling and let me try and show you what

343
00:17:37,120 --> 00:17:43,110
I mean see if we can get this work

344
00:17:45,210 --> 00:17:47,470
welcome to try Turkish try is

345
00:17:47,470 --> 00:17:51,670
presentation on bigger SES si the latest

346
00:17:51,670 --> 00:17:55,420
offer from protection for tr-069 price

347
00:17:55,420 --> 00:17:59,070
to order commercial service

348
00:17:59,880 --> 00:18:02,580
let's begin by logging into bigger a

349
00:18:02,580 --> 00:18:05,730
CSSI ante or username and password

350
00:18:05,730 --> 00:18:08,100
it's admin admin my network and devices

351
00:18:08,100 --> 00:18:10,669
fields full now

352
00:18:10,669 --> 00:18:13,260
okay I think I think that's enough you

353
00:18:13,260 --> 00:18:15,090
get my point

354
00:18:15,090 --> 00:18:19,890
anyway so you know much ACS vendors many

355
00:18:19,890 --> 00:18:23,539
features but such a 1999 look and feel

356
00:18:23,539 --> 00:18:25,370
Wow

357
00:18:25,370 --> 00:18:28,650
so the more you read the more we

358
00:18:28,650 --> 00:18:31,940
understand that ACS software basically

359
00:18:31,940 --> 00:18:36,600
web applications you know with lots of

360
00:18:36,600 --> 00:18:41,039
CPE controlled values that go into lots

361
00:18:41,039 --> 00:18:44,880
of processing right and and we all know

362
00:18:44,880 --> 00:18:46,799
clients can be like totally trusted

363
00:18:46,799 --> 00:18:52,260
right so we can look at your r69

364
00:18:52,260 --> 00:18:55,200
problems and to planes so we have

365
00:18:55,200 --> 00:18:58,140
unsecure configuration and we have

366
00:18:58,140 --> 00:19:03,539
insecure implementations so some words

367
00:19:03,539 --> 00:19:08,820
of wisdom to to begin how do you find a

368
00:19:08,820 --> 00:19:12,600
CSS in the wild so first of all if

369
00:19:12,600 --> 00:19:14,190
you're looking for a certain ACS in a

370
00:19:14,190 --> 00:19:16,980
certain provider hack one router right

371
00:19:16,980 --> 00:19:21,030
or by one router and look at it and

372
00:19:21,030 --> 00:19:24,240
that's it so that's a good method but

373
00:19:24,240 --> 00:19:26,520
you can also scan you know so massively

374
00:19:26,520 --> 00:19:30,450
scan use dead map use mess can you know

375
00:19:30,450 --> 00:19:33,169
there's also UPnP endpoints which are

376
00:19:33,169 --> 00:19:35,640
sometimes open and and there are a lot

377
00:19:35,640 --> 00:19:39,720
of fun public datasets you know had the

378
00:19:39,720 --> 00:19:41,760
internet census have the dns census or

379
00:19:41,760 --> 00:19:43,770
we can just grab for interesting price

380
00:19:43,770 --> 00:19:47,700
strings no how about some google dorks

381
00:19:47,700 --> 00:19:50,780
that will help you find certain products

382
00:19:50,780 --> 00:19:52,380
of course

383
00:19:52,380 --> 00:19:56,090
let me show them that for you as well

384
00:19:56,210 --> 00:19:58,890
any way you look at it there are

385
00:19:58,890 --> 00:20:01,200
vulnerable ACS is online

386
00:20:01,200 --> 00:20:07,010
I guarantee it so how is ACS

387
00:20:07,010 --> 00:20:09,480
authentication performed let's let's

388
00:20:09,480 --> 00:20:11,639
start drilling down into that

389
00:20:11,639 --> 00:20:15,409
so the standard very clearly states that

390
00:20:15,409 --> 00:20:20,460
SSL is recommended so you know which

391
00:20:20,460 --> 00:20:23,789
means that a whole bunch of lazy ice

392
00:20:23,789 --> 00:20:26,879
bees avoided trouble and just go with

393
00:20:26,879 --> 00:20:28,919
with the second option which is a shared

394
00:20:28,919 --> 00:20:31,679
secret which is really HTTP

395
00:20:31,679 --> 00:20:34,580
authentication so I've actually done a

396
00:20:34,580 --> 00:20:37,710
little survey where we were able to see

397
00:20:37,710 --> 00:20:40,799
a few hundred ACS addresses belonging to

398
00:20:40,799 --> 00:20:43,889
a few hundred ice bees and would you

399
00:20:43,889 --> 00:20:45,419
like to guess how many of those were

400
00:20:45,419 --> 00:20:51,269
using SSL before would be a good number

401
00:20:51,269 --> 00:20:55,889
but I was looking for percentage just

402
00:20:55,889 --> 00:21:02,700
throw anything out there how many four

403
00:21:02,700 --> 00:21:03,179
percent

404
00:21:03,179 --> 00:21:06,179
well actually 19% it's not that much

405
00:21:06,179 --> 00:21:09,419
better than where you were going but so

406
00:21:09,419 --> 00:21:14,429
so wait you know 81 percent of ice pees

407
00:21:14,429 --> 00:21:18,989
out there don't even protect these super

408
00:21:18,989 --> 00:21:22,109
critical sessions with any kind of

409
00:21:22,109 --> 00:21:25,289
encryption which which means that you

410
00:21:25,289 --> 00:21:27,690
know using the all of the you know

411
00:21:27,690 --> 00:21:30,749
Snowden leaks we've seen the quantum

412
00:21:30,749 --> 00:21:34,289
capabilities that the NSA has which is

413
00:21:34,289 --> 00:21:37,259
you know TCP injection and you know all

414
00:21:37,259 --> 00:21:42,629
it takes is one little packet and you

415
00:21:42,629 --> 00:21:46,769
can you know upload a new firmware to

416
00:21:46,769 --> 00:21:49,950
that to that router which is I guess

417
00:21:49,950 --> 00:21:54,960
that's quite powerful here's a little

418
00:21:54,960 --> 00:21:58,739
trick we found you know the the secret

419
00:21:58,739 --> 00:21:59,999
they were mentioning before even if

420
00:21:59,999 --> 00:22:03,119
you're not using SSL so you know router

421
00:22:03,119 --> 00:22:05,129
interfaces to try to protect the ACS

422
00:22:05,129 --> 00:22:07,229
password out it's like you know those

423
00:22:07,229 --> 00:22:10,409
asterisks or whatever but you can

424
00:22:10,409 --> 00:22:13,200
actually change the ACS URL which means

425
00:22:13,200 --> 00:22:15,570
like in right now I can redirect it to

426
00:22:15,570 --> 00:22:18,089
any server that I control and it just

427
00:22:18,089 --> 00:22:20,639
tries to authenticate to my server with

428
00:22:20,639 --> 00:22:22,650
that password so that's that's

429
00:22:22,650 --> 00:22:28,950
really you know I heard okay so let's

430
00:22:28,950 --> 00:22:30,930
talk about certificate validation even

431
00:22:30,930 --> 00:22:36,630
for those who actually use SSL you know

432
00:22:36,630 --> 00:22:40,080
it says that if TLS 1.2 is used then the

433
00:22:40,080 --> 00:22:42,450
CPE must authenticate the ACS using an

434
00:22:42,450 --> 00:22:46,620
ACS provider certificate that sounds

435
00:22:46,620 --> 00:22:49,380
right that I mean that sounds okay that

436
00:22:49,380 --> 00:22:52,380
sounds correct but this is how I imagine

437
00:22:52,380 --> 00:22:55,530
that this is perceived and in most is be

438
00:22:55,530 --> 00:23:01,890
management forums so you know we took we

439
00:23:01,890 --> 00:23:04,170
went ahead and done a little field test

440
00:23:04,170 --> 00:23:06,030
and this is obviously a self-signed

441
00:23:06,030 --> 00:23:07,650
certificate that we just you know

442
00:23:07,650 --> 00:23:10,110
created for the purposes of this testing

443
00:23:10,110 --> 00:23:14,580
and you know you claimed to validate SSL

444
00:23:14,580 --> 00:23:16,170
certificates but the fact that you

445
00:23:16,170 --> 00:23:18,170
expect accepted myself find one

446
00:23:18,170 --> 00:23:21,270
determine that that was the lie so even

447
00:23:21,270 --> 00:23:23,940
out of those 19 percent that actually

448
00:23:23,940 --> 00:23:27,090
use SSL there are some that are

449
00:23:27,090 --> 00:23:29,150
incorrectly implementing about

450
00:23:29,150 --> 00:23:32,310
certificate validation still allowing

451
00:23:32,310 --> 00:23:36,380
anyone you know any moderately

452
00:23:36,380 --> 00:23:41,010
persistent attacker or whatever to man

453
00:23:41,010 --> 00:23:42,650
in the middle

454
00:23:42,650 --> 00:23:45,540
yeah and this is the first record face

455
00:23:45,540 --> 00:23:51,930
ball for the name so run through a short

456
00:23:51,930 --> 00:23:55,320
recap so I hope you're convinced that TR

457
00:23:55,320 --> 00:23:58,800
69 you know is dangerously powerful it

458
00:23:58,800 --> 00:24:01,860
makes a very lucrative accessible target

459
00:24:01,860 --> 00:24:03,870
there are a lot of implementations

460
00:24:03,870 --> 00:24:06,410
they're just you know not serious enough

461
00:24:06,410 --> 00:24:10,680
and let's move on to some interesting

462
00:24:10,680 --> 00:24:13,190
findings

463
00:24:15,460 --> 00:24:18,370
so our first target was a java-based

464
00:24:18,370 --> 00:24:20,440
open-source project and it was and it's

465
00:24:20,440 --> 00:24:24,040
called open ICS and instant open serve

466
00:24:24,040 --> 00:24:25,210
it's an open source server

467
00:24:25,210 --> 00:24:28,900
implementation and we started auditing

468
00:24:28,900 --> 00:24:31,690
and three days later we get remote code

469
00:24:31,690 --> 00:24:35,980
execution so yeah at this point we're

470
00:24:35,980 --> 00:24:38,680
like yes this is I mean this is exactly

471
00:24:38,680 --> 00:24:40,420
what we were hoping for I mean we

472
00:24:40,420 --> 00:24:42,160
thought it was going to be easy it's

473
00:24:42,160 --> 00:24:44,710
starting to be easy and you know this is

474
00:24:44,710 --> 00:24:47,980
awesome let's continue so we move on and

475
00:24:47,980 --> 00:24:50,590
you know we pick Genie ACS which is you

476
00:24:50,590 --> 00:24:52,330
know another open source project this

477
00:24:52,330 --> 00:24:55,150
was fairly modern it's under active

478
00:24:55,150 --> 00:24:57,460
development it's using all the new hip

479
00:24:57,460 --> 00:25:01,270
stuff no js' reddish MongoDB N and we

480
00:25:01,270 --> 00:25:03,940
start auditing and two days later we get

481
00:25:03,940 --> 00:25:04,930
a functional remote code execution

482
00:25:04,930 --> 00:25:08,050
exploit so this one is actually kind of

483
00:25:08,050 --> 00:25:13,650
fun okay can you see the um let's see

484
00:25:13,650 --> 00:25:16,080
wait

485
00:25:16,080 --> 00:25:18,310
okay so this this is a regular

486
00:25:18,310 --> 00:25:20,920
expression that's supposed to filter out

487
00:25:20,920 --> 00:25:23,170
bad characters because that parameter is

488
00:25:23,170 --> 00:25:27,130
later moved to eval anyway this is

489
00:25:27,130 --> 00:25:28,740
supposed to filter our bad characters

490
00:25:28,740 --> 00:25:32,050
but they're missing the G at the end of

491
00:25:32,050 --> 00:25:35,500
their regular expression meaning that it

492
00:25:35,500 --> 00:25:38,710
only filters out one bad character and

493
00:25:38,710 --> 00:25:41,470
you know so that allows us to you know

494
00:25:41,470 --> 00:25:44,080
use one bad character and just do

495
00:25:44,080 --> 00:25:47,110
whatever we want and this and this is

496
00:25:47,110 --> 00:25:48,280
serious

497
00:25:48,280 --> 00:25:51,760
also because no js' usually runs this

498
00:25:51,760 --> 00:25:54,220
route which allows us to do all all

499
00:25:54,220 --> 00:26:00,240
sorts of fun stuff and again I mean yeah

500
00:26:01,710 --> 00:26:06,460
so well we're scanning ipv4 for geni ACS

501
00:26:06,460 --> 00:26:10,840
and when you detect an instance and in a

502
00:26:10,840 --> 00:26:13,900
middle-eastern ISP and some

503
00:26:13,900 --> 00:26:18,970
middle-eastern which not Israel and you

504
00:26:18,970 --> 00:26:21,000
know North Miami face is exposed and

505
00:26:21,000 --> 00:26:25,450
Picard face balm and no I called them to

506
00:26:25,450 --> 00:26:27,730
actually report this thing because

507
00:26:27,730 --> 00:26:30,549
you know it's serious and the ICP

508
00:26:30,549 --> 00:26:33,700
Support Center was not thrilled about an

509
00:26:33,700 --> 00:26:35,880
Israeli calling about you know

510
00:26:35,880 --> 00:26:39,159
vulnerable infrastructure you know you

511
00:26:39,159 --> 00:26:40,630
know but this is there's no politics

512
00:26:40,630 --> 00:26:42,340
here this is a pure security research

513
00:26:42,340 --> 00:26:44,970
and calling to do responsible disclosure

514
00:26:44,970 --> 00:26:47,380
because this is you know this is what we

515
00:26:47,380 --> 00:26:51,370
get and you know eight out of ten I

516
00:26:51,370 --> 00:26:54,220
would report that again so they're not

517
00:26:54,220 --> 00:26:55,990
very big to seven thousand devices but

518
00:26:55,990 --> 00:26:59,830
still very serious yeah but you know why

519
00:26:59,830 --> 00:27:02,320
are you leaving a critical internal

520
00:27:02,320 --> 00:27:06,610
asset listening the entire world with no

521
00:27:06,610 --> 00:27:13,210
ACL no firewall nothing next case

522
00:27:13,210 --> 00:27:16,299
it's a big one we can't disclose the

523
00:27:16,299 --> 00:27:19,210
vendor at this point in time but this

524
00:27:19,210 --> 00:27:22,750
one has a massive global install base it

525
00:27:22,750 --> 00:27:25,240
is deployed globally our findings

526
00:27:25,240 --> 00:27:28,419
include an internal API authentication

527
00:27:28,419 --> 00:27:31,450
bypass to sequel injections and one

528
00:27:31,450 --> 00:27:34,450
denial of service the combination of

529
00:27:34,450 --> 00:27:37,419
which interestingly allows writing

530
00:27:37,419 --> 00:27:41,350
arbitrary files including to see slash

531
00:27:41,350 --> 00:27:45,309
Annette pub on an ASP nailed internet

532
00:27:45,309 --> 00:27:48,100
server which means again remote code

533
00:27:48,100 --> 00:27:53,399
execution so we went ahead and contacted

534
00:27:53,399 --> 00:27:56,559
one large provider to test this with

535
00:27:56,559 --> 00:28:01,480
permission on a live server and you know

536
00:28:01,480 --> 00:28:04,510
I was there at the at their office and I

537
00:28:04,510 --> 00:28:06,760
was showing them from my laptop how I

538
00:28:06,760 --> 00:28:09,279
just took control of their entire

539
00:28:09,279 --> 00:28:13,360
infrastructure and yeah so we owned

540
00:28:13,360 --> 00:28:17,710
around half a million devices and and

541
00:28:17,710 --> 00:28:19,630
that's that's you know in a major is be

542
00:28:19,630 --> 00:28:22,929
and that's just an example provider we

543
00:28:22,929 --> 00:28:28,740
just picked one so

544
00:28:28,740 --> 00:28:30,869
you know that's you know his Taylor

545
00:28:30,869 --> 00:28:36,659
Swift's response for that and so so what

546
00:28:36,659 --> 00:28:39,149
can you really do you know if you don't

547
00:28:39,149 --> 00:28:40,409
trust your gateway there aren't many

548
00:28:40,409 --> 00:28:44,429
many things that you can do of course

549
00:28:44,429 --> 00:28:46,169
you can hide under the couch and never

550
00:28:46,169 --> 00:28:48,389
connect to the internet again but but

551
00:28:48,389 --> 00:28:51,360
that's not really an option so I mean

552
00:28:51,360 --> 00:28:55,289
you can audit your TR 69 settings um you

553
00:28:55,289 --> 00:28:57,509
know ensure that they are using SSL you

554
00:28:57,509 --> 00:29:00,480
can test this yourselves you're

555
00:29:00,480 --> 00:29:01,139
unsatisfied

556
00:29:01,139 --> 00:29:05,789
you know disabled if you if you can of

557
00:29:05,789 --> 00:29:07,559
course you can add another home security

558
00:29:07,559 --> 00:29:08,909
layer

559
00:29:08,909 --> 00:29:11,190
I mean checkpoint cells these devices

560
00:29:11,190 --> 00:29:13,259
but you know you can use any open source

561
00:29:13,259 --> 00:29:15,809
for immoral alternatives and and they'll

562
00:29:15,809 --> 00:29:16,799
do just fine

563
00:29:16,799 --> 00:29:23,059
just don't use snort yeah small joke

564
00:29:23,059 --> 00:29:25,619
here are some answers to frequently

565
00:29:25,619 --> 00:29:29,820
asked questions so I am just saying it

566
00:29:29,820 --> 00:29:32,249
out loud I'm not saying that TR 69 is

567
00:29:32,249 --> 00:29:35,519
bad it's just dangerous when it's

568
00:29:35,519 --> 00:29:37,710
unprotected so it's definitely better

569
00:29:37,710 --> 00:29:41,659
than SNMP which is what used to be the

570
00:29:41,659 --> 00:29:45,960
controlling protocol it can be secure it

571
00:29:45,960 --> 00:29:47,970
has some good features you just have to

572
00:29:47,970 --> 00:29:53,070
use them correctly and no I I can't tell

573
00:29:53,070 --> 00:29:56,490
you if vendor X is vulnerable not you

574
00:29:56,490 --> 00:29:58,379
know we have a hundred percent success

575
00:29:58,379 --> 00:30:00,389
the hun percent success rate with the

576
00:30:00,389 --> 00:30:03,029
handful that we've assessed extrapolate

577
00:30:03,029 --> 00:30:06,869
okay I don't know yeah this this is just

578
00:30:06,869 --> 00:30:08,909
so this is from the security point of

579
00:30:08,909 --> 00:30:11,279
view I have nothing against you know any

580
00:30:11,279 --> 00:30:16,950
network providers or whatever how do you

581
00:30:16,950 --> 00:30:22,559
fix the problem so there is no easy fix

582
00:30:22,559 --> 00:30:25,440
really because you know TR 69 has to

583
00:30:25,440 --> 00:30:28,230
mature there are bad implementations out

584
00:30:28,230 --> 00:30:31,379
there we have to make sure we either

585
00:30:31,379 --> 00:30:34,220
don't use them or have them fixed

586
00:30:34,220 --> 00:30:38,159
awareness is the key this is what we

587
00:30:38,159 --> 00:30:39,170
think

588
00:30:39,170 --> 00:30:42,080
this is what we heard to do the security

589
00:30:42,080 --> 00:30:46,250
community which is you know you guys we

590
00:30:46,250 --> 00:30:47,600
really would like to see some more

591
00:30:47,600 --> 00:30:50,860
research coming out on that ACS vendors

592
00:30:50,860 --> 00:30:53,690
write better software um you know put

593
00:30:53,690 --> 00:30:56,240
your money in secure coding show us your

594
00:30:56,240 --> 00:30:58,340
security stance I mean have you ever

595
00:30:58,340 --> 00:31:01,850
seen a bug bounty and four on an ACS

596
00:31:01,850 --> 00:31:05,690
vendor I I haven't service providers you

597
00:31:05,690 --> 00:31:08,180
have to protect your customers this is

598
00:31:08,180 --> 00:31:09,830
your responsibility audit your

599
00:31:09,830 --> 00:31:17,120
infrastructure some future work so first

600
00:31:17,120 --> 00:31:19,640
of all say that the broadband forum has

601
00:31:19,640 --> 00:31:22,490
responded positively and you know they

602
00:31:22,490 --> 00:31:24,080
are looking into the problems that we

603
00:31:24,080 --> 00:31:26,450
violated and they may release a new

604
00:31:26,450 --> 00:31:29,090
amendment with some improvements and you

605
00:31:29,090 --> 00:31:30,410
know we're currently talking with them

606
00:31:30,410 --> 00:31:35,720
and that's great gr 69 client phone ian

607
00:31:35,720 --> 00:31:37,610
pwnage is interesting so you remember

608
00:31:37,610 --> 00:31:40,280
how seven five four seven is you know

609
00:31:40,280 --> 00:31:42,050
the second most popular port in the

610
00:31:42,050 --> 00:31:45,530
world for many many many kinds this is

611
00:31:45,530 --> 00:31:48,260
by design you can't shut it down like

612
00:31:48,260 --> 00:31:51,530
you can for a port 80 and this opens up

613
00:31:51,530 --> 00:31:54,920
an interesting exploitation vector which

614
00:31:54,920 --> 00:31:57,020
we are currently looking into and we

615
00:31:57,020 --> 00:31:58,820
have some very interesting results to

616
00:31:58,820 --> 00:32:00,020
show you

617
00:32:00,020 --> 00:32:04,760
stay tuned for later this year yeah

618
00:32:04,760 --> 00:32:09,890
sorry so thank you very much for your

619
00:32:09,890 --> 00:32:14,480
time you know hit me up on on Twitter or

620
00:32:14,480 --> 00:32:17,030
an email if you want to ask anything

621
00:32:17,030 --> 00:32:22,100
else and going back to what I promised

622
00:32:22,100 --> 00:32:23,980
you remember what I promised earlier

623
00:32:23,980 --> 00:32:29,930
taylor swift's leaked fondle pics so you

624
00:32:29,930 --> 00:32:33,970
asked here they are taylor swift's rack

625
00:32:33,970 --> 00:32:36,200
thank you very much if you have any

626
00:32:36,200 --> 00:32:39,970
questions I'd love to take them now

627
00:32:41,110 --> 00:32:44,420
anyone you can also come over later if

628
00:32:44,420 --> 00:32:46,190
you if you that's more comfortable for

629
00:32:46,190 --> 00:32:48,340
you

630
00:32:50,610 --> 00:32:54,810
great thank you very much

631
00:32:57,840 --> 00:33:00,240
[Applause]

