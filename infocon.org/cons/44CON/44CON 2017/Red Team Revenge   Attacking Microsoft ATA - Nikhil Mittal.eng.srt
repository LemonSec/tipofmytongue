1
00:00:00,140 --> 00:00:04,890
hi good<font color="#E5E5E5"> morning I'm nickel-metal and</font>

2
00:00:03,120 --> 00:00:07,340
you're in the session<font color="#E5E5E5"> red team revenge</font>

3
00:00:04,890 --> 00:00:09,840
<font color="#CCCCCC">attacking Microsoft</font><font color="#E5E5E5"> ata</font>

4
00:00:07,340 --> 00:00:12,629
up so let's get started thanks for

5
00:00:09,840 --> 00:00:14,730
coming to the talk<font color="#E5E5E5"> and I cannot move</font>

6
00:00:12,630 --> 00:00:18,449
<font color="#E5E5E5">I'll usually move around a lot while</font>

7
00:00:14,730 --> 00:00:20,520
<font color="#E5E5E5">speaking but yeah so I'm a hacker I do a</font>

8
00:00:18,449 --> 00:00:22,980
lot of red teaming I<font color="#E5E5E5"> train at</font>

9
00:00:20,520 --> 00:00:25,230
conferences to private training speak at

10
00:00:22,980 --> 00:00:28,529
conferences<font color="#CCCCCC"> I'm associated with</font>

11
00:00:25,230 --> 00:00:31,439
pentester academy<font color="#E5E5E5"> you can find me on</font>

12
00:00:28,529 --> 00:00:34,079
twitter as<font color="#CCCCCC"> Nikhil underscore mi TT so</font>

13
00:00:31,439 --> 00:00:37,230
please go follow me<font color="#CCCCCC"> I'd</font><font color="#E5E5E5"> really like to</font>

14
00:00:34,079 --> 00:00:41,340
see my<font color="#CCCCCC"> Twitter</font><font color="#E5E5E5"> follower count increase</font>

15
00:00:37,230 --> 00:00:43,648
<font color="#E5E5E5">after every talk I blog a regularly on</font>

16
00:00:41,340 --> 00:00:45,329
lab of penetration<font color="#CCCCCC"> test</font><font color="#E5E5E5"> calm that's</font>

17
00:00:43,649 --> 00:00:47,700
that's my home on<font color="#E5E5E5"> the Internet</font>

18
00:00:45,329 --> 00:00:51,329
I maintain<font color="#E5E5E5"> to</font><font color="#CCCCCC"> open-source</font><font color="#E5E5E5"> tool kits for</font>

19
00:00:47,700 --> 00:00:54,660
red teamers<font color="#CCCCCC"> kirtaniyah and</font><font color="#E5E5E5"> nahshon</font><font color="#CCCCCC"> katya</font>

20
00:00:51,329 --> 00:00:57,180
<font color="#E5E5E5">is a toolkit</font><font color="#CCCCCC"> which you can use to create</font>

21
00:00:54,660 --> 00:00:59,760
ready to use a<font color="#E5E5E5"> human interface device</font>

22
00:00:57,180 --> 00:01:03,539
sketches<font color="#E5E5E5"> so it generates either</font>

23
00:00:59,760 --> 00:01:06,830
<font color="#E5E5E5">a PD or I know file which you can burn</font>

24
00:01:03,539 --> 00:01:09,479
<font color="#CCCCCC">to your</font><font color="#E5E5E5"> de new device connected to an</font>

25
00:01:06,830 --> 00:01:10,979
<font color="#E5E5E5">unlocked box and it types interesting</font>

26
00:01:09,479 --> 00:01:13,650
stuff out for<font color="#E5E5E5"> you whatever you</font>

27
00:01:10,979 --> 00:01:16,470
programmed it<font color="#CCCCCC"> to do nishang is a tool</font>

28
00:01:13,650 --> 00:01:17,640
which is a collection of it's sort<font color="#CCCCCC"> of</font><font color="#E5E5E5"> a</font>

29
00:01:16,470 --> 00:01:19,200
framework which<font color="#CCCCCC"> is a collection of</font>

30
00:01:17,640 --> 00:01:20,460
<font color="#CCCCCC">powershell scripts</font><font color="#E5E5E5"> you can generate</font>

31
00:01:19,200 --> 00:01:23,100
scripts<font color="#E5E5E5"> they are ready to use the</font>

32
00:01:20,460 --> 00:01:24,630
<font color="#E5E5E5">scripts as well for</font><font color="#CCCCCC"> different phases of</font>

33
00:01:23,100 --> 00:01:28,229
a<font color="#CCCCCC"> tri team engagement or a penetration</font>

34
00:01:24,630 --> 00:01:29,399
<font color="#E5E5E5">test</font><font color="#CCCCCC"> i'm generally interested in of</font>

35
00:01:28,229 --> 00:01:32,610
course<font color="#E5E5E5"> where</font><font color="#CCCCCC"> i have I have the</font>

36
00:01:29,400 --> 00:01:35,610
permission<font color="#E5E5E5"> to do so I would like to try</font>

37
00:01:32,610 --> 00:01:38,579
new methods<font color="#E5E5E5"> of breaking into boxes by</font>

38
00:01:35,610 --> 00:01:41,100
<font color="#E5E5E5">past offenses if there are any which of</font>

39
00:01:38,579 --> 00:01:44,399
course helps both the<font color="#CCCCCC"> red teamers and</font>

40
00:01:41,100 --> 00:01:47,309
blue teamers<font color="#CCCCCC"> a previously</font><font color="#E5E5E5"> spoken at</font><font color="#CCCCCC"> Def</font>

41
00:01:44,399 --> 00:01:50,670
<font color="#CCCCCC">Con blackhat trained at Kansai quest</font>

42
00:01:47,310 --> 00:01:54,439
<font color="#CCCCCC">bukhan this is my first 44</font><font color="#E5E5E5"> corner and</font>

43
00:01:50,670 --> 00:01:57,840
I'm really<font color="#E5E5E5"> liking it so what is</font>

44
00:01:54,439 --> 00:02:00,779
Microsoft<font color="#E5E5E5"> ata what is the</font><font color="#CCCCCC"> the theory</font>

45
00:01:57,840 --> 00:02:03,600
<font color="#E5E5E5">behind it those of</font><font color="#CCCCCC"> you who regularly pen</font>

46
00:02:00,780 --> 00:02:06,420
test or attack Active Directory networks

47
00:02:03,600 --> 00:02:09,478
you<font color="#CCCCCC"> will see that logs are not something</font>

48
00:02:06,420 --> 00:02:11,160
<font color="#CCCCCC">which provide you especially if you are</font>

49
00:02:09,479 --> 00:02:13,290
<font color="#CCCCCC">on the defense</font><font color="#E5E5E5"> side or on the</font><font color="#CCCCCC"> purple</font>

50
00:02:11,160 --> 00:02:15,810
team side<font color="#E5E5E5"> logs are not something</font>

51
00:02:13,290 --> 00:02:17,540
which provide you an insight on<font color="#E5E5E5"> all the</font>

52
00:02:15,810 --> 00:02:20,819
attacks there are some attacks which

53
00:02:17,540 --> 00:02:23,969
cannot<font color="#E5E5E5"> be detected</font><font color="#CCCCCC"> easily as easily</font><font color="#E5E5E5"> in</font>

54
00:02:20,819 --> 00:02:27,929
logs<font color="#CCCCCC"> maybe as easily</font><font color="#E5E5E5"> by</font><font color="#CCCCCC"> looking at a</font>

55
00:02:23,969 --> 00:02:30,239
<font color="#CCCCCC">traffic or logging could be you</font><font color="#E5E5E5"> know</font>

56
00:02:27,930 --> 00:02:32,370
something<font color="#E5E5E5"> which is much more there are</font>

57
00:02:30,239 --> 00:02:34,319
so many logs<font color="#CCCCCC"> if there are there is</font>

58
00:02:32,370 --> 00:02:37,439
another way<font color="#CCCCCC"> of not</font><font color="#E5E5E5"> looking at the logs</font>

59
00:02:34,319 --> 00:02:39,869
but looking at the traffic<font color="#E5E5E5"> somehow which</font>

60
00:02:37,439 --> 00:02:41,280
allows you<font color="#E5E5E5"> to get a better</font><font color="#CCCCCC"> insight into</font>

61
00:02:39,870 --> 00:02:44,340
attacks in your Active Directory

62
00:02:41,280 --> 00:02:48,659
environment<font color="#E5E5E5"> then how</font><font color="#CCCCCC"> would it look like</font>

63
00:02:44,340 --> 00:02:51,299
it would look like Microsoft's 8888 the

64
00:02:48,659 --> 00:02:54,629
textbook definition<font color="#E5E5E5"> from Microsoft Docs</font>

65
00:02:51,299 --> 00:02:56,700
<font color="#E5E5E5">is it is an on-premises platform that</font>

66
00:02:54,629 --> 00:02:59,340
<font color="#E5E5E5">helps protect your enterprise from</font>

67
00:02:56,700 --> 00:03:01,530
multiple types of advanced targeted

68
00:02:59,340 --> 00:03:05,879
<font color="#CCCCCC">cyberattacks and inside</font><font color="#E5E5E5"> tracks I mean so</font>

69
00:03:01,530 --> 00:03:10,739
many marketing keywords<font color="#E5E5E5"> in</font><font color="#CCCCCC"> here</font><font color="#E5E5E5"> but the</font>

70
00:03:05,879 --> 00:03:13,649
point is 88<font color="#E5E5E5"> as I have encountered it in</font>

71
00:03:10,739 --> 00:03:15,629
in<font color="#E5E5E5"> my</font><font color="#CCCCCC"> real-world assessments 88 too much</font>

72
00:03:13,650 --> 00:03:19,190
extent<font color="#CCCCCC"> actually provides</font><font color="#E5E5E5"> you insight</font>

73
00:03:15,629 --> 00:03:21,870
<font color="#CCCCCC">into what an attacker may be up</font><font color="#E5E5E5"> to it</font>

74
00:03:19,190 --> 00:03:24,000
reads all the traffic on your<font color="#CCCCCC"> domain</font>

75
00:03:21,870 --> 00:03:26,430
controller or domain controllers you

76
00:03:24,000 --> 00:03:29,579
need to mirror all<font color="#CCCCCC"> the traffic going</font><font color="#E5E5E5"> on</font>

77
00:03:26,430 --> 00:03:32,030
there to the<font color="#E5E5E5"> ATS sensors and it reads</font>

78
00:03:29,579 --> 00:03:36,359
some interesting protocols like<font color="#CCCCCC"> arose</font>

79
00:03:32,030 --> 00:03:39,810
LDAP and others to see if there is<font color="#E5E5E5"> any</font>

80
00:03:36,359 --> 00:03:42,870
enemy<font color="#E5E5E5"> in the traffic from our regular</font>

81
00:03:39,810 --> 00:03:45,479
traffic<font color="#E5E5E5"> that is it builds up a profile</font>

82
00:03:42,870 --> 00:03:47,310
<font color="#E5E5E5">of all the users</font><font color="#CCCCCC"> and machines</font><font color="#E5E5E5"> over time</font>

83
00:03:45,479 --> 00:03:51,060
there is an initial learning<font color="#CCCCCC"> period in</font>

84
00:03:47,310 --> 00:03:53,790
<font color="#CCCCCC">fact it can detect behavior</font><font color="#E5E5E5"> behavior</font>

85
00:03:51,060 --> 00:03:56,760
based attacks that is a user<font color="#E5E5E5"> accesses</font><font color="#CCCCCC"> a</font>

86
00:03:53,790 --> 00:04:00,510
resource which he or<font color="#CCCCCC"> she does not</font><font color="#E5E5E5"> access</font>

87
00:03:56,760 --> 00:04:03,120
regularly<font color="#E5E5E5"> and animal based attacks that</font>

88
00:04:00,510 --> 00:04:06,358
is those those<font color="#CCCCCC"> are</font><font color="#E5E5E5"> the ones which you</font>

89
00:04:03,120 --> 00:04:08,129
<font color="#E5E5E5">are going to have a look at today for</font>

90
00:04:06,359 --> 00:04:10,439
animal based attacks<font color="#CCCCCC"> there is a learning</font>

91
00:04:08,129 --> 00:04:11,638
<font color="#CCCCCC">period</font><font color="#E5E5E5"> of one week for behavior based</font>

92
00:04:10,439 --> 00:04:14,759
attacks there is<font color="#E5E5E5"> a learning period of</font>

93
00:04:11,639 --> 00:04:17,519
three weeks<font color="#CCCCCC"> in fact</font><font color="#E5E5E5"> there</font><font color="#CCCCCC"> are some</font>

94
00:04:14,759 --> 00:04:19,918
<font color="#E5E5E5">animal attacks for which there</font><font color="#CCCCCC"> is no</font>

95
00:04:17,519 --> 00:04:22,710
<font color="#E5E5E5">learning period</font><font color="#CCCCCC"> required but we are not</font>

96
00:04:19,918 --> 00:04:25,719
going<font color="#CCCCCC"> to jump into the learning</font><font color="#E5E5E5"> period</font>

97
00:04:22,710 --> 00:04:30,400
right now so this<font color="#E5E5E5"> is</font>

98
00:04:25,720 --> 00:04:32,500
it is basic architecture which a diagram

99
00:04:30,400 --> 00:04:34,179
<font color="#E5E5E5">has</font><font color="#CCCCCC"> been created</font><font color="#E5E5E5"> from the one which you</font>

100
00:04:32,500 --> 00:04:38,650
can find<font color="#E5E5E5"> in the</font><font color="#CCCCCC"> docs target which is</font><font color="#E5E5E5"> a</font>

101
00:04:34,180 --> 00:04:40,690
bit better than<font color="#CCCCCC"> this so this</font><font color="#E5E5E5"> is the 80</font>

102
00:04:38,650 --> 00:04:42,340
<font color="#E5E5E5">gateway this is the component</font><font color="#CCCCCC"> which you</font>

103
00:04:40,690 --> 00:04:44,680
can either in case of small

104
00:04:42,340 --> 00:04:46,659
installations<font color="#CCCCCC"> install</font><font color="#E5E5E5"> on your own domain</font>

105
00:04:44,680 --> 00:04:48,460
controller<font color="#E5E5E5"> or it is a separate box which</font>

106
00:04:46,660 --> 00:04:51,850
<font color="#E5E5E5">looks at the trough traffic and all and</font>

107
00:04:48,460 --> 00:04:55,330
then everything is sent to a<font color="#CCCCCC"> TA Center</font>

108
00:04:51,850 --> 00:04:57,760
it is at this place where<font color="#E5E5E5"> user or</font>

109
00:04:55,330 --> 00:05:00,340
machine profiles are<font color="#CCCCCC"> stored then the</font>

110
00:04:57,760 --> 00:05:04,570
console<font color="#CCCCCC"> 8e console which provides you</font>

111
00:05:00,340 --> 00:05:08,669
access to the alerts is on<font color="#E5E5E5"> this box so</font>

112
00:05:04,570 --> 00:05:11,380
<font color="#E5E5E5">you can have a log forwards</font><font color="#CCCCCC"> traffics</font>

113
00:05:08,670 --> 00:05:15,610
event forwarding etcetera as traffic

114
00:05:11,380 --> 00:05:17,919
<font color="#E5E5E5">source to the ATA gateway in the lab</font>

115
00:05:15,610 --> 00:05:21,130
<font color="#CCCCCC">ville i have tested so I've got two</font>

116
00:05:17,919 --> 00:05:23,650
<font color="#E5E5E5">trainings I have multiple labs all of</font>

117
00:05:21,130 --> 00:05:26,860
them have a TA configured and installed

118
00:05:23,650 --> 00:05:28,750
so<font color="#E5E5E5"> over over the past one year almost</font>

119
00:05:26,860 --> 00:05:31,990
one year<font color="#E5E5E5"> with when I've been using a TA</font>

120
00:05:28,750 --> 00:05:33,790
<font color="#E5E5E5">more than 450</font><font color="#CCCCCC"> of my students or</font>

121
00:05:31,990 --> 00:05:39,669
attendees have tried attacks against a

122
00:05:33,790 --> 00:05:41,740
TA<font color="#CCCCCC"> so if we find</font><font color="#E5E5E5"> any bypasses</font><font color="#CCCCCC"> for any</font>

123
00:05:39,669 --> 00:05:45,099
<font color="#E5E5E5">enemy</font><font color="#CCCCCC"> based detection that is quite sure</font>

124
00:05:41,740 --> 00:05:48,370
that that is a solid bypass if<font color="#E5E5E5"> you if</font>

125
00:05:45,100 --> 00:05:50,140
you can<font color="#CCCCCC"> seem so many</font><font color="#E5E5E5"> of us trying</font><font color="#CCCCCC"> think</font>

126
00:05:48,370 --> 00:05:53,110
so many professionals and actors trying

127
00:05:50,140 --> 00:05:56,909
things<font color="#E5E5E5"> across an installation and still</font>

128
00:05:53,110 --> 00:05:59,950
there is<font color="#CCCCCC"> no detection</font><font color="#E5E5E5"> that means that</font>

129
00:05:56,910 --> 00:06:02,050
the bypass is a solid one<font color="#E5E5E5"> we are going</font>

130
00:05:59,950 --> 00:06:06,280
<font color="#E5E5E5">to use 8 e 1.8 which is the latest</font>

131
00:06:02,050 --> 00:06:10,750
<font color="#CCCCCC">version as of right now when in in the</font>

132
00:06:06,280 --> 00:06:14,940
lab or in<font color="#E5E5E5"> the demonstrations threats of</font>

133
00:06:10,750 --> 00:06:18,070
interest which 88 detects in Drakon

134
00:06:14,940 --> 00:06:18,700
<font color="#E5E5E5">phase account enumeration session a</font>

135
00:06:18,070 --> 00:06:20,469
numeration

136
00:06:18,700 --> 00:06:22,440
active directory enumeration<font color="#CCCCCC"> that is if</font>

137
00:06:20,470 --> 00:06:26,919
you are<font color="#E5E5E5"> trying</font><font color="#CCCCCC"> to have a look at</font><font color="#E5E5E5"> groups</font>

138
00:06:22,440 --> 00:06:29,260
sessions on boxes you know user hunting

139
00:06:26,919 --> 00:06:30,880
<font color="#E5E5E5">for looking for</font><font color="#CCCCCC"> local admin access if</font>

140
00:06:29,260 --> 00:06:33,219
you are<font color="#E5E5E5"> running a text like this it it</font>

141
00:06:30,880 --> 00:06:34,780
tries<font color="#CCCCCC"> to detect them then compromised</font>

142
00:06:33,220 --> 00:06:36,590
credentials that will attacks like brute

143
00:06:34,780 --> 00:06:38,299
force<font color="#E5E5E5"> or</font>

144
00:06:36,590 --> 00:06:40,549
unusual protocol implementation<font color="#E5E5E5"> we'll</font>

145
00:06:38,300 --> 00:06:43,040
see what state abnormal behavior<font color="#CCCCCC"> we are</font>

146
00:06:40,550 --> 00:06:44,990
<font color="#E5E5E5">not going to have a look at the behavior</font>

147
00:06:43,040 --> 00:06:47,720
based detection<font color="#CCCCCC"> then the most</font>

148
00:06:44,990 --> 00:06:49,850
<font color="#E5E5E5">interesting part lateral movement that</font>

149
00:06:47,720 --> 00:06:52,820
is something which which<font color="#CCCCCC"> eighty is</font>

150
00:06:49,850 --> 00:06:56,180
specifically<font color="#E5E5E5"> it has been designed for</font>

151
00:06:52,820 --> 00:06:57,920
focus is really<font color="#E5E5E5"> a lot on a lateral</font>

152
00:06:56,180 --> 00:07:00,170
<font color="#E5E5E5">movement attacks like past the decade</font>

153
00:06:57,920 --> 00:07:01,910
<font color="#E5E5E5">past the hash or pasta hash</font>

154
00:07:00,170 --> 00:07:03,410
abnormal behavior<font color="#E5E5E5"> once again you are not</font>

155
00:07:01,910 --> 00:07:07,480
<font color="#E5E5E5">will</font><font color="#CCCCCC"> have a look</font><font color="#E5E5E5"> at abnormal behavior</font>

156
00:07:03,410 --> 00:07:10,010
<font color="#E5E5E5">then comes</font><font color="#CCCCCC"> your main dominance</font><font color="#E5E5E5"> so if I</font>

157
00:07:07,480 --> 00:07:12,770
<font color="#CCCCCC">don't want to use that</font><font color="#E5E5E5"> word right now</font>

158
00:07:10,010 --> 00:07:16,310
<font color="#E5E5E5">but that cyber kill chain which Lockheed</font>

159
00:07:12,770 --> 00:07:18,109
Martin made popular<font color="#E5E5E5"> the the last thing</font>

160
00:07:16,310 --> 00:07:19,940
comes from<font color="#CCCCCC"> their the domain dominance</font>

161
00:07:18,110 --> 00:07:22,630
<font color="#E5E5E5">part that is the domain persistence</font>

162
00:07:19,940 --> 00:07:26,330
which us mortals called persistence or

163
00:07:22,630 --> 00:07:28,490
maintaining<font color="#E5E5E5"> access marketing buzzwords</font>

164
00:07:26,330 --> 00:07:32,659
call them domain dominance<font color="#E5E5E5"> that is once</font>

165
00:07:28,490 --> 00:07:34,010
you have privileges<font color="#CCCCCC"> enough</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> a domain</font>

166
00:07:32,660 --> 00:07:35,300
let's say a domain admin or an

167
00:07:34,010 --> 00:07:36,349
enterprise admin or or something

168
00:07:35,300 --> 00:07:38,090
interesting<font color="#CCCCCC"> that you think is</font>

169
00:07:36,350 --> 00:07:40,100
interesting<font color="#E5E5E5"> you may like to maintain</font>

170
00:07:38,090 --> 00:07:42,560
your<font color="#CCCCCC"> persists or</font><font color="#E5E5E5"> maintain your excess</font>

171
00:07:40,100 --> 00:07:44,750
persist in in<font color="#E5E5E5"> that domain</font>

172
00:07:42,560 --> 00:07:47,270
that's what domain dominance is which

173
00:07:44,750 --> 00:07:49,610
contains golden ticket attacks<font color="#E5E5E5"> malicious</font>

174
00:07:47,270 --> 00:07:52,190
replication request that's DC<font color="#CCCCCC"> sync</font>

175
00:07:49,610 --> 00:07:55,310
attacks these are the attacks which

176
00:07:52,190 --> 00:07:56,900
<font color="#E5E5E5">eighty eight detects now how</font><font color="#CCCCCC"> would</font><font color="#E5E5E5"> you</font>

177
00:07:55,310 --> 00:08:00,590
avoid that so we<font color="#E5E5E5"> are going to have a</font>

178
00:07:56,900 --> 00:08:03,620
look<font color="#E5E5E5"> at two things in the presentation</font>

179
00:08:00,590 --> 00:08:08,000
or two phrases<font color="#E5E5E5"> one would be how we can</font>

180
00:08:03,620 --> 00:08:10,280
avoid detection how which I talked<font color="#CCCCCC"> about</font>

181
00:08:08,000 --> 00:08:13,130
a bit previously as well<font color="#CCCCCC"> and then how</font>

182
00:08:10,280 --> 00:08:15,200
would<font color="#E5E5E5"> we identify eighty installation in</font>

183
00:08:13,130 --> 00:08:18,200
a domain<font color="#CCCCCC"> and directly attack it</font><font color="#E5E5E5"> so if</font>

184
00:08:15,200 --> 00:08:21,409
you are pissed off at<font color="#E5E5E5"> ATF for some</font>

185
00:08:18,200 --> 00:08:24,620
reason and<font color="#CCCCCC"> you can directly attack</font><font color="#E5E5E5"> it</font>

186
00:08:21,410 --> 00:08:29,150
and make<font color="#CCCCCC"> it now do interesting things</font>

187
00:08:24,620 --> 00:08:32,150
for you<font color="#E5E5E5"> so in case of detection eighty</font>

188
00:08:29,150 --> 00:08:39,280
<font color="#E5E5E5">eight detects attacks like this so if we</font>

189
00:08:32,150 --> 00:08:39,280
have<font color="#E5E5E5"> let's open up this</font><font color="#CCCCCC"> ata here</font>

190
00:08:39,390 --> 00:08:46,040
and this is how it looks at the

191
00:08:44,159 --> 00:08:48,209
enumeration so is it visible<font color="#CCCCCC"> til back</font>

192
00:08:46,040 --> 00:08:50,279
<font color="#CCCCCC">though sitting at the very back and you</font>

193
00:08:48,209 --> 00:08:54,319
see the<font color="#CCCCCC"> text</font><font color="#E5E5E5"> okay</font>

194
00:08:50,279 --> 00:08:57,510
<font color="#CCCCCC">put so this is SMB session enumeration</font>

195
00:08:54,320 --> 00:09:00,990
this is<font color="#CCCCCC"> recon</font><font color="#E5E5E5"> using dark key service</font>

196
00:08:57,510 --> 00:09:04,260
queries<font color="#E5E5E5"> so when you see things like this</font>

197
00:09:00,990 --> 00:09:05,040
<font color="#CCCCCC">samer</font><font color="#E5E5E5"> is a protocol which so let's first</font>

198
00:09:04,260 --> 00:09:07,579
address this

199
00:09:05,040 --> 00:09:11,519
<font color="#CCCCCC">samer</font><font color="#E5E5E5"> is a protocol which is</font><font color="#CCCCCC"> used by</font>

200
00:09:07,579 --> 00:09:15,000
let's say when you run a<font color="#CCCCCC"> nat group /</font>

201
00:09:11,519 --> 00:09:15,709
domain<font color="#E5E5E5"> it is that thing which is visible</font>

202
00:09:15,000 --> 00:09:20,220
<font color="#CCCCCC">here</font>

203
00:09:15,709 --> 00:09:23,180
our<font color="#E5E5E5"> avoiding this is as easy as</font><font color="#CCCCCC"> using</font>

204
00:09:20,220 --> 00:09:27,329
tools like<font color="#CCCCCC"> Power View which use LDAP for</font>

205
00:09:23,180 --> 00:09:29,459
for enumeration<font color="#CCCCCC"> Adia is interested only</font>

206
00:09:27,329 --> 00:09:32,880
<font color="#E5E5E5">in authentication traffic when it comes</font>

207
00:09:29,459 --> 00:09:35,339
to LDAP<font color="#E5E5E5"> so in this case just to avoid</font>

208
00:09:32,880 --> 00:09:36,990
things like<font color="#E5E5E5"> if</font><font color="#CCCCCC"> your if you'd</font><font color="#E5E5E5"> like to see</font>

209
00:09:35,339 --> 00:09:39,480
all the<font color="#E5E5E5"> users in</font><font color="#CCCCCC"> a domain or all the</font>

210
00:09:36,990 --> 00:09:42,510
boxes<font color="#CCCCCC"> in a domain group memberships just</font>

211
00:09:39,480 --> 00:09:46,140
do not<font color="#E5E5E5"> use things like net use maybe</font>

212
00:09:42,510 --> 00:09:49,740
tools like Power View then when it comes

213
00:09:46,140 --> 00:09:53,040
<font color="#E5E5E5">to some interesting animation that</font><font color="#CCCCCC"> is</font>

214
00:09:49,740 --> 00:09:55,260
let's<font color="#E5E5E5"> say there's a very popular way of</font>

215
00:09:53,040 --> 00:09:57,269
looking for domain admin privileges

216
00:09:55,260 --> 00:09:59,430
which is also called user hunting

217
00:09:57,269 --> 00:10:01,140
looking<font color="#CCCCCC"> for a particular box where a</font>

218
00:09:59,430 --> 00:10:04,489
domain admin token may be available<font color="#CCCCCC"> and</font>

219
00:10:01,140 --> 00:10:04,490
you have let's say local<font color="#E5E5E5"> admin access</font>

220
00:10:05,570 --> 00:10:13,260
<font color="#E5E5E5">for that</font><font color="#CCCCCC"> if you closely look at</font><font color="#E5E5E5"> the</font>

221
00:10:10,079 --> 00:10:15,300
message which<font color="#CCCCCC"> ata provides us SMB</font>

222
00:10:13,260 --> 00:10:18,240
session enumeration attempts was

223
00:10:15,300 --> 00:10:21,149
successfully performed<font color="#CCCCCC"> by some user from</font>

224
00:10:18,240 --> 00:10:24,300
some box against ops TC which in in my

225
00:10:21,149 --> 00:10:27,779
lab is the domain controller what does

226
00:10:24,300 --> 00:10:31,170
this message mean this means<font color="#CCCCCC"> 88 does not</font>

227
00:10:27,779 --> 00:10:33,300
has no problem providing<font color="#E5E5E5"> sorry you</font>

228
00:10:31,170 --> 00:10:35,640
asking information<font color="#E5E5E5"> from the domain</font>

229
00:10:33,300 --> 00:10:37,829
controller like the boxes the<font color="#E5E5E5"> member</font>

230
00:10:35,640 --> 00:10:41,189
boxes<font color="#E5E5E5"> or the users of the group</font>

231
00:10:37,829 --> 00:10:44,160
membership<font color="#E5E5E5"> but it has a problem</font><font color="#CCCCCC"> if you</font>

232
00:10:41,190 --> 00:10:46,170
would like<font color="#E5E5E5"> to list sessions on the</font>

233
00:10:44,160 --> 00:10:47,790
domain controller<font color="#CCCCCC"> if you would like to</font>

234
00:10:46,170 --> 00:10:50,310
list<font color="#E5E5E5"> logged on users on the domain</font>

235
00:10:47,790 --> 00:10:52,709
<font color="#E5E5E5">controller</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> is as long</font><font color="#CCCCCC"> as</font><font color="#E5E5E5"> you are</font>

236
00:10:50,310 --> 00:10:55,138
<font color="#CCCCCC">asking very innocent information</font>

237
00:10:52,709 --> 00:10:57,239
that's fine but as soon as<font color="#CCCCCC"> you move</font><font color="#E5E5E5"> on</font>

238
00:10:55,139 --> 00:11:03,809
<font color="#E5E5E5">to a bit intrusive enumeration it</font>

239
00:10:57,240 --> 00:11:07,829
complains but because a DA has<font color="#E5E5E5"> a sensor</font>

240
00:11:03,809 --> 00:11:10,618
<font color="#CCCCCC">only in front of the DC traffic</font><font color="#E5E5E5"> that</font>

241
00:11:07,829 --> 00:11:13,800
<font color="#E5E5E5">means you can extract information from</font>

242
00:11:10,619 --> 00:11:17,249
DC but while you're<font color="#CCCCCC"> doing the intrusive</font>

243
00:11:13,800 --> 00:11:19,008
enumeration just remove the DC<font color="#E5E5E5"> from the</font>

244
00:11:17,249 --> 00:11:22,079
<font color="#CCCCCC">list of boxes you are going to enumerate</font>

245
00:11:19,009 --> 00:11:24,089
<font color="#E5E5E5">that is not poking the DC not talking to</font>

246
00:11:22,079 --> 00:11:25,739
the DC is<font color="#CCCCCC"> the key</font><font color="#E5E5E5"> not</font><font color="#CCCCCC"> only in</font><font color="#E5E5E5"> this case</font>

247
00:11:24,089 --> 00:11:29,699
in all the cases if you're avoiding

248
00:11:25,740 --> 00:11:35,720
talking<font color="#E5E5E5"> to the DC if you can then</font><font color="#CCCCCC"> ATM</font>

249
00:11:29,699 --> 00:11:43,589
would not be<font color="#E5E5E5"> very useful</font><font color="#CCCCCC"> so for example</font>

250
00:11:35,720 --> 00:11:46,759
let's say<font color="#CCCCCC"> we have a list here if I get a</font>

251
00:11:43,589 --> 00:11:46,759
list of boxes

252
00:11:48,999 --> 00:11:54,079
so these are the users in the<font color="#E5E5E5"> door sorry</font>

253
00:11:52,220 --> 00:12:02,600
the member computers in this domain

254
00:11:54,079 --> 00:12:05,508
<font color="#E5E5E5">which we can simply get using something</font>

255
00:12:02,600 --> 00:12:09,919
<font color="#E5E5E5">like power wheel we simply run</font><font color="#CCCCCC"> getnet</font>

256
00:12:05,509 --> 00:12:11,689
computer and we get a list of all the

257
00:12:09,919 --> 00:12:14,660
<font color="#E5E5E5">machine or member computers in the</font>

258
00:12:11,689 --> 00:12:22,669
domain<font color="#E5E5E5"> please note that in the list</font>

259
00:12:14,660 --> 00:12:25,399
which we have here we<font color="#CCCCCC"> have just</font><font color="#E5E5E5"> made one</font>

260
00:12:22,669 --> 00:12:28,339
<font color="#CCCCCC">change there is no domain controller</font><font color="#E5E5E5"> in</font>

261
00:12:25,399 --> 00:12:31,939
this list<font color="#CCCCCC"> so we've just</font><font color="#E5E5E5"> removed this</font>

262
00:12:28,339 --> 00:12:36,309
part right and<font color="#CCCCCC"> now if we run as</font>

263
00:12:31,939 --> 00:12:36,309
<font color="#CCCCCC">intrusive enumeration as this</font>

264
00:12:41,750 --> 00:12:49,850
<font color="#CCCCCC">Oh ATF will not complain at all</font><font color="#E5E5E5"> why</font>

265
00:12:46,370 --> 00:12:51,950
because we are<font color="#CCCCCC"> not running</font><font color="#E5E5E5"> the intrusive</font>

266
00:12:49,850 --> 00:12:53,650
<font color="#E5E5E5">enumeration against the DC it is fine as</font>

267
00:12:51,950 --> 00:12:57,440
long as<font color="#E5E5E5"> you just extract the information</font>

268
00:12:53,650 --> 00:13:00,260
<font color="#CCCCCC">but as long as you are not listing the</font>

269
00:12:57,440 --> 00:13:02,980
session it<font color="#E5E5E5"> is quite clear the that it</font>

270
00:13:00,260 --> 00:13:06,650
complaints about session and emulation

271
00:13:02,980 --> 00:13:08,990
<font color="#E5E5E5">that's what it</font><font color="#CCCCCC"> has</font><font color="#E5E5E5"> problems</font><font color="#CCCCCC"> with so as</font>

272
00:13:06,650 --> 00:13:11,060
long<font color="#E5E5E5"> as you avoid running or let's say</font>

273
00:13:08,990 --> 00:13:13,520
<font color="#CCCCCC">invoke use your hunter blindly without</font>

274
00:13:11,060 --> 00:13:16,930
<font color="#E5E5E5">removing the domain controller</font><font color="#CCCCCC"> 88 it</font>

275
00:13:13,520 --> 00:13:24,350
would be fine<font color="#CCCCCC"> with that</font><font color="#E5E5E5"> and there is no</font>

276
00:13:16,930 --> 00:13:26,540
<font color="#E5E5E5">detection for that absolutely that's so</font>

277
00:13:24,350 --> 00:13:29,240
you can<font color="#CCCCCC"> use</font><font color="#E5E5E5"> it for let's say looking</font><font color="#CCCCCC"> for</font>

278
00:13:26,540 --> 00:13:31,099
local<font color="#E5E5E5"> admins or</font><font color="#CCCCCC"> any any interesting</font>

279
00:13:29,240 --> 00:13:33,350
thing which<font color="#CCCCCC"> would</font><font color="#E5E5E5"> like to</font><font color="#CCCCCC"> just keep in</font>

280
00:13:31,100 --> 00:13:36,080
<font color="#CCCCCC">mind that</font><font color="#E5E5E5"> only extract information from</font>

281
00:13:33,350 --> 00:13:36,530
the DC and do not run<font color="#E5E5E5"> intrusive</font><font color="#CCCCCC"> a</font>

282
00:13:36,080 --> 00:13:39,710
<font color="#E5E5E5">numeration</font>

283
00:13:36,530 --> 00:13:41,890
against the DC itself<font color="#E5E5E5"> and you will be</font>

284
00:13:39,710 --> 00:13:48,260
fine with that

285
00:13:41,890 --> 00:13:51,949
<font color="#E5E5E5">okay then</font><font color="#CCCCCC"> SPN scanning</font><font color="#E5E5E5"> the popular way</font>

286
00:13:48,260 --> 00:13:54,319
<font color="#CCCCCC">of looking for those services</font><font color="#E5E5E5"> whose SPN</font>

287
00:13:51,950 --> 00:13:58,310
is registered with<font color="#E5E5E5"> the DC is not</font>

288
00:13:54,320 --> 00:14:01,089
detected at all by a TA<font color="#E5E5E5"> and as far</font><font color="#CCCCCC"> as</font><font color="#E5E5E5"> I</font>

289
00:13:58,310 --> 00:14:04,209
<font color="#E5E5E5">know there are no plans of</font><font color="#CCCCCC"> doing it</font><font color="#E5E5E5"> so</font>

290
00:14:01,089 --> 00:14:07,240
that's another very<font color="#CCCCCC"> interesting</font>

291
00:14:04,210 --> 00:14:09,620
enumeration<font color="#CCCCCC"> which doesn't get</font><font color="#E5E5E5"> detected</font>

292
00:14:07,240 --> 00:14:12,020
of course<font color="#E5E5E5"> that's not on the slides right</font>

293
00:14:09,620 --> 00:14:13,850
now because I'm more interested<font color="#E5E5E5"> in</font>

294
00:14:12,020 --> 00:14:16,550
providing the in going through<font color="#E5E5E5"> the</font>

295
00:14:13,850 --> 00:14:19,280
<font color="#E5E5E5">attacking</font><font color="#CCCCCC"> ata</font><font color="#E5E5E5"> part but for example</font><font color="#CCCCCC"> if</font>

296
00:14:16,550 --> 00:14:21,020
you use<font color="#CCCCCC"> brute</font><font color="#E5E5E5"> forcing</font><font color="#CCCCCC"> or the</font><font color="#E5E5E5"> horizontal</font>

297
00:14:19,280 --> 00:14:24,949
one the well-known<font color="#E5E5E5"> one where you try a</font>

298
00:14:21,020 --> 00:14:28,520
single<font color="#CCCCCC"> password against multiple domain</font>

299
00:14:24,950 --> 00:14:30,200
users and because it's a single<font color="#E5E5E5"> attempt</font>

300
00:14:28,520 --> 00:14:32,720
they would be no<font color="#CCCCCC"> lock out</font><font color="#E5E5E5"> that also</font>

301
00:14:30,200 --> 00:14:35,240
<font color="#E5E5E5">doesn't</font><font color="#CCCCCC"> get detected once</font><font color="#E5E5E5"> again because</font>

302
00:14:32,720 --> 00:14:37,280
it depends totally on the tool<font color="#E5E5E5"> so if you</font>

303
00:14:35,240 --> 00:14:39,200
are using a partial script like one from

304
00:14:37,280 --> 00:14:42,050
<font color="#CCCCCC">nishang invoke</font><font color="#E5E5E5"> brute force it doesn't</font>

305
00:14:39,200 --> 00:14:44,620
that get detected because<font color="#E5E5E5"> that uses LDAP</font>

306
00:14:42,050 --> 00:14:47,510
queries of course if<font color="#CCCCCC"> you're</font><font color="#E5E5E5"> going to use</font>

307
00:14:44,620 --> 00:14:52,180
<font color="#CCCCCC">well-known tools like Hydra etc there</font><font color="#E5E5E5"> is</font>

308
00:14:47,510 --> 00:14:54,780
a detection now once we have<font color="#E5E5E5"> identified</font>

309
00:14:52,180 --> 00:14:57,300
<font color="#CCCCCC">let's say in this</font><font color="#E5E5E5"> case</font>

310
00:14:54,780 --> 00:15:00,120
let's make a quick assumption that we

311
00:14:57,300 --> 00:15:02,310
identified some boxes<font color="#E5E5E5"> fear we have a</font>

312
00:15:00,120 --> 00:15:04,320
<font color="#E5E5E5">domain admin token available there are</font>

313
00:15:02,310 --> 00:15:08,699
many<font color="#E5E5E5"> we are</font><font color="#CCCCCC"> a domain admin tokens</font>

314
00:15:04,320 --> 00:15:12,060
available<font color="#E5E5E5"> we just you know</font><font color="#CCCCCC"> let's dump</font>

315
00:15:08,700 --> 00:15:15,690
the credentials that is hashes ntlm

316
00:15:12,060 --> 00:15:17,670
hashes of<font color="#E5E5E5"> the domain admin that's what</font>

317
00:15:15,690 --> 00:15:18,690
<font color="#E5E5E5">credentials are you cannot extract them</font>

318
00:15:17,670 --> 00:15:21,449
in<font color="#E5E5E5"> clear text anymore</font>

319
00:15:18,690 --> 00:15:24,120
so if you have<font color="#E5E5E5"> access let's say</font><font color="#CCCCCC"> 2 to the</font>

320
00:15:21,450 --> 00:15:26,250
<font color="#CCCCCC">N tell em</font><font color="#E5E5E5"> - of a domain admin our next</font>

321
00:15:24,120 --> 00:15:29,550
step is letter movement we would like to

322
00:15:26,250 --> 00:15:31,590
<font color="#E5E5E5">use attacks like</font><font color="#CCCCCC"> overpass the hash to</font>

323
00:15:29,550 --> 00:15:36,120
use those credentials<font color="#E5E5E5"> to access other</font>

324
00:15:31,590 --> 00:15:38,490
resources<font color="#CCCCCC"> but right</font><font color="#E5E5E5"> so if you you</font><font color="#CCCCCC"> would</font>

325
00:15:36,120 --> 00:15:41,700
like to read about<font color="#E5E5E5"> torpasta hash more on</font>

326
00:15:38,490 --> 00:15:46,860
<font color="#E5E5E5">on Benjamin's</font><font color="#CCCCCC"> blog a</font><font color="#E5E5E5"> guy who wrote</font><font color="#CCCCCC"> mimic</font>

327
00:15:41,700 --> 00:15:49,310
<font color="#CCCCCC">ads so how is how</font><font color="#E5E5E5"> 8080 taxes so this is</font>

328
00:15:46,860 --> 00:15:52,830
the normal<font color="#E5E5E5"> traffic the</font><font color="#CCCCCC"> ACE request</font>

329
00:15:49,310 --> 00:15:57,660
packet when you have a look at the this

330
00:15:52,830 --> 00:16:02,100
packet there is a<font color="#E5E5E5"> specific field called</font>

331
00:15:57,660 --> 00:16:04,439
<font color="#E5E5E5">e type which which tells you the</font>

332
00:16:02,100 --> 00:16:08,370
<font color="#E5E5E5">encryption type being used you can see</font>

333
00:16:04,440 --> 00:16:10,920
here it is<font color="#CCCCCC"> a E - yes</font><font color="#E5E5E5"> 256 in case of</font>

334
00:16:08,370 --> 00:16:15,750
<font color="#CCCCCC">overpass Nahash attack if we are using</font>

335
00:16:10,920 --> 00:16:24,599
<font color="#CCCCCC">ntlm hashes this field is downgraded</font><font color="#E5E5E5"> to</font>

336
00:16:15,750 --> 00:16:31,550
<font color="#E5E5E5">our</font><font color="#CCCCCC"> core H</font><font color="#E5E5E5"> Mac md5 and that is what</font><font color="#CCCCCC"> 80</font>

337
00:16:24,600 --> 00:16:31,550
tells you if we can

338
00:16:33,660 --> 00:16:39,209
I<font color="#E5E5E5"> may be no longer in 1.8 but that</font>

339
00:16:37,350 --> 00:16:42,210
that's what it tells you if you would

340
00:16:39,210 --> 00:16:43,950
like<font color="#CCCCCC"> to</font><font color="#E5E5E5"> see in 1.7 at least the</font>

341
00:16:42,210 --> 00:16:46,470
encryption method of the encrypted

342
00:16:43,950 --> 00:16:49,680
<font color="#E5E5E5">timestamp field of the a stroke web</font>

343
00:16:46,470 --> 00:16:52,350
message has<font color="#CCCCCC"> been downgraded that's what</font>

344
00:16:49,680 --> 00:16:55,680
exactly it is complaining<font color="#E5E5E5"> about that you</font>

345
00:16:52,350 --> 00:16:58,920
have<font color="#CCCCCC"> downgraded this field there</font><font color="#E5E5E5"> is</font>

346
00:16:55,680 --> 00:17:00,540
another detection of it it says unusual

347
00:16:58,920 --> 00:17:03,959
protocol implementation I'm not sure

348
00:17:00,540 --> 00:17:07,349
what it looks for maybe these<font color="#E5E5E5"> types if</font>

349
00:17:03,960 --> 00:17:10,680
you see here these<font color="#E5E5E5"> may be the supported</font>

350
00:17:07,349 --> 00:17:16,829
e type<font color="#E5E5E5"> s-- okay can't see the pointer</font>

351
00:17:10,680 --> 00:17:18,810
sorry if<font color="#E5E5E5"> these types that's that's maybe</font>

352
00:17:16,829 --> 00:17:20,188
the second so one is encryption

353
00:17:18,810 --> 00:17:22,980
downgrade another one is unusual

354
00:17:20,189 --> 00:17:25,319
<font color="#E5E5E5">protocol implementation so probably this</font>

355
00:17:22,980 --> 00:17:28,040
is<font color="#E5E5E5"> the</font><font color="#CCCCCC"> second</font><font color="#E5E5E5"> part which it looks for so</font>

356
00:17:25,319 --> 00:17:34,139
how do you avoid detection in this case

357
00:17:28,040 --> 00:17:37,680
you simply use AES keys so from Java

358
00:17:34,140 --> 00:17:39,870
2008 onwards you can<font color="#CCCCCC"> use AES keys or</font>

359
00:17:37,680 --> 00:17:41,070
that is actually the default<font color="#E5E5E5"> if</font><font color="#CCCCCC"> you if</font>

360
00:17:39,870 --> 00:17:43,770
you go through<font color="#CCCCCC"> your long so you'll see</font>

361
00:17:41,070 --> 00:17:48,149
the encryption<font color="#E5E5E5"> type for Kerberos packets</font>

362
00:17:43,770 --> 00:17:51,300
to be<font color="#CCCCCC"> 0 +1 to that that means AES so</font>

363
00:17:48,150 --> 00:17:54,690
what we can do is in place of using

364
00:17:51,300 --> 00:17:56,250
<font color="#E5E5E5">simply invoke mimikatz</font><font color="#CCCCCC"> let's say we are</font>

365
00:17:54,690 --> 00:17:59,580
<font color="#E5E5E5">using the</font><font color="#CCCCCC"> powershell port of</font><font color="#E5E5E5"> maquettes</font>

366
00:17:56,250 --> 00:18:02,730
invoke mimikatz - command<font color="#E5E5E5"> in place of</font>

367
00:17:59,580 --> 00:18:06,899
just using slash ntlm we also<font color="#E5E5E5"> use slash</font>

368
00:18:02,730 --> 00:18:10,470
aes-256<font color="#E5E5E5"> slash aes-128 or just</font><font color="#CCCCCC"> lead to</font>

369
00:18:06,900 --> 00:18:13,920
<font color="#CCCCCC">five six keys if we use these keys</font><font color="#E5E5E5"> your</font>

370
00:18:10,470 --> 00:18:16,250
traffic<font color="#E5E5E5"> looks really normal and there</font>

371
00:18:13,920 --> 00:18:19,740
would be no detection<font color="#CCCCCC"> just keep in mind</font>

372
00:18:16,250 --> 00:18:21,810
<font color="#E5E5E5">that a</font><font color="#CCCCCC"> es key is according</font><font color="#E5E5E5"> to benjamine</font>

373
00:18:19,740 --> 00:18:25,530
and<font color="#E5E5E5"> I tested</font><font color="#CCCCCC"> it that's right</font><font color="#E5E5E5"> can be</font>

374
00:18:21,810 --> 00:18:30,570
replaced<font color="#E5E5E5"> only on either 8.1 2012</font><font color="#CCCCCC"> to our</font>

375
00:18:25,530 --> 00:18:34,290
<font color="#E5E5E5">two boxes or on</font><font color="#CCCCCC"> 7 2008 r2 8 2012 boxes</font>

376
00:18:30,570 --> 00:18:35,669
with this<font color="#E5E5E5"> KB applied of course in case</font>

377
00:18:34,290 --> 00:18:37,800
<font color="#E5E5E5">of an enterprise environment you will</font>

378
00:18:35,670 --> 00:18:43,220
find<font color="#E5E5E5"> this patch install almost all the</font>

379
00:18:37,800 --> 00:18:43,220
time<font color="#E5E5E5"> right so</font>

380
00:18:46,200 --> 00:18:55,470
let's say we have<font color="#E5E5E5"> this 2012 r2 box and</font>

381
00:18:51,720 --> 00:18:58,080
you can<font color="#E5E5E5"> see</font><font color="#CCCCCC"> that because we already</font><font color="#E5E5E5"> have</font>

382
00:18:55,470 --> 00:19:00,600
access<font color="#E5E5E5"> to the credentials that is keys</font>

383
00:18:58,080 --> 00:19:02,189
and hash of domain administrators which

384
00:19:00,600 --> 00:19:06,000
we<font color="#E5E5E5"> found out in the</font><font color="#CCCCCC"> domination</font><font color="#E5E5E5"> phase</font>

385
00:19:02,190 --> 00:19:08,850
<font color="#E5E5E5">what we are doing here everything else</font>

386
00:19:06,000 --> 00:19:13,520
is as<font color="#CCCCCC"> usual but in place</font><font color="#E5E5E5"> of slash ntlm</font>

387
00:19:08,850 --> 00:19:17,370
we are using slash aes-256<font color="#CCCCCC"> and did 256</font>

388
00:19:13,520 --> 00:19:26,240
bit key for the administrator<font color="#E5E5E5"> if</font><font color="#CCCCCC"> I run</font>

389
00:19:17,370 --> 00:19:26,239
this so great

390
00:19:29,400 --> 00:19:36,210
so this should ideally open up a new

391
00:19:31,830 --> 00:19:40,040
powershell a prompt<font color="#E5E5E5"> so let's try to do</font>

392
00:19:36,210 --> 00:19:40,040
<font color="#E5E5E5">that once again from a new session</font>

393
00:19:45,650 --> 00:19:48,309
so

394
00:19:50,790 --> 00:19:57,280
<font color="#CCCCCC">o.k so let's just copy this</font><font color="#E5E5E5"> and try it</font>

395
00:19:53,830 --> 00:20:05,260
from a new session<font color="#E5E5E5"> and hopefully it</font>

396
00:19:57,280 --> 00:20:08,850
works this time so<font color="#E5E5E5"> let's do load up the</font>

397
00:20:05,260 --> 00:20:08,850
<font color="#CCCCCC">McCanns and let's try it once again</font>

398
00:20:11,790 --> 00:20:17,590
because this new<font color="#E5E5E5"> partial process which</font>

399
00:20:14,770 --> 00:20:20,440
<font color="#CCCCCC">starts up</font><font color="#E5E5E5"> has the privileges of domain</font>

400
00:20:17,590 --> 00:20:22,870
admin<font color="#E5E5E5"> a very easy way to identify</font><font color="#CCCCCC"> that</font>

401
00:20:20,440 --> 00:20:26,110
should be something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> trying to</font>

402
00:20:22,870 --> 00:20:28,449
access the file system of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> domain</font>

403
00:20:26,110 --> 00:20:32,290
controller or run a partial remoting<font color="#CCCCCC"> or</font>

404
00:20:28,450 --> 00:20:40,390
WMI queries or<font color="#E5E5E5"> decom or whatever and</font>

405
00:20:32,290 --> 00:20:42,940
there would be no<font color="#E5E5E5"> detection right and</font>

406
00:20:40,390 --> 00:20:45,510
how does<font color="#E5E5E5"> that happen because you are</font>

407
00:20:42,940 --> 00:20:50,500
using a yes<font color="#CCCCCC"> keys the traffic traffic</font>

408
00:20:45,510 --> 00:20:53,140
looks really normal here<font color="#E5E5E5"> so that's our</font>

409
00:20:50,500 --> 00:20:56,470
pasta hash attack once you can move

410
00:20:53,140 --> 00:20:57,910
<font color="#CCCCCC">laterally without getting detected ok</font>

411
00:20:56,470 --> 00:21:01,960
<font color="#E5E5E5">another interesting thing is you can</font>

412
00:20:57,910 --> 00:21:04,300
actually<font color="#E5E5E5"> generate false</font><font color="#CCCCCC"> events if you</font>

413
00:21:01,960 --> 00:21:06,940
would like to<font color="#CCCCCC"> if we use a wrong username</font>

414
00:21:04,300 --> 00:21:09,879
<font color="#E5E5E5">in the in the command which we just saw</font>

415
00:21:06,940 --> 00:21:16,810
<font color="#CCCCCC">ETA in</font><font color="#E5E5E5"> 88 you can use things like see</font>

416
00:21:09,880 --> 00:21:20,110
things like this like<font color="#E5E5E5"> this you know of</font>

417
00:21:16,810 --> 00:21:21,790
failed or<font color="#E5E5E5"> overpass the hash attacks from</font>

418
00:21:20,110 --> 00:21:24,610
multiple users just in case you<font color="#E5E5E5"> would</font>

419
00:21:21,790 --> 00:21:25,960
like<font color="#E5E5E5"> to describe blue teamers or</font>

420
00:21:24,610 --> 00:21:28,780
anything<font color="#E5E5E5"> interesting you would like to</font>

421
00:21:25,960 --> 00:21:30,610
just play with<font color="#CCCCCC"> it now once we have</font><font color="#E5E5E5"> over</font>

422
00:21:28,780 --> 00:21:33,000
pass the hash capabilities

423
00:21:30,610 --> 00:21:35,979
next comes the domain domination part

424
00:21:33,000 --> 00:21:39,430
now for golden ticket<font color="#CCCCCC"> because we are</font>

425
00:21:35,980 --> 00:21:42,070
going<font color="#E5E5E5"> to create a TGT the field of</font>

426
00:21:39,430 --> 00:21:46,630
<font color="#E5E5E5">interest in the Kerberos packet for</font><font color="#CCCCCC"> ata</font>

427
00:21:42,070 --> 00:21:48,490
now is the tedious quest packet so of

428
00:21:46,630 --> 00:21:52,000
<font color="#CCCCCC">course you</font><font color="#E5E5E5"> can use read about golden</font>

429
00:21:48,490 --> 00:21:54,850
ticket more or more about it here so a

430
00:21:52,000 --> 00:21:59,110
normal tedious request<font color="#CCCCCC"> package looks</font>

431
00:21:54,850 --> 00:22:01,959
like this a yes<font color="#CCCCCC"> 2 5</font><font color="#E5E5E5"> 6 etc</font><font color="#CCCCCC"> in case we</font><font color="#E5E5E5"> are</font>

432
00:21:59,110 --> 00:22:03,000
using ntlm hash to create a golden

433
00:22:01,960 --> 00:22:06,750
<font color="#CCCCCC">decade</font>

434
00:22:03,000 --> 00:22:09,120
once<font color="#E5E5E5"> again there is a dumb grid here so</font>

435
00:22:06,750 --> 00:22:13,429
as<font color="#E5E5E5"> we have</font><font color="#CCCCCC"> learned</font><font color="#E5E5E5"> from overpass the</font>

436
00:22:09,120 --> 00:22:17,280
<font color="#CCCCCC">hatch attack</font><font color="#E5E5E5"> the natural thing to</font><font color="#CCCCCC"> do is</font>

437
00:22:13,429 --> 00:22:20,400
is<font color="#E5E5E5"> to use AES keys you can see here and</font>

438
00:22:17,280 --> 00:22:23,129
in<font color="#E5E5E5"> fact I think</font><font color="#CCCCCC"> in the case this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> not</font>

439
00:22:20,400 --> 00:22:25,620
readable<font color="#E5E5E5"> but it says the encryption</font>

440
00:22:23,130 --> 00:22:28,620
method of the<font color="#CCCCCC"> TD T field of the TGS</font>

441
00:22:25,620 --> 00:22:30,539
request message from two computers has

442
00:22:28,620 --> 00:22:33,449
been downgraded based on previously

443
00:22:30,539 --> 00:22:36,419
<font color="#E5E5E5">learned behavior so we simply do this</font>

444
00:22:33,450 --> 00:22:40,320
once<font color="#E5E5E5"> again in place of using just the</font>

445
00:22:36,419 --> 00:22:47,730
ntlm hash for creating a golden ticket

446
00:22:40,320 --> 00:22:51,000
<font color="#E5E5E5">we simply use AES keys right so in place</font>

447
00:22:47,730 --> 00:22:53,549
of<font color="#CCCCCC"> using</font><font color="#E5E5E5"> slash ntlm or slash I think it</font>

448
00:22:51,000 --> 00:22:56,070
accepts less<font color="#E5E5E5"> r /</font><font color="#CCCCCC"> r c for in case of</font>

449
00:22:53,549 --> 00:23:01,200
golden ticket<font color="#E5E5E5"> you can simply use slash</font>

450
00:22:56,070 --> 00:23:05,428
aes-256<font color="#CCCCCC"> of the copy TTT account and you</font>

451
00:23:01,200 --> 00:23:08,250
will<font color="#E5E5E5"> not be</font><font color="#CCCCCC"> detected now another very</font>

452
00:23:05,429 --> 00:23:11,760
interesting bypass<font color="#CCCCCC"> was some thing which</font>

453
00:23:08,250 --> 00:23:16,320
<font color="#CCCCCC">i always get asked at how do</font><font color="#E5E5E5"> we extract</font>

454
00:23:11,760 --> 00:23:18,450
<font color="#E5E5E5">the aes keys so of course we will see</font>

455
00:23:16,320 --> 00:23:21,450
<font color="#E5E5E5">your ways of doing that as well for</font>

456
00:23:18,450 --> 00:23:23,309
<font color="#CCCCCC">example running</font><font color="#E5E5E5"> DC sync attack but if</font>

457
00:23:21,450 --> 00:23:28,380
you run a DC sync attack it actually

458
00:23:23,309 --> 00:23:31,408
gets<font color="#E5E5E5"> detected like this a malicious</font>

459
00:23:28,380 --> 00:23:34,770
replication<font color="#E5E5E5"> of directory services so how</font>

460
00:23:31,409 --> 00:23:38,640
do<font color="#E5E5E5"> we avoid or how do we escape having</font>

461
00:23:34,770 --> 00:23:42,510
<font color="#E5E5E5">to extract</font><font color="#CCCCCC"> AES keys</font><font color="#E5E5E5"> we can simply use</font>

462
00:23:38,640 --> 00:23:47,190
something like<font color="#E5E5E5"> this use the ntlm hash</font>

463
00:23:42,510 --> 00:23:51,900
but in the user name<font color="#CCCCCC"> field use any</font>

464
00:23:47,190 --> 00:23:54,510
<font color="#E5E5E5">non-existent user and</font><font color="#CCCCCC"> ATF supposedly</font>

465
00:23:51,900 --> 00:23:58,470
<font color="#CCCCCC">because it maintains profiles of users</font>

466
00:23:54,510 --> 00:24:00,570
it cannot actually detect it and this<font color="#E5E5E5"> is</font>

467
00:23:58,470 --> 00:24:02,520
actually surprising when when I found

468
00:24:00,570 --> 00:24:04,350
found<font color="#E5E5E5"> this out before my black a talk or</font>

469
00:24:02,520 --> 00:24:08,250
<font color="#E5E5E5">a couple of months</font><font color="#CCCCCC"> ago I couldn't</font>

470
00:24:04,350 --> 00:24:10,590
believe I checked it<font color="#E5E5E5"> across with some</font><font color="#CCCCCC"> of</font>

471
00:24:08,250 --> 00:24:14,039
my<font color="#E5E5E5"> friends</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> is it actually</font><font color="#CCCCCC"> something</font>

472
00:24:10,590 --> 00:24:14,840
<font color="#E5E5E5">which is present or is it a</font><font color="#CCCCCC"> miss</font>

473
00:24:14,039 --> 00:24:17,060
configuration in

474
00:24:14,840 --> 00:24:23,600
<font color="#E5E5E5">labboard or I'm doing</font><font color="#CCCCCC"> something silly</font>

475
00:24:17,060 --> 00:24:26,300
but<font color="#CCCCCC"> know this this was up to now so this</font>

476
00:24:23,600 --> 00:24:36,740
means let's<font color="#E5E5E5"> see if I have a demo for</font>

477
00:24:26,300 --> 00:24:39,649
<font color="#E5E5E5">this I should have so we'll stick to</font>

478
00:24:36,740 --> 00:24:49,640
just looking at access<font color="#E5E5E5"> to the</font><font color="#CCCCCC"> filesystem</font>

479
00:24:39,650 --> 00:24:55,430
we cannot<font color="#E5E5E5"> access it right now if I use</font>

480
00:24:49,640 --> 00:25:02,300
this that is using the golden<font color="#E5E5E5"> ticket</font>

481
00:24:55,430 --> 00:25:05,210
but with<font color="#CCCCCC"> ok need to but with a</font>

482
00:25:02,300 --> 00:25:07,490
non-existent user that is<font color="#CCCCCC"> use</font><font color="#E5E5E5"> of it</font>

483
00:25:05,210 --> 00:25:09,760
which is<font color="#E5E5E5"> not there just</font><font color="#CCCCCC"> use any random</font>

484
00:25:07,490 --> 00:25:09,760
<font color="#E5E5E5">name</font>

485
00:25:16,730 --> 00:25:22,880
so of the ticket has<font color="#CCCCCC"> been injected</font><font color="#E5E5E5"> and</font>

486
00:25:19,430 --> 00:25:24,230
hopefully we<font color="#CCCCCC"> can access any service on</font>

487
00:25:22,880 --> 00:25:28,160
to the domain controller<font color="#CCCCCC"> that is we are</font>

488
00:25:24,230 --> 00:25:32,420
<font color="#E5E5E5">back to domain admins now this doesn't</font>

489
00:25:28,160 --> 00:25:34,010
get detected as well once again<font color="#E5E5E5"> I</font><font color="#CCCCCC"> worked</font>

490
00:25:32,420 --> 00:25:36,200
quite closely<font color="#E5E5E5"> with dat team they</font><font color="#CCCCCC"> are</font>

491
00:25:34,010 --> 00:25:40,520
fantastic guys I mean they<font color="#CCCCCC"> were</font><font color="#E5E5E5"> very</font>

492
00:25:36,200 --> 00:25:44,120
receptive<font color="#E5E5E5"> with all these bugs or</font>

493
00:25:40,520 --> 00:25:45,740
bypasses in the tool but I never got any

494
00:25:44,120 --> 00:25:47,929
clear answer about<font color="#E5E5E5"> that</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> mean they are</font>

495
00:25:45,740 --> 00:25:51,170
<font color="#E5E5E5">working on it that's what they told me</font>

496
00:25:47,930 --> 00:25:53,120
<font color="#CCCCCC">but why it is</font><font color="#E5E5E5"> not detected hopefully</font>

497
00:25:51,170 --> 00:25:55,070
<font color="#E5E5E5">because ATM maintains a profile of all</font>

498
00:25:53,120 --> 00:25:57,350
the users<font color="#CCCCCC"> and it cannot</font><font color="#E5E5E5"> find a profile</font>

499
00:25:55,070 --> 00:25:59,750
<font color="#E5E5E5">it cannot attribute it to a particular</font>

500
00:25:57,350 --> 00:26:06,740
<font color="#CCCCCC">user that could be the reason</font><font color="#E5E5E5"> but</font>

501
00:25:59,750 --> 00:26:09,860
<font color="#E5E5E5">nonetheless</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> very useful bypass now up</font>

502
00:26:06,740 --> 00:26:13,070
to 1.7<font color="#E5E5E5"> there was no check on ticket</font>

503
00:26:09,860 --> 00:26:15,050
lifetime 1.8 introduced checking<font color="#CCCCCC"> for</font>

504
00:26:13,070 --> 00:26:17,480
ticket lifetime that<font color="#E5E5E5"> is if you create</font><font color="#CCCCCC"> a</font>

505
00:26:15,050 --> 00:26:21,230
golden<font color="#CCCCCC"> ticket and that's</font><font color="#E5E5E5"> what most of us</font>

506
00:26:17,480 --> 00:26:23,270
do here we in place of<font color="#E5E5E5"> slash PTT</font><font color="#CCCCCC"> we use</font>

507
00:26:21,230 --> 00:26:25,250
something like slash ticket and save the

508
00:26:23,270 --> 00:26:27,470
ticket to a to a file

509
00:26:25,250 --> 00:26:29,930
keep that<font color="#E5E5E5"> file with us and maybe six</font>

510
00:26:27,470 --> 00:26:32,150
months<font color="#E5E5E5"> back might need six months</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> I</font>

511
00:26:29,930 --> 00:26:33,950
had if<font color="#CCCCCC"> we need the persistence we'll</font>

512
00:26:32,150 --> 00:26:37,070
just reuse<font color="#CCCCCC"> that ticket</font><font color="#E5E5E5"> right that's</font>

513
00:26:33,950 --> 00:26:39,170
that's<font color="#E5E5E5"> how many of us to saw or how many</font>

514
00:26:37,070 --> 00:26:41,030
<font color="#CCCCCC">of</font><font color="#E5E5E5"> you actually use the</font><font color="#CCCCCC"> slash ticket</font>

515
00:26:39,170 --> 00:26:42,280
option if you use mimikatz for creating

516
00:26:41,030 --> 00:26:44,899
a golden<font color="#E5E5E5"> ticket</font>

517
00:26:42,280 --> 00:26:48,710
no one<font color="#E5E5E5"> creates the ticket to the disk</font>

518
00:26:44,900 --> 00:26:54,020
really<font color="#CCCCCC"> ok so some some of you</font><font color="#E5E5E5"> and I</font>

519
00:26:48,710 --> 00:26:55,850
<font color="#E5E5E5">think more</font><font color="#CCCCCC"> of you but a white saving</font>

520
00:26:54,020 --> 00:26:58,160
ticket to this there are a couple of

521
00:26:55,850 --> 00:27:00,129
reasons for that<font color="#E5E5E5"> one you can see here</font>

522
00:26:58,160 --> 00:27:03,260
<font color="#E5E5E5">whenever you create a golden ticket</font>

523
00:27:00,130 --> 00:27:05,630
<font color="#CCCCCC">there is or any ticket for that matter</font>

524
00:27:03,260 --> 00:27:07,970
there<font color="#CCCCCC"> is a</font><font color="#E5E5E5"> lifetime which is associated</font>

525
00:27:05,630 --> 00:27:11,420
<font color="#E5E5E5">with that ticket</font><font color="#CCCCCC"> here you can see the</font>

526
00:27:07,970 --> 00:27:13,880
lifetime<font color="#E5E5E5"> that means if you create a</font>

527
00:27:11,420 --> 00:27:15,620
ticket<font color="#E5E5E5"> to and save it to the disk</font>

528
00:27:13,880 --> 00:27:19,460
<font color="#E5E5E5">exfiltrate the ticket so that</font><font color="#CCCCCC"> you can</font>

529
00:27:15,620 --> 00:27:23,989
commonly<font color="#E5E5E5"> come in later on and inject it</font>

530
00:27:19,460 --> 00:27:26,240
<font color="#E5E5E5">in those cases the ATA 1.8 onwards</font>

531
00:27:23,990 --> 00:27:27,800
<font color="#E5E5E5">checks for the lifetime of the ticket</font>

532
00:27:26,240 --> 00:27:29,720
<font color="#CCCCCC">what does that mean that means you will</font>

533
00:27:27,800 --> 00:27:33,200
get some detection

534
00:27:29,720 --> 00:27:35,360
that<font color="#CCCCCC"> our ticket was</font><font color="#E5E5E5"> used beyond the</font>

535
00:27:33,200 --> 00:27:37,790
<font color="#E5E5E5">stipulated</font><font color="#CCCCCC"> time that means it's an enemy</font>

536
00:27:35,360 --> 00:27:43,219
<font color="#CCCCCC">lease so here is an alert</font><font color="#E5E5E5"> that's how it</font>

537
00:27:37,790 --> 00:27:47,420
works<font color="#CCCCCC"> so this of course makes things</font>

538
00:27:43,220 --> 00:27:51,320
difficult sometimes<font color="#E5E5E5"> so this is how that</font>

539
00:27:47,420 --> 00:27:55,600
alot looks like here<font color="#E5E5E5"> it can tell you the</font>

540
00:27:51,320 --> 00:27:57,980
<font color="#E5E5E5">arse you have been using the same ticket</font>

541
00:27:55,600 --> 00:28:00,740
<font color="#CCCCCC">whereas the so that default ticket</font>

542
00:27:57,980 --> 00:28:02,120
<font color="#CCCCCC">lifetime is ten hours in a domain and it</font>

543
00:28:00,740 --> 00:28:05,030
depends on<font color="#E5E5E5"> your target configuration</font>

544
00:28:02,120 --> 00:28:07,040
that is generally not changed so<font color="#E5E5E5"> fury</font>

545
00:28:05,030 --> 00:28:10,340
creating a ticket<font color="#E5E5E5"> and using it again</font>

546
00:28:07,040 --> 00:28:16,159
<font color="#E5E5E5">like after</font><font color="#CCCCCC"> 10 hours then you can get</font>

547
00:28:10,340 --> 00:28:19,040
detected so to avoid such scenarios<font color="#E5E5E5"> the</font>

548
00:28:16,160 --> 00:28:20,750
best way is<font color="#CCCCCC"> to not</font><font color="#E5E5E5"> create a ticket</font><font color="#CCCCCC"> on to</font>

549
00:28:19,040 --> 00:28:22,430
the file<font color="#E5E5E5"> because</font><font color="#CCCCCC"> it's not the ticket</font>

550
00:28:20,750 --> 00:28:26,090
which provides<font color="#E5E5E5"> you persistence but it's</font>

551
00:28:22,430 --> 00:28:28,400
the static or not frequently changed

552
00:28:26,090 --> 00:28:32,270
<font color="#CCCCCC">kirby TGT hash no one really changes it</font>

553
00:28:28,400 --> 00:28:34,790
<font color="#E5E5E5">of maybe some of you but not all and all</font>

554
00:28:32,270 --> 00:28:36,860
<font color="#CCCCCC">the times so it's the copy T DT hash</font>

555
00:28:34,790 --> 00:28:39,560
which provides you persistence

556
00:28:36,860 --> 00:28:42,860
so just<font color="#E5E5E5"> exfiltrate or keep the hash with</font>

557
00:28:39,560 --> 00:28:45,080
you and do not<font color="#E5E5E5"> write</font><font color="#CCCCCC"> the ticket to the</font>

558
00:28:42,860 --> 00:28:47,479
<font color="#CCCCCC">dist</font><font color="#E5E5E5"> how does that help in that case you</font>

559
00:28:45,080 --> 00:28:49,010
can use options like this that is<font color="#E5E5E5"> you</font>

560
00:28:47,480 --> 00:28:51,560
create<font color="#E5E5E5"> the ticket and inject it right</font>

561
00:28:49,010 --> 00:28:54,640
<font color="#E5E5E5">away when you need to use it you</font><font color="#CCCCCC"> know</font>

562
00:28:51,560 --> 00:28:59,139
maybe<font color="#E5E5E5"> six months later year later or so</font>

563
00:28:54,640 --> 00:29:02,140
<font color="#E5E5E5">also</font><font color="#CCCCCC"> if you for some</font><font color="#E5E5E5"> reason cannot just</font>

564
00:28:59,140 --> 00:29:06,410
save yourself<font color="#CCCCCC"> from saving tickets to</font>

565
00:29:02,140 --> 00:29:08,240
<font color="#E5E5E5">disk mimikatz provides and other tools</font>

566
00:29:06,410 --> 00:29:11,290
<font color="#CCCCCC">or</font><font color="#E5E5E5"> some private tools which</font><font color="#CCCCCC"> also provide</font>

567
00:29:08,240 --> 00:29:14,840
the same functionality<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> actually</font>

568
00:29:11,290 --> 00:29:16,730
<font color="#E5E5E5">just make</font><font color="#CCCCCC"> our ticket with having a</font>

569
00:29:14,840 --> 00:29:19,490
<font color="#E5E5E5">lifetime in the future for example here</font>

570
00:29:16,730 --> 00:29:21,980
we<font color="#CCCCCC"> have a ticket which has a ticket</font>

571
00:29:19,490 --> 00:29:23,900
creation time set to<font color="#E5E5E5"> two hours and it</font>

572
00:29:21,980 --> 00:29:26,150
would two hours from<font color="#E5E5E5"> now</font><font color="#CCCCCC"> that is two R's</font>

573
00:29:23,900 --> 00:29:28,790
<font color="#E5E5E5">in future and would have a valid time of</font>

574
00:29:26,150 --> 00:29:31,070
one<font color="#E5E5E5"> R so if you use this within the</font>

575
00:29:28,790 --> 00:29:38,270
stipulated<font color="#E5E5E5"> time there would be no</font>

576
00:29:31,070 --> 00:29:40,730
detection right now let's see how we can

577
00:29:38,270 --> 00:29:43,100
attack<font color="#E5E5E5"> a</font><font color="#CCCCCC"> TI deployment now there are</font>

578
00:29:40,730 --> 00:29:45,110
multiple<font color="#CCCCCC"> deployment scenarios of a tea</font>

579
00:29:43,100 --> 00:29:46,969
it could be part<font color="#E5E5E5"> of</font><font color="#CCCCCC"> your current domain</font>

580
00:29:45,110 --> 00:29:49,309
it could be a<font color="#E5E5E5"> workgroup box that is a</font>

581
00:29:46,970 --> 00:29:52,789
separate box which is not part of a

582
00:29:49,309 --> 00:29:54,950
domain now in the<font color="#E5E5E5"> I don't</font><font color="#CCCCCC"> think I've</font>

583
00:29:52,789 --> 00:29:58,640
linked that<font color="#E5E5E5"> Google Doc or that</font><font color="#CCCCCC"> so that</font>

584
00:29:54,950 --> 00:30:01,880
doc<font color="#E5E5E5"> but the 88 dogs actually discuss</font>

585
00:29:58,640 --> 00:30:04,549
briefly the<font color="#CCCCCC"> deployment scenario you</font>

586
00:30:01,880 --> 00:30:07,580
should go for so according to them<font color="#E5E5E5"> and</font>

587
00:30:04,549 --> 00:30:10,429
which I totally agree to if you make<font color="#CCCCCC"> 88</font>

588
00:30:07,580 --> 00:30:12,860
console<font color="#E5E5E5"> part of the domain managing it</font>

589
00:30:10,429 --> 00:30:15,770
would be<font color="#E5E5E5"> really</font><font color="#CCCCCC"> easy you know pet</font><font color="#E5E5E5"> cycles</font>

590
00:30:12,860 --> 00:30:18,020
or basic sanitation checking whatever

591
00:30:15,770 --> 00:30:21,168
you can manage it using<font color="#CCCCCC"> your normal</font>

592
00:30:18,020 --> 00:30:24,350
<font color="#E5E5E5">domain but if the box is not part of the</font>

593
00:30:21,169 --> 00:30:27,500
domain<font color="#E5E5E5"> patches or other maintenance may</font>

594
00:30:24,350 --> 00:30:30,379
take a<font color="#E5E5E5"> bit</font><font color="#CCCCCC"> more effort</font><font color="#E5E5E5"> but here's the</font>

595
00:30:27,500 --> 00:30:31,789
catch<font color="#E5E5E5"> if you're a TA deployment is part</font>

596
00:30:30,380 --> 00:30:34,130
of the<font color="#CCCCCC"> domain and</font><font color="#E5E5E5"> a lumen gets</font>

597
00:30:31,789 --> 00:30:36,679
compromised for example in our case<font color="#E5E5E5"> we</font>

598
00:30:34,130 --> 00:30:39,710
already<font color="#E5E5E5"> have the domain admin access and</font>

599
00:30:36,679 --> 00:30:42,850
persistence and dominance<font color="#E5E5E5"> etc in such</font>

600
00:30:39,710 --> 00:30:45,169
cases it is possible<font color="#CCCCCC"> to attack a tee</font>

601
00:30:42,850 --> 00:30:46,340
console itself for interesting<font color="#CCCCCC"> things</font>

602
00:30:45,169 --> 00:30:49,309
<font color="#E5E5E5">and that doesn't mean that you always</font>

603
00:30:46,340 --> 00:30:52,639
<font color="#E5E5E5">need</font><font color="#CCCCCC"> to have domain admin privileges to</font>

604
00:30:49,309 --> 00:30:54,710
attack a<font color="#CCCCCC"> tee</font><font color="#E5E5E5"> console you must be of</font>

605
00:30:52,640 --> 00:30:56,840
course local<font color="#E5E5E5"> admin on that box that's</font>

606
00:30:54,710 --> 00:31:00,200
<font color="#E5E5E5">the basic</font><font color="#CCCCCC"> thing you need and please do</font>

607
00:30:56,840 --> 00:31:02,059
not<font color="#E5E5E5"> think that if it's admin it's game</font>

608
00:31:00,200 --> 00:31:04,309
over that's<font color="#E5E5E5"> what the theory which</font><font color="#CCCCCC"> ATS</font>

609
00:31:02,059 --> 00:31:08,899
subscribes to<font color="#E5E5E5"> any as we will see that</font>

610
00:31:04,309 --> 00:31:11,299
makes<font color="#E5E5E5"> things really disastrous so before</font>

611
00:31:08,900 --> 00:31:14,090
attacking<font color="#E5E5E5"> the deployment of course in we</font>

612
00:31:11,299 --> 00:31:15,470
need to identify<font color="#E5E5E5"> if there is an</font><font color="#CCCCCC"> ata</font>

613
00:31:14,090 --> 00:31:18,740
<font color="#E5E5E5">deployment in the environment there</font><font color="#CCCCCC"> are</font>

614
00:31:15,470 --> 00:31:21,440
some very<font color="#CCCCCC"> easy ways of doing that</font><font color="#E5E5E5"> up to</font>

615
00:31:18,740 --> 00:31:24,530
1.7 you could simply<font color="#E5E5E5"> point and it lets</font>

616
00:31:21,440 --> 00:31:27,650
<font color="#E5E5E5">it</font><font color="#CCCCCC"> let's say point</font><font color="#E5E5E5"> and map to all</font><font color="#CCCCCC"> the IP</font>

617
00:31:24,530 --> 00:31:29,418
<font color="#CCCCCC">addresses</font><font color="#E5E5E5"> now which listen on port 443</font>

618
00:31:27,650 --> 00:31:32,330
that's the default port where<font color="#E5E5E5"> a</font><font color="#CCCCCC"> TA</font>

619
00:31:29,419 --> 00:31:35,659
console this thing this this web console

620
00:31:32,330 --> 00:31:40,270
listens on port 443 by default<font color="#E5E5E5"> you just</font>

621
00:31:35,659 --> 00:31:43,429
<font color="#E5E5E5">0.82 443 do the basic panel crabbing</font><font color="#CCCCCC"> and</font>

622
00:31:40,270 --> 00:31:47,059
<font color="#CCCCCC">you can find out that if there is an 80</font>

623
00:31:43,429 --> 00:31:53,350
or<font color="#CCCCCC"> not but</font><font color="#E5E5E5"> from 1.8 onwards and ours is</font>

624
00:31:47,059 --> 00:31:56,700
and<font color="#CCCCCC"> one of</font><font color="#E5E5E5"> our</font><font color="#CCCCCC"> C's of 1.8 version</font><font color="#E5E5E5"> in 1.8</font>

625
00:31:53,350 --> 00:31:59,340
<font color="#E5E5E5">now there is a single</font><font color="#CCCCCC"> sign-on that</font>

626
00:31:56,700 --> 00:32:01,920
if you try to<font color="#CCCCCC"> access this without</font>

627
00:31:59,340 --> 00:32:05,010
providing any<font color="#E5E5E5"> credentials we cannot even</font>

628
00:32:01,920 --> 00:32:10,830
do basic<font color="#E5E5E5"> banner grabbing so in such</font>

629
00:32:05,010 --> 00:32:14,100
cases we<font color="#CCCCCC"> can use</font><font color="#E5E5E5"> a simple partial code</font>

630
00:32:10,830 --> 00:32:17,429
like this<font color="#E5E5E5"> if</font><font color="#CCCCCC"> we run this from a domain</font>

631
00:32:14,100 --> 00:32:19,379
joint box without any<font color="#E5E5E5"> privileges</font><font color="#CCCCCC"> you do</font>

632
00:32:17,430 --> 00:32:27,840
not need any special<font color="#E5E5E5"> privileges</font><font color="#CCCCCC"> if we</font>

633
00:32:19,380 --> 00:32:29,370
run this from<font color="#E5E5E5"> a domain joint box so it</font>

634
00:32:27,840 --> 00:32:32,340
<font color="#CCCCCC">returned</font><font color="#E5E5E5"> true and what we were checking</font>

635
00:32:29,370 --> 00:32:33,719
for<font color="#CCCCCC"> so for the quick demonstration we</font>

636
00:32:32,340 --> 00:32:35,189
already knew<font color="#E5E5E5"> the IP address otherwise</font>

637
00:32:33,720 --> 00:32:37,380
you may need to<font color="#E5E5E5"> run it on what if</font>

638
00:32:35,190 --> 00:32:41,880
multiple IP<font color="#CCCCCC"> addresses</font><font color="#E5E5E5"> so what we were</font>

639
00:32:37,380 --> 00:32:46,290
looking<font color="#CCCCCC"> for</font><font color="#E5E5E5"> if this</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> this web server</font>

640
00:32:41,880 --> 00:32:48,240
<font color="#E5E5E5">HTTP on this particular IP if</font><font color="#CCCCCC"> its</font><font color="#E5E5E5"> banner</font>

641
00:32:46,290 --> 00:32:50,940
contains Microsoft advanced threat

642
00:32:48,240 --> 00:32:53,040
analytics that's what we did<font color="#E5E5E5"> and well</font>

643
00:32:50,940 --> 00:32:56,820
that's<font color="#E5E5E5"> the IP 1.3 where we are running</font>

644
00:32:53,040 --> 00:32:59,580
running<font color="#CCCCCC"> it on so a very simple method to</font>

645
00:32:56,820 --> 00:33:01,110
do it<font color="#CCCCCC"> from from PowerShell because I do</font>

646
00:32:59,580 --> 00:33:03,720
a lot of work on PowerShell that's why I

647
00:33:01,110 --> 00:33:05,610
<font color="#E5E5E5">choose this otherwise this is this can</font>

648
00:33:03,720 --> 00:33:06,960
<font color="#CCCCCC">be done from pretty</font><font color="#E5E5E5"> much any scripting</font>

649
00:33:05,610 --> 00:33:11,189
language or programming language of<font color="#CCCCCC"> your</font>

650
00:33:06,960 --> 00:33:13,520
<font color="#E5E5E5">choice all right now so once we have</font>

651
00:33:11,190 --> 00:33:16,110
identified<font color="#CCCCCC"> it so that's one of the ways</font>

652
00:33:13,520 --> 00:33:18,600
now if we do not have<font color="#E5E5E5"> any domain join</font>

653
00:33:16,110 --> 00:33:21,209
<font color="#E5E5E5">machine a very simple well known method</font>

654
00:33:18,600 --> 00:33:24,990
<font color="#E5E5E5">could</font><font color="#CCCCCC"> be this simply point SSL scan to</font>

655
00:33:21,210 --> 00:33:29,400
it that is if you have a look<font color="#E5E5E5"> at the</font>

656
00:33:24,990 --> 00:33:34,470
<font color="#CCCCCC">certificate of</font><font color="#E5E5E5"> in fact in even in those</font>

657
00:33:29,400 --> 00:33:37,410
<font color="#E5E5E5">cases where where you do not have</font><font color="#CCCCCC"> so I</font>

658
00:33:34,470 --> 00:33:41,940
<font color="#CCCCCC">am NOT in a mood to go through these</font>

659
00:33:37,410 --> 00:33:46,140
certificate in<font color="#CCCCCC"> chrome so if you have a</font>

660
00:33:41,940 --> 00:33:48,420
look<font color="#E5E5E5"> at the certificate here you can</font>

661
00:33:46,140 --> 00:33:51,720
simply<font color="#CCCCCC"> see that</font><font color="#E5E5E5"> it has been issued to an</font>

662
00:33:48,420 --> 00:33:55,230
issued by a<font color="#E5E5E5"> TA</font><font color="#CCCCCC"> center I have not seen</font>

663
00:33:51,720 --> 00:33:56,760
<font color="#E5E5E5">many I'm not even not a single actually</font>

664
00:33:55,230 --> 00:33:59,580
<font color="#CCCCCC">no single installment</font><font color="#E5E5E5"> in an enterprise</font>

665
00:33:56,760 --> 00:34:01,500
<font color="#CCCCCC">it changes this an internal certificate</font>

666
00:33:59,580 --> 00:34:03,929
of self signed or certificates are used

667
00:34:01,500 --> 00:34:06,060
<font color="#E5E5E5">all the time</font><font color="#CCCCCC"> in enterprises</font><font color="#E5E5E5"> so this</font>

668
00:34:03,930 --> 00:34:09,840
simply allows<font color="#CCCCCC"> us to enumerate</font><font color="#E5E5E5"> if there</font>

669
00:34:06,060 --> 00:34:13,080
is any<font color="#E5E5E5"> 80 a deployment in</font>

670
00:34:09,840 --> 00:34:15,180
the target environment<font color="#E5E5E5"> now there are</font>

671
00:34:13,080 --> 00:34:18,000
some<font color="#E5E5E5"> more</font><font color="#CCCCCC"> interesting</font><font color="#E5E5E5"> things about the</font>

672
00:34:15,179 --> 00:34:21,270
8080 deployment<font color="#E5E5E5"> all the local</font>

673
00:34:18,000 --> 00:34:24,889
administrators on the<font color="#E5E5E5"> ATS</font><font color="#CCCCCC"> Center</font><font color="#E5E5E5"> have</font>

674
00:34:21,270 --> 00:34:27,570
administrative access<font color="#E5E5E5"> to the console</font>

675
00:34:24,889 --> 00:34:29,790
<font color="#CCCCCC">that means you can simply if you</font><font color="#E5E5E5"> have</font>

676
00:34:27,570 --> 00:34:31,110
local administrator access<font color="#E5E5E5"> who by</font>

677
00:34:29,790 --> 00:34:33,659
default would have local administrator

678
00:34:31,110 --> 00:34:37,140
access<font color="#E5E5E5"> all the members of the local</font>

679
00:34:33,659 --> 00:34:39,330
administrators group<font color="#E5E5E5"> the the local users</font>

680
00:34:37,139 --> 00:34:41,940
<font color="#E5E5E5">the domain provision a privileged users</font>

681
00:34:39,330 --> 00:34:44,580
that means that in our scenario<font color="#E5E5E5"> when we</font>

682
00:34:41,940 --> 00:34:46,470
already<font color="#CCCCCC"> have high privileges</font><font color="#E5E5E5"> or if we</font>

683
00:34:44,580 --> 00:34:48,600
somehow have local I mean privileges on

684
00:34:46,469 --> 00:34:52,350
this<font color="#E5E5E5"> box we can do some</font><font color="#CCCCCC"> interesting</font>

685
00:34:48,600 --> 00:34:55,860
stuff<font color="#E5E5E5"> by going to this part we can</font><font color="#CCCCCC"> add</font>

686
00:34:52,350 --> 00:35:00,450
exclusions for example for IP addresses

687
00:34:55,860 --> 00:35:02,670
for users for specific attacks<font color="#CCCCCC"> we can</font>

688
00:35:00,450 --> 00:35:05,339
see the domain controllers fear this is

689
00:35:02,670 --> 00:35:07,050
configured and other things which makes

690
00:35:05,340 --> 00:35:11,280
sense<font color="#E5E5E5"> right if</font><font color="#CCCCCC"> you have access to the</font>

691
00:35:07,050 --> 00:35:14,220
web console but the problem with this<font color="#E5E5E5"> a</font>

692
00:35:11,280 --> 00:35:16,410
bit of problem<font color="#E5E5E5"> with this thing is if an</font>

693
00:35:14,220 --> 00:35:18,180
<font color="#CCCCCC">ata administrator comes here and looks</font>

694
00:35:16,410 --> 00:35:19,799
at this<font color="#E5E5E5"> this would be really visible</font>

695
00:35:18,180 --> 00:35:22,529
<font color="#E5E5E5">right that there are some exclusions for</font>

696
00:35:19,800 --> 00:35:26,400
<font color="#E5E5E5">a specific IP address or user that may</font>

697
00:35:22,530 --> 00:35:28,710
<font color="#E5E5E5">actually give you away so for such cases</font>

698
00:35:26,400 --> 00:35:31,590
we may like to<font color="#E5E5E5"> interact</font><font color="#CCCCCC"> with the</font>

699
00:35:28,710 --> 00:35:34,920
<font color="#CCCCCC">back-end directory</font><font color="#E5E5E5"> now the</font><font color="#CCCCCC"> backend used</font>

700
00:35:31,590 --> 00:35:38,520
by<font color="#CCCCCC"> ata</font><font color="#E5E5E5"> is a MongoDB server which listens</font>

701
00:35:34,920 --> 00:35:41,100
just on the<font color="#CCCCCC"> localhost but does not need</font>

702
00:35:38,520 --> 00:35:44,370
any password to interact with so I'm

703
00:35:41,100 --> 00:35:45,960
still<font color="#E5E5E5"> have to come to terms with this</font>

704
00:35:44,370 --> 00:35:47,850
idea of<font color="#E5E5E5"> not</font><font color="#CCCCCC"> having a local</font>

705
00:35:45,960 --> 00:35:50,550
authentication<font color="#E5E5E5"> any sort of</font>

706
00:35:47,850 --> 00:35:52,529
authentication on the back end<font color="#CCCCCC"> but</font>

707
00:35:50,550 --> 00:35:54,870
that's how it<font color="#CCCCCC"> is right now</font>

708
00:35:52,530 --> 00:35:57,360
that means you can<font color="#CCCCCC"> actually</font><font color="#E5E5E5"> interact</font>

709
00:35:54,870 --> 00:36:04,170
<font color="#CCCCCC">with different interesting collections</font>

710
00:35:57,360 --> 00:36:06,930
<font color="#CCCCCC">over there which looks like this so this</font>

711
00:36:04,170 --> 00:36:09,000
is<font color="#E5E5E5"> the ATA</font><font color="#CCCCCC"> back-end</font><font color="#E5E5E5"> you can see there</font>

712
00:36:06,930 --> 00:36:10,950
are some<font color="#E5E5E5"> interesting collections</font>

713
00:36:09,000 --> 00:36:13,260
suspicious activity system profile

714
00:36:10,950 --> 00:36:17,819
unique<font color="#CCCCCC"> entity</font><font color="#E5E5E5"> so unique entity is the</font>

715
00:36:13,260 --> 00:36:21,150
<font color="#E5E5E5">collection which has a profiles of all</font>

716
00:36:17,820 --> 00:36:23,390
the users<font color="#E5E5E5"> and machines and entities</font><font color="#CCCCCC"> in</font>

717
00:36:21,150 --> 00:36:24,950
the with the<font color="#E5E5E5"> ATA</font>

718
00:36:23,390 --> 00:36:27,379
and then suspicious activity as the name

719
00:36:24,950 --> 00:36:29,538
suggests is the<font color="#E5E5E5"> collection which lists</font>

720
00:36:27,380 --> 00:36:34,940
all<font color="#E5E5E5"> the suspicious activities now what</font>

721
00:36:29,539 --> 00:36:39,019
can we<font color="#CCCCCC"> do with this</font><font color="#E5E5E5"> so many things first</font>

722
00:36:34,940 --> 00:36:41,980
is let's say<font color="#E5E5E5"> we have we would like</font><font color="#CCCCCC"> to</font>

723
00:36:39,019 --> 00:36:45,288
change<font color="#E5E5E5"> attribution in case of an attack</font>

724
00:36:41,980 --> 00:36:47,269
<font color="#E5E5E5">so I think I have one</font><font color="#CCCCCC"> here so here we</font>

725
00:36:45,289 --> 00:36:49,760
can see in<font color="#CCCCCC"> reckon using SMB session</font><font color="#E5E5E5"> you</font>

726
00:36:47,269 --> 00:36:59,240
<font color="#E5E5E5">enumeration using this user called</font>

727
00:36:49,760 --> 00:37:06,980
<font color="#CCCCCC">billed admin so this is the unique ID if</font>

728
00:36:59,240 --> 00:37:08,479
<font color="#E5E5E5">you go there and change the okay so</font>

729
00:37:06,980 --> 00:37:11,720
that's that's the one which is<font color="#E5E5E5"> open we</font>

730
00:37:08,480 --> 00:37:15,400
<font color="#CCCCCC">can confirm this with this</font><font color="#E5E5E5"> it's an</font><font color="#CCCCCC"> image</font>

731
00:37:11,720 --> 00:37:19,910
session<font color="#E5E5E5"> suspicion</font><font color="#CCCCCC"> a suspicious activity</font>

732
00:37:15,400 --> 00:37:23,990
<font color="#E5E5E5">and field responsible for the</font>

733
00:37:19,910 --> 00:37:28,279
identification of user is<font color="#CCCCCC"> it's this</font>

734
00:37:23,990 --> 00:37:30,348
source account ID<font color="#E5E5E5"> so</font><font color="#CCCCCC"> that's this is</font>

735
00:37:28,279 --> 00:37:33,650
<font color="#E5E5E5">something which identifies that user in</font>

736
00:37:30,349 --> 00:37:36,740
<font color="#CCCCCC">that in</font><font color="#E5E5E5"> in 88 this is</font><font color="#CCCCCC"> the build admin</font>

737
00:37:33,650 --> 00:37:41,380
user so how we<font color="#CCCCCC"> can do this we go to</font><font color="#E5E5E5"> the</font>

738
00:37:36,740 --> 00:37:43,848
unique identity<font color="#E5E5E5"> look for let's say a</font>

739
00:37:41,380 --> 00:37:45,980
particular<font color="#E5E5E5"> user let's lab user or</font>

740
00:37:43,849 --> 00:37:47,569
whatever user you want<font color="#CCCCCC"> to</font><font color="#E5E5E5"> so we can</font>

741
00:37:45,980 --> 00:37:49,549
<font color="#CCCCCC">simply</font><font color="#E5E5E5"> assume</font><font color="#CCCCCC"> that because you</font><font color="#E5E5E5"> are here</font>

742
00:37:47,569 --> 00:37:53,230
you know<font color="#CCCCCC"> at least Diggs basic</font>

743
00:37:49,549 --> 00:37:57,619
information about the<font color="#CCCCCC"> environment so we</font>

744
00:37:53,230 --> 00:38:03,049
go<font color="#E5E5E5"> here copy this ID that's the unique</font>

745
00:37:57,619 --> 00:38:06,769
ID for<font color="#E5E5E5"> this user we'll go back here edit</font>

746
00:38:03,049 --> 00:38:12,109
<font color="#CCCCCC">the document and change the source</font>

747
00:38:06,769 --> 00:38:18,299
account ID<font color="#CCCCCC"> you need</font><font color="#E5E5E5"> to change it at all</font>

748
00:38:12,109 --> 00:38:20,910
the places<font color="#CCCCCC"> actually so change it here</font>

749
00:38:18,300 --> 00:38:24,240
so I'm actually working on a tool I

750
00:38:20,910 --> 00:38:26,100
couldn't I wanted to complete it<font color="#E5E5E5"> to</font>

751
00:38:24,240 --> 00:38:29,040
present at 44<font color="#CCCCCC"> con I'm</font><font color="#E5E5E5"> working on a tool</font>

752
00:38:26,100 --> 00:38:31,740
which automates this so you need<font color="#E5E5E5"> not do</font>

753
00:38:29,040 --> 00:38:38,940
it<font color="#CCCCCC"> for each and every one of the</font>

754
00:38:31,740 --> 00:38:44,339
activity here so let's replace all<font color="#CCCCCC"> of</font>

755
00:38:38,940 --> 00:38:47,010
these do we<font color="#CCCCCC"> have a couple more</font><font color="#E5E5E5"> so</font>

756
00:38:44,340 --> 00:38:49,020
replace so we are<font color="#CCCCCC"> replacing the ID of</font>

757
00:38:47,010 --> 00:38:51,360
the<font color="#CCCCCC"> Bildad min here with another</font><font color="#E5E5E5"> user</font>

758
00:38:49,020 --> 00:38:53,520
called lab user or whatever user of your

759
00:38:51,360 --> 00:39:02,010
choice<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> simply</font><font color="#CCCCCC"> use idea for let's</font>

760
00:38:53,520 --> 00:39:06,000
say<font color="#E5E5E5"> a D or any other user so okay let's</font>

761
00:39:02,010 --> 00:39:08,310
do this so many of them let's try to do

762
00:39:06,000 --> 00:39:14,660
the<font color="#CCCCCC"> to it do it without</font><font color="#E5E5E5"> changing it for</font>

763
00:39:08,310 --> 00:39:21,390
all of<font color="#CCCCCC"> them save it and if we reload</font>

764
00:39:14,660 --> 00:39:23,100
this right now<font color="#E5E5E5"> so it has</font><font color="#CCCCCC"> changed for</font>

765
00:39:21,390 --> 00:39:27,420
some of the<font color="#E5E5E5"> activities you can see that</font>

766
00:39:23,100 --> 00:39:30,450
from a build admin it now says lab user

767
00:39:27,420 --> 00:39:34,410
as well<font color="#CCCCCC"> and if we quickly change it for</font>

768
00:39:30,450 --> 00:39:40,980
all so let's do<font color="#CCCCCC"> that</font><font color="#E5E5E5"> so that it</font><font color="#CCCCCC"> is it</font>

769
00:39:34,410 --> 00:39:46,790
looks much more better if you quickly do

770
00:39:40,980 --> 00:39:46,790
it<font color="#E5E5E5"> for all these</font><font color="#CCCCCC"> protections</font><font color="#E5E5E5"> here</font>

771
00:39:55,609 --> 00:40:07,670
replace replace<font color="#E5E5E5"> tears</font><font color="#CCCCCC"> I mean that's not</font>

772
00:40:02,239 --> 00:40:17,170
very<font color="#E5E5E5"> looks good to do to manually do</font>

773
00:40:07,670 --> 00:40:24,140
this but<font color="#E5E5E5"> okay let's replace this okay</font>

774
00:40:17,170 --> 00:40:25,940
<font color="#E5E5E5">please we have more my god okay so I'm</font>

775
00:40:24,140 --> 00:40:28,368
not<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to spend so much time</font><font color="#CCCCCC"> on this</font>

776
00:40:25,940 --> 00:40:33,950
let's see if we<font color="#CCCCCC"> can't see changes over</font>

777
00:40:28,369 --> 00:40:39,890
here still<font color="#E5E5E5"> it's not in this list</font><font color="#CCCCCC"> let's</font>

778
00:40:33,950 --> 00:40:42,618
keep it try<font color="#E5E5E5"> it for another one so here</font>

779
00:40:39,890 --> 00:40:44,930
you<font color="#E5E5E5"> can see that if we okay one thing</font>

780
00:40:42,619 --> 00:40:48,640
<font color="#CCCCCC">which I forgot to</font><font color="#E5E5E5"> mention here is if you</font>

781
00:40:44,930 --> 00:40:53,149
<font color="#CCCCCC">are not going</font><font color="#E5E5E5"> to polish the ticket from</font>

782
00:40:48,640 --> 00:40:55,759
this<font color="#E5E5E5"> our session when</font><font color="#CCCCCC"> we use the we</font>

783
00:40:53,150 --> 00:40:57,279
created the golden ticket<font color="#E5E5E5"> if you</font><font color="#CCCCCC"> are not</font>

784
00:40:55,759 --> 00:40:59,420
<font color="#E5E5E5">going to purge the tickets from here</font>

785
00:40:57,279 --> 00:41:03,400
there would be<font color="#E5E5E5"> direction like</font><font color="#CCCCCC"> this so</font>

786
00:40:59,420 --> 00:41:06,400
use<font color="#CCCCCC"> it and see straight away project</font>

787
00:41:03,400 --> 00:41:06,400
<font color="#E5E5E5">okay</font>

788
00:41:09,650 --> 00:41:12,650
so

789
00:41:12,990 --> 00:41:17,450
let's try<font color="#E5E5E5"> for this activity</font>

790
00:41:25,590 --> 00:41:30,480
and let's see<font color="#CCCCCC"> if we have</font><font color="#E5E5E5"> the source</font>

791
00:41:27,900 --> 00:41:34,160
account ID here<font color="#E5E5E5"> there is a source</font>

792
00:41:30,480 --> 00:41:37,550
account ID so<font color="#CCCCCC"> we</font><font color="#E5E5E5"> just need one</font><font color="#CCCCCC"> for</font>

793
00:41:34,160 --> 00:41:37,549
another user

794
00:41:46,220 --> 00:42:02,700
and change the source<font color="#E5E5E5"> account ID right</font>

795
00:41:55,290 --> 00:42:06,029
I'll save and if you fetch it<font color="#CCCCCC"> now it</font>

796
00:42:02,700 --> 00:42:08,370
says it is from lab user<font color="#E5E5E5"> so of course I</font>

797
00:42:06,030 --> 00:42:09,750
mean<font color="#E5E5E5"> this makes sense if you</font><font color="#CCCCCC"> are going</font>

798
00:42:08,370 --> 00:42:11,640
<font color="#E5E5E5">to make</font><font color="#CCCCCC"> changes in</font><font color="#E5E5E5"> the back and the</font>

799
00:42:09,750 --> 00:42:15,690
<font color="#E5E5E5">front end will show the exact same thing</font>

800
00:42:11,640 --> 00:42:17,970
<font color="#E5E5E5">the point is being a</font><font color="#CCCCCC"> tool specifically</font>

801
00:42:15,690 --> 00:42:19,620
<font color="#E5E5E5">for</font><font color="#CCCCCC"> our most focus on the</font><font color="#E5E5E5"> little</font>

802
00:42:17,970 --> 00:42:22,080
movement attacks there is<font color="#E5E5E5"> no log or any</font>

803
00:42:19,620 --> 00:42:24,150
trace<font color="#CCCCCC"> of this</font><font color="#E5E5E5"> activity anywhere and this</font>

804
00:42:22,080 --> 00:42:26,840
is actually one of the difficult<font color="#CCCCCC"> things</font>

805
00:42:24,150 --> 00:42:28,640
to<font color="#E5E5E5"> do you can simply do something like</font>

806
00:42:26,840 --> 00:42:31,160
<font color="#CCCCCC">this</font><font color="#E5E5E5"> as well</font>

807
00:42:28,640 --> 00:42:34,920
so let's say we do not<font color="#E5E5E5"> want</font><font color="#CCCCCC"> this</font>

808
00:42:31,160 --> 00:42:37,859
<font color="#CCCCCC">Kerberos</font><font color="#E5E5E5"> golden activity</font><font color="#CCCCCC"> a lot to be</font>

809
00:42:34,920 --> 00:42:39,630
seen<font color="#CCCCCC"> we</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> simply try this</font><font color="#E5E5E5"> so of course</font>

810
00:42:37,860 --> 00:42:42,630
you need not have access<font color="#E5E5E5"> to the console</font>

811
00:42:39,630 --> 00:42:47,010
all the<font color="#E5E5E5"> time I'm using these IDs so that</font>

812
00:42:42,630 --> 00:42:49,890
it's quick<font color="#E5E5E5"> to demonstrate so if we look</font>

813
00:42:47,010 --> 00:42:54,420
for this particular<font color="#CCCCCC"> activity if you run</font>

814
00:42:49,890 --> 00:42:58,980
it<font color="#E5E5E5"> like</font><font color="#CCCCCC"> this you</font><font color="#E5E5E5"> can get sorry</font><font color="#CCCCCC"> if we run</font>

815
00:42:54,420 --> 00:43:00,840
it like<font color="#E5E5E5"> this we can get</font><font color="#CCCCCC"> a list</font><font color="#E5E5E5"> of all</font>

816
00:42:58,980 --> 00:43:03,480
<font color="#E5E5E5">the</font><font color="#CCCCCC"> activities and</font><font color="#E5E5E5"> the lead it's in a</font>

817
00:43:00,840 --> 00:43:10,830
chronological<font color="#E5E5E5"> order so you can</font><font color="#CCCCCC"> see the</font>

818
00:43:03,480 --> 00:43:12,720
<font color="#CCCCCC">latest activity</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> but in case you</font>

819
00:43:10,830 --> 00:43:15,930
would<font color="#E5E5E5"> like to go after</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> specific</font>

820
00:43:12,720 --> 00:43:21,509
<font color="#E5E5E5">activity or</font><font color="#CCCCCC"> an SRE a specific alert</font>

821
00:43:15,930 --> 00:43:23,190
<font color="#CCCCCC">let's see it</font><font color="#E5E5E5"> go to add it and in place</font>

822
00:43:21,510 --> 00:43:25,830
of<font color="#CCCCCC"> doing</font><font color="#E5E5E5"> anything else we can simply</font>

823
00:43:23,190 --> 00:43:29,840
here is<font color="#CCCCCC"> a</font><font color="#E5E5E5"> property called is visible we</font>

824
00:43:25,830 --> 00:43:29,840
can simply set<font color="#CCCCCC"> it to false</font>

825
00:43:32,610 --> 00:43:39,020
save it<font color="#E5E5E5"> and if we go to the console</font><font color="#CCCCCC"> now</font>

826
00:43:41,720 --> 00:43:48,209
<font color="#E5E5E5">it's not visible</font><font color="#CCCCCC"> and once again</font><font color="#E5E5E5"> there is</font>

827
00:43:44,910 --> 00:43:50,759
<font color="#CCCCCC">no</font><font color="#E5E5E5"> trace no logs of anyone doing</font><font color="#CCCCCC"> this</font>

828
00:43:48,210 --> 00:43:52,920
<font color="#E5E5E5">activity so that is gone and it wouldn't</font>

829
00:43:50,760 --> 00:43:55,560
<font color="#E5E5E5">it you cannot retrieve it from the</font>

830
00:43:52,920 --> 00:43:57,900
<font color="#E5E5E5">console</font><font color="#CCCCCC"> right now</font><font color="#E5E5E5"> what someone needs to</font>

831
00:43:55,560 --> 00:44:01,410
<font color="#E5E5E5">do is to go</font><font color="#CCCCCC"> back here look</font><font color="#E5E5E5"> for the</font>

832
00:43:57,900 --> 00:44:03,720
activities and set its visibility<font color="#CCCCCC"> to</font>

833
00:44:01,410 --> 00:44:05,850
back to true<font color="#CCCCCC"> now there are so many other</font>

834
00:44:03,720 --> 00:44:07,189
things<font color="#E5E5E5"> you can do for</font><font color="#CCCCCC"> example what I was</font>

835
00:44:05,850 --> 00:44:09,270
trying<font color="#CCCCCC"> to do and</font><font color="#E5E5E5"> couldn't complete</font>

836
00:44:07,190 --> 00:44:11,780
because it does not need<font color="#E5E5E5"> any</font>

837
00:44:09,270 --> 00:44:15,120
authentication<font color="#CCCCCC"> you can we</font><font color="#E5E5E5"> can simply</font>

838
00:44:11,780 --> 00:44:17,310
leave our reverse port<font color="#E5E5E5"> forwarding proxy</font>

839
00:44:15,120 --> 00:44:19,920
if we have access<font color="#CCCCCC"> of port forwarding on</font>

840
00:44:17,310 --> 00:44:22,410
this box so<font color="#CCCCCC"> that this is forwarded to</font>

841
00:44:19,920 --> 00:44:26,310
one of our<font color="#E5E5E5"> boxes somewhere and we can</font>

842
00:44:22,410 --> 00:44:29,009
<font color="#E5E5E5">interact with the MongoDB now from a</font>

843
00:44:26,310 --> 00:44:33,720
remote session<font color="#E5E5E5"> or remotely then you can</font>

844
00:44:29,010 --> 00:44:35,700
of course<font color="#E5E5E5"> inject your own profiles need</font>

845
00:44:33,720 --> 00:44:38,430
to just have a look at<font color="#E5E5E5"> couple of unique</font>

846
00:44:35,700 --> 00:44:44,970
things<font color="#CCCCCC"> it takes</font><font color="#E5E5E5"> a time to build so I</font>

847
00:44:38,430 --> 00:44:50,629
cannot demonstrate that so<font color="#CCCCCC"> they have</font>

848
00:44:44,970 --> 00:44:50,629
seen I think this and<font color="#E5E5E5"> this as well so</font>

849
00:44:51,800 --> 00:44:56,610
<font color="#E5E5E5">what is the defense against the evasions</font>

850
00:44:54,390 --> 00:44:58,470
which we have saw we have seen of<font color="#CCCCCC"> course</font>

851
00:44:56,610 --> 00:45:00,510
<font color="#CCCCCC">the well-known</font><font color="#E5E5E5"> Active Directory</font>

852
00:44:58,470 --> 00:45:03,299
mitigations like limiting your domain

853
00:45:00,510 --> 00:45:07,010
admins logins or<font color="#E5E5E5"> architectural changes</font>

854
00:45:03,300 --> 00:45:10,560
suppose proposed here<font color="#E5E5E5"> can be used to</font>

855
00:45:07,010 --> 00:45:15,030
avoid the attacks<font color="#E5E5E5"> not specifically</font><font color="#CCCCCC"> 80</font>

856
00:45:10,560 --> 00:45:19,680
<font color="#E5E5E5">evasions how you can define</font><font color="#CCCCCC"> your 80</font>

857
00:45:15,030 --> 00:45:22,290
installation is make<font color="#CCCCCC"> a think over it if</font>

858
00:45:19,680 --> 00:45:24,810
you would like<font color="#E5E5E5"> to make it part</font><font color="#CCCCCC"> of your</font>

859
00:45:22,290 --> 00:45:27,240
<font color="#E5E5E5">domain or not if it is part of the</font>

860
00:45:24,810 --> 00:45:30,750
domain<font color="#E5E5E5"> please keep in</font><font color="#CCCCCC"> mind</font><font color="#E5E5E5"> that it would</font>

861
00:45:27,240 --> 00:45:33,209
be easier<font color="#CCCCCC"> to attack the not only through</font>

862
00:45:30,750 --> 00:45:37,290
to find it<font color="#E5E5E5"> out but also to attack it for</font>

863
00:45:33,210 --> 00:45:39,120
example<font color="#CCCCCC"> 88</font><font color="#E5E5E5"> in some installations</font><font color="#CCCCCC"> there</font>

864
00:45:37,290 --> 00:45:41,850
<font color="#E5E5E5">are specific groups called</font><font color="#CCCCCC"> ATI</font>

865
00:45:39,120 --> 00:45:42,990
administrators<font color="#CCCCCC"> 88 users Microsoft</font>

866
00:45:41,850 --> 00:45:45,630
<font color="#E5E5E5">suggests these</font>

867
00:45:42,990 --> 00:45:47,640
to be just<font color="#CCCCCC"> role-based groups that he</font>

868
00:45:45,630 --> 00:45:49,590
that his<font color="#CCCCCC"> ata administrators are let's</font>

869
00:45:47,640 --> 00:45:51,839
say the local<font color="#E5E5E5"> administrators but in some</font>

870
00:45:49,590 --> 00:45:55,170
installations I have seen actual groups

871
00:45:51,840 --> 00:45:57,240
like<font color="#CCCCCC"> ATI administrators</font><font color="#E5E5E5"> ata users so you</font>

872
00:45:55,170 --> 00:45:59,430
can that<font color="#E5E5E5"> means the normal group</font>

873
00:45:57,240 --> 00:46:02,879
enumeration can also give away<font color="#E5E5E5"> the</font>

874
00:45:59,430 --> 00:46:05,368
location<font color="#E5E5E5"> or that there is an</font><font color="#CCCCCC"> ata</font>

875
00:46:02,880 --> 00:46:07,950
deployment<font color="#E5E5E5"> so not making it part of a</font>

876
00:46:05,369 --> 00:46:09,510
domain could be<font color="#E5E5E5"> good disease and as far</font>

877
00:46:07,950 --> 00:46:12,109
<font color="#CCCCCC">as at least security of the deployment</font>

878
00:46:09,510 --> 00:46:14,610
itself is concerned

879
00:46:12,110 --> 00:46:17,100
hopefully password for<font color="#CCCCCC"> back-end</font><font color="#E5E5E5"> DB would</font>

880
00:46:14,610 --> 00:46:18,780
be installed<font color="#CCCCCC"> of course you can let's say</font>

881
00:46:17,100 --> 00:46:22,470
if you have<font color="#CCCCCC"> administrative access</font><font color="#E5E5E5"> you</font>

882
00:46:18,780 --> 00:46:25,670
can<font color="#E5E5E5"> just</font><font color="#CCCCCC"> go no exfiltrate the whole</font>

883
00:46:22,470 --> 00:46:28,799
<font color="#E5E5E5">database</font><font color="#CCCCCC"> but that at least</font><font color="#E5E5E5"> includes or</font>

884
00:46:25,670 --> 00:46:31,560
<font color="#E5E5E5">put some cost on an attacker not having</font>

885
00:46:28,800 --> 00:46:34,410
any password just<font color="#E5E5E5"> makes it</font><font color="#CCCCCC"> very easier</font>

886
00:46:31,560 --> 00:46:37,799
for for any attacker to to tamper with

887
00:46:34,410 --> 00:46:40,529
<font color="#E5E5E5">the alerts and</font><font color="#CCCCCC"> of course some way of</font>

888
00:46:37,800 --> 00:46:42,690
logs<font color="#E5E5E5"> when if someone is tampering into</font>

889
00:46:40,530 --> 00:46:45,119
the database<font color="#E5E5E5"> or tampering with the</font>

890
00:46:42,690 --> 00:46:47,760
activities in the database some<font color="#E5E5E5"> logs or</font>

891
00:46:45,119 --> 00:46:49,710
additional<font color="#E5E5E5"> alerts possibly if not alerts</font>

892
00:46:47,760 --> 00:46:52,350
because it's in the same database<font color="#CCCCCC"> at</font>

893
00:46:49,710 --> 00:46:56,220
least some logs<font color="#CCCCCC"> into that Windows Event</font>

894
00:46:52,350 --> 00:46:59,069
log<font color="#E5E5E5"> right so that should also help now</font>

895
00:46:56,220 --> 00:47:01,470
there are some<font color="#E5E5E5"> limitations</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> ata if you</font>

896
00:46:59,070 --> 00:47:05,250
go to this<font color="#E5E5E5"> documentation there are only</font>

897
00:47:01,470 --> 00:47:07,740
certain protocols which<font color="#CCCCCC"> 88 attacks reads</font>

898
00:47:05,250 --> 00:47:09,660
and detects<font color="#E5E5E5"> alerts from them there are</font>

899
00:47:07,740 --> 00:47:12,839
<font color="#CCCCCC">attacks</font><font color="#E5E5E5"> like let's say constrained</font>

900
00:47:09,660 --> 00:47:14,580
delegation attacks or there was a very

901
00:47:12,840 --> 00:47:16,650
popular attack couple of months back

902
00:47:14,580 --> 00:47:18,930
<font color="#CCCCCC">where you abuse the membership</font><font color="#E5E5E5"> of DNS</font>

903
00:47:16,650 --> 00:47:23,940
admins group<font color="#E5E5E5"> these are not detected by</font>

904
00:47:18,930 --> 00:47:26,009
ata why because ata needs<font color="#E5E5E5"> a normal</font>

905
00:47:23,940 --> 00:47:28,350
traffic and an<font color="#E5E5E5"> anomaly for to detect</font>

906
00:47:26,010 --> 00:47:30,780
<font color="#E5E5E5">those things if it does not know what an</font>

907
00:47:28,350 --> 00:47:32,730
enemy is if they it lacks<font color="#E5E5E5"> let's say</font>

908
00:47:30,780 --> 00:47:38,160
signature of an attack<font color="#CCCCCC"> that cannot</font>

909
00:47:32,730 --> 00:47:40,140
detect it yep and that's that's<font color="#E5E5E5"> the</font>

910
00:47:38,160 --> 00:47:41,720
<font color="#CCCCCC">thing I was</font><font color="#E5E5E5"> talking about constrained</font>

911
00:47:40,140 --> 00:47:47,580
<font color="#CCCCCC">delia let's say constrained delegation</font>

912
00:47:41,720 --> 00:47:49,290
or<font color="#E5E5E5"> DNS admins attack now other than</font>

913
00:47:47,580 --> 00:47:50,970
bypass there are some avoidance

914
00:47:49,290 --> 00:47:54,480
techniques as well tickets like silver

915
00:47:50,970 --> 00:47:56,330
attack or Kerberos which either need<font color="#E5E5E5"> no</font>

916
00:47:54,480 --> 00:47:57,860
communication with<font color="#E5E5E5"> the domain controller</font>

917
00:47:56,330 --> 00:48:00,080
need minimum communication with the

918
00:47:57,860 --> 00:48:01,880
domain controller<font color="#E5E5E5"> are also not</font><font color="#CCCCCC"> detected</font>

919
00:48:00,080 --> 00:48:04,819
of course if you are<font color="#E5E5E5"> not talking to</font><font color="#CCCCCC"> the</font>

920
00:48:01,880 --> 00:48:11,120
<font color="#E5E5E5">DC</font><font color="#CCCCCC"> ATA cannot read the traffic</font><font color="#E5E5E5"> and there</font>

921
00:48:04,820 --> 00:48:16,670
would be no detection<font color="#E5E5E5"> now how is the red</font>

922
00:48:11,120 --> 00:48:21,250
<font color="#E5E5E5">teamer how can</font><font color="#CCCCCC"> I detect a avoid ata</font>

923
00:48:16,670 --> 00:48:24,440
<font color="#E5E5E5">forever so for that</font>

924
00:48:21,250 --> 00:48:28,970
try not to escalate to domain admin

925
00:48:24,440 --> 00:48:31,160
privileges just so<font color="#E5E5E5"> that you can brag</font>

926
00:48:28,970 --> 00:48:32,870
about<font color="#E5E5E5"> it in your report</font><font color="#CCCCCC"> you know we</font>

927
00:48:31,160 --> 00:48:34,460
escalated<font color="#CCCCCC"> to domain admins and you it</font>

928
00:48:32,870 --> 00:48:37,279
was possible<font color="#CCCCCC"> for</font><font color="#E5E5E5"> us</font><font color="#CCCCCC"> to access all the</font>

929
00:48:34,460 --> 00:48:40,220
boxes<font color="#E5E5E5"> I mean who doesn't like to write</font>

930
00:48:37,280 --> 00:48:42,680
that in the report but avoid<font color="#E5E5E5"> that if you</font>

931
00:48:40,220 --> 00:48:44,600
can if your goal<font color="#CCCCCC"> is to go for a specific</font>

932
00:48:42,680 --> 00:48:48,049
<font color="#E5E5E5">box or any specific</font><font color="#CCCCCC"> piece of</font><font color="#E5E5E5"> information</font>

933
00:48:44,600 --> 00:48:50,420
which should<font color="#E5E5E5"> be actually then just do</font>

934
00:48:48,050 --> 00:48:54,590
<font color="#E5E5E5">not go after the domain admin as</font><font color="#CCCCCC"> the</font>

935
00:48:50,420 --> 00:48:56,960
very<font color="#E5E5E5"> first thing also now</font><font color="#CCCCCC"> ABA allows you</font>

936
00:48:54,590 --> 00:49:01,880
to create honey tokens<font color="#CCCCCC"> that is you</font>

937
00:48:56,960 --> 00:49:05,570
<font color="#E5E5E5">create a let's say a</font><font color="#CCCCCC"> rogue domain admin</font>

938
00:49:01,880 --> 00:49:15,050
and specify that<font color="#CCCCCC"> here in the</font><font color="#E5E5E5"> ATA</font>

939
00:49:05,570 --> 00:49:17,120
configuration<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> here in the honey</font>

940
00:49:15,050 --> 00:49:19,550
token accounts you specify the<font color="#E5E5E5"> said of</font>

941
00:49:17,120 --> 00:49:22,220
<font color="#E5E5E5">that account</font><font color="#CCCCCC"> and as soon as</font><font color="#E5E5E5"> that account</font>

942
00:49:19,550 --> 00:49:25,220
<font color="#E5E5E5">that particular account</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> used even for</font>

943
00:49:22,220 --> 00:49:27,560
<font color="#CCCCCC">normal thing or even if just someone</font>

944
00:49:25,220 --> 00:49:31,759
uses<font color="#E5E5E5"> its ticket there would be alert</font>

945
00:49:27,560 --> 00:49:34,790
here so avoid unnecessarily going after

946
00:49:31,760 --> 00:49:36,470
<font color="#E5E5E5">da now before going for the lowest</font>

947
00:49:34,790 --> 00:49:38,390
hanging fruit which all of us<font color="#CCCCCC"> have been</font>

948
00:49:36,470 --> 00:49:41,120
taught just<font color="#E5E5E5"> think for a moment</font><font color="#CCCCCC"> is it</font>

949
00:49:38,390 --> 00:49:44,210
really the<font color="#CCCCCC"> lowest hanging fruit or is it</font>

950
00:49:41,120 --> 00:49:47,210
<font color="#E5E5E5">a</font><font color="#CCCCCC"> sister honey token which you can of</font>

951
00:49:44,210 --> 00:49:48,980
course enumerate from for example<font color="#CCCCCC"> let's</font>

952
00:49:47,210 --> 00:49:54,650
say looking at<font color="#E5E5E5"> the last</font><font color="#CCCCCC"> logon time of</font>

953
00:49:48,980 --> 00:49:58,130
the user and similar attributes yep

954
00:49:54,650 --> 00:50:00,770
that's that's about the evasion part

955
00:49:58,130 --> 00:50:03,670
just<font color="#E5E5E5"> the stay focused on on the goal of</font>

956
00:50:00,770 --> 00:50:06,380
of<font color="#E5E5E5"> your assessment do not unnecessarily</font>

957
00:50:03,670 --> 00:50:08,930
<font color="#CCCCCC">do</font><font color="#E5E5E5"> try to do cool things like golden</font>

958
00:50:06,380 --> 00:50:09,460
ticket or skeleton key if not required<font color="#CCCCCC"> I</font>

959
00:50:08,930 --> 00:50:11,830
mean

960
00:50:09,460 --> 00:50:13,359
who would need a golden ticket<font color="#E5E5E5"> in</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> red</font>

961
00:50:11,830 --> 00:50:16,660
<font color="#E5E5E5">team assessment of one month</font><font color="#CCCCCC"> I don't</font>

962
00:50:13,359 --> 00:50:19,720
<font color="#CCCCCC">think anyone would and if you're using</font>

963
00:50:16,660 --> 00:50:21,730
it be ready for detection<font color="#E5E5E5"> now</font>

964
00:50:19,720 --> 00:50:24,520
limitations of the research of<font color="#E5E5E5"> course</font>

965
00:50:21,730 --> 00:50:27,880
all the<font color="#E5E5E5"> bypasses or things which we</font><font color="#CCCCCC"> have</font>

966
00:50:24,520 --> 00:50:30,400
seen there in the bypasses<font color="#CCCCCC"> we</font><font color="#E5E5E5"> focused</font>

967
00:50:27,880 --> 00:50:32,530
<font color="#E5E5E5">only in the anomaly based detection</font><font color="#CCCCCC"> so</font>

968
00:50:30,400 --> 00:50:34,359
no behavior based detection<font color="#CCCCCC"> so while</font>

969
00:50:32,530 --> 00:50:37,510
interacting with<font color="#E5E5E5"> the 88 team they are</font>

970
00:50:34,359 --> 00:50:39,730
<font color="#E5E5E5">many for many times they tell told me</font>

971
00:50:37,510 --> 00:50:41,830
the same<font color="#E5E5E5"> thing</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> for example even if</font>

972
00:50:39,730 --> 00:50:44,650
<font color="#E5E5E5">you can bypass overpass the hatch</font>

973
00:50:41,830 --> 00:50:47,020
detection<font color="#E5E5E5"> if you access</font><font color="#CCCCCC"> a new resource</font>

974
00:50:44,650 --> 00:50:50,440
using that or behavior based detection

975
00:50:47,020 --> 00:50:53,589
will catch you<font color="#CCCCCC"> I mean could be</font><font color="#E5E5E5"> I've</font>

976
00:50:50,440 --> 00:50:55,650
never tried<font color="#CCCCCC"> that in my labs I have never</font>

977
00:50:53,589 --> 00:50:58,390
seen a<font color="#E5E5E5"> single</font><font color="#CCCCCC"> behavioral-based</font>

978
00:50:55,650 --> 00:51:01,089
alert from now the<font color="#E5E5E5"> 80 installation has</font>

979
00:50:58,390 --> 00:51:03,430
been<font color="#E5E5E5"> running for past 11 months so could</font>

980
00:51:01,089 --> 00:51:07,390
be true in in<font color="#CCCCCC"> real world environments</font>

981
00:51:03,430 --> 00:51:09,490
but not in my lab at<font color="#CCCCCC"> least for attacking</font>

982
00:51:07,390 --> 00:51:12,759
88 deployment we need local<font color="#E5E5E5"> admin</font>

983
00:51:09,490 --> 00:51:13,959
privileges that's what we<font color="#CCCCCC"> assumed</font><font color="#E5E5E5"> and</font>

984
00:51:12,760 --> 00:51:15,609
that's a requirement<font color="#E5E5E5"> I mean that's a</font>

985
00:51:13,960 --> 00:51:21,730
limitation is basically that<font color="#E5E5E5"> we assume</font>

986
00:51:15,609 --> 00:51:26,290
that<font color="#E5E5E5"> we have that and so we can say that</font>

987
00:51:21,730 --> 00:51:30,190
to conclude with is a weekend<font color="#E5E5E5"> of course</font>

988
00:51:26,290 --> 00:51:32,589
bypass<font color="#E5E5E5"> ata as we saw here but it still</font>

989
00:51:30,190 --> 00:51:35,109
<font color="#CCCCCC">provides it not specifically</font><font color="#E5E5E5"> to 80 and</font>

990
00:51:32,589 --> 00:51:38,049
<font color="#E5E5E5">the some of the bypasses which we saw</font>

991
00:51:35,109 --> 00:51:40,089
here are not<font color="#E5E5E5"> very</font><font color="#CCCCCC"> specific</font><font color="#E5E5E5"> to ata many</font>

992
00:51:38,050 --> 00:51:41,830
<font color="#CCCCCC">active directory detection tools look</font>

993
00:51:40,089 --> 00:51:43,810
for the exact<font color="#E5E5E5"> same thing of course I</font>

994
00:51:41,830 --> 00:51:47,890
cannot name them right now<font color="#E5E5E5"> but look</font><font color="#CCCCCC"> for</font>

995
00:51:43,810 --> 00:51:52,029
the exact<font color="#CCCCCC"> same thing if you use attacks</font>

996
00:51:47,890 --> 00:51:54,368
carefully like this you may bypass<font color="#CCCCCC"> many</font>

997
00:51:52,030 --> 00:51:57,310
of them<font color="#E5E5E5"> and modification of attack</font>

998
00:51:54,369 --> 00:51:59,260
methodologies and the<font color="#CCCCCC"> work</font><font color="#E5E5E5"> culture</font><font color="#CCCCCC"> of</font>

999
00:51:57,310 --> 00:52:02,589
<font color="#CCCCCC">Pratt teams may go a long way you</font><font color="#E5E5E5"> know</font>

1000
00:51:59,260 --> 00:52:04,599
just<font color="#E5E5E5"> to see how it cool cool it is to</font>

1001
00:52:02,589 --> 00:52:07,210
<font color="#E5E5E5">mention skeleton key golden ticket or</font>

1002
00:52:04,599 --> 00:52:10,450
other<font color="#E5E5E5"> headline attacks in in your report</font>

1003
00:52:07,210 --> 00:52:13,270
just<font color="#CCCCCC"> to survive that</font><font color="#E5E5E5"> I mean that's</font><font color="#CCCCCC"> no</font>

1004
00:52:10,450 --> 00:52:17,910
<font color="#E5E5E5">fantastic if we can avoid that</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> only</font>

1005
00:52:13,270 --> 00:52:21,009
saves us time but<font color="#CCCCCC"> deduction as</font><font color="#E5E5E5"> well so</font>

1006
00:52:17,910 --> 00:52:22,080
<font color="#E5E5E5">yeah that should be it from</font><font color="#CCCCCC"> me if there</font>

1007
00:52:21,010 --> 00:52:24,710
<font color="#E5E5E5">are</font><font color="#CCCCCC"> any questions</font><font color="#E5E5E5"> have</font><font color="#CCCCCC"> we</font>

1008
00:52:22,080 --> 00:52:24,710
like to take them

1009
00:52:28,560 --> 00:52:47,930
[Music]

