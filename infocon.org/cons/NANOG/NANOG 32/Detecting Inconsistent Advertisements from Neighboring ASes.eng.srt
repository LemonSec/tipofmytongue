1
00:00:01,129 --> 00:00:06,298
<font color="#CCCCCC">Thanks thanks</font><font color="#E5E5E5"> for the great intro Greg</font>

2
00:00:04,100 --> 00:00:09,178
so this being an election year we've

3
00:00:06,299 --> 00:00:11,309
heard a lot about inconsistencies but

4
00:00:09,179 --> 00:00:14,160
I'm going<font color="#E5E5E5"> to talk about inconsistent</font>

5
00:00:11,309 --> 00:00:15,419
advertisements in neighboring a esas did

6
00:00:14,160 --> 00:00:16,859
how to detect inconsistent

7
00:00:15,420 --> 00:00:19,109
advertisements from neighboring a esas

8
00:00:16,859 --> 00:00:22,020
and our experience looking at these

9
00:00:19,109 --> 00:00:23,939
things<font color="#E5E5E5"> from inside the AT&T network this</font>

10
00:00:22,020 --> 00:00:25,380
is joint work with Morley mouth from

11
00:00:23,939 --> 00:00:30,119
University<font color="#E5E5E5"> of Michigan and Jennifer</font>

12
00:00:25,380 --> 00:00:32,129
<font color="#CCCCCC">rexford from AT&T</font><font color="#E5E5E5"> okay so of course</font>

13
00:00:30,119 --> 00:00:35,399
almost<font color="#CCCCCC"> all of you've seen things</font><font color="#E5E5E5"> like</font>

14
00:00:32,130 --> 00:00:37,469
this this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> just an excerpt from a</font>

15
00:00:35,399 --> 00:00:40,079
settlement free peering agreement

16
00:00:37,469 --> 00:00:41,790
contract that<font color="#CCCCCC"> I</font><font color="#E5E5E5"> just happen to find on</font>

17
00:00:40,079 --> 00:00:45,570
the<font color="#E5E5E5"> web some people actually</font><font color="#CCCCCC"> do put</font>

18
00:00:41,790 --> 00:00:47,789
these things on the web so something

19
00:00:45,570 --> 00:00:49,230
that turns up in<font color="#E5E5E5"> these policies the</font>

20
00:00:47,789 --> 00:00:52,230
settlement for you peering arrangements

21
00:00:49,230 --> 00:00:54,660
wait frequently is that<font color="#CCCCCC"> you know the</font>

22
00:00:52,230 --> 00:00:56,459
neighboring<font color="#CCCCCC"> a s is supposed to announce</font>

23
00:00:54,660 --> 00:00:59,489
consistent customer routes at all inter

24
00:00:56,460 --> 00:01:01,829
connection points so what that<font color="#E5E5E5"> means in</font>

25
00:00:59,489 --> 00:01:03,510
simpler terms is that if you're

26
00:01:01,829 --> 00:01:05,430
appearing with some<font color="#E5E5E5"> is like you you</font>

27
00:01:03,510 --> 00:01:08,460
should expect them to advertise<font color="#CCCCCC"> bgp</font>

28
00:01:05,430 --> 00:01:10,140
routes at all peering points and the

29
00:01:08,460 --> 00:01:13,048
<font color="#CCCCCC">routes that</font><font color="#E5E5E5"> they advertise so you should</font>

30
00:01:10,140 --> 00:01:16,290
have equal a s path length and equal med

31
00:01:13,049 --> 00:01:20,880
values so why<font color="#E5E5E5"> is this important well</font>

32
00:01:16,290 --> 00:01:23,729
again you know why it's important if na

33
00:01:20,880 --> 00:01:25,949
s does<font color="#E5E5E5"> this then it allows allows you to</font>

34
00:01:23,729 --> 00:01:28,049
do hot potato routing you can show your

35
00:01:25,950 --> 00:01:29,640
traffic off on the closest<font color="#CCCCCC"> peering</font>

36
00:01:28,049 --> 00:01:33,259
points<font color="#E5E5E5"> or actually wherever appearing</font>

37
00:01:29,640 --> 00:01:35,460
point you choose if on the other<font color="#CCCCCC"> hand</font>

38
00:01:33,259 --> 00:01:36,990
neighboring s does not advertise these

39
00:01:35,460 --> 00:01:40,079
consistent routes as<font color="#E5E5E5"> I've shown on the</font>

40
00:01:36,990 --> 00:01:41,220
on the right side<font color="#E5E5E5"> of this graph then it</font>

41
00:01:40,079 --> 00:01:43,919
makes it a little tougher to<font color="#E5E5E5"> do hot</font>

42
00:01:41,220 --> 00:01:46,890
potato routing for example if a s1 sent

43
00:01:43,920 --> 00:01:48,600
a route on that pairing session on the

44
00:01:46,890 --> 00:01:51,390
right with a longer a s path length for

45
00:01:48,600 --> 00:01:53,669
example well then s2 is going to have a

46
00:01:51,390 --> 00:01:55,649
little harder time actually implementing

47
00:01:53,670 --> 00:01:58,469
hot potato routing actually restricts

48
00:01:55,649 --> 00:02:00,479
the flexibility that you have in your

49
00:01:58,469 --> 00:02:01,710
policy in setting exit points ok so

50
00:02:00,479 --> 00:02:05,399
we're we're concerned and trying to

51
00:02:01,710 --> 00:02:09,389
<font color="#CCCCCC">actually figure out why these types of</font>

52
00:02:05,399 --> 00:02:11,730
inconsistencies happen when they do how

53
00:02:09,389 --> 00:02:12,799
can<font color="#CCCCCC"> we actually detect them from inside</font>

54
00:02:11,730 --> 00:02:14,480
our own<font color="#CCCCCC"> a s</font>

55
00:02:12,800 --> 00:02:16,130
and then once we've actually figured<font color="#E5E5E5"> out</font>

56
00:02:14,480 --> 00:02:18,079
how to do<font color="#CCCCCC"> that in some practical fashion</font>

57
00:02:16,130 --> 00:02:19,130
let's<font color="#CCCCCC"> try</font><font color="#E5E5E5"> to figure out how often this</font>

58
00:02:18,080 --> 00:02:22,340
type of thing is happening<font color="#E5E5E5"> is this</font>

59
00:02:19,130 --> 00:02:23,780
something<font color="#CCCCCC"> we should</font><font color="#E5E5E5"> be worried about so</font>

60
00:02:22,340 --> 00:02:25,760
first let's<font color="#E5E5E5"> get to the question of why</font>

61
00:02:23,780 --> 00:02:28,520
these inconsistent advertisements happen

62
00:02:25,760 --> 00:02:29,720
well the first<font color="#CCCCCC"> one is obvious right your</font>

63
00:02:28,520 --> 00:02:34,550
peer<font color="#CCCCCC"> may be actually</font><font color="#E5E5E5"> just trying to</font>

64
00:02:29,720 --> 00:02:36,140
cheat you that's simple enough but the

65
00:02:34,550 --> 00:02:37,760
pier may not be sending inconsistent

66
00:02:36,140 --> 00:02:39,950
routes intentionally there are a number

67
00:02:37,760 --> 00:02:42,609
of reasons why you might expect<font color="#E5E5E5"> to see</font>

68
00:02:39,950 --> 00:02:44,420
these inconsistent advertisements

69
00:02:42,610 --> 00:02:45,980
several<font color="#E5E5E5"> of which involve miss</font>

70
00:02:44,420 --> 00:02:47,119
configuration and I'll go<font color="#E5E5E5"> into detail on</font>

71
00:02:45,980 --> 00:02:49,730
these and<font color="#CCCCCC"> they're in the coming slides</font>

72
00:02:47,120 --> 00:02:51,860
and others sort of have to do with<font color="#E5E5E5"> some</font>

73
00:02:49,730 --> 00:02:55,280
fundamental limitations with regard to

74
00:02:51,860 --> 00:02:57,350
the interaction between<font color="#CCCCCC"> the BGP decision</font>

75
00:02:55,280 --> 00:03:01,190
process and how people implement

76
00:02:57,350 --> 00:03:03,859
business contracts<font color="#E5E5E5"> okay so let's first</font>

77
00:03:01,190 --> 00:03:05,120
talk about the<font color="#CCCCCC"> sort</font><font color="#E5E5E5"> of simplest miss</font>

78
00:03:03,860 --> 00:03:06,590
configuration that could that could

79
00:03:05,120 --> 00:03:07,910
cause this type of inconsistent

80
00:03:06,590 --> 00:03:10,970
advertisement you're probably way ahead

81
00:03:07,910 --> 00:03:12,760
of<font color="#E5E5E5"> me already on this you know if a s 1</font>

82
00:03:10,970 --> 00:03:15,800
2 3 here that I've shown on the<font color="#CCCCCC"> bottom</font>

83
00:03:12,760 --> 00:03:18,829
you<font color="#CCCCCC"> know has different export policies</font>

84
00:03:15,800 --> 00:03:20,390
to its neighbor well of course<font color="#CCCCCC"> the</font>

85
00:03:18,830 --> 00:03:22,910
potential exists for these inconsistent

86
00:03:20,390 --> 00:03:25,640
advertisements to happen I've sort of

87
00:03:22,910 --> 00:03:27,890
given you just<font color="#CCCCCC"> little snippets of cisco</font>

88
00:03:25,640 --> 00:03:32,230
iOS here just to illustrate the point

89
00:03:27,890 --> 00:03:35,269
that you lookin at lookin at these

90
00:03:32,230 --> 00:03:37,130
configuration fragments to immediately

91
00:03:35,270 --> 00:03:38,810
detect the inconsistency isn't always

92
00:03:37,130 --> 00:03:41,030
obvious right you know both<font color="#CCCCCC"> of these</font>

93
00:03:38,810 --> 00:03:43,700
routers may have configurations that say

94
00:03:41,030 --> 00:03:47,660
hey to this appear use the route map

95
00:03:43,700 --> 00:03:48,709
called<font color="#CCCCCC"> pier I mean you make so this</font>

96
00:03:47,660 --> 00:03:52,670
would look there's a type of here that

97
00:03:48,709 --> 00:03:54,560
should be<font color="#CCCCCC"> actually even I mess it up the</font>

98
00:03:52,670 --> 00:03:57,619
you know the route map may say route map

99
00:03:54,560 --> 00:04:00,230
pier set prepend whatever and then and

100
00:03:57,620 --> 00:04:02,090
the rap map on the on the other router

101
00:04:00,230 --> 00:04:04,250
may have the<font color="#CCCCCC"> same name for that</font><font color="#E5E5E5"> route</font>

102
00:04:02,090 --> 00:04:07,220
map but actually do different things so

103
00:04:04,250 --> 00:04:08,930
these types of<font color="#CCCCCC"> things may you know if</font>

104
00:04:07,220 --> 00:04:10,820
<font color="#E5E5E5">this is a simplest possible case right</font>

105
00:04:08,930 --> 00:04:12,290
but even even these types of things<font color="#E5E5E5"> may</font>

106
00:04:10,820 --> 00:04:13,459
in some<font color="#CCCCCC"> cases be hard to eyeball and</font>

107
00:04:12,290 --> 00:04:16,548
actually immediately figure out that

108
00:04:13,459 --> 00:04:19,190
you've got a<font color="#E5E5E5"> problem like this so I'm</font>

109
00:04:16,548 --> 00:04:20,418
<font color="#E5E5E5">just going to take this moment to plug a</font>

110
00:04:19,190 --> 00:04:22,760
tool that<font color="#CCCCCC"> I talked about</font><font color="#E5E5E5"> it the last</font>

111
00:04:20,418 --> 00:04:25,099
channel that I call our CC which is the

112
00:04:22,760 --> 00:04:26,360
router config checker and you can run

113
00:04:25,100 --> 00:04:28,909
this over your configurations

114
00:04:26,360 --> 00:04:31,460
detect this type of inconsistent export

115
00:04:28,909 --> 00:04:33,560
policies quite easily so<font color="#CCCCCC"> there's a URL</font>

116
00:04:31,460 --> 00:04:35,719
you can go check<font color="#CCCCCC"> it out please</font><font color="#E5E5E5"> send me a</font>

117
00:04:33,560 --> 00:04:38,300
mail if you're interested<font color="#CCCCCC"> in using it</font>

118
00:04:35,719 --> 00:04:39,949
and helping me<font color="#E5E5E5"> with it</font><font color="#CCCCCC"> okay so that's</font>

119
00:04:38,300 --> 00:04:41,090
the sort of easiest mr. configuration

120
00:04:39,949 --> 00:04:42,979
that you can that<font color="#E5E5E5"> you can imagine what</font>

121
00:04:41,090 --> 00:04:44,508
<font color="#CCCCCC">other types of things can</font><font color="#E5E5E5"> happen well</font>

122
00:04:42,979 --> 00:04:45,800
here's here's here's another pretty

123
00:04:44,509 --> 00:04:47,930
pretty simple thing that could happen

124
00:04:45,800 --> 00:04:50,509
<font color="#E5E5E5">right so let's let's assume it in my a s</font>

125
00:04:47,930 --> 00:04:53,509
I've got four routers and you know I'd

126
00:04:50,509 --> 00:04:55,669
like to set up<font color="#E5E5E5"> full mesh ibgp but whoops</font>

127
00:04:53,509 --> 00:04:56,840
I forgot a<font color="#E5E5E5"> BGP session from that router</font>

128
00:04:55,669 --> 00:04:58,609
on the lower left to the route around

129
00:04:56,840 --> 00:05:00,590
the upper right well so what can happen

130
00:04:58,610 --> 00:05:02,960
is you know if a comes in at<font color="#E5E5E5"> this router</font>

131
00:05:00,590 --> 00:05:04,039
on the lower left here then this router

132
00:05:02,960 --> 00:05:06,169
on the upper right<font color="#CCCCCC"> is actually never</font>

133
00:05:04,039 --> 00:05:08,900
<font color="#CCCCCC">going to learn that route so if you're</font>

134
00:05:06,169 --> 00:05:11,900
if this a s is peering at these two

135
00:05:08,900 --> 00:05:15,198
routers with some other neighbor then at

136
00:05:11,900 --> 00:05:16,638
one of those peering points that<font color="#CCCCCC"> pier</font><font color="#E5E5E5"> is</font>

137
00:05:15,199 --> 00:05:18,050
going to hear route a and at the other

138
00:05:16,639 --> 00:05:22,509
peering point that<font color="#CCCCCC"> pierce not going to</font>

139
00:05:18,050 --> 00:05:22,509
hear anything<font color="#E5E5E5"> okay so you're probably</font>

140
00:05:23,050 --> 00:05:28,310
thinking you know what else what else

141
00:05:24,979 --> 00:05:30,289
could probably happen well so let's

142
00:05:28,310 --> 00:05:33,409
let's assume now that some downstream a

143
00:05:30,289 --> 00:05:35,509
s sends a with some AAS path lengthen

144
00:05:33,409 --> 00:05:38,180
and another route be with<font color="#CCCCCC"> a</font><font color="#E5E5E5"> longer</font><font color="#CCCCCC"> a s</font>

145
00:05:35,509 --> 00:05:39,589
path length well note here that you do

146
00:05:38,180 --> 00:05:42,379
have<font color="#E5E5E5"> kind of a signaling partition here</font>

147
00:05:39,589 --> 00:05:43,699
because not only can the router on the

148
00:05:42,379 --> 00:05:45,529
upper left not here route a but the

149
00:05:43,699 --> 00:05:46,940
router on the the router on the upper

150
00:05:45,529 --> 00:05:49,400
right can't hear out a but the router on

151
00:05:46,940 --> 00:05:51,379
the upper left can't hear<font color="#E5E5E5"> route be so</font>

152
00:05:49,400 --> 00:05:53,060
that right around the upper left just

153
00:05:51,379 --> 00:05:55,759
going to advertise<font color="#CCCCCC"> in a s path length</font>

154
00:05:53,060 --> 00:05:56,960
rat with an AAS path length of to the

155
00:05:55,759 --> 00:05:59,089
right around the upper right is going to

156
00:05:56,960 --> 00:06:01,520
advertise a route with nance path length

157
00:05:59,089 --> 00:06:02,719
of three and and now you know even<font color="#CCCCCC"> that</font>

158
00:06:01,520 --> 00:06:04,128
even though that neighbor is going to

159
00:06:02,719 --> 00:06:05,900
hear routes at both of those peering

160
00:06:04,129 --> 00:06:07,610
points it's going to hear things<font color="#E5E5E5"> that</font>

161
00:06:05,900 --> 00:06:09,620
are inconsistent ie they have different

162
00:06:07,610 --> 00:06:11,599
a s path lengths so you're<font color="#CCCCCC"> probably</font>

163
00:06:09,620 --> 00:06:13,849
thinking like oh come on like this you

164
00:06:11,599 --> 00:06:15,110
know this sort of ibgp like failure to

165
00:06:13,849 --> 00:06:17,180
configure flemish like never happens

166
00:06:15,110 --> 00:06:19,099
right but these things can actually<font color="#CCCCCC"> get</font>

167
00:06:17,180 --> 00:06:20,750
like significantly more complicated when

168
00:06:19,099 --> 00:06:22,849
you start introducing things like route

169
00:06:20,750 --> 00:06:24,289
reflection right so here I've shown I

170
00:06:22,849 --> 00:06:26,810
basically<font color="#E5E5E5"> dropped in the simplest</font>

171
00:06:24,289 --> 00:06:28,370
possible ibgp signaling partition

172
00:06:26,810 --> 00:06:30,800
involving route reflection right I've

173
00:06:28,370 --> 00:06:32,150
got a top layer of three route

174
00:06:30,800 --> 00:06:34,310
reflectors but they're not<font color="#E5E5E5"> fully meshed</font>

175
00:06:32,150 --> 00:06:36,679
and I've got<font color="#E5E5E5"> the same situation here</font>

176
00:06:34,310 --> 00:06:39,440
again um so one thing I want<font color="#E5E5E5"> to stress</font>

177
00:06:36,680 --> 00:06:41,550
here is that again

178
00:06:39,440 --> 00:06:44,370
unless you specifically look for this

179
00:06:41,550 --> 00:06:45,750
type of thing this this this may be

180
00:06:44,370 --> 00:06:47,010
going on and you may<font color="#E5E5E5"> not you may not</font>

181
00:06:45,750 --> 00:06:48,870
<font color="#E5E5E5">even notice right it's not like reach</font>

182
00:06:47,010 --> 00:06:50,520
ability is being affected here right

183
00:06:48,870 --> 00:06:51,960
that that<font color="#CCCCCC"> peer whoever you're sending</font>

184
00:06:50,520 --> 00:06:53,370
these routes to is actually is going<font color="#CCCCCC"> to</font>

185
00:06:51,960 --> 00:06:55,169
hear routes they're going<font color="#CCCCCC"> to be able</font><font color="#E5E5E5"> to</font>

186
00:06:53,370 --> 00:06:57,230
reach the destination and<font color="#E5E5E5"> unless you</font>

187
00:06:55,170 --> 00:06:59,640
they actually take the time to look then

188
00:06:57,230 --> 00:07:01,320
hey this stuff may be going on and and

189
00:06:59,640 --> 00:07:02,880
we may<font color="#E5E5E5"> not know about it and similarly</font>

190
00:07:01,320 --> 00:07:04,800
like you may be<font color="#E5E5E5"> doing</font><font color="#CCCCCC"> this to</font><font color="#E5E5E5"> your peers</font>

191
00:07:02,880 --> 00:07:06,000
and not know about<font color="#E5E5E5"> it if</font><font color="#CCCCCC"> you haven't</font>

192
00:07:04,800 --> 00:07:09,180
bothered to check<font color="#E5E5E5"> for this type of thing</font>

193
00:07:06,000 --> 00:07:12,120
so again<font color="#E5E5E5"> RCC can look for these types of</font>

194
00:07:09,180 --> 00:07:13,740
signaling partitions as well so what

195
00:07:12,120 --> 00:07:15,390
other types of things can<font color="#E5E5E5"> happen well a</font>

196
00:07:13,740 --> 00:07:17,040
lot<font color="#E5E5E5"> of these inconsistencies can also be</font>

197
00:07:15,390 --> 00:07:19,919
caused by things like BGP communities

198
00:07:17,040 --> 00:07:22,230
let's let's say the<font color="#CCCCCC"> same AS and it's now</font>

199
00:07:19,919 --> 00:07:23,729
fully meshed but it's it's got some

200
00:07:22,230 --> 00:07:25,950
customer that's advertising route to the

201
00:07:23,730 --> 00:07:27,780
destination at two places and maybe at

202
00:07:25,950 --> 00:07:30,479
one of those places the customer

203
00:07:27,780 --> 00:07:33,119
attaches<font color="#CCCCCC"> a no export community well you</font>

204
00:07:30,480 --> 00:07:34,500
know the routers in SAS may not may not

205
00:07:33,120 --> 00:07:36,300
all pick the same route the router on

206
00:07:34,500 --> 00:07:37,380
the upper left may pick route a the

207
00:07:36,300 --> 00:07:39,390
route around the<font color="#E5E5E5"> upper right may pick</font>

208
00:07:37,380 --> 00:07:40,950
route be<font color="#E5E5E5"> also what happens when that</font>

209
00:07:39,390 --> 00:07:42,659
runner on the upper right pics are up<font color="#CCCCCC"> B</font>

210
00:07:40,950 --> 00:07:45,650
is that that that route has a no export

211
00:07:42,660 --> 00:07:48,690
community and it doesn't send<font color="#E5E5E5"> the route</font>

212
00:07:45,650 --> 00:07:50,159
<font color="#E5E5E5">okay so this is sort of things that</font>

213
00:07:48,690 --> 00:07:52,169
involve configuration let's talk about

214
00:07:50,160 --> 00:07:53,910
some sort<font color="#E5E5E5"> of more fundamental</font>

215
00:07:52,169 --> 00:07:57,180
limitations that can cause these

216
00:07:53,910 --> 00:07:59,280
inconsistencies to happen um so tink

217
00:07:57,180 --> 00:08:02,460
taking just supposing<font color="#CCCCCC"> for a minute that</font>

218
00:07:59,280 --> 00:08:05,640
you know we abide by that common

219
00:08:02,460 --> 00:08:06,599
restriction that if<font color="#CCCCCC"> I na s learns around</font>

220
00:08:05,640 --> 00:08:08,219
from up here it's<font color="#E5E5E5"> not going to</font>

221
00:08:06,600 --> 00:08:10,440
re-advertise that route to another<font color="#E5E5E5"> peer</font>

222
00:08:08,220 --> 00:08:12,690
well strange things can happen if<font color="#CCCCCC"> you do</font>

223
00:08:10,440 --> 00:08:15,900
if you prefer customer routes and pure

224
00:08:12,690 --> 00:08:18,510
routes to a single destination equally

225
00:08:15,900 --> 00:08:20,489
so in this example I've shown route a

226
00:08:18,510 --> 00:08:22,560
coming in from customer<font color="#CCCCCC"> 1 and route be</font>

227
00:08:20,490 --> 00:08:23,940
coming in from pier 1 well so what

228
00:08:22,560 --> 00:08:26,310
happens now is if that router on the

229
00:08:23,940 --> 00:08:27,810
upper right picks the pier route and the

230
00:08:26,310 --> 00:08:30,960
router on the upper left picks the

231
00:08:27,810 --> 00:08:33,809
customer route well pr2 up there is

232
00:08:30,960 --> 00:08:39,000
going<font color="#E5E5E5"> to learn route a from the upper</font>

233
00:08:33,809 --> 00:08:40,530
left but not<font color="#E5E5E5"> route be now you may be</font>

234
00:08:39,000 --> 00:08:42,360
thinking like this<font color="#CCCCCC"> is incredibly</font>

235
00:08:40,530 --> 00:08:44,430
contrived and you know perhaps have just

236
00:08:42,360 --> 00:08:48,420
made this up right well let's open the

237
00:08:44,430 --> 00:08:50,400
nano history books and Randy<font color="#E5E5E5"> Bush isn't</font>

238
00:08:48,420 --> 00:08:51,550
here unfortunately but I'll speak for

239
00:08:50,400 --> 00:08:53,860
<font color="#CCCCCC">him anyway</font>

240
00:08:51,550 --> 00:08:56,079
we go back to nineteen ninety-seven we

241
00:08:53,860 --> 00:08:57,209
can see the situation<font color="#E5E5E5"> that I just</font>

242
00:08:56,080 --> 00:08:59,920
described<font color="#CCCCCC"> to you on the last slide</font>

243
00:08:57,209 --> 00:09:01,420
actually came<font color="#CCCCCC"> up on a thread on the</font>

244
00:08:59,920 --> 00:09:03,310
archives you can you can go read<font color="#CCCCCC"> the</font>

245
00:09:01,420 --> 00:09:05,800
thread yourself essentially what what

246
00:09:03,310 --> 00:09:08,979
Randy<font color="#CCCCCC"> is saying here is that hey I've</font>

247
00:09:05,800 --> 00:09:10,449
got<font color="#CCCCCC"> uh you know I'm I've got some site</font>

248
00:09:08,980 --> 00:09:12,310
that that I'm<font color="#E5E5E5"> learning routes to you</font>

249
00:09:10,450 --> 00:09:14,649
from both appear and a customer I have

250
00:09:12,310 --> 00:09:16,149
consistent export policy but because I'm

251
00:09:14,649 --> 00:09:18,640
not advertising my peer routes to other

252
00:09:16,149 --> 00:09:22,709
peers it could you know<font color="#E5E5E5"> the situation I</font>

253
00:09:18,640 --> 00:09:25,300
just<font color="#E5E5E5"> described actually can happen okay</font>

254
00:09:22,709 --> 00:09:26,319
so now that<font color="#E5E5E5"> we know like that the types</font>

255
00:09:25,300 --> 00:09:28,510
of things that can<font color="#E5E5E5"> cause these</font>

256
00:09:26,320 --> 00:09:30,160
inconsistencies to occur let's sort of

257
00:09:28,510 --> 00:09:31,750
dive deeper and try to figure out how we

258
00:09:30,160 --> 00:09:33,279
can actually<font color="#E5E5E5"> detect these things how can</font>

259
00:09:31,750 --> 00:09:36,130
<font color="#E5E5E5">I actually figure out as an AS sending</font>

260
00:09:33,279 --> 00:09:38,519
me inconsistent advertisements<font color="#E5E5E5"> okay so</font>

261
00:09:36,130 --> 00:09:42,339
the first thing you might think of is

262
00:09:38,519 --> 00:09:44,410
<font color="#E5E5E5">really</font><font color="#CCCCCC"> simple right well you know if I'm</font>

263
00:09:42,339 --> 00:09:46,990
if I'm<font color="#E5E5E5"> hearing routes a and B from some</font>

264
00:09:44,410 --> 00:09:48,880
<font color="#CCCCCC">AAS well why don't I just you know</font><font color="#E5E5E5"> look</font>

265
00:09:46,990 --> 00:09:50,529
at<font color="#E5E5E5"> the routes I'm hearing over ebgp and</font>

266
00:09:48,880 --> 00:09:52,450
compare them and<font color="#E5E5E5"> if they're different or</font>

267
00:09:50,529 --> 00:09:55,000
if one's missing at some peering point

268
00:09:52,450 --> 00:09:57,610
then<font color="#E5E5E5"> you know I go yell at them well</font>

269
00:09:55,000 --> 00:09:59,740
unfortunately this type of thing isn't

270
00:09:57,610 --> 00:10:01,690
isn't tenable today you you kind<font color="#CCCCCC"> of</font>

271
00:09:59,740 --> 00:10:04,810
imagine how you might might do this

272
00:10:01,690 --> 00:10:07,420
right unfortunately we can't actually

273
00:10:04,810 --> 00:10:08,410
see the EBT routes all the ebgp routes

274
00:10:07,420 --> 00:10:10,540
that are coming<font color="#CCCCCC"> over those sessions</font>

275
00:10:08,410 --> 00:10:12,550
you'd need something<font color="#CCCCCC"> like a vendor</font>

276
00:10:10,540 --> 00:10:14,709
enhancement to say like a lot of the

277
00:10:12,550 --> 00:10:16,750
router to say give<font color="#CCCCCC"> me all the all the</font>

278
00:10:14,709 --> 00:10:19,899
routes<font color="#E5E5E5"> I've learned by ebgp at a</font>

279
00:10:16,750 --> 00:10:21,940
specific time right I can't just do show

280
00:10:19,899 --> 00:10:23,560
ibgp for example like<font color="#E5E5E5"> I can't do table</font>

281
00:10:21,940 --> 00:10:24,850
dumps because hey that table dump could

282
00:10:23,560 --> 00:10:27,939
take<font color="#CCCCCC"> 10 minutes and if I'm dumping</font>

283
00:10:24,850 --> 00:10:29,440
routes from both<font color="#CCCCCC"> of these tables over a</font>

284
00:10:27,940 --> 00:10:30,940
<font color="#CCCCCC">10-minute period I don't know if that</font>

285
00:10:29,440 --> 00:10:32,920
inconsistency actually happened or it

286
00:10:30,940 --> 00:10:34,380
was some like transient event that was

287
00:10:32,920 --> 00:10:36,729
going on while I was dumping the tables

288
00:10:34,380 --> 00:10:38,110
so I really need like some you know some

289
00:10:36,730 --> 00:10:44,380
sort of real-time feed to do<font color="#E5E5E5"> this</font>

290
00:10:38,110 --> 00:10:45,790
correctly um so yeah you know one one

291
00:10:44,380 --> 00:10:48,310
way<font color="#E5E5E5"> to do</font><font color="#CCCCCC"> this would be to require the</font>

292
00:10:45,790 --> 00:10:50,410
<font color="#E5E5E5">vendor to actually you know tell me all</font>

293
00:10:48,310 --> 00:10:52,899
the BGP routes all the ebgp routes I'm

294
00:10:50,410 --> 00:10:54,339
getting in real time of course another

295
00:10:52,899 --> 00:10:55,720
<font color="#E5E5E5">way you could do this assuming you</font>

296
00:10:54,339 --> 00:10:59,440
trusted your peer and it wasn't actually

297
00:10:55,720 --> 00:11:00,970
<font color="#E5E5E5">you know doing that in this inconsistent</font>

298
00:10:59,440 --> 00:11:03,579
<font color="#E5E5E5">advertisement intentionally as you could</font>

299
00:11:00,970 --> 00:11:04,889
say hey could you send me an e<font color="#CCCCCC"> BGP feed</font>

300
00:11:03,579 --> 00:11:05,939
of your<font color="#E5E5E5"> routes at</font>

301
00:11:04,889 --> 00:11:08,999
separate router so I can<font color="#CCCCCC"> actually</font>

302
00:11:05,939 --> 00:11:10,379
monitor them that doesn't you know that

303
00:11:08,999 --> 00:11:13,199
approach doesn't really instill a lot of

304
00:11:10,379 --> 00:11:15,209
confidence in me the third is of course

305
00:11:13,199 --> 00:11:16,559
you could take packet monitors on on

306
00:11:15,209 --> 00:11:18,059
every<font color="#CCCCCC"> one of these</font><font color="#E5E5E5"> links and then see</font>

307
00:11:16,559 --> 00:11:21,358
what's actually coming on the<font color="#CCCCCC"> CB GP</font>

308
00:11:18,059 --> 00:11:22,618
sessions um so it's unfortunately we

309
00:11:21,359 --> 00:11:24,359
don't have any of these<font color="#E5E5E5"> things because</font>

310
00:11:22,619 --> 00:11:27,089
this problem would would would really go

311
00:11:24,359 --> 00:11:29,879
<font color="#E5E5E5">away if you know if we could get just</font>

312
00:11:27,089 --> 00:11:31,859
one of these<font color="#E5E5E5"> things so what</font><font color="#CCCCCC"> can we</font><font color="#E5E5E5"> do</font>

313
00:11:29,879 --> 00:11:33,660
instead well we can monitor the ibgp

314
00:11:31,859 --> 00:11:35,639
it's really easy right like we just set

315
00:11:33,660 --> 00:11:37,019
up a zebra router or some other type of

316
00:11:35,639 --> 00:11:39,329
monitor and we just start logging the

317
00:11:37,019 --> 00:11:41,089
ibgp messages we've got time stamps on

318
00:11:39,329 --> 00:11:43,138
them and we can figure out what routers

319
00:11:41,089 --> 00:11:44,910
what which of these border routers have

320
00:11:43,139 --> 00:11:46,769
picked which route is their best route

321
00:11:44,910 --> 00:11:48,988
at any specific point in time and then I

322
00:11:46,769 --> 00:11:51,059
could<font color="#CCCCCC"> look</font><font color="#E5E5E5"> for inconsistencies with the</font>

323
00:11:48,989 --> 00:11:53,730
problem with looking at the ibgp is I

324
00:11:51,059 --> 00:11:56,759
<font color="#E5E5E5">don't get the full picture right I only</font>

325
00:11:53,730 --> 00:11:59,579
get each routers best ebgp learned route

326
00:11:56,759 --> 00:12:01,319
at any one time so for<font color="#E5E5E5"> example in this</font>

327
00:11:59,579 --> 00:12:03,748
<font color="#E5E5E5">asf shown here if the router on the</font>

328
00:12:01,319 --> 00:12:06,738
upper right picks throughout see then I

329
00:12:03,749 --> 00:12:09,480
only get<font color="#E5E5E5"> to see route a and route see I</font>

330
00:12:06,739 --> 00:12:11,999
never get to see route be so I you<font color="#CCCCCC"> know</font>

331
00:12:09,480 --> 00:12:14,129
<font color="#CCCCCC">just</font><font color="#E5E5E5"> you know it's tough to tell whether</font>

332
00:12:11,999 --> 00:12:16,679
routes a and B are equally good if I

333
00:12:14,129 --> 00:12:19,529
never see be<font color="#E5E5E5"> alright so what can</font><font color="#CCCCCC"> we do</font>

334
00:12:16,679 --> 00:12:21,419
about this well let's try<font color="#E5E5E5"> to infer</font>

335
00:12:19,529 --> 00:12:23,369
something about be now even<font color="#CCCCCC"> though we</font>

336
00:12:21,419 --> 00:12:25,290
didn't see it because<font color="#E5E5E5"> we saw route see</font>

337
00:12:23,369 --> 00:12:30,360
maybe we could say something<font color="#E5E5E5"> about route</font>

338
00:12:25,290 --> 00:12:33,029
be<font color="#CCCCCC"> ok so the trick here is to basically</font>

339
00:12:30,360 --> 00:12:35,939
try to<font color="#CCCCCC"> oh and the other</font><font color="#E5E5E5"> problem with</font>

340
00:12:33,029 --> 00:12:37,439
ibgp right is not only<font color="#E5E5E5"> is that each of</font>

341
00:12:35,939 --> 00:12:39,389
one of these routers picking its best

342
00:12:37,439 --> 00:12:42,719
route but there's policy going<font color="#E5E5E5"> on there</font>

343
00:12:39,389 --> 00:12:46,019
too so the routes I hear over these ibgp

344
00:12:42,720 --> 00:12:47,850
sessions may may<font color="#E5E5E5"> be altered by the</font>

345
00:12:46,019 --> 00:12:49,199
import policies on<font color="#CCCCCC"> the ebgp speaking</font>

346
00:12:47,850 --> 00:12:54,929
routers before<font color="#E5E5E5"> I actually get to see</font>

347
00:12:49,199 --> 00:12:56,549
them right so what I'd<font color="#CCCCCC"> like to do to</font>

348
00:12:54,929 --> 00:12:58,860
allow me to compare routes a and<font color="#E5E5E5"> B is</font>

349
00:12:56,549 --> 00:13:00,389
sort of say something about route be

350
00:12:58,860 --> 00:13:04,079
based on<font color="#E5E5E5"> the fact that I saw her out see</font>

351
00:13:00,389 --> 00:13:05,279
<font color="#E5E5E5">instead so what I want to do</font><font color="#CCCCCC"> is take</font>

352
00:13:04,079 --> 00:13:06,899
this route see that I've learned<font color="#CCCCCC"> over</font>

353
00:13:05,279 --> 00:13:09,239
ibgp and sort<font color="#E5E5E5"> of figure</font><font color="#CCCCCC"> out what it</font>

354
00:13:06,899 --> 00:13:11,160
would have looked like over the<font color="#CCCCCC"> ebgp</font>

355
00:13:09,239 --> 00:13:12,839
session by inverting that import policy

356
00:13:11,160 --> 00:13:14,639
and then<font color="#E5E5E5"> I'd like to be able to say that</font>

357
00:13:12,839 --> 00:13:17,100
<font color="#E5E5E5">hey since this router is picking its</font>

358
00:13:14,639 --> 00:13:18,329
best ebgp learned route and<font color="#E5E5E5"> I learned</font>

359
00:13:17,100 --> 00:13:20,579
<font color="#CCCCCC">about see</font>

360
00:13:18,329 --> 00:13:21,809
well<font color="#CCCCCC"> c must be at least as good as route</font>

361
00:13:20,579 --> 00:13:24,839
be because otherwise it would<font color="#E5E5E5"> have heard</font>

362
00:13:21,809 --> 00:13:27,540
route be and then knowing that I could

363
00:13:24,839 --> 00:13:30,239
say if route<font color="#E5E5E5"> c is worse than route a</font>

364
00:13:27,540 --> 00:13:34,170
then either be<font color="#E5E5E5"> also has to be worse than</font>

365
00:13:30,239 --> 00:13:35,939
a longer a s path length etc or<font color="#CCCCCC"> D wasn't</font>

366
00:13:34,170 --> 00:13:38,488
advertised at all otherwise<font color="#CCCCCC"> I would have</font>

367
00:13:35,939 --> 00:13:40,199
heard it unfortunately I can't always do

368
00:13:38,489 --> 00:13:41,819
this certain things<font color="#E5E5E5"> have to be true</font>

369
00:13:40,199 --> 00:13:44,939
about the import policy to allow me<font color="#E5E5E5"> to</font>

370
00:13:41,819 --> 00:13:46,139
make<font color="#CCCCCC"> these kind of statements now on the</font>

371
00:13:44,939 --> 00:13:47,459
last slide I talked about<font color="#E5E5E5"> inverting</font>

372
00:13:46,139 --> 00:13:49,499
import policy so the first thing that

373
00:13:47,459 --> 00:13:51,809
<font color="#E5E5E5">has to be true about import policy is it</font>

374
00:13:49,499 --> 00:13:53,309
has to be invertible the second thing<font color="#E5E5E5"> is</font>

375
00:13:51,809 --> 00:13:55,469
that<font color="#E5E5E5"> the import policy on those those</font>

376
00:13:53,309 --> 00:13:57,179
ebgp speaking routers can't take two

377
00:13:55,470 --> 00:13:58,860
routes that are consistent ie they have

378
00:13:57,179 --> 00:14:01,350
equal a s path length and they're both

379
00:13:58,860 --> 00:14:03,600
being in<font color="#CCCCCC"> there all being advertised each</font>

380
00:14:01,350 --> 00:14:05,819
the<font color="#E5E5E5"> pier is advertising something at all</font>

381
00:14:03,600 --> 00:14:07,949
those peering points and actually<font color="#E5E5E5"> make</font>

382
00:14:05,819 --> 00:14:09,988
some set of consistent routes look

383
00:14:07,949 --> 00:14:12,389
inconsistent so I'm<font color="#CCCCCC"> going to talk</font><font color="#E5E5E5"> about</font>

384
00:14:09,989 --> 00:14:15,269
<font color="#E5E5E5">examples of import policy that violate</font>

385
00:14:12,389 --> 00:14:17,069
each of these two things now so here's

386
00:14:15,269 --> 00:14:20,519
an example<font color="#CCCCCC"> of a non-invertible import</font>

387
00:14:17,069 --> 00:14:23,488
policy let's say<font color="#E5E5E5"> that on these on both</font>

388
00:14:20,519 --> 00:14:25,350
of these border routers<font color="#E5E5E5"> I have some some</font>

389
00:14:23,489 --> 00:14:28,110
import policy that says if the a s path

390
00:14:25,350 --> 00:14:31,079
length is 1 then prepend<font color="#CCCCCC"> one twice if</font>

391
00:14:28,110 --> 00:14:34,919
the a s path length is 1 1 then prepend

392
00:14:31,079 --> 00:14:39,179
won a single time well what am I going

393
00:14:34,919 --> 00:14:42,360
to<font color="#CCCCCC"> here at</font><font color="#E5E5E5"> this at this monitoring point</font>

394
00:14:39,179 --> 00:14:43,980
if I hear one on this session on<font color="#E5E5E5"> the</font>

395
00:14:42,360 --> 00:14:47,699
left and 11 on the session on the right

396
00:14:43,980 --> 00:14:50,519
I'm gonna hear three ones for my ass

397
00:14:47,699 --> 00:14:54,508
path in both<font color="#CCCCCC"> cases and I could flip flop</font>

398
00:14:50,519 --> 00:14:56,610
these and I could also you know they

399
00:14:54,509 --> 00:14:58,259
might also be both a s path length of

400
00:14:56,610 --> 00:15:00,509
two or they might also both bas path

401
00:14:58,259 --> 00:15:02,339
length of one absolutely no it it's hell

402
00:15:00,509 --> 00:15:03,959
because<font color="#E5E5E5"> my import policy has done</font>

403
00:15:02,339 --> 00:15:06,540
something<font color="#E5E5E5"> that doesn't allow me to</font>

404
00:15:03,959 --> 00:15:11,219
reverse it based solely on what I see in

405
00:15:06,540 --> 00:15:13,379
the ibgp routes okay so the other<font color="#CCCCCC"> thing</font>

406
00:15:11,220 --> 00:15:14,970
that can that import policies could do

407
00:15:13,379 --> 00:15:16,889
potentially that would make our life

408
00:15:14,970 --> 00:15:19,649
difficult is to take<font color="#CCCCCC"> two routes that are</font>

409
00:15:16,889 --> 00:15:21,629
consistent<font color="#CCCCCC"> in terms of a s path length</font>

410
00:15:19,649 --> 00:15:23,429
and make them inconsistent so let's<font color="#E5E5E5"> say</font>

411
00:15:21,629 --> 00:15:25,889
<font color="#E5E5E5">that these border routers now have some</font>

412
00:15:23,429 --> 00:15:30,430
import policy that says if the a s path

413
00:15:25,889 --> 00:15:32,500
contains the as5 then depress the route

414
00:15:30,430 --> 00:15:34,319
okay so what could happen here is that

415
00:15:32,500 --> 00:15:38,080
you know this router on the upper right

416
00:15:34,320 --> 00:15:40,960
if that<font color="#CCCCCC"> router learns a route and around</font>

417
00:15:38,080 --> 00:15:43,420
with the a s path for example 156 and a

418
00:15:40,960 --> 00:15:45,970
second route from a different is with a

419
00:15:43,420 --> 00:15:47,439
longer a s path length well then that

420
00:15:45,970 --> 00:15:49,300
router is actually going to choose the

421
00:15:47,440 --> 00:15:50,140
route with<font color="#CCCCCC"> the longer a s path length so</font>

422
00:15:49,300 --> 00:15:53,979
what we're going to see at this

423
00:15:50,140 --> 00:15:56,680
monitoring point is an ass a route with

424
00:15:53,980 --> 00:15:58,870
an ass path length of three one four six

425
00:15:56,680 --> 00:16:01,000
and a route with an ass path length of

426
00:15:58,870 --> 00:16:03,760
four to seven eight six but I can't say

427
00:16:01,000 --> 00:16:05,740
anything about what I<font color="#E5E5E5"> would have</font><font color="#CCCCCC"> heard</font>

428
00:16:03,760 --> 00:16:08,410
or what I think I might have heard from

429
00:16:05,740 --> 00:16:10,270
ants one on<font color="#E5E5E5"> this on this other border</font>

430
00:16:08,410 --> 00:16:11,829
router because my import policies are

431
00:16:10,270 --> 00:16:15,490
making it impossible for me to see

432
00:16:11,830 --> 00:16:17,080
actually what's going on ok so these

433
00:16:15,490 --> 00:16:19,360
these are two cases<font color="#E5E5E5"> that create some</font>

434
00:16:17,080 --> 00:16:22,750
problems<font color="#E5E5E5"> for us</font><font color="#CCCCCC"> but in other in other</font>

435
00:16:19,360 --> 00:16:25,480
cases the the technique I described to

436
00:16:22,750 --> 00:16:27,370
you or the logic I described to you for

437
00:16:25,480 --> 00:16:28,870
inferring what's actually<font color="#E5E5E5"> being coming</font>

438
00:16:27,370 --> 00:16:30,790
in over the ebgp sessions actually

439
00:16:28,870 --> 00:16:32,620
actually<font color="#CCCCCC"> does work and</font><font color="#E5E5E5"> we can answer</font>

440
00:16:30,790 --> 00:16:34,089
some questions about<font color="#CCCCCC"> you know how</font>

441
00:16:32,620 --> 00:16:36,330
prevalent these these types of

442
00:16:34,089 --> 00:16:37,990
inconsistent advertisements are

443
00:16:36,330 --> 00:16:39,339
obviously the first thing we'd be

444
00:16:37,990 --> 00:16:40,690
interested in is<font color="#E5E5E5"> trying to figure</font><font color="#CCCCCC"> out</font>

445
00:16:39,339 --> 00:16:45,580
how often these inconsistent route

446
00:16:40,690 --> 00:16:47,470
advertisements happen of<font color="#CCCCCC"> course another</font>

447
00:16:45,580 --> 00:16:48,640
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> to think about is how how how long</font>

448
00:16:47,470 --> 00:16:50,440
are these inconsistent route

449
00:16:48,640 --> 00:16:52,120
advertisements lasting you know if

450
00:16:50,440 --> 00:16:53,500
they're relatively short-lived and we

451
00:16:52,120 --> 00:16:55,480
could<font color="#E5E5E5"> probably write it off to you know</font>

452
00:16:53,500 --> 00:16:56,680
convergence or something like that if on

453
00:16:55,480 --> 00:16:58,660
the<font color="#E5E5E5"> other hand they're going on for days</font>

454
00:16:56,680 --> 00:17:00,969
or weeks then it's probably time to make

455
00:16:58,660 --> 00:17:04,240
a phone<font color="#E5E5E5"> call um and then the other</font><font color="#CCCCCC"> thing</font>

456
00:17:00,970 --> 00:17:06,490
to think about is you know how how badly

457
00:17:04,240 --> 00:17:08,109
are these these inconsistent

458
00:17:06,490 --> 00:17:10,569
advertisements messing us up are they

459
00:17:08,109 --> 00:17:12,339
causing us to send traffic you know from

460
00:17:10,569 --> 00:17:15,760
you know out appearing point in San

461
00:17:12,339 --> 00:17:17,349
Francisco instead of one<font color="#E5E5E5"> LA or are they</font>

462
00:17:15,760 --> 00:17:18,790
causing us to send traffic out of

463
00:17:17,349 --> 00:17:21,219
appearing point in San Francisco instead

464
00:17:18,790 --> 00:17:22,928
of one in New York just<font color="#E5E5E5"> things to think</font>

465
00:17:21,220 --> 00:17:24,429
about when we think about inconsistent

466
00:17:22,929 --> 00:17:26,699
advertisements so let's<font color="#E5E5E5"> look at the</font>

467
00:17:24,429 --> 00:17:29,350
first one<font color="#E5E5E5"> how often</font><font color="#CCCCCC"> it is</font><font color="#E5E5E5"> inconsistent</font>

468
00:17:26,699 --> 00:17:34,600
routes route advertisements happening

469
00:17:29,350 --> 00:17:36,790
well we looked at a week-long trace this

470
00:17:34,600 --> 00:17:39,340
is so i'm going<font color="#E5E5E5"> to show you two types of</font>

471
00:17:36,790 --> 00:17:41,260
data<font color="#E5E5E5"> i said for i described the easy</font>

472
00:17:39,340 --> 00:17:43,270
case when we had the ebgp feed and we

473
00:17:41,260 --> 00:17:44,740
did have<font color="#E5E5E5"> this for one of AT&T SP</font>

474
00:17:43,270 --> 00:17:47,200
and that's what<font color="#E5E5E5"> I'm showing here when</font><font color="#CCCCCC"> i</font>

475
00:17:44,740 --> 00:17:49,750
show bgp announcements from one peer so

476
00:17:47,200 --> 00:17:52,090
we looked at a week a week long period

477
00:17:49,750 --> 00:17:54,760
of<font color="#E5E5E5"> this trace and just looked at you</font>

478
00:17:52,090 --> 00:17:56,169
<font color="#CCCCCC">know how often was it for the case when</font>

479
00:17:54,760 --> 00:17:58,000
a prefect when a prefix was being

480
00:17:56,170 --> 00:17:59,590
advertised how often was it that you

481
00:17:58,000 --> 00:18:01,090
know it<font color="#E5E5E5"> wasn't being advertised at all</font>

482
00:17:59,590 --> 00:18:02,620
peering points or it was being

483
00:18:01,090 --> 00:18:04,929
advertised at all peering points but had

484
00:18:02,620 --> 00:18:06,129
different<font color="#E5E5E5"> ask path lengths etc you can</font>

485
00:18:04,930 --> 00:18:08,200
see<font color="#E5E5E5"> that over the course of this week</font>

486
00:18:06,130 --> 00:18:10,210
like inconsistent<font color="#E5E5E5"> route advertisements</font>

487
00:18:08,200 --> 00:18:11,950
are happening all the time so you might

488
00:18:10,210 --> 00:18:14,320
wonder like what's what's going on here

489
00:18:11,950 --> 00:18:16,270
so lets you know<font color="#E5E5E5"> is that always the same</font>

490
00:18:14,320 --> 00:18:18,760
prefix<font color="#CCCCCC"> its that's being inconsistent or</font>

491
00:18:16,270 --> 00:18:20,740
is it just short-lived stuff well it

492
00:18:18,760 --> 00:18:22,510
<font color="#CCCCCC">turns out almost all this stuff is</font>

493
00:18:20,740 --> 00:18:23,980
short-lived you're going to write almost

494
00:18:22,510 --> 00:18:25,480
all of it off to convergence like

495
00:18:23,980 --> 00:18:27,940
<font color="#CCCCCC">ninety-nine percent of these</font>

496
00:18:25,480 --> 00:18:31,090
inconsistencies<font color="#CCCCCC"> last less than about 100</font>

497
00:18:27,940 --> 00:18:33,340
seconds<font color="#CCCCCC"> well but there there are you</font>

498
00:18:31,090 --> 00:18:35,379
know<font color="#E5E5E5"> some fraction of these routes that</font>

499
00:18:33,340 --> 00:18:40,629
are inconsistent for<font color="#E5E5E5"> the entire period</font>

500
00:18:35,380 --> 00:18:41,950
of<font color="#E5E5E5"> our trace um as far as a as far as</font>

501
00:18:40,630 --> 00:18:43,950
different as path lengths are concerned

502
00:18:41,950 --> 00:18:46,750
that seems to be<font color="#E5E5E5"> even less prevalent</font>

503
00:18:43,950 --> 00:18:48,970
again these these types of

504
00:18:46,750 --> 00:18:51,760
inconsistencies are quite short and in

505
00:18:48,970 --> 00:18:53,920
these types in consistencies we didn't

506
00:18:51,760 --> 00:18:55,629
witness in our trace so this was

507
00:18:53,920 --> 00:18:57,970
actually keep in mind this is not<font color="#E5E5E5"> like a</font>

508
00:18:55,630 --> 00:19:01,180
<font color="#E5E5E5">general result that I just showed you</font>

509
00:18:57,970 --> 00:19:02,980
this was for one of<font color="#E5E5E5"> 18</font><font color="#CCCCCC"> T</font><font color="#E5E5E5"> Spears but for</font>

510
00:19:01,180 --> 00:19:04,510
this case we could I mean it's<font color="#E5E5E5"> pretty</font>

511
00:19:02,980 --> 00:19:06,880
safe to say that most of these

512
00:19:04,510 --> 00:19:08,800
inconsistencies are caused by

513
00:19:06,880 --> 00:19:10,540
convergence but not<font color="#E5E5E5"> all good it's</font>

514
00:19:08,800 --> 00:19:12,550
important to look out for that tenth of

515
00:19:10,540 --> 00:19:14,770
<font color="#E5E5E5">one percent to actually see see</font><font color="#CCCCCC"> what</font>

516
00:19:12,550 --> 00:19:17,320
they're doing let's sort of drill down

517
00:19:14,770 --> 00:19:18,879
<font color="#CCCCCC">and sort of figure out what's going on</font>

518
00:19:17,320 --> 00:19:21,639
<font color="#CCCCCC">with those inconsistencies which</font>

519
00:19:18,880 --> 00:19:25,180
prefixes are being<font color="#CCCCCC"> consistent</font><font color="#E5E5E5"> for how</font>

520
00:19:21,640 --> 00:19:27,610
long okay so what<font color="#E5E5E5"> I've shown here the</font>

521
00:19:25,180 --> 00:19:29,560
way to read this graph is on the on the

522
00:19:27,610 --> 00:19:32,169
<font color="#CCCCCC">x axis I have</font><font color="#E5E5E5"> percentage of time so</font>

523
00:19:29,560 --> 00:19:36,000
that's duration of time for the trace so

524
00:19:32,170 --> 00:19:39,370
and it's a log scale so 10 to the 0 ie

525
00:19:36,000 --> 00:19:42,210
one percent that would be like two hours

526
00:19:39,370 --> 00:19:45,489
roughly and<font color="#E5E5E5"> 10 to the minus</font><font color="#CCCCCC"> two is</font>

527
00:19:42,210 --> 00:19:48,420
essentially a minute right so if we read

528
00:19:45,490 --> 00:19:53,940
up from for<font color="#CCCCCC"> example 10</font><font color="#E5E5E5"> to the minus</font><font color="#CCCCCC"> two</font>

529
00:19:48,420 --> 00:19:56,650
we<font color="#E5E5E5"> can see that you for this pier</font>

530
00:19:53,940 --> 00:19:59,320
eighty-five percent of

531
00:19:56,650 --> 00:20:02,940
the<font color="#CCCCCC"> BGP routes or eighty five percent of</font>

532
00:19:59,320 --> 00:20:05,200
the prefixes had less<font color="#E5E5E5"> than a minute</font>

533
00:20:02,940 --> 00:20:07,420
during the entire week for which they

534
00:20:05,200 --> 00:20:09,160
were inconsistent in the sense that they

535
00:20:07,420 --> 00:20:10,660
weren't being advertised at all peering

536
00:20:09,160 --> 00:20:14,680
points that's what missing means in this

537
00:20:10,660 --> 00:20:16,060
case<font color="#E5E5E5"> okay um you can read up for example</font>

538
00:20:14,680 --> 00:20:18,850
from two hours right and it's basically

539
00:20:16,060 --> 00:20:22,659
<font color="#E5E5E5">like in</font><font color="#CCCCCC"> ninety five</font><font color="#E5E5E5"> percent of the</font>

540
00:20:18,850 --> 00:20:24,459
prefixes were consistent for all but two

541
00:20:22,660 --> 00:20:26,980
<font color="#E5E5E5">hours of the</font><font color="#CCCCCC"> week long trace that</font><font color="#E5E5E5"> we</font>

542
00:20:24,460 --> 00:20:28,360
looked at<font color="#E5E5E5"> okay so you you might</font><font color="#CCCCCC"> be</font>

543
00:20:26,980 --> 00:20:30,670
thinking like is this just a

544
00:20:28,360 --> 00:20:33,669
<font color="#E5E5E5">well-behaved pier right what</font><font color="#CCCCCC"> about other</font>

545
00:20:30,670 --> 00:20:34,870
peers well<font color="#CCCCCC"> I did take the ibgp technique</font>

546
00:20:33,670 --> 00:20:37,120
that I described<font color="#CCCCCC"> to you earlier in</font><font color="#E5E5E5"> the</font>

547
00:20:34,870 --> 00:20:38,979
talk and for those appears where we

548
00:20:37,120 --> 00:20:40,659
didn't have<font color="#CCCCCC"> a BGP fees that we could</font>

549
00:20:38,980 --> 00:20:44,320
look at we looked at some of<font color="#E5E5E5"> the ibgp</font>

550
00:20:40,660 --> 00:20:46,090
stuff and most of the<font color="#E5E5E5"> peers look like</font>

551
00:20:44,320 --> 00:20:47,500
the one I just showed<font color="#E5E5E5"> you so for the</font>

552
00:20:46,090 --> 00:20:50,080
graphs that we<font color="#E5E5E5"> just looked at in detail</font>

553
00:20:47,500 --> 00:20:54,130
with the missing and the different a

554
00:20:50,080 --> 00:20:55,570
spat length that's shown here<font color="#CCCCCC"> as pr3 the</font>

555
00:20:54,130 --> 00:20:57,700
<font color="#CCCCCC">Green Line</font><font color="#E5E5E5"> so what I've shown here is I</font>

556
00:20:55,570 --> 00:20:59,710
basically combined both cases<font color="#E5E5E5"> of</font>

557
00:20:57,700 --> 00:21:01,360
inconsistency different<font color="#E5E5E5"> ask path lengths</font>

558
00:20:59,710 --> 00:21:03,160
or not advertised at all peering points

559
00:21:01,360 --> 00:21:05,439
and just call that an<font color="#E5E5E5"> inconsistency in</font>

560
00:21:03,160 --> 00:21:09,910
this graph so again you can read this

561
00:21:05,440 --> 00:21:13,360
graph in the same way um so up here

562
00:21:09,910 --> 00:21:15,460
basically means<font color="#CCCCCC"> that you know most like</font>

563
00:21:13,360 --> 00:21:17,020
almost all the time like these prefixes

564
00:21:15,460 --> 00:21:18,940
are consistent and<font color="#E5E5E5"> down here you've got</font>

565
00:21:17,020 --> 00:21:20,950
<font color="#CCCCCC">a significant fraction of prefixes that</font>

566
00:21:18,940 --> 00:21:25,020
are inconsistent for a large portion<font color="#E5E5E5"> of</font>

567
00:21:20,950 --> 00:21:27,370
time so what's going on<font color="#E5E5E5"> with this this</font>

568
00:21:25,020 --> 00:21:28,540
<font color="#E5E5E5">pr4 well that's probably someone we</font>

569
00:21:27,370 --> 00:21:30,639
should<font color="#E5E5E5"> make a phone call</font><font color="#CCCCCC"> to write</font>

570
00:21:28,540 --> 00:21:33,480
because it looks<font color="#E5E5E5"> like you know about</font>

571
00:21:30,640 --> 00:21:35,740
<font color="#E5E5E5">fifteen percent of the time I'm sorry</font>

572
00:21:33,480 --> 00:21:38,920
<font color="#E5E5E5">fifteen percent of the prefixes are</font>

573
00:21:35,740 --> 00:21:40,330
inconsistent for more<font color="#E5E5E5"> than seventy</font>

574
00:21:38,920 --> 00:21:43,330
percent of<font color="#E5E5E5"> the trace that's like five</font>

575
00:21:40,330 --> 00:21:46,830
days out<font color="#E5E5E5"> of seven days fifteen percent</font>

576
00:21:43,330 --> 00:21:51,760
of these prefixes are inconsistent

577
00:21:46,830 --> 00:21:54,909
that's<font color="#E5E5E5"> probably not convergence okay so</font>

578
00:21:51,760 --> 00:21:56,500
just in conclusion these settlement free

579
00:21:54,910 --> 00:21:58,330
peering arrangements are occasionally

580
00:21:56,500 --> 00:22:01,660
violated most of these violations we can

581
00:21:58,330 --> 00:22:04,090
<font color="#E5E5E5">explain away with convergence but there</font>

582
00:22:01,660 --> 00:22:05,350
<font color="#E5E5E5">are a</font><font color="#CCCCCC"> few significant cases where it's</font>

583
00:22:04,090 --> 00:22:08,169
probably worth looking to see if you

584
00:22:05,350 --> 00:22:10,030
have<font color="#E5E5E5"> this type of thing and you know if</font>

585
00:22:08,170 --> 00:22:10,690
it's<font color="#E5E5E5"> actually affecting the</font><font color="#CCCCCC"> way your</font>

586
00:22:10,030 --> 00:22:13,600
routing traffic

587
00:22:10,690 --> 00:22:15,400
some severe way so I did describe for

588
00:22:13,600 --> 00:22:16,899
<font color="#E5E5E5">the first half of the talk some way that</font>

589
00:22:15,400 --> 00:22:19,300
you can<font color="#E5E5E5"> actually detect these these</font>

590
00:22:16,900 --> 00:22:22,360
violations without you no modifications

591
00:22:19,300 --> 00:22:24,639
to routers or having<font color="#CCCCCC"> to have packet</font>

592
00:22:22,360 --> 00:22:26,919
dumps on all your ebgp sessions you<font color="#E5E5E5"> can</font>

593
00:22:24,640 --> 00:22:29,260
do this with simple ibgp monitoring for

594
00:22:26,920 --> 00:22:30,910
a lot of cases of course if we had this

595
00:22:29,260 --> 00:22:33,210
monitoring protocol that dumped the ebgp

596
00:22:30,910 --> 00:22:35,440
routes this problem would<font color="#CCCCCC"> be really easy</font>

597
00:22:33,210 --> 00:22:39,280
so there<font color="#E5E5E5"> are a lot of people from</font><font color="#CCCCCC"> cisco</font>

598
00:22:35,440 --> 00:22:41,230
here and<font color="#CCCCCC"> i hope</font><font color="#E5E5E5"> they heard</font><font color="#CCCCCC"> that so</font>

599
00:22:39,280 --> 00:22:42,850
another thing to take note of is it you

600
00:22:41,230 --> 00:22:45,670
know there<font color="#CCCCCC"> are there are</font><font color="#E5E5E5"> quite a few of</font>

601
00:22:42,850 --> 00:22:49,240
these inconsistencies thousands in a

602
00:22:45,670 --> 00:22:51,100
week-long period and most of<font color="#E5E5E5"> the time</font>

603
00:22:49,240 --> 00:22:53,530
<font color="#E5E5E5">and then for the things that we that</font><font color="#CCCCCC"> we</font>

604
00:22:51,100 --> 00:22:55,120
observed the inconsistencies that we

605
00:22:53,530 --> 00:22:57,670
observed were mostly due to missing

606
00:22:55,120 --> 00:22:59,469
missing routes ie route not being

607
00:22:57,670 --> 00:23:00,760
advertised at appearing point where it

608
00:22:59,470 --> 00:23:04,360
should have<font color="#E5E5E5"> been rather than different</font>

609
00:23:00,760 --> 00:23:06,310
is path lengths most of the time piers

610
00:23:04,360 --> 00:23:09,189
seem to be<font color="#CCCCCC"> well-behaved but</font><font color="#E5E5E5"> there are</font>

611
00:23:06,310 --> 00:23:10,960
some peers that we should watch out<font color="#CCCCCC"> for</font>

612
00:23:09,190 --> 00:23:12,760
as I<font color="#CCCCCC"> mentioned there</font><font color="#E5E5E5"> is one case we</font>

613
00:23:10,960 --> 00:23:14,470
observed where more<font color="#CCCCCC"> than fifteen percent</font>

614
00:23:12,760 --> 00:23:16,360
of the prefixes were inconsistent for

615
00:23:14,470 --> 00:23:21,510
you know five days out of out<font color="#CCCCCC"> of seven</font>

616
00:23:16,360 --> 00:23:21,510
days so thanks for listening

617
00:23:27,780 --> 00:23:34,030
we've time for a five to seven minutes

618
00:23:30,430 --> 00:23:35,890
sure as we were<font color="#CCCCCC"> talking about yesterday</font>

619
00:23:34,030 --> 00:23:39,220
internal one of the things that<font color="#E5E5E5"> we said</font>

620
00:23:35,890 --> 00:23:40,560
we've seen is when you give Abby you're

621
00:23:39,220 --> 00:23:43,540
supposed<font color="#E5E5E5"> to introduce yourself ah</font>

622
00:23:40,560 --> 00:23:44,740
obviously thing about my one of the

623
00:23:43,540 --> 00:23:47,710
things that<font color="#E5E5E5"> we've seen is when you give</font>

624
00:23:44,740 --> 00:23:50,020
customers flexible flexibility by giving

625
00:23:47,710 --> 00:23:52,060
them communities they can cause

626
00:23:50,020 --> 00:23:54,340
inconsistent announcements<font color="#E5E5E5"> so on your</font>

627
00:23:52,060 --> 00:23:56,770
slide you showed no export for example

628
00:23:54,340 --> 00:23:58,720
if you have<font color="#CCCCCC"> a</font><font color="#E5E5E5"> pn</font><font color="#CCCCCC"> i only community and</font>

629
00:23:56,770 --> 00:24:01,360
you happen<font color="#E5E5E5"> to appear with one is you</font>

630
00:23:58,720 --> 00:24:03,490
know you know not at p ni and P&I

631
00:24:01,360 --> 00:24:07,240
elsewhere that'll cause<font color="#CCCCCC"> inconsistency</font>

632
00:24:03,490 --> 00:24:09,280
and if you take<font color="#CCCCCC"> a</font><font color="#E5E5E5"> look at</font><font color="#CCCCCC"> a lot of</font>

633
00:24:07,240 --> 00:24:10,960
policies you can<font color="#E5E5E5"> actually look at some</font>

634
00:24:09,280 --> 00:24:12,670
of<font color="#E5E5E5"> the larger transit providers you</font>

635
00:24:10,960 --> 00:24:14,950
could construct ways to do this

636
00:24:12,670 --> 00:24:16,480
inconsistency but it is those larger

637
00:24:14,950 --> 00:24:17,710
transit providers who are generally the

638
00:24:16,480 --> 00:24:20,290
ones most interested<font color="#E5E5E5"> in getting</font>

639
00:24:17,710 --> 00:24:22,090
consistency so in many of those cases if

640
00:24:20,290 --> 00:24:25,620
they just set up you know peering<font color="#E5E5E5"> to</font>

641
00:24:22,090 --> 00:24:28,149
<font color="#E5E5E5">zebra boxes to do internal monitoring of</font>

642
00:24:25,620 --> 00:24:29,469
customers you know applying policy that

643
00:24:28,150 --> 00:24:37,180
<font color="#E5E5E5">causing consistency that might actually</font>

644
00:24:29,470 --> 00:24:39,960
help that's a<font color="#E5E5E5"> good idea</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> question sure</font>

645
00:24:37,180 --> 00:24:42,010
so you know<font color="#CCCCCC"> i understand something</font><font color="#E5E5E5"> i</font>

646
00:24:39,960 --> 00:24:44,260
understand some the limitations of

647
00:24:42,010 --> 00:24:46,120
incurring via ibgp it sounds like the

648
00:24:44,260 --> 00:24:48,190
real problem you're trying to solve is

649
00:24:46,120 --> 00:24:49,510
really understand if someone is going to

650
00:24:48,190 --> 00:24:52,060
<font color="#CCCCCC">built-in</font><font color="#E5E5E5"> upon someone intentionally</font>

651
00:24:49,510 --> 00:24:53,890
gaming you or redirecting traffic flows

652
00:24:52,060 --> 00:24:55,629
and it sounds<font color="#E5E5E5"> like it might be actually</font>

653
00:24:53,890 --> 00:24:57,550
easier to<font color="#E5E5E5"> do something actually looking</font>

654
00:24:55,630 --> 00:24:59,320
at<font color="#E5E5E5"> the traffic itself that's chosen if</font>

655
00:24:57,550 --> 00:25:02,590
you can't get a real live you know

656
00:24:59,320 --> 00:25:04,590
adjacency ribbon feed perhaps looking at

657
00:25:02,590 --> 00:25:06,340
the IPS from via net flow or other

658
00:25:04,590 --> 00:25:08,949
measurements and actually seeing the

659
00:25:06,340 --> 00:25:12,159
actual traffic chosen or selected on<font color="#CCCCCC"> the</font>

660
00:25:08,950 --> 00:25:14,170
outbound interface you know that is that

661
00:25:12,160 --> 00:25:17,560
is a good idea<font color="#CCCCCC"> and it's another way</font><font color="#E5E5E5"> to</font>

662
00:25:14,170 --> 00:25:20,260
look at it and that's<font color="#CCCCCC"> the problem</font><font color="#E5E5E5"> is</font>

663
00:25:17,560 --> 00:25:22,480
probably worth exploring I expect that<font color="#E5E5E5"> I</font>

664
00:25:20,260 --> 00:25:25,540
mean one one good<font color="#E5E5E5"> reason to look at the</font>

665
00:25:22,480 --> 00:25:27,580
routes is because it's pretty easy to

666
00:25:25,540 --> 00:25:30,370
separate the cases<font color="#CCCCCC"> of convergence versus</font>

667
00:25:27,580 --> 00:25:33,010
those that are that are that are clearly

668
00:25:30,370 --> 00:25:34,360
not convergent so I'd be interested to

669
00:25:33,010 --> 00:25:37,560
see if you could do the same thing<font color="#E5E5E5"> from</font>

670
00:25:34,360 --> 00:25:40,418
traffic is this just a transient like

671
00:25:37,560 --> 00:25:43,928
traffic fluctuation<font color="#CCCCCC"> caused</font>

672
00:25:40,419 --> 00:25:46,059
I you know a change in demand or is it

673
00:25:43,929 --> 00:25:47,649
due to the way I'm sampling my net flow

674
00:25:46,059 --> 00:25:48,789
or is this actually something I should

675
00:25:47,649 --> 00:25:58,320
be worried about<font color="#E5E5E5"> and you probably could</font>

676
00:25:48,789 --> 00:26:02,009
do it with with traffic to anyone else

677
00:25:58,320 --> 00:26:02,009
<font color="#CCCCCC">Thanks thank you</font>

