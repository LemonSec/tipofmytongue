1
00:00:00,050 --> 00:00:05,460
<font color="#E5E5E5">I'll be given this tutorial lessons</font>

2
00:00:03,929 --> 00:00:08,160
<font color="#E5E5E5">learned as a small network operator</font>

3
00:00:05,460 --> 00:00:10,440
things I've picked up on through various

4
00:00:08,160 --> 00:00:12,780
different nanog presentations that have

5
00:00:10,440 --> 00:00:16,439
<font color="#E5E5E5">made a huge difference in life as a</font>

6
00:00:12,780 --> 00:00:18,000
network operator agenda<font color="#E5E5E5"> what we're going</font>

7
00:00:16,440 --> 00:00:20,609
to cover hopefully these slides are up

8
00:00:18,000 --> 00:00:23,490
on the website by now overview and

9
00:00:20,609 --> 00:00:27,029
background where I'm coming from basics

10
00:00:23,490 --> 00:00:30,359
of our pop architecture a focus on<font color="#CCCCCC"> igp</font>

11
00:00:27,029 --> 00:00:33,329
followed by bgp then mpls traffic

12
00:00:30,359 --> 00:00:36,329
engineering some pointers on monitoring

13
00:00:33,329 --> 00:00:39,660
and a few other random items from there

14
00:00:36,329 --> 00:00:42,300
so email addresses there if you have any

15
00:00:39,660 --> 00:00:43,709
questions afterward feel free to track

16
00:00:42,300 --> 00:00:50,399
me down and ask whatever you'd like<font color="#E5E5E5"> to</font>

17
00:00:43,710 --> 00:00:52,379
know up until basically last month maybe

18
00:00:50,399 --> 00:00:54,530
<font color="#E5E5E5">even this month I was in a hybrid</font>

19
00:00:52,379 --> 00:00:58,050
engineering<font color="#CCCCCC"> an OPS position for a small</font>

20
00:00:54,530 --> 00:01:00,000
telecom<font color="#E5E5E5"> and isp in</font><font color="#CCCCCC"> Texas recent we were</font>

21
00:00:58,050 --> 00:01:02,280
<font color="#E5E5E5">recently acquired so now I'm strictly in</font>

22
00:01:00,000 --> 00:01:05,489
the<font color="#E5E5E5"> engineering department this in the</font>

23
00:01:02,280 --> 00:01:08,670
sense has increased the traffic that<font color="#E5E5E5"> I</font>

24
00:01:05,489 --> 00:01:11,270
deal with by a factor of six so<font color="#E5E5E5"> we'll</font>

25
00:01:08,670 --> 00:01:13,290
see what all changes going<font color="#E5E5E5"> forward</font>

26
00:01:11,270 --> 00:01:16,710
general objective<font color="#E5E5E5"> when you're doing</font>

27
00:01:13,290 --> 00:01:18,240
network design keep things simple Dave

28
00:01:16,710 --> 00:01:20,460
Meyer said somewhere along the line be

29
00:01:18,240 --> 00:01:22,939
realistic about the trade-off between

30
00:01:20,460 --> 00:01:26,039
complexity and operational expenditures

31
00:01:22,939 --> 00:01:28,408
and I simply say be<font color="#E5E5E5"> realistic about your</font>

32
00:01:26,040 --> 00:01:31,170
network complexity no matter what if

33
00:01:28,409 --> 00:01:33,240
it's simple it's easier for various

34
00:01:31,170 --> 00:01:35,250
people to troubleshoot if it's simple

35
00:01:33,240 --> 00:01:37,470
the<font color="#E5E5E5"> network will scale and if it's</font>

36
00:01:35,250 --> 00:01:41,810
simple you can go to nanog and take

37
00:01:37,470 --> 00:01:43,649
other vacations without a lot<font color="#E5E5E5"> of stress</font>

38
00:01:41,810 --> 00:01:45,750
whenever you're doing engineering

39
00:01:43,649 --> 00:01:48,840
troubleshooting or anything to do with

40
00:01:45,750 --> 00:01:50,820
your<font color="#E5E5E5"> network think like a router think</font>

41
00:01:48,840 --> 00:01:53,939
through what how will this router deal

42
00:01:50,820 --> 00:01:57,689
with packet processing sequence how will

43
00:01:53,939 --> 00:01:59,189
it forward this packet on a packet by

44
00:01:57,689 --> 00:02:01,169
packet basis and then work your way

45
00:01:59,189 --> 00:02:05,880
through your<font color="#E5E5E5"> network</font><font color="#CCCCCC"> on a router by</font>

46
00:02:01,170 --> 00:02:09,209
router basis as<font color="#E5E5E5"> I coach knock people and</font>

47
00:02:05,880 --> 00:02:11,490
other operations staff on how to figure

48
00:02:09,209 --> 00:02:14,490
<font color="#E5E5E5">out what's going on at this moment</font>

49
00:02:11,490 --> 00:02:21,330
this type of analysis comes in very key

50
00:02:14,490 --> 00:02:23,580
for them so six years ago came into a

51
00:02:21,330 --> 00:02:26,130
job working with for routers just one

52
00:02:23,580 --> 00:02:27,960
router / pop ds3 is tying it all

53
00:02:26,130 --> 00:02:30,120
together but<font color="#CCCCCC"> we're doing</font><font color="#E5E5E5"> a whopping</font><font color="#CCCCCC"> 5</font>

54
00:02:27,960 --> 00:02:35,160
megabits to the<font color="#E5E5E5"> internet over</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> next</font>

55
00:02:30,120 --> 00:02:38,880
three years<font color="#E5E5E5"> we grew to 35 routers lots</font>

56
00:02:35,160 --> 00:02:40,560
of ds3 s200 megabits total and we've

57
00:02:38,880 --> 00:02:44,130
slowed down since then but it<font color="#E5E5E5"> has grown</font>

58
00:02:40,560 --> 00:02:46,620
another 50 megs at peak we're back down

59
00:02:44,130 --> 00:02:49,650
around<font color="#CCCCCC"> 200 recently but that's</font><font color="#E5E5E5"> about</font>

60
00:02:46,620 --> 00:02:52,260
where we're at for City network our

61
00:02:49,650 --> 00:02:54,240
internet pipes were just 41 s<font color="#CCCCCC"> 2 cable</font>

62
00:02:52,260 --> 00:02:56,579
and wireless cable and wireless

63
00:02:54,240 --> 00:02:58,860
statically routed to us we had default

64
00:02:56,580 --> 00:03:01,830
routes everything within the network was

65
00:02:58,860 --> 00:03:03,270
static and corporate offices were

66
00:03:01,830 --> 00:03:08,490
getting to the internet<font color="#CCCCCC"> through a pretty</font>

67
00:03:03,270 --> 00:03:10,260
scary process of<font color="#E5E5E5"> NAT and those</font><font color="#CCCCCC"> four</font>

68
00:03:08,490 --> 00:03:14,580
routers in the<font color="#E5E5E5"> Pops were</font><font color="#CCCCCC"> riverstone</font>

69
00:03:10,260 --> 00:03:16,140
which nobody knew and this was a

70
00:03:14,580 --> 00:03:18,930
challenge from<font color="#E5E5E5"> it from a support</font>

71
00:03:16,140 --> 00:03:20,880
perspective from a design and

72
00:03:18,930 --> 00:03:23,490
architecture perspective and even bit us

73
00:03:20,880 --> 00:03:25,650
from a sales perspective sales people

74
00:03:23,490 --> 00:03:28,020
would get asked the typical question are

75
00:03:25,650 --> 00:03:29,910
<font color="#E5E5E5">you guys using cisco or juniper and</font>

76
00:03:28,020 --> 00:03:33,000
they'd have to say no we're using

77
00:03:29,910 --> 00:03:36,990
<font color="#CCCCCC">riverstone and the customer would follow</font>

78
00:03:33,000 --> 00:03:40,560
with who's that so we started planning

79
00:03:36,990 --> 00:03:42,240
our upgrades after we ran into flow

80
00:03:40,560 --> 00:03:44,610
routing limitations of the river stones

81
00:03:42,240 --> 00:03:46,650
and everything you're<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to see and</font>

82
00:03:44,610 --> 00:03:49,970
the rest of this presentation is what we

83
00:03:46,650 --> 00:03:52,110
<font color="#CCCCCC">use to get us to where we are today so</font>

84
00:03:49,970 --> 00:03:55,859
we're whenever you're looking<font color="#E5E5E5"> at your</font>

85
00:03:52,110 --> 00:03:57,720
router obviously any<font color="#E5E5E5"> network pretty much</font>

86
00:03:55,860 --> 00:04:00,180
starts with one you might<font color="#E5E5E5"> run out of</font>

87
00:03:57,720 --> 00:04:02,130
slots you might run on a memory you

88
00:04:00,180 --> 00:04:06,690
might<font color="#CCCCCC"> find yourself tapped out on CPU</font>

89
00:04:02,130 --> 00:04:08,130
resources as you plan to upgrade you're

90
00:04:06,690 --> 00:04:10,560
going to find<font color="#E5E5E5"> it you need</font><font color="#CCCCCC"> to become an</font>

91
00:04:08,130 --> 00:04:13,440
expert on the different routers you may

92
00:04:10,560 --> 00:04:18,630
select we learned very hard<font color="#E5E5E5"> that we had</font>

93
00:04:13,440 --> 00:04:22,350
to become<font color="#E5E5E5"> quite well versed in memory</font>

94
00:04:18,630 --> 00:04:23,640
errors on<font color="#CCCCCC"> Cisco VIP tubes once we</font>

95
00:04:22,350 --> 00:04:25,090
learned them we knew whether it was bad

96
00:04:23,640 --> 00:04:26,650
memory or bad VIP

97
00:04:25,090 --> 00:04:28,989
we knew what had<font color="#CCCCCC"> to be</font><font color="#E5E5E5"> replaced and were</font>

98
00:04:26,650 --> 00:04:31,000
able to<font color="#E5E5E5"> get past our problems so they</font>

99
00:04:28,990 --> 00:04:34,500
didn't recur<font color="#CCCCCC"> and impact our customers</font>

100
00:04:31,000 --> 00:04:36,729
going<font color="#E5E5E5"> forward we continue to learn about</font>

101
00:04:34,500 --> 00:04:39,820
implications of different GSR engine

102
00:04:36,729 --> 00:04:44,320
revisions and continue to<font color="#E5E5E5"> get bitten by</font>

103
00:04:39,820 --> 00:04:49,060
little limitations in catalyst 6500 line

104
00:04:44,320 --> 00:04:51,040
cards and those wonderful concepts of

105
00:04:49,060 --> 00:04:54,340
redundancy everyone wants to hear<font color="#E5E5E5"> the</font>

106
00:04:51,040 --> 00:04:56,650
<font color="#E5E5E5">geb redundant</font><font color="#CCCCCC"> Network and multiple</font>

107
00:04:54,340 --> 00:04:59,349
routers don't ensure that you've gotten

108
00:04:56,650 --> 00:05:02,979
redundancy proper design using those

109
00:04:59,350 --> 00:05:04,930
routers is key if you've<font color="#E5E5E5"> got one router</font>

110
00:05:02,979 --> 00:05:07,950
in service and you decide to add router

111
00:05:04,930 --> 00:05:10,270
to is merely a child of router one

112
00:05:07,950 --> 00:05:13,360
router to is completely<font color="#CCCCCC"> dependent on</font>

113
00:05:10,270 --> 00:05:17,560
router one and you've made things worse

114
00:05:13,360 --> 00:05:20,760
not better so our initial design

115
00:05:17,560 --> 00:05:22,930
involved a two-tier model essentially a

116
00:05:20,760 --> 00:05:26,050
upper layer that handled all the

117
00:05:22,930 --> 00:05:28,449
interconnections between sites and<font color="#E5E5E5"> also</font>

118
00:05:26,050 --> 00:05:31,120
our connectivity up to the internet we

119
00:05:28,449 --> 00:05:33,130
continue to be fed merely by transit

120
00:05:31,120 --> 00:05:35,320
connections the<font color="#E5E5E5"> lower tier a</font>

121
00:05:33,130 --> 00:05:38,200
distribution tier handled all of our

122
00:05:35,320 --> 00:05:40,990
customer connections to some degree we

123
00:05:38,200 --> 00:05:44,050
aimed for distinct routers suited for

124
00:05:40,990 --> 00:05:45,520
particular connection types ideally and

125
00:05:44,050 --> 00:05:47,919
this is where we're heading it wasn't

126
00:05:45,520 --> 00:05:49,570
this way in the beginning one type<font color="#CCCCCC"> of</font>

127
00:05:47,919 --> 00:05:51,909
router for fractional and full t ones

128
00:05:49,570 --> 00:05:55,599
another type of router for ds3<font color="#E5E5E5"> and</font>

129
00:05:51,910 --> 00:05:58,030
larger<font color="#E5E5E5"> ran technologies OC 3 and so on</font>

130
00:05:55,599 --> 00:06:02,380
<font color="#E5E5E5">and then one type</font><font color="#CCCCCC"> of router for</font><font color="#E5E5E5"> Ethernet</font>

131
00:05:58,030 --> 00:06:05,020
services so looking at our initial core

132
00:06:02,380 --> 00:06:07,330
design to tie all these routers together

133
00:06:05,020 --> 00:06:09,130
whether you know obviously two core

134
00:06:07,330 --> 00:06:12,010
routers per city based on our redundancy

135
00:06:09,130 --> 00:06:14,710
<font color="#E5E5E5">goals and then one or more customer</font>

136
00:06:12,010 --> 00:06:17,409
connection routers we use two parallel

137
00:06:14,710 --> 00:06:20,580
<font color="#E5E5E5">lands to tie these together so two</font>

138
00:06:17,410 --> 00:06:23,470
separate<font color="#E5E5E5"> Ethernet switches to provide</font>

139
00:06:20,580 --> 00:06:25,330
essentially backbone redundancy each of

140
00:06:23,470 --> 00:06:27,070
the core routers connected to both lands

141
00:06:25,330 --> 00:06:29,560
each of the distribution router is

142
00:06:27,070 --> 00:06:31,840
connected to both lands and that got us

143
00:06:29,560 --> 00:06:34,900
<font color="#E5E5E5">going it started in our first pop and</font>

144
00:06:31,840 --> 00:06:37,690
continued thereafter and here's a

145
00:06:34,900 --> 00:06:38,859
representation of what we had so all the

146
00:06:37,690 --> 00:06:43,539
different routers became

147
00:06:38,860 --> 00:06:46,139
pretty much similar icons within our

148
00:06:43,539 --> 00:06:49,960
model<font color="#CCCCCC"> two switches to tie it together</font>

149
00:06:46,139 --> 00:06:51,550
but we soon ran into issues that the

150
00:06:49,960 --> 00:06:53,710
routers because they're<font color="#E5E5E5"> going through a</font>

151
00:06:51,550 --> 00:06:56,560
multi accessed apology wouldn't be able

152
00:06:53,710 --> 00:07:02,169
<font color="#E5E5E5">to detect when another router lost a</font>

153
00:06:56,560 --> 00:07:04,210
link had a card fail or what have you so

154
00:07:02,169 --> 00:07:08,289
there'd be time you know we have to<font color="#CCCCCC"> wait</font>

155
00:07:04,210 --> 00:07:10,330
for<font color="#E5E5E5"> I GP timers to to timeout and we</font><font color="#CCCCCC"> had</font>

156
00:07:08,289 --> 00:07:13,120
<font color="#E5E5E5">not yet explored much with tweaking</font>

157
00:07:10,330 --> 00:07:14,560
those timers regardless I don't think we

158
00:07:13,120 --> 00:07:18,250
could<font color="#CCCCCC"> have gotten down below</font><font color="#E5E5E5"> three</font>

159
00:07:14,560 --> 00:07:20,080
second failure detection and we weren't

160
00:07:18,250 --> 00:07:21,819
real happy with that especially<font color="#CCCCCC"> because</font>

161
00:07:20,080 --> 00:07:24,460
in the default case we were looking at

162
00:07:21,819 --> 00:07:28,870
<font color="#E5E5E5">40 seconds of black hole until we</font>

163
00:07:24,460 --> 00:07:31,029
detected the failure likewise capacity

164
00:07:28,870 --> 00:07:33,069
<font color="#CCCCCC">issues if the links from those Ethernet</font>

165
00:07:31,029 --> 00:07:35,560
switches<font color="#E5E5E5"> to</font><font color="#CCCCCC"> the various routers were</font>

166
00:07:33,069 --> 00:07:38,860
fast ethernet in some cases in gigabit

167
00:07:35,560 --> 00:07:41,650
in other cases the<font color="#E5E5E5"> sending router would</font>

168
00:07:38,860 --> 00:07:43,719
not know of a bottleneck going to the

169
00:07:41,650 --> 00:07:45,849
receiving router if it was transmitting

170
00:07:43,719 --> 00:07:49,150
on a gig link and and draining out a

171
00:07:45,849 --> 00:07:50,378
fast e link and likewise we had

172
00:07:49,150 --> 00:07:53,888
troubleshooting issues we had a lot of

173
00:07:50,379 --> 00:07:56,199
<font color="#E5E5E5">round robin back at delivery especially</font>

174
00:07:53,889 --> 00:07:58,389
in the case of a link failure quite

175
00:07:56,199 --> 00:08:03,039
unpredictable as to what the path would

176
00:07:58,389 --> 00:08:05,379
be from one router to another so as part

177
00:08:03,039 --> 00:08:07,960
of hardware upgrades putting<font color="#CCCCCC"> GS ours in</font>

178
00:08:05,379 --> 00:08:09,550
the core we worked on transitioning our

179
00:08:07,960 --> 00:08:12,729
topology so that the core router is

180
00:08:09,550 --> 00:08:15,610
connected to each<font color="#E5E5E5"> other so that transit</font>

181
00:08:12,729 --> 00:08:16,839
traffic had a direct<font color="#E5E5E5"> path and then the</font>

182
00:08:15,610 --> 00:08:19,389
core router is connected to each

183
00:08:16,839 --> 00:08:21,580
distribution router so even<font color="#E5E5E5"> though</font>

184
00:08:19,389 --> 00:08:23,050
essentially all<font color="#CCCCCC"> were</font><font color="#E5E5E5"> Ethernet we were</font>

185
00:08:21,580 --> 00:08:25,750
able to<font color="#E5E5E5"> treat them all logically as</font>

186
00:08:23,050 --> 00:08:28,900
point-to-point links and that gave us a

187
00:08:25,750 --> 00:08:31,089
lot<font color="#CCCCCC"> of gains throughout our topology so</font>

188
00:08:28,900 --> 00:08:33,250
here's the representation two cores talk

189
00:08:31,089 --> 00:08:37,088
to each other everything else connects

190
00:08:33,250 --> 00:08:38,708
merely to<font color="#E5E5E5"> the course so now the core</font>

191
00:08:37,089 --> 00:08:42,550
<font color="#E5E5E5">routers no link state to all the other</font>

192
00:08:38,708 --> 00:08:45,069
routers and vice versa and routing

193
00:08:42,549 --> 00:08:50,030
became more predictable and our queuing

194
00:08:45,070 --> 00:08:52,880
became more predictable got us going

195
00:08:50,030 --> 00:08:56,630
gave us what we were looking for<font color="#E5E5E5"> but got</font>

196
00:08:52,880 --> 00:08:58,310
bit by another challenge then because

197
00:08:56,630 --> 00:09:02,270
<font color="#CCCCCC">our upstream connections were on those</font>

198
00:08:58,310 --> 00:09:05,540
core routers so obviously we're so far

199
00:09:02,270 --> 00:09:07,939
as Cisco only shop with in iOS the<font color="#CCCCCC"> bgp</font>

200
00:09:05,540 --> 00:09:11,089
path selection algorithm rule number<font color="#CCCCCC"> 9</font>

201
00:09:07,940 --> 00:09:13,700
says prefer the external bgp path over

202
00:09:11,090 --> 00:09:16,220
the internal bgp path and therefore

203
00:09:13,700 --> 00:09:17,930
inter pop traffic that might<font color="#E5E5E5"> be coming</font>

204
00:09:16,220 --> 00:09:20,060
<font color="#CCCCCC">in from an adjacent pop and then heading</font>

205
00:09:17,930 --> 00:09:22,189
out to the internet would leave by the

206
00:09:20,060 --> 00:09:24,800
logically closest link<font color="#E5E5E5"> unless unless</font>

207
00:09:22,190 --> 00:09:28,010
<font color="#E5E5E5">another link was drastically better so</font>

208
00:09:24,800 --> 00:09:30,740
here's a representation the two routers

209
00:09:28,010 --> 00:09:32,930
in the center are will call it<font color="#CCCCCC"> City one</font>

210
00:09:30,740 --> 00:09:35,570
each<font color="#CCCCCC"> one has an upstream internet</font>

211
00:09:32,930 --> 00:09:37,900
connection and you'll see city two on

212
00:09:35,570 --> 00:09:41,120
the<font color="#E5E5E5"> left and</font><font color="#CCCCCC"> city three on the right and</font>

213
00:09:37,900 --> 00:09:43,790
traffic coming in from city to wanted to

214
00:09:41,120 --> 00:09:47,120
leave by way of core ones upstream since

215
00:09:43,790 --> 00:09:49,520
it was an external<font color="#CCCCCC"> bgp path city two</font>

216
00:09:47,120 --> 00:09:52,640
might have originally chosen a best path

217
00:09:49,520 --> 00:09:56,600
from core two but since each router is

218
00:09:52,640 --> 00:09:58,490
making its own routing decision by doing

219
00:09:56,600 --> 00:10:01,010
its own layer<font color="#CCCCCC"> three look up core one</font>

220
00:09:58,490 --> 00:10:03,470
sends it out sup stream so here's what

221
00:10:01,010 --> 00:10:07,819
we were hoping to<font color="#E5E5E5"> have happen city two</font>

222
00:10:03,470 --> 00:10:10,220
through its full ib ibgp mesh had

223
00:10:07,820 --> 00:10:15,080
selected core tues upstream as its

224
00:10:10,220 --> 00:10:17,600
desired exit point but let me show you

225
00:10:15,080 --> 00:10:20,030
here's what we were seeing as a result

226
00:10:17,600 --> 00:10:22,340
the traffic coming in from city to was

227
00:10:20,030 --> 00:10:25,550
instead going<font color="#E5E5E5"> directly out core one and</font>

228
00:10:22,340 --> 00:10:28,670
the reason<font color="#CCCCCC"> for that is core one prefers</font>

229
00:10:25,550 --> 00:10:32,000
most paths out its external path in core

230
00:10:28,670 --> 00:10:36,170
two prefers both pass out<font color="#E5E5E5"> its external</font>

231
00:10:32,000 --> 00:10:39,050
path in city to those core routers were

232
00:10:36,170 --> 00:10:42,410
learning both paths by an bgp full mesh

233
00:10:39,050 --> 00:10:45,740
and its core routers were selecting a

234
00:10:42,410 --> 00:10:49,209
best path as<font color="#E5E5E5"> city one core two for one</font>

235
00:10:45,740 --> 00:10:51,470
reason of<font color="#E5E5E5"> the most likely oldest route</font>

236
00:10:49,210 --> 00:10:55,190
perhaps a router ID it all depends on

237
00:10:51,470 --> 00:10:56,570
<font color="#CCCCCC">the individual situation so city two was</font>

238
00:10:55,190 --> 00:10:59,120
sending packets destined for that

239
00:10:56,570 --> 00:11:01,040
<font color="#E5E5E5">internet destination towards</font><font color="#CCCCCC"> City one</font>

240
00:10:59,120 --> 00:11:03,340
core one because<font color="#CCCCCC"> that was its next</font><font color="#E5E5E5"> hop</font>

241
00:11:01,040 --> 00:11:06,980
toward<font color="#E5E5E5"> city one</font>

242
00:11:03,340 --> 00:11:09,800
and so as the packets arrive on<font color="#E5E5E5"> City one</font>

243
00:11:06,980 --> 00:11:11,930
core one another IP routing lookup is

244
00:11:09,800 --> 00:11:14,000
performed on the packet and it decides

245
00:11:11,930 --> 00:11:16,280
that it's best drain point is the

246
00:11:14,000 --> 00:11:18,830
upstream link rather than sending it

247
00:11:16,280 --> 00:11:20,120
over to core<font color="#CCCCCC"> 2 in that same city so</font>

248
00:11:18,830 --> 00:11:24,920
that's how we ended<font color="#E5E5E5"> up with this</font>

249
00:11:20,120 --> 00:11:28,190
challenge and<font color="#E5E5E5"> because of our traffic</font>

250
00:11:24,920 --> 00:11:30,469
patterns customer differentiation

251
00:11:28,190 --> 00:11:32,410
between markets and so forth we found

252
00:11:30,470 --> 00:11:35,570
this incredibly difficult tuned as we

253
00:11:32,410 --> 00:11:38,420
grew we<font color="#E5E5E5"> found that our upstream links</font>

254
00:11:35,570 --> 00:11:40,790
typically<font color="#E5E5E5"> on two or three-year contract</font>

255
00:11:38,420 --> 00:11:43,699
terms were becoming increasingly

256
00:11:40,790 --> 00:11:46,370
difficult to<font color="#E5E5E5"> balance well when traffic</font>

257
00:11:43,700 --> 00:11:49,430
<font color="#CCCCCC">was coming in from</font><font color="#E5E5E5"> another city so we</font>

258
00:11:46,370 --> 00:11:52,100
kept our<font color="#E5E5E5"> two layer hierarchy but split</font>

259
00:11:49,430 --> 00:11:55,760
that lower tier into two types of

260
00:11:52,100 --> 00:11:58,550
routers one for customers and still try

261
00:11:55,760 --> 00:12:01,880
to break that up into connection

262
00:11:58,550 --> 00:12:04,339
specific choices and then added edge

263
00:12:01,880 --> 00:12:08,390
routers which hand which we're handling

264
00:12:04,340 --> 00:12:11,570
specifically our upstream connections so

265
00:12:08,390 --> 00:12:14,150
essentially an upside down v when you

266
00:12:11,570 --> 00:12:17,210
look at an architecture redrawing our

267
00:12:14,150 --> 00:12:19,430
core<font color="#CCCCCC"> and edge challenge we've added in</font>

268
00:12:17,210 --> 00:12:22,550
edge routers as a<font color="#E5E5E5"> separate layer from</font>

269
00:12:19,430 --> 00:12:26,089
the<font color="#E5E5E5"> core and now traffic coming in from</font>

270
00:12:22,550 --> 00:12:28,400
city to arrives on core one core one can

271
00:12:26,090 --> 00:12:31,190
<font color="#E5E5E5">make a best path decision both of the</font>

272
00:12:28,400 --> 00:12:33,949
drain points are external so that

273
00:12:31,190 --> 00:12:36,350
decision does<font color="#CCCCCC"> not factor in it probably</font>

274
00:12:33,950 --> 00:12:38,270
falls down to oldest route and can now

275
00:12:36,350 --> 00:12:42,890
choose to send it to the right<font color="#CCCCCC"> edge</font>

276
00:12:38,270 --> 00:12:45,500
router and go out that connection and it

277
00:12:42,890 --> 00:12:50,000
was a for us a fairly<font color="#CCCCCC"> small capex in</font>

278
00:12:45,500 --> 00:12:52,670
order to realize significant operational

279
00:12:50,000 --> 00:12:54,830
cost savings because we didn't have<font color="#E5E5E5"> to</font>

280
00:12:52,670 --> 00:12:58,939
<font color="#E5E5E5">upgrade pipe sizes just because of an</font>

281
00:12:54,830 --> 00:13:00,680
inability to tune them knowing that

282
00:12:58,940 --> 00:13:09,830
another pipe might end up becoming less

283
00:13:00,680 --> 00:13:13,099
used due to its term length so split the

284
00:13:09,830 --> 00:13:14,510
upstream and downstream roles and remain

285
00:13:13,100 --> 00:13:16,089
<font color="#CCCCCC">with the topology where each</font>

286
00:13:14,510 --> 00:13:18,300
distribution router and each

287
00:13:16,089 --> 00:13:21,279
edge router only connects to the course

288
00:13:18,300 --> 00:13:24,579
there was an alternate fix that we ended

289
00:13:21,279 --> 00:13:27,399
up upon as a result of deploying MPLS in

290
00:13:24,579 --> 00:13:29,739
the backbone but didn't<font color="#CCCCCC"> know ahead of</font>

291
00:13:27,399 --> 00:13:32,800
time this<font color="#E5E5E5"> would have fixed it for us had</font>

292
00:13:29,740 --> 00:13:34,809
we deployed MPLS upon the packet coming

293
00:13:32,800 --> 00:13:37,540
in from the customer heading towards<font color="#CCCCCC"> the</font>

294
00:13:34,809 --> 00:13:38,860
internet that inbound distribution

295
00:13:37,540 --> 00:13:42,099
router would<font color="#E5E5E5"> have done its own IP lookup</font>

296
00:13:38,860 --> 00:13:43,629
having full tables on hand and would

297
00:13:42,100 --> 00:13:46,540
have found<font color="#E5E5E5"> the best egress point and</font>

298
00:13:43,629 --> 00:13:48,100
potentially<font color="#CCCCCC"> even interface and would</font>

299
00:13:46,540 --> 00:13:50,769
have applied<font color="#E5E5E5"> to label corresponding that</font>

300
00:13:48,100 --> 00:13:53,829
exit point the core routers all

301
00:13:50,769 --> 00:13:56,499
throughout<font color="#CCCCCC"> the middle of</font><font color="#E5E5E5"> the path would</font>

302
00:13:53,829 --> 00:13:58,689
afforded solely based on label directly

303
00:13:56,499 --> 00:14:01,089
through core<font color="#CCCCCC"> 1 and hopping it over to</font>

304
00:13:58,689 --> 00:14:03,009
core two and then core two would<font color="#E5E5E5"> have</font>

305
00:14:01,089 --> 00:14:08,410
done it Siegrist decision and sent it

306
00:14:03,009 --> 00:14:11,559
out that direction so on to selecting an

307
00:14:08,410 --> 00:14:13,899
igp for choices<font color="#E5E5E5"> we ruled out rip v2 it</font>

308
00:14:11,559 --> 00:14:15,430
needs to be dead we were running

309
00:14:13,899 --> 00:14:20,050
<font color="#CCCCCC">riverstone so that</font><font color="#E5E5E5"> immediately</font>

310
00:14:15,430 --> 00:14:24,519
eliminated eigrp<font color="#E5E5E5"> and gave us two choices</font>

311
00:14:20,050 --> 00:14:26,229
<font color="#CCCCCC">OSPF and ISS and perhaps selfishly but</font>

312
00:14:24,519 --> 00:14:28,589
since I was the one it was tasked with

313
00:14:26,230 --> 00:14:31,990
<font color="#E5E5E5">putting in some form of dynamic routing</font>

314
00:14:28,589 --> 00:14:33,160
our selection was<font color="#CCCCCC"> OSPF considering that</font>

315
00:14:31,990 --> 00:14:36,399
<font color="#E5E5E5">at the time we were completely</font>

316
00:14:33,160 --> 00:14:37,839
statically routed the person who had

317
00:14:36,399 --> 00:14:40,059
been maintaining the network prior to me

318
00:14:37,839 --> 00:14:43,269
<font color="#E5E5E5">whenever there was a intercity link</font>

319
00:14:40,059 --> 00:14:45,939
failure would hop into routers through

320
00:14:43,269 --> 00:14:47,999
back doors and console connections and

321
00:14:45,939 --> 00:14:51,519
do static routes to patch around<font color="#E5E5E5"> it and</font>

322
00:14:47,999 --> 00:14:54,009
<font color="#E5E5E5">inevitably through whatever magic he was</font>

323
00:14:51,519 --> 00:14:55,629
using<font color="#E5E5E5"> the pick those static routes when</font>

324
00:14:54,009 --> 00:14:58,360
our internet connections came back up

325
00:14:55,629 --> 00:15:01,509
those particular affected cities were

326
00:14:58,360 --> 00:15:07,629
black hold again until he removed all of

327
00:15:01,509 --> 00:15:10,179
<font color="#E5E5E5">his band aids so over time we switched</font>

328
00:15:07,629 --> 00:15:14,730
to is<font color="#E5E5E5"> is three supposed benefits</font>

329
00:15:10,179 --> 00:15:17,439
stability on<font color="#CCCCCC"> the premise that the</font>

330
00:15:14,730 --> 00:15:22,689
various hardware and software router

331
00:15:17,439 --> 00:15:25,049
engineers were being very careful<font color="#E5E5E5"> with</font>

332
00:15:22,689 --> 00:15:27,399
change management in there is<font color="#E5E5E5"> is code</font>

333
00:15:25,049 --> 00:15:29,079
can't<font color="#E5E5E5"> really say that gained as much of</font>

334
00:15:27,399 --> 00:15:31,840
anything<font color="#E5E5E5"> per se</font>

335
00:15:29,080 --> 00:15:34,000
protection in that there'd be no CL NS

336
00:15:31,840 --> 00:15:37,270
packets coming in from customers or

337
00:15:34,000 --> 00:15:41,230
providers<font color="#E5E5E5"> and thirdly as we began to</font>

338
00:15:37,270 --> 00:15:43,210
roll out mpls VPN s with a suspicion

339
00:15:41,230 --> 00:15:45,370
that our customers might request dynamic

340
00:15:43,210 --> 00:15:48,880
routing with us and that they might ask

341
00:15:45,370 --> 00:15:53,290
<font color="#E5E5E5">for ospf to do so we wanted</font><font color="#CCCCCC"> to separate</font>

342
00:15:48,880 --> 00:15:58,480
our customer facing VPN dynamic routing

343
00:15:53,290 --> 00:16:02,890
router ospf blah from our production

344
00:15:58,480 --> 00:16:04,180
<font color="#CCCCCC">network igp by doing router is is so</font>

345
00:16:02,890 --> 00:16:06,189
that people wouldn't accidentally go

346
00:16:04,180 --> 00:16:08,890
into router ospf<font color="#E5E5E5"> one and blow something</font>

347
00:16:06,190 --> 00:16:12,880
up when they meant<font color="#E5E5E5"> to be on a vrf on</font>

348
00:16:08,890 --> 00:16:15,670
different process turns out<font color="#E5E5E5"> in the three</font>

349
00:16:12,880 --> 00:16:17,350
or so<font color="#CCCCCC"> years we've had VPNs that none of</font>

350
00:16:15,670 --> 00:16:19,780
our customers have requested dynamic

351
00:16:17,350 --> 00:16:23,590
routing the only customer with it is us

352
00:16:19,780 --> 00:16:25,540
ourselves<font color="#E5E5E5"> for corporate offices and</font><font color="#CCCCCC"> that</font>

353
00:16:23,590 --> 00:16:29,890
was<font color="#CCCCCC"> BGP until recently we've now</font>

354
00:16:25,540 --> 00:16:32,640
switched to ospf the assumption is<font color="#E5E5E5"> that</font>

355
00:16:29,890 --> 00:16:37,750
staff<font color="#E5E5E5"> won't be blowing that up between</font>

356
00:16:32,640 --> 00:16:40,840
corporate and production and because<font color="#CCCCCC"> of</font>

357
00:16:37,750 --> 00:16:44,620
a<font color="#CCCCCC"> variety of reasons primarily ipv6</font>

358
00:16:40,840 --> 00:16:47,110
we've switched back did the rollout as

359
00:16:44,620 --> 00:16:48,550
part of our ipv6 roll out which will be

360
00:16:47,110 --> 00:16:54,010
in another presentation of this nanog

361
00:16:48,550 --> 00:16:58,599
tomorrow but also chose to do it<font color="#E5E5E5"> because</font>

362
00:16:54,010 --> 00:17:01,030
<font color="#E5E5E5">we had forecasted a use for gear that</font>

363
00:16:58,600 --> 00:17:03,670
did<font color="#E5E5E5"> not support my sis whatsoever so by</font>

364
00:17:01,030 --> 00:17:05,859
rolling back to ospf we were able<font color="#E5E5E5"> to</font>

365
00:17:03,670 --> 00:17:11,139
keep our topology and architecture

366
00:17:05,859 --> 00:17:13,208
consistent typical<font color="#CCCCCC"> IGP design goals that</font>

367
00:17:11,140 --> 00:17:15,370
you hear in a lot<font color="#CCCCCC"> of the other nanog</font>

368
00:17:13,209 --> 00:17:18,490
talks but our consolidated here keep

369
00:17:15,369 --> 00:17:20,859
everything lean device loop backs links

370
00:17:18,490 --> 00:17:22,329
between devices nothing else<font color="#E5E5E5"> I've even</font>

371
00:17:20,859 --> 00:17:24,819
<font color="#CCCCCC">heard of</font><font color="#E5E5E5"> people taking</font><font color="#CCCCCC"> their inter</font>

372
00:17:22,329 --> 00:17:26,260
device links out haven't<font color="#E5E5E5"> quite figured</font>

373
00:17:24,819 --> 00:17:28,750
out what they're after and how they're

374
00:17:26,260 --> 00:17:31,840
doing it but if it<font color="#E5E5E5"> works for them even</font>

375
00:17:28,750 --> 00:17:34,060
<font color="#CCCCCC">better everything else belongs in BGP</font>

376
00:17:31,840 --> 00:17:36,340
it's a protocol made for thousands or

377
00:17:34,060 --> 00:17:38,620
outs and it's got administrative control

378
00:17:36,340 --> 00:17:41,020
and plenty of filtering capability

379
00:17:38,620 --> 00:17:46,300
that's specifically<font color="#E5E5E5"> not in OSP</font>

380
00:17:41,020 --> 00:17:48,820
f and we copied a lot of the work of<font color="#E5E5E5"> VJ</font>

381
00:17:46,300 --> 00:17:51,909
gill and the AOL transit data network

382
00:17:48,820 --> 00:17:54,550
team from<font color="#E5E5E5"> their nanog 29 presentation</font><font color="#CCCCCC"> I</font>

383
00:17:51,910 --> 00:17:57,610
believe from when they converted from

384
00:17:54,550 --> 00:17:59,530
ospf to is is we use that during our

385
00:17:57,610 --> 00:18:02,229
conversion to is is<font color="#E5E5E5"> and copied the</font>

386
00:17:59,530 --> 00:18:04,840
metrics coming back to ospf more

387
00:18:02,230 --> 00:18:07,540
recently doing so we started<font color="#E5E5E5"> with a</font>

388
00:18:04,840 --> 00:18:10,060
table of metrics based on link rate and

389
00:18:07,540 --> 00:18:12,490
then add a various modifier depending on

390
00:18:10,060 --> 00:18:16,450
the role of a particular link so our

391
00:18:12,490 --> 00:18:19,590
general table goes from 1 to 10 40<font color="#E5E5E5"> c 768</font>

392
00:18:16,450 --> 00:18:21,700
or 40 gig Ethernet down<font color="#CCCCCC"> to ds1</font>

393
00:18:19,590 --> 00:18:24,550
considering that our total traffic right

394
00:18:21,700 --> 00:18:28,530
<font color="#CCCCCC">now prior to acquisition is a quarter</font>

395
00:18:24,550 --> 00:18:31,690
gigabit I'm not real worried<font color="#CCCCCC"> about</font>

396
00:18:28,530 --> 00:18:37,360
anything bigger than that whether it's

397
00:18:31,690 --> 00:18:39,370
hunter gig 160 gig or whatever modifying

398
00:18:37,360 --> 00:18:41,679
those metrics the links between cores

399
00:18:39,370 --> 00:18:43,989
are metric one no matter what<font color="#E5E5E5"> size the</font>

400
00:18:41,680 --> 00:18:46,720
pipe actually<font color="#E5E5E5"> is on rare occasions we've</font>

401
00:18:43,990 --> 00:18:48,820
had two different sizes<font color="#E5E5E5"> of pipe one a</font>

402
00:18:46,720 --> 00:18:51,270
primary one a back up so the primary

403
00:18:48,820 --> 00:18:53,860
would be one the backup<font color="#E5E5E5"> would</font><font color="#CCCCCC"> be two</font>

404
00:18:51,270 --> 00:18:56,170
links from core routers to distribution

405
00:18:53,860 --> 00:18:59,439
routers are 500 plus whatever was in the

406
00:18:56,170 --> 00:19:02,410
table links from cortege are the same

407
00:18:59,440 --> 00:19:05,560
500 plus whatever is in the table links

408
00:19:02,410 --> 00:19:10,480
between cities so far<font color="#CCCCCC"> our 30 plus table</font>

409
00:19:05,560 --> 00:19:12,399
value<font color="#E5E5E5"> I believe</font><font color="#CCCCCC"> VJ and the ATN folks</font>

410
00:19:10,480 --> 00:19:16,210
<font color="#CCCCCC">attn folks mentioned that they have</font>

411
00:19:12,400 --> 00:19:17,860
<font color="#CCCCCC">different levels</font><font color="#E5E5E5"> of modifier based on</font>

412
00:19:16,210 --> 00:19:22,510
<font color="#E5E5E5">one of those links are within a region</font>

413
00:19:17,860 --> 00:19:25,750
across regions or cross continents this

414
00:19:22,510 --> 00:19:27,510
will be a matter of study for us as we

415
00:19:25,750 --> 00:19:31,240
move to a multi-state network

416
00:19:27,510 --> 00:19:33,129
<font color="#CCCCCC">post-acquisition text link is based in</font>

417
00:19:31,240 --> 00:19:36,340
texas and<font color="#CCCCCC"> pacwest being based in</font>

418
00:19:33,130 --> 00:19:39,210
california we may<font color="#E5E5E5"> have to do some semi</font>

419
00:19:36,340 --> 00:19:41,530
separation between the<font color="#E5E5E5"> two until we get</font>

420
00:19:39,210 --> 00:19:45,160
upstream links rebalanced and and

421
00:19:41,530 --> 00:19:46,870
<font color="#CCCCCC">whatnot and as I'll highlight later in</font>

422
00:19:45,160 --> 00:19:49,660
the talk we've had<font color="#E5E5E5"> to do some minor</font>

423
00:19:46,870 --> 00:19:53,419
tweaks to these landlink values based on

424
00:19:49,660 --> 00:19:56,120
<font color="#CCCCCC">BGP tuning purposes considering that</font>

425
00:19:53,420 --> 00:19:58,430
one time not<font color="#E5E5E5"> thinking through all the</font>

426
00:19:56,120 --> 00:20:02,290
implications here<font color="#E5E5E5"> I managed to</font><font color="#CCCCCC"> blow up</font>

427
00:19:58,430 --> 00:20:04,460
an entire pop when multipath ran all for

428
00:20:02,290 --> 00:20:06,740
customer connection routers out of

429
00:20:04,460 --> 00:20:08,170
memory at the<font color="#E5E5E5"> same time considering it</font>

430
00:20:06,740 --> 00:20:13,730
was<font color="#CCCCCC"> also the router that handled our</font>

431
00:20:08,170 --> 00:20:16,160
office it was a bad day every now and

432
00:20:13,730 --> 00:20:17,870
then staff need to do modifications to

433
00:20:16,160 --> 00:20:21,920
the network whether<font color="#E5E5E5"> it's planned</font>

434
00:20:17,870 --> 00:20:24,500
maintenance upgrades downgrades what

435
00:20:21,920 --> 00:20:27,890
have<font color="#CCCCCC"> you they've all been told add</font>

436
00:20:24,500 --> 00:20:30,140
10,000 to the link<font color="#E5E5E5"> cost and that way</font>

437
00:20:27,890 --> 00:20:31,400
it's<font color="#E5E5E5"> pretty easy to figure out what the</font>

438
00:20:30,140 --> 00:20:33,500
link is supposed to be when they're done

439
00:20:31,400 --> 00:20:36,950
with their maintenance so if we've<font color="#CCCCCC"> done</font>

440
00:20:33,500 --> 00:20:41,750
some some changes and<font color="#CCCCCC"> let's say there's</font>

441
00:20:36,950 --> 00:20:44,180
a ds3 that would have been a metric<font color="#E5E5E5"> of</font>

442
00:20:41,750 --> 00:20:45,920
38 because it's going between cities but

443
00:20:44,180 --> 00:20:49,340
for tuning purposes we may have made it

444
00:20:45,920 --> 00:20:52,550
43 temporarily they know that when they

445
00:20:49,340 --> 00:20:54,139
see a link cost of one or<font color="#CCCCCC"> 10,000 43 they</font>

446
00:20:52,550 --> 00:20:57,290
should revert it back to 43 for

447
00:20:54,140 --> 00:20:59,330
simplicity if for some reason a link

448
00:20:57,290 --> 00:21:03,889
really really really should not<font color="#E5E5E5"> be used</font>

449
00:20:59,330 --> 00:21:06,649
that<font color="#CCCCCC"> Delta is 20,000 folks usually tend</font>

450
00:21:03,890 --> 00:21:09,020
to go Pete why is this one 20,000 and

451
00:21:06,650 --> 00:21:11,180
that's enough time<font color="#E5E5E5"> to say won't step</font>

452
00:21:09,020 --> 00:21:14,270
away from where<font color="#CCCCCC"> you are and let's not</font>

453
00:21:11,180 --> 00:21:17,420
disturb that right now<font color="#E5E5E5"> and here's why so</font>

454
00:21:14,270 --> 00:21:19,340
with the carefully engineered metric

455
00:21:17,420 --> 00:21:22,190
Design we get a<font color="#E5E5E5"> very predictable traffic</font>

456
00:21:19,340 --> 00:21:24,080
flow and that's good both under normal

457
00:21:22,190 --> 00:21:28,460
conditions and when<font color="#E5E5E5"> the link is out of</font>

458
00:21:24,080 --> 00:21:31,040
service expected or unexpected and I

459
00:21:28,460 --> 00:21:32,690
diverge for a moment to say learning the

460
00:21:31,040 --> 00:21:35,800
algorithm by which the router select

461
00:21:32,690 --> 00:21:39,890
paths will really assist in

462
00:21:35,800 --> 00:21:41,450
understanding what's going on my<font color="#E5E5E5"> magic</font>

463
00:21:39,890 --> 00:21:43,780
light bulb came from the book shown

464
00:21:41,450 --> 00:21:47,360
<font color="#CCCCCC">there traffic engineering with mpls and</font>

465
00:21:43,780 --> 00:21:50,030
<font color="#CCCCCC">I gave a tutorial back at 37 about</font>

466
00:21:47,360 --> 00:21:53,260
traffic engineering and in there there's

467
00:21:50,030 --> 00:21:55,970
an exercise that explains both the base

468
00:21:53,260 --> 00:22:01,220
shortest path algorithm and also how it

469
00:21:55,970 --> 00:22:03,590
works with in traffic engineering so key

470
00:22:01,220 --> 00:22:05,900
factor in<font color="#E5E5E5"> the link design and metric</font>

471
00:22:03,590 --> 00:22:06,889
Design is that our distribution and edge

472
00:22:05,900 --> 00:22:09,500
routers aren't as

473
00:22:06,890 --> 00:22:11,120
early<font color="#CCCCCC"> size to handle traffic</font><font color="#E5E5E5"> that for</font>

474
00:22:09,500 --> 00:22:13,850
one reason or another is trying to

475
00:22:11,120 --> 00:22:18,399
transit this pop so far our network

476
00:22:13,850 --> 00:22:21,230
isn't big enough in a steady state

477
00:22:18,400 --> 00:22:24,080
configuration to have much if any

478
00:22:21,230 --> 00:22:25,910
transit traffic but we had a link outage

479
00:22:24,080 --> 00:22:28,580
over the weekend as I was arriving here

480
00:22:25,910 --> 00:22:30,920
<font color="#CCCCCC">in dominican republic and we were</font>

481
00:22:28,580 --> 00:22:32,139
punting all traffic that would<font color="#E5E5E5"> normally</font>

482
00:22:30,920 --> 00:22:35,810
have go from<font color="#CCCCCC"> houston to san antonio</font>

483
00:22:32,140 --> 00:22:38,600
<font color="#E5E5E5">through our dallas pop so that extra</font>

484
00:22:35,810 --> 00:22:39,770
traffic were it to have tried to<font color="#CCCCCC"> travel</font>

485
00:22:38,600 --> 00:22:42,080
through the<font color="#E5E5E5"> router designed to handle</font>

486
00:22:39,770 --> 00:22:45,680
customer<font color="#E5E5E5"> t ones could have put a serious</font>

487
00:22:42,080 --> 00:22:47,240
hurt on that poor little 7206 so we want

488
00:22:45,680 --> 00:22:52,570
to<font color="#CCCCCC"> make sure that the traffic</font><font color="#E5E5E5"> that in</font>

489
00:22:47,240 --> 00:22:55,700
this case is transiting quartic or link

490
00:22:52,570 --> 00:22:58,520
knows where to go<font color="#CCCCCC"> have the quarter core</font>

491
00:22:55,700 --> 00:23:00,560
links in dallas gone away we would<font color="#CCCCCC"> have</font>

492
00:22:58,520 --> 00:23:01,940
<font color="#CCCCCC">been in a bad space anyway but let's say</font>

493
00:23:00,560 --> 00:23:03,860
those are<font color="#CCCCCC"> the only two links that were</font>

494
00:23:01,940 --> 00:23:05,570
down we want<font color="#CCCCCC"> to</font><font color="#E5E5E5"> make sure the traffic</font>

495
00:23:03,860 --> 00:23:08,810
<font color="#CCCCCC">that one otherwise want to go through</font>

496
00:23:05,570 --> 00:23:10,790
them will go around<font color="#E5E5E5"> the lan rather than</font>

497
00:23:08,810 --> 00:23:13,600
trying<font color="#E5E5E5"> to punish our customer</font>

498
00:23:10,790 --> 00:23:18,110
distribution routers or upstream routers

499
00:23:13,600 --> 00:23:20,840
so to do that the we know<font color="#CCCCCC"> that the</font>

500
00:23:18,110 --> 00:23:22,729
distance within a pot going<font color="#E5E5E5"> from a core</font>

501
00:23:20,840 --> 00:23:25,340
down to a<font color="#E5E5E5"> disk back to a core or</font>

502
00:23:22,730 --> 00:23:27,860
likewise core edge core is<font color="#E5E5E5"> going to be</font>

503
00:23:25,340 --> 00:23:29,990
at least<font color="#E5E5E5"> a thousand and two because</font>

504
00:23:27,860 --> 00:23:32,899
those link metrics are always<font color="#E5E5E5"> 500 plus</font>

505
00:23:29,990 --> 00:23:35,150
at least<font color="#E5E5E5"> one and likewise 500 plus at</font>

506
00:23:32,900 --> 00:23:36,950
least<font color="#E5E5E5"> one whereas the cost to go around</font>

507
00:23:35,150 --> 00:23:39,650
<font color="#E5E5E5">the way in is always going to be at</font>

508
00:23:36,950 --> 00:23:42,670
least<font color="#E5E5E5"> sixty three since from this city</font>

509
00:23:39,650 --> 00:23:46,460
to the next city will be at least<font color="#CCCCCC"> 30 11</font>

510
00:23:42,670 --> 00:23:49,930
to go from core decor and 31 to go back

511
00:23:46,460 --> 00:23:52,400
through another win link to this city if

512
00:23:49,930 --> 00:23:54,530
there are<font color="#CCCCCC"> additional cities going around</font>

513
00:23:52,400 --> 00:23:56,570
that ring the land cost is going to

514
00:23:54,530 --> 00:23:58,970
increment by anywhere from 30 to 40 per

515
00:23:56,570 --> 00:24:02,270
city so in this case traffic would

516
00:23:58,970 --> 00:24:03,080
rather go through 23 cities before it

517
00:24:02,270 --> 00:24:05,510
would decide to go through the

518
00:24:03,080 --> 00:24:08,000
distribution layer keeping us safe for

519
00:24:05,510 --> 00:24:10,160
now with<font color="#E5E5E5"> only four cities we're safe but</font>

520
00:24:08,000 --> 00:24:13,430
<font color="#CCCCCC">i know that</font><font color="#E5E5E5"> we're on an expansion</font>

521
00:24:10,160 --> 00:24:14,990
roadmap and i'm<font color="#CCCCCC"> very happy that i'm not</font>

522
00:24:13,430 --> 00:24:18,980
going<font color="#CCCCCC"> to have to go back and recalculate</font>

523
00:24:14,990 --> 00:24:20,429
re-engineer for a long long time so

524
00:24:18,980 --> 00:24:22,529
here's a representation

525
00:24:20,429 --> 00:24:24,269
of those metrics not totally to scale

526
00:24:22,529 --> 00:24:26,759
but<font color="#E5E5E5"> you can see that the distance from</font>

527
00:24:24,269 --> 00:24:28,799
<font color="#E5E5E5">core down to distribution and back up</font>

528
00:24:26,759 --> 00:24:31,799
again is far greater than<font color="#CCCCCC"> it is between</font>

529
00:24:28,799 --> 00:24:36,720
<font color="#CCCCCC">the two or particularly to go over to</font>

530
00:24:31,799 --> 00:24:38,158
<font color="#CCCCCC">another</font><font color="#E5E5E5"> city and as our staff begins to</font>

531
00:24:36,720 --> 00:24:41,159
become familiar<font color="#CCCCCC"> with this they get to</font>

532
00:24:38,159 --> 00:24:42,480
see that it truly is consistent as long

533
00:24:41,159 --> 00:24:44,249
as they've<font color="#CCCCCC"> got the metric table in front</font>

534
00:24:42,480 --> 00:24:46,320
of<font color="#E5E5E5"> them I've occasionally given them</font>

535
00:24:44,249 --> 00:24:48,629
projects to configure a new router being

536
00:24:46,320 --> 00:24:51,299
<font color="#E5E5E5">out of the network and they can</font>

537
00:24:48,629 --> 00:24:56,219
understand better<font color="#E5E5E5"> how to put in the</font>

538
00:24:51,299 --> 00:24:58,139
proper configuration entries so the

539
00:24:56,220 --> 00:25:02,190
event that kind<font color="#E5E5E5"> of bit us that one</font>

540
00:24:58,139 --> 00:25:05,248
afternoon we have links to NTT vario in

541
00:25:02,190 --> 00:25:07,350
both Dallas and Houston and based on the

542
00:25:05,249 --> 00:25:09,509
<font color="#E5E5E5">BGP path selection algorithm rule number</font>

543
00:25:07,350 --> 00:25:12,269
<font color="#CCCCCC">10 prefer the route that can be</font><font color="#E5E5E5"> reached</font>

544
00:25:09,509 --> 00:25:15,299
to the closest<font color="#CCCCCC"> IGP neighbor lowest IGP</font>

545
00:25:12,269 --> 00:25:17,820
metric core one in<font color="#E5E5E5"> San Antonio was</font>

546
00:25:15,299 --> 00:25:21,389
connected to Dallas and in Dallas we had

547
00:25:17,820 --> 00:25:24,210
a link to 29 14 and therefore San

548
00:25:21,389 --> 00:25:26,580
Antonio corwin liked to go that

549
00:25:24,210 --> 00:25:28,169
direction<font color="#E5E5E5"> San Antonio core</font><font color="#CCCCCC"> 2 was</font>

550
00:25:26,580 --> 00:25:30,749
connected to Houston and we had a link

551
00:25:28,169 --> 00:25:34,919
to NTT there as well in core<font color="#CCCCCC"> 2 liked to</font>

552
00:25:30,749 --> 00:25:36,840
go towards houston we were noticed that

553
00:25:34,919 --> 00:25:39,419
some of<font color="#E5E5E5"> our dallas distribution routers</font>

554
00:25:36,840 --> 00:25:41,519
were sending outbound traffic over to

555
00:25:39,419 --> 00:25:43,379
<font color="#CCCCCC">Houston to</font><font color="#E5E5E5"> go to auntie T because of a</font>

556
00:25:41,519 --> 00:25:45,869
difference in<font color="#CCCCCC"> igp metric from Dallas</font>

557
00:25:43,379 --> 00:25:49,408
distribution to Dallas core to Dallas

558
00:25:45,869 --> 00:25:51,570
edge<font color="#CCCCCC"> vs from Dallas distribution to</font>

559
00:25:49,409 --> 00:25:53,999
Dallas core over to Houston core and

560
00:25:51,570 --> 00:25:56,490
then up to Houston edge so we tweaked

561
00:25:53,999 --> 00:25:59,129
the link metrics going from Houston core

562
00:25:56,490 --> 00:26:01,169
to Houston edge<font color="#CCCCCC"> 1 rebalance traffic and</font>

563
00:25:59,129 --> 00:26:02,850
sure enough those<font color="#E5E5E5"> Dallas distribution</font>

564
00:26:01,169 --> 00:26:04,440
routers would began doing the thing that

565
00:26:02,850 --> 00:26:06,600
we'd hoped they would do and that was to

566
00:26:04,440 --> 00:26:10,740
stay within city and send their traffic

567
00:26:06,600 --> 00:26:12,269
out to dallas<font color="#E5E5E5"> ntt however our</font><font color="#CCCCCC"> San</font>

568
00:26:10,740 --> 00:26:14,669
<font color="#CCCCCC">Antonio distribution routers had bgp</font>

569
00:26:12,269 --> 00:26:16,769
multipath enabled and they were now

570
00:26:14,669 --> 00:26:19,080
getting best paths at least if they were

571
00:26:16,769 --> 00:26:20,879
headed towards ntt pointing towards

572
00:26:19,080 --> 00:26:24,178
dallas from core<font color="#CCCCCC"> 1 and pointing stirred</font>

573
00:26:20,879 --> 00:26:25,969
<font color="#CCCCCC">houston from core 2 so 4 40 or 50,000</font>

574
00:26:24,179 --> 00:26:28,859
prefixes we now had two entries and

575
00:26:25,970 --> 00:26:31,999
those poor little RSP force all went

576
00:26:28,859 --> 00:26:34,360
boom pretty much simultaneously and

577
00:26:31,999 --> 00:26:36,040
considering<font color="#CCCCCC"> that my desk and</font>

578
00:26:34,360 --> 00:26:38,409
all of our support personnel were behind

579
00:26:36,040 --> 00:26:40,690
one of those we were<font color="#E5E5E5"> kind of in the dark</font>

580
00:26:38,410 --> 00:26:45,820
<font color="#E5E5E5">until we figured out maybe that change</font>

581
00:26:40,690 --> 00:26:50,980
about 10 minutes ago was bad so our

582
00:26:45,820 --> 00:26:53,860
retrofit was merely to was to leave the

583
00:26:50,980 --> 00:26:56,010
<font color="#E5E5E5">Houston edge metrics the same or as</font>

584
00:26:53,860 --> 00:26:58,179
desired so that everything matched and

585
00:26:56,010 --> 00:27:00,940
behaved similarly between<font color="#E5E5E5"> Dallas and</font>

586
00:26:58,180 --> 00:27:03,460
<font color="#E5E5E5">Houston but to change the LAN links from</font>

587
00:27:00,940 --> 00:27:06,160
Dallas to San<font color="#CCCCCC"> Antonio and</font><font color="#E5E5E5"> Houston to San</font>

588
00:27:03,460 --> 00:27:08,680
<font color="#CCCCCC">Antonio so this San Antonio core routers</font>

589
00:27:06,160 --> 00:27:10,990
had a clear preference I think currently

590
00:27:08,680 --> 00:27:13,300
it's towards<font color="#E5E5E5"> Houston and wouldn't feed</font>

591
00:27:10,990 --> 00:27:18,520
the distribution routers with a

592
00:27:13,300 --> 00:27:21,159
multipath mess so within BGP it's made

593
00:27:18,520 --> 00:27:22,900
to scale use it we carry all of our

594
00:27:21,160 --> 00:27:24,940
customer link subnets customer land

595
00:27:22,900 --> 00:27:28,410
subnets and external routes within BGP

596
00:27:24,940 --> 00:27:31,930
as well it's got great filtering tools

597
00:27:28,410 --> 00:27:34,030
use them it'll save<font color="#CCCCCC"> your life we filter</font>

598
00:27:31,930 --> 00:27:36,790
at every route ingress and route

599
00:27:34,030 --> 00:27:39,670
injection point and in doing so we apply

600
00:27:36,790 --> 00:27:41,350
an internal community so that any BGP

601
00:27:39,670 --> 00:27:44,110
route anywhere on a network will have at

602
00:27:41,350 --> 00:27:45,490
least that internal community so from a

603
00:27:44,110 --> 00:27:46,800
troubleshooting perspective we're able

604
00:27:45,490 --> 00:27:51,370
to<font color="#CCCCCC"> figure out where it's coming from</font>

605
00:27:46,800 --> 00:27:53,590
instantly you're going to have to scale

606
00:27:51,370 --> 00:27:56,409
your BGP at some point<font color="#E5E5E5"> confederations</font>

607
00:27:53,590 --> 00:27:59,409
did not work well for us we<font color="#E5E5E5"> started off</font>

608
00:27:56,410 --> 00:28:01,630
using one sub a s<font color="#E5E5E5"> per pop when you have</font>

609
00:27:59,410 --> 00:28:04,540
one router / pop it means each router is

610
00:28:01,630 --> 00:28:07,060
its own sub a s convergence<font color="#E5E5E5"> was painful</font>

611
00:28:04,540 --> 00:28:09,520
because those pops would end up having

612
00:28:07,060 --> 00:28:11,770
to send a full table over to the

613
00:28:09,520 --> 00:28:14,050
Confederation<font color="#E5E5E5"> neighbors as opposed to in</font>

614
00:28:11,770 --> 00:28:16,480
a route reflector situation where they

615
00:28:14,050 --> 00:28:18,520
send only best paths and if they're

616
00:28:16,480 --> 00:28:21,700
getting learning routes from an adjacent

617
00:28:18,520 --> 00:28:24,820
pop that were better anyway you've got a

618
00:28:21,700 --> 00:28:28,810
much simpler reflection upon BGP session

619
00:28:24,820 --> 00:28:30,669
restoral so in the<font color="#CCCCCC"> process of doing our</font>

620
00:28:28,810 --> 00:28:32,889
various pop upgrades we<font color="#CCCCCC"> removed the</font>

621
00:28:30,670 --> 00:28:34,630
Confederations and deployed route

622
00:28:32,890 --> 00:28:36,910
reflectors in the<font color="#E5E5E5"> step-by-step process</font>

623
00:28:34,630 --> 00:28:40,780
and again following the suggestions of

624
00:28:36,910 --> 00:28:42,970
<font color="#CCCCCC">vijay gil and</font><font color="#E5E5E5"> 8th edn we have no client</font>

625
00:28:40,780 --> 00:28:44,889
to client reflection the distribution

626
00:28:42,970 --> 00:28:45,809
and edge routers within a pop are fully

627
00:28:44,890 --> 00:28:48,580
meshed

628
00:28:45,809 --> 00:28:52,928
which prevent theoretically prevents at

629
00:28:48,580 --> 00:28:54,939
least first layer met oscillation we are

630
00:28:52,929 --> 00:28:56,950
nowhere near hitting that but I'd<font color="#E5E5E5"> rather</font>

631
00:28:54,940 --> 00:28:58,899
take the<font color="#E5E5E5"> future of you now than have to</font>

632
00:28:56,950 --> 00:29:01,899
go around later and race around and<font color="#E5E5E5"> fix</font>

633
00:28:58,899 --> 00:29:03,820
things<font color="#E5E5E5"> up so within our distribution</font>

634
00:29:01,899 --> 00:29:06,728
layer all the customer links are

635
00:29:03,820 --> 00:29:09,609
redistributed into<font color="#E5E5E5"> bgp as connected</font>

636
00:29:06,729 --> 00:29:11,590
routes make sure you exclude the

637
00:29:09,609 --> 00:29:14,080
interfaces that are<font color="#E5E5E5"> from</font><font color="#CCCCCC"> disc to core</font>

638
00:29:11,590 --> 00:29:17,678
and we got<font color="#CCCCCC"> burned on this once when we</font>

639
00:29:14,080 --> 00:29:18,999
<font color="#CCCCCC">didn't write our route map i suggest</font>

640
00:29:17,679 --> 00:29:22,389
that<font color="#E5E5E5"> you don't write your route map to</font>

641
00:29:18,999 --> 00:29:24,879
exclude by interface name if the router

642
00:29:22,389 --> 00:29:27,008
comes up and the VIP is not there it'll

643
00:29:24,879 --> 00:29:29,738
drop out that reference in the route map

644
00:29:27,009 --> 00:29:33,419
and now you had instead<font color="#E5E5E5"> of denying one</font>

645
00:29:29,739 --> 00:29:36,009
interface you're denying all routes

646
00:29:33,419 --> 00:29:37,450
instead use a prefix list so that<font color="#E5E5E5"> even</font>

647
00:29:36,009 --> 00:29:39,729
<font color="#E5E5E5">if you end up with no interfaces</font>

648
00:29:37,450 --> 00:29:42,309
matching a prefix list you<font color="#E5E5E5"> have a static</font>

649
00:29:39,729 --> 00:29:45,220
reference and you won't<font color="#CCCCCC"> have this kind</font>

650
00:29:42,309 --> 00:29:48,340
of black hole likewise we redistribute

651
00:29:45,220 --> 00:29:49,929
static routes in the<font color="#CCCCCC"> bgp may want to</font>

652
00:29:48,340 --> 00:29:52,509
consider a prefix list there to make

653
00:29:49,929 --> 00:29:55,899
<font color="#CCCCCC">sure you</font><font color="#E5E5E5"> don't capture any private space</font>

654
00:29:52,509 --> 00:29:57,639
you might want to block and doing so

655
00:29:55,899 --> 00:29:59,559
when you add a customer<font color="#CCCCCC"> to a</font>

656
00:29:57,639 --> 00:30:01,238
distribution router you don't need to<font color="#E5E5E5"> go</font>

657
00:29:59,559 --> 00:30:06,039
anywhere else to make sure that they're

658
00:30:01,239 --> 00:30:08,139
properly routed scales very<font color="#E5E5E5"> well means</font>

659
00:30:06,039 --> 00:30:09,700
<font color="#E5E5E5">that a lot of your technicians will only</font>

660
00:30:08,139 --> 00:30:11,498
have<font color="#CCCCCC"> to deal with</font><font color="#E5E5E5"> the distribution layer</font>

661
00:30:09,700 --> 00:30:18,340
and won't have to deal with much of<font color="#CCCCCC"> your</font>

662
00:30:11,499 --> 00:30:20,320
redundancy and scalability<font color="#CCCCCC"> bgp local</font>

663
00:30:18,340 --> 00:30:21,849
<font color="#E5E5E5">pref design this</font><font color="#CCCCCC"> is one of the magic</font>

664
00:30:20,320 --> 00:30:24,399
secrets that<font color="#CCCCCC"> i've</font><font color="#E5E5E5"> never found in the</font>

665
00:30:21,849 --> 00:30:26,019
books and sometimes<font color="#E5E5E5"> you can't even find</font>

666
00:30:24,399 --> 00:30:28,508
it in many<font color="#E5E5E5"> of the nanulak presentations</font>

667
00:30:26,019 --> 00:30:31,570
you want to choose your local pref

668
00:30:28,509 --> 00:30:33,729
values so that traffic goes appropriate

669
00:30:31,570 --> 00:30:36,220
to your dollars knowing that transit

670
00:30:33,729 --> 00:30:38,440
probably cost you money peering might

671
00:30:36,220 --> 00:30:41,669
cost might not but perhaps lower than

672
00:30:38,440 --> 00:30:44,409
transit and your customers mean revenue

673
00:30:41,669 --> 00:30:46,179
makes more sense to send traffic to a

674
00:30:44,409 --> 00:30:49,269
customer than it does to send it through

675
00:30:46,179 --> 00:30:51,039
one of<font color="#E5E5E5"> your transit connections and most</font>

676
00:30:49,269 --> 00:30:53,649
<font color="#E5E5E5">people seem to be using local pref to</font>

677
00:30:51,039 --> 00:30:55,809
accomplish this so our basic design

678
00:30:53,649 --> 00:30:58,209
although<font color="#CCCCCC"> not totally reflected in all of</font>

679
00:30:55,809 --> 00:30:59,379
our routers is that customer routes are

680
00:30:58,210 --> 00:31:03,970
given a local preference<font color="#CCCCCC"> before</font>

681
00:30:59,380 --> 00:31:06,430
p routes get a LP of<font color="#CCCCCC"> 300 transits or 200</font>

682
00:31:03,970 --> 00:31:08,710
and any route that temporarily is being

683
00:31:06,430 --> 00:31:11,410
asked to be treated<font color="#E5E5E5"> as a backup to some</font>

684
00:31:08,710 --> 00:31:13,930
other customer<font color="#CCCCCC"> peer transit route gets a</font>

685
00:31:11,410 --> 00:31:16,120
local preference of 50 since the routers

686
00:31:13,930 --> 00:31:19,360
default to a local preference of 100 if

687
00:31:16,120 --> 00:31:21,580
you forget a route map or you typo a

688
00:31:19,360 --> 00:31:23,830
route map you're going to have routes

689
00:31:21,580 --> 00:31:25,300
that are invisible and you're going<font color="#E5E5E5"> to</font>

690
00:31:23,830 --> 00:31:27,580
<font color="#E5E5E5">go troubleshoot it and you're going to</font>

691
00:31:25,300 --> 00:31:29,320
<font color="#E5E5E5">go oops I forgot where I bombed a route</font>

692
00:31:27,580 --> 00:31:32,169
map and you're going<font color="#E5E5E5"> to fix it early</font>

693
00:31:29,320 --> 00:31:37,300
rather than crashing into it months or

694
00:31:32,170 --> 00:31:40,060
years later and as everyone requests

695
00:31:37,300 --> 00:31:43,060
please filter your customers we do it

696
00:31:40,060 --> 00:31:45,580
once<font color="#CCCCCC"> on-ree in grass from our BGP</font>

697
00:31:43,060 --> 00:31:48,750
customers and we do so very aggressively

698
00:31:45,580 --> 00:31:52,389
for each prefix we check that prefix

699
00:31:48,750 --> 00:31:55,240
against a prefix list and against an AS

700
00:31:52,390 --> 00:31:58,840
path list we allow that customer to

701
00:31:55,240 --> 00:32:00,850
prepend as much as they wish we allow

702
00:31:58,840 --> 00:32:03,699
them to truncate the<font color="#E5E5E5"> AS path so if they</font>

703
00:32:00,850 --> 00:32:06,399
have a customer<font color="#E5E5E5"> of our customer that's</font>

704
00:32:03,700 --> 00:32:08,490
giving them a prefix so we might<font color="#E5E5E5"> be</font>

705
00:32:06,400 --> 00:32:12,430
seeing two different a esas in the path

706
00:32:08,490 --> 00:32:14,830
will allow our customer to take over

707
00:32:12,430 --> 00:32:16,690
that route for their customer and the

708
00:32:14,830 --> 00:32:19,990
event their customer has some sort<font color="#E5E5E5"> of</font>

709
00:32:16,690 --> 00:32:23,130
<font color="#E5E5E5">emergency so the second and subsequent</font>

710
00:32:19,990 --> 00:32:25,810
<font color="#CCCCCC">is in that path is completely optional</font>

711
00:32:23,130 --> 00:32:28,590
we tell our customers about<font color="#E5E5E5"> these rules</font>

712
00:32:25,810 --> 00:32:31,330
and a whole<font color="#CCCCCC"> bunch more at Turnham and</font>

713
00:32:28,590 --> 00:32:34,330
assuming they read the document which

714
00:32:31,330 --> 00:32:35,710
would notice that do not rarely do they

715
00:32:34,330 --> 00:32:37,149
have everything they need to know to

716
00:32:35,710 --> 00:32:42,460
bring up that session without a single

717
00:32:37,150 --> 00:32:44,410
phone call we also factored in no

718
00:32:42,460 --> 00:32:46,360
<font color="#E5E5E5">routing capability and we do so somewhat</font>

719
00:32:44,410 --> 00:32:48,880
complete with certain amount<font color="#E5E5E5"> of</font>

720
00:32:46,360 --> 00:32:50,560
complexity but the reality of it<font color="#E5E5E5"> is it</font>

721
00:32:48,880 --> 00:32:52,240
gives the customer flexibility and

722
00:32:50,560 --> 00:32:54,040
allows them<font color="#E5E5E5"> to do a lot</font><font color="#CCCCCC"> of stuff without</font>

723
00:32:52,240 --> 00:32:57,940
ever having to<font color="#E5E5E5"> call us assuming you have</font>

724
00:32:54,040 --> 00:33:01,450
enough clue to use it will accept their

725
00:32:57,940 --> 00:33:04,660
aggregate routes marked for no routing

726
00:33:01,450 --> 00:33:07,510
we will treat internally as a no route

727
00:33:04,660 --> 00:33:11,200
and we will propagate those aggregate

728
00:33:07,510 --> 00:33:12,999
routes allowing them to do certain

729
00:33:11,200 --> 00:33:14,199
tricks which we'll cover in a bit

730
00:33:12,999 --> 00:33:17,409
and certainly will accept their

731
00:33:14,199 --> 00:33:18,879
aggregate routes assuming no tagging or

732
00:33:17,409 --> 00:33:20,829
at least no no route tagging and

733
00:33:18,879 --> 00:33:24,938
propagate it normally as would be

734
00:33:20,829 --> 00:33:27,789
expected we will accept any more

735
00:33:24,939 --> 00:33:30,879
specific of their aggregates mark with

736
00:33:27,789 --> 00:33:32,979
no route we will treat<font color="#E5E5E5"> it internally for</font>

737
00:33:30,879 --> 00:33:35,468
no routing we will mark it internally

738
00:33:32,979 --> 00:33:37,539
for<font color="#E5E5E5"> no export so that doesn't go out to</font>

739
00:33:35,469 --> 00:33:40,959
providers and customers since it most

740
00:33:37,539 --> 00:33:44,319
likely would get filtered anyway share

741
00:33:40,959 --> 00:33:46,449
it all within our network we<font color="#CCCCCC"> do also</font>

742
00:33:44,319 --> 00:33:48,938
accept more specifics of their

743
00:33:46,449 --> 00:33:52,779
aggregates if they mark them with<font color="#CCCCCC"> a</font>

744
00:33:48,939 --> 00:33:54,849
override community we treat that as an

745
00:33:52,779 --> 00:33:57,309
aggregate and allow<font color="#CCCCCC"> it to be propagated</font>

746
00:33:54,849 --> 00:33:59,739
out on the hopes that our transits

747
00:33:57,309 --> 00:34:03,428
filter on a less than<font color="#CCCCCC"> or equal to 24 bit</font>

748
00:33:59,739 --> 00:34:06,999
basis obviously that's best effort for

749
00:34:03,429 --> 00:34:09,279
some verb up streams but the notion

750
00:34:06,999 --> 00:34:11,889
behind this for a small shop such as

751
00:34:09,279 --> 00:34:14,529
ours is that<font color="#CCCCCC"> if you have a</font><font color="#E5E5E5"> customer with</font>

752
00:34:11,889 --> 00:34:16,990
sufficient<font color="#E5E5E5"> bgp clue to call you up at</font>

753
00:34:14,529 --> 00:34:18,969
seven p.m. on a friday night and say hey

754
00:34:16,989 --> 00:34:21,638
i<font color="#CCCCCC"> just added a customer two minutes ago</font>

755
00:34:18,969 --> 00:34:23,609
<font color="#E5E5E5">which we know is false but they've got</font>

756
00:34:21,639 --> 00:34:26,109
<font color="#E5E5E5">this new prefix they've brought from</font>

757
00:34:23,609 --> 00:34:29,679
wherever and they want to<font color="#E5E5E5"> be able to</font>

758
00:34:26,109 --> 00:34:32,288
route it will say go ahead<font color="#E5E5E5"> put</font><font color="#CCCCCC"> one 1457</font>

759
00:34:29,679 --> 00:34:34,509
colon 20 on that announcement will

760
00:34:32,289 --> 00:34:35,859
accept it will propagate it assuming

761
00:34:34,509 --> 00:34:39,609
<font color="#E5E5E5">it's somewhere within their prefix list</font>

762
00:34:35,859 --> 00:34:42,038
and allow<font color="#CCCCCC"> it to go out and hopefully</font>

763
00:34:39,609 --> 00:34:43,719
<font color="#CCCCCC">it'll magically begin working we</font>

764
00:34:42,039 --> 00:34:47,039
expected it will for at least one<font color="#CCCCCC"> of</font><font color="#E5E5E5"> our</font>

765
00:34:43,719 --> 00:34:50,230
providers based on current patterns and

766
00:34:47,039 --> 00:34:52,569
allows us sometime over the weekend or

767
00:34:50,230 --> 00:34:54,879
monday or tuesday to do the right thing

768
00:34:52,569 --> 00:34:59,259
and get those routes added properly to

769
00:34:54,879 --> 00:35:01,509
our filter list last<font color="#E5E5E5"> but not least we</font>

770
00:34:59,259 --> 00:35:06,579
<font color="#E5E5E5">will accept more specific routes of that</font>

771
00:35:01,509 --> 00:35:08,680
customers aggregates untacked will

772
00:35:06,579 --> 00:35:10,359
accept them well mark them as no export

773
00:35:08,680 --> 00:35:12,970
because we see no reason to send them

774
00:35:10,359 --> 00:35:16,660
out or propagate them internally we use

775
00:35:12,970 --> 00:35:20,049
it as a<font color="#E5E5E5"> anti spoof filter opening for</font>

776
00:35:16,660 --> 00:35:22,359
traffic engineering purposes a little

777
00:35:20,049 --> 00:35:26,160
bit complex but<font color="#E5E5E5"> it means that life is</font>

778
00:35:22,359 --> 00:35:28,450
very hands-off for bgp customers so

779
00:35:26,160 --> 00:35:30,359
basic thought is the customer can

780
00:35:28,450 --> 00:35:32,529
obviously announce their aggregate route

781
00:35:30,359 --> 00:35:34,900
they can announce that aggregate route

782
00:35:32,529 --> 00:35:38,470
and null route some specifics we figure

783
00:35:34,900 --> 00:35:40,089
is<font color="#CCCCCC"> the second likely case that if they</font>

784
00:35:38,470 --> 00:35:42,160
have<font color="#CCCCCC"> enough clue to use no routing</font>

785
00:35:40,089 --> 00:35:45,130
remotely they can accomplish it

786
00:35:42,160 --> 00:35:47,379
themselves<font color="#CCCCCC"> they also have the power to</font>

787
00:35:45,130 --> 00:35:50,769
announce their aggregate and null routed

788
00:35:47,380 --> 00:35:53,680
which will propagate externally and also

789
00:35:50,769 --> 00:35:56,348
announce more specifics without no

790
00:35:53,680 --> 00:35:58,538
routing tag for which we will forward<font color="#E5E5E5"> to</font>

791
00:35:56,349 --> 00:36:01,569
the customer so let's<font color="#E5E5E5"> say they have a /</font>

792
00:35:58,539 --> 00:36:03,180
<font color="#E5E5E5">20 only wish</font><font color="#CCCCCC"> to use the 24 of it they</font>

793
00:36:01,569 --> 00:36:07,210
could announce the 20 null routed

794
00:36:03,180 --> 00:36:09,788
announced the 24 to us the rest of<font color="#E5E5E5"> the</font>

795
00:36:07,210 --> 00:36:13,869
20 gets black hold for them very easily

796
00:36:09,789 --> 00:36:15,460
they don't<font color="#E5E5E5"> have to do the other 15 / 24</font>

797
00:36:13,869 --> 00:36:16,420
<font color="#E5E5E5">s to be</font><font color="#CCCCCC"> no</font><font color="#E5E5E5"> routed to get to where</font>

798
00:36:15,460 --> 00:36:19,690
they're going they can do it with two

799
00:36:16,420 --> 00:36:21,730
announcements and within that 24 they

800
00:36:19,690 --> 00:36:24,369
could no route further specifics so it's

801
00:36:21,730 --> 00:36:26,440
a very scalable hands-off design keeping

802
00:36:24,369 --> 00:36:30,339
the customers offer phone lines out<font color="#CCCCCC"> of</font>

803
00:36:26,440 --> 00:36:33,099
our hair here's a sample in this<font color="#E5E5E5"> case</font>

804
00:36:30,339 --> 00:36:34,749
they've got a 22 of our<font color="#E5E5E5"> space they've</font>

805
00:36:33,099 --> 00:36:39,400
marked it for no routing which is the<font color="#E5E5E5"> 11</font>

806
00:36:34,749 --> 00:36:41,529
<font color="#E5E5E5">457 colon</font><font color="#CCCCCC"> zero or no we accept it pass</font>

807
00:36:39,400 --> 00:36:45,309
it out to the world<font color="#E5E5E5"> and no route it they</font>

808
00:36:41,529 --> 00:36:47,319
can also announced the 23 within it will

809
00:36:45,309 --> 00:36:49,660
accept it share it<font color="#E5E5E5"> with in totally</font>

810
00:36:47,319 --> 00:36:52,299
internally routed to the customers would

811
00:36:49,660 --> 00:36:54,368
be otherwise<font color="#E5E5E5"> expected as an RPF opening</font>

812
00:36:52,299 --> 00:36:56,499
and they can also announced a 24 within

813
00:36:54,369 --> 00:36:59,859
the 23 and no route and in doing so

814
00:36:56,499 --> 00:37:02,618
they've got<font color="#E5E5E5"> a 22 with only 24 forwarded</font>

815
00:36:59,859 --> 00:37:04,569
so very hands-off if the customer has

816
00:37:02,619 --> 00:37:07,390
enough clue to even no route they might

817
00:37:04,569 --> 00:37:09,519
want<font color="#E5E5E5"> to do this wasn't too hard</font><font color="#CCCCCC"> for us</font>

818
00:37:07,390 --> 00:37:12,519
to<font color="#E5E5E5"> write in the beginning and continue</font>

819
00:37:09,519 --> 00:37:17,950
cloning for new customers and scales

820
00:37:12,519 --> 00:37:19,089
very<font color="#E5E5E5"> well for us one side challenge is</font>

821
00:37:17,950 --> 00:37:21,819
<font color="#CCCCCC">that for every customer we have at least</font>

822
00:37:19,089 --> 00:37:24,339
<font color="#E5E5E5">two prefix lists one that's the exact</font>

823
00:37:21,819 --> 00:37:26,349
match on<font color="#E5E5E5"> their aggregate routes another</font>

824
00:37:24,339 --> 00:37:28,869
one that's Ellie 32 to allow them to do

825
00:37:26,349 --> 00:37:32,369
their no routes and their overrides if

826
00:37:28,869 --> 00:37:35,200
the customer asks we will adjust their

827
00:37:32,369 --> 00:37:37,359
inbound route map to inject various

828
00:37:35,200 --> 00:37:39,339
tuning community communities at their

829
00:37:37,359 --> 00:37:41,590
request

830
00:37:39,340 --> 00:37:43,570
had customers that just<font color="#E5E5E5"> don't understand</font>

831
00:37:41,590 --> 00:37:45,760
how to do a simple route map to SATA

832
00:37:43,570 --> 00:37:50,110
community and<font color="#CCCCCC"> will do this to get them</font>

833
00:37:45,760 --> 00:37:52,930
<font color="#E5E5E5">out of trouble going</font><font color="#CCCCCC"> back to</font><font color="#E5E5E5"> the</font>

834
00:37:50,110 --> 00:37:56,620
internal community design we tag every

835
00:37:52,930 --> 00:37:58,960
single prefix internally the<font color="#CCCCCC"> moment it</font>

836
00:37:56,620 --> 00:38:01,560
becomes a beach pier out in doing<font color="#CCCCCC"> so we</font>

837
00:37:58,960 --> 00:38:04,930
identify the pop where it came in the

838
00:38:01,560 --> 00:38:06,880
<font color="#E5E5E5">general requested exit handling and a</font>

839
00:38:04,930 --> 00:38:08,290
type of route so we can interpret where

840
00:38:06,880 --> 00:38:11,620
it's coming from and what's being<font color="#CCCCCC"> used</font>

841
00:38:08,290 --> 00:38:13,720
for one of the things that<font color="#E5E5E5"> we do with</font>

842
00:38:11,620 --> 00:38:16,270
that is<font color="#CCCCCC"> to use the pop of origin to</font>

843
00:38:13,720 --> 00:38:18,580
adjust med automatically it's a simple

844
00:38:16,270 --> 00:38:21,190
geo routing and it saved significant

845
00:38:18,580 --> 00:38:26,610
city to city land costs and<font color="#E5E5E5"> Link sizing</font>

846
00:38:21,190 --> 00:38:30,730
for us design is our<font color="#E5E5E5"> AS colon ABCDE</font>

847
00:38:26,610 --> 00:38:34,930
first digit is the route type customer

848
00:38:30,730 --> 00:38:38,380
hours or upstream bc covers up<font color="#CCCCCC"> to 100</font>

849
00:38:34,930 --> 00:38:41,740
pops so far five but we're about to add

850
00:38:38,380 --> 00:38:45,490
five more as part of the acquisition<font color="#E5E5E5"> d</font>

851
00:38:41,740 --> 00:38:47,439
is a<font color="#CCCCCC"> high-level desired tuning</font><font color="#E5E5E5"> 0 is</font>

852
00:38:45,490 --> 00:38:51,149
based on whatever we've cooked up

853
00:38:47,440 --> 00:38:53,710
overtime to keep links balanced one

854
00:38:51,150 --> 00:38:55,780
pretty much strips out any<font color="#E5E5E5"> of our tuning</font>

855
00:38:53,710 --> 00:38:59,380
and goes to whatever the providers would

856
00:38:55,780 --> 00:39:00,970
give us if untuned otherwise to is for

857
00:38:59,380 --> 00:39:03,610
backup and seven is for maintenance and

858
00:39:00,970 --> 00:39:06,669
the last bit indicates what to do from a

859
00:39:03,610 --> 00:39:10,510
<font color="#CCCCCC">geo routing perspective whether to apply</font>

860
00:39:06,670 --> 00:39:13,840
meds or not so here's a sample one 1457

861
00:39:10,510 --> 00:39:16,900
colon<font color="#E5E5E5"> 10 200 since a is one it's a</font>

862
00:39:13,840 --> 00:39:19,720
customer out since bc is 0-2 in our case

863
00:39:16,900 --> 00:39:21,820
<font color="#CCCCCC">it came from pop to which is Dallas D is</font>

864
00:39:19,720 --> 00:39:23,950
<font color="#E5E5E5">0 so we propagate it based on whatever</font>

865
00:39:21,820 --> 00:39:26,410
tuning we've cooked into our existing

866
00:39:23,950 --> 00:39:29,980
route maps<font color="#E5E5E5"> assuming that</font><font color="#CCCCCC"> you know and</font>

867
00:39:26,410 --> 00:39:31,990
there's no hook out to avoid them and<font color="#CCCCCC"> E</font>

868
00:39:29,980 --> 00:39:34,780
<font color="#E5E5E5">is 0 so</font><font color="#CCCCCC"> we now knit announce it as hot</font>

869
00:39:31,990 --> 00:39:38,919
potato which is a default med in all

870
00:39:34,780 --> 00:39:40,630
cities the geo routing for us is very

871
00:39:38,920 --> 00:39:42,070
simple I have a suspicion is going to

872
00:39:40,630 --> 00:39:44,080
grow to maybe a third tier right now

873
00:39:42,070 --> 00:39:46,630
it's basically<font color="#E5E5E5"> new</font><font color="#CCCCCC"> your verses far if</font>

874
00:39:44,080 --> 00:39:49,420
that internal community matches one 1457

875
00:39:46,630 --> 00:39:53,050
colon<font color="#CCCCCC"> four dots and a one last</font><font color="#E5E5E5"> digit</font>

876
00:39:49,420 --> 00:39:56,440
being one end it matches a nearby popov

877
00:39:53,050 --> 00:39:58,570
virgin and bc bits we set<font color="#CCCCCC"> ned to 200 if</font>

878
00:39:56,440 --> 00:40:01,390
the internal community matches<font color="#E5E5E5"> one</font><font color="#CCCCCC"> one</font>

879
00:39:58,570 --> 00:40:03,880
<font color="#CCCCCC">four five seven and then ends in a</font><font color="#E5E5E5"> I</font>

880
00:40:01,390 --> 00:40:06,910
have a typo there no that's right if it

881
00:40:03,880 --> 00:40:10,810
ends<font color="#E5E5E5"> in a one but it's not matching a bc</font>

882
00:40:06,910 --> 00:40:13,359
of a nearby pop that is 400 if the

883
00:40:10,810 --> 00:40:15,040
internal community ends in a zero it's

884
00:40:13,360 --> 00:40:21,960
going to<font color="#E5E5E5"> get med</font><font color="#CCCCCC"> of 200 whether near or</font>

885
00:40:15,040 --> 00:40:24,160
far extending that bgp community design

886
00:40:21,960 --> 00:40:27,010
develop a set of community so that your

887
00:40:24,160 --> 00:40:29,259
you and/or your customers can apply to

888
00:40:27,010 --> 00:40:31,890
<font color="#CCCCCC">those routes for tuning within your</font>

889
00:40:29,260 --> 00:40:33,670
network we allow our customers to do

890
00:40:31,890 --> 00:40:35,710
obviously<font color="#CCCCCC"> they're going to default to</font>

891
00:40:33,670 --> 00:40:37,180
customer level local preference they can

892
00:40:35,710 --> 00:40:40,510
choose peer level local preference or

893
00:40:37,180 --> 00:40:41,830
<font color="#CCCCCC">back up if they want to do a if they</font>

894
00:40:40,510 --> 00:40:44,560
have two connections and want to<font color="#E5E5E5"> do a</font>

895
00:40:41,830 --> 00:40:48,069
customer versus customer<font color="#CCCCCC"> backup or</font>

896
00:40:44,560 --> 00:40:49,930
<font color="#E5E5E5">pierre vs pure backup we tell them they</font>

897
00:40:48,070 --> 00:40:52,240
can do so using local you<font color="#E5E5E5"> know meds</font>

898
00:40:49,930 --> 00:40:54,480
within that level and local preference

899
00:40:52,240 --> 00:40:56,950
to get between<font color="#E5E5E5"> customer and peer a</font>

900
00:40:54,480 --> 00:40:58,990
little bit more complex than using the

901
00:40:56,950 --> 00:41:01,930
heavy hammer of local preference but

902
00:40:58,990 --> 00:41:03,790
it's more scalable and keeps our route

903
00:41:01,930 --> 00:41:09,210
maps cleaner and our local reference

904
00:41:03,790 --> 00:41:14,320
count cleaner so for the simple stuff

905
00:41:09,210 --> 00:41:19,360
one 1457 colon 200 300 or 400 is the

906
00:41:14,320 --> 00:41:21,670
customer<font color="#CCCCCC"> pier or transit levels or other</font>

907
00:41:19,360 --> 00:41:25,420
way around and of course the<font color="#CCCCCC"> colon 0 for</font>

908
00:41:21,670 --> 00:41:29,320
no routing we have<font color="#E5E5E5"> another set of</font>

909
00:41:25,420 --> 00:41:30,970
communities that we or our customers<font color="#CCCCCC"> can</font>

910
00:41:29,320 --> 00:41:33,070
apply<font color="#CCCCCC"> to routes for tuning outside our</font>

911
00:41:30,970 --> 00:41:35,109
network in in this case it's for our

912
00:41:33,070 --> 00:41:37,060
upstream providers we do not<font color="#E5E5E5"> you have</font>

913
00:41:35,110 --> 00:41:39,580
yet have any peers but this would scale

914
00:41:37,060 --> 00:41:41,620
to those as well we can mark prefixes

915
00:41:39,580 --> 00:41:45,069
for no advertise whether to one provider

916
00:41:41,620 --> 00:41:47,020
or all they<font color="#CCCCCC"> can set pre pens to those</font>

917
00:41:45,070 --> 00:41:49,090
providers that are<font color="#E5E5E5"> independent of</font>

918
00:41:47,020 --> 00:41:51,400
whatever they might announce in to us

919
00:41:49,090 --> 00:41:55,030
and they can also request local

920
00:41:51,400 --> 00:41:57,670
preference so here's a diagram<font color="#E5E5E5"> of our</font>

921
00:41:55,030 --> 00:41:59,410
tuning logic as it leaves our network we

922
00:41:57,670 --> 00:42:01,000
filter out any other<font color="#E5E5E5"> upstream routes</font>

923
00:41:59,410 --> 00:42:02,379
they have no sense<font color="#E5E5E5"> going back we don't</font>

924
00:42:01,000 --> 00:42:06,690
want to be a transit provider between

925
00:42:02,380 --> 00:42:08,640
our providers we allow routes from

926
00:42:06,690 --> 00:42:10,950
<font color="#CCCCCC">stammers</font><font color="#E5E5E5"> or our own flagged with</font>

927
00:42:08,640 --> 00:42:13,140
individual or global local preference or

928
00:42:10,950 --> 00:42:14,790
prepend requests and this does get a

929
00:42:13,140 --> 00:42:18,060
little complex to handle<font color="#E5E5E5"> multiple</font>

930
00:42:14,790 --> 00:42:20,069
combinations there in if we've<font color="#CCCCCC"> had any</font>

931
00:42:18,060 --> 00:42:21,660
of those requests we then hand it off to

932
00:42:20,069 --> 00:42:23,910
the<font color="#E5E5E5"> final logic that does the Med</font>

933
00:42:21,660 --> 00:42:26,970
selection if there were none of those

934
00:42:23,910 --> 00:42:29,069
requests we allow routes flagged with

935
00:42:26,970 --> 00:42:31,980
internal local preference<font color="#E5E5E5"> requests and</font>

936
00:42:29,069 --> 00:42:34,800
map a corresponding external local

937
00:42:31,980 --> 00:42:37,140
preference<font color="#CCCCCC"> request if there's nothing</font>

938
00:42:34,800 --> 00:42:39,780
<font color="#E5E5E5">there we processed routes based on their</font>

939
00:42:37,140 --> 00:42:42,029
embedded tuning that<font color="#CCCCCC"> D bit within the</font>

940
00:42:39,780 --> 00:42:44,040
internal community and likewise hand it

941
00:42:42,030 --> 00:42:46,109
off for meds one of the things<font color="#E5E5E5"> we've</font>

942
00:42:44,040 --> 00:42:50,759
found the hard way in the beginning<font color="#CCCCCC"> is</font>

943
00:42:46,109 --> 00:42:53,369
that<font color="#E5E5E5"> if a customer through communities</font>

944
00:42:50,760 --> 00:42:56,310
or other route map tuning ever requests

945
00:42:53,369 --> 00:42:59,849
to be<font color="#E5E5E5"> treated inside our network as a</font>

946
00:42:56,310 --> 00:43:03,500
peer it becomes essential to announce

947
00:42:59,849 --> 00:43:05,579
<font color="#E5E5E5">that prefix outward as a peer as well</font>

948
00:43:03,500 --> 00:43:08,460
otherwise you end up<font color="#E5E5E5"> with a certain</font>

949
00:43:05,579 --> 00:43:12,390
stickiness that if they ever fail over

950
00:43:08,460 --> 00:43:14,819
<font color="#E5E5E5">to us external routing will then glue to</font>

951
00:43:12,390 --> 00:43:17,460
our transits<font color="#E5E5E5"> and when their primary link</font>

952
00:43:14,819 --> 00:43:19,920
comes back up our transit still like the

953
00:43:17,460 --> 00:43:22,650
<font color="#E5E5E5">route coming from us because the they</font>

954
00:43:19,920 --> 00:43:25,349
see it as a customer route they will

955
00:43:22,650 --> 00:43:27,890
stick to us<font color="#CCCCCC"> until the customer breaks</font>

956
00:43:25,349 --> 00:43:35,190
their link with us causing additional

957
00:43:27,890 --> 00:43:38,430
pain flap dampening etc so using those

958
00:43:35,190 --> 00:43:40,980
meds for geo routing we quote unquote

959
00:43:38,430 --> 00:43:42,839
enjoy parallel connectivity to three

960
00:43:40,980 --> 00:43:45,030
different transit providers for each of

961
00:43:42,839 --> 00:43:47,069
those providers we have a link to<font color="#E5E5E5"> that</font>

962
00:43:45,030 --> 00:43:52,290
network in<font color="#CCCCCC"> dallas</font><font color="#E5E5E5"> and a second link to</font>

963
00:43:47,069 --> 00:43:55,589
that network in<font color="#E5E5E5"> houston so for outbound</font>

964
00:43:52,290 --> 00:43:59,150
routing we receive those providers

965
00:43:55,589 --> 00:44:03,210
routes and their customers routes and

966
00:43:59,150 --> 00:44:05,190
rely on the meds learn from them most

967
00:44:03,210 --> 00:44:08,010
likely any other routes we learn our

968
00:44:05,190 --> 00:44:10,109
peers perhaps they are purchasing

969
00:44:08,010 --> 00:44:14,160
transit<font color="#CCCCCC"> I'm not certain about one of our</font>

970
00:44:10,109 --> 00:44:15,930
networks regardless we zero out the meds

971
00:44:14,160 --> 00:44:19,040
on anything we get that's beyond them

972
00:44:15,930 --> 00:44:19,040
that's not a customer route

973
00:44:19,760 --> 00:44:23,960
if they can't give<font color="#CCCCCC"> us much direction</font><font color="#E5E5E5"> on</font>

974
00:44:22,070 --> 00:44:25,850
where to send it no sense us trying to

975
00:44:23,960 --> 00:44:30,830
<font color="#E5E5E5">send it through multiple links of our</font>

976
00:44:25,850 --> 00:44:33,529
own<font color="#CCCCCC"> and it works well because a normal</font>

977
00:44:30,830 --> 00:44:37,150
state cold potato sending it straight

978
00:44:33,530 --> 00:44:40,430
<font color="#CCCCCC">out to them you're sending it through a</font>

979
00:44:37,150 --> 00:44:42,500
preferred med value is<font color="#E5E5E5"> only one hop</font>

980
00:44:40,430 --> 00:44:44,720
longer than hot potato sending<font color="#E5E5E5"> it</font>

981
00:44:42,500 --> 00:44:46,820
straight at the local city and the

982
00:44:44,720 --> 00:44:49,310
assumption<font color="#E5E5E5"> is we know our network we</font>

983
00:44:46,820 --> 00:44:53,990
<font color="#E5E5E5">know we've done very careful</font><font color="#CCCCCC"> igp metric</font>

984
00:44:49,310 --> 00:44:58,580
Design it's<font color="#CCCCCC"> working for us we know that</font>

985
00:44:53,990 --> 00:45:01,580
we've chosen good backbone networks we

986
00:44:58,580 --> 00:45:05,480
assume they've done a lot<font color="#CCCCCC"> of careful igp</font>

987
00:45:01,580 --> 00:45:08,779
metric Design and<font color="#E5E5E5"> so forth but we know</font>

988
00:45:05,480 --> 00:45:10,400
our network better than we<font color="#E5E5E5"> know their</font>

989
00:45:08,780 --> 00:45:13,130
network we don't<font color="#E5E5E5"> know what they use for</font>

990
00:45:10,400 --> 00:45:16,070
med values how significant they are if

991
00:45:13,130 --> 00:45:17,750
there's a way<font color="#E5E5E5"> to add to them there's</font>

992
00:45:16,070 --> 00:45:21,050
certainly no way to multiply them within

993
00:45:17,750 --> 00:45:23,300
our route maps so if they're<font color="#E5E5E5"> telling us</font>

994
00:45:21,050 --> 00:45:26,000
that a particular pop is better we<font color="#E5E5E5"> will</font>

995
00:45:23,300 --> 00:45:29,690
use it but<font color="#E5E5E5"> only on their routes and</font>

996
00:45:26,000 --> 00:45:32,420
their customers because the assumption

997
00:45:29,690 --> 00:45:35,390
is<font color="#E5E5E5"> the</font><font color="#CCCCCC"> med learned is in some way tied</font>

998
00:45:32,420 --> 00:45:39,410
to<font color="#CCCCCC"> IGP distance fiber</font><font color="#E5E5E5"> kilometers some</font>

999
00:45:35,390 --> 00:45:41,330
other vector towards wherever that

1000
00:45:39,410 --> 00:45:46,270
particular prefix is going into their

1001
00:45:41,330 --> 00:45:50,840
network so if it's let's say one of

1002
00:45:46,270 --> 00:45:53,630
entity various aggregate prefixes think

1003
00:45:50,840 --> 00:45:56,720
<font color="#E5E5E5">they've got 157</font><font color="#CCCCCC"> 229 or something like</font>

1004
00:45:53,630 --> 00:46:00,440
that we know they're going to originate

1005
00:45:56,720 --> 00:46:02,089
it on some subset of their core we

1006
00:46:00,440 --> 00:46:05,180
assume that that is going<font color="#E5E5E5"> to be</font>

1007
00:46:02,090 --> 00:46:07,550
<font color="#E5E5E5">announced to us in dallas and in houston</font>

1008
00:46:05,180 --> 00:46:11,169
with some representation of how far it

1009
00:46:07,550 --> 00:46:13,340
is to that particular injection point

1010
00:46:11,170 --> 00:46:19,970
for their customers let's say they have

1011
00:46:13,340 --> 00:46:23,630
a customer in<font color="#CCCCCC"> atlanta we know that that</font>

1012
00:46:19,970 --> 00:46:25,730
customer is most likely better reached

1013
00:46:23,630 --> 00:46:28,220
through<font color="#CCCCCC"> houston which is geographically</font>

1014
00:46:25,730 --> 00:46:31,910
closer to<font color="#E5E5E5"> atlanta then</font><font color="#CCCCCC"> dallas</font><font color="#E5E5E5"> would be</font>

1015
00:46:28,220 --> 00:46:33,740
for us so if they're giving<font color="#E5E5E5"> us med it's</font>

1016
00:46:31,910 --> 00:46:35,930
probably tied to that distance

1017
00:46:33,740 --> 00:46:38,118
some other link costs like that and

1018
00:46:35,930 --> 00:46:40,490
<font color="#CCCCCC">we'll choose to send that traffic</font>

1019
00:46:38,119 --> 00:46:43,490
through our network to<font color="#E5E5E5"> Houston to give</font>

1020
00:46:40,490 --> 00:46:44,660
<font color="#E5E5E5">to in this example</font><font color="#CCCCCC"> NTT and let them</font>

1021
00:46:43,490 --> 00:46:46,910
carry it to Atlanta to go to the

1022
00:46:44,660 --> 00:46:48,290
customer so we feel that it's a pretty

1023
00:46:46,910 --> 00:46:52,460
good<font color="#E5E5E5"> balance between trying to do the</font>

1024
00:46:48,290 --> 00:46:55,460
right thing internally and trying to try

1025
00:46:52,460 --> 00:47:00,860
<font color="#E5E5E5">too hard and send traffic on funny</font>

1026
00:46:55,460 --> 00:47:04,010
circles so obviously we have numerous

1027
00:47:00,860 --> 00:47:05,810
customers that do BGP we respect that

1028
00:47:04,010 --> 00:47:08,720
many perhaps<font color="#CCCCCC"> even all</font><font color="#E5E5E5"> of them have</font>

1029
00:47:05,810 --> 00:47:09,980
little to no<font color="#CCCCCC"> bgp experience most of the</font>

1030
00:47:08,720 --> 00:47:12,230
customers that we've had that we're

1031
00:47:09,980 --> 00:47:14,390
<font color="#CCCCCC">doing any sort of multihoming were doing</font>

1032
00:47:12,230 --> 00:47:18,320
so<font color="#E5E5E5"> merely for the sake of transitioning</font>

1033
00:47:14,390 --> 00:47:23,350
from old provider to us and they perhaps

1034
00:47:18,320 --> 00:47:25,790
had<font color="#CCCCCC"> a</font><font color="#E5E5E5"> errand assigned prefix block and</font>

1035
00:47:23,350 --> 00:47:27,140
felt that it would look best on the

1036
00:47:25,790 --> 00:47:28,580
internet if they were announcing it from

1037
00:47:27,140 --> 00:47:33,589
their own a ass when in fact we know

1038
00:47:28,580 --> 00:47:35,150
that<font color="#E5E5E5"> doesn't really matter as long as</font>

1039
00:47:33,590 --> 00:47:37,280
that customer sends is just their

1040
00:47:35,150 --> 00:47:40,730
aggregate routes with a reasonable<font color="#CCCCCC"> a</font><font color="#E5E5E5"> s</font>

1041
00:47:37,280 --> 00:47:42,500
path and they don't dump their entire

1042
00:47:40,730 --> 00:47:44,660
table or at least so many that it bumps

1043
00:47:42,500 --> 00:47:47,900
up against<font color="#E5E5E5"> max prefix everything works</font>

1044
00:47:44,660 --> 00:47:49,399
fine if the customer requests will apply

1045
00:47:47,900 --> 00:47:51,830
reasonable tweaks we've often had

1046
00:47:49,400 --> 00:47:55,640
customers who had a link to us and a

1047
00:47:51,830 --> 00:47:57,650
link to a<font color="#E5E5E5"> Tier one and find that a lot</font>

1048
00:47:55,640 --> 00:47:59,600
of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> traffic comes in through us will</font>

1049
00:47:57,650 --> 00:48:02,240
often mark their prefix<font color="#E5E5E5"> to be treated as</font>

1050
00:47:59,600 --> 00:48:05,060
a peer in our providers which tends to

1051
00:48:02,240 --> 00:48:06,859
rebalance things well otherwise we tell

1052
00:48:05,060 --> 00:48:08,779
them look here's a web page with all of

1053
00:48:06,859 --> 00:48:11,810
our current<font color="#E5E5E5"> communities you can do it</font>

1054
00:48:08,780 --> 00:48:13,220
with BGP route maps on your<font color="#E5E5E5"> own end at</font>

1055
00:48:11,810 --> 00:48:15,680
whatever hour you<font color="#E5E5E5"> want to do it you</font>

1056
00:48:13,220 --> 00:48:17,060
never<font color="#E5E5E5"> have to call us and a few folks</font>

1057
00:48:15,680 --> 00:48:18,950
<font color="#CCCCCC">who've had enough clue to try and use</font>

1058
00:48:17,060 --> 00:48:21,350
that have<font color="#E5E5E5"> found they've got all the</font>

1059
00:48:18,950 --> 00:48:26,649
knobs they need even in us<font color="#CCCCCC"> a perhaps</font>

1060
00:48:21,350 --> 00:48:26,650
tier<font color="#CCCCCC"> 3 totally transit dependent network</font>

1061
00:48:26,890 --> 00:48:31,339
moving on to traffic engineering

1062
00:48:29,390 --> 00:48:35,210
redundancy especially in a small

1063
00:48:31,340 --> 00:48:37,900
minimally mesh network for cities for us

1064
00:48:35,210 --> 00:48:42,050
would theoretically need six links for

1065
00:48:37,900 --> 00:48:46,310
full mesh we've got five we do some

1066
00:48:42,050 --> 00:48:47,720
subset of regular simulations but it's

1067
00:48:46,310 --> 00:48:50,930
not very conducive in our

1068
00:48:47,720 --> 00:48:53,299
<font color="#CCCCCC">to efficient redundancy favorite quote</font>

1069
00:48:50,930 --> 00:48:57,080
of mine from GI<font color="#E5E5E5"> Jane to means one and</font>

1070
00:48:53,300 --> 00:48:59,000
one means none if you've got<font color="#E5E5E5"> two links</font>

1071
00:48:57,080 --> 00:49:01,180
you can fall down to<font color="#E5E5E5"> one but if you have</font>

1072
00:48:59,000 --> 00:49:03,890
one link and it fails you've got nothing

1073
00:49:01,180 --> 00:49:05,779
unfortunately two to one means half your

1074
00:49:03,890 --> 00:49:08,029
capacity ins of being excess we are such

1075
00:49:05,780 --> 00:49:10,369
a small network that in many cases we've

1076
00:49:08,030 --> 00:49:14,180
<font color="#CCCCCC">got to go with 2n redundancy to have any</font>

1077
00:49:10,369 --> 00:49:16,849
redundancy yuck getting around<font color="#CCCCCC"> this</font>

1078
00:49:14,180 --> 00:49:20,270
based on multiple ds3 is running between

1079
00:49:16,849 --> 00:49:23,810
certain key cities then multiple OC 3s

1080
00:49:20,270 --> 00:49:27,200
as we grew well mpls traffic engineering

1081
00:49:23,810 --> 00:49:29,630
saved our network normal<font color="#CCCCCC"> igp routing is</font>

1082
00:49:27,200 --> 00:49:31,640
completely unaware of traffic saturation

1083
00:49:29,630 --> 00:49:33,859
<font color="#E5E5E5">until there's so much traffic that those</font>

1084
00:49:31,640 --> 00:49:35,629
keep alives go boom and in<font color="#E5E5E5"> that case</font>

1085
00:49:33,859 --> 00:49:37,819
you're in a<font color="#E5E5E5"> very bad situation anyway</font>

1086
00:49:35,630 --> 00:49:42,020
but it's just messy trying to send

1087
00:49:37,820 --> 00:49:43,609
traffic a long way mpls te enables our

1088
00:49:42,020 --> 00:49:45,530
routers to spread our traffic over

1089
00:49:43,609 --> 00:49:47,930
multiple paths including those that are

1090
00:49:45,530 --> 00:49:50,390
not on the shortest<font color="#CCCCCC"> igp path so we've</font>

1091
00:49:47,930 --> 00:49:52,460
often used call it backdoor paths

1092
00:49:50,390 --> 00:49:56,029
through austin and through san antonio

1093
00:49:52,460 --> 00:49:58,880
which were secondary pops aside from our

1094
00:49:56,030 --> 00:50:01,010
main<font color="#E5E5E5"> dallas and houston sites and it's</font>

1095
00:49:58,880 --> 00:50:05,270
done using one-way tunnels between

1096
00:50:01,010 --> 00:50:06,859
routers initially we<font color="#CCCCCC"> had a full mesh of</font>

1097
00:50:05,270 --> 00:50:09,190
tunnels between all of our distribution

1098
00:50:06,859 --> 00:50:11,990
routers and all of<font color="#E5E5E5"> our edge routers</font>

1099
00:50:09,190 --> 00:50:15,380
sometimes one sometimes two tunnels in

1100
00:50:11,990 --> 00:50:18,500
each router pairing depending<font color="#CCCCCC"> on traffic</font>

1101
00:50:15,380 --> 00:50:21,470
loads we ran very aggressive 15-minute

1102
00:50:18,500 --> 00:50:24,290
automatic bandwidth rescaling timers so

1103
00:50:21,470 --> 00:50:25,970
those tunnels rapidly reflected how much

1104
00:50:24,290 --> 00:50:29,000
traffic they were actually carrying and

1105
00:50:25,970 --> 00:50:31,939
those tunnels would then redistribute

1106
00:50:29,000 --> 00:50:35,780
their traffic across the backbone very

1107
00:50:31,940 --> 00:50:38,180
rapidly and because we often<font color="#E5E5E5"> had two</font>

1108
00:50:35,780 --> 00:50:41,960
three sometimes four<font color="#CCCCCC"> DS 3s over</font><font color="#E5E5E5"> the</font>

1109
00:50:38,180 --> 00:50:44,419
primary path and in some cases a hundred

1110
00:50:41,960 --> 00:50:46,460
and<font color="#E5E5E5"> twenty megabits per second maybe 140</font>

1111
00:50:44,420 --> 00:50:48,650
megabits per second trying to reverse

1112
00:50:46,460 --> 00:50:53,960
those 40 s 3 s it was<font color="#CCCCCC"> a very tight fit</font>

1113
00:50:48,650 --> 00:50:56,599
it was the<font color="#CCCCCC"> only way we survived but we</font>

1114
00:50:53,960 --> 00:51:00,020
got squeezed because we had a customer

1115
00:50:56,599 --> 00:51:01,420
who<font color="#CCCCCC"> set up a news server and those news</font>

1116
00:51:00,020 --> 00:51:03,430
feeds would get glued to a

1117
00:51:01,420 --> 00:51:06,099
<font color="#E5E5E5">tunnel so our best bet in these cases</font>

1118
00:51:03,430 --> 00:51:09,819
were to add more tunnels over particular

1119
00:51:06,099 --> 00:51:14,200
<font color="#E5E5E5">edge distribution pairs we went to for</font>

1120
00:51:09,819 --> 00:51:16,450
primarily to get traffic to hash over

1121
00:51:14,200 --> 00:51:18,700
multiple tunnels we knew that that nntp

1122
00:51:16,450 --> 00:51:20,649
flow would fit to one tunnel and

1123
00:51:18,700 --> 00:51:22,808
hopefully almost all the other traffic

1124
00:51:20,650 --> 00:51:25,390
running from edge to distant dis to edge

1125
00:51:22,809 --> 00:51:28,480
would pick the other three tunnels which

1126
00:51:25,390 --> 00:51:30,460
pretty much did gave us the granularity

1127
00:51:28,480 --> 00:51:34,450
next necessary to rebalance all that

1128
00:51:30,460 --> 00:51:36,369
traffic and the<font color="#E5E5E5"> flip side is</font><font color="#CCCCCC"> that all of</font>

1129
00:51:34,450 --> 00:51:38,828
our redundant capacity<font color="#E5E5E5"> back up paths</font>

1130
00:51:36,369 --> 00:51:40,930
longer pass<font color="#E5E5E5"> what have you can usually</font>

1131
00:51:38,829 --> 00:51:42,549
get used by accident because<font color="#E5E5E5"> you don't</font>

1132
00:51:40,930 --> 00:51:44,890
<font color="#CCCCCC">really</font><font color="#E5E5E5"> have an easy metric as to how</font>

1133
00:51:42,549 --> 00:51:46,690
much of that excess capacity or that

1134
00:51:44,890 --> 00:51:50,618
excess traffic is<font color="#CCCCCC"> travelling around</font><font color="#E5E5E5"> a</font>

1135
00:51:46,690 --> 00:51:54,910
non shortest path wow you can end up

1136
00:51:50,619 --> 00:51:57,549
with quick surprises when your

1137
00:51:54,910 --> 00:51:59,078
redundancy just isn't there however<font color="#E5E5E5"> that</font>

1138
00:51:57,549 --> 00:52:01,750
excess capacity can be used during

1139
00:51:59,079 --> 00:52:04,510
momentary surprises we've had a few

1140
00:52:01,750 --> 00:52:06,369
customers still have one that just

1141
00:52:04,510 --> 00:52:09,099
seemed to be a<font color="#CCCCCC"> bit of</font><font color="#E5E5E5"> a magnet for dos</font>

1142
00:52:06,369 --> 00:52:10,270
attacks and when they<font color="#E5E5E5"> would get dust at</font>

1143
00:52:09,099 --> 00:52:12,309
least the network<font color="#E5E5E5"> would take care of</font>

1144
00:52:10,270 --> 00:52:15,339
<font color="#CCCCCC">itself we'd use up all available</font>

1145
00:52:12,309 --> 00:52:18,369
redundancy<font color="#CCCCCC"> for that event but at least</font>

1146
00:52:15,339 --> 00:52:19,990
we kept running<font color="#E5E5E5"> and the rest of our</font>

1147
00:52:18,369 --> 00:52:23,920
customers are<font color="#E5E5E5"> not so severely affected</font>

1148
00:52:19,990 --> 00:52:26,470
by that das attack<font color="#CCCCCC"> long-term we ended up</font>

1149
00:52:23,920 --> 00:52:29,440
with iOS version mismatches on different

1150
00:52:26,470 --> 00:52:31,720
routers and something just<font color="#CCCCCC"> wasn't right</font>

1151
00:52:29,440 --> 00:52:35,020
we could never get cisco tac to identify

1152
00:52:31,720 --> 00:52:38,819
what was truly going<font color="#E5E5E5"> on but it just</font>

1153
00:52:35,020 --> 00:52:44,829
wasn't working knowing<font color="#CCCCCC"> that our core is</font>

1154
00:52:38,819 --> 00:52:46,540
entirely GSR almost we migrated to just

1155
00:52:44,829 --> 00:52:48,549
using mpls traffic engineering over our

1156
00:52:46,540 --> 00:52:50,200
Hwang links which natively were smallest

1157
00:52:48,549 --> 00:52:54,460
links and the ones<font color="#E5E5E5"> that were the most</font>

1158
00:52:50,200 --> 00:52:58,689
<font color="#E5E5E5">likely to need protection each link gets</font>

1159
00:52:54,460 --> 00:53:00,309
four tunnels so<font color="#E5E5E5"> therefore if one of</font>

1160
00:52:58,690 --> 00:53:02,049
those tunnels has to find a less than

1161
00:53:00,309 --> 00:53:04,240
<font color="#E5E5E5">shortest path</font><font color="#CCCCCC"> away from point A to point</font>

1162
00:53:02,049 --> 00:53:06,640
B only<font color="#CCCCCC"> about a quarter of</font><font color="#E5E5E5"> the traffic</font>

1163
00:53:04,240 --> 00:53:09,879
over that link swings a particular time

1164
00:53:06,640 --> 00:53:11,859
and therefore<font color="#E5E5E5"> the traffic follows the</font>

1165
00:53:09,880 --> 00:53:14,990
shortest path except in the face of

1166
00:53:11,859 --> 00:53:16,910
congestion and so we

1167
00:53:14,990 --> 00:53:21,500
stay back<font color="#CCCCCC"> to as close as simple as we</font>

1168
00:53:16,910 --> 00:53:23,060
can predictable rarely have to explain

1169
00:53:21,500 --> 00:53:25,220
to<font color="#CCCCCC"> people why traffic's going the long</font>

1170
00:53:23,060 --> 00:53:28,190
way but<font color="#E5E5E5"> it does happen every now and</font>

1171
00:53:25,220 --> 00:53:33,220
then<font color="#E5E5E5"> but</font><font color="#CCCCCC"> it keeps us back towards a very</font>

1172
00:53:28,190 --> 00:53:33,220
default traffic flow most of the time

1173
00:53:33,880 --> 00:53:39,380
changing topics to network monitoring

1174
00:53:37,240 --> 00:53:42,080
obviously we<font color="#CCCCCC"> all have small budgets for</font>

1175
00:53:39,380 --> 00:53:44,510
tools consider taking off the shelf

1176
00:53:42,080 --> 00:53:48,610
stuff and kind of home brewing some

1177
00:53:44,510 --> 00:53:51,980
tweaks and modifications on to that<font color="#E5E5E5"> and</font>

1178
00:53:48,610 --> 00:53:53,390
do what you can to put<font color="#CCCCCC"> information in</font>

1179
00:53:51,980 --> 00:53:57,080
front of your<font color="#E5E5E5"> support folks you're not</font>

1180
00:53:53,390 --> 00:53:58,670
in your<font color="#E5E5E5"> helpdesk and whatnot and perhaps</font>

1181
00:53:57,080 --> 00:54:00,680
you won't even have<font color="#E5E5E5"> to share enable that</font>

1182
00:53:58,670 --> 00:54:02,510
much with your NOC folks because they'll

1183
00:54:00,680 --> 00:54:07,069
be<font color="#CCCCCC"> able to figure</font><font color="#E5E5E5"> out what's going on a</font>

1184
00:54:02,510 --> 00:54:09,619
lot<font color="#E5E5E5"> quicker our analysis analysis said</font>

1185
00:54:07,070 --> 00:54:13,220
there were three problems to solve right

1186
00:54:09,619 --> 00:54:15,590
now what is up or down that's perhaps

1187
00:54:13,220 --> 00:54:18,589
what you might use whatsup gold or HP

1188
00:54:15,590 --> 00:54:21,050
<font color="#E5E5E5">openview for analysis of what happened</font>

1189
00:54:18,590 --> 00:54:23,119
when whether it's simple with syslog or

1190
00:54:21,050 --> 00:54:24,410
sure there's other tools that capture

1191
00:54:23,119 --> 00:54:28,040
that and show what's going on and then

1192
00:54:24,410 --> 00:54:30,279
<font color="#CCCCCC">how many bits packets</font><font color="#E5E5E5"> errors what have</font>

1193
00:54:28,040 --> 00:54:32,300
you are flowing through the network

1194
00:54:30,280 --> 00:54:35,390
obviously different tools to solve each

1195
00:54:32,300 --> 00:54:38,150
problem the two biggest things<font color="#E5E5E5"> for us</font>

1196
00:54:35,390 --> 00:54:39,950
for<font color="#E5E5E5"> mr TG to be able to figure out what</font>

1197
00:54:38,150 --> 00:54:43,190
our trends were and what our traffic was

1198
00:54:39,950 --> 00:54:44,569
and homebrew enhancements that really

1199
00:54:43,190 --> 00:54:47,180
tuned it up and<font color="#E5E5E5"> make it useful</font><font color="#CCCCCC"> for our</font>

1200
00:54:44,570 --> 00:54:49,670
<font color="#E5E5E5">people and then syslog to show what's</font>

1201
00:54:47,180 --> 00:54:52,310
happening right<font color="#CCCCCC"> now on the network the</font>

1202
00:54:49,670 --> 00:54:54,800
<font color="#CCCCCC">mr TG that we've deployed has simple</font>

1203
00:54:52,310 --> 00:54:58,160
links on each customer facing port for a

1204
00:54:54,800 --> 00:55:01,490
cutesy network diagram a link to be able

1205
00:54:58,160 --> 00:55:04,460
<font color="#E5E5E5">to telnet to the CPE and a how-to guide</font>

1206
00:55:01,490 --> 00:55:08,810
<font color="#CCCCCC">on how to configure our standard CPE so</font>

1207
00:55:04,460 --> 00:55:11,660
that if we provision the custom report

1208
00:55:08,810 --> 00:55:14,600
any time during<font color="#E5E5E5"> the day tomorrow</font><font color="#CCCCCC"> morning</font>

1209
00:55:11,660 --> 00:55:17,629
at 6am all these tools get updated and

1210
00:55:14,600 --> 00:55:18,950
created so that as long<font color="#CCCCCC"> as we do</font><font color="#E5E5E5"> it a</font>

1211
00:55:17,630 --> 00:55:21,200
day before<font color="#CCCCCC"> the technician</font><font color="#E5E5E5"> would be</font>

1212
00:55:18,950 --> 00:55:23,419
configuring the CPE he doesn't have to

1213
00:55:21,200 --> 00:55:25,759
ask anybody it's got step by step with

1214
00:55:23,420 --> 00:55:28,310
IP address values and channel

1215
00:55:25,760 --> 00:55:29,960
assignments already coded in

1216
00:55:28,310 --> 00:55:31,820
automatically generated there's a

1217
00:55:29,960 --> 00:55:33,920
diagram<font color="#CCCCCC"> showing them what routes are</font>

1218
00:55:31,820 --> 00:55:35,840
sent where we've had<font color="#E5E5E5"> knock personnel</font>

1219
00:55:33,920 --> 00:55:37,880
just capture that in a screenshot and

1220
00:55:35,840 --> 00:55:39,490
email to<font color="#E5E5E5"> the customer when they want to</font>

1221
00:55:37,880 --> 00:55:41,720
see it in a graphical manner and

1222
00:55:39,490 --> 00:55:44,479
likewise their syslog has a pearl

1223
00:55:41,720 --> 00:55:47,660
wrapper that color codes up as green and

1224
00:55:44,480 --> 00:55:50,900
down<font color="#E5E5E5"> as read and substitutes in the</font>

1225
00:55:47,660 --> 00:55:54,259
interface description value learned as

1226
00:55:50,900 --> 00:55:56,150
part of our regular<font color="#CCCCCC"> em RTG configuration</font>

1227
00:55:54,260 --> 00:55:58,760
generation so<font color="#CCCCCC"> that when an interface</font>

1228
00:55:56,150 --> 00:56:00,910
goes up or down the log entry has a

1229
00:55:58,760 --> 00:56:04,010
local<font color="#E5E5E5"> meaning by showing the customers</font>

1230
00:56:00,910 --> 00:56:06,620
representation so it's a<font color="#E5E5E5"> little</font>

1231
00:56:04,010 --> 00:56:08,690
scrunched for the PDF but you can get<font color="#E5E5E5"> an</font>

1232
00:56:06,620 --> 00:56:11,029
<font color="#CCCCCC">idea this is a sample of our automatic</font>

1233
00:56:08,690 --> 00:56:13,610
<font color="#CCCCCC">network diagrams for a customer in one</font>

1234
00:56:11,030 --> 00:56:17,030
of our<font color="#CCCCCC"> cities shows the distribution</font>

1235
00:56:13,610 --> 00:56:21,830
router with inner<font color="#E5E5E5"> co shows that in this</font>

1236
00:56:17,030 --> 00:56:25,370
case it's on router dist for interface

1237
00:56:21,830 --> 00:56:28,240
card s 3 x 0<font color="#E5E5E5"> t 1 number 7 and time slots</font>

1238
00:56:25,370 --> 00:56:32,390
1 through 15 shows the<font color="#E5E5E5"> LAN Network</font>

1239
00:56:28,240 --> 00:56:34,250
mapped from distribution<font color="#E5E5E5"> to cpe specific</font>

1240
00:56:32,390 --> 00:56:36,140
<font color="#E5E5E5">endpoint addresses for people to</font>

1241
00:56:34,250 --> 00:56:37,850
reference and<font color="#CCCCCC"> then whatever</font><font color="#E5E5E5"> the</font>

1242
00:56:36,140 --> 00:56:39,980
<font color="#E5E5E5">customers network is is represented the</font>

1243
00:56:37,850 --> 00:56:43,549
bottom whatever their land block or land

1244
00:56:39,980 --> 00:56:45,350
blocks are the likely land gateway even

1245
00:56:43,550 --> 00:56:46,730
though from a distribution router we

1246
00:56:45,350 --> 00:56:48,950
have no easy way<font color="#CCCCCC"> of knowing what's going</font>

1247
00:56:46,730 --> 00:56:50,780
to be assigned because some of the

1248
00:56:48,950 --> 00:56:54,770
<font color="#CCCCCC">customers may choose to subnet further</font>

1249
00:56:50,780 --> 00:56:56,660
and then these on RMR<font color="#E5E5E5"> TG page are</font>

1250
00:56:54,770 --> 00:56:59,090
clickable links to give people<font color="#E5E5E5"> a</font>

1251
00:56:56,660 --> 00:57:00,799
translation<font color="#E5E5E5"> of what / 28 actually means</font>

1252
00:56:59,090 --> 00:57:03,050
so they don't<font color="#CCCCCC"> have</font><font color="#E5E5E5"> to have</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> printed</font>

1253
00:57:00,800 --> 00:57:04,610
out and taped to their cork board next

1254
00:57:03,050 --> 00:57:06,770
to their desk it's always available when

1255
00:57:04,610 --> 00:57:08,030
they're looking<font color="#E5E5E5"> at one of</font><font color="#CCCCCC"> the most</font>

1256
00:57:06,770 --> 00:57:11,120
likely places<font color="#E5E5E5"> they'd be looking at a</font>

1257
00:57:08,030 --> 00:57:13,190
<font color="#CCCCCC">slash notation and if by chance there's</font>

1258
00:57:11,120 --> 00:57:14,770
any sort<font color="#E5E5E5"> of extra admin distance</font>

1259
00:57:13,190 --> 00:57:17,870
configured on the router configuration

1260
00:57:14,770 --> 00:57:20,600
we have<font color="#CCCCCC"> a table that</font><font color="#E5E5E5"> shows the all the</font>

1261
00:57:17,870 --> 00:57:23,720
different values within a cisco iOS for

1262
00:57:20,600 --> 00:57:26,779
those distances and if by<font color="#CCCCCC"> chance there's</font>

1263
00:57:23,720 --> 00:57:29,270
an internal tag which for us<font color="#E5E5E5"> the only</font>

1264
00:57:26,780 --> 00:57:32,270
tags we're using is on our black hole

1265
00:57:29,270 --> 00:57:35,090
server we<font color="#CCCCCC"> tag</font><font color="#E5E5E5"> black hole routes as 666</font>

1266
00:57:32,270 --> 00:57:38,570
but the hook is there to make it<font color="#E5E5E5"> easy to</font>

1267
00:57:35,090 --> 00:57:41,120
show the staff what's going on likewise

1268
00:57:38,570 --> 00:57:42,109
here's a modified snapshot of our log

1269
00:57:41,120 --> 00:57:44,808
watcher

1270
00:57:42,109 --> 00:57:49,038
just six<font color="#E5E5E5"> Dallas is our t1 distribution</font>

1271
00:57:44,809 --> 00:57:51,079
router in<font color="#CCCCCC"> Dallas and the other day one</font>

1272
00:57:49,039 --> 00:57:53,239
in the<font color="#CCCCCC"> afternoon customer p.m. real</font>

1273
00:57:51,079 --> 00:57:59,440
Realty and the location on dallas

1274
00:57:53,239 --> 00:58:03,950
parkway must have had a 32 second outage

1275
00:57:59,440 --> 00:58:05,480
another one that's about 30 seconds so

1276
00:58:03,950 --> 00:58:08,210
my suspicion is for one reason or

1277
00:58:05,480 --> 00:58:10,549
another<font color="#CCCCCC"> there cpe got rebooted there the</font>

1278
00:58:08,210 --> 00:58:12,769
adtran<font color="#E5E5E5"> CB that we often</font><font color="#CCCCCC"> use takes about</font>

1279
00:58:10,549 --> 00:58:15,829
30 seconds at least<font color="#CCCCCC"> from a t1</font>

1280
00:58:12,769 --> 00:58:17,959
perspective down to up so it marked in

1281
00:58:15,829 --> 00:58:20,150
here that the interface in this case the

1282
00:58:17,960 --> 00:58:21,470
line protocol went down shows again when

1283
00:58:20,150 --> 00:58:25,369
the controller and the interface comes

1284
00:58:21,470 --> 00:58:27,259
up and second reboot of some form<font color="#E5E5E5"> and so</font>

1285
00:58:25,369 --> 00:58:30,650
this allows<font color="#E5E5E5"> our NOC to see what's going</font>

1286
00:58:27,259 --> 00:58:33,440
on on a per customer<font color="#CCCCCC"> level some quick</font>

1287
00:58:30,650 --> 00:58:38,239
representation of what's important and

1288
00:58:33,440 --> 00:58:41,960
what's not we mark loopback<font color="#E5E5E5"> messages</font>

1289
00:58:38,239 --> 00:58:44,359
loopback shows up in blue and ospf and

1290
00:58:41,960 --> 00:58:45,859
bgp messages show up in yellow simple

1291
00:58:44,359 --> 00:58:50,089
way for them to say hey is this

1292
00:58:45,859 --> 00:58:52,369
important is it not important assuming

1293
00:58:50,089 --> 00:58:56,630
that<font color="#E5E5E5"> they're actually</font><font color="#CCCCCC"> watching it which</font>

1294
00:58:52,369 --> 00:58:57,890
can be potluck but gives them the tool

1295
00:58:56,630 --> 00:59:01,460
that if the customer calls in and says

1296
00:58:57,890 --> 00:59:03,680
my Internet's down oh yeah your t1 went

1297
00:59:01,460 --> 00:59:05,690
down<font color="#E5E5E5"> about four minutes ago let's go</font>

1298
00:59:03,680 --> 00:59:06,950
<font color="#E5E5E5">ahead and investigate and we can look a</font>

1299
00:59:05,690 --> 00:59:08,539
<font color="#CCCCCC">little bit more intelligent in front of</font>

1300
00:59:06,950 --> 00:59:09,919
the customer instead of having to go

1301
00:59:08,539 --> 00:59:11,420
fishing around and figuring<font color="#CCCCCC"> out what</font>

1302
00:59:09,920 --> 00:59:15,109
route are there on and look at some

1303
00:59:11,420 --> 00:59:18,680
<font color="#CCCCCC">other representation there so the usual</font>

1304
00:59:15,109 --> 00:59:21,920
plea here at nanog please prevent bad

1305
00:59:18,680 --> 00:59:25,940
traffic do whatever<font color="#E5E5E5"> you</font><font color="#CCCCCC"> can to prevent</font>

1306
00:59:21,920 --> 00:59:31,549
spoofing we use unicast RPF wherever

1307
00:59:25,940 --> 00:59:33,380
possible we have<font color="#E5E5E5"> a stock inbound access</font>

1308
00:59:31,549 --> 00:59:35,960
list we use on all customers there's

1309
00:59:33,380 --> 00:59:39,739
actually two variations one is for our

1310
00:59:35,960 --> 00:59:43,549
legacy retail customers which blocks

1311
00:59:39,739 --> 00:59:44,869
anything ospf perhaps a couple of

1312
00:59:43,549 --> 00:59:47,359
multicast things<font color="#E5E5E5"> unless they've</font>

1313
00:59:44,869 --> 00:59:50,989
requested a specific exemption which

1314
00:59:47,359 --> 00:59:52,700
we've never<font color="#E5E5E5"> had any and double checks to</font>

1315
00:59:50,989 --> 00:59:53,720
make sure that they never spoof anything

1316
00:59:52,700 --> 00:59:58,250
that's coming<font color="#CCCCCC"> from</font>

1317
00:59:53,720 --> 01:00:01,390
our interface subnets we know where they

1318
00:59:58,250 --> 01:00:04,970
are that way if for some reason the

1319
01:00:01,390 --> 01:00:06,618
unicast RPF check gets removed maybe SEF

1320
01:00:04,970 --> 01:00:08,240
blew up and we re enabled it but it

1321
01:00:06,619 --> 01:00:10,340
wasn't<font color="#CCCCCC"> enough to</font><font color="#E5E5E5"> get the RPF check</font>

1322
01:00:08,240 --> 01:00:11,359
restored on the<font color="#E5E5E5"> interface we know that</font>

1323
01:00:10,340 --> 01:00:13,609
we're at least protecting against

1324
01:00:11,359 --> 01:00:15,980
spoofing that would blow up<font color="#E5E5E5"> our internal</font>

1325
01:00:13,609 --> 01:00:17,509
<font color="#CCCCCC">bgp sessions and so forth all that gets</font>

1326
01:00:15,980 --> 01:00:20,690
blocked before<font color="#CCCCCC"> it ever gets into our</font>

1327
01:00:17,510 --> 01:00:23,420
network<font color="#E5E5E5"> the second variation of the</font>

1328
01:00:20,690 --> 01:00:27,099
inbound<font color="#CCCCCC"> akal is used on our wholesale</font>

1329
01:00:23,420 --> 01:00:30,099
customers our ISPs in our Colo areas and

1330
01:00:27,099 --> 01:00:33,290
that one's a little bit wider

1331
01:00:30,099 --> 01:00:37,670
considering the retail<font color="#CCCCCC"> akal also blocks</font>

1332
01:00:33,290 --> 01:00:39,680
the<font color="#CCCCCC"> netbios over tcp stuff we take a</font>

1333
01:00:37,670 --> 01:00:42,470
stance that unless they've<font color="#CCCCCC"> got some</font>

1334
01:00:39,680 --> 01:00:44,899
specific reason to share windows files

1335
01:00:42,470 --> 01:00:47,060
and<font color="#E5E5E5"> Printers wide open over the internet</font>

1336
01:00:44,900 --> 01:00:48,800
they probably don't want that open we

1337
01:00:47,060 --> 01:00:53,180
block<font color="#E5E5E5"> that on a retail side but leave it</font>

1338
01:00:48,800 --> 01:00:54,980
<font color="#E5E5E5">open on the wholesale side and as soon</font>

1339
01:00:53,180 --> 01:00:57,440
as you've<font color="#CCCCCC"> got an opportunity to work it</font>

1340
01:00:54,980 --> 01:00:59,599
into your configuration highly recommend

1341
01:00:57,440 --> 01:01:01,339
some sort of black hole router we've

1342
01:00:59,599 --> 01:01:02,930
cannibalized a couple of console servers

1343
01:01:01,339 --> 01:01:06,080
that also work as<font color="#CCCCCC"> council servers and</font>

1344
01:01:02,930 --> 01:01:08,000
there are black hole triggers take a

1345
01:01:06,080 --> 01:01:10,640
<font color="#E5E5E5">look for our tbh and Google or whatever</font>

1346
01:01:08,000 --> 01:01:12,680
to find out basic ways of doing it we've

1347
01:01:10,640 --> 01:01:14,960
also built a very basic<font color="#CCCCCC"> but very</font>

1348
01:01:12,680 --> 01:01:16,549
functional net flow infrastructure so

1349
01:01:14,960 --> 01:01:19,430
when we get dust we know how to figure

1350
01:01:16,550 --> 01:01:23,349
<font color="#E5E5E5">out at least who's getting targeted our</font>

1351
01:01:19,430 --> 01:01:26,810
normal<font color="#E5E5E5"> recourse is to black hole the</font>

1352
01:01:23,349 --> 01:01:28,849
victim address first it's the quickest

1353
01:01:26,810 --> 01:01:30,830
thing for us<font color="#CCCCCC"> to find in the net flow</font>

1354
01:01:28,849 --> 01:01:35,089
reports figure out whether it's a very

1355
01:01:30,830 --> 01:01:36,529
distributed a very singular source so

1356
01:01:35,089 --> 01:01:38,900
will then go back and<font color="#CCCCCC"> check whether</font><font color="#E5E5E5"> the</font>

1357
01:01:36,530 --> 01:01:41,990
source is singular or multiple look for

1358
01:01:38,900 --> 01:01:44,030
the largest attackers at least and<font color="#CCCCCC"> we'll</font>

1359
01:01:41,990 --> 01:01:45,709
black hole from the source and then

1360
01:01:44,030 --> 01:01:49,359
we'll restore<font color="#E5E5E5"> the victim back to</font>

1361
01:01:45,710 --> 01:01:51,619
operation so it's got minimal impact to

1362
01:01:49,359 --> 01:01:54,230
the rest<font color="#E5E5E5"> of our customers throughout the</font>

1363
01:01:51,619 --> 01:01:56,089
entire event gets our customer

1364
01:01:54,230 --> 01:01:59,030
completely back online as soon as we can

1365
01:01:56,089 --> 01:02:02,570
and starts black holing the source as

1366
01:01:59,030 --> 01:02:04,940
quickly as<font color="#CCCCCC"> we can so that's my story</font>

1367
01:02:02,570 --> 01:02:07,180
it's worked<font color="#E5E5E5"> very well for us I've told</font>

1368
01:02:04,940 --> 01:02:08,890
management that my goal is that the<font color="#E5E5E5"> NOC</font>

1369
01:02:07,180 --> 01:02:11,470
handle ninety percent<font color="#CCCCCC"> of the issues</font>

1370
01:02:08,890 --> 01:02:13,690
completely on their own another nine

1371
01:02:11,470 --> 01:02:16,118
percent of the issues with just asking

1372
01:02:13,690 --> 01:02:18,130
me a few<font color="#CCCCCC"> questions</font><font color="#E5E5E5"> and about one percent</font>

1373
01:02:16,119 --> 01:02:20,440
of the issues that<font color="#E5E5E5"> I have to say I'll</font>

1374
01:02:18,130 --> 01:02:22,630
deal with it it's going to<font color="#E5E5E5"> take</font><font color="#CCCCCC"> me far</font>

1375
01:02:20,440 --> 01:02:24,670
longer to explain it to you then it will

1376
01:02:22,630 --> 01:02:25,900
for me to resolve<font color="#E5E5E5"> it it's better for the</font>

1377
01:02:24,670 --> 01:02:27,460
customer to get the customer up and

1378
01:02:25,900 --> 01:02:31,119
running and then circle back and<font color="#CCCCCC"> train</font>

1379
01:02:27,460 --> 01:02:32,650
the NOC later and we've we've truly

1380
01:02:31,119 --> 01:02:36,540
gotten to that point<font color="#E5E5E5"> and then some I</font>

1381
01:02:32,650 --> 01:02:39,069
mean my phone rings quite and frequently

1382
01:02:36,540 --> 01:02:43,750
the only exception to how often I get

1383
01:02:39,069 --> 01:02:47,050
called is often on those where some

1384
01:02:43,750 --> 01:02:48,970
other completely independent event is

1385
01:02:47,050 --> 01:02:51,520
happening on the network usually on the

1386
01:02:48,970 --> 01:02:53,200
voice side or transport side and a

1387
01:02:51,520 --> 01:02:55,960
customer calls in with an IP related

1388
01:02:53,200 --> 01:02:57,848
question and our NOC is too overwhelmed

1389
01:02:55,960 --> 01:02:59,859
to handle it they'll pumped it over to

1390
01:02:57,849 --> 01:03:01,660
me and that's<font color="#E5E5E5"> about the only exception</font>

1391
01:02:59,859 --> 01:03:06,880
of getting rare calls every three months

1392
01:03:01,660 --> 01:03:08,589
or so if any of you here in<font color="#E5E5E5"> the room or</font>

1393
01:03:06,880 --> 01:03:10,119
later watching<font color="#CCCCCC"> the archives are</font>

1394
01:03:08,589 --> 01:03:12,190
interested in any part of our

1395
01:03:10,119 --> 01:03:14,309
configurations please email me and<font color="#E5E5E5"> I'll</font>

1396
01:03:12,190 --> 01:03:17,740
be happy<font color="#E5E5E5"> to to send you whatever</font>

1397
01:03:14,309 --> 01:03:19,240
snippets you'd like and this point I'm

1398
01:03:17,740 --> 01:03:21,669
opening up the questions anything you

1399
01:03:19,240 --> 01:03:25,390
want to see further I can connect in and

1400
01:03:21,670 --> 01:03:28,920
do some demonstrations any other

1401
01:03:25,390 --> 01:03:28,920
questions you've got come on<font color="#CCCCCC"> up</font>

1402
01:03:41,580 --> 01:03:44,390
very good

