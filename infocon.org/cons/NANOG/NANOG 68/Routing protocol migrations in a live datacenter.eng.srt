1
00:00:06,899 --> 00:00:17,160
sure that can<font color="#E5E5E5"> be music down please end</font>

2
00:00:14,320 --> 00:00:19,300
of the track<font color="#E5E5E5"> nice</font><font color="#CCCCCC"> okay</font>

3
00:00:17,160 --> 00:00:20,830
welcome back<font color="#E5E5E5"> for I agree I could talk</font>

4
00:00:19,300 --> 00:00:22,450
over<font color="#E5E5E5"> the</font><font color="#CCCCCC"> music I guess I could hum a</font>

5
00:00:20,830 --> 00:00:25,709
little<font color="#CCCCCC"> bit but</font><font color="#E5E5E5"> ya know we still have the</font>

6
00:00:22,450 --> 00:00:25,710
music<font color="#CCCCCC"> dude</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> music</font><font color="#E5E5E5"> down please</font>

7
00:00:29,279 --> 00:00:33,309
there we go

8
00:00:31,150 --> 00:00:35,739
welcome back from<font color="#CCCCCC"> lunch thank you uh</font>

9
00:00:33,309 --> 00:00:37,870
thank<font color="#E5E5E5"> you for settling in please make</font>

10
00:00:35,739 --> 00:00:39,849
sure<font color="#E5E5E5"> that your phones are set to silent</font>

11
00:00:37,870 --> 00:00:42,519
<font color="#E5E5E5">and your beepers are off if you still</font>

12
00:00:39,850 --> 00:00:45,159
have beepers<font color="#CCCCCC"> a couple items from earlier</font>

13
00:00:42,519 --> 00:00:47,049
this<font color="#CCCCCC"> morning once again we do apologize</font>

14
00:00:45,159 --> 00:00:49,019
for the power outage that<font color="#E5E5E5"> took some of</font>

15
00:00:47,049 --> 00:00:52,180
the tables out and some of<font color="#CCCCCC"> the aps and</font>

16
00:00:49,019 --> 00:00:53,470
<font color="#CCCCCC">effected</font><font color="#E5E5E5"> the Wi-Fi so we had I think</font>

17
00:00:52,180 --> 00:00:55,600
<font color="#E5E5E5">about a switch or so that didn't come</font>

18
00:00:53,470 --> 00:00:56,949
<font color="#E5E5E5">back after the power got restored I did</font>

19
00:00:55,600 --> 00:00:59,830
hear that<font color="#E5E5E5"> everything is back up and</font>

20
00:00:56,949 --> 00:01:01,390
<font color="#E5E5E5">running so hopefully internet</font>

21
00:00:59,830 --> 00:01:04,750
<font color="#CCCCCC">performance should</font><font color="#E5E5E5"> be back</font><font color="#CCCCCC"> to where you</font>

22
00:01:01,390 --> 00:01:06,369
expect<font color="#E5E5E5"> it to be also the temperature we</font>

23
00:01:04,750 --> 00:01:07,900
did hear quite a<font color="#E5E5E5"> bit of feedback that</font><font color="#CCCCCC"> it</font>

24
00:01:06,369 --> 00:01:09,220
was a<font color="#E5E5E5"> little bit chilly this morning</font><font color="#CCCCCC"> and</font>

25
00:01:07,900 --> 00:01:10,870
I want to say that was intentional<font color="#CCCCCC"> to</font>

26
00:01:09,220 --> 00:01:11,650
wake you<font color="#CCCCCC"> out but you know it's that's</font>

27
00:01:10,870 --> 00:01:13,420
how it goes<font color="#CCCCCC"> sometimes</font>

28
00:01:11,650 --> 00:01:14,710
<font color="#E5E5E5">they did make a slight</font><font color="#CCCCCC"> adjustment to</font>

29
00:01:13,420 --> 00:01:16,270
hopefully the second half<font color="#E5E5E5"> of the day</font>

30
00:01:14,710 --> 00:01:18,789
will<font color="#CCCCCC"> be a bit more comfortable for</font>

31
00:01:16,270 --> 00:01:20,860
<font color="#CCCCCC">everybody</font><font color="#E5E5E5"> so with that said I wanted to</font>

32
00:01:18,790 --> 00:01:24,000
<font color="#E5E5E5">introduce Chris who's gonna talk to us</font>

33
00:01:20,860 --> 00:01:26,530
about<font color="#E5E5E5"> a really neat experience</font><font color="#CCCCCC"> migrating</font>

34
00:01:24,000 --> 00:01:29,950
routing protocols<font color="#CCCCCC"> in a live data center</font>

35
00:01:26,530 --> 00:01:30,730
take it away Chris nice<font color="#E5E5E5"> hi everybody I'm</font>

36
00:01:29,950 --> 00:01:32,500
Chris<font color="#CCCCCC"> Woodfield</font>

37
00:01:30,730 --> 00:01:35,680
I'm with the Twitter<font color="#CCCCCC"> Network engineering</font>

38
00:01:32,500 --> 00:01:40,090
team and I'm<font color="#E5E5E5"> here to talk about a</font>

39
00:01:35,680 --> 00:01:43,270
project that<font color="#E5E5E5"> hopefully none of you</font>

40
00:01:40,090 --> 00:01:47,650
should<font color="#E5E5E5"> have to do</font><font color="#CCCCCC"> this was a very</font>

41
00:01:43,270 --> 00:01:50,140
intensive project for us<font color="#E5E5E5"> and you know a</font>

42
00:01:47,650 --> 00:01:53,320
lot<font color="#E5E5E5"> of factors came</font><font color="#CCCCCC"> in to the fact of</font>

43
00:01:50,140 --> 00:01:55,360
having to do this the<font color="#CCCCCC"> way we did I see</font>

44
00:01:53,320 --> 00:01:57,550
the value<font color="#CCCCCC"> and sharing of it because in</font>

45
00:01:55,360 --> 00:01:59,229
perfect world you wouldn't you know<font color="#CCCCCC"> you</font>

46
00:01:57,550 --> 00:02:01,690
<font color="#E5E5E5">wouldn't be doing this sort of</font><font color="#CCCCCC"> project</font>

47
00:01:59,229 --> 00:02:03,640
in this sort of way but<font color="#E5E5E5"> we know none of</font>

48
00:02:01,690 --> 00:02:08,799
<font color="#E5E5E5">us live</font><font color="#CCCCCC"> in perfect worlds</font>

49
00:02:03,640 --> 00:02:11,049
so I think<font color="#E5E5E5"> it's valuable to to explain</font>

50
00:02:08,799 --> 00:02:12,280
how the<font color="#E5E5E5"> sauces get made</font><font color="#CCCCCC"> sometime when</font>

51
00:02:11,049 --> 00:02:14,290
you don't have

52
00:02:12,280 --> 00:02:18,910
<font color="#E5E5E5">you know a perfect world where you can</font>

53
00:02:14,290 --> 00:02:23,049
just do things more<font color="#E5E5E5"> cleanly</font><font color="#CCCCCC"> so starting</font>

54
00:02:18,910 --> 00:02:24,520
<font color="#E5E5E5">with our our existing design</font><font color="#CCCCCC"> when we sir</font>

55
00:02:23,050 --> 00:02:27,240
<font color="#CCCCCC">first started</font><font color="#E5E5E5"> building data centers</font>

56
00:02:24,520 --> 00:02:29,800
<font color="#E5E5E5">about you know four or five years ago</font>

57
00:02:27,240 --> 00:02:31,620
<font color="#CCCCCC">OSPF was more or less a no-brainer as</font>

58
00:02:29,800 --> 00:02:35,920
far as a data center routing protocol

59
00:02:31,620 --> 00:02:39,340
<font color="#CCCCCC">bgp data center topologies</font><font color="#E5E5E5"> really</font>

60
00:02:35,920 --> 00:02:41,140
weren't widely<font color="#E5E5E5"> known about the RFC</font>

61
00:02:39,340 --> 00:02:46,120
didn't get<font color="#E5E5E5"> published until I believe</font>

62
00:02:41,140 --> 00:02:51,160
2012<font color="#CCCCCC"> or a</font><font color="#E5E5E5"> couple year after that</font><font color="#CCCCCC"> the</font>

63
00:02:46,120 --> 00:02:53,400
feature sets of the various various data

64
00:02:51,160 --> 00:02:55,750
center network network<font color="#E5E5E5"> devices</font>

65
00:02:53,400 --> 00:02:57,819
<font color="#E5E5E5">particularly lower and switches didn't</font>

66
00:02:55,750 --> 00:03:00,040
have all the complete features that were

67
00:02:57,819 --> 00:03:02,890
necessary to<font color="#E5E5E5"> do a successful</font><font color="#CCCCCC"> BGP data</font>

68
00:03:00,040 --> 00:03:06,750
center routing deployment<font color="#CCCCCC"> speaking to</font>

69
00:03:02,890 --> 00:03:09,970
our environment<font color="#CCCCCC"> we had a rather heavy</font>

70
00:03:06,750 --> 00:03:11,620
<font color="#E5E5E5">north-south bias to our traffic and this</font>

71
00:03:09,970 --> 00:03:14,950
comes<font color="#E5E5E5"> back to</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> point that at the time</font>

72
00:03:11,620 --> 00:03:17,860
the the<font color="#CCCCCC"> Twitter app was a big old ball</font>

73
00:03:14,950 --> 00:03:21,220
of Ruby on Rails<font color="#CCCCCC"> and</font><font color="#E5E5E5"> there wasn't a</font>

74
00:03:17,860 --> 00:03:23,500
<font color="#CCCCCC">whole lot</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> of disaggregation of</font>

75
00:03:21,220 --> 00:03:27,310
various components<font color="#CCCCCC"> of the app</font><font color="#E5E5E5"> going on</font>

76
00:03:23,500 --> 00:03:32,100
at the<font color="#E5E5E5"> time so we built an</font><font color="#CCCCCC"> OSPF topology</font>

77
00:03:27,310 --> 00:03:36,459
<font color="#CCCCCC">a standard multi area</font><font color="#E5E5E5"> we had a number of</font>

78
00:03:32,100 --> 00:03:38,859
clusters where we separated the clusters

79
00:03:36,459 --> 00:03:41,980
by<font color="#E5E5E5"> role so we had a cluster for front</font>

80
00:03:38,860 --> 00:03:47,049
<font color="#E5E5E5">end hosts a cluster for storage cluster</font>

81
00:03:41,980 --> 00:03:49,480
<font color="#E5E5E5">for real-time storage and at the time we</font>

82
00:03:47,049 --> 00:03:52,329
were scaling more vertically than

83
00:03:49,480 --> 00:03:53,858
horizontally<font color="#CCCCCC"> in order to keep the</font><font color="#E5E5E5"> OSF</font>

84
00:03:52,329 --> 00:03:57,040
topology as simple as we could our

85
00:03:53,859 --> 00:04:00,220
preference for capacity augmentation was

86
00:03:57,040 --> 00:04:02,290
to expand<font color="#CCCCCC"> the size of LACP trunks as</font>

87
00:04:00,220 --> 00:04:04,600
opposed<font color="#E5E5E5"> to adding more layer</font><font color="#CCCCCC"> three links</font>

88
00:04:02,290 --> 00:04:09,030
which would make<font color="#CCCCCC"> that topology</font><font color="#E5E5E5"> more</font>

89
00:04:04,600 --> 00:04:12,100
complex and<font color="#CCCCCC"> introduced more SPF</font><font color="#E5E5E5"> fun</font><font color="#CCCCCC"> as</font>

90
00:04:09,030 --> 00:04:13,989
it happens time goes on and your

91
00:04:12,100 --> 00:04:15,970
<font color="#CCCCCC">original assumptions turn out to be</font>

92
00:04:13,989 --> 00:04:19,870
<font color="#E5E5E5">completely incorrect</font>

93
00:04:15,970 --> 00:04:22,300
we saw the<font color="#E5E5E5"> app D aggregate into a number</font>

94
00:04:19,870 --> 00:04:25,010
<font color="#E5E5E5">of micro services that resulted in a</font>

95
00:04:22,300 --> 00:04:26,690
east-west traffic<font color="#CCCCCC"> explosion</font>

96
00:04:25,010 --> 00:04:28,219
we were seeing far more<font color="#CCCCCC"> traffic between</font>

97
00:04:26,690 --> 00:04:29,810
<font color="#E5E5E5">host and our data center than the</font>

98
00:04:28,220 --> 00:04:32,600
servers<font color="#E5E5E5"> that we were than the traffic we</font>

99
00:04:29,810 --> 00:04:35,090
were passing<font color="#E5E5E5"> out to the Internet</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the</font>

100
00:04:32,600 --> 00:04:38,120
process of augmenting<font color="#E5E5E5"> all of these links</font>

101
00:04:35,090 --> 00:04:39,530
we wound up running<font color="#E5E5E5"> into capacity issues</font>

102
00:04:38,120 --> 00:04:40,970
with the number<font color="#E5E5E5"> of hosts</font>

103
00:04:39,530 --> 00:04:43,849
number of<font color="#E5E5E5"> individual ports we could put</font>

104
00:04:40,970 --> 00:04:45,470
in<font color="#CCCCCC"> LACP trunks this forced us to add</font>

105
00:04:43,850 --> 00:04:48,490
<font color="#CCCCCC">more layer three</font><font color="#E5E5E5"> links which in turn</font>

106
00:04:45,470 --> 00:04:51,410
made our<font color="#CCCCCC"> OSPF topology</font><font color="#E5E5E5"> more complex and</font>

107
00:04:48,490 --> 00:04:55,940
you can see how<font color="#CCCCCC"> that can go at the time</font>

108
00:04:51,410 --> 00:04:58,130
<font color="#E5E5E5">we started to</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> decommission</font><font color="#CCCCCC"> OSPF we</font>

109
00:04:55,940 --> 00:05:00,730
had over 50,000<font color="#CCCCCC"> l essays</font><font color="#E5E5E5"> in our table</font><font color="#CCCCCC"> I</font>

110
00:04:58,130 --> 00:05:04,340
don't recommend<font color="#E5E5E5"> that</font>

111
00:05:00,730 --> 00:05:06,740
one particular<font color="#E5E5E5"> flaw in our design that</font>

112
00:05:04,340 --> 00:05:09,679
was becoming a big problem<font color="#CCCCCC"> was that</font>

113
00:05:06,740 --> 00:05:11,750
<font color="#E5E5E5">during certain migrations that we were</font>

114
00:05:09,680 --> 00:05:15,200
<font color="#E5E5E5">doing we were</font><font color="#CCCCCC"> seeing traffic</font><font color="#E5E5E5"> actually</font>

115
00:05:11,750 --> 00:05:17,590
<font color="#E5E5E5">prefer paths going through other racks</font>

116
00:05:15,200 --> 00:05:22,420
as opposed<font color="#E5E5E5"> to up through the fabric</font>

117
00:05:17,590 --> 00:05:24,919
<font color="#CCCCCC">never a</font><font color="#E5E5E5"> good</font><font color="#CCCCCC"> day when</font><font color="#E5E5E5"> that happens</font><font color="#CCCCCC"> so</font>

118
00:05:22,420 --> 00:05:26,780
<font color="#CCCCCC">the decision was made a number</font><font color="#E5E5E5"> of years</font>

119
00:05:24,920 --> 00:05:29,990
<font color="#CCCCCC">later</font><font color="#E5E5E5"> we started this project late last</font>

120
00:05:26,780 --> 00:05:32,330
year<font color="#E5E5E5"> bgp data center routing is what had</font>

121
00:05:29,990 --> 00:05:36,080
that by that<font color="#E5E5E5"> time had</font><font color="#CCCCCC"> become a bit more</font>

122
00:05:32,330 --> 00:05:39,109
<font color="#CCCCCC">established</font><font color="#E5E5E5"> and feature sets were more</font>

123
00:05:36,080 --> 00:05:42,289
stable and complete so<font color="#E5E5E5"> we decided to</font>

124
00:05:39,110 --> 00:05:45,140
<font color="#E5E5E5">take the</font><font color="#CCCCCC"> plunge</font><font color="#E5E5E5"> and to move to a BGP</font>

125
00:05:42,290 --> 00:05:47,180
topology for<font color="#E5E5E5"> our data center</font><font color="#CCCCCC"> a lot</font><font color="#E5E5E5"> of</font>

126
00:05:45,140 --> 00:05:51,650
the reasons that<font color="#E5E5E5"> other speakers have</font>

127
00:05:47,180 --> 00:05:54,050
described far more far more<font color="#E5E5E5"> or better</font>

128
00:05:51,650 --> 00:05:55,760
than I have<font color="#CCCCCC"> policy control and every</font>

129
00:05:54,050 --> 00:05:57,830
peer it restores something of a flat

130
00:05:55,760 --> 00:06:01,250
routing model as opposed to a multi area

131
00:05:57,830 --> 00:06:04,310
topology<font color="#CCCCCC"> easier to diagnose</font><font color="#E5E5E5"> simpler</font>

132
00:06:01,250 --> 00:06:09,050
decision points<font color="#CCCCCC"> and</font><font color="#E5E5E5"> just generally more</font>

133
00:06:04,310 --> 00:06:11,750
scalable<font color="#E5E5E5"> most data</font><font color="#CCCCCC"> centers that do these</font>

134
00:06:09,050 --> 00:06:13,670
sorts of<font color="#E5E5E5"> projects based on the</font>

135
00:06:11,750 --> 00:06:17,150
<font color="#E5E5E5">collective knowledge that we pulled</font>

136
00:06:13,670 --> 00:06:19,490
together at the time<font color="#E5E5E5"> are</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> to build</font>

137
00:06:17,150 --> 00:06:23,690
a new<font color="#E5E5E5"> one they're going</font><font color="#CCCCCC"> to build</font><font color="#E5E5E5"> a new</font>

138
00:06:19,490 --> 00:06:27,380
topology<font color="#CCCCCC"> and they're</font><font color="#E5E5E5"> going to move hosts</font>

139
00:06:23,690 --> 00:06:29,330
or applications into it<font color="#CCCCCC"> if anybody has</font>

140
00:06:27,380 --> 00:06:31,010
done<font color="#CCCCCC"> this</font><font color="#E5E5E5"> separately they weren't</font>

141
00:06:29,330 --> 00:06:34,609
talking<font color="#CCCCCC"> about</font><font color="#E5E5E5"> it and I'd love to talk</font><font color="#CCCCCC"> to</font>

142
00:06:31,010 --> 00:06:37,360
<font color="#E5E5E5">you afterwards</font><font color="#CCCCCC"> we at the</font><font color="#E5E5E5"> time we're</font><font color="#CCCCCC"> not</font>

143
00:06:34,610 --> 00:06:40,210
looking at<font color="#E5E5E5"> any new data centers builds</font>

144
00:06:37,360 --> 00:06:42,819
we couldn't foresee a way that we could

145
00:06:40,210 --> 00:06:45,210
build a<font color="#CCCCCC"> new topology in our data center</font>

146
00:06:42,819 --> 00:06:48,159
and<font color="#E5E5E5"> migrate traffic over incrementally</font>

147
00:06:45,210 --> 00:06:50,909
<font color="#CCCCCC">thus we made the decision that</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> were</font>

148
00:06:48,159 --> 00:06:54,129
going<font color="#CCCCCC"> to do it live</font><font color="#E5E5E5"> we were going to</font>

149
00:06:50,909 --> 00:06:56,979
turn up BGP inside our data center on

150
00:06:54,129 --> 00:06:59,560
the same topology<font color="#CCCCCC"> that our OSPF was</font>

151
00:06:56,979 --> 00:07:03,669
currently<font color="#E5E5E5"> running on and then</font><font color="#CCCCCC"> teardown</font>

152
00:06:59,560 --> 00:07:05,620
<font color="#CCCCCC">OSPF</font><font color="#E5E5E5"> so a quick a</font><font color="#CCCCCC"> quart description of</font>

153
00:07:03,669 --> 00:07:08,500
the data center topology<font color="#CCCCCC"> a</font><font color="#E5E5E5"> standard</font>

154
00:07:05,620 --> 00:07:10,990
clause model<font color="#E5E5E5"> backbone edge routers</font><font color="#CCCCCC"> that</font>

155
00:07:08,500 --> 00:07:12,280
connect data center to backbone as well

156
00:07:10,990 --> 00:07:17,229
as<font color="#CCCCCC"> terminate</font><font color="#E5E5E5"> our load balancers</font>

157
00:07:12,280 --> 00:07:19,299
firewalls<font color="#CCCCCC"> dozens of fabric and cluster</font>

158
00:07:17,229 --> 00:07:20,800
switches I believe that we were<font color="#E5E5E5"> four</font>

159
00:07:19,300 --> 00:07:23,199
wide on fabric at the<font color="#E5E5E5"> time that we</font>

160
00:07:20,800 --> 00:07:24,219
<font color="#CCCCCC">started this</font><font color="#E5E5E5"> we've expanded that fabric</font>

161
00:07:23,199 --> 00:07:28,330
<font color="#E5E5E5">and gone wider since</font>

162
00:07:24,219 --> 00:07:31,449
thousands of<font color="#CCCCCC"> tapa</font><font color="#E5E5E5"> racks</font><font color="#CCCCCC"> and you know</font>

163
00:07:28,330 --> 00:07:34,448
multiples of<font color="#CCCCCC"> terabyte terabits per</font>

164
00:07:31,449 --> 00:07:36,789
second of traffic going<font color="#E5E5E5"> between</font><font color="#CCCCCC"> host and</font>

165
00:07:34,449 --> 00:07:40,150
<font color="#E5E5E5">the data center and as you might expect</font>

166
00:07:36,789 --> 00:07:43,590
<font color="#CCCCCC">Twitter is a very much sense of is a</font>

167
00:07:40,150 --> 00:07:46,448
<font color="#E5E5E5">very sensitive real-time application no</font>

168
00:07:43,590 --> 00:07:48,638
<font color="#E5E5E5">reasonable there were no reasonable</font>

169
00:07:46,449 --> 00:07:50,949
expectations or assumptions that<font color="#E5E5E5"> we</font>

170
00:07:48,639 --> 00:07:55,659
would be<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to tolerate</font><font color="#CCCCCC"> down time</font>

171
00:07:50,949 --> 00:07:57,969
during<font color="#CCCCCC"> this migration so I'm going to</font>

172
00:07:55,659 --> 00:07:59,979
<font color="#E5E5E5">change tenses a little bit and talk a</font>

173
00:07:57,969 --> 00:08:01,779
little bit about what we did but<font color="#CCCCCC"> also</font>

174
00:07:59,979 --> 00:08:03,550
<font color="#CCCCCC">talk about</font><font color="#E5E5E5"> if you</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> looking at the</font>

175
00:08:01,779 --> 00:08:08,020
sort of migration what you might run

176
00:08:03,550 --> 00:08:09,940
into<font color="#E5E5E5"> the first thing that we</font><font color="#CCCCCC"> needed</font><font color="#E5E5E5"> to</font>

177
00:08:08,020 --> 00:08:13,180
do and that everybody doing this should

178
00:08:09,940 --> 00:08:15,520
<font color="#E5E5E5">do is is realize that when you're</font>

179
00:08:13,180 --> 00:08:17,289
<font color="#CCCCCC">talking about data center</font><font color="#E5E5E5"> hardware</font><font color="#CCCCCC"> BGP</font>

180
00:08:15,520 --> 00:08:20,500
feature sets are going<font color="#CCCCCC"> to be all over</font>

181
00:08:17,289 --> 00:08:23,740
the<font color="#CCCCCC"> map</font><font color="#E5E5E5"> core</font><font color="#CCCCCC"> backman routers</font><font color="#E5E5E5"> you tend to</font>

182
00:08:20,500 --> 00:08:26,800
have<font color="#CCCCCC"> assumptions as to the complete</font>

183
00:08:23,740 --> 00:08:28,240
feature set<font color="#CCCCCC"> with some of the some of the</font>

184
00:08:26,800 --> 00:08:29,949
lower end gear<font color="#E5E5E5"> or you know particularly</font>

185
00:08:28,240 --> 00:08:32,610
top of racks which are the weakest links

186
00:08:29,949 --> 00:08:35,349
you could wind up with<font color="#CCCCCC"> a</font><font color="#E5E5E5"> number of</font>

187
00:08:32,610 --> 00:08:37,180
compromises<font color="#CCCCCC"> fib limits</font><font color="#E5E5E5"> then the number</font>

188
00:08:35,349 --> 00:08:40,719
<font color="#E5E5E5">of routes you</font><font color="#CCCCCC"> can install</font><font color="#E5E5E5"> on a fib how</font>

189
00:08:37,179 --> 00:08:44,140
many<font color="#CCCCCC"> ECM ppad next</font><font color="#E5E5E5"> hops can you</font>

190
00:08:40,719 --> 00:08:46,600
associate a particular route<font color="#CCCCCC"> support for</font>

191
00:08:44,140 --> 00:08:48,209
specific<font color="#CCCCCC"> BGP features such as 32-bit a s</font>

192
00:08:46,600 --> 00:08:51,660
numbers<font color="#CCCCCC"> mo</font>

193
00:08:48,209 --> 00:08:54,888
<font color="#CCCCCC">das multipath a number of devices will</font>

194
00:08:51,660 --> 00:08:57,420
not<font color="#E5E5E5"> ecmp across different AAS paths</font>

195
00:08:54,889 --> 00:08:59,040
<font color="#CCCCCC">which was a fun when we had to run</font><font color="#E5E5E5"> and</font>

196
00:08:57,420 --> 00:09:01,618
we had to figure<font color="#E5E5E5"> out a solution for on</font>

197
00:08:59,040 --> 00:09:03,660
the fly at one point<font color="#CCCCCC"> and a lot</font><font color="#E5E5E5"> of ways</font>

198
00:09:01,619 --> 00:09:05,639
the state<font color="#E5E5E5"> of the existing hardware will</font>

199
00:09:03,660 --> 00:09:09,269
in<font color="#E5E5E5"> fact to take your</font><font color="#CCCCCC"> topology and your</font>

200
00:09:05,639 --> 00:09:12,689
design<font color="#CCCCCC"> there are a number of variations</font>

201
00:09:09,269 --> 00:09:15,089
on the<font color="#CCCCCC"> klaus model their single spine</font>

202
00:09:12,689 --> 00:09:17,699
and multiple spines model we identified

203
00:09:15,089 --> 00:09:19,949
an issue with going<font color="#CCCCCC"> with a multiple</font>

204
00:09:17,699 --> 00:09:23,399
spine model which honestly<font color="#E5E5E5"> would have</font>

205
00:09:19,949 --> 00:09:25,410
been our preference<font color="#CCCCCC"> where unless</font><font color="#E5E5E5"> we were</font>

206
00:09:23,399 --> 00:09:27,149
<font color="#E5E5E5">passing down a full table to our top</font><font color="#CCCCCC"> of</font>

207
00:09:25,410 --> 00:09:29,819
racks<font color="#E5E5E5"> which we couldn't do to defib</font>

208
00:09:27,149 --> 00:09:31,829
limits<font color="#E5E5E5"> we had we saw a black hole</font>

209
00:09:29,819 --> 00:09:35,279
potential if<font color="#CCCCCC"> we went to</font><font color="#E5E5E5"> multiple spines</font>

210
00:09:31,829 --> 00:09:37,498
<font color="#E5E5E5">so a single spine it was that spine will</font>

211
00:09:35,279 --> 00:09:41,869
scale very nicely and<font color="#E5E5E5"> it should do</font>

212
00:09:37,499 --> 00:09:45,629
everything<font color="#E5E5E5"> we need it to do</font><font color="#CCCCCC"> I hope</font>

213
00:09:41,869 --> 00:09:47,720
how many spines can you how<font color="#E5E5E5"> can</font><font color="#CCCCCC"> you put</font>

214
00:09:45,629 --> 00:09:50,999
in your data center how wide<font color="#CCCCCC"> can you go</font>

215
00:09:47,720 --> 00:09:52,379
<font color="#CCCCCC">how wide can your can your cluster</font>

216
00:09:50,999 --> 00:09:55,799
switches do ecmp

217
00:09:52,379 --> 00:09:57,629
<font color="#E5E5E5">are they 64 128 sometimes they might be</font>

218
00:09:55,799 --> 00:10:00,720
as small as<font color="#E5E5E5"> 8 or 16 depending on your</font>

219
00:09:57,629 --> 00:10:03,529
<font color="#CCCCCC">hardware that's going</font><font color="#E5E5E5"> to that's going</font><font color="#CCCCCC"> to</font>

220
00:10:00,720 --> 00:10:06,899
limit<font color="#E5E5E5"> your scalability at that point</font>

221
00:10:03,529 --> 00:10:10,740
when you assign<font color="#CCCCCC"> a SN's</font><font color="#E5E5E5"> to your network</font>

222
00:10:06,899 --> 00:10:13,199
devices<font color="#E5E5E5"> do you use a shared space or do</font>

223
00:10:10,740 --> 00:10:15,660
you assign every every device<font color="#E5E5E5"> a unique</font>

224
00:10:13,199 --> 00:10:17,969
<font color="#CCCCCC">AAS number</font><font color="#E5E5E5"> well it depends there's all</font>

225
00:10:15,660 --> 00:10:19,829
your<font color="#E5E5E5"> hardware support 32-bit</font><font color="#CCCCCC"> ASNs if so</font>

226
00:10:17,970 --> 00:10:24,329
great<font color="#CCCCCC"> do unique otherwise you're gonna</font>

227
00:10:19,829 --> 00:10:27,388
<font color="#E5E5E5">have to make some compromises</font><font color="#CCCCCC"> as far as</font>

228
00:10:24,329 --> 00:10:31,888
<font color="#E5E5E5">a s allocations again if you can use</font>

229
00:10:27,389 --> 00:10:34,819
32-bit a sans<font color="#E5E5E5"> do it and we came</font><font color="#CCCCCC"> up with</font>

230
00:10:31,889 --> 00:10:38,610
we came up<font color="#E5E5E5"> with a couple a couple</font>

231
00:10:34,819 --> 00:10:41,009
numbering schemes based on how various

232
00:10:38,610 --> 00:10:43,079
layers<font color="#E5E5E5"> based on the naming conventions</font>

233
00:10:41,009 --> 00:10:45,540
we were using<font color="#E5E5E5"> at various layers</font><font color="#CCCCCC"> in our</font>

234
00:10:43,079 --> 00:10:50,219
case<font color="#E5E5E5"> our fabrics and clusters were based</font>

235
00:10:45,540 --> 00:10:52,379
<font color="#E5E5E5">on a a cluster unit number so we used a</font>

236
00:10:50,220 --> 00:10:54,029
scheme to<font color="#E5E5E5"> you know just do some math</font>

237
00:10:52,379 --> 00:10:57,569
taking those numbers to generate a s

238
00:10:54,029 --> 00:10:59,699
number our racks<font color="#CCCCCC"> we use letter</font>

239
00:10:57,569 --> 00:11:05,069
designations<font color="#CCCCCC"> a</font>

240
00:10:59,699 --> 00:11:07,919
<font color="#CCCCCC">AAC so on</font><font color="#E5E5E5"> so so developing</font><font color="#CCCCCC"> AAAS</font>

241
00:11:05,069 --> 00:11:09,889
allocation scheme<font color="#E5E5E5"> from that</font><font color="#CCCCCC"> wind up</font>

242
00:11:07,919 --> 00:11:13,709
being developed<font color="#CCCCCC"> through some ASCII math</font>

243
00:11:09,889 --> 00:11:16,019
<font color="#E5E5E5">some pseudo codes they're using you know</font>

244
00:11:13,709 --> 00:11:21,899
<font color="#E5E5E5">one to twenty six</font><font color="#CCCCCC"> for each letter in the</font>

245
00:11:16,019 --> 00:11:24,149
alphabet<font color="#CCCCCC"> aggregation is going to be an</font>

246
00:11:21,899 --> 00:11:26,249
interesting<font color="#E5E5E5"> one because the assumptions</font>

247
00:11:24,149 --> 00:11:28,589
that<font color="#E5E5E5"> you can make between OSPF and BGP</font>

248
00:11:26,249 --> 00:11:31,309
are going to be different as far<font color="#E5E5E5"> as how</font>

249
00:11:28,589 --> 00:11:33,899
<font color="#E5E5E5">you where where you can aggregate</font>

250
00:11:31,309 --> 00:11:37,889
<font color="#E5E5E5">networks particularly if you're going</font>

251
00:11:33,899 --> 00:11:40,410
into a<font color="#CCCCCC"> clause model in a in our previous</font>

252
00:11:37,889 --> 00:11:43,049
cluster<font color="#E5E5E5"> there were cross-links between</font>

253
00:11:40,410 --> 00:11:45,329
<font color="#CCCCCC">cluster devices which are</font><font color="#E5E5E5"> not going to</font>

254
00:11:43,049 --> 00:11:48,089
be present in<font color="#E5E5E5"> a clause model because</font><font color="#CCCCCC"> you</font>

255
00:11:45,329 --> 00:11:49,858
may have<font color="#CCCCCC"> to be able to</font><font color="#E5E5E5"> scale wider</font><font color="#CCCCCC"> this</font>

256
00:11:48,089 --> 00:11:52,559
created<font color="#CCCCCC"> some black hole potential that</font>

257
00:11:49,859 --> 00:11:57,749
we observed<font color="#E5E5E5"> if we were aggregating and</font>

258
00:11:52,559 --> 00:12:00,358
then and then<font color="#E5E5E5"> suppressing the more</font>

259
00:11:57,749 --> 00:12:01,970
specifics<font color="#CCCCCC"> you do want to float your</font>

260
00:12:00,359 --> 00:12:04,589
aggregates<font color="#E5E5E5"> but you don't necessarily</font>

261
00:12:01,970 --> 00:12:07,829
<font color="#E5E5E5">want to make the aggregate the only</font>

262
00:12:04,589 --> 00:12:10,859
route the rack the rack<font color="#E5E5E5"> routes</font>

263
00:12:07,829 --> 00:12:15,809
themselves<font color="#E5E5E5"> when possible should stay in</font>

264
00:12:10,859 --> 00:12:18,269
<font color="#E5E5E5">your network</font><font color="#CCCCCC"> a few other tips that we</font>

265
00:12:15,809 --> 00:12:20,879
that we<font color="#E5E5E5"> learn along the way from your</font>

266
00:12:18,269 --> 00:12:23,189
edge generally<font color="#E5E5E5"> you only need to generate</font>

267
00:12:20,879 --> 00:12:25,499
<font color="#E5E5E5">a default route</font><font color="#CCCCCC"> there may be some needs</font>

268
00:12:23,189 --> 00:12:28,259
for<font color="#CCCCCC"> more for some more specific routes</font>

269
00:12:25,499 --> 00:12:29,879
to be<font color="#E5E5E5"> floated in but think about those</font>

270
00:12:28,259 --> 00:12:34,739
<font color="#E5E5E5">carefully and make sure</font><font color="#CCCCCC"> that they're</font>

271
00:12:29,879 --> 00:12:38,100
<font color="#CCCCCC">really needed</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> the implication from</font>

272
00:12:34,739 --> 00:12:40,199
that that<font color="#E5E5E5"> comes up is that</font><font color="#CCCCCC"> if you can't</font>

273
00:12:38,100 --> 00:12:43,379
send full tables down to your top of

274
00:12:40,199 --> 00:12:45,389
racks<font color="#CCCCCC"> that default route</font><font color="#E5E5E5"> that's</font>

275
00:12:43,379 --> 00:12:48,329
generated from<font color="#E5E5E5"> the edge becomes the same</font>

276
00:12:45,389 --> 00:12:51,059
default route that your racks are going

277
00:12:48,329 --> 00:12:53,339
to be using<font color="#CCCCCC"> to</font><font color="#E5E5E5"> talk to each other so you</font>

278
00:12:51,059 --> 00:12:56,969
<font color="#CCCCCC">definitely</font><font color="#E5E5E5"> want your data center</font>

279
00:12:53,339 --> 00:12:58,259
aggregates<font color="#E5E5E5"> along with your default route</font>

280
00:12:56,970 --> 00:13:00,660
to go down to the racks because<font color="#E5E5E5"> of that</font>

281
00:12:58,259 --> 00:13:03,359
the out route goes away not<font color="#E5E5E5"> only</font>

282
00:13:00,660 --> 00:13:04,649
can your racks<font color="#E5E5E5"> not talk to the rest of</font>

283
00:13:03,359 --> 00:13:07,109
the<font color="#E5E5E5"> internet but they can't talk to</font><font color="#CCCCCC"> each</font>

284
00:13:04,649 --> 00:13:09,569
other either put<font color="#E5E5E5"> those aggregates</font><font color="#CCCCCC"> or</font>

285
00:13:07,109 --> 00:13:13,010
more specifics in place and<font color="#CCCCCC"> that issue</font>

286
00:13:09,569 --> 00:13:15,050
goes away if

287
00:13:13,010 --> 00:13:17,510
<font color="#CCCCCC">if you're going</font><font color="#E5E5E5"> to be doing any policy</font>

288
00:13:15,050 --> 00:13:21,530
<font color="#E5E5E5">that manipulates local pref</font><font color="#CCCCCC"> remember</font>

289
00:13:17,510 --> 00:13:24,680
that in a<font color="#CCCCCC"> ebgp model where each layer</font>

290
00:13:21,530 --> 00:13:28,130
<font color="#CCCCCC">speaks over</font><font color="#E5E5E5"> ebgp versus ibgp local prep</font>

291
00:13:24,680 --> 00:13:30,260
is not transitive<font color="#CCCCCC"> and</font><font color="#E5E5E5"> the easiest way to</font>

292
00:13:28,130 --> 00:13:32,990
ensure<font color="#CCCCCC"> that you have consistent behavior</font>

293
00:13:30,260 --> 00:13:37,460
along<font color="#E5E5E5"> a path is to make</font><font color="#CCCCCC"> sure</font><font color="#E5E5E5"> that all</font>

294
00:13:32,990 --> 00:13:39,500
your<font color="#E5E5E5"> policies</font><font color="#CCCCCC"> are the same</font><font color="#E5E5E5"> something we</font>

295
00:13:37,460 --> 00:13:41,720
discovered<font color="#CCCCCC"> in our lab testing is that if</font>

296
00:13:39,500 --> 00:13:45,410
you're running OSPF and BGP in parallel

297
00:13:41,720 --> 00:13:48,830
it's necessary to<font color="#E5E5E5"> turn on advertised</font>

298
00:13:45,410 --> 00:13:50,839
<font color="#E5E5E5">inactive otherwise your BGP routes will</font>

299
00:13:48,830 --> 00:13:54,710
not propagate<font color="#E5E5E5"> until</font><font color="#CCCCCC"> they are preferred</font>

300
00:13:50,840 --> 00:13:55,910
over the<font color="#CCCCCC"> OSPF routes</font><font color="#E5E5E5"> that we ran into</font>

301
00:13:54,710 --> 00:13:59,090
<font color="#E5E5E5">one interesting bug I'll tell you about</font>

302
00:13:55,910 --> 00:14:01,160
the bar later<font color="#CCCCCC"> as a part of this</font><font color="#E5E5E5"> the</font>

303
00:13:59,090 --> 00:14:05,780
g-shot community g-shot is a relatively

304
00:14:01,160 --> 00:14:09,610
new<font color="#CCCCCC"> well-known community it's support in</font>

305
00:14:05,780 --> 00:14:11,689
various<font color="#CCCCCC"> which code is is</font><font color="#E5E5E5"> inconsistent</font>

306
00:14:09,610 --> 00:14:13,880
<font color="#CCCCCC">some</font><font color="#E5E5E5"> vendors have it</font><font color="#CCCCCC"> out-of-the-box</font>

307
00:14:11,690 --> 00:14:17,090
<font color="#CCCCCC">other vendors</font><font color="#E5E5E5"> you have to implement</font>

308
00:14:13,880 --> 00:14:19,160
<font color="#E5E5E5">policy</font><font color="#CCCCCC"> there's an internet</font><font color="#E5E5E5"> draft that</font>

309
00:14:17,090 --> 00:14:19,910
describes its behavior and<font color="#CCCCCC"> which is</font>

310
00:14:19,160 --> 00:14:22,760
fairly basic

311
00:14:19,910 --> 00:14:25,790
<font color="#E5E5E5">if route has community</font><font color="#CCCCCC"> x</font><font color="#E5E5E5"> set local craft</font>

312
00:14:22,760 --> 00:14:29,540
to<font color="#E5E5E5"> zero don't use the route the internet</font>

313
00:14:25,790 --> 00:14:31,370
draft<font color="#E5E5E5"> mentions a mentions instruction to</font>

314
00:14:29,540 --> 00:14:34,339
strip the community you have<font color="#E5E5E5"> to receive</font>

315
00:14:31,370 --> 00:14:35,900
<font color="#CCCCCC">it but</font><font color="#E5E5E5"> we had trouble</font><font color="#CCCCCC"> understanding why</font>

316
00:14:34,340 --> 00:14:39,800
you would want<font color="#CCCCCC"> to do that</font><font color="#E5E5E5"> and we chose</font>

317
00:14:35,900 --> 00:14:40,819
not<font color="#E5E5E5"> to</font><font color="#CCCCCC"> Automation</font><font color="#E5E5E5"> you're gonna be</font>

318
00:14:39,800 --> 00:14:43,400
building<font color="#E5E5E5"> a</font><font color="#CCCCCC"> lot of</font><font color="#E5E5E5"> hearing statements</font>

319
00:14:40,820 --> 00:14:45,860
<font color="#CCCCCC">there is</font><font color="#E5E5E5"> no reasonable way</font><font color="#CCCCCC"> to do this</font>

320
00:14:43,400 --> 00:14:47,829
without building your building and

321
00:14:45,860 --> 00:14:50,960
<font color="#E5E5E5">deploying your configs using software</font>

322
00:14:47,830 --> 00:14:53,330
<font color="#CCCCCC">just just no way not not unless your</font>

323
00:14:50,960 --> 00:14:56,930
network is very very small which ours of

324
00:14:53,330 --> 00:14:59,300
<font color="#CCCCCC">course was</font><font color="#E5E5E5"> not</font><font color="#CCCCCC"> we developed four main</font>

325
00:14:56,930 --> 00:15:02,510
phases<font color="#E5E5E5"> for our automation solution for</font>

326
00:14:59,300 --> 00:15:05,660
doing<font color="#CCCCCC"> this rollout first step is</font><font color="#E5E5E5"> to</font>

327
00:15:02,510 --> 00:15:08,630
discover your existing state<font color="#E5E5E5"> again this</font>

328
00:15:05,660 --> 00:15:10,750
is a this is<font color="#E5E5E5"> a live network</font><font color="#CCCCCC"> this is an</font>

329
00:15:08,630 --> 00:15:13,160
organic network that's grown over time

330
00:15:10,750 --> 00:15:15,140
<font color="#CCCCCC">you're not</font><font color="#E5E5E5"> gonna be</font><font color="#CCCCCC"> able</font><font color="#E5E5E5"> to arbitrary</font>

331
00:15:13,160 --> 00:15:16,670
fit arbitrarily fitted into<font color="#E5E5E5"> a source of</font>

332
00:15:15,140 --> 00:15:18,930
truth<font color="#E5E5E5"> you</font><font color="#CCCCCC"> have to</font><font color="#E5E5E5"> go discover what's out</font>

333
00:15:16,670 --> 00:15:21,120
there<font color="#E5E5E5"> and pull that in</font>

334
00:15:18,930 --> 00:15:23,160
and you know<font color="#E5E5E5"> lots of data you need to</font>

335
00:15:21,120 --> 00:15:25,290
pull in you know platforms code revs<font color="#E5E5E5"> you</font>

336
00:15:23,160 --> 00:15:29,219
know what can things to deploy<font color="#E5E5E5"> which</font>

337
00:15:25,290 --> 00:15:30,810
device<font color="#CCCCCC"> roles</font><font color="#E5E5E5"> router IDs and neighbor</font>

338
00:15:29,220 --> 00:15:34,350
information and this<font color="#E5E5E5"> is important</font>

339
00:15:30,810 --> 00:15:36,060
<font color="#CCCCCC">because if your if</font><font color="#E5E5E5"> your config</font>

340
00:15:34,350 --> 00:15:38,699
generation is manually building<font color="#E5E5E5"> bgp</font>

341
00:15:36,060 --> 00:15:42,329
peering statements<font color="#E5E5E5"> you have to know and</font>

342
00:15:38,699 --> 00:15:46,380
<font color="#CCCCCC">OSPF</font><font color="#E5E5E5"> alone will not tell you what</font><font color="#CCCCCC"> all</font>

343
00:15:42,329 --> 00:15:49,008
<font color="#E5E5E5">the neighbors are so there's a couple</font>

344
00:15:46,380 --> 00:15:53,069
<font color="#CCCCCC">strategies around</font><font color="#E5E5E5"> this you could use</font>

345
00:15:49,009 --> 00:15:55,440
<font color="#CCCCCC">lldp data that that each</font><font color="#E5E5E5"> device will</font>

346
00:15:53,069 --> 00:15:57,779
give you which is great<font color="#E5E5E5"> as long as you</font>

347
00:15:55,440 --> 00:16:00,769
have<font color="#E5E5E5"> LDP working reliably on every</font>

348
00:15:57,779 --> 00:16:04,259
<font color="#E5E5E5">device in your network hint we didn't</font>

349
00:16:00,769 --> 00:16:09,360
the more<font color="#E5E5E5"> reliable approach we found is</font>

350
00:16:04,259 --> 00:16:11,220
<font color="#CCCCCC">to store the slash 30 ones in your on</font>

351
00:16:09,360 --> 00:16:15,089
all the interface addresses and just

352
00:16:11,220 --> 00:16:17,490
find matches device X has 0.31<font color="#E5E5E5"> device</font><font color="#CCCCCC"> Y</font>

353
00:16:15,089 --> 00:16:22,380
has<font color="#CCCCCC"> got 1.31</font><font color="#E5E5E5"> guess what there could</font>

354
00:16:17,490 --> 00:16:26,240
<font color="#CCCCCC">directly connected</font><font color="#E5E5E5"> during a project</font><font color="#CCCCCC"> like</font>

355
00:16:22,380 --> 00:16:30,720
<font color="#CCCCCC">this</font><font color="#E5E5E5"> you're often not going to be</font>

356
00:16:26,240 --> 00:16:31,889
working<font color="#E5E5E5"> on an on a static topology racks</font>

357
00:16:30,720 --> 00:16:34,170
are always gonna get rolled on the<font color="#E5E5E5"> floor</font>

358
00:16:31,889 --> 00:16:35,279
<font color="#E5E5E5">there's always gonna be changes so this</font>

359
00:16:34,170 --> 00:16:37,709
discovery<font color="#E5E5E5"> should be something that</font>

360
00:16:35,279 --> 00:16:42,569
<font color="#E5E5E5">you're always running continuously so</font>

361
00:16:37,709 --> 00:16:44,638
you can pick<font color="#E5E5E5"> up</font><font color="#CCCCCC"> changes as they go the</font>

362
00:16:42,569 --> 00:16:47,370
next<font color="#E5E5E5"> step is to take all this data</font><font color="#CCCCCC"> and</font>

363
00:16:44,639 --> 00:16:48,870
generate your configurations<font color="#CCCCCC"> you know</font>

364
00:16:47,370 --> 00:16:50,189
you're<font color="#E5E5E5"> going to have various templates</font>

365
00:16:48,870 --> 00:16:53,430
for your<font color="#CCCCCC"> different vendors your</font>

366
00:16:50,189 --> 00:16:57,389
<font color="#E5E5E5">different</font><font color="#CCCCCC"> role types make it make it</font>

367
00:16:53,430 --> 00:16:59,849
<font color="#E5E5E5">make</font><font color="#CCCCCC"> it a template</font><font color="#E5E5E5"> that is easily</font>

368
00:16:57,389 --> 00:17:01,319
inheritable<font color="#CCCCCC"> I realize it's</font><font color="#E5E5E5"> the final</font>

369
00:16:59,850 --> 00:17:05,400
bullet<font color="#E5E5E5"> point but</font><font color="#CCCCCC"> Jinja</font><font color="#E5E5E5"> to actually makes</font>

370
00:17:01,319 --> 00:17:07,199
us very<font color="#E5E5E5"> easily with includes and you can</font>

371
00:17:05,400 --> 00:17:09,449
start<font color="#E5E5E5"> with</font><font color="#CCCCCC"> a baseline policy that</font>

372
00:17:07,199 --> 00:17:11,549
implements everything that<font color="#E5E5E5"> should live</font>

373
00:17:09,449 --> 00:17:14,280
on every device<font color="#E5E5E5"> even policy that doesn't</font>

374
00:17:11,549 --> 00:17:17,220
get used<font color="#E5E5E5"> you know it's easier just to</font>

375
00:17:14,280 --> 00:17:18,389
deploy it<font color="#E5E5E5"> and just have that there even</font>

376
00:17:17,220 --> 00:17:19,470
if it's<font color="#CCCCCC"> not referenced that's opposed to</font>

377
00:17:18,390 --> 00:17:22,260
putting<font color="#E5E5E5"> a whole</font><font color="#CCCCCC"> bunch of conditional</font>

378
00:17:19,470 --> 00:17:23,970
<font color="#CCCCCC">statements as far as what goes where</font>

379
00:17:22,260 --> 00:17:27,030
separate your baseline from<font color="#E5E5E5"> your</font>

380
00:17:23,970 --> 00:17:28,950
configuration templates<font color="#CCCCCC"> that makes that</font>

381
00:17:27,030 --> 00:17:30,720
<font color="#E5E5E5">makes things much easier and allows you</font>

382
00:17:28,950 --> 00:17:33,090
<font color="#E5E5E5">to do this and something about to pass</font>

383
00:17:30,720 --> 00:17:36,780
you can just deploy<font color="#E5E5E5"> your baseline in one</font>

384
00:17:33,090 --> 00:17:42,000
big push and then do the do<font color="#E5E5E5"> the peer</font>

385
00:17:36,780 --> 00:17:45,780
specific config<font color="#E5E5E5"> afterwards generally not</font>

386
00:17:42,000 --> 00:17:46,980
a whole lot of need to filter routes<font color="#CCCCCC"> you</font>

387
00:17:45,780 --> 00:17:49,139
know<font color="#E5E5E5"> mainly we had to filter out</font>

388
00:17:46,980 --> 00:17:51,360
upstream<font color="#E5E5E5"> to avoid seeing</font><font color="#CCCCCC"> the crowding</font>

389
00:17:49,140 --> 00:17:54,450
again<font color="#E5E5E5"> we don't want we</font><font color="#CCCCCC"> don't want wreak</font>

390
00:17:51,360 --> 00:17:57,928
a Dirac BTUs<font color="#E5E5E5"> raksi</font><font color="#CCCCCC"> and build templates</font>

391
00:17:54,450 --> 00:18:00,750
<font color="#E5E5E5">for</font><font color="#CCCCCC"> rollback</font><font color="#E5E5E5"> to don't forget that now</font>

392
00:17:57,929 --> 00:18:03,630
that we have<font color="#E5E5E5"> that code in place and</font>

393
00:18:00,750 --> 00:18:06,299
<font color="#CCCCCC">working</font><font color="#E5E5E5"> the push scripting</font><font color="#CCCCCC"> that we that</font>

394
00:18:03,630 --> 00:18:09,900
<font color="#E5E5E5">we developed</font><font color="#CCCCCC"> actually</font><font color="#E5E5E5"> was a bit of a</font>

395
00:18:06,299 --> 00:18:13,408
slow roll<font color="#E5E5E5"> again thousands of devices but</font>

396
00:18:09,900 --> 00:18:15,030
<font color="#CCCCCC">we were we ran</font><font color="#E5E5E5"> only a couple instances</font>

397
00:18:13,409 --> 00:18:18,270
in parallel we were only<font color="#E5E5E5"> pushing a few</font>

398
00:18:15,030 --> 00:18:22,799
<font color="#E5E5E5">racks at a time</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> to manage the risk</font>

399
00:18:18,270 --> 00:18:24,960
<font color="#E5E5E5">of this we were pushing our configs in</font>

400
00:18:22,799 --> 00:18:27,658
<font color="#E5E5E5">hunting you know in batches of</font><font color="#CCCCCC"> a hundred</font>

401
00:18:24,960 --> 00:18:29,220
devices<font color="#E5E5E5"> at a time</font><font color="#CCCCCC"> you obviously don't</font>

402
00:18:27,659 --> 00:18:30,419
<font color="#CCCCCC">we'll be watching</font><font color="#E5E5E5"> this thing run you</font>

403
00:18:29,220 --> 00:18:34,230
<font color="#E5E5E5">don't wanna be sitting there watching a</font>

404
00:18:30,419 --> 00:18:38,669
<font color="#CCCCCC">screen so have your code</font><font color="#E5E5E5"> post status to</font>

405
00:18:34,230 --> 00:18:41,400
a<font color="#E5E5E5"> HipChat channel or a syslog actively</font>

406
00:18:38,669 --> 00:18:43,289
alert you on errors and and when the

407
00:18:41,400 --> 00:18:46,289
batch completes so that someone knows to

408
00:18:43,289 --> 00:18:49,309
start off the<font color="#E5E5E5"> next batch and then</font>

409
00:18:46,289 --> 00:18:52,379
afterwards<font color="#E5E5E5"> you're</font><font color="#CCCCCC"> going to ideally have</font>

410
00:18:49,309 --> 00:18:54,480
parallel OSPF and BGP tables<font color="#E5E5E5"> they will</font>

411
00:18:52,380 --> 00:18:55,679
<font color="#E5E5E5">never be completely parallel so you have</font>

412
00:18:54,480 --> 00:18:58,200
to find the differences<font color="#E5E5E5"> and make sure</font>

413
00:18:55,679 --> 00:19:00,299
you understand<font color="#E5E5E5"> them</font><font color="#CCCCCC"> make sure that every</font>

414
00:18:58,200 --> 00:19:02,490
place that<font color="#CCCCCC"> you had an OSPF neighbor you</font>

415
00:19:00,299 --> 00:19:06,690
now have a<font color="#E5E5E5"> BGP peer biggest problem we</font>

416
00:19:02,490 --> 00:19:10,200
<font color="#E5E5E5">ran into blocking TCP port 179 on</font>

417
00:19:06,690 --> 00:19:12,960
loopback<font color="#CCCCCC"> ackles check the</font><font color="#E5E5E5"> routing tables</font>

418
00:19:10,200 --> 00:19:15,000
and make sure that for every route that

419
00:19:12,960 --> 00:19:18,240
is still only in<font color="#E5E5E5"> one protocol the other</font>

420
00:19:15,000 --> 00:19:20,630
you understand why<font color="#CCCCCC"> check a</font><font color="#E5E5E5"> route if you</font>

421
00:19:18,240 --> 00:19:23,340
have a route<font color="#E5E5E5"> that's only</font><font color="#CCCCCC"> OSPF check the</font>

422
00:19:20,630 --> 00:19:29,520
covering BGP route and<font color="#E5E5E5"> make sure the</font>

423
00:19:23,340 --> 00:19:33,449
make sure the the next hops match<font color="#CCCCCC"> that</font>

424
00:19:29,520 --> 00:19:36,480
was a very valuable audit to do now it's

425
00:19:33,450 --> 00:19:37,230
time to<font color="#E5E5E5"> turn</font><font color="#CCCCCC"> OSPF off</font><font color="#E5E5E5"> so how did we do</font>

426
00:19:36,480 --> 00:19:40,010
this

427
00:19:37,230 --> 00:19:45,470
there's two main<font color="#CCCCCC"> ways that you could do</font>

428
00:19:40,010 --> 00:19:49,129
a protocol<font color="#CCCCCC"> decommission do you just turn</font>

429
00:19:45,470 --> 00:19:51,020
off<font color="#E5E5E5"> the neighbors or do you</font><font color="#CCCCCC"> adjust the</font>

430
00:19:49,130 --> 00:19:52,580
routing preference<font color="#E5E5E5"> to make your new</font>

431
00:19:51,020 --> 00:19:55,280
<font color="#E5E5E5">routing protocol the more preferred</font>

432
00:19:52,580 --> 00:19:59,449
routing protocol<font color="#CCCCCC"> we actually did a</font>

433
00:19:55,280 --> 00:20:02,899
little bit<font color="#CCCCCC"> of</font><font color="#E5E5E5"> both</font><font color="#CCCCCC"> at the</font><font color="#E5E5E5"> cluster</font><font color="#CCCCCC"> Toorak</font>

434
00:19:59,450 --> 00:20:06,410
layer<font color="#CCCCCC"> we made the</font><font color="#E5E5E5"> decision to disable</font>

435
00:20:02,900 --> 00:20:08,330
the nay the<font color="#CCCCCC"> OSPF</font><font color="#E5E5E5"> neighbors and trust</font>

436
00:20:06,410 --> 00:20:10,250
<font color="#E5E5E5">that the</font><font color="#CCCCCC"> bgp routes</font><font color="#E5E5E5"> obviously after</font>

437
00:20:08,330 --> 00:20:12,740
validating would take over<font color="#E5E5E5"> as</font><font color="#CCCCCC"> the</font>

438
00:20:10,250 --> 00:20:14,960
preferred routes<font color="#CCCCCC"> the reason</font><font color="#E5E5E5"> for this is</font>

439
00:20:12,740 --> 00:20:17,330
that we decided<font color="#CCCCCC"> that it would</font><font color="#E5E5E5"> be far</font>

440
00:20:14,960 --> 00:20:20,240
easier<font color="#E5E5E5"> to deactivate those peers at the</font>

441
00:20:17,330 --> 00:20:21,620
<font color="#E5E5E5">cluster switch in batches</font><font color="#CCCCCC"> that way we</font>

442
00:20:20,240 --> 00:20:24,080
could roll those back easier without

443
00:20:21,620 --> 00:20:26,330
<font color="#E5E5E5">having to touch all of</font><font color="#CCCCCC"> those racks</font><font color="#E5E5E5"> and</font>

444
00:20:24,080 --> 00:20:29,620
<font color="#E5E5E5">in parallel</font><font color="#CCCCCC"> you know one</font><font color="#E5E5E5"> place to turn</font>

445
00:20:26,330 --> 00:20:32,810
off one place to re-enable if<font color="#CCCCCC"> needed</font>

446
00:20:29,620 --> 00:20:35,840
<font color="#E5E5E5">from the</font><font color="#CCCCCC"> cluster</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> fabric</font><font color="#E5E5E5"> to edge layer</font>

447
00:20:32,810 --> 00:20:39,649
we actually did this part with with

448
00:20:35,840 --> 00:20:41,990
preference changes turning<font color="#E5E5E5"> turning down</font>

449
00:20:39,650 --> 00:20:45,290
the<font color="#E5E5E5"> sorry turning up the preference for</font>

450
00:20:41,990 --> 00:20:47,600
<font color="#CCCCCC">BGP for for</font><font color="#E5E5E5"> OSPF to make BGP the more</font>

451
00:20:45,290 --> 00:20:49,879
more preferred route<font color="#E5E5E5"> once we had this</font>

452
00:20:47,600 --> 00:20:51,530
accomplished with all the<font color="#CCCCCC"> OSPF still</font>

453
00:20:49,880 --> 00:20:53,510
routes<font color="#CCCCCC"> routes still</font><font color="#E5E5E5"> in the table</font>

454
00:20:51,530 --> 00:20:56,690
<font color="#E5E5E5">auditing the remaining</font><font color="#CCCCCC"> OSPF routes was</font>

455
00:20:53,510 --> 00:20:57,920
far<font color="#CCCCCC"> easier one</font><font color="#E5E5E5"> lesson</font><font color="#CCCCCC"> we learned is it's</font>

456
00:20:56,690 --> 00:20:59,750
perfectly fine<font color="#CCCCCC"> to run</font><font color="#E5E5E5"> these two</font>

457
00:20:57,920 --> 00:21:01,970
protocols<font color="#E5E5E5"> in parallel for extended</font>

458
00:20:59,750 --> 00:21:03,740
periods<font color="#CCCCCC"> of time so don't feel like</font><font color="#E5E5E5"> you</font>

459
00:21:01,970 --> 00:21:09,290
have<font color="#CCCCCC"> to rush</font><font color="#E5E5E5"> this step if you don't have</font>

460
00:21:03,740 --> 00:21:11,320
to<font color="#E5E5E5"> and as a result we actually had a</font>

461
00:21:09,290 --> 00:21:15,620
pretty good<font color="#CCCCCC"> experience with</font><font color="#E5E5E5"> this rollout</font>

462
00:21:11,320 --> 00:21:20,060
we only caused one incident during<font color="#E5E5E5"> this</font>

463
00:21:15,620 --> 00:21:24,229
entire project<font color="#E5E5E5"> and the the reason for</font>

464
00:21:20,060 --> 00:21:25,639
<font color="#E5E5E5">that is</font><font color="#CCCCCC"> that we had a we had multiple</font>

465
00:21:24,230 --> 00:21:27,590
data centers<font color="#CCCCCC"> that we could fail the app</font>

466
00:21:25,640 --> 00:21:30,170
in and out of and there's always going

467
00:21:27,590 --> 00:21:32,209
<font color="#E5E5E5">to be a little bit of packet loss as we</font>

468
00:21:30,170 --> 00:21:33,890
do these<font color="#E5E5E5"> cut overs</font><font color="#CCCCCC"> that we were</font>

469
00:21:32,210 --> 00:21:35,990
mitigating the risk by by failing

470
00:21:33,890 --> 00:21:37,370
different different parts<font color="#CCCCCC"> of the app in</font>

471
00:21:35,990 --> 00:21:40,790
and out based on what cluster we were

472
00:21:37,370 --> 00:21:42,860
working<font color="#E5E5E5"> in one point where we had bad</font>

473
00:21:40,790 --> 00:21:44,030
<font color="#E5E5E5">information resulted in one facing</font>

474
00:21:42,860 --> 00:21:46,399
incident because we thought<font color="#E5E5E5"> we were</font>

475
00:21:44,030 --> 00:21:48,580
<font color="#CCCCCC">working on a low SLA rack and we were</font>

476
00:21:46,400 --> 00:21:48,580
not

477
00:21:49,049 --> 00:21:54,070
one app an interesting<font color="#E5E5E5"> anecdote that</font>

478
00:21:52,299 --> 00:21:56,830
<font color="#E5E5E5">came out of this is</font><font color="#CCCCCC"> that we</font><font color="#E5E5E5"> went we had</font>

479
00:21:54,070 --> 00:21:58,600
<font color="#E5E5E5">one app we were very worried about just</font>

480
00:21:56,830 --> 00:22:01,119
<font color="#CCCCCC">because of the sensitivity app and the</font>

481
00:21:58,600 --> 00:22:02,619
amount of traffic involved<font color="#CCCCCC"> the solution</font>

482
00:22:01,119 --> 00:22:05,830
<font color="#E5E5E5">that we came</font><font color="#CCCCCC"> up after talking to those</font>

483
00:22:02,619 --> 00:22:09,220
service owners was turn off all their

484
00:22:05,830 --> 00:22:11,259
racks<font color="#E5E5E5"> at the same time</font><font color="#CCCCCC"> so I</font><font color="#E5E5E5"> turn off</font><font color="#CCCCCC"> OS</font>

485
00:22:09,220 --> 00:22:15,429
<font color="#CCCCCC">p f on all their racks at the same time</font>

486
00:22:11,259 --> 00:22:19,169
the end result<font color="#E5E5E5"> a bit</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> bit of a subtle</font>

487
00:22:15,429 --> 00:22:22,840
but important change in statement<font color="#E5E5E5"> and</font>

488
00:22:19,169 --> 00:22:25,299
the result of<font color="#CCCCCC"> that</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> that app had one</font>

489
00:22:22,840 --> 00:22:27,488
<font color="#E5E5E5">minute of impact they drop below SLA for</font>

490
00:22:25,299 --> 00:22:30,999
<font color="#CCCCCC">one minute bounced right</font><font color="#E5E5E5"> back</font>

491
00:22:27,489 --> 00:22:33,070
<font color="#CCCCCC">everything was</font><font color="#E5E5E5"> cool</font><font color="#CCCCCC"> and that drives home</font>

492
00:22:30,999 --> 00:22:35,259
<font color="#E5E5E5">definitely the need to make sure</font><font color="#CCCCCC"> that</font>

493
00:22:33,070 --> 00:22:36,759
when we're doing<font color="#E5E5E5"> a change like this</font><font color="#CCCCCC"> you</font>

494
00:22:35,259 --> 00:22:38,139
know you got to<font color="#CCCCCC"> communicate with</font>

495
00:22:36,759 --> 00:22:40,989
everybody<font color="#E5E5E5"> else</font><font color="#CCCCCC"> that you're working</font><font color="#E5E5E5"> with</font>

496
00:22:38,139 --> 00:22:43,359
<font color="#E5E5E5">we have a control center</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> have various</font>

497
00:22:40,989 --> 00:22:46,450
app owners<font color="#CCCCCC"> and just you know</font>

498
00:22:43,359 --> 00:22:48,039
<font color="#E5E5E5">communication is key in in large project</font>

499
00:22:46,450 --> 00:22:50,679
<font color="#CCCCCC">like this</font><font color="#E5E5E5"> which is interesting because a</font>

500
00:22:48,039 --> 00:22:51,908
<font color="#CCCCCC">lot your</font><font color="#E5E5E5"> you're dealing</font><font color="#CCCCCC"> with developers</font>

501
00:22:50,679 --> 00:22:53,739
<font color="#E5E5E5">that may not really know</font><font color="#CCCCCC"> about the</font>

502
00:22:51,909 --> 00:22:56,080
network but<font color="#E5E5E5"> you have to make them</font>

503
00:22:53,739 --> 00:23:01,480
understand the implications of<font color="#E5E5E5"> what</font>

504
00:22:56,080 --> 00:23:04,960
<font color="#CCCCCC">you're doing one interest</font><font color="#E5E5E5"> one nice graph</font>

505
00:23:01,480 --> 00:23:06,970
that came out<font color="#E5E5E5"> of this is this is our PD</font>

506
00:23:04,960 --> 00:23:11,289
on one of our cluster switches before

507
00:23:06,970 --> 00:23:14,259
and after before and after turning<font color="#E5E5E5"> off</font>

508
00:23:11,289 --> 00:23:15,700
<font color="#CCCCCC">OSPF we</font><font color="#E5E5E5"> weren't expecting that dramatic</font>

509
00:23:14,259 --> 00:23:21,249
a difference but we<font color="#CCCCCC"> were very happy</font><font color="#E5E5E5"> to</font>

510
00:23:15,700 --> 00:23:24,070
see<font color="#CCCCCC"> it</font><font color="#E5E5E5"> that said not everything goes</font>

511
00:23:21,249 --> 00:23:25,600
<font color="#E5E5E5">perfectly so I'll take a few minutes and</font>

512
00:23:24,070 --> 00:23:27,879
<font color="#E5E5E5">talk about the things that we did wrong</font>

513
00:23:25,600 --> 00:23:29,980
<font color="#E5E5E5">were the things that we didn't expect</font><font color="#CCCCCC"> a</font>

514
00:23:27,879 --> 00:23:32,918
lot<font color="#E5E5E5"> of these are general lessons some</font>

515
00:23:29,980 --> 00:23:34,929
more specific to our<font color="#E5E5E5"> implementation</font><font color="#CCCCCC"> but</font>

516
00:23:32,919 --> 00:23:38,230
you know the<font color="#E5E5E5"> first rule to</font><font color="#CCCCCC"> remember in a</font>

517
00:23:34,929 --> 00:23:40,629
large project<font color="#E5E5E5"> is that lab</font><font color="#CCCCCC"> is not</font>

518
00:23:38,230 --> 00:23:43,480
<font color="#E5E5E5">production there will always be some of</font>

519
00:23:40,629 --> 00:23:46,359
these you<font color="#E5E5E5"> will always run into corner</font>

520
00:23:43,480 --> 00:23:50,649
cases<font color="#E5E5E5"> that you just could never have</font>

521
00:23:46,359 --> 00:23:53,379
simulated<font color="#E5E5E5"> in your lab</font><font color="#CCCCCC"> due</font><font color="#E5E5E5"> to scale or or</font>

522
00:23:50,649 --> 00:23:55,549
whatever<font color="#E5E5E5"> other reasons</font><font color="#CCCCCC"> canary</font>

523
00:23:53,379 --> 00:23:58,399
<font color="#E5E5E5">early and</font><font color="#CCCCCC"> often is</font><font color="#E5E5E5"> a</font>

524
00:23:55,549 --> 00:23:59,989
is a strong recommendation<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> how</font>

525
00:23:58,399 --> 00:24:03,590
you're gonna<font color="#E5E5E5"> catch things that you</font>

526
00:23:59,989 --> 00:24:06,619
didn't catch in your<font color="#E5E5E5"> lab automation our</font>

527
00:24:03,590 --> 00:24:07,820
<font color="#E5E5E5">automation was good but not great</font><font color="#CCCCCC"> you</font>

528
00:24:06,619 --> 00:24:09,799
know this project<font color="#CCCCCC"> had a lot of</font><font color="#E5E5E5"> time</font>

529
00:24:07,820 --> 00:24:12,860
<font color="#E5E5E5">pressure around it and our developers</font>

530
00:24:09,799 --> 00:24:15,168
did an incredible job<font color="#CCCCCC"> but at some point</font>

531
00:24:12,860 --> 00:24:17,090
<font color="#E5E5E5">we just had to say</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> it works good</font>

532
00:24:15,169 --> 00:24:18,980
enough are there things we<font color="#E5E5E5"> wish the</font>

533
00:24:17,090 --> 00:24:22,039
automation did that we didn't develop

534
00:24:18,980 --> 00:24:25,489
sure<font color="#E5E5E5"> but what we had was enough to get</font>

535
00:24:22,039 --> 00:24:28,190
<font color="#E5E5E5">the job done</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is also a project that</font>

536
00:24:25,489 --> 00:24:31,730
we've only done<font color="#CCCCCC"> you know it was one</font>

537
00:24:28,190 --> 00:24:33,230
<font color="#CCCCCC">project not an ongoing</font><font color="#E5E5E5"> initiative</font><font color="#CCCCCC"> if it</font>

538
00:24:31,730 --> 00:24:37,309
had<font color="#E5E5E5"> been we might have spent more time</font>

539
00:24:33,230 --> 00:24:38,960
there<font color="#CCCCCC"> we moved very fast and as a result</font>

540
00:24:37,309 --> 00:24:44,359
the documentation and run books fell

541
00:24:38,960 --> 00:24:47,419
behind<font color="#CCCCCC"> document first deploy later again</font>

542
00:24:44,359 --> 00:24:49,970
the one impact<font color="#E5E5E5"> impacting incident that I</font>

543
00:24:47,419 --> 00:24:52,399
mentioned because<font color="#CCCCCC"> we just we didn't have</font>

544
00:24:49,970 --> 00:24:54,289
perfect<font color="#CCCCCC"> information on what was</font><font color="#E5E5E5"> running</font>

545
00:24:52,399 --> 00:24:58,689
in a particular set of racks we were

546
00:24:54,289 --> 00:25:00,859
working on<font color="#E5E5E5"> going back to</font><font color="#CCCCCC"> the g-shot</font>

547
00:24:58,690 --> 00:25:02,210
implementation that actually was

548
00:25:00,859 --> 00:25:04,999
<font color="#E5E5E5">something that we missed the</font><font color="#CCCCCC"> first time</font>

549
00:25:02,210 --> 00:25:07,249
<font color="#E5E5E5">around we actually failed to deploy it</font>

550
00:25:04,999 --> 00:25:09,230
and<font color="#E5E5E5"> we deployed</font><font color="#CCCCCC"> it in one platform</font><font color="#E5E5E5"> but</font>

551
00:25:07,249 --> 00:25:13,909
missed the<font color="#E5E5E5"> policy to deploy in another</font>

552
00:25:09,230 --> 00:25:16,460
<font color="#CCCCCC">platform so we</font><font color="#E5E5E5"> had to retro</font><font color="#CCCCCC"> later on</font>

553
00:25:13,909 --> 00:25:19,669
down<font color="#CCCCCC"> the</font><font color="#E5E5E5"> line and by the line I mean two</font>

554
00:25:16,460 --> 00:25:24,440
months<font color="#E5E5E5"> after we completed the project</font><font color="#CCCCCC"> we</font>

555
00:25:19,669 --> 00:25:28,039
ran<font color="#CCCCCC"> into this problem which was</font><font color="#E5E5E5"> that in</font>

556
00:25:24,440 --> 00:25:31,009
a class in a clause model<font color="#E5E5E5"> you're going</font>

557
00:25:28,039 --> 00:25:33,799
to have routes coming<font color="#E5E5E5"> up from your racks</font>

558
00:25:31,009 --> 00:25:35,509
<font color="#CCCCCC">that</font><font color="#E5E5E5"> are gonna have shorter shorter</font>

559
00:25:33,799 --> 00:25:37,429
paths<font color="#E5E5E5"> but you're also going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be</font>

560
00:25:35,509 --> 00:25:41,239
bouncing prefixes if you don't<font color="#E5E5E5"> filter</font>

561
00:25:37,429 --> 00:25:43,879
them<font color="#CCCCCC"> through other spines</font><font color="#E5E5E5"> so we saw a</font>

562
00:25:41,239 --> 00:25:46,580
<font color="#CCCCCC">situation where if a fabric lost</font>

563
00:25:43,879 --> 00:25:48,559
connectivity<font color="#E5E5E5"> to a particular cluster now</font>

564
00:25:46,580 --> 00:25:49,699
granted no traffic<font color="#E5E5E5"> would hit that spine</font>

565
00:25:48,559 --> 00:25:53,330
because it doesn't have a route there

566
00:25:49,700 --> 00:25:57,169
but in that<font color="#CCCCCC"> fat in that spines routing</font>

567
00:25:53,330 --> 00:26:00,289
spying devices routing table<font color="#CCCCCC"> its best</font>

568
00:25:57,169 --> 00:26:02,419
route to hosts in that cluster<font color="#E5E5E5"> was a</font>

569
00:26:00,289 --> 00:26:05,450
nice EMP path through every other

570
00:26:02,419 --> 00:26:09,260
<font color="#E5E5E5">cluster in the</font><font color="#CCCCCC"> switch via all the</font>

571
00:26:05,450 --> 00:26:11,419
various spines<font color="#E5E5E5"> this this resulted in</font>

572
00:26:09,260 --> 00:26:14,390
this resulted in a minor incident just

573
00:26:11,419 --> 00:26:16,640
<font color="#CCCCCC">due to the</font><font color="#E5E5E5"> FIB scale going a lot wider</font>

574
00:26:14,390 --> 00:26:18,110
than<font color="#E5E5E5"> we ever expected</font><font color="#CCCCCC"> that required</font><font color="#E5E5E5"> us</font>

575
00:26:16,640 --> 00:26:20,750
to add<font color="#CCCCCC"> some additional filtering to make</font>

576
00:26:18,110 --> 00:26:24,760
sure that no cluster would advertise up

577
00:26:20,750 --> 00:26:28,040
a route that was not local<font color="#E5E5E5"> that cluster</font>

578
00:26:24,760 --> 00:26:29,570
<font color="#E5E5E5">so that's been resolved</font><font color="#CCCCCC"> all in all</font>

579
00:26:28,040 --> 00:26:32,049
<font color="#E5E5E5">things are working well for us we're</font>

580
00:26:29,570 --> 00:26:35,418
<font color="#E5E5E5">still iterating</font><font color="#CCCCCC"> we're still improving</font>

581
00:26:32,049 --> 00:26:38,450
<font color="#CCCCCC">but and</font><font color="#E5E5E5"> you know</font><font color="#CCCCCC"> hopefully</font><font color="#E5E5E5"> this is this</font>

582
00:26:35,419 --> 00:26:41,330
<font color="#E5E5E5">is the tail end and we're not going to</font>

583
00:26:38,450 --> 00:26:45,230
<font color="#E5E5E5">have to do this again</font><font color="#CCCCCC"> it was a pretty</font>

584
00:26:41,330 --> 00:26:47,120
intense project to say the least<font color="#E5E5E5"> but</font><font color="#CCCCCC"> I</font>

585
00:26:45,230 --> 00:26:48,610
think we made a lot<font color="#E5E5E5"> of progress and I'm</font>

586
00:26:47,120 --> 00:26:54,340
very happy<font color="#CCCCCC"> with our work in the end</font>

587
00:26:48,610 --> 00:26:54,340
<font color="#E5E5E5">thank</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> mushrooms</font>

588
00:27:03,490 --> 00:27:09,200
hi Kevin Bloomberg<font color="#CCCCCC"> one</font><font color="#E5E5E5"> quick question</font>

589
00:27:06,650 --> 00:27:11,809
<font color="#CCCCCC">for you yes did you compute after this</font>

590
00:27:09,200 --> 00:27:15,950
how many<font color="#CCCCCC"> additional hours of</font><font color="#E5E5E5"> sleep you</font>

591
00:27:11,809 --> 00:27:19,010
got<font color="#E5E5E5"> I really should have there were a</font>

592
00:27:15,950 --> 00:27:21,559
lot of late nights here no but what I'm

593
00:27:19,010 --> 00:27:23,360
actually meant was<font color="#E5E5E5"> how much extra sleep</font>

594
00:27:21,559 --> 00:27:27,289
you got<font color="#CCCCCC"> because you</font><font color="#E5E5E5"> weren't running with</font>

595
00:27:23,360 --> 00:27:30,709
<font color="#E5E5E5">50,000 Elysee</font><font color="#CCCCCC"> and issues related to that</font>

596
00:27:27,289 --> 00:27:33,350
<font color="#CCCCCC">I can I</font><font color="#E5E5E5"> can tell you that</font><font color="#CCCCCC"> Network</font>

597
00:27:30,710 --> 00:27:35,440
incidents in the quarter<font color="#CCCCCC"> after we</font><font color="#E5E5E5"> could</font>

598
00:27:33,350 --> 00:27:40,820
<font color="#E5E5E5">leave this deployment</font><font color="#CCCCCC"> we're down</font><font color="#E5E5E5"> by half</font>

599
00:27:35,440 --> 00:27:42,740
<font color="#E5E5E5">thank you good morning Chris Matt</font><font color="#CCCCCC"> Pete</font>

600
00:27:40,820 --> 00:27:44,629
<font color="#CCCCCC">at</font><font color="#E5E5E5"> Yahoo</font><font color="#CCCCCC"> I noticed you didn't actually</font>

601
00:27:42,740 --> 00:27:47,390
tell<font color="#E5E5E5"> us whether you decided</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the</font>

602
00:27:44,630 --> 00:27:49,370
32-bit<font color="#E5E5E5"> ace and 16-bit</font><font color="#CCCCCC"> ASN and the like</font>

603
00:27:47,390 --> 00:27:52,399
<font color="#E5E5E5">I guess that's left as a an exercise for</font>

604
00:27:49,370 --> 00:27:54,168
<font color="#E5E5E5">the reader</font><font color="#CCCCCC"> we got we got lucky and we</font>

605
00:27:52,399 --> 00:27:56,449
didn't have anything<font color="#E5E5E5"> in our network</font><font color="#CCCCCC"> that</font>

606
00:27:54,169 --> 00:27:58,010
didn't<font color="#CCCCCC"> support 32-bit</font><font color="#E5E5E5"> but I know there's</font>

607
00:27:56,450 --> 00:28:00,169
people who have<font color="#E5E5E5"> not had the</font><font color="#CCCCCC"> same</font>

608
00:27:58,010 --> 00:28:02,149
experience<font color="#E5E5E5"> and one other question you</font>

609
00:28:00,169 --> 00:28:03,710
said 50,000<font color="#E5E5E5"> Dell essays before</font><font color="#CCCCCC"> you</font>

610
00:28:02,149 --> 00:28:05,928
started I'm curious did you actually

611
00:28:03,710 --> 00:28:09,740
<font color="#E5E5E5">track how</font><font color="#CCCCCC"> many prefixes were in your</font><font color="#E5E5E5"> BGP</font>

612
00:28:05,929 --> 00:28:13,460
after you were done<font color="#CCCCCC"> yes far fewer than</font>

613
00:28:09,740 --> 00:28:15,679
50,000 around you know mid mid to high

614
00:28:13,460 --> 00:28:17,450
mid to high thousands<font color="#E5E5E5"> and we're working</font>

615
00:28:15,679 --> 00:28:20,330
<font color="#CCCCCC">on that we're doing</font><font color="#E5E5E5"> more</font><font color="#CCCCCC"> deep we're</font>

616
00:28:17,450 --> 00:28:22,880
doing more aggregation to a lot<font color="#E5E5E5"> of those</font>

617
00:28:20,330 --> 00:28:24,830
<font color="#CCCCCC">r / 31 like nets that</font><font color="#E5E5E5"> were</font><font color="#CCCCCC"> we're</font>

618
00:28:22,880 --> 00:28:26,870
aggregated in<font color="#CCCCCC"> OSPF but the way</font><font color="#E5E5E5"> that we</font>

619
00:28:24,830 --> 00:28:29,000
did our<font color="#E5E5E5"> link numbering we couldn't</font>

620
00:28:26,870 --> 00:28:30,379
aggregate in<font color="#E5E5E5"> BGP as well but we're doing</font>

621
00:28:29,000 --> 00:28:32,270
<font color="#E5E5E5">a renumber</font>

622
00:28:30,380 --> 00:28:34,059
now<font color="#E5E5E5"> so that we can bring those back into</font>

623
00:28:32,270 --> 00:28:36,260
aggregates and<font color="#CCCCCC"> reduce</font><font color="#E5E5E5"> that fit further</font>

624
00:28:34,059 --> 00:28:37,460
you shouldn't have any scaling problems

625
00:28:36,260 --> 00:28:43,279
with that<font color="#CCCCCC"> lower</font><font color="#E5E5E5"> number though so I</font>

626
00:28:37,460 --> 00:28:48,890
should be<font color="#CCCCCC"> safe thank you hi I'm sue</font>

627
00:28:43,279 --> 00:28:52,340
here's um I'm also a BGP chair<font color="#E5E5E5"> in ITF so</font>

628
00:28:48,890 --> 00:28:55,220
question is did<font color="#CCCCCC"> you have interoperable G</font>

629
00:28:52,340 --> 00:28:57,350
<font color="#CCCCCC">shut</font><font color="#E5E5E5"> community implementations</font><font color="#CCCCCC"> I wasn't</font>

630
00:28:55,220 --> 00:29:00,110
quite<font color="#E5E5E5"> clear on</font><font color="#CCCCCC"> your problems that you</font>

631
00:28:57,350 --> 00:29:03,469
were listing there<font color="#E5E5E5"> and as a chair should</font>

632
00:29:00,110 --> 00:29:05,928
we push standardization<font color="#E5E5E5"> of that faster</font>

633
00:29:03,470 --> 00:29:08,590
<font color="#CCCCCC">okay so there there's a draft on</font><font color="#E5E5E5"> the</font>

634
00:29:05,929 --> 00:29:11,740
g-shot community<font color="#CCCCCC"> I don't think it got</font>

635
00:29:08,590 --> 00:29:14,620
actually got an RFC number<font color="#CCCCCC"> some some of</font>

636
00:29:11,740 --> 00:29:17,140
our switch<font color="#E5E5E5"> OS</font><font color="#CCCCCC"> vendor support support</font>

637
00:29:14,620 --> 00:29:18,610
<font color="#E5E5E5">g-shot natively if you know there's no</font>

638
00:29:17,140 --> 00:29:19,600
additional config needed if I see the

639
00:29:18,610 --> 00:29:22,928
community<font color="#E5E5E5"> I'm setting</font><font color="#CCCCCC"> will come from</font>

640
00:29:19,600 --> 00:29:25,750
<font color="#CCCCCC">zero</font><font color="#E5E5E5"> other vendors we build policy to</font>

641
00:29:22,929 --> 00:29:29,380
replicate the behavior<font color="#CCCCCC"> you know just</font>

642
00:29:25,750 --> 00:29:31,360
with<font color="#CCCCCC"> match set policies</font><font color="#E5E5E5"> the there's a</font>

643
00:29:29,380 --> 00:29:34,539
bit in<font color="#CCCCCC"> the draft where the</font>

644
00:29:31,360 --> 00:29:36,639
recommendation is<font color="#CCCCCC"> to if you receive a G</font>

645
00:29:34,539 --> 00:29:38,110
around with<font color="#E5E5E5"> a G shut community set to</font>

646
00:29:36,640 --> 00:29:40,659
set your local<font color="#CCCCCC"> where up</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> zero but then</font>

647
00:29:38,110 --> 00:29:42,850
also<font color="#CCCCCC"> strip the community from</font><font color="#E5E5E5"> the prefix</font>

648
00:29:40,659 --> 00:29:45,330
so if you pass<font color="#CCCCCC"> that prefix along we're</font>

649
00:29:42,850 --> 00:29:49,240
sending it<font color="#CCCCCC"> without that G shut community</font>

650
00:29:45,330 --> 00:29:50,949
<font color="#CCCCCC">we we</font><font color="#E5E5E5"> couldn't figure out why that would</font>

651
00:29:49,240 --> 00:29:53,110
be something we would want<font color="#CCCCCC"> to</font><font color="#E5E5E5"> do in our</font>

652
00:29:50,950 --> 00:29:54,760
opinion if you have a route that's

653
00:29:53,110 --> 00:29:58,570
poisoned it should stay poisoned all<font color="#E5E5E5"> the</font>

654
00:29:54,760 --> 00:29:59,890
way through<font color="#CCCCCC"> and actually</font><font color="#E5E5E5"> when</font><font color="#CCCCCC"> we talk to</font>

655
00:29:58,570 --> 00:30:02,168
<font color="#E5E5E5">one of our</font><font color="#CCCCCC"> vendors the vendor that</font><font color="#E5E5E5"> I</font>

656
00:29:59,890 --> 00:30:05,500
mentioned<font color="#E5E5E5"> did support it natively they</font>

657
00:30:02,169 --> 00:30:08,640
came to the same conclusion<font color="#E5E5E5"> okay thank</font>

658
00:30:05,500 --> 00:30:08,640
you<font color="#E5E5E5"> that's really good</font><font color="#CCCCCC"> feedback</font>

659
00:30:11,049 --> 00:30:14,500
<font color="#CCCCCC">yeah just one moment want</font><font color="#E5E5E5"> to make</font><font color="#CCCCCC"> sure</font>

660
00:30:12,820 --> 00:30:16,149
we have two more<font color="#CCCCCC"> questions</font><font color="#E5E5E5"> that were</font>

661
00:30:14,500 --> 00:30:20,200
closing<font color="#E5E5E5"> the mics after this</font>

662
00:30:16,149 --> 00:30:24,760
just a follow-up on the<font color="#E5E5E5"> g-shot</font><font color="#CCCCCC"> yes you</font>

663
00:30:20,200 --> 00:30:25,330
had the choice in some<font color="#CCCCCC"> cases to do the</font>

664
00:30:24,760 --> 00:30:29,049
<font color="#E5E5E5">g-shot</font>

665
00:30:25,330 --> 00:30:31,360
policy yourself<font color="#E5E5E5"> or rely on the vendors</font>

666
00:30:29,049 --> 00:30:34,899
implementation which way did you feel

667
00:30:31,360 --> 00:30:37,149
<font color="#E5E5E5">more</font><font color="#CCCCCC"> comfortable about if</font><font color="#E5E5E5"> I would say</font>

668
00:30:34,899 --> 00:30:40,299
<font color="#E5E5E5">that you know just from a having more</font>

669
00:30:37,149 --> 00:30:41,649
control<font color="#E5E5E5"> over my environment</font><font color="#CCCCCC"> I would say</font>

670
00:30:40,299 --> 00:30:43,929
I have<font color="#E5E5E5"> a weak preference for be able to</font>

671
00:30:41,649 --> 00:30:46,059
find the policy myself<font color="#E5E5E5"> now the one</font>

672
00:30:43,929 --> 00:30:49,270
vendor<font color="#E5E5E5"> the one vendor that supports it</font>

673
00:30:46,059 --> 00:30:52,809
natively<font color="#CCCCCC"> they do provide kentuc so you</font>

674
00:30:49,270 --> 00:30:55,450
can modify the policy but they do the we

675
00:30:52,809 --> 00:31:02,879
wound up<font color="#E5E5E5"> using</font><font color="#CCCCCC"> their to fall</font><font color="#E5E5E5"> the boss</font>

676
00:30:55,450 --> 00:31:05,289
policy in that<font color="#CCCCCC"> OS own DeLong Akamai</font>

677
00:31:02,880 --> 00:31:08,380
<font color="#CCCCCC">you're going</font><font color="#E5E5E5"> through a remembering</font>

678
00:31:05,289 --> 00:31:13,629
project to aggregate<font color="#E5E5E5"> your link addresses</font>

679
00:31:08,380 --> 00:31:15,130
<font color="#E5E5E5">why bother to carry them at all</font><font color="#CCCCCC"> there's</font>

680
00:31:13,630 --> 00:31:18,159
a there's there<font color="#CCCCCC"> are some</font><font color="#E5E5E5"> reasons</font><font color="#CCCCCC"> for</font>

681
00:31:15,130 --> 00:31:20,460
that<font color="#E5E5E5"> and we did consider</font><font color="#CCCCCC"> that but we</font>

682
00:31:18,159 --> 00:31:22,590
<font color="#E5E5E5">found that there are some other</font>

683
00:31:20,460 --> 00:31:24,450
reason you know I'll tell<font color="#E5E5E5"> you</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> at the</font>

684
00:31:22,590 --> 00:31:26,370
bar<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> messed I</font><font color="#E5E5E5"> can explain it we</font>

685
00:31:24,450 --> 00:31:27,860
found we actually found that<font color="#E5E5E5"> with there</font>

686
00:31:26,370 --> 00:31:29,610
were some things that broke pretty badly

687
00:31:27,860 --> 00:31:31,169
<font color="#E5E5E5">monitoring being the first thing</font>

688
00:31:29,610 --> 00:31:33,990
monitoring was pinging those<font color="#CCCCCC"> link Nets</font>

689
00:31:31,170 --> 00:31:35,160
<font color="#E5E5E5">that doesn't I don't</font><font color="#CCCCCC"> necessarily need to</font>

690
00:31:33,990 --> 00:31:36,450
do<font color="#CCCCCC"> that and</font><font color="#E5E5E5"> that's something we were</font>

691
00:31:35,160 --> 00:31:42,270
<font color="#E5E5E5">discussing whether or not that's a</font>

692
00:31:36,450 --> 00:31:45,390
necessity<font color="#CCCCCC"> DHCP DHCP forwarding on our</font>

693
00:31:42,270 --> 00:31:48,270
network on our top of<font color="#CCCCCC"> racks</font><font color="#E5E5E5"> actually</font>

694
00:31:45,390 --> 00:31:49,890
sources the unicast of DHCP<font color="#CCCCCC"> request</font>

695
00:31:48,270 --> 00:31:52,639
using<font color="#CCCCCC"> link</font><font color="#E5E5E5"> netted</font><font color="#CCCCCC"> Drex and not a</font>

696
00:31:49,890 --> 00:31:54,840
<font color="#E5E5E5">loopback that's what broke</font><font color="#CCCCCC"> the worst I</font>

697
00:31:52,640 --> 00:31:57,930
saw you put your head<font color="#E5E5E5"> I saw you put your</font>

698
00:31:54,840 --> 00:32:00,020
head<font color="#CCCCCC"> to your hand</font><font color="#E5E5E5"> we had the same</font>

699
00:31:57,930 --> 00:32:00,020
reaction

700
00:32:01,310 --> 00:32:06,350
<font color="#E5E5E5">alrighty thank you so much Chris</font>

701
00:32:03,540 --> 00:32:06,350
<font color="#CCCCCC">will appreciate that</font>

