1
00:00:20,500 --> 00:00:24,650
alright so I'm gonna ask a few questions

2
00:00:22,700 --> 00:00:26,630
and throughout this presentation I'd

3
00:00:24,650 --> 00:00:27,770
like you to raise your hand or and if

4
00:00:26,630 --> 00:00:29,029
you're not quite sure just pick

5
00:00:27,770 --> 00:00:32,000
something it doesn't really matter too

6
00:00:29,029 --> 00:00:33,860
much how many of those are in the red

7
00:00:32,000 --> 00:00:35,180
side so the attack is the pen test is

8
00:00:33,860 --> 00:00:39,769
that sort of thing can I get a show of

9
00:00:35,180 --> 00:00:42,559
hands for how many are on the blue side

10
00:00:39,770 --> 00:00:49,850
of things okay I was actually expecting

11
00:00:42,559 --> 00:00:51,559
you reverse there so given that most of

12
00:00:49,850 --> 00:00:53,090
the audience is blue how many think they

13
00:00:51,560 --> 00:00:57,350
have a good grasp on how long it takes

14
00:00:53,090 --> 00:00:59,000
to actually investigate a red team how

15
00:00:57,350 --> 00:01:02,239
many people reckon it's about ten hours

16
00:00:59,000 --> 00:01:04,449
work for a one day red team no let's go

17
00:01:02,239 --> 00:01:08,149
a hundred hours for one day red team a

18
00:01:04,449 --> 00:01:09,229
few okay all right the reason I'm up

19
00:01:08,149 --> 00:01:11,829
here talking to you guys today is

20
00:01:09,229 --> 00:01:15,590
because I found a really big disconnect

21
00:01:11,829 --> 00:01:17,539
between what a lot of pen testers think

22
00:01:15,590 --> 00:01:20,570
is the time it takes actually

23
00:01:17,540 --> 00:01:23,870
investigate a red team I found that they

24
00:01:20,570 --> 00:01:26,509
thought they ran one nmap scan and it

25
00:01:23,870 --> 00:01:27,799
would hit 155 hosts and they think I

26
00:01:26,510 --> 00:01:30,890
that that's a couple of minutes work

27
00:01:27,799 --> 00:01:32,510
when in reality it's it's it's very

28
00:01:30,890 --> 00:01:34,369
different so what I'm gonna go through

29
00:01:32,510 --> 00:01:36,560
today is basically I'm gonna go through

30
00:01:34,369 --> 00:01:38,270
a red team and I'm gonna talk about I'm

31
00:01:36,560 --> 00:01:40,549
gonna go the red team the blue team and

32
00:01:38,270 --> 00:01:42,759
what you can do on both sides and then

33
00:01:40,549 --> 00:01:45,650
I'm gonna go through some of the real

34
00:01:42,760 --> 00:01:48,439
issues that are about and the compound

35
00:01:45,650 --> 00:01:50,659
the time that takes actually decipher

36
00:01:48,439 --> 00:01:53,360
what's happened in an engagement like

37
00:01:50,659 --> 00:01:54,799
this and also that recent slack

38
00:01:53,360 --> 00:01:56,179
conversation on SEC talk so it was

39
00:01:54,799 --> 00:01:58,490
enough good blue team so this is my

40
00:01:56,180 --> 00:02:00,920
attempt sorry blue team talk so this is

41
00:01:58,490 --> 00:02:07,429
my attempt to actually solve that issue

42
00:02:00,920 --> 00:02:09,679
now I've been I've conducted red teams

43
00:02:07,430 --> 00:02:11,120
I've been I've actually been mostly on

44
00:02:09,679 --> 00:02:13,129
the other side I've been defending

45
00:02:11,120 --> 00:02:16,159
against red teams and I've personally

46
00:02:13,129 --> 00:02:18,590
had probably about five to seven red

47
00:02:16,159 --> 00:02:22,069
teams against myself and the greater

48
00:02:18,590 --> 00:02:24,020
team that I work with and I've picked up

49
00:02:22,069 --> 00:02:25,480
some sneaky tricks along the way and not

50
00:02:24,020 --> 00:02:27,409
all those are mine

51
00:02:25,480 --> 00:02:28,849
but I'm also picked up some interesting

52
00:02:27,409 --> 00:02:31,340
detection strategies which you may not

53
00:02:28,849 --> 00:02:32,929
have thought about and we're gonna go

54
00:02:31,340 --> 00:02:35,719
through these estándar step by step

55
00:02:32,930 --> 00:02:38,599
process so now I wasn't born blue team

56
00:02:35,719 --> 00:02:41,599
all right I it's quite an interesting

57
00:02:38,599 --> 00:02:45,858
story actually I interviewed for a job

58
00:02:41,599 --> 00:02:48,798
but actually croc econ one that is a

59
00:02:45,859 --> 00:02:50,329
photo of Zayn resign they're saying his

60
00:02:48,799 --> 00:02:52,430
own put your hand up I need I want to

61
00:02:50,329 --> 00:02:54,169
that's the photo of Zayn and I at crack

62
00:02:52,430 --> 00:02:56,840
econ one now just to give an example of

63
00:02:54,169 --> 00:03:01,310
how far we've come look behind me there

64
00:02:56,840 --> 00:03:03,019
that's a tarp over a window tape to the

65
00:03:01,310 --> 00:03:04,579
window that someone had to rush out and

66
00:03:03,019 --> 00:03:06,199
get because when they put the projector

67
00:03:04,579 --> 00:03:08,810
on it was too much light and no one

68
00:03:06,199 --> 00:03:11,030
could see anything now clearly we can

69
00:03:08,810 --> 00:03:13,669
now afford color printing because it's

70
00:03:11,030 --> 00:03:15,829
an a3 black and white crikey Khan behind

71
00:03:13,669 --> 00:03:18,650
me there and that was at the old polish

72
00:03:15,829 --> 00:03:23,209
Club but West in there so that that's a

73
00:03:18,650 --> 00:03:25,400
going back a little bit now we actually

74
00:03:23,209 --> 00:03:27,469
talked about we scanned all of the ipv4

75
00:03:25,400 --> 00:03:29,239
Australian address space just before g20

76
00:03:27,469 --> 00:03:30,888
this was right around that time just to

77
00:03:29,239 --> 00:03:33,430
see how vulnerable we were I'm sure you

78
00:03:30,889 --> 00:03:35,030
can guess the conclusion to that talk

79
00:03:33,430 --> 00:03:37,430
but that was actually a fairly

80
00:03:35,030 --> 00:03:39,500
uneventful g20 if you remember not a lot

81
00:03:37,430 --> 00:03:40,759
happened which was quite surprising but

82
00:03:39,500 --> 00:03:43,069
there was a lot of talk in the media

83
00:03:40,759 --> 00:03:45,018
that you know some cyber element may

84
00:03:43,069 --> 00:03:49,220
occur but we never thankfully we never

85
00:03:45,019 --> 00:03:52,280
saw that now my name's Ben past more and

86
00:03:49,220 --> 00:03:53,810
I have the blue team blues as you can

87
00:03:52,280 --> 00:03:57,949
see from this photo I have a lot more

88
00:03:53,810 --> 00:04:01,519
gray hair now I've gone a bit bald and

89
00:03:57,949 --> 00:04:04,009
up a bit bit more power here as well you

90
00:04:01,519 --> 00:04:06,680
know that's I need to start some BTA

91
00:04:04,009 --> 00:04:08,268
meetings blue team was enormous I need

92
00:04:06,680 --> 00:04:09,560
to thank Stacey Lopes you have the jcic

93
00:04:08,269 --> 00:04:12,560
actually for the for the name to the

94
00:04:09,560 --> 00:04:14,780
talk now just before I continue this is

95
00:04:12,560 --> 00:04:16,909
disclaimer the learnings from this

96
00:04:14,780 --> 00:04:18,829
presentation aren't from one employer

97
00:04:16,909 --> 00:04:22,190
they're actually from a lot of people

98
00:04:18,829 --> 00:04:25,400
I've combined a lot of people's

99
00:04:22,190 --> 00:04:26,690
learnings into this presentation so my

100
00:04:25,400 --> 00:04:28,758
opinions are not my employers at the

101
00:04:26,690 --> 00:04:29,210
moment and a quick google tell you who I

102
00:04:28,759 --> 00:04:32,539
work for

103
00:04:29,210 --> 00:04:35,180
but this is not them so I'm gonna step

104
00:04:32,539 --> 00:04:36,409
through a red team exercise now and it's

105
00:04:35,180 --> 00:04:38,059
gonna be a bit of a scenario so we have

106
00:04:36,409 --> 00:04:43,429
external attackers

107
00:04:38,059 --> 00:04:45,110
an external red team sorry and their

108
00:04:43,429 --> 00:04:46,849
goal is to get a internal database

109
00:04:45,110 --> 00:04:48,589
alright they just need to exfiltrate

110
00:04:46,849 --> 00:04:50,058
this internal database that's their flag

111
00:04:48,589 --> 00:04:56,569
and then they need to maintain some

112
00:04:50,059 --> 00:05:01,009
persistence so usually the first step is

113
00:04:56,569 --> 00:05:02,449
some sort of reconnaissance this is a

114
00:05:01,009 --> 00:05:04,999
form of passive intelligence gathering

115
00:05:02,449 --> 00:05:06,469
and it usually provides the biggest

116
00:05:04,999 --> 00:05:09,110
amount of wealth of information in any

117
00:05:06,469 --> 00:05:12,019
red team exercise and this can be from

118
00:05:09,110 --> 00:05:14,779
Showdown google multigo all those sorts

119
00:05:12,019 --> 00:05:16,699
of powerful tools and to get a really a

120
00:05:14,779 --> 00:05:22,129
lay of the land and you can find a lot

121
00:05:16,699 --> 00:05:23,719
with a bit of google kung fu so that's

122
00:05:22,129 --> 00:05:27,860
usually the first step and the important

123
00:05:23,719 --> 00:05:29,299
word there is passive for a blue team

124
00:05:27,860 --> 00:05:30,559
side it's like you're playing Where's

125
00:05:29,299 --> 00:05:33,019
Waldo but you actually don't know you're

126
00:05:30,559 --> 00:05:34,459
playing Where's Waldo this is really

127
00:05:33,019 --> 00:05:37,999
hard to detect any sort of

128
00:05:34,459 --> 00:05:43,849
reconnaissance against any target

129
00:05:37,999 --> 00:05:45,259
because it is designed to be passive the

130
00:05:43,849 --> 00:05:46,819
attackers don't actually want you to

131
00:05:45,259 --> 00:05:48,889
know that they're looking at you at the

132
00:05:46,819 --> 00:05:50,479
moment but there are some things you can

133
00:05:48,889 --> 00:05:53,539
do raise of hands how many people know

134
00:05:50,479 --> 00:05:54,529
what canary tokens are a few okay I'll

135
00:05:53,539 --> 00:05:56,808
go over it again just for those who

136
00:05:54,529 --> 00:06:01,308
don't know so canary token II is some

137
00:05:56,809 --> 00:06:03,679
form of beacon it can be embedded in the

138
00:06:01,309 --> 00:06:05,149
document which is usually the case and

139
00:06:03,679 --> 00:06:08,359
it can be an image that loads from an

140
00:06:05,149 --> 00:06:09,889
external site and usually this all this

141
00:06:08,360 --> 00:06:13,069
tells you is that your document is

142
00:06:09,889 --> 00:06:14,419
opened in X it may give you a country it

143
00:06:13,069 --> 00:06:15,889
may give you an IP address that's about

144
00:06:14,419 --> 00:06:17,299
it but it can just be open so if you

145
00:06:15,889 --> 00:06:19,249
have confidential documents internally

146
00:06:17,299 --> 00:06:21,828
that shouldn't be shared externally they

147
00:06:19,249 --> 00:06:23,239
can all contain canary canary tokens and

148
00:06:21,829 --> 00:06:24,679
all of a sudden you be like why is our

149
00:06:23,239 --> 00:06:27,498
document been open in Kazakhstan

150
00:06:24,679 --> 00:06:30,888
we're in Australian company so that sort

151
00:06:27,499 --> 00:06:31,879
of technique can be used there's a fair

152
00:06:30,889 --> 00:06:33,979
few companies to do this sort of

153
00:06:31,879 --> 00:06:35,209
technique and it's quite good and you'll

154
00:06:33,979 --> 00:06:36,799
see a lot of their marketing people to

155
00:06:35,209 --> 00:06:40,129
use it for our email marketing

156
00:06:36,799 --> 00:06:42,229
statistics as well now there's another

157
00:06:40,129 --> 00:06:47,660
thing though that actually sort of works

158
00:06:42,229 --> 00:06:53,070
fake accounts these don't always work

159
00:06:47,660 --> 00:06:55,050
this is Benjamin and a lot of the time

160
00:06:53,070 --> 00:06:56,880
you can put these up on LinkedIn or

161
00:06:55,050 --> 00:06:58,890
Facebook or whatever it may be but you

162
00:06:56,880 --> 00:07:01,380
to agree you are actually breaking the

163
00:06:58,890 --> 00:07:04,950
Terms of Service this is something we

164
00:07:01,380 --> 00:07:06,600
have had a lot of success with okay

165
00:07:04,950 --> 00:07:09,840
especially LinkedIn putting up those

166
00:07:06,600 --> 00:07:10,980
fake accounts and you'll get sometimes

167
00:07:09,840 --> 00:07:12,479
you're not quite sure if they're just

168
00:07:10,980 --> 00:07:15,180
like your profile picture or if they're

169
00:07:12,480 --> 00:07:17,820
actually some sort of attack waiting to

170
00:07:15,180 --> 00:07:19,620
happen but if you look at your proxy

171
00:07:17,820 --> 00:07:22,980
logs actually and you look across your

172
00:07:19,620 --> 00:07:24,720
proxy logs and most of you URLs from

173
00:07:22,980 --> 00:07:26,640
mostly shuttle social media networks

174
00:07:24,720 --> 00:07:29,220
will provide a unique identifier for a

175
00:07:26,640 --> 00:07:32,340
profile if you suddenly see a large

176
00:07:29,220 --> 00:07:34,800
portion of your employees look at a

177
00:07:32,340 --> 00:07:37,650
single LinkedIn profile there may be

178
00:07:34,800 --> 00:07:39,870
something to it because usually they

179
00:07:37,650 --> 00:07:41,190
just try and bulk friend anyone and

180
00:07:39,870 --> 00:07:44,160
let's be honest most people looked at

181
00:07:41,190 --> 00:07:45,570
LinkedIn and work at some forum so

182
00:07:44,160 --> 00:07:47,610
that's one way you can you can sort of

183
00:07:45,570 --> 00:07:50,460
detect their reconnaissance face but

184
00:07:47,610 --> 00:07:54,240
again it's it's a bit I'm gonna remove

185
00:07:50,460 --> 00:07:57,690
that slide off the thing there yeah

186
00:07:54,240 --> 00:07:59,070
thank you her so the next phase you just

187
00:07:57,690 --> 00:08:00,900
the red side is the mapping side of

188
00:07:59,070 --> 00:08:02,700
things all right they need to need to

189
00:08:00,900 --> 00:08:04,530
actively touch the external

190
00:08:02,700 --> 00:08:06,840
infrastructure and figure out what's out

191
00:08:04,530 --> 00:08:08,929
there this can be anything you can

192
00:08:06,840 --> 00:08:08,929
imagine

193
00:08:08,990 --> 00:08:13,560
it's a form of active intelligence

194
00:08:11,100 --> 00:08:17,520
gathering is using nmap inspiring tools

195
00:08:13,560 --> 00:08:18,930
like burp and those sorts of things and

196
00:08:17,520 --> 00:08:20,609
it's really a way just to engage their

197
00:08:18,930 --> 00:08:23,460
footprint now most big companies have a

198
00:08:20,610 --> 00:08:26,130
fairly large footprint and it's an issue

199
00:08:23,460 --> 00:08:28,080
for a lot of people so let's imagine in

200
00:08:26,130 --> 00:08:30,300
this scenario you find about a thousand

201
00:08:28,080 --> 00:08:31,530
hosts you find they're running tell me

202
00:08:30,300 --> 00:08:33,090
who runs telling it anymore that's

203
00:08:31,530 --> 00:08:35,010
pretty old but you find they're running

204
00:08:33,090 --> 00:08:35,940
SSH and FTP and a whole lot of web

205
00:08:35,010 --> 00:08:42,059
servers as well that's pretty

206
00:08:35,940 --> 00:08:44,280
commonplace for any sort of company from

207
00:08:42,059 --> 00:08:46,020
this point you'd think that the blue

208
00:08:44,280 --> 00:08:49,380
team would be able to detect some of

209
00:08:46,020 --> 00:08:51,720
this well imagine you're a an old

210
00:08:49,380 --> 00:08:53,310
grandpa sitting in your house and this

211
00:08:51,720 --> 00:08:53,850
is miss maybe a museum you thumb isn't

212
00:08:53,310 --> 00:08:56,250
for me

213
00:08:53,850 --> 00:08:57,750
but I'm sitting there and you hear a

214
00:08:56,250 --> 00:09:00,990
knock on the door there aren't you get

215
00:08:57,750 --> 00:09:03,210
up no one's there we go back to you see

216
00:09:00,990 --> 00:09:04,380
another knock of the door you get up no

217
00:09:03,210 --> 00:09:05,880
one there all right

218
00:09:04,380 --> 00:09:07,890
this continues over and over and over

219
00:09:05,880 --> 00:09:09,180
this is basically whatever maps are

220
00:09:07,890 --> 00:09:11,939
doing against your external Network

221
00:09:09,180 --> 00:09:14,670
right it's a whole lot of alerts hitting

222
00:09:11,940 --> 00:09:17,490
the external facing side of your network

223
00:09:14,670 --> 00:09:19,979
and it just it's noise that's all it is

224
00:09:17,490 --> 00:09:21,810
it's noise you don't know if it's showed

225
00:09:19,980 --> 00:09:23,430
and scanning you which is in some

226
00:09:21,810 --> 00:09:24,989
regards as a legitimate service you

227
00:09:23,430 --> 00:09:26,280
don't know if it's an attack you don't

228
00:09:24,990 --> 00:09:29,490
know if it's the Russians or Chinese or

229
00:09:26,280 --> 00:09:34,709
whatever it may be it's noise it happens

230
00:09:29,490 --> 00:09:36,930
a lot to just go look at your logs so

231
00:09:34,710 --> 00:09:38,040
from here and one thing I want to talk

232
00:09:36,930 --> 00:09:40,739
about later is actually the alert

233
00:09:38,040 --> 00:09:42,689
fatigue that's a very big factor in this

234
00:09:40,740 --> 00:09:46,020
sort of thing so I'll get into that in a

235
00:09:42,690 --> 00:09:48,210
little bit but there's some things you

236
00:09:46,020 --> 00:09:50,189
can do how many people will realize that

237
00:09:48,210 --> 00:09:51,570
when you run it in map by default

238
00:09:50,190 --> 00:09:54,740
settings it actually admits that user

239
00:09:51,570 --> 00:09:56,880
agent you can see on the screen there

240
00:09:54,740 --> 00:10:00,390
okay most the pentesters in the room

241
00:09:56,880 --> 00:10:02,820
maybe but if you look for this again

242
00:10:00,390 --> 00:10:04,920
it's and this is pulled off my day job

243
00:10:02,820 --> 00:10:07,740
but this is just an external web server

244
00:10:04,920 --> 00:10:09,240
that's been in Matt right it's clear as

245
00:10:07,740 --> 00:10:10,560
day it's been in maps it doesn't give me

246
00:10:09,240 --> 00:10:13,170
a lot of intelligence it gives me an IP

247
00:10:10,560 --> 00:10:14,000
address gives me a time that's really

248
00:10:13,170 --> 00:10:17,490
about it

249
00:10:14,000 --> 00:10:19,320
so as a as a pen tester really have a

250
00:10:17,490 --> 00:10:21,120
look at what sort of signatures your

251
00:10:19,320 --> 00:10:22,770
tools are met because sometimes we can

252
00:10:21,120 --> 00:10:26,300
pick them up quite easily if you're red

253
00:10:22,770 --> 00:10:26,300
teaming me please don't change

254
00:10:32,890 --> 00:10:38,290
so you've mapped the external Network

255
00:10:35,910 --> 00:10:39,550
you've figured out the good of a

256
00:10:38,290 --> 00:10:40,719
thousand hosts you've got a fair bet

257
00:10:39,550 --> 00:10:43,390
information out of your reconnaissance

258
00:10:40,720 --> 00:10:45,610
phase it's it's ready to try and try to

259
00:10:43,390 --> 00:10:50,830
exploit to actually traverse inside

260
00:10:45,610 --> 00:10:52,780
their network low-hanging fruit you know

261
00:10:50,830 --> 00:10:54,700
we've we've probably all heard of that

262
00:10:52,780 --> 00:10:57,130
that term before and you go for the

263
00:10:54,700 --> 00:10:58,360
least of path of least resistance telnet

264
00:10:57,130 --> 00:11:00,970
probably that path of least resistance

265
00:10:58,360 --> 00:11:02,440
here turns out it's not available

266
00:11:00,970 --> 00:11:04,930
anymore which is interesting in itself

267
00:11:02,440 --> 00:11:07,180
when in mapa ran and we ran our mapping

268
00:11:04,930 --> 00:11:09,130
phase it said telnet was there is this a

269
00:11:07,180 --> 00:11:10,390
problem with our tools or is this

270
00:11:09,130 --> 00:11:12,850
something to get to switched on switched

271
00:11:10,390 --> 00:11:18,580
off when we're developers in in the

272
00:11:12,850 --> 00:11:21,100
office or not it's a ghost so that's

273
00:11:18,580 --> 00:11:22,510
interesting we go to FTP SSH and all

274
00:11:21,100 --> 00:11:24,160
those sorts of things and we try the

275
00:11:22,510 --> 00:11:25,960
default passwords admin admin admin

276
00:11:24,160 --> 00:11:27,180
password none of that's working they

277
00:11:25,960 --> 00:11:29,200
were all require authentication

278
00:11:27,180 --> 00:11:31,689
hopefully that's pretty standard for

279
00:11:29,200 --> 00:11:33,010
most of us but we have all been known

280
00:11:31,690 --> 00:11:35,460
maybe to have default passwords log

281
00:11:33,010 --> 00:11:38,770
around somewhere

282
00:11:35,460 --> 00:11:39,850
so from there we can't really the

283
00:11:38,770 --> 00:11:45,640
low-hanging fruit so that doesn't seem

284
00:11:39,850 --> 00:11:48,580
to exist at least easily but what we do

285
00:11:45,640 --> 00:11:51,060
find is we spend a few hours browsing

286
00:11:48,580 --> 00:11:55,090
all the HTTP websites that are exposed

287
00:11:51,060 --> 00:11:56,349
we're looking around and there's nothing

288
00:11:55,090 --> 00:11:58,440
really terribly interesting but we

289
00:11:56,350 --> 00:12:00,850
actually stumble across a browsable

290
00:11:58,440 --> 00:12:01,990
indexed directory and for those who

291
00:12:00,850 --> 00:12:03,730
don't know what that is that's just

292
00:12:01,990 --> 00:12:05,710
basically listing of all the files on a

293
00:12:03,730 --> 00:12:10,210
web server and it's been misconfigured

294
00:12:05,710 --> 00:12:12,340
or it's hasn't been configured we find a

295
00:12:10,210 --> 00:12:14,190
bash script on there and lo and behold

296
00:12:12,340 --> 00:12:17,470
booyah it has a username password

297
00:12:14,190 --> 00:12:19,330
hard-coded in it okay we try that

298
00:12:17,470 --> 00:12:21,730
username password and the FTP and SSH it

299
00:12:19,330 --> 00:12:24,190
doesn't work we'll keep this one for

300
00:12:21,730 --> 00:12:27,400
later well put it in our back pocket for

301
00:12:24,190 --> 00:12:30,130
now interestingly Google didn't actually

302
00:12:27,400 --> 00:12:35,290
find this during our Google kung fu

303
00:12:30,130 --> 00:12:38,439
reconnaissance phase so in regards this

304
00:12:35,290 --> 00:12:40,060
low-hanging fruit again with the amount

305
00:12:38,440 --> 00:12:42,340
of noise that that hits our external

306
00:12:40,060 --> 00:12:44,109
services it's very hard to tell if

307
00:12:42,340 --> 00:12:45,190
someone's just poking you if it's a red

308
00:12:44,110 --> 00:12:48,370
team if it's

309
00:12:45,190 --> 00:12:50,170
in China or whoever it may be it's very

310
00:12:48,370 --> 00:12:51,810
very hard especially the larger the

311
00:12:50,170 --> 00:12:54,459
company you're getting the more diverse

312
00:12:51,810 --> 00:12:56,050
if I had to action every single time

313
00:12:54,460 --> 00:12:58,330
someone scanned our network I need a

314
00:12:56,050 --> 00:13:02,530
team of a thousand guys working 24/7

315
00:12:58,330 --> 00:13:04,750
just would not happen so we can't Alert

316
00:13:02,530 --> 00:13:08,079
on any on every single instance and we

317
00:13:04,750 --> 00:13:09,880
can't baseline it because the noise just

318
00:13:08,080 --> 00:13:12,610
jumps up and down it's not a constant

319
00:13:09,880 --> 00:13:14,590
noise it is a suddenly we're getting

320
00:13:12,610 --> 00:13:15,670
scans from 500 hosts suddenly were

321
00:13:14,590 --> 00:13:18,040
getting scared from nothing so there's

322
00:13:15,670 --> 00:13:20,560
no pattern to it hey I doesn't work here

323
00:13:18,040 --> 00:13:21,780
people say I cannot solve that at least

324
00:13:20,560 --> 00:13:24,459
in my opinion

325
00:13:21,780 --> 00:13:26,079
but this browsable index one way you

326
00:13:24,460 --> 00:13:27,670
could actually look for that is

327
00:13:26,080 --> 00:13:30,870
literally just scan your own web

328
00:13:27,670 --> 00:13:33,819
presences for the word password

329
00:13:30,870 --> 00:13:35,410
you know adored a recursive W get and

330
00:13:33,820 --> 00:13:38,230
just do a grep for password do this once

331
00:13:35,410 --> 00:13:39,969
a month you know it may not it may not

332
00:13:38,230 --> 00:13:43,900
work for two years for years but when it

333
00:13:39,970 --> 00:13:45,580
does you better raise a red flag and I

334
00:13:43,900 --> 00:13:48,640
have actually seen a company do this

335
00:13:45,580 --> 00:13:50,770
before what I have seen which is very

336
00:13:48,640 --> 00:13:53,710
unfortunate is domain administrator

337
00:13:50,770 --> 00:13:56,170
credentials sit in a Google index blog

338
00:13:53,710 --> 00:14:00,730
in a bash script for three years that

339
00:13:56,170 --> 00:14:02,079
was still valid the red team came along

340
00:14:00,730 --> 00:14:05,110
and look what we found in the Rakata

341
00:14:02,080 --> 00:14:06,730
notes phase and they worked just because

342
00:14:05,110 --> 00:14:08,260
this guy had to blog about cats and

343
00:14:06,730 --> 00:14:10,180
thought he'd written this amazing

344
00:14:08,260 --> 00:14:12,060
PowerShell script and unfortunately he'd

345
00:14:10,180 --> 00:14:14,530
hard-coded dear creds

346
00:14:12,060 --> 00:14:17,439
so I use a bit of Google kung fu scan

347
00:14:14,530 --> 00:14:24,040
your web servers just have a look at

348
00:14:17,440 --> 00:14:25,450
your own infrastructure now there's one

349
00:14:24,040 --> 00:14:27,880
thing you can do when it comes to

350
00:14:25,450 --> 00:14:30,040
external services and if you haven't

351
00:14:27,880 --> 00:14:33,580
noticed already I'm taking a bit of a no

352
00:14:30,040 --> 00:14:34,660
words on the PowerPoint view but if

353
00:14:33,580 --> 00:14:37,150
you're a Red Team you're probably

354
00:14:34,660 --> 00:14:39,100
scanning across FTP SSH tell them and

355
00:14:37,150 --> 00:14:41,370
let's let's say you are actually logging

356
00:14:39,100 --> 00:14:43,270
all those authentication failures if

357
00:14:41,370 --> 00:14:44,710
most of the bots out there that are

358
00:14:43,270 --> 00:14:46,960
scanning you are focusing on one service

359
00:14:44,710 --> 00:14:50,050
they're focusing on SSH they're focusing

360
00:14:46,960 --> 00:14:52,660
on FTP and they're hitting you hard if

361
00:14:50,050 --> 00:14:55,359
you have the same IP address the same

362
00:14:52,660 --> 00:14:57,219
user agent the same some fact that is

363
00:14:55,360 --> 00:14:58,350
consistent across all those services

364
00:14:57,220 --> 00:15:01,140
initially in a

365
00:14:58,350 --> 00:15:03,930
timeframe you could consider that maybe

366
00:15:01,140 --> 00:15:07,290
that's a more targeted attack versus in

367
00:15:03,930 --> 00:15:09,150
some BOTS that's scripting you high

368
00:15:07,290 --> 00:15:11,400
noise ratio yes and if it's coming out

369
00:15:09,150 --> 00:15:12,840
of a VPN that may be difficult but these

370
00:15:11,400 --> 00:15:16,890
are the sort of things you can do to

371
00:15:12,840 --> 00:15:21,300
maybe differentiate the the noise from

372
00:15:16,890 --> 00:15:22,980
the actual targeted stuff and if you're

373
00:15:21,300 --> 00:15:24,870
a really sneaky attacker you could

374
00:15:22,980 --> 00:15:32,910
randomize all of it but again don't do

375
00:15:24,870 --> 00:15:36,210
that to me please so we've just said the

376
00:15:32,910 --> 00:15:37,319
low-hanging fruit doesn't work we need

377
00:15:36,210 --> 00:15:42,630
to get a little dirty we need to go to

378
00:15:37,320 --> 00:15:44,940
an exploit phase usually this turns into

379
00:15:42,630 --> 00:15:46,230
basically you'd profile all the services

380
00:15:44,940 --> 00:15:47,790
that are running you'd find their

381
00:15:46,230 --> 00:15:49,440
versions you'd look up see the CV

382
00:15:47,790 --> 00:15:51,420
database you'd find an active exploit

383
00:15:49,440 --> 00:15:55,950
something it's unpatched something that

384
00:15:51,420 --> 00:15:57,120
you can easily break and unfortunately a

385
00:15:55,950 --> 00:15:58,740
lot of the red teams this is where it

386
00:15:57,120 --> 00:16:00,420
falls over we just don't have good

387
00:15:58,740 --> 00:16:03,360
assurance and patching it in the

388
00:16:00,420 --> 00:16:07,530
external side and they find something to

389
00:16:03,360 --> 00:16:10,380
pop so in this case it takes a little

390
00:16:07,530 --> 00:16:12,420
while but they find a vulnerability I

391
00:16:10,380 --> 00:16:15,900
were able to get a web shell into

392
00:16:12,420 --> 00:16:17,160
uploads directory over web so now you'll

393
00:16:15,900 --> 00:16:18,560
see in the news there's a lot of people

394
00:16:17,160 --> 00:16:20,730
using web shells there's a lot of

395
00:16:18,560 --> 00:16:22,650
nation-states using web shells they're

396
00:16:20,730 --> 00:16:25,830
very effective and they've been around

397
00:16:22,650 --> 00:16:28,350
for a long time I started my career as

398
00:16:25,830 --> 00:16:30,810
the guy that wrote the PHP that everyone

399
00:16:28,350 --> 00:16:32,490
laughs at today I've wrote those

400
00:16:30,810 --> 00:16:35,099
websites they probably still exist which

401
00:16:32,490 --> 00:16:36,720
horrifies me and I was always interested

402
00:16:35,100 --> 00:16:38,610
interested in security but I became the

403
00:16:36,720 --> 00:16:40,620
de facto security guy because so many of

404
00:16:38,610 --> 00:16:43,680
our websites were getting popped with

405
00:16:40,620 --> 00:16:44,880
these web shells and they're fairly easy

406
00:16:43,680 --> 00:16:46,770
to find if you know what you're looking

407
00:16:44,880 --> 00:16:51,090
for but they're very close they're very

408
00:16:46,770 --> 00:16:54,199
similar to legitimate code so it's very

409
00:16:51,090 --> 00:16:56,370
hard to eradicate them in some cases

410
00:16:54,200 --> 00:17:00,200
anyway we've got this swept shoulders

411
00:16:56,370 --> 00:17:03,300
upload directory so booyah we have

412
00:17:00,200 --> 00:17:04,980
compromised this company from a blue

413
00:17:03,300 --> 00:17:07,470
team side what do you reckon we can do I

414
00:17:04,980 --> 00:17:09,150
sound like a bit of a broken record here

415
00:17:07,470 --> 00:17:11,310
the web logs are noisy everyone's

416
00:17:09,150 --> 00:17:11,530
scanning us we can't bassline this in

417
00:17:11,310 --> 00:17:14,079
from

418
00:17:11,530 --> 00:17:17,020
action well you can look at some rare

419
00:17:14,079 --> 00:17:18,849
events you can look at post requests an

420
00:17:17,020 --> 00:17:20,770
investigation where the web shells

421
00:17:18,849 --> 00:17:23,260
involved the web servers in question no

422
00:17:20,770 --> 00:17:25,690
one ever ever posted to that website it

423
00:17:23,260 --> 00:17:26,859
was just a static site and we were

424
00:17:25,690 --> 00:17:28,480
following the attacker who are

425
00:17:26,859 --> 00:17:29,679
randomizing their IP addresses based

426
00:17:28,480 --> 00:17:32,290
solely on the fact that they were

427
00:17:29,680 --> 00:17:35,080
posting or trying to post to this

428
00:17:32,290 --> 00:17:37,720
website so have a look for rare values

429
00:17:35,080 --> 00:17:40,230
the brain is geared to determine

430
00:17:37,720 --> 00:17:42,210
patterns it's very good at doing that

431
00:17:40,230 --> 00:17:45,160
talk a bit more to that later

432
00:17:42,210 --> 00:17:46,960
also odd headers and requests usually

433
00:17:45,160 --> 00:17:48,820
Python developers if they're using some

434
00:17:46,960 --> 00:17:51,490
custom script there there may be default

435
00:17:48,820 --> 00:17:53,139
just like the nmap thing Python requests

436
00:17:51,490 --> 00:17:55,570
the library actually has a default user

437
00:17:53,140 --> 00:17:57,910
agent string which sits there unless you

438
00:17:55,570 --> 00:17:59,260
change it the other thing you can do is

439
00:17:57,910 --> 00:18:02,080
actually actually file monitoring

440
00:17:59,260 --> 00:18:04,210
solutions if you've got a really tight

441
00:18:02,080 --> 00:18:06,909
development process every time there's a

442
00:18:04,210 --> 00:18:08,500
release you can empty five all the files

443
00:18:06,910 --> 00:18:11,200
and you can watch those files and if

444
00:18:08,500 --> 00:18:12,760
they change okay and should one of them

445
00:18:11,200 --> 00:18:14,950
ever change in production without a

446
00:18:12,760 --> 00:18:17,260
release there's an alert there that

447
00:18:14,950 --> 00:18:19,450
requires a fair amount of overhead but

448
00:18:17,260 --> 00:18:20,950
can be done and also you'd think in

449
00:18:19,450 --> 00:18:22,300
antivirus scans would be happening in

450
00:18:20,950 --> 00:18:23,590
that up low uploads I'm sure you've all

451
00:18:22,300 --> 00:18:25,810
seen you upload something to onedrive

452
00:18:23,590 --> 00:18:27,340
Microsoft Google and it says just hang a

453
00:18:25,810 --> 00:18:30,490
second antivirus scanning this for you

454
00:18:27,340 --> 00:18:32,379
that's also possible but in this case

455
00:18:30,490 --> 00:18:35,130
it's an uploads directory which changes

456
00:18:32,380 --> 00:18:41,080
a lot some of these things aren't aren't

457
00:18:35,130 --> 00:18:43,150
applicable or easy and to be honest from

458
00:18:41,080 --> 00:18:44,830
an assurance side of things this just

459
00:18:43,150 --> 00:18:47,140
comes down to patching we all know it

460
00:18:44,830 --> 00:18:49,300
install your patches and do some asset

461
00:18:47,140 --> 00:18:51,490
discovery there are some companies out

462
00:18:49,300 --> 00:18:52,720
there showed an asset note and those

463
00:18:51,490 --> 00:18:55,480
sorts of things if you can pay and

464
00:18:52,720 --> 00:18:57,850
they'll show you as much information as

465
00:18:55,480 --> 00:19:02,170
you need to know to see your external

466
00:18:57,850 --> 00:19:05,250
interfaces and also a lot of these web

467
00:19:02,170 --> 00:19:07,330
shells also emit signals in your logs

468
00:19:05,250 --> 00:19:10,170
quick Google will tell you that and you

469
00:19:07,330 --> 00:19:12,639
can scan those through your logs as well

470
00:19:10,170 --> 00:19:15,040
now this is where it gets really fun so

471
00:19:12,640 --> 00:19:17,920
you've now got a web shell you're on the

472
00:19:15,040 --> 00:19:20,530
server you've you've compromised it you

473
00:19:17,920 --> 00:19:22,330
now need to do another mapping phase the

474
00:19:20,530 --> 00:19:23,389
jackpot you've hit 20,000 hosts it's a

475
00:19:22,330 --> 00:19:27,049
flat network

476
00:19:23,389 --> 00:19:31,478
not pen testers dream here and this is

477
00:19:27,049 --> 00:19:31,479
very very common all right

478
00:19:33,759 --> 00:19:40,369
from a blue team mapping internal it's

479
00:19:37,899 --> 00:19:41,389
it's sort of like the old man except

480
00:19:40,369 --> 00:19:43,218
this time you're a principal in a school

481
00:19:41,389 --> 00:19:44,238
you have students knock on your door you

482
00:19:43,219 --> 00:19:50,119
know it's one of those students you

483
00:19:44,239 --> 00:19:52,609
don't know which one you've got a better

484
00:19:50,119 --> 00:19:57,439
chance of detection but it's a again

485
00:19:52,609 --> 00:20:01,249
it's a little harder but there are some

486
00:19:57,440 --> 00:20:03,369
things you can look at so I'd hope most

487
00:20:01,249 --> 00:20:05,539
of us run AV of some sort

488
00:20:03,369 --> 00:20:07,070
AV is actually very good at detecting

489
00:20:05,539 --> 00:20:10,279
port scans if you look close enough and

490
00:20:07,070 --> 00:20:11,718
if it's configured I bring I'm lucky

491
00:20:10,279 --> 00:20:13,909
enough to work from home sometimes I

492
00:20:11,719 --> 00:20:17,419
bring my work laptop home and I plug it

493
00:20:13,909 --> 00:20:19,429
into my network and about one in five

494
00:20:17,419 --> 00:20:22,249
times this little pop-up comes up and it

495
00:20:19,429 --> 00:20:27,789
goes port scan targeted that attack

496
00:20:22,249 --> 00:20:27,789
blocked and I freeze China

497
00:20:28,080 --> 00:20:34,470
in reality it's actually just my Google

498
00:20:30,210 --> 00:20:39,930
chromecast oh hello but every time it

499
00:20:34,470 --> 00:20:41,400
happens so you can imagine if all of a

500
00:20:39,930 --> 00:20:44,130
sudden a thousand of your hosts

501
00:20:41,400 --> 00:20:45,660
internally flagged this alert and this

502
00:20:44,130 --> 00:20:48,210
literally just happened to me on Friday

503
00:20:45,660 --> 00:20:49,580
a thousand one one thousand in this case

504
00:20:48,210 --> 00:20:53,460
three hundred three hundred

505
00:20:49,580 --> 00:20:55,100
Symantec alerts suddenly popped up we

506
00:20:53,460 --> 00:20:57,260
knew something was wrong pretty quickly

507
00:20:55,100 --> 00:21:00,659
so have a look at those things because

508
00:20:57,260 --> 00:21:03,150
the seemingly benign alerts that some of

509
00:21:00,660 --> 00:21:05,570
these tools produce if you statistically

510
00:21:03,150 --> 00:21:08,880
look at them it can actually lead you to

511
00:21:05,570 --> 00:21:10,350
to maybe finding out that someone's

512
00:21:08,880 --> 00:21:12,570
running a mapping inside your network

513
00:21:10,350 --> 00:21:14,760
and I'm really glad that our internal

514
00:21:12,570 --> 00:21:16,080
Red Team guys aren't here because I have

515
00:21:14,760 --> 00:21:18,030
that alert and they're not gonna hear it

516
00:21:16,080 --> 00:21:20,070
so hopefully I get away with that one

517
00:21:18,030 --> 00:21:21,210
for a little longer the only thing you

518
00:21:20,070 --> 00:21:22,950
have to be careful is vulnerability

519
00:21:21,210 --> 00:21:24,000
scanners that will usually trigger these

520
00:21:22,950 --> 00:21:25,920
alerts but that's usually pretty easy

521
00:21:24,000 --> 00:21:28,740
because hopefully you run those and you

522
00:21:25,920 --> 00:21:29,970
know the IP addresses of them so that's

523
00:21:28,740 --> 00:21:32,430
one thing you can do for an internal

524
00:21:29,970 --> 00:21:33,770
scanning but again it's not a bill and

525
00:21:32,430 --> 00:21:37,710
indoor solution

526
00:21:33,770 --> 00:21:39,810
so you've mapped the network but

527
00:21:37,710 --> 00:21:41,730
something's wrong your web shells a bit

528
00:21:39,810 --> 00:21:46,200
flaky it's only accepting one in five

529
00:21:41,730 --> 00:21:50,010
commands you need to you need to obtain

530
00:21:46,200 --> 00:21:51,960
another method of persistence and a lot

531
00:21:50,010 --> 00:21:54,180
of nation-state actors will do this that

532
00:21:51,960 --> 00:21:57,330
I will use a backup form of position

533
00:21:54,180 --> 00:21:58,830
persistence so in this case we're gonna

534
00:21:57,330 --> 00:21:59,939
go for the low hanging fruit the path of

535
00:21:58,830 --> 00:22:04,860
least resistance we're gonna find a

536
00:21:59,940 --> 00:22:07,800
Windows XP box all right we drop a

537
00:22:04,860 --> 00:22:10,229
PowerShell payload on there and it's

538
00:22:07,800 --> 00:22:13,590
linked up to go to a dynamic DNS domain

539
00:22:10,230 --> 00:22:16,680
and we just pray AV doesn't detect it

540
00:22:13,590 --> 00:22:19,560
and just like you saw Wayne a second ago

541
00:22:16,680 --> 00:22:21,390
with wait that minute and we and you get

542
00:22:19,560 --> 00:22:24,710
a connection so you've got a second

543
00:22:21,390 --> 00:22:24,710
piece of persistence on there now

544
00:22:26,910 --> 00:22:30,540
the persistence makin the second

545
00:22:28,470 --> 00:22:32,790
secondary persistence mechanism is

546
00:22:30,540 --> 00:22:34,620
usually a different form sorry if it's

547
00:22:32,790 --> 00:22:36,210
web shell this time between malware

548
00:22:34,620 --> 00:22:38,219
files now originally this time maybe a

549
00:22:36,210 --> 00:22:39,630
web show it depends on what they can get

550
00:22:38,220 --> 00:22:41,730
but usually they'll be in a different

551
00:22:39,630 --> 00:22:44,010
form and it actually works to a blue

552
00:22:41,730 --> 00:22:46,320
team's favor sometimes because it

553
00:22:44,010 --> 00:22:48,810
increases the detection chances of that

554
00:22:46,320 --> 00:22:50,250
occurring which again I've had before we

555
00:22:48,810 --> 00:22:51,720
didn't know they are in they dropped in

556
00:22:50,250 --> 00:22:56,790
the persistence mechanism we're live on

557
00:22:51,720 --> 00:22:59,340
that one went what's this over here from

558
00:22:56,790 --> 00:23:04,800
a blue team you just need to pray Ava's

559
00:22:59,340 --> 00:23:06,929
gonna work you raise our hands how many

560
00:23:04,800 --> 00:23:15,750
people actually monitor dynamic DNS

561
00:23:06,930 --> 00:23:17,130
traffic anyone yeah okay so you can

562
00:23:15,750 --> 00:23:21,900
block that you can block that sort of

563
00:23:17,130 --> 00:23:23,610
traffic and sorry I've just skipped a

564
00:23:21,900 --> 00:23:25,860
slide you can block that sort of traffic

565
00:23:23,610 --> 00:23:28,290
and you can actually sinkhole it now

566
00:23:25,860 --> 00:23:29,909
Fred in IT is going to probably want to

567
00:23:28,290 --> 00:23:31,230
connect to his home router to make sure

568
00:23:29,910 --> 00:23:33,480
Game of Thrones are downloading at the

569
00:23:31,230 --> 00:23:34,200
right speed that's probably not

570
00:23:33,480 --> 00:23:36,270
something you should be letting through

571
00:23:34,200 --> 00:23:39,150
the work network but it's something we

572
00:23:36,270 --> 00:23:43,500
do very successfully and a noise of a

573
00:23:39,150 --> 00:23:45,960
few people but most of the time that

574
00:23:43,500 --> 00:23:48,090
sort of assistance mechanism that sort

575
00:23:45,960 --> 00:23:53,220
of malware won't won't get out and we in

576
00:23:48,090 --> 00:23:54,030
some cases can be alerted to it the

577
00:23:53,220 --> 00:23:56,640
other thing you can do is scan

578
00:23:54,030 --> 00:23:58,020
persistence mechanisms right sorry if

579
00:23:56,640 --> 00:23:59,370
there's piece of malware is persistent

580
00:23:58,020 --> 00:24:01,860
which it usually is it'll survive a

581
00:23:59,370 --> 00:24:03,750
reboot and you have some sort of EDR

582
00:24:01,860 --> 00:24:06,780
tool or s SEM or something that can

583
00:24:03,750 --> 00:24:08,610
bring all that information back you can

584
00:24:06,780 --> 00:24:10,410
have a look at it statistically and go

585
00:24:08,610 --> 00:24:13,379
what are the rare values of persistence

586
00:24:10,410 --> 00:24:15,420
you're gonna get the Nero burns and the

587
00:24:13,380 --> 00:24:18,270
clippy's and those sorts of things but

588
00:24:15,420 --> 00:24:19,590
have a look at the rare values they're

589
00:24:18,270 --> 00:24:21,780
quite good and they pick up a lot of

590
00:24:19,590 --> 00:24:22,740
interesting stuff we're mostly pup but

591
00:24:21,780 --> 00:24:26,129
every now and again you'll get actually

592
00:24:22,740 --> 00:24:27,840
getting an infection here or there now

593
00:24:26,130 --> 00:24:31,410
I'm sorry I did skip ahead on on the DNS

594
00:24:27,840 --> 00:24:35,310
sinkholes we do this very effectively it

595
00:24:31,410 --> 00:24:36,600
creates a lot of noise again but one

596
00:24:35,310 --> 00:24:37,320
thing we do use it for as well as

597
00:24:36,600 --> 00:24:39,270
typosquatting

598
00:24:37,320 --> 00:24:41,429
we internally sync a lot of

599
00:24:39,270 --> 00:24:43,379
hypo squatting names and it the amount

600
00:24:41,430 --> 00:24:46,440
of miss configuration you wouldn't

601
00:24:43,380 --> 00:24:48,780
believe it but I'd rather those email

602
00:24:46,440 --> 00:24:50,520
servers with the misconfigured IMAP hit

603
00:24:48,780 --> 00:24:52,860
our own internal boxes then resolve

604
00:24:50,520 --> 00:24:54,360
externally to an attacker which a lot of

605
00:24:52,860 --> 00:24:57,360
the red teams and the pentesting bulbs

606
00:24:54,360 --> 00:24:59,879
will do these days I've seen a case

607
00:24:57,360 --> 00:25:03,689
where over a five-day engagement there

608
00:24:59,880 --> 00:25:05,280
was eight gig of email traffic that went

609
00:25:03,690 --> 00:25:07,650
out to one type of squad it's quite a

610
00:25:05,280 --> 00:25:12,570
domain and that's a lot of data

611
00:25:07,650 --> 00:25:14,550
passports driver's license all of it now

612
00:25:12,570 --> 00:25:16,439
the sinkholes when you talk to cloud

613
00:25:14,550 --> 00:25:20,430
that makes it a little harder but there

614
00:25:16,440 --> 00:25:22,140
are options so you've got a second piece

615
00:25:20,430 --> 00:25:23,520
of persistence in there now it's time to

616
00:25:22,140 --> 00:25:27,240
actually getting your flag it's time to

617
00:25:23,520 --> 00:25:28,950
to put the nail in the coffin here so

618
00:25:27,240 --> 00:25:30,900
you've found the database you found the

619
00:25:28,950 --> 00:25:31,920
server you've easily used you've used

620
00:25:30,900 --> 00:25:33,840
those creds that you had in your back

621
00:25:31,920 --> 00:25:39,360
pocket from the bash script you've

622
00:25:33,840 --> 00:25:43,139
logged on and you found it it's a little

623
00:25:39,360 --> 00:25:46,560
big so you need to compress it and

624
00:25:43,140 --> 00:25:50,460
compress it comes down to one gig I got

625
00:25:46,560 --> 00:25:52,770
still a little big okay you need to get

626
00:25:50,460 --> 00:25:54,750
this out somehow and you've tried your

627
00:25:52,770 --> 00:25:57,980
web shell you've tried your persistence

628
00:25:54,750 --> 00:25:59,640
but for some reason it's pretty slow so

629
00:25:57,980 --> 00:26:01,170
what we're going to do is we're gonna

630
00:25:59,640 --> 00:26:03,030
use rah we're gonna split it and we're

631
00:26:01,170 --> 00:26:05,400
gonna encrypt it with a password and

632
00:26:03,030 --> 00:26:11,100
we're going to upload it to let's say

633
00:26:05,400 --> 00:26:13,010
Dropbox we're done so in this scenario

634
00:26:11,100 --> 00:26:15,860
we if we've managed to capture our flag

635
00:26:13,010 --> 00:26:17,850
from a blue team side of things

636
00:26:15,860 --> 00:26:20,189
exfiltration is one of the hardest

637
00:26:17,850 --> 00:26:23,280
things to detect but how often do you

638
00:26:20,190 --> 00:26:27,060
seer are you being used the standard

639
00:26:23,280 --> 00:26:29,340
inbuilt Windows zip function can't split

640
00:26:27,060 --> 00:26:31,800
an archive at least at last I checked it

641
00:26:29,340 --> 00:26:33,480
couldn't so usually they need to use rar

642
00:26:31,800 --> 00:26:35,790
and depending on your environment you

643
00:26:33,480 --> 00:26:36,420
may have restored by default not always

644
00:26:35,790 --> 00:26:39,030
the case

645
00:26:36,420 --> 00:26:41,220
what you can do is actually alert on the

646
00:26:39,030 --> 00:26:43,200
different flags that are used to split

647
00:26:41,220 --> 00:26:45,600
an archive the average user is probably

648
00:26:43,200 --> 00:26:46,830
not going to split an archive the

649
00:26:45,600 --> 00:26:49,860
average user is probably not going to

650
00:26:46,830 --> 00:26:51,449
apply a password to an archive a lot of

651
00:26:49,860 --> 00:26:52,740
the EDR tools and the detection is out

652
00:26:51,450 --> 00:26:54,929
there actually look at

653
00:26:52,740 --> 00:26:56,610
flags being used in these tools and the

654
00:26:54,929 --> 00:26:58,830
output that they're generating versus

655
00:26:56,610 --> 00:27:00,120
the tool itself the tool itself changes

656
00:26:58,830 --> 00:27:03,449
every hour with a different nd five

657
00:27:00,120 --> 00:27:05,159
different it's very hard to detect but

658
00:27:03,450 --> 00:27:06,630
the flags remain the same the man page

659
00:27:05,160 --> 00:27:08,970
stays the same in the output stays the

660
00:27:06,630 --> 00:27:11,250
same if you're on memory caps on most of

661
00:27:08,970 --> 00:27:13,800
most of the latest tools hopefully pray

662
00:27:11,250 --> 00:27:15,660
they will actually detect on the output

663
00:27:13,800 --> 00:27:17,760
format of the memory Katz file itself

664
00:27:15,660 --> 00:27:19,500
because if memory caps runs in memory it

665
00:27:17,760 --> 00:27:20,550
may not detect it but it'll detect it

666
00:27:19,500 --> 00:27:26,190
when you dump all the passwords to a

667
00:27:20,550 --> 00:27:28,169
text file and save it as Yahoo so you

668
00:27:26,190 --> 00:27:30,750
can alert on those flags you can load on

669
00:27:28,170 --> 00:27:31,800
the output some cases we'd hope the

670
00:27:30,750 --> 00:27:34,350
cloud sharing would actually be blocked

671
00:27:31,800 --> 00:27:36,570
or actually be only allowed to access to

672
00:27:34,350 --> 00:27:38,850
a certain few people but what I found is

673
00:27:36,570 --> 00:27:40,919
that the more and more especially in

674
00:27:38,850 --> 00:27:43,649
media they the media type they seem to

675
00:27:40,920 --> 00:27:45,030
need all this access but we're in an age

676
00:27:43,650 --> 00:27:46,950
where we're transferring large files now

677
00:27:45,030 --> 00:27:49,500
and everyone seems to need access for it

678
00:27:46,950 --> 00:27:50,880
you can track large uploads if you've

679
00:27:49,500 --> 00:27:53,940
got a proxy they usually count how many

680
00:27:50,880 --> 00:27:55,740
bytes out you have problem is Skype

681
00:27:53,940 --> 00:27:57,120
seems to be the worst for this I don't

682
00:27:55,740 --> 00:27:58,800
know why you have Skype sitting there

683
00:27:57,120 --> 00:28:00,479
and it will do 800 megabyte in a day and

684
00:27:58,800 --> 00:28:02,879
you think you set in files or people

685
00:28:00,480 --> 00:28:05,250
you're just sitting there so that's

686
00:28:02,880 --> 00:28:09,870
difficult again noise again I'm a broken

687
00:28:05,250 --> 00:28:11,520
record on that on that one there are so

688
00:28:09,870 --> 00:28:15,030
many techniques of exfiltration as well

689
00:28:11,520 --> 00:28:17,190
as DNS as email there's you know sharing

690
00:28:15,030 --> 00:28:18,480
services there's the postal system I've

691
00:28:17,190 --> 00:28:24,780
heard of a case where someone has

692
00:28:18,480 --> 00:28:26,280
internally mailed a disk out to them yep

693
00:28:24,780 --> 00:28:29,760
they'll put it in the tunel mailbox and

694
00:28:26,280 --> 00:28:31,559
off it goes and now we've just released

695
00:28:29,760 --> 00:28:34,710
what terrifies me is a one terabyte

696
00:28:31,559 --> 00:28:36,149
micro SD card it's that damn big you can

697
00:28:34,710 --> 00:28:39,809
hide that anywhere happen to your tongue

698
00:28:36,150 --> 00:28:42,080
at you go so in this case you just have

699
00:28:39,809 --> 00:28:45,000
to cover the common and just hope

700
00:28:42,080 --> 00:28:47,100
unfortunate there is no I've seen no

701
00:28:45,000 --> 00:28:49,650
tool that does all this it's just you've

702
00:28:47,100 --> 00:28:54,899
got to cover the basics and hopefully

703
00:28:49,650 --> 00:28:58,170
you get them in another stage so that's

704
00:28:54,900 --> 00:28:59,880
the red team at a high level and that

705
00:28:58,170 --> 00:29:01,910
was successful I'd say most red teams

706
00:28:59,880 --> 00:29:04,340
are

707
00:29:01,910 --> 00:29:05,600
but the blue side really has a pretty

708
00:29:04,340 --> 00:29:06,709
hard job you know we don't know where

709
00:29:05,600 --> 00:29:11,419
they're coming from we've got a big

710
00:29:06,710 --> 00:29:14,270
attack surface and I've it's it's a very

711
00:29:11,420 --> 00:29:15,740
hard thing I've been on the receiving

712
00:29:14,270 --> 00:29:19,150
side of red team we haven't detected

713
00:29:15,740 --> 00:29:21,740
them they've gone four or five days and

714
00:29:19,150 --> 00:29:23,990
lucky enough I work for a very mature

715
00:29:21,740 --> 00:29:26,600
company that understands that we're

716
00:29:23,990 --> 00:29:28,160
always not going to catch them but as a

717
00:29:26,600 --> 00:29:29,449
guy that sits and writes the detections

718
00:29:28,160 --> 00:29:32,300
all day and works with a really good

719
00:29:29,450 --> 00:29:33,470
team it's a bit disheartening so it's

720
00:29:32,300 --> 00:29:35,750
something you have to be very careful

721
00:29:33,470 --> 00:29:37,160
and manage with your team that it's okay

722
00:29:35,750 --> 00:29:38,720
we'll be better next time and I'm gonna

723
00:29:37,160 --> 00:29:43,100
go a bit a bit more to that how you can

724
00:29:38,720 --> 00:29:44,180
achieve that what I'm gonna go into now

725
00:29:43,100 --> 00:29:49,340
is some of the problems that actually

726
00:29:44,180 --> 00:29:51,920
compound the blue team's side of things

727
00:29:49,340 --> 00:29:53,899
for investigation so I've spoken to you

728
00:29:51,920 --> 00:29:55,820
event I said the red team does X Blue

729
00:29:53,900 --> 00:29:57,440
team can do y we should all be able to

730
00:29:55,820 --> 00:30:01,610
detect everything we should all be happy

731
00:29:57,440 --> 00:30:03,920
it's not the case you've heard me go on

732
00:30:01,610 --> 00:30:06,530
about this already it's a noise problem

733
00:30:03,920 --> 00:30:08,120
right the principal in the school he

734
00:30:06,530 --> 00:30:09,980
hears the kids playing soccer outside

735
00:30:08,120 --> 00:30:10,570
window smash he comes running out which

736
00:30:09,980 --> 00:30:17,420
one was it

737
00:30:10,570 --> 00:30:19,159
right it's it's a noise problem it

738
00:30:17,420 --> 00:30:21,110
mostly affects external facing

739
00:30:19,160 --> 00:30:23,300
infrastructure but when you come to

740
00:30:21,110 --> 00:30:26,899
multi multifaceted companies it can be

741
00:30:23,300 --> 00:30:31,159
quite difficult to breach for that noise

742
00:30:26,900 --> 00:30:32,840
to give you an example let's say you

743
00:30:31,160 --> 00:30:35,480
have an alert and it's a very VIP

744
00:30:32,840 --> 00:30:37,310
account as a service account it's got a

745
00:30:35,480 --> 00:30:39,500
static password it shouldn't fail it

746
00:30:37,310 --> 00:30:41,659
shouldn't fail authentication so if it

747
00:30:39,500 --> 00:30:44,270
fails authentication greater than 25

748
00:30:41,660 --> 00:30:46,070
times in an hour maybe someone's trying

749
00:30:44,270 --> 00:30:48,860
to break into that account that's a

750
00:30:46,070 --> 00:30:50,929
sensible alert to have well what happens

751
00:30:48,860 --> 00:30:54,139
when that the password expires and no

752
00:30:50,930 --> 00:30:56,120
one notices you end up having all these

753
00:30:54,140 --> 00:30:57,290
alerts come through your system because

754
00:30:56,120 --> 00:31:00,679
someone's just forgotten to change a

755
00:30:57,290 --> 00:31:01,700
password on the schedule so a lot of the

756
00:31:00,680 --> 00:31:04,130
times when you're developing these

757
00:31:01,700 --> 00:31:06,140
alerts the best intentions are there but

758
00:31:04,130 --> 00:31:08,980
the business or other business factors

759
00:31:06,140 --> 00:31:12,170
will cause those alerts to fire and

760
00:31:08,980 --> 00:31:14,540
sometimes threshold base alerts are very

761
00:31:12,170 --> 00:31:18,110
hard to

762
00:31:14,540 --> 00:31:21,050
to tweek thank you and that's one area

763
00:31:18,110 --> 00:31:23,090
where AI actually may be used to help us

764
00:31:21,050 --> 00:31:24,680
here what I've started to do is I've

765
00:31:23,090 --> 00:31:26,990
started to take the last seven days of

766
00:31:24,680 --> 00:31:30,350
failures and if in the last seven days

767
00:31:26,990 --> 00:31:33,020
of failures its peaked above a certain

768
00:31:30,350 --> 00:31:35,000
percentage then I'll alert again I still

769
00:31:33,020 --> 00:31:37,100
stuffer the parcel exploration problem

770
00:31:35,000 --> 00:31:38,540
but I'm base lining previous data

771
00:31:37,100 --> 00:31:40,340
because you'd be surprised how many

772
00:31:38,540 --> 00:31:43,100
health and service accounts fail for

773
00:31:40,340 --> 00:31:44,959
example some migrations from IMAP to

774
00:31:43,100 --> 00:31:52,419
office success five it tries to connect

775
00:31:44,960 --> 00:31:57,740
to an a disabled account value my god

776
00:31:52,420 --> 00:32:02,180
time stamps dear Lord do some vendors

777
00:31:57,740 --> 00:32:06,140
get this so wrong this is the bane of

778
00:32:02,180 --> 00:32:10,190
blue team it's called ISO 8601 follow it

779
00:32:06,140 --> 00:32:13,490
and provide that provide the time zone

780
00:32:10,190 --> 00:32:15,590
please the only acceptable way is

781
00:32:13,490 --> 00:32:19,790
year-month-day people hours been at

782
00:32:15,590 --> 00:32:22,550
seconds Tom's own I work my direct

783
00:32:19,790 --> 00:32:23,720
reports action Montreal and when we

784
00:32:22,550 --> 00:32:25,159
first was sort of became a team there

785
00:32:23,720 --> 00:32:26,690
are a few issues around this because

786
00:32:25,160 --> 00:32:29,320
they go month/day/year because they're

787
00:32:26,690 --> 00:32:33,320
so close to the states so it's now a

788
00:32:29,320 --> 00:32:36,230
unwritten rule uses format I've seen

789
00:32:33,320 --> 00:32:38,060
logging vendors sorry

790
00:32:36,230 --> 00:32:39,140
logging vendors in general at the spunks

791
00:32:38,060 --> 00:32:40,610
and the Alps are there they do a pretty

792
00:32:39,140 --> 00:32:44,390
good job of actually converting these

793
00:32:40,610 --> 00:32:46,610
timestamps into UTC and to to make them

794
00:32:44,390 --> 00:32:50,210
possible but when they get it wrong you

795
00:32:46,610 --> 00:32:52,610
don't notice right and if they mix it

796
00:32:50,210 --> 00:32:53,660
about you can miss some vital

797
00:32:52,610 --> 00:32:58,429
information when you're investigating

798
00:32:53,660 --> 00:33:00,530
things I've had one where MTP was

799
00:32:58,430 --> 00:33:03,290
installed but wasn't connected to the

800
00:33:00,530 --> 00:33:05,750
NTP servers the clock slipped it started

801
00:33:03,290 --> 00:33:07,550
slipping it was four hours out and

802
00:33:05,750 --> 00:33:09,920
suddenly my logs are hitting my swamp

803
00:33:07,550 --> 00:33:10,940
server and they're four hours out you

804
00:33:09,920 --> 00:33:12,860
could imagine if I'm looking at a

805
00:33:10,940 --> 00:33:14,510
30-second time window and the data is

806
00:33:12,860 --> 00:33:19,280
over here four hours earlier or four

807
00:33:14,510 --> 00:33:21,230
hours later what I tell most of the

808
00:33:19,280 --> 00:33:23,120
responders that instant respondents that

809
00:33:21,230 --> 00:33:24,800
I work with is and the Splunk

810
00:33:23,120 --> 00:33:26,899
administrators hate me for this but I

811
00:33:24,800 --> 00:33:28,370
say if you're looking at 30 seconds

812
00:33:26,900 --> 00:33:30,740
startup 30-day

813
00:33:28,370 --> 00:33:33,439
work your way in because there's usually

814
00:33:30,740 --> 00:33:34,309
some events either side of it they're

815
00:33:33,440 --> 00:33:39,650
actually applicable to your

816
00:33:34,309 --> 00:33:43,280
investigation and the best example I

817
00:33:39,650 --> 00:33:44,299
have of this is load balancers let's for

818
00:33:43,280 --> 00:33:46,010
example say you've got a load balancer

819
00:33:44,299 --> 00:33:48,799
at the front and you have a webserver

820
00:33:46,010 --> 00:33:51,290
behind it that's two discrete set of

821
00:33:48,799 --> 00:33:53,179
logs the load balancer at the front will

822
00:33:51,290 --> 00:33:57,440
have the IP address of the visitor will

823
00:33:53,179 --> 00:34:00,710
have the user agent and then the

824
00:33:57,440 --> 00:34:02,630
webserver internally may have the local

825
00:34:00,710 --> 00:34:04,700
IP addres for the IP address of the load

826
00:34:02,630 --> 00:34:06,950
balancer and the username let's say you

827
00:34:04,700 --> 00:34:09,350
need to match the internal user name to

828
00:34:06,950 --> 00:34:11,629
the external IP address the only way to

829
00:34:09,350 --> 00:34:14,210
do that without some fact that's common

830
00:34:11,629 --> 00:34:16,339
between the two logs is time if you have

831
00:34:14,210 --> 00:34:20,690
a very heavy service that's getting used

832
00:34:16,340 --> 00:34:23,060
a lot you've got to make sure those

833
00:34:20,690 --> 00:34:24,350
times are on our correct otherwise

834
00:34:23,060 --> 00:34:27,199
you're not going to be able to find the

835
00:34:24,350 --> 00:34:30,080
person and find the match the same with

836
00:34:27,199 --> 00:34:31,219
DNS DNS is another story but if the time

837
00:34:30,080 --> 00:34:33,379
is not right answer

838
00:34:31,219 --> 00:34:37,459
it's a nightmare so I've literally seen

839
00:34:33,379 --> 00:34:40,009
vendors just give us AM and PM in with

840
00:34:37,460 --> 00:34:43,040
24 hours but no time zones I've seen

841
00:34:40,010 --> 00:34:47,840
time before date oh please just follow

842
00:34:43,040 --> 00:34:53,300
that epoch time yeah yeah well that's a

843
00:34:47,840 --> 00:34:56,869
bit better yeah the next thing is log

844
00:34:53,300 --> 00:34:58,790
formats we have a team of two three

845
00:34:56,869 --> 00:35:00,830
people that almost work full time just

846
00:34:58,790 --> 00:35:02,540
trying to make sure from our multiple

847
00:35:00,830 --> 00:35:07,549
vendors and multiple system owners that

848
00:35:02,540 --> 00:35:09,200
we can get the logs correctly syslog is

849
00:35:07,550 --> 00:35:14,390
evil I'm sorry it worked for us a while

850
00:35:09,200 --> 00:35:19,339
ago but it it's not a good format Saif

851
00:35:14,390 --> 00:35:21,319
is not bad and Jason's pretty good but

852
00:35:19,340 --> 00:35:24,490
you need to be developed sorry we need

853
00:35:21,320 --> 00:35:24,490
to be verbose in our logs

854
00:35:27,549 --> 00:35:32,450
the next big problem at anyone with big

855
00:35:30,019 --> 00:35:34,879
data expertise in here will know is

856
00:35:32,450 --> 00:35:36,919
normalization let's say that load

857
00:35:34,880 --> 00:35:38,839
balancer at the front its source IP

858
00:35:36,920 --> 00:35:41,779
address field as SRC underscore IP

859
00:35:38,839 --> 00:35:46,729
address sorry I'm squat I P and the web

860
00:35:41,779 --> 00:35:48,650
server it's s IP now if you want to

861
00:35:46,729 --> 00:35:50,808
create a search that looks across your

862
00:35:48,650 --> 00:35:53,599
entire infrastructure for an internal or

863
00:35:50,809 --> 00:35:55,339
just an IP address are you gonna have to

864
00:35:53,599 --> 00:35:56,719
remember every single log format that

865
00:35:55,339 --> 00:36:00,109
you've come across and you've indexed

866
00:35:56,719 --> 00:36:02,089
and remember all those fields no a lot

867
00:36:00,109 --> 00:36:03,049
of the good tools you're elq's your

868
00:36:02,089 --> 00:36:05,029
Splunk so they'll have data

869
00:36:03,049 --> 00:36:05,479
normalization data models and Splunk for

870
00:36:05,029 --> 00:36:08,119
that matter

871
00:36:05,479 --> 00:36:12,379
and they'll condense all the different

872
00:36:08,119 --> 00:36:14,569
type of log formats into a common model

873
00:36:12,380 --> 00:36:16,519
so that all the IP addresses are named

874
00:36:14,569 --> 00:36:18,170
the one thing unfortunately my

875
00:36:16,519 --> 00:36:20,558
experience this is fairly good but it

876
00:36:18,170 --> 00:36:23,329
actually removes context out of the logs

877
00:36:20,559 --> 00:36:24,979
so sometimes you'll go I can see the IP

878
00:36:23,329 --> 00:36:26,119
address where did this come from was it

879
00:36:24,979 --> 00:36:27,709
the load balance or was it the web

880
00:36:26,119 --> 00:36:37,069
server and sometimes that can be an

881
00:36:27,709 --> 00:36:38,470
issue cloud that's a life to say about

882
00:36:37,069 --> 00:36:41,859
that

883
00:36:38,470 --> 00:36:43,839
No some of them are doing good job de

884
00:36:41,859 --> 00:36:44,950
Dios guard duty is not bad and those

885
00:36:43,839 --> 00:36:47,529
sort of things

886
00:36:44,950 --> 00:36:49,328
Microsoft you've got a ways to come but

887
00:36:47,530 --> 00:36:51,700
there's also the outsourcing aspect the

888
00:36:49,329 --> 00:36:54,339
multi-tenancy are of devices if your

889
00:36:51,700 --> 00:36:56,049
proxies multi-tenant 'add sometimes you

890
00:36:54,339 --> 00:36:57,339
cannot get logs because you'll breach

891
00:36:56,050 --> 00:37:01,450
privacy acts and all those sorts of

892
00:36:57,339 --> 00:37:02,828
things and that's a when you're signing

893
00:37:01,450 --> 00:37:05,020
up for your next SAS service or whatever

894
00:37:02,829 --> 00:37:08,800
it may be make sure you can get logs out

895
00:37:05,020 --> 00:37:13,180
of it make sure you can get them in real

896
00:37:08,800 --> 00:37:15,369
time or near real time I have logs from

897
00:37:13,180 --> 00:37:16,690
proxies at a six hours delayed imagine

898
00:37:15,369 --> 00:37:18,250
my manager running up to me saying we've

899
00:37:16,690 --> 00:37:19,990
got an outbreak of one a cry

900
00:37:18,250 --> 00:37:23,349
you left the wait six hours sir because

901
00:37:19,990 --> 00:37:25,060
I'm gonna wait for the logs yeah you

902
00:37:23,349 --> 00:37:27,190
batch logs marks are currently gives us

903
00:37:25,060 --> 00:37:30,220
24 hour batch logs an email and I sorts

904
00:37:27,190 --> 00:37:31,750
of things it's a real problem so a lot

905
00:37:30,220 --> 00:37:33,549
of the time the blue team has to

906
00:37:31,750 --> 00:37:35,170
investigate with only half the picture

907
00:37:33,550 --> 00:37:36,609
you know they're only getting half the

908
00:37:35,170 --> 00:37:37,780
picture from the red team anyway because

909
00:37:36,609 --> 00:37:39,520
there's always gonna be a hole somewhere

910
00:37:37,780 --> 00:37:41,190
but then you get only giving them half

911
00:37:39,520 --> 00:37:43,540
the picture at when it's happening

912
00:37:41,190 --> 00:37:45,099
that's really hard to investigate you've

913
00:37:43,540 --> 00:37:47,079
got we've got half the picture here in

914
00:37:45,099 --> 00:37:49,150
six hours time we may better get another

915
00:37:47,079 --> 00:37:50,670
half the picture but we're gonna keep

916
00:37:49,150 --> 00:37:52,660
going because they're still attacking us

917
00:37:50,670 --> 00:37:55,740
they're not going to stop because we're

918
00:37:52,660 --> 00:37:55,740
six hours delayed logs

919
00:38:01,430 --> 00:38:05,339
alert fatigue this is a really really

920
00:38:03,869 --> 00:38:07,289
big one and something I'm still battling

921
00:38:05,339 --> 00:38:09,239
to this day I use the grumpy grandpa

922
00:38:07,289 --> 00:38:14,160
approach because that's what I am at

923
00:38:09,239 --> 00:38:15,989
work sometimes and this happens it is

924
00:38:14,160 --> 00:38:18,450
basically you receiving the same alert

925
00:38:15,989 --> 00:38:19,650
over and over and over same time a

926
00:38:18,450 --> 00:38:21,269
hundred times a day and you're like

927
00:38:19,650 --> 00:38:23,249
false positive false positive and false

928
00:38:21,269 --> 00:38:24,569
positive false positive false positive

929
00:38:23,249 --> 00:38:27,169
that was false positive or no that was a

930
00:38:24,569 --> 00:38:27,170
true positive whoops

931
00:38:28,339 --> 00:38:35,308
and with the baseline and how noisy it

932
00:38:32,759 --> 00:38:36,720
is it's very hard Microsoft actually

933
00:38:35,309 --> 00:38:38,400
said in one of their blog post very

934
00:38:36,720 --> 00:38:40,499
recently they don't actually implement

935
00:38:38,400 --> 00:38:44,130
any alert in production unless it has a

936
00:38:40,499 --> 00:38:45,629
90% hit rate of a true positive I wish

937
00:38:44,130 --> 00:38:47,369
that was I wish I could say here on HUD

938
00:38:45,630 --> 00:38:50,910
that was my case I'm more down twenty

939
00:38:47,369 --> 00:38:52,200
thirty percent and especially when

940
00:38:50,910 --> 00:38:53,578
you're working across a big team that

941
00:38:52,200 --> 00:38:56,489
doesn't have the knowledge behind it and

942
00:38:53,579 --> 00:38:57,359
you've got an outsourced sock they're

943
00:38:56,489 --> 00:38:58,559
not gonna they're not going to

944
00:38:57,359 --> 00:39:01,619
investigate everything one they're just

945
00:38:58,559 --> 00:39:03,539
gonna go no that doesn't matter and one

946
00:39:01,619 --> 00:39:06,180
thing that I found very recently is that

947
00:39:03,539 --> 00:39:08,219
if your logging system you're a learning

948
00:39:06,180 --> 00:39:11,848
system whatever it may be have a way to

949
00:39:08,219 --> 00:39:13,170
suppress those alerts right if you can

950
00:39:11,849 --> 00:39:15,089
quickly create a rule saying please

951
00:39:13,170 --> 00:39:17,130
suppress all alerts from this host of

952
00:39:15,089 --> 00:39:19,529
this kind for four hours

953
00:39:17,130 --> 00:39:22,499
that makes it that blue tip very happy

954
00:39:19,529 --> 00:39:28,170
you may miss one but you won't piss off

955
00:39:22,499 --> 00:39:31,259
your blue team that alert fatigue can

956
00:39:28,170 --> 00:39:33,739
also contribute to staff turnover which

957
00:39:31,259 --> 00:39:36,029
is not something we all any of us want

958
00:39:33,739 --> 00:39:39,029
so it's if you hear you blue to him

959
00:39:36,029 --> 00:39:41,609
complaining about that it's a hard

960
00:39:39,029 --> 00:39:45,749
problem to solve but it only takes some

961
00:39:41,609 --> 00:39:47,460
to sit down some time to tweak them now

962
00:39:45,749 --> 00:39:48,629
I haven't mentioned a few things that

963
00:39:47,460 --> 00:39:51,900
compound the issues but I'm sure you can

964
00:39:48,630 --> 00:39:53,190
get some of these politics I don't have

965
00:39:51,900 --> 00:39:54,869
domain it Ben over here because I'm not

966
00:39:53,190 --> 00:39:55,529
allowed to go over there and and those

967
00:39:54,869 --> 00:39:59,430
sorts of things

968
00:39:55,529 --> 00:40:02,519
a shadow IT well that's that's pretty

969
00:39:59,430 --> 00:40:03,899
bad stuff and the expectation that you

970
00:40:02,519 --> 00:40:07,828
have a deep understanding of every

971
00:40:03,900 --> 00:40:09,719
system on your network if you have a big

972
00:40:07,829 --> 00:40:11,279
network I mean if you're a Facebook you

973
00:40:09,719 --> 00:40:13,269
have Facebook to look after

974
00:40:11,279 --> 00:40:15,460
but if you're on our owner on a

975
00:40:13,269 --> 00:40:17,470
engineering company you have so many web

976
00:40:15,460 --> 00:40:19,989
apps to do different things and you need

977
00:40:17,470 --> 00:40:21,399
to instantly apparently know exactly how

978
00:40:19,989 --> 00:40:24,279
all these logs work and how the system

979
00:40:21,400 --> 00:40:25,539
works and a lot of time it's just

980
00:40:24,279 --> 00:40:27,489
spending the time on the phone talking

981
00:40:25,539 --> 00:40:30,009
to the service owners who it's currently

982
00:40:27,489 --> 00:40:31,569
8 8 8 p.m. on a Sunday night and you

983
00:40:30,009 --> 00:40:34,749
gonna ring up saying how does this work

984
00:40:31,569 --> 00:40:36,849
who coded this where does this live the

985
00:40:34,749 --> 00:40:38,709
context I'm always honored that context

986
00:40:36,849 --> 00:40:40,450
around vendors around anyone give us

987
00:40:38,710 --> 00:40:40,630
some context around everything you give

988
00:40:40,450 --> 00:40:42,910
us

989
00:40:40,630 --> 00:40:44,619
logs whatever it may be new projects

990
00:40:42,910 --> 00:40:49,529
because that is a wealth of information

991
00:40:44,619 --> 00:40:49,529
we need when excuse me hits the fan

992
00:40:50,099 --> 00:40:56,559
now I've said it a fair bit of doom and

993
00:40:54,519 --> 00:40:58,899
gloom right but there is some sexiness

994
00:40:56,559 --> 00:41:03,609
to the blue team let's be honest all

995
00:40:58,900 --> 00:41:05,289
right oh you keep talking I will just

996
00:41:03,609 --> 00:41:08,769
like Wayne with the Iron Man Souter I

997
00:41:05,289 --> 00:41:12,309
don't mean that I sort of that don't do

998
00:41:08,769 --> 00:41:14,529
that I know where it's going guess yes I

999
00:41:12,309 --> 00:41:16,150
debated putting that in there um just

1000
00:41:14,529 --> 00:41:18,640
like Wayne with the Iron Man suit you

1001
00:41:16,150 --> 00:41:19,779
feel like neo chasing agent agent Smith

1002
00:41:18,640 --> 00:41:22,509
through the matrix when you're on the

1003
00:41:19,779 --> 00:41:23,859
tail of these attackers ten minutes

1004
00:41:22,509 --> 00:41:26,200
behind nation-state attackers it's

1005
00:41:23,859 --> 00:41:29,078
amazing rush you'll work a 12 hour a day

1006
00:41:26,200 --> 00:41:31,839
it'll feel like two and it's amazing it

1007
00:41:29,079 --> 00:41:33,759
is really really good so the good comes

1008
00:41:31,839 --> 00:41:34,989
to the bad with any job and I've been

1009
00:41:33,759 --> 00:41:37,989
harping on a lot about this but it was

1010
00:41:34,989 --> 00:41:40,329
mere to show you guys some of the the

1011
00:41:37,989 --> 00:41:41,920
compounding problems that really when

1012
00:41:40,329 --> 00:41:42,910
you sit back and go the blue team should

1013
00:41:41,920 --> 00:41:45,279
have a load on that it shouldn't have

1014
00:41:42,910 --> 00:41:46,779
been a problem we popped this box we

1015
00:41:45,279 --> 00:41:49,089
installed malware they should have seen

1016
00:41:46,779 --> 00:41:51,400
something there are a lot of issues at

1017
00:41:49,089 --> 00:41:53,558
play here not saying we shouldn't detect

1018
00:41:51,400 --> 00:41:58,390
detected but there's a lot of things

1019
00:41:53,559 --> 00:42:02,710
going on and as I say I have literally

1020
00:41:58,390 --> 00:42:05,078
been 10 minutes behind attackers the 10

1021
00:42:02,710 --> 00:42:07,660
minutes was only because vendor X and

1022
00:42:05,079 --> 00:42:09,940
it's logging situation just like you saw

1023
00:42:07,660 --> 00:42:12,368
Wayne with his delay was literally

1024
00:42:09,940 --> 00:42:13,960
taking that time okay I was analyzing

1025
00:42:12,369 --> 00:42:17,120
those logs seeing what they were doing

1026
00:42:13,960 --> 00:42:20,900
I'm gonna take this off the screen

1027
00:42:17,120 --> 00:42:23,000
I saw it just Sarah I was tennis behind

1028
00:42:20,900 --> 00:42:25,910
those guys passing off the the usernames

1029
00:42:23,000 --> 00:42:29,000
and host names to a colleague of mine

1030
00:42:25,910 --> 00:42:31,250
and will continuing to watch them the

1031
00:42:29,000 --> 00:42:33,890
one thing about and it depends on your

1032
00:42:31,250 --> 00:42:37,220
maturity of your company is that if you

1033
00:42:33,890 --> 00:42:39,049
can watch an attacker you you hopefully

1034
00:42:37,220 --> 00:42:39,830
reveal a lot of business intelligence of

1035
00:42:39,050 --> 00:42:41,720
what they're after

1036
00:42:39,830 --> 00:42:43,430
if you block an attack if you rebuttal

1037
00:42:41,720 --> 00:42:44,720
machine are done they may come in some

1038
00:42:43,430 --> 00:42:46,580
of the way what were they here for

1039
00:42:44,720 --> 00:42:48,529
were they just poking around whether

1040
00:42:46,580 --> 00:42:50,600
after something specific were they

1041
00:42:48,530 --> 00:42:56,200
trying to go to the negotiations or some

1042
00:42:50,600 --> 00:42:56,200
IP until that they want it there is some

1043
00:42:56,320 --> 00:43:00,320
there is some measure and actually

1044
00:42:58,160 --> 00:43:01,940
watching them closely and it depends on

1045
00:43:00,320 --> 00:43:03,590
on your infrastructure depends on your

1046
00:43:01,940 --> 00:43:06,110
team whether or not you can contain that

1047
00:43:03,590 --> 00:43:07,250
and depends on your risk appetite as

1048
00:43:06,110 --> 00:43:11,360
well which is a hard one to get across

1049
00:43:07,250 --> 00:43:12,950
the line PowerShell injects tacit gets

1050
00:43:11,360 --> 00:43:14,780
on a box first thing they do turn off

1051
00:43:12,950 --> 00:43:16,339
PowerShell logs you know you can shim

1052
00:43:14,780 --> 00:43:17,510
the PowerShell home profile and turn

1053
00:43:16,340 --> 00:43:20,000
that logging back on without them

1054
00:43:17,510 --> 00:43:22,850
knowing it's something we've done

1055
00:43:20,000 --> 00:43:28,430
recently it's been a simple code you can

1056
00:43:22,850 --> 00:43:30,170
just google it you can locally sync

1057
00:43:28,430 --> 00:43:32,509
they're c2s this really pisses them off

1058
00:43:30,170 --> 00:43:34,850
take some water figure this one out that

1059
00:43:32,510 --> 00:43:36,740
dynamic DNS that their piece of mail was

1060
00:43:34,850 --> 00:43:38,450
linked was going at two you can sync

1061
00:43:36,740 --> 00:43:40,939
those be it's syncing on your actual

1062
00:43:38,450 --> 00:43:44,299
sink holes internally alright or sync it

1063
00:43:40,940 --> 00:43:46,220
locally you can stump them for a little

1064
00:43:44,300 --> 00:43:47,290
while may tip your hand but you can

1065
00:43:46,220 --> 00:43:49,459
stomp them for a little while and

1066
00:43:47,290 --> 00:43:50,990
usually what happens is I don't look

1067
00:43:49,460 --> 00:43:55,060
close enough they'll switch to another

1068
00:43:50,990 --> 00:43:55,060
situ and it just gives you more Intel

1069
00:43:58,030 --> 00:44:02,330
you can cure s their connection and make

1070
00:44:00,890 --> 00:44:10,250
it like it's not in ninety and dial up

1071
00:44:02,330 --> 00:44:13,640
again and you can run their malware an

1072
00:44:10,250 --> 00:44:15,440
isolated machine I'm not going to talk a

1073
00:44:13,640 --> 00:44:16,910
lot about this as ago I work with a

1074
00:44:15,440 --> 00:44:19,790
called Matthew McGlashan and and he can

1075
00:44:16,910 --> 00:44:22,910
talk days about this but this gives you

1076
00:44:19,790 --> 00:44:26,300
a lot of business intelligence and it's

1077
00:44:22,910 --> 00:44:29,440
a small risk but sometimes it's worth

1078
00:44:26,300 --> 00:44:32,349
the payoff and that's a whole

1079
00:44:29,440 --> 00:44:34,630
presentation in itself the last one that

1080
00:44:32,349 --> 00:44:38,230
I'm very happy to stand up here and talk

1081
00:44:34,630 --> 00:44:40,720
about is corrupting rods I was in a

1082
00:44:38,230 --> 00:44:43,030
situation where exactly that they'd come

1083
00:44:40,720 --> 00:44:46,029
down they brought rather they did they

1084
00:44:43,030 --> 00:44:47,800
dipped up I think it was about four gig

1085
00:44:46,030 --> 00:44:51,280
of data and it was across about fifty

1086
00:44:47,800 --> 00:44:54,490
parts of rods and we were very close to

1087
00:44:51,280 --> 00:44:56,079
them and of course this always happens I

1088
00:44:54,490 --> 00:44:58,479
go to lunch just as the alert comes up

1089
00:44:56,079 --> 00:44:59,710
like that's a post lunch bin problem I

1090
00:44:58,480 --> 00:45:01,450
won't deal with that now I'll go to

1091
00:44:59,710 --> 00:45:04,030
lunch and having our lunch come back and

1092
00:45:01,450 --> 00:45:05,740
that's I should look at that and here

1093
00:45:04,030 --> 00:45:08,589
they were they were uploading

1094
00:45:05,740 --> 00:45:10,990
exfiltrating part by part by part so

1095
00:45:08,589 --> 00:45:13,029
this is what you do in that case you go

1096
00:45:10,990 --> 00:45:13,660
to the second last part you open it in a

1097
00:45:13,030 --> 00:45:17,079
text editor

1098
00:45:13,660 --> 00:45:20,109
or a hex editor wherever it may be you

1099
00:45:17,079 --> 00:45:21,310
take your hand and it's called the

1100
00:45:20,109 --> 00:45:24,190
keyboard slap then you could just slap

1101
00:45:21,310 --> 00:45:26,680
the keyboard and you put random junk in

1102
00:45:24,190 --> 00:45:27,970
that last part of the archive so that

1103
00:45:26,680 --> 00:45:29,529
when they do actual trailer they get it

1104
00:45:27,970 --> 00:45:30,399
back and it was a dog and now it's a cat

1105
00:45:29,530 --> 00:45:34,750
and they're sitting there going why is

1106
00:45:30,400 --> 00:45:37,690
this not working no I've actually done

1107
00:45:34,750 --> 00:45:39,819
that in an engagement and I've seen them

1108
00:45:37,690 --> 00:45:41,710
12 hours later going back and go they

1109
00:45:39,819 --> 00:45:43,119
tried to unrar it on on outside and they

1110
00:45:41,710 --> 00:45:47,770
went it didn't work and they stole it

1111
00:45:43,119 --> 00:45:49,390
again by this time we were ready they've

1112
00:45:47,770 --> 00:45:50,859
installed a keylogger I've actually hex

1113
00:45:49,390 --> 00:45:53,379
entered the key logger to modify where

1114
00:45:50,859 --> 00:45:54,730
the the logins going to and I've

1115
00:45:53,380 --> 00:45:57,040
actually logged it to somewhere I know

1116
00:45:54,730 --> 00:45:59,290
that's a handy username password to know

1117
00:45:57,040 --> 00:46:01,329
in future and I've actually put canary

1118
00:45:59,290 --> 00:46:02,680
tokens in the log file Davey axle traded

1119
00:46:01,329 --> 00:46:07,150
and then we've watched those come back

1120
00:46:02,680 --> 00:46:08,410
through if you have some controls and

1121
00:46:07,150 --> 00:46:09,700
you have some risk appetite with this

1122
00:46:08,410 --> 00:46:14,200
sort of stuff it can actually generate

1123
00:46:09,700 --> 00:46:18,750
some very good business intelligence now

1124
00:46:14,200 --> 00:46:22,839
how much time I forgot I'm over time

1125
00:46:18,750 --> 00:46:24,040
when we're over so I'll go a few

1126
00:46:22,839 --> 00:46:25,810
takeaways I'll go go through very

1127
00:46:24,040 --> 00:46:28,540
quickly the red team please record

1128
00:46:25,810 --> 00:46:30,609
everything right if you're on two or

1129
00:46:28,540 --> 00:46:32,200
three n raps game simultaneously I'd

1130
00:46:30,609 --> 00:46:34,029
like to know about it because it's very

1131
00:46:32,200 --> 00:46:36,640
hard to piece that together on my side

1132
00:46:34,030 --> 00:46:39,190
of things right I know report writing

1133
00:46:36,640 --> 00:46:42,160
for you guys sucks take a view like

1134
00:46:39,190 --> 00:46:43,130
literally screen capture your red team

1135
00:46:42,160 --> 00:46:44,660
as you're doing

1136
00:46:43,130 --> 00:46:47,210
because it provides a wealth of

1137
00:46:44,660 --> 00:46:49,190
information take a closer look at the

1138
00:46:47,210 --> 00:46:50,450
the signatures as I said before that

1139
00:46:49,190 --> 00:46:52,250
your tools are admitting your in maps

1140
00:46:50,450 --> 00:46:53,870
and those sorts of things some of them

1141
00:46:52,250 --> 00:46:56,510
are very obvious if you want to be a bit

1142
00:46:53,870 --> 00:47:01,490
sneaky yeah change them not against me

1143
00:46:56,510 --> 00:47:02,810
please and actually consider including

1144
00:47:01,490 --> 00:47:05,390
some detection strategies in your next

1145
00:47:02,810 --> 00:47:07,759
report if you've got a pen test report

1146
00:47:05,390 --> 00:47:09,680
your copy-paste this that maybe put a

1147
00:47:07,760 --> 00:47:12,290
detection strategy there for some of

1148
00:47:09,680 --> 00:47:15,410
them more less mature companies that's

1149
00:47:12,290 --> 00:47:17,029
you know you're offering a solution not

1150
00:47:15,410 --> 00:47:19,730
only do they have to patch and fix the

1151
00:47:17,030 --> 00:47:21,050
the hole but if it ever occurs again

1152
00:47:19,730 --> 00:47:25,250
because they've rolled some code back

1153
00:47:21,050 --> 00:47:27,740
you may have a way to detect it the blue

1154
00:47:25,250 --> 00:47:29,780
team side just focus on the basics DNS

1155
00:47:27,740 --> 00:47:31,339
authentication right I've talked about

1156
00:47:29,780 --> 00:47:35,240
some sexy tricks here but none of those

1157
00:47:31,340 --> 00:47:36,950
work until you get the basics right when

1158
00:47:35,240 --> 00:47:39,319
I first started the company all we had

1159
00:47:36,950 --> 00:47:44,029
was DNS no other logging and that showed

1160
00:47:39,320 --> 00:47:45,860
us a wealth of information the power of

1161
00:47:44,030 --> 00:47:50,420
the brain the human brain is really good

1162
00:47:45,860 --> 00:47:51,860
to pick out patterns so I'll give you an

1163
00:47:50,420 --> 00:47:54,770
example of this a lot of the alerts I

1164
00:47:51,860 --> 00:47:57,860
wrote last year the year before actually

1165
00:47:54,770 --> 00:48:00,110
over 2017 sorry it it focused on a

1166
00:47:57,860 --> 00:48:02,620
single alert or a single threshold so

1167
00:48:00,110 --> 00:48:05,990
greater than 25 hits I'm going to alert

1168
00:48:02,620 --> 00:48:08,240
now what I do is are include a report

1169
00:48:05,990 --> 00:48:09,620
and I'll include a graph or a report

1170
00:48:08,240 --> 00:48:11,660
because the human brain can pick out

1171
00:48:09,620 --> 00:48:12,520
those outliers much better than any AI

1172
00:48:11,660 --> 00:48:15,080
can

1173
00:48:12,520 --> 00:48:18,500
so consider if you can't write an alert

1174
00:48:15,080 --> 00:48:20,810
because it's too noisy show them a rare

1175
00:48:18,500 --> 00:48:23,930
value show them the common values let

1176
00:48:20,810 --> 00:48:26,779
them decide and if your team is if it's

1177
00:48:23,930 --> 00:48:28,850
not if it doesn't alert as much your

1178
00:48:26,780 --> 00:48:31,010
team will start to build what's normal

1179
00:48:28,850 --> 00:48:33,020
in the base line themselves and you can

1180
00:48:31,010 --> 00:48:35,060
document that going forward so when

1181
00:48:33,020 --> 00:48:37,430
something rare or something common does

1182
00:48:35,060 --> 00:48:41,990
happen that shouldn't it's not word in

1183
00:48:37,430 --> 00:48:43,430
itself and in general purple team's I

1184
00:48:41,990 --> 00:48:45,740
haven't mentioned that yet purple teams

1185
00:48:43,430 --> 00:48:48,589
are worth their weight in gold and I

1186
00:48:45,740 --> 00:48:51,430
have not done a lot of those yet and in

1187
00:48:48,590 --> 00:48:53,570
my eyes some people have different

1188
00:48:51,430 --> 00:48:55,129
interpretations of purple team's I would

1189
00:48:53,570 --> 00:48:56,150
say a purple team is a red team our city

1190
00:48:55,130 --> 00:48:58,430
runs an nmap

1191
00:48:56,150 --> 00:49:00,200
and then gives us Blue Team six hours to

1192
00:48:58,430 --> 00:49:01,669
figure out if we saw it what we saw if

1193
00:49:00,200 --> 00:49:03,439
we can write detection surround that

1194
00:49:01,670 --> 00:49:05,420
next step it's like running a red team

1195
00:49:03,440 --> 00:49:08,029
but doing it over six months and do it

1196
00:49:05,420 --> 00:49:10,099
step by step and during that way we can

1197
00:49:08,029 --> 00:49:11,319
actually map out what's happening it

1198
00:49:10,099 --> 00:49:13,520
gives us a chance to go we've got

1199
00:49:11,319 --> 00:49:15,349
visibility issues here are delayed logs

1200
00:49:13,520 --> 00:49:19,759
aren't working we can write some alerts

1201
00:49:15,349 --> 00:49:21,380
and if you're not on the pen testing the

1202
00:49:19,760 --> 00:49:23,750
the defender the audience and response

1203
00:49:21,380 --> 00:49:25,609
story side have a chat if your

1204
00:49:23,750 --> 00:49:27,079
architecture whatever it may be to some

1205
00:49:25,609 --> 00:49:30,980
of the deficiencies and logging in

1206
00:49:27,079 --> 00:49:32,089
visibility that the blue team have the

1207
00:49:30,980 --> 00:49:34,010
amount of people I've talked to that are

1208
00:49:32,089 --> 00:49:36,009
in cybersecurity and go I didn't realize

1209
00:49:34,010 --> 00:49:38,299
that that service account was failing

1210
00:49:36,010 --> 00:49:41,150
fifty thousand times a day that

1211
00:49:38,299 --> 00:49:42,770
shouldn't be happening actually share

1212
00:49:41,150 --> 00:49:44,420
some of the some of those common issues

1213
00:49:42,770 --> 00:49:49,730
because you'd be surprised how much they

1214
00:49:44,420 --> 00:49:53,660
can help and with that hopefully I

1215
00:49:49,730 --> 00:49:55,220
haven't destroyed your your will to join

1216
00:49:53,660 --> 00:49:57,980
the blue team as I said it's like it's

1217
00:49:55,220 --> 00:50:01,098
like neo chasing Agent Smith but I'm

1218
00:49:57,980 --> 00:50:03,980
hoping that gave you some insight to the

1219
00:50:01,099 --> 00:50:06,140
challenges of running in response at

1220
00:50:03,980 --> 00:50:11,000
Lascaux thank you much

1221
00:50:06,140 --> 00:50:11,000
[Applause]

