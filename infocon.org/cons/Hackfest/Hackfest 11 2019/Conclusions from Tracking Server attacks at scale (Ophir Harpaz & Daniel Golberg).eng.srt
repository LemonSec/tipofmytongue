1
00:00:00,469 --> 00:00:07,200
hey guys hello okay thank you for being

2
00:00:07,200 --> 00:00:09,260
with us today

3
00:00:09,260 --> 00:00:12,750
my name is affair this is Daniel will

4
00:00:12,750 --> 00:00:15,599
present ourselves soon our talk today is

5
00:00:15,599 --> 00:00:18,170
named conclusions from tracking attack

6
00:00:18,170 --> 00:00:21,210
server attacks at scale first I'd like

7
00:00:21,210 --> 00:00:25,519
to tell you a little bit about what we

8
00:00:25,519 --> 00:00:28,170
mean when we say server attacks and how

9
00:00:28,170 --> 00:00:31,109
these attacks look in high-level so

10
00:00:31,109 --> 00:00:34,829
let's begin server attacks are any

11
00:00:34,829 --> 00:00:37,530
attack that targets a server machine as

12
00:00:37,530 --> 00:00:41,309
opposed to endpoints such as personal

13
00:00:41,309 --> 00:00:44,070
computers laptop mobile phones server

14
00:00:44,070 --> 00:00:45,840
machines can be anything from web

15
00:00:45,840 --> 00:00:48,660
servers database servers orchestration

16
00:00:48,660 --> 00:00:52,050
servers etc why do these machines make a

17
00:00:52,050 --> 00:00:55,379
good target for attackers so first of

18
00:00:55,379 --> 00:00:57,539
all these attacks are usually very

19
00:00:57,539 --> 00:01:00,149
automated and they require zero user

20
00:01:00,149 --> 00:01:03,210
interaction second of all server

21
00:01:03,210 --> 00:01:05,159
machines as you probably can assume they

22
00:01:05,159 --> 00:01:07,439
have very long uptime this means that

23
00:01:07,439 --> 00:01:09,360
attackers have very high chances of

24
00:01:09,360 --> 00:01:13,049
reaching an active machine server

25
00:01:13,049 --> 00:01:15,060
machines have exactly what attackers are

26
00:01:15,060 --> 00:01:17,280
looking for so if we're talking about a

27
00:01:17,280 --> 00:01:20,100
lot of CPU power this is a great basis

28
00:01:20,100 --> 00:01:22,500
for a crypto mining and crypto jacking

29
00:01:22,500 --> 00:01:24,780
if we're talking about large bandwidth

30
00:01:24,780 --> 00:01:27,180
then this means better and more

31
00:01:27,180 --> 00:01:29,880
efficient DDoS attack if we're talking

32
00:01:29,880 --> 00:01:31,979
about storage server machines usually

33
00:01:31,979 --> 00:01:34,259
have a lot of valuable data that

34
00:01:34,259 --> 00:01:36,780
attackers can still send to their

35
00:01:36,780 --> 00:01:38,700
command and control servers and later on

36
00:01:38,700 --> 00:01:42,240
sell to other attack groups and last but

37
00:01:42,240 --> 00:01:45,119
not least server machines are sometimes

38
00:01:45,119 --> 00:01:47,100
those neglected machines within the

39
00:01:47,100 --> 00:01:49,829
organization they run old operating

40
00:01:49,829 --> 00:01:52,049
systems they don't have security patches

41
00:01:52,049 --> 00:01:54,899
installed sometimes they're even exposed

42
00:01:54,899 --> 00:01:56,969
to the Internet where really they don't

43
00:01:56,969 --> 00:01:59,430
have any reason to be and all these

44
00:01:59,430 --> 00:02:01,170
reasons make them a really good target

45
00:02:01,170 --> 00:02:05,310
for attackers to concentrate on now

46
00:02:05,310 --> 00:02:07,079
let's see how these attacks look like

47
00:02:07,079 --> 00:02:10,110
from beginning to end when an attacker

48
00:02:10,110 --> 00:02:12,120
wants to initiate an attack campaign

49
00:02:12,120 --> 00:02:13,890
they first need to locate the

50
00:02:13,890 --> 00:02:16,740
scenes on the internet that run the

51
00:02:16,740 --> 00:02:18,240
vulnerable services

52
00:02:18,240 --> 00:02:22,380
these can be mssql SMB MySQL and the

53
00:02:22,380 --> 00:02:24,170
relevant port numbers that appear

54
00:02:24,170 --> 00:02:27,180
respectively in the slide to locate

55
00:02:27,180 --> 00:02:28,709
these machines on the Internet

56
00:02:28,709 --> 00:02:31,230
the attackers perform simple port

57
00:02:31,230 --> 00:02:35,490
scanning and what we see is that some of

58
00:02:35,490 --> 00:02:37,170
the times they use open source tools

59
00:02:37,170 --> 00:02:40,890
like nmap or masscan which are publicly

60
00:02:40,890 --> 00:02:43,319
available but they are also sometimes

61
00:02:43,319 --> 00:02:45,330
write their own proprietary port

62
00:02:45,330 --> 00:02:47,220
scanners to integrate with their other

63
00:02:47,220 --> 00:02:50,370
modules once they find these machines on

64
00:02:50,370 --> 00:02:51,690
the Internet

65
00:02:51,690 --> 00:02:53,370
they need to exploit the vulnerable

66
00:02:53,370 --> 00:02:55,650
services and they do this usually in one

67
00:02:55,650 --> 00:02:59,670
of two methods either vulnerability

68
00:02:59,670 --> 00:03:02,250
exploitation or simple credential brute

69
00:03:02,250 --> 00:03:02,870
force

70
00:03:02,870 --> 00:03:05,760
so with vulnerability exploitation what

71
00:03:05,760 --> 00:03:09,209
we see a lot is lately the eternal blue

72
00:03:09,209 --> 00:03:11,880
exploits that we've heard of in the last

73
00:03:11,880 --> 00:03:15,510
in the previous talk we're seeing

74
00:03:15,510 --> 00:03:17,519
eternal blue exploitations implemented

75
00:03:17,519 --> 00:03:19,560
in Python and PowerShell in many

76
00:03:19,560 --> 00:03:22,380
languages this is still very active

77
00:03:22,380 --> 00:03:24,420
today we also see all the web

78
00:03:24,420 --> 00:03:26,519
vulnerabilities like Oracle struts and

79
00:03:26,519 --> 00:03:30,690
PHP myadmin and many more but also as I

80
00:03:30,690 --> 00:03:32,370
mentioned credential brute force is a

81
00:03:32,370 --> 00:03:37,560
very preferred method for attackers once

82
00:03:37,560 --> 00:03:39,810
the machine is exploited the attackers

83
00:03:39,810 --> 00:03:42,060
are in the organization and at this

84
00:03:42,060 --> 00:03:45,090
point at the post infection phase what

85
00:03:45,090 --> 00:03:47,820
they usually do is such additional

86
00:03:47,820 --> 00:03:50,280
payloads these can be the DDoS modules

87
00:03:50,280 --> 00:03:53,850
more malware crypto miners and sometimes

88
00:03:53,850 --> 00:03:56,400
these attackers decide to propagate and

89
00:03:56,400 --> 00:03:58,230
move laterally within the organization

90
00:03:58,230 --> 00:04:00,329
why because they need as many machines

91
00:04:00,329 --> 00:04:02,850
infected as possible so they just try to

92
00:04:02,850 --> 00:04:04,739
move laterally within the organization

93
00:04:04,739 --> 00:04:07,170
and get as many server machines as they

94
00:04:07,170 --> 00:04:12,870
can good so we at guard Igor where we

95
00:04:12,870 --> 00:04:15,329
work we see a lot of these attack

96
00:04:15,329 --> 00:04:18,000
campaigns and we have a very large data

97
00:04:18,000 --> 00:04:19,918
set that Daniel will describe later on

98
00:04:19,918 --> 00:04:23,039
and this is a very nice basis for us to

99
00:04:23,039 --> 00:04:26,669
ask some very interesting questions so

100
00:04:26,669 --> 00:04:27,720
for example who are

101
00:04:27,720 --> 00:04:29,460
the attack machines that are responsible

102
00:04:29,460 --> 00:04:32,460
for the major attacks in the Internet

103
00:04:32,460 --> 00:04:34,530
where did they come from which countries

104
00:04:34,530 --> 00:04:36,900
which is appease hosts these attack

105
00:04:36,900 --> 00:04:37,530
machines

106
00:04:37,530 --> 00:04:39,660
how long did these attack machine live

107
00:04:39,660 --> 00:04:43,740
how long do they operate once the server

108
00:04:43,740 --> 00:04:46,140
the attackers are on the infected

109
00:04:46,140 --> 00:04:47,700
machines where did they go outbound

110
00:04:47,700 --> 00:04:50,420
which machines do they try to connect to

111
00:04:50,420 --> 00:04:53,010
we're going to try and answer some of

112
00:04:53,010 --> 00:04:54,780
these questions of course there is a lot

113
00:04:54,780 --> 00:04:57,030
to ask and research here there's a lot

114
00:04:57,030 --> 00:04:59,640
of future work to be done which I think

115
00:04:59,640 --> 00:05:04,230
will be fascinating so the agenda for

116
00:05:04,230 --> 00:05:06,750
today we covered server attacks in short

117
00:05:06,750 --> 00:05:09,600
next annual will present the data set

118
00:05:09,600 --> 00:05:13,170
that we worked with and the main part

119
00:05:13,170 --> 00:05:15,180
will be present to you our findings from

120
00:05:15,180 --> 00:05:17,190
our data analysis the questions and

121
00:05:17,190 --> 00:05:19,940
answers and also some anecdotal

122
00:05:19,940 --> 00:05:22,290
campaigns that we uncovered in Guardi

123
00:05:22,290 --> 00:05:24,770
core to show you some real-life examples

124
00:05:24,770 --> 00:05:27,030
finally we will conclude will have some

125
00:05:27,030 --> 00:05:30,030
amusing anecdotes as well regarding

126
00:05:30,030 --> 00:05:34,080
attacker behavior and yeah we'll wrap it

127
00:05:34,080 --> 00:05:36,810
up so now to present ourselves a little

128
00:05:36,810 --> 00:05:39,000
more thoroughly my name is Luke fear and

129
00:05:39,000 --> 00:05:40,950
security researcher in the guard Ecore

130
00:05:40,950 --> 00:05:43,710
where Daniel is my boss and enjoys

131
00:05:43,710 --> 00:05:45,479
throwing tasks at me

132
00:05:45,479 --> 00:05:48,300
I love reverse engineering binaries

133
00:05:48,300 --> 00:05:50,850
malware whatever and also a big twitter

134
00:05:50,850 --> 00:05:53,880
addict you're very invited to follow a

135
00:05:53,880 --> 00:05:59,550
few one Daniel so I'm Daniel as if we're

136
00:05:59,550 --> 00:06:01,620
introduced to me after a decade in

137
00:06:01,620 --> 00:06:04,200
security I'm call myself security

138
00:06:04,200 --> 00:06:06,770
jack-of-all-trades and somehow still

139
00:06:06,770 --> 00:06:09,419
hopeless Windows fanboy despite the mess

140
00:06:09,419 --> 00:06:13,410
that is that operating system in two

141
00:06:13,410 --> 00:06:15,090
sentences briefly about where we work

142
00:06:15,090 --> 00:06:17,040
guard core is a cloud and data center

143
00:06:17,040 --> 00:06:19,650
security company the buzzwords is like

144
00:06:19,650 --> 00:06:22,380
we do micro segmentation visibility what

145
00:06:22,380 --> 00:06:24,210
this means in practice is we built a

146
00:06:24,210 --> 00:06:27,030
distributed firewall for virtual

147
00:06:27,030 --> 00:06:29,150
machines and optimized for servers

148
00:06:29,150 --> 00:06:31,979
enough about that let's talk a bit about

149
00:06:31,979 --> 00:06:33,300
the data and the research that we

150
00:06:33,300 --> 00:06:36,780
actually performed so our idea was let's

151
00:06:36,780 --> 00:06:38,460
look at what's happening and attacks on

152
00:06:38,460 --> 00:06:40,080
the internet if you just put a machine

153
00:06:40,080 --> 00:06:41,490
online what actually

154
00:06:41,490 --> 00:06:43,860
happens to it we all know it in a very

155
00:06:43,860 --> 00:06:45,120
high level what if you're describing we

156
00:06:45,120 --> 00:06:46,530
decide to take a closer look at what

157
00:06:46,530 --> 00:06:47,870
actually happens here

158
00:06:47,870 --> 00:06:50,819
the core idea we had was let's put a lot

159
00:06:50,819 --> 00:06:54,539
a lot of honey pots and to the internet

160
00:06:54,539 --> 00:06:55,500
and see what happens

161
00:06:55,500 --> 00:06:57,060
and but to do this in a slightly

162
00:06:57,060 --> 00:07:00,720
sophisticated manner what we did was the

163
00:07:00,720 --> 00:07:02,280
idea that we want to route publicly

164
00:07:02,280 --> 00:07:04,740
accessible IPs to machines we control

165
00:07:04,740 --> 00:07:07,440
and basically setting up a server that's

166
00:07:07,440 --> 00:07:09,590
exposed to the Internet on all the ports

167
00:07:09,590 --> 00:07:12,180
block all of them and then dynamically

168
00:07:12,180 --> 00:07:15,240
redirect the traffic to a virtual

169
00:07:15,240 --> 00:07:17,460
machine honeypot so we generate every

170
00:07:17,460 --> 00:07:19,139
few minutes this means that if

171
00:07:19,139 --> 00:07:21,150
somebody's scanning the internet for

172
00:07:21,150 --> 00:07:23,880
looking for MySQL servers we're gonna

173
00:07:23,880 --> 00:07:26,400
say hi there this is a MySQL server and

174
00:07:26,400 --> 00:07:28,500
give him a honeypot that's a MySQL

175
00:07:28,500 --> 00:07:30,599
server if he does that for SSH he gets

176
00:07:30,599 --> 00:07:36,020
the same service the problem is just a

177
00:07:36,020 --> 00:07:38,520
connecting to machine doesn't mean you

178
00:07:38,520 --> 00:07:41,009
can break into it attackers need to

179
00:07:41,009 --> 00:07:43,770
someone break in and most people are not

180
00:07:43,770 --> 00:07:45,810
gonna spend their strong vulnerabilities

181
00:07:45,810 --> 00:07:48,599
online so we wanted to do was to create

182
00:07:48,599 --> 00:07:50,070
virtual machines with vulnerable

183
00:07:50,070 --> 00:07:52,830
services for example old PHP myadmin a

184
00:07:52,830 --> 00:07:54,740
popular content management system or

185
00:07:54,740 --> 00:07:56,880
unpatched windows box is still

186
00:07:56,880 --> 00:07:58,560
vulnerable to the eternal blue a

187
00:07:58,560 --> 00:08:01,020
vulnerability from two years ago and so

188
00:08:01,020 --> 00:08:03,539
forth another thing we did was we

189
00:08:03,539 --> 00:08:06,479
patched sshd and the SMB service so that

190
00:08:06,479 --> 00:08:08,370
after a few attempts the attackers are

191
00:08:08,370 --> 00:08:10,889
just gonna break in that means they were

192
00:08:10,889 --> 00:08:12,509
gonna try administrator password one

193
00:08:12,509 --> 00:08:15,479
root root admin admin and on the fourth

194
00:08:15,479 --> 00:08:20,759
try they're in ok once inside what do we

195
00:08:20,759 --> 00:08:25,169
want to know so and wait before that we

196
00:08:25,169 --> 00:08:28,259
did this spread around 400 or so

197
00:08:28,259 --> 00:08:31,620
publicly accessible ip's a we partnered

198
00:08:31,620 --> 00:08:33,570
with a large European hosting company to

199
00:08:33,570 --> 00:08:37,049
took 30 IPS from there a a large

200
00:08:37,049 --> 00:08:38,578
regional university gave us an unused

201
00:08:38,578 --> 00:08:41,190
class C and to divert to our honey pots

202
00:08:41,190 --> 00:08:44,279
we bought 60 IPS from one of the larger

203
00:08:44,279 --> 00:08:47,370
cloud vendors and just when took the

204
00:08:47,370 --> 00:08:49,890
corporate credit card and bought a IP

205
00:08:49,890 --> 00:08:52,110
ranges in different data centers in the

206
00:08:52,110 --> 00:08:54,570
u.s. in Europe does give us a pretty

207
00:08:54,570 --> 00:08:55,140
good snare

208
00:08:55,140 --> 00:08:59,070
what's going on in the West and once we

209
00:08:59,070 --> 00:09:01,290
did that we decided to take a look at

210
00:09:01,290 --> 00:09:03,540
what's actually going on so basically

211
00:09:03,540 --> 00:09:05,430
what's our honeypot cable of doing so

212
00:09:05,430 --> 00:09:09,990
like pretty much any other sandbox it we

213
00:09:09,990 --> 00:09:11,700
monitor for process events process

214
00:09:11,700 --> 00:09:13,830
creation command lines environment

215
00:09:13,830 --> 00:09:15,540
variables and so forth

216
00:09:15,540 --> 00:09:17,910
we run a full packet capture of all

217
00:09:17,910 --> 00:09:21,210
incoming and outgoing traffic to monitor

218
00:09:21,210 --> 00:09:23,070
but we take a closer look for example

219
00:09:23,070 --> 00:09:25,410
and what all DNS queries going outside

220
00:09:25,410 --> 00:09:27,630
of that box it go through to a name

221
00:09:27,630 --> 00:09:29,940
server under our control we all see

222
00:09:29,940 --> 00:09:32,070
track all file and registry events such

223
00:09:32,070 --> 00:09:35,700
as file saves modifications queries we

224
00:09:35,700 --> 00:09:36,990
want to know everything the attackers

225
00:09:36,990 --> 00:09:39,630
did all this is typical for many

226
00:09:39,630 --> 00:09:42,030
sandboxes we also went a step further

227
00:09:42,030 --> 00:09:45,060
and wrote application specific hooks to

228
00:09:45,060 --> 00:09:47,670
look into activities on database servers

229
00:09:47,670 --> 00:09:49,820
for example database queries or

230
00:09:49,820 --> 00:09:52,710
powershell blocks that were executed or

231
00:09:52,710 --> 00:09:55,920
a user password modifications and so

232
00:09:55,920 --> 00:09:59,010
forth and we weren't pretty wild on that

233
00:09:59,010 --> 00:10:00,810
this is a very partial list to follow

234
00:10:00,810 --> 00:10:03,090
the custom hooks we implemented for

235
00:10:03,090 --> 00:10:05,370
example we keep track of user operations

236
00:10:05,370 --> 00:10:08,220
like which use a group modifications as

237
00:10:08,220 --> 00:10:10,340
I mention before DNS resolutions

238
00:10:10,340 --> 00:10:13,050
schedule task creations and we run the

239
00:10:13,050 --> 00:10:15,240
entire pcap file through a yaro rules

240
00:10:15,240 --> 00:10:18,270
engine to just see what other people

241
00:10:18,270 --> 00:10:22,950
were gonna pick up so we cover pretty

242
00:10:22,950 --> 00:10:24,600
much everything that happens inside the

243
00:10:24,600 --> 00:10:26,340
box but there are important limitations

244
00:10:26,340 --> 00:10:29,730
and we cover a bunch of operating

245
00:10:29,730 --> 00:10:32,670
systems my mistake you can see here

246
00:10:32,670 --> 00:10:35,670
Windows Server 2003 2012 r2 and a boon

247
00:10:35,670 --> 00:10:40,590
to 1404 these are not the latest and

248
00:10:40,590 --> 00:10:41,820
greatest operating systems and this was

249
00:10:41,820 --> 00:10:43,830
delivered we wanted to cover the

250
00:10:43,830 --> 00:10:45,680
operating systems that we expect to see

251
00:10:45,680 --> 00:10:47,700
unmaintained in the internet not fully

252
00:10:47,700 --> 00:10:50,280
patch not maintained properly and see

253
00:10:50,280 --> 00:10:52,740
what attackers do to these machines also

254
00:10:52,740 --> 00:10:54,870
besides the typical obvious services

255
00:10:54,870 --> 00:10:59,070
such as SMB FTP remote desktop we also

256
00:10:59,070 --> 00:11:01,440
exposed in a hadoop yarn configuration

257
00:11:01,440 --> 00:11:04,770
windows remote management a telnet and

258
00:11:04,770 --> 00:11:06,270
we pretty much try to figure out what

259
00:11:06,270 --> 00:11:08,370
attackers are going to look for and give

260
00:11:08,370 --> 00:11:09,059
them

261
00:11:09,059 --> 00:11:13,379
to see some limitations to our research

262
00:11:13,379 --> 00:11:16,349
to keep in mind in our conclusions a I

263
00:11:16,349 --> 00:11:19,259
mentioned 400 or so routed IPs but this

264
00:11:19,259 --> 00:11:21,239
number changes over time depending on

265
00:11:21,239 --> 00:11:23,339
budget same with the number of honey

266
00:11:23,339 --> 00:11:25,919
pots we have this means we basically

267
00:11:25,919 --> 00:11:27,449
have limited resources compared to the

268
00:11:27,449 --> 00:11:29,909
internet and that means aggressive

269
00:11:29,909 --> 00:11:31,979
attackers are overrepresented if for

270
00:11:31,979 --> 00:11:33,809
example we sample only 1 in every 10

271
00:11:33,809 --> 00:11:35,849
connections then people who are

272
00:11:35,849 --> 00:11:37,769
constantly trying to break in through

273
00:11:37,769 --> 00:11:40,139
our front door are more likely to be

274
00:11:40,139 --> 00:11:42,179
recorded than the one in a million who

275
00:11:42,179 --> 00:11:45,419
has a really cool technique additionally

276
00:11:45,419 --> 00:11:47,819
not all IP ranges are created equal for

277
00:11:47,819 --> 00:11:49,379
example we discovered that one of our IP

278
00:11:49,379 --> 00:11:51,599
ranges was predominately targeted around

279
00:11:51,599 --> 00:11:54,719
windows and so when those results allow

280
00:11:54,719 --> 00:11:57,029
a more popular in our data set then we

281
00:11:57,029 --> 00:11:58,799
know that exists in the real world

282
00:11:58,799 --> 00:12:00,419
according to scanners like to show down

283
00:12:00,419 --> 00:12:04,919
in census and okay with that in mind

284
00:12:04,919 --> 00:12:06,209
let's actually look into what we

285
00:12:06,209 --> 00:12:09,539
actually discovered here a we ran this

286
00:12:09,539 --> 00:12:11,809
experiment for roughly two years and

287
00:12:11,809 --> 00:12:14,099
started crunching the numbers recently

288
00:12:14,099 --> 00:12:17,009
and this means roughly 2 million or so

289
00:12:17,009 --> 00:12:21,269
different unique attack incidents we

290
00:12:21,269 --> 00:12:22,799
start out from the very basic question

291
00:12:22,799 --> 00:12:24,719
of just how dominant our top attackers

292
00:12:24,719 --> 00:12:26,579
meaning those noisy people who are

293
00:12:26,579 --> 00:12:28,469
costly trying to break into everything

294
00:12:28,469 --> 00:12:31,769
every IP they see want to track just how

295
00:12:31,769 --> 00:12:34,169
dominant are they are the importer and

296
00:12:34,169 --> 00:12:37,169
is blacklisting that their IPs really

297
00:12:37,169 --> 00:12:40,649
relevant the technique was simple let's

298
00:12:40,649 --> 00:12:42,809
count the attack incidents per attacker

299
00:12:42,809 --> 00:12:46,169
IP sort by a descending number and fetch

300
00:12:46,169 --> 00:12:51,029
the top attacker IPS and we did that we

301
00:12:51,029 --> 00:12:53,609
took the first 100 of our results

302
00:12:53,609 --> 00:12:55,679
counted number of attacks from them and

303
00:12:55,679 --> 00:12:57,359
divided by the number of overall attacks

304
00:12:57,359 --> 00:12:59,699
we saw and the first result was pretty

305
00:12:59,699 --> 00:13:03,389
cool 1% of all source IPS all attacker

306
00:13:03,389 --> 00:13:06,359
IPS are responsible for 35% of all

307
00:13:06,359 --> 00:13:10,559
security incidents hey this sounds like

308
00:13:10,559 --> 00:13:12,029
it would be a great idea to just take

309
00:13:12,029 --> 00:13:14,279
this list of 1% of these IPs and just

310
00:13:14,279 --> 00:13:17,009
blacklist them and significantly reduce

311
00:13:17,009 --> 00:13:18,929
the noise we're seeing in our firewall

312
00:13:18,929 --> 00:13:21,809
logs in access logs and leave time to

313
00:13:21,809 --> 00:13:22,800
focus on more inch

314
00:13:22,800 --> 00:13:26,339
ding threats but we're skeptical and we

315
00:13:26,339 --> 00:13:28,050
checked just how stable these numbers

316
00:13:28,050 --> 00:13:30,510
are and we reran them just for the stop

317
00:13:30,510 --> 00:13:34,740
three months in the last summer the

318
00:13:34,740 --> 00:13:38,040
results are a bit less a useful 13% of

319
00:13:38,040 --> 00:13:40,079
attackers are responsible for 35% of

320
00:13:40,079 --> 00:13:43,410
attack incidence this is still

321
00:13:43,410 --> 00:13:45,870
interesting because those are not that

322
00:13:45,870 --> 00:13:51,029
many IPS we're talking about 200 that if

323
00:13:51,029 --> 00:13:54,899
you block a significant fraction if

324
00:13:54,899 --> 00:13:59,339
they're all follow their attacks you

325
00:13:59,339 --> 00:14:01,950
want sorry hey this doesn't mean if you

326
00:14:01,950 --> 00:14:04,440
want to use blocks you're gonna have to

327
00:14:04,440 --> 00:14:08,459
update them over okay somebody good

328
00:14:08,459 --> 00:14:17,579
figure so hold on okay just move to

329
00:14:17,579 --> 00:14:23,339
using this this does you like lists okay

330
00:14:23,339 --> 00:14:25,019
we'll work over you God

331
00:14:25,019 --> 00:14:28,519
if this doesn't mean if you want to

332
00:14:35,190 --> 00:14:38,740
and yeah this doesn't mean if you want

333
00:14:38,740 --> 00:14:41,200
to rely at lists then you're gonna have

334
00:14:41,200 --> 00:14:43,360
to keep updating your black lists not

335
00:14:43,360 --> 00:14:45,370
every half year but pretty much every

336
00:14:45,370 --> 00:14:49,750
week or so we also decide to take a look

337
00:14:49,750 --> 00:14:52,030
at where these attackers come from and

338
00:14:52,030 --> 00:14:56,860
which geographically and ISP level so

339
00:14:56,860 --> 00:14:59,020
geographically we ran all these IPS

340
00:14:59,020 --> 00:15:03,010
through a commercial a geolocation find

341
00:15:03,010 --> 00:15:06,220
if you're curious and no big surprise on

342
00:15:06,220 --> 00:15:08,200
to top three the United States China and

343
00:15:08,200 --> 00:15:10,390
Russia are the most popular sources of

344
00:15:10,390 --> 00:15:14,710
the botnet attacks and it's more

345
00:15:14,710 --> 00:15:16,510
surprising to look at Vietnam which is

346
00:15:16,510 --> 00:15:19,600
somehow earth fourth result and we're

347
00:15:19,600 --> 00:15:21,190
not exactly sure since when is Vietnam a

348
00:15:21,190 --> 00:15:24,660
cybercrime powerhouse here

349
00:15:24,660 --> 00:15:26,620
there's not much we can do about it

350
00:15:26,620 --> 00:15:27,370
coming

351
00:15:27,370 --> 00:15:30,010
China and Russia but there is a law we

352
00:15:30,010 --> 00:15:32,320
can do about tax coming from the US and

353
00:15:32,320 --> 00:15:33,970
we decide to take a closer look at what

354
00:15:33,970 --> 00:15:38,860
is peace both for attacks in the US and

355
00:15:38,860 --> 00:15:41,020
in the top five we see with a large

356
00:15:41,020 --> 00:15:42,820
hosting companies such as Colo crossing

357
00:15:42,820 --> 00:15:43,630
in digitalocean

358
00:15:43,630 --> 00:15:47,860
no surprise at just such ISPs would be

359
00:15:47,860 --> 00:15:50,800
used a and also abuse by attackers but

360
00:15:50,800 --> 00:15:56,310
also some names such as that are uh that

361
00:15:56,310 --> 00:15:59,080
are pretty surprising to see and we're

362
00:15:59,080 --> 00:16:01,360
not exactly sure who's using these IDs

363
00:16:01,360 --> 00:16:04,570
and why are we accepting from them for

364
00:16:04,570 --> 00:16:06,330
primarily responsible for spreading

365
00:16:06,330 --> 00:16:10,900
malware on la it's an interesting

366
00:16:10,900 --> 00:16:13,600
question just how often these attacks

367
00:16:13,600 --> 00:16:17,350
happen how long da for example if you're

368
00:16:17,350 --> 00:16:23,820
spreading attacks from digitalocean what

369
00:16:23,820 --> 00:16:28,500
let's see if now this works yeah okay

370
00:16:28,500 --> 00:16:34,390
technical problems are fun so it's an

371
00:16:34,390 --> 00:16:35,950
interesting question just how long if

372
00:16:35,950 --> 00:16:38,590
you take a malicious I if you take a

373
00:16:38,590 --> 00:16:39,910
server from digitalocean

374
00:16:39,910 --> 00:16:42,490
and start attacking does anybody stop

375
00:16:42,490 --> 00:16:44,950
you if for example you compromised some

376
00:16:44,950 --> 00:16:47,779
machine that's hosted in a nice beat or

377
00:16:47,779 --> 00:16:50,389
blocked or not and we'd want to take a

378
00:16:50,389 --> 00:16:52,910
look closer look into this an

379
00:16:52,910 --> 00:16:54,829
interesting question we started by

380
00:16:54,829 --> 00:16:57,649
asking was how do we even find and count

381
00:16:57,649 --> 00:17:01,009
these a naive approach would be to take

382
00:17:01,009 --> 00:17:03,110
each attackers first scene and last

383
00:17:03,110 --> 00:17:05,510
scene timestamps and subtract this is

384
00:17:05,510 --> 00:17:08,270
problematic for two reasons one in these

385
00:17:08,270 --> 00:17:10,189
large hosting companies IPS are

386
00:17:10,189 --> 00:17:12,380
frequently reused and an IP that would

387
00:17:12,380 --> 00:17:16,459
be used in one by one server the service

388
00:17:16,459 --> 00:17:18,589
decommission two months later an IP is

389
00:17:18,589 --> 00:17:21,919
reused again and we might count it as a

390
00:17:21,919 --> 00:17:24,439
single consecutive sequence not good

391
00:17:24,439 --> 00:17:28,339
enough additionally a a popular event

392
00:17:28,339 --> 00:17:30,830
that happens in a malicious circles is

393
00:17:30,830 --> 00:17:33,679
you take over a machine this is admin

394
00:17:33,679 --> 00:17:37,640
and notices it kicks you off but doesn't

395
00:17:37,640 --> 00:17:39,710
block the way you entered the machine

396
00:17:39,710 --> 00:17:42,200
and two months later you're infected

397
00:17:42,200 --> 00:17:43,970
again we would like to consider these as

398
00:17:43,970 --> 00:17:48,860
two different events we needed to find a

399
00:17:48,860 --> 00:17:51,289
better solution what we ended up doing

400
00:17:51,289 --> 00:17:54,049
was to take all the attacks time stamps

401
00:17:54,049 --> 00:17:56,720
per attack or IP rounded to one week's

402
00:17:56,720 --> 00:17:59,450
resolution and counted the number of

403
00:17:59,450 --> 00:18:00,559
consecutive weeks

404
00:18:00,559 --> 00:18:04,220
in this attack so if a server is

405
00:18:04,220 --> 00:18:06,440
spreaded around a different attacks for

406
00:18:06,440 --> 00:18:09,260
two months was cleaned up attacked again

407
00:18:09,260 --> 00:18:11,030
a few weeks later we're gonna count

408
00:18:11,030 --> 00:18:14,840
these as separate events and once we did

409
00:18:14,840 --> 00:18:17,419
that we got the following results this

410
00:18:17,419 --> 00:18:19,730
is the number of IP addresses per number

411
00:18:19,730 --> 00:18:22,909
of distinct weeks we've seen these IPS

412
00:18:22,909 --> 00:18:24,919
and our sensors you can see the very

413
00:18:24,919 --> 00:18:28,460
rapid drop-off of a round one or two

414
00:18:28,460 --> 00:18:31,640
weeks and then a very rapid drop what

415
00:18:31,640 --> 00:18:33,760
this means is the vast majority of cases

416
00:18:33,760 --> 00:18:37,159
if a machine is compromised it's rapidly

417
00:18:37,159 --> 00:18:39,799
discovered and cleaned up and somebody

418
00:18:39,799 --> 00:18:42,649
hardens the box again but there's a very

419
00:18:42,649 --> 00:18:44,630
long tail and the graph doesn't show it

420
00:18:44,630 --> 00:18:46,429
properly but this keeps on going till

421
00:18:46,429 --> 00:18:49,760
the 40s and 50s stabilizes around 25

422
00:18:49,760 --> 00:18:52,970
weeks and we feel comfortable stating

423
00:18:52,970 --> 00:18:55,390
that servers that we see very frequently

424
00:18:55,390 --> 00:18:58,669
attacking our honey pots are not just

425
00:18:58,669 --> 00:19:00,679
some server that somebody randomly took

426
00:19:00,679 --> 00:19:01,610
over but dead

427
00:19:01,610 --> 00:19:03,920
cated machines hosted in an isp that

428
00:19:03,920 --> 00:19:08,299
doesn't care or in machines that were

429
00:19:08,299 --> 00:19:09,980
compromised and the hosting provider

430
00:19:09,980 --> 00:19:11,900
doesn't notice that the machines were

431
00:19:11,900 --> 00:19:16,460
compromised so next up we looked at as I

432
00:19:16,460 --> 00:19:17,780
mentioned before the consecutive weeks

433
00:19:17,780 --> 00:19:22,250
and here the graph looked similar but I

434
00:19:22,250 --> 00:19:23,900
want to see the top level numbers for a

435
00:19:23,900 --> 00:19:26,900
change and we see saw tax summit IPS are

436
00:19:26,900 --> 00:19:29,000
attacking us for week after week nearly

437
00:19:29,000 --> 00:19:32,030
a year at a time we took a look at the

438
00:19:32,030 --> 00:19:33,890
most active eyepiece starting from the

439
00:19:33,890 --> 00:19:37,010
first one and decide just to look what

440
00:19:37,010 --> 00:19:39,440
exactly is going on a for so long in

441
00:19:39,440 --> 00:19:42,830
these machines and this is a screenshot

442
00:19:42,830 --> 00:19:45,980
from the public side of our honeypot

443
00:19:45,980 --> 00:19:48,440
providers website we'll talk about it in

444
00:19:48,440 --> 00:19:49,010
the end

445
00:19:49,010 --> 00:19:51,799
this is P is from China no large

446
00:19:51,799 --> 00:19:54,049
surprise there and from one of the

447
00:19:54,049 --> 00:19:56,870
larger ISPs and it's a bit hard to see

448
00:19:56,870 --> 00:19:58,880
here I'll take a closer look in a minute

449
00:19:58,880 --> 00:20:03,559
that this targets ms SQL servers now the

450
00:20:03,559 --> 00:20:05,600
title here is smaller ooh and for those

451
00:20:05,600 --> 00:20:08,419
of us who are not keeping up with bodman

452
00:20:08,419 --> 00:20:10,880
news and I don't blame you it's mom

453
00:20:10,880 --> 00:20:12,740
andrew is a long-running campaign over

454
00:20:12,740 --> 00:20:15,470
the last three years with many variants

455
00:20:15,470 --> 00:20:17,090
that's been covered by different

456
00:20:17,090 --> 00:20:19,490
security researchers for example hex man

457
00:20:19,490 --> 00:20:21,559
my kings and small Minoru most lately

458
00:20:21,559 --> 00:20:24,110
this bonnet compromises machines using

459
00:20:24,110 --> 00:20:26,150
the eternal blue exploit and brute

460
00:20:26,150 --> 00:20:27,919
forces credentials and various services

461
00:20:27,919 --> 00:20:31,370
such as ms SQL databases telnet and IOT

462
00:20:31,370 --> 00:20:33,640
devices remote desktops and more

463
00:20:33,640 --> 00:20:36,830
despondent makes money by crypto mining

464
00:20:36,830 --> 00:20:38,270
game or narrow currency Ahsan Khan

465
00:20:38,270 --> 00:20:41,419
remised servers a using this machines

466
00:20:41,419 --> 00:20:43,970
for DDoS attacks and selling access to

467
00:20:43,970 --> 00:20:47,990
different criminal groups the attackers

468
00:20:47,990 --> 00:20:49,490
in where will be a constant theme in

469
00:20:49,490 --> 00:20:51,230
this talk left part of their attack

470
00:20:51,230 --> 00:20:53,600
infrastructure wide open allowing us to

471
00:20:53,600 --> 00:20:56,030
read their attack logs and collect

472
00:20:56,030 --> 00:20:59,480
information we looked at it for a month

473
00:20:59,480 --> 00:21:02,780
and we started following some basic

474
00:21:02,780 --> 00:21:05,840
stats roughly 90,000 infections inside a

475
00:21:05,840 --> 00:21:07,520
single month from just scanning the

476
00:21:07,520 --> 00:21:10,010
internet and attacking a this came out

477
00:21:10,010 --> 00:21:13,419
to be roughly 5,000 infections per day

478
00:21:13,419 --> 00:21:15,500
interestingly Smallman ruin

479
00:21:15,500 --> 00:21:17,060
included a lateral movement component

480
00:21:17,060 --> 00:21:18,890
like a fear mentioned in the start and

481
00:21:18,890 --> 00:21:21,440
we found more than 5,000 networks were

482
00:21:21,440 --> 00:21:24,710
infected and after the attackers found

483
00:21:24,710 --> 00:21:27,290
and initially open hosts on the Internet

484
00:21:27,290 --> 00:21:31,310
and as an anecdote the most largest

485
00:21:31,310 --> 00:21:34,010
network we saw compromised had 65 hosts

486
00:21:34,010 --> 00:21:36,500
it was a small company in north of Italy

487
00:21:36,500 --> 00:21:39,650
and as I mentioned before many system

488
00:21:39,650 --> 00:21:42,140
administrators are not fools and they do

489
00:21:42,140 --> 00:21:43,940
notice that they were attacked and

490
00:21:43,940 --> 00:21:46,610
somebody took over their machines but

491
00:21:46,610 --> 00:21:48,740
many of them clean up the machines and

492
00:21:48,740 --> 00:21:52,610
didn't stop the vulnerability or exploit

493
00:21:52,610 --> 00:21:55,100
used to break in and we found more than

494
00:21:55,100 --> 00:21:56,510
a quarter of the hosts were infected

495
00:21:56,510 --> 00:21:58,130
more than once during the course of this

496
00:21:58,130 --> 00:22:00,140
month so system administrators are

497
00:22:00,140 --> 00:22:01,730
probably behind the scenes oh I found a

498
00:22:01,730 --> 00:22:05,300
virus eh let's clean it up but I'm not

499
00:22:05,300 --> 00:22:07,670
sure how it got in here so let's keep on

500
00:22:07,670 --> 00:22:08,930
doing the same thing over and over again

501
00:22:08,930 --> 00:22:11,480
I don't want to spend more time on this

502
00:22:11,480 --> 00:22:13,910
botnet because we wrote about it and

503
00:22:13,910 --> 00:22:15,590
other people wrote about it you can read

504
00:22:15,590 --> 00:22:18,170
here or the slides will upload and at

505
00:22:18,170 --> 00:22:20,500
this point fear

506
00:22:20,500 --> 00:22:23,750
thank you let's take 10 seconds to pray

507
00:22:23,750 --> 00:22:30,160
that my mic will work okay

508
00:22:30,160 --> 00:22:32,840
so Daniel spend some time talking about

509
00:22:32,840 --> 00:22:35,000
the attackers where they come from how

510
00:22:35,000 --> 00:22:37,610
frequently they operate now I'd like to

511
00:22:37,610 --> 00:22:39,650
dig in a little bit more to the post

512
00:22:39,650 --> 00:22:41,510
infection phase what do they do after

513
00:22:41,510 --> 00:22:44,780
the attackers are on the machine so as I

514
00:22:44,780 --> 00:22:46,250
mentioned before they tend to

515
00:22:46,250 --> 00:22:48,320
communicate back to external servers

516
00:22:48,320 --> 00:22:52,130
like command and control CNC and file

517
00:22:52,130 --> 00:22:54,710
hosting servers that host malicious

518
00:22:54,710 --> 00:22:57,530
payloads scripts that they need to run

519
00:22:57,530 --> 00:23:00,350
uninfected machines etc and we figured

520
00:23:00,350 --> 00:23:03,170
that if we study this behavior this post

521
00:23:03,170 --> 00:23:06,530
infection behavior maybe we can get to

522
00:23:06,530 --> 00:23:08,450
some more generalized indicators of

523
00:23:08,450 --> 00:23:11,030
compromised and managed to perhaps block

524
00:23:11,030 --> 00:23:13,700
malicious traffic performed from

525
00:23:13,700 --> 00:23:19,190
breached servers so we look at the

526
00:23:19,190 --> 00:23:21,260
attacks that we have in our database and

527
00:23:21,260 --> 00:23:24,170
we saw that 40% of the attacks included

528
00:23:24,170 --> 00:23:28,850
some kind of outgoing traffic where did

529
00:23:28,850 --> 00:23:29,870
the attack

530
00:23:29,870 --> 00:23:33,830
go outbound anyway so we see two main

531
00:23:33,830 --> 00:23:35,120
destinations

532
00:23:35,120 --> 00:23:37,670
the first is servers that the attackers

533
00:23:37,670 --> 00:23:39,770
compromised once again to function as

534
00:23:39,770 --> 00:23:42,560
command and controls or host malicious

535
00:23:42,560 --> 00:23:44,990
files and malicious payloads and the

536
00:23:44,990 --> 00:23:46,910
second destination which is also pretty

537
00:23:46,910 --> 00:23:49,550
popular is completely legitimate online

538
00:23:49,550 --> 00:23:52,250
services that the attacker is abused to

539
00:23:52,250 --> 00:23:54,560
store malicious payload so as you can

540
00:23:54,560 --> 00:23:57,530
see we see things like github Amazon s3

541
00:23:57,530 --> 00:24:00,140
buckets discord channels used to host

542
00:24:00,140 --> 00:24:05,180
files bitbucket and many others now as

543
00:24:05,180 --> 00:24:06,700
you can see in the examples below

544
00:24:06,700 --> 00:24:09,320
attackers use both IP addresses to

545
00:24:09,320 --> 00:24:12,380
connect back to their servers but they

546
00:24:12,380 --> 00:24:14,300
also use domains and we were interested

547
00:24:14,300 --> 00:24:16,880
in figuring out how often they use each

548
00:24:16,880 --> 00:24:19,460
one of those and whether they prefer one

549
00:24:19,460 --> 00:24:23,660
over the other so just to talk a little

550
00:24:23,660 --> 00:24:25,250
bit about the considerations when

551
00:24:25,250 --> 00:24:27,530
choosing IPs or domains

552
00:24:27,530 --> 00:24:29,570
when attackers or any other person

553
00:24:29,570 --> 00:24:31,580
chooses IPs they get to be anonymous

554
00:24:31,580 --> 00:24:33,230
right no personal information is

555
00:24:33,230 --> 00:24:35,780
registered with this the problems about

556
00:24:35,780 --> 00:24:39,170
IPs is that IP rotation is harder so if

557
00:24:39,170 --> 00:24:41,900
an attacker wants to for example post

558
00:24:41,900 --> 00:24:43,760
their files on a different server than

559
00:24:43,760 --> 00:24:46,460
they started with they will probably

560
00:24:46,460 --> 00:24:49,070
have to change many places and in their

561
00:24:49,070 --> 00:24:50,750
infrastructure so we're talking about

562
00:24:50,750 --> 00:24:52,940
hard-coded address or practically any

563
00:24:52,940 --> 00:24:56,690
place that points to the server also

564
00:24:56,690 --> 00:24:59,210
when using IPS encrypting the traffic is

565
00:24:59,210 --> 00:25:01,790
harder than we get with domains with

566
00:25:01,790 --> 00:25:04,430
domains we have SSL certificates which

567
00:25:04,430 --> 00:25:07,400
makes encryption easier also we have

568
00:25:07,400 --> 00:25:09,800
easier IP rotation because one single

569
00:25:09,800 --> 00:25:12,470
DNS record can point to can resolve too

570
00:25:12,470 --> 00:25:15,560
many IP addresses and we also gain

571
00:25:15,560 --> 00:25:17,840
another layer of redirection the DNS

572
00:25:17,840 --> 00:25:20,350
resolution itself is good for attackers

573
00:25:20,350 --> 00:25:23,540
the problems about domains is that they

574
00:25:23,540 --> 00:25:25,760
store personal information you need to

575
00:25:25,760 --> 00:25:27,980
give organization address when you

576
00:25:27,980 --> 00:25:29,870
register a domain and this information

577
00:25:29,870 --> 00:25:32,150
can be also backtracked so we can see

578
00:25:32,150 --> 00:25:35,330
which IP address is a DNS record

579
00:25:35,330 --> 00:25:39,770
resolved to over time so let's dig into

580
00:25:39,770 --> 00:25:41,920
the data and see what attackers prefer

581
00:25:41,920 --> 00:25:43,460
apparently when

582
00:25:43,460 --> 00:25:45,860
look at the file download operations we

583
00:25:45,860 --> 00:25:49,460
see 2/3 of the cases attackers use IP

584
00:25:49,460 --> 00:25:51,409
addresses so apparently they prefer

585
00:25:51,409 --> 00:25:55,429
being anonymous over the other benefits

586
00:25:55,429 --> 00:25:58,549
that domains give them only 1/3 of the

587
00:25:58,549 --> 00:26:01,100
file downloads are done with domain

588
00:26:01,100 --> 00:26:03,919
names another interesting question that

589
00:26:03,919 --> 00:26:07,070
we had is over which port numbers do

590
00:26:07,070 --> 00:26:09,919
attackers perform file downloads and

591
00:26:09,919 --> 00:26:13,399
this is what we figured out 95% of file

592
00:26:13,399 --> 00:26:16,309
downloads are done over traditional port

593
00:26:16,309 --> 00:26:20,260
numbers like FTP HTTP HTTPS and

594
00:26:20,260 --> 00:26:22,460
traditional web ports like you can see

595
00:26:22,460 --> 00:26:26,120
in the list below only 5% is done with

596
00:26:26,120 --> 00:26:30,409
some bizarre port numbers like 777 1 2 3

597
00:26:30,409 --> 00:26:33,610
4 you name all these weird port numbers

598
00:26:33,610 --> 00:26:36,620
so this kind of means that we cannot

599
00:26:36,620 --> 00:26:39,080
block malicious file downloads only by

600
00:26:39,080 --> 00:26:42,740
blocking traffic to weird-looking port

601
00:26:42,740 --> 00:26:46,279
numbers but I'd like to show some more

602
00:26:46,279 --> 00:26:49,460
comforting insight that we found we

603
00:26:49,460 --> 00:26:51,260
decided to look at the domain names to

604
00:26:51,260 --> 00:26:54,110
which attackers communicate and we

605
00:26:54,110 --> 00:26:56,120
listed all domain names that we see and

606
00:26:56,120 --> 00:26:58,220
we counted how many times each one

607
00:26:58,220 --> 00:27:00,830
appeared in the data set and to be

608
00:27:00,830 --> 00:27:03,080
honest we wanted to see which top-level

609
00:27:03,080 --> 00:27:05,270
domains were used by attackers so we

610
00:27:05,270 --> 00:27:08,899
actually zoomed in on this part on the

611
00:27:08,899 --> 00:27:13,580
TL DS and this is what we found

612
00:27:13,580 --> 00:27:16,580
so the topmost top most frequent

613
00:27:16,580 --> 00:27:18,559
top-level domains were dot-com and dark

614
00:27:18,559 --> 00:27:21,559
net but right after them appeared those

615
00:27:21,559 --> 00:27:25,429
till these that no one ever accesses

616
00:27:25,429 --> 00:27:30,830
like P W X Y Zed CC we don't think

617
00:27:30,830 --> 00:27:33,200
anything good comes from these top-level

618
00:27:33,200 --> 00:27:34,880
domains I'm sorry if there are any

619
00:27:34,880 --> 00:27:38,630
residents of the plow country which P W

620
00:27:38,630 --> 00:27:42,080
stands for so this means that blocking

621
00:27:42,080 --> 00:27:44,240
outgoing traffic from servers to these

622
00:27:44,240 --> 00:27:47,059
top-level domains will most likely block

623
00:27:47,059 --> 00:27:49,970
malicious traffic which is a pretty nice

624
00:27:49,970 --> 00:27:55,429
fact ok going back to the post infection

625
00:27:55,429 --> 00:27:57,470
phase we wanted to know how attack

626
00:27:57,470 --> 00:28:01,580
persist on machines I said that servers

627
00:28:01,580 --> 00:28:03,919
had long up times but this doesn't mean

628
00:28:03,919 --> 00:28:06,470
they're never rebooted and attackers do

629
00:28:06,470 --> 00:28:08,600
want to make sure that they survive

630
00:28:08,600 --> 00:28:11,809
reboots so what did they choose to

631
00:28:11,809 --> 00:28:14,750
persist I think we all know some very

632
00:28:14,750 --> 00:28:16,700
classical persistence methods here we

633
00:28:16,700 --> 00:28:18,350
see screenshots from Guardi core

634
00:28:18,350 --> 00:28:22,039
platform we see the classical registry

635
00:28:22,039 --> 00:28:26,389
run key persistence method persistent

636
00:28:26,389 --> 00:28:29,990
method right after it we see the

637
00:28:29,990 --> 00:28:32,779
creation of a user a backdoor user and

638
00:28:32,779 --> 00:28:34,669
how it's added to the administrators

639
00:28:34,669 --> 00:28:38,629
group to allow it for higher privileges

640
00:28:38,629 --> 00:28:42,259
on the machine lastly we see an example

641
00:28:42,259 --> 00:28:44,240
from Linux machines where attackers

642
00:28:44,240 --> 00:28:47,330
choose to create SSH keys for

643
00:28:47,330 --> 00:28:50,679
persistence and with regards to

644
00:28:50,679 --> 00:28:53,210
persistence methods we actually had two

645
00:28:53,210 --> 00:28:55,549
questions in mind this is a list of the

646
00:28:55,549 --> 00:28:57,620
persistence methods that we monitor in

647
00:28:57,620 --> 00:29:01,129
our honey pots we had two questions in

648
00:29:01,129 --> 00:29:03,409
mind the first one was how many methods

649
00:29:03,409 --> 00:29:05,120
are used within each attack the

650
00:29:05,120 --> 00:29:07,100
attackers use only one do they use all

651
00:29:07,100 --> 00:29:12,110
of them and the second question was what

652
00:29:12,110 --> 00:29:13,549
is the distribution like what is the

653
00:29:13,549 --> 00:29:15,320
most popular method what is the least

654
00:29:15,320 --> 00:29:18,019
popular method and we'll see both

655
00:29:18,019 --> 00:29:22,159
answers now so for the first question we

656
00:29:22,159 --> 00:29:25,730
saw that 65% the vast majority uses only

657
00:29:25,730 --> 00:29:27,860
one method this means that if this

658
00:29:27,860 --> 00:29:29,960
method is eliminated by some security

659
00:29:29,960 --> 00:29:32,299
product on the server machine they don't

660
00:29:32,299 --> 00:29:35,600
have any persistence anymore 33 percent

661
00:29:35,600 --> 00:29:38,690
of the attackers use exactly two methods

662
00:29:38,690 --> 00:29:41,330
to persistence methods this guarantees

663
00:29:41,330 --> 00:29:43,639
that even even if one method is

664
00:29:43,639 --> 00:29:46,759
eliminated they still persist on the

665
00:29:46,759 --> 00:29:49,490
machine we see two percent of the

666
00:29:49,490 --> 00:29:51,980
attackers used more than two persistence

667
00:29:51,980 --> 00:29:54,080
methods from the previous slide

668
00:29:54,080 --> 00:29:56,929
and we even see attackers use eight

669
00:29:56,929 --> 00:29:59,149
different persistence methods in one

670
00:29:59,149 --> 00:30:01,399
attack which is pretty interesting so

671
00:30:01,399 --> 00:30:05,379
they kind of shoot in all directions

672
00:30:05,529 --> 00:30:08,000
okay regarding the second question what

673
00:30:08,000 --> 00:30:10,039
is the most popular so I don't know if

674
00:30:10,039 --> 00:30:11,270
this is surprising

675
00:30:11,270 --> 00:30:14,420
the registry bran key is still the most

676
00:30:14,420 --> 00:30:16,160
popular among the attacks that we

677
00:30:16,160 --> 00:30:19,130
observe right after it we have the W my

678
00:30:19,130 --> 00:30:22,820
persistence I don't know if all of you

679
00:30:22,820 --> 00:30:25,450
know it so I'll give a quick explanation

680
00:30:25,450 --> 00:30:28,190
this is a persistence method on Windows

681
00:30:28,190 --> 00:30:31,040
where attackers create a consumer object

682
00:30:31,040 --> 00:30:33,110
which is the action to be performed and

683
00:30:33,110 --> 00:30:36,530
they tie it with some event some

684
00:30:36,530 --> 00:30:38,450
operating system event this can be the

685
00:30:38,450 --> 00:30:39,110
timer

686
00:30:39,110 --> 00:30:41,570
this can be log on any other trigger and

687
00:30:41,570 --> 00:30:44,330
this is how they can run their malicious

688
00:30:44,330 --> 00:30:47,450
processes processes when different

689
00:30:47,450 --> 00:30:51,740
triggers occur so these are the biggest

690
00:30:51,740 --> 00:30:54,200
chunks in this pie chart right but to

691
00:30:54,200 --> 00:30:56,330
find the really interesting incidents we

692
00:30:56,330 --> 00:30:58,790
wanted to look at the minority of the of

693
00:30:58,790 --> 00:31:01,250
the attacks and we decided to look at

694
00:31:01,250 --> 00:31:06,650
the 1% of driver creations so we simply

695
00:31:06,650 --> 00:31:08,929
listed all the drivers we see created

696
00:31:08,929 --> 00:31:12,320
and loaded in attack incidents at the

697
00:31:12,320 --> 00:31:15,320
first place you can see NP F this is net

698
00:31:15,320 --> 00:31:18,140
packet filter it is very interesting but

699
00:31:18,140 --> 00:31:21,520
it's well known we decided not to

700
00:31:21,520 --> 00:31:24,320
concentrate on this this driver is

701
00:31:24,320 --> 00:31:27,290
usually used what attackers want to

702
00:31:27,290 --> 00:31:30,880
either sniff the network on breached

703
00:31:30,880 --> 00:31:34,280
servers or when they want to scan the

704
00:31:34,280 --> 00:31:36,380
network to propagate and to move

705
00:31:36,380 --> 00:31:41,090
laterally the next driver on this list

706
00:31:41,090 --> 00:31:42,500
is what we actually found very

707
00:31:42,500 --> 00:31:47,030
interesting this is si 6 4 8 2 and this

708
00:31:47,030 --> 00:31:50,270
is a driver used in the nan Chu campaign

709
00:31:50,270 --> 00:31:54,290
that we uncovered around 5 months ago so

710
00:31:54,290 --> 00:31:56,750
from a first glance this may look like a

711
00:31:56,750 --> 00:32:00,350
regular crypto minor botnet but actually

712
00:32:00,350 --> 00:32:02,200
we found it pretty interesting because

713
00:32:02,200 --> 00:32:05,360
except the crypto minor which is pretty

714
00:32:05,360 --> 00:32:08,540
regular this attack group was using both

715
00:32:08,540 --> 00:32:11,870
a driver and two versions of Windows

716
00:32:11,870 --> 00:32:15,980
kernel exploits here you can see a

717
00:32:15,980 --> 00:32:17,450
screenshot once again from Guardi core

718
00:32:17,450 --> 00:32:19,130
platform and we can see how the attacker

719
00:32:19,130 --> 00:32:21,770
downloads and executes the windows

720
00:32:21,770 --> 00:32:24,320
exploits and the loading of the driver

721
00:32:24,320 --> 00:32:25,080
you can

722
00:32:25,080 --> 00:32:28,169
the name that we saw before what is so

723
00:32:28,169 --> 00:32:30,749
unique about a driver being used in a

724
00:32:30,749 --> 00:32:35,580
crypto mining attack so recent versions

725
00:32:35,580 --> 00:32:37,710
of Windows require every driver which is

726
00:32:37,710 --> 00:32:40,019
loaded into kernel mode to be signed

727
00:32:40,019 --> 00:32:43,080
with a digital certificate and for

728
00:32:43,080 --> 00:32:44,940
attackers to have such a certificate

729
00:32:44,940 --> 00:32:46,649
they need to do one of two things either

730
00:32:46,649 --> 00:32:49,619
steal a certificate or create some fake

731
00:32:49,619 --> 00:32:52,080
company and convince a certificate

732
00:32:52,080 --> 00:32:54,470
authority that they're worthy of

733
00:32:54,470 --> 00:32:58,289
certificates this is not a very trivial

734
00:32:58,289 --> 00:33:01,230
operation and we thought we'd see it

735
00:33:01,230 --> 00:33:02,869
with higher end attackers like

736
00:33:02,869 --> 00:33:05,730
nation-states and more advanced attack

737
00:33:05,730 --> 00:33:07,649
groups but apparently even common

738
00:33:07,649 --> 00:33:10,350
criminals are getting ahead and they're

739
00:33:10,350 --> 00:33:13,519
starting to use some advanced techniques

740
00:33:13,519 --> 00:33:18,720
to get a better look at the driver that

741
00:33:18,720 --> 00:33:20,609
is used in an qu we can see here the

742
00:33:20,609 --> 00:33:23,759
digital certificate the company name

743
00:33:23,759 --> 00:33:25,559
I'll read it for you hang zooty and

744
00:33:25,559 --> 00:33:26,909
network technology this is a

745
00:33:26,909 --> 00:33:28,859
non-existent company they just made it

746
00:33:28,859 --> 00:33:31,679
up and apparently they made Verisign

747
00:33:31,679 --> 00:33:35,279
give them this digital certificate I'll

748
00:33:35,279 --> 00:33:37,769
spoil a little and say that the driver

749
00:33:37,769 --> 00:33:40,230
was used to protect the crypto mining

750
00:33:40,230 --> 00:33:44,249
process so even a very aware user that

751
00:33:44,249 --> 00:33:47,159
saw this crypto minor running would not

752
00:33:47,159 --> 00:33:48,899
be able to just kill it because this

753
00:33:48,899 --> 00:33:50,669
driver would protect it using the

754
00:33:50,669 --> 00:33:56,220
process ID Daniel promised death the

755
00:33:56,220 --> 00:33:59,429
open infrastructure is a repeating theme

756
00:33:59,429 --> 00:34:01,889
in this talk and even an Xu attackers

757
00:34:01,889 --> 00:34:04,769
left their infrastructure open for us to

758
00:34:04,769 --> 00:34:08,010
investigate which I personally loved and

759
00:34:08,010 --> 00:34:10,859
we saw that during the times kind of one

760
00:34:10,859 --> 00:34:13,530
month only they doubled the number of

761
00:34:13,530 --> 00:34:15,809
infected machines they reached and they

762
00:34:15,809 --> 00:34:18,510
basically reached almost 50,000 machines

763
00:34:18,510 --> 00:34:19,440
on the Internet

764
00:34:19,440 --> 00:34:26,299
running ms SQL servers and PHP myadmin

765
00:34:27,049 --> 00:34:30,049
Daniel

766
00:34:33,480 --> 00:34:38,460
great so now we see different we saw

767
00:34:38,460 --> 00:34:40,770
different a persistence methods but why

768
00:34:40,770 --> 00:34:43,980
do we need so many and the reason comes

769
00:34:43,980 --> 00:34:45,300
back to that criminal groups are

770
00:34:45,300 --> 00:34:47,820
commercial enterprises they want to make

771
00:34:47,820 --> 00:34:51,210
money and the malware space is just as

772
00:34:51,210 --> 00:34:53,250
competitive as many other sectors of the

773
00:34:53,250 --> 00:34:56,879
economy and attackers need to find ways

774
00:34:56,879 --> 00:34:59,160
to stand out from each other in terms of

775
00:34:59,160 --> 00:35:02,010
how they take over machines and the

776
00:35:02,010 --> 00:35:03,300
reason for that is simple

777
00:35:03,300 --> 00:35:05,369
the Internet's very large but there's a

778
00:35:05,369 --> 00:35:07,230
large but limited number of vulnerable

779
00:35:07,230 --> 00:35:10,590
servers online each one is worth money

780
00:35:10,590 --> 00:35:12,480
they can use these machines to make

781
00:35:12,480 --> 00:35:15,300
whether by using an infra cryptocurrency

782
00:35:15,300 --> 00:35:17,910
by selling the access ransom wearing the

783
00:35:17,910 --> 00:35:20,760
data you can't just have take over a box

784
00:35:20,760 --> 00:35:22,950
and get kicked out by the next attacker

785
00:35:22,950 --> 00:35:26,130
who wants to use it to my Manero or

786
00:35:26,130 --> 00:35:28,230
while you're mining cryptocurrency have

787
00:35:28,230 --> 00:35:30,810
somebody come in and destroy the box by

788
00:35:30,810 --> 00:35:33,630
ransom wearing the data on it so

789
00:35:33,630 --> 00:35:35,730
attackers are faced with problems how do

790
00:35:35,730 --> 00:35:38,700
I block hostile takeovers I got on a box

791
00:35:38,700 --> 00:35:40,369
and how do I prevent it the next a

792
00:35:40,369 --> 00:35:42,690
automated attack after me gonna come in

793
00:35:42,690 --> 00:35:45,840
and kick me off we've seen a variety of

794
00:35:45,840 --> 00:35:47,910
techniques used I'm gonna show a few of

795
00:35:47,910 --> 00:35:51,840
them now if one is let's block how you

796
00:35:51,840 --> 00:35:54,030
got in if you got in for example using

797
00:35:54,030 --> 00:35:56,160
the eternal blue vulnerability over SMB

798
00:35:56,160 --> 00:35:58,500
then what we see here is meta sage

799
00:35:58,500 --> 00:36:01,140
Windows Firewall a commands to block the

800
00:36:01,140 --> 00:36:04,020
SMB and RPC ports and a few others are

801
00:36:04,020 --> 00:36:06,090
emitted from this listing basically

802
00:36:06,090 --> 00:36:08,340
meaning I got in nobody else gets in

803
00:36:08,340 --> 00:36:12,000
right after me let's bar the door and a

804
00:36:12,000 --> 00:36:14,850
side-effect from this is that defenders

805
00:36:14,850 --> 00:36:16,530
have a harder time of monitoring their

806
00:36:16,530 --> 00:36:18,840
boxes because most monitoring tools

807
00:36:18,840 --> 00:36:22,619
still work over our PC or a SMB to

808
00:36:22,619 --> 00:36:24,540
access the Machine and collect

809
00:36:24,540 --> 00:36:26,640
information so they not only blocked

810
00:36:26,640 --> 00:36:28,200
other attackers but they also blocked

811
00:36:28,200 --> 00:36:32,460
the basic tool used by defenders this is

812
00:36:32,460 --> 00:36:34,830
pretty neat but most attackers go for

813
00:36:34,830 --> 00:36:37,260
something a lot simpler this is just a

814
00:36:37,260 --> 00:36:39,359
very very very long task kill command

815
00:36:39,359 --> 00:36:41,340
that I cut out because it got way too

816
00:36:41,340 --> 00:36:43,890
long and here you can see the attackers

817
00:36:43,890 --> 00:36:46,200
deleting killing other crypto miners

818
00:36:46,200 --> 00:36:47,010
other

819
00:36:47,010 --> 00:36:49,560
doors other Trojans registry editing

820
00:36:49,560 --> 00:36:50,820
tools and pretty much everything they

821
00:36:50,820 --> 00:36:53,010
can think of that can cause problems for

822
00:36:53,010 --> 00:36:56,640
them and this is noisy but it's

823
00:36:56,640 --> 00:37:00,930
effective and if you kill this then this

824
00:37:00,930 --> 00:37:02,760
is why attackers use persistence methods

825
00:37:02,760 --> 00:37:05,280
or they leave backdoors in so some

826
00:37:05,280 --> 00:37:07,940
attackers go that step further and

827
00:37:07,940 --> 00:37:10,500
they're gonna kill other users backdoors

828
00:37:10,500 --> 00:37:12,870
other criminal groups what we see here

829
00:37:12,870 --> 00:37:15,390
is ms SQL commands to change the

830
00:37:15,390 --> 00:37:17,040
password of different users to this

831
00:37:17,040 --> 00:37:20,460
random jumble of letters and the right

832
00:37:20,460 --> 00:37:24,140
side is you can see SZ SS s e and

833
00:37:24,140 --> 00:37:26,100
obviously this list was a long longer

834
00:37:26,100 --> 00:37:28,230
and these are user names we found

835
00:37:28,230 --> 00:37:31,110
created by other criminal groups and the

836
00:37:31,110 --> 00:37:32,760
reasons they picked these names is

837
00:37:32,760 --> 00:37:34,920
because in ms SQL the system

838
00:37:34,920 --> 00:37:37,680
administrator user is si and these names

839
00:37:37,680 --> 00:37:38,990
sound familiar

840
00:37:38,990 --> 00:37:42,210
so attackers end up pretty much

841
00:37:42,210 --> 00:37:43,950
competing over the same limited amount

842
00:37:43,950 --> 00:37:50,040
of servers so as a short summary and we

843
00:37:50,040 --> 00:37:51,660
want to say that I'm targeted attacks

844
00:37:51,660 --> 00:37:53,340
are a lot more than just a mere I

845
00:37:53,340 --> 00:37:55,350
look-alikes and ransomware worms we've

846
00:37:55,350 --> 00:37:57,390
been seeing the last few years such as

847
00:37:57,390 --> 00:38:00,320
wanna cry or the classic DDoS botnets

848
00:38:00,320 --> 00:38:03,390
they make money from in multiple methods

849
00:38:03,390 --> 00:38:06,060
and though cryptocurrency is by far the

850
00:38:06,060 --> 00:38:08,520
biggest one there's a large amount of

851
00:38:08,520 --> 00:38:10,890
determined actors working and developing

852
00:38:10,890 --> 00:38:13,350
infrastructure in this space and there's

853
00:38:13,350 --> 00:38:16,170
a lot more victims than you think we

854
00:38:16,170 --> 00:38:18,210
found little to no overlap between the

855
00:38:18,210 --> 00:38:20,520
two campaigns we presented here in turn

856
00:38:20,520 --> 00:38:23,370
in the list of victims there's pretty

857
00:38:23,370 --> 00:38:26,400
much millions of computers of accessible

858
00:38:26,400 --> 00:38:31,050
online with really bad security all the

859
00:38:31,050 --> 00:38:33,690
data that we presented here is available

860
00:38:33,690 --> 00:38:36,360
for free on our website we put up you

861
00:38:36,360 --> 00:38:39,240
can go there check any IP that we found

862
00:38:39,240 --> 00:38:41,820
in our collection any domain just go

863
00:38:41,820 --> 00:38:44,280
right there and then and then cert some

864
00:38:44,280 --> 00:38:47,430
IPS if you have information it tell us

865
00:38:47,430 --> 00:38:48,000
about it

866
00:38:48,000 --> 00:38:49,890
it went it's talked on a bit of a

867
00:38:49,890 --> 00:38:51,900
lighter note I'm gonna let a fear talk a

868
00:38:51,900 --> 00:38:56,730
bit about some mistakes we found I got a

869
00:38:56,730 --> 00:38:59,730
first ask if someone tried the QR code

870
00:38:59,730 --> 00:39:00,569
and managed

871
00:39:00,569 --> 00:39:03,419
- yeah it works okay yay I didn't test

872
00:39:03,419 --> 00:39:05,119
it

873
00:39:05,119 --> 00:39:11,669
where's my clicker thankfully okay so

874
00:39:11,669 --> 00:39:14,939
the fun part the mistakes that attackers

875
00:39:14,939 --> 00:39:18,179
make first of all Daniel described our

876
00:39:18,179 --> 00:39:20,969
honey pots what service providers they

877
00:39:20,969 --> 00:39:23,729
have what we can imitate and it seems

878
00:39:23,729 --> 00:39:25,559
like attackers are expecting more than

879
00:39:25,559 --> 00:39:27,900
we can offer them so for example they're

880
00:39:27,900 --> 00:39:31,140
trying to run stuff like fetch TFTP curl

881
00:39:31,140 --> 00:39:36,599
docker god knows why yeah also they

882
00:39:36,599 --> 00:39:39,209
don't seem to check on which Linux

883
00:39:39,209 --> 00:39:41,369
distribution they're running on so

884
00:39:41,369 --> 00:39:43,079
they're trying the young package manager

885
00:39:43,079 --> 00:39:45,359
where what we can actually give them is

886
00:39:45,359 --> 00:39:49,829
the apt package manager next we need to

887
00:39:49,829 --> 00:39:51,599
remember that attackers are human beings

888
00:39:51,599 --> 00:39:53,549
as well they have human errors they have

889
00:39:53,549 --> 00:39:56,279
typos they confuse sometimes and we can

890
00:39:56,279 --> 00:39:58,739
see two examples here so on the top we

891
00:39:58,739 --> 00:40:02,669
see an invalid IP used to fetch the

892
00:40:02,669 --> 00:40:04,380
Windows exploit that I talked about

893
00:40:04,380 --> 00:40:06,900
before this command will obviously not

894
00:40:06,900 --> 00:40:08,819
work the attackers had to fix their

895
00:40:08,819 --> 00:40:11,400
scripts and we actually saw this being

896
00:40:11,400 --> 00:40:15,749
fixed after a couple of days next on the

897
00:40:15,749 --> 00:40:17,509
slides we see how they confuse

898
00:40:17,509 --> 00:40:19,739
command-line parameters here they're

899
00:40:19,739 --> 00:40:22,709
trying to run their crypto minor this is

900
00:40:22,709 --> 00:40:24,900
actually the correct way of doing this

901
00:40:24,900 --> 00:40:27,449
you being the wallet address to which

902
00:40:27,449 --> 00:40:30,929
we're mining coins and the peeper

903
00:40:30,929 --> 00:40:32,699
ammeter is the credentials used to

904
00:40:32,699 --> 00:40:35,729
connect to the pool on the right is how

905
00:40:35,729 --> 00:40:37,949
they actually ran this command line

906
00:40:37,949 --> 00:40:40,829
which is exactly the opposite of what

907
00:40:40,829 --> 00:40:43,049
they should you have to understand that

908
00:40:43,049 --> 00:40:45,059
running the miner this way will not

909
00:40:45,059 --> 00:40:48,449
produce even a single dollar or yeah

910
00:40:48,449 --> 00:40:52,709
Bitcoin or Manero for these attackers so

911
00:40:52,709 --> 00:40:57,359
this is completely useless to wrap

912
00:40:57,359 --> 00:40:58,999
everything up this is my favorite

913
00:40:58,999 --> 00:41:02,249
mistake of all leaving the server's wide

914
00:41:02,249 --> 00:41:04,559
open for security researchers like

915
00:41:04,559 --> 00:41:07,319
ourselves to investigate this is the nan

916
00:41:07,319 --> 00:41:09,779
Chu file server here they stored all the

917
00:41:09,779 --> 00:41:12,659
all their files HTTP file server

918
00:41:12,659 --> 00:41:14,130
HFS as you

919
00:41:14,130 --> 00:41:16,079
can see the full file listing of what

920
00:41:16,079 --> 00:41:18,839
the attackers were using when each file

921
00:41:18,839 --> 00:41:21,000
was uploaded to the server and how many

922
00:41:21,000 --> 00:41:24,059
times it was downloaded and this is very

923
00:41:24,059 --> 00:41:26,250
nice we monitored these numbers for

924
00:41:26,250 --> 00:41:28,619
about a month and we actually got to

925
00:41:28,619 --> 00:41:30,720
find out how widespread this campaign

926
00:41:30,720 --> 00:41:34,019
was this is the graph I showed you

927
00:41:34,019 --> 00:41:37,470
before so yeah these are some attackers

928
00:41:37,470 --> 00:41:39,960
mistakes and thank you so much for being

929
00:41:39,960 --> 00:41:42,089
with us I hope you enjoy this talk I

930
00:41:42,089 --> 00:41:59,130
think can we take questions or later and

931
00:41:59,130 --> 00:42:02,789
now's the time otherwise we'll be in the

932
00:42:02,789 --> 00:42:03,750
speaker lounge well if anybody has

933
00:42:03,750 --> 00:42:08,880
questions we still have some time okay

934
00:42:08,880 --> 00:42:12,150
so if anybody still wants to ask us but

935
00:42:12,150 --> 00:42:14,069
not up here we'll be outside thank you

936
00:42:14,069 --> 00:42:16,400
very much

