1
00:00:00,030 --> 00:00:10,290
thank you thank you hi everyone thank

2
00:00:08,099 --> 00:00:11,820
you for joining in before I start just

3
00:00:10,290 --> 00:00:13,590
want to give a quick shout out to hack

4
00:00:11,820 --> 00:00:16,830
fests for having me here

5
00:00:13,590 --> 00:00:18,750
I live with my first act first and I'm

6
00:00:16,830 --> 00:00:20,189
absolutely loving it but that might

7
00:00:18,750 --> 00:00:23,789
change depending on if you get my jokes

8
00:00:20,189 --> 00:00:26,609
or not I also want to give a shout out

9
00:00:23,789 --> 00:00:29,789
to one of my ex-colleague Nick who also

10
00:00:26,609 --> 00:00:31,759
contributed to this research his name

11
00:00:29,789 --> 00:00:36,140
and handle is down there

12
00:00:31,759 --> 00:00:39,809
but yeah he couldn't be here priorities

13
00:00:36,140 --> 00:00:40,320
I am sorry parrot goes by the handle 0x

14
00:00:39,809 --> 00:00:42,390
Wahby

15
00:00:40,320 --> 00:00:44,190
I will get mandiant and much like

16
00:00:42,390 --> 00:00:46,920
everyone else these days I'm also at

17
00:00:44,190 --> 00:00:48,989
gmail because it's been trending a lot I

18
00:00:46,920 --> 00:00:50,640
also like to call myself a wannabe

19
00:00:48,989 --> 00:00:53,099
reverse engineer because I started my

20
00:00:50,640 --> 00:00:56,660
career as a reverse engineer but I don't

21
00:00:53,100 --> 00:00:56,660
get to do that very often these days

22
00:00:58,430 --> 00:01:02,969
this is what the agenda for the talk

23
00:01:00,600 --> 00:01:05,129
looks like I have first five topics to

24
00:01:02,969 --> 00:01:07,490
kill time and then I'll jump into case

25
00:01:05,129 --> 00:01:09,420
studies where where I'll talk about

26
00:01:07,490 --> 00:01:12,600
different vulnerabilities that we

27
00:01:09,420 --> 00:01:14,850
discovered in to medical devices in a

28
00:01:12,600 --> 00:01:16,979
typical InfoSec style presentation I

29
00:01:14,850 --> 00:01:18,770
won't be providing any solution to any

30
00:01:16,979 --> 00:01:21,119
of the problems I'll talk about today

31
00:01:18,770 --> 00:01:27,090
but there will be some very generic

32
00:01:21,119 --> 00:01:29,400
remarks in the end just wanted to have a

33
00:01:27,090 --> 00:01:31,020
disclaimer at the beginning of the of

34
00:01:29,400 --> 00:01:33,659
the talk the talk is not about

35
00:01:31,020 --> 00:01:38,100
bad-mouthing anyone so I won't be naming

36
00:01:33,659 --> 00:01:39,689
any vendors or device names also FDA was

37
00:01:38,100 --> 00:01:42,270
breathing down on my neck also these

38
00:01:39,689 --> 00:01:45,059
devices are installed or deployed at

39
00:01:42,270 --> 00:01:47,789
different medical institutions so with

40
00:01:45,060 --> 00:01:49,590
that I already I apologize for heavily

41
00:01:47,790 --> 00:01:55,020
redacted screenshots that are coming up

42
00:01:49,590 --> 00:01:56,820
that might put NSA to shame so a little

43
00:01:55,020 --> 00:01:58,979
bit about connected healthcare devices

44
00:01:56,820 --> 00:02:01,439
they are well connected they could be

45
00:01:58,979 --> 00:02:03,329
connected to a private network that

46
00:02:01,439 --> 00:02:06,270
could be connected to internet they can

47
00:02:03,329 --> 00:02:10,288
talk on different protocols like Wi-Fi

48
00:02:06,270 --> 00:02:12,959
lo5 SiC B and so on and they fall under

49
00:02:10,288 --> 00:02:13,950
the umbrella of IOT devices which is the

50
00:02:12,959 --> 00:02:15,870
bigger umbrella

51
00:02:13,950 --> 00:02:18,480
and there are tons of IOT devices out

52
00:02:15,870 --> 00:02:20,010
there and which is becoming a problem

53
00:02:18,480 --> 00:02:22,350
because they're just coming out in the

54
00:02:20,010 --> 00:02:24,870
market and they aren't much security

55
00:02:22,350 --> 00:02:27,180
features built into those devices and

56
00:02:24,870 --> 00:02:29,280
also the fact that like medical

57
00:02:27,180 --> 00:02:31,860
connected devices I get I get why

58
00:02:29,280 --> 00:02:34,050
there's a need for those devices but at

59
00:02:31,860 --> 00:02:36,540
the same time there are other IOT

60
00:02:34,050 --> 00:02:40,530
devices that I just don't get behind the

61
00:02:36,540 --> 00:02:42,239
like your things like your fridge

62
00:02:40,530 --> 00:02:43,380
connected to internet your toaster

63
00:02:42,240 --> 00:02:44,820
connected to internet or washing

64
00:02:43,380 --> 00:02:46,410
machines so like let's just think about

65
00:02:44,820 --> 00:02:48,269
this for a moment let's just assume that

66
00:02:46,410 --> 00:02:50,160
I have an Internet connected washing

67
00:02:48,270 --> 00:02:51,840
machine right so like how it would go

68
00:02:50,160 --> 00:02:54,000
down is like I'll take my dirty laundry

69
00:02:51,840 --> 00:02:56,520
put it in the machine and at that moment

70
00:02:54,000 --> 00:02:59,550
I can make a decision to just press that

71
00:02:56,520 --> 00:03:01,170
big red button right there or I can run

72
00:02:59,550 --> 00:03:02,820
to my basement log onto my laptop

73
00:03:01,170 --> 00:03:05,820
connect to the washing machine over

74
00:03:02,820 --> 00:03:07,500
Wi-Fi and then started and because I'm

75
00:03:05,820 --> 00:03:09,690
an idiot I'm not wondering did it even

76
00:03:07,500 --> 00:03:14,060
work so like I'll run back upstairs to

77
00:03:09,690 --> 00:03:14,060
see if it works alike yeah tough choice

78
00:03:15,800 --> 00:03:21,150
so I've tried to classify medical

79
00:03:19,200 --> 00:03:23,160
devices into five different categories

80
00:03:21,150 --> 00:03:24,840
and the first one is consumer variables

81
00:03:23,160 --> 00:03:27,870
which is which you would be mushroomy

82
00:03:24,840 --> 00:03:29,910
livid so these are your fitness trackers

83
00:03:27,870 --> 00:03:31,860
sleep man sleep pattern monitors and so

84
00:03:29,910 --> 00:03:34,709
on then they're patient monitoring

85
00:03:31,860 --> 00:03:37,799
devices which are your insulin pumps

86
00:03:34,709 --> 00:03:39,720
blood pressure monitors then there are

87
00:03:37,799 --> 00:03:42,600
something called IV D on in vitro

88
00:03:39,720 --> 00:03:44,640
medical devices and your HIV detection

89
00:03:42,600 --> 00:03:47,040
systems blood analyzers fall in that

90
00:03:44,640 --> 00:03:49,768
category and so all the devices that

91
00:03:47,040 --> 00:03:52,350
I've talked about so far are external to

92
00:03:49,769 --> 00:03:54,660
a patient's body hopefully and then

93
00:03:52,350 --> 00:03:57,000
their devices which are embedded into

94
00:03:54,660 --> 00:03:59,150
patient's body so pacemaker would be the

95
00:03:57,000 --> 00:04:03,209
most common example of those devices and

96
00:03:59,150 --> 00:04:05,160
and then the devices which you see at

97
00:04:03,209 --> 00:04:07,230
hospitals and medical institutions which

98
00:04:05,160 --> 00:04:09,900
are like bulky stay steady equipment

99
00:04:07,230 --> 00:04:12,828
like medical dispensing system MRI

100
00:04:09,900 --> 00:04:15,540
machine CT scanner x-ray machines and

101
00:04:12,829 --> 00:04:17,700
some of these devices that fall under

102
00:04:15,540 --> 00:04:20,880
this in-house equipment category they

103
00:04:17,700 --> 00:04:23,219
are also referred to as legacy devices

104
00:04:20,880 --> 00:04:25,890
in the sense that they were never meant

105
00:04:23,220 --> 00:04:27,449
to be connected to a network but because

106
00:04:25,890 --> 00:04:30,060
everyone is connecting everything

107
00:04:27,449 --> 00:04:31,710
so why not these devices as well and so

108
00:04:30,060 --> 00:04:33,509
I'll talk about in a bit how these

109
00:04:31,710 --> 00:04:36,599
devices are connected to a network and

110
00:04:33,509 --> 00:04:41,550
what kind of risk is then exposed from

111
00:04:36,599 --> 00:04:43,800
these devices so this is what the data

112
00:04:41,550 --> 00:04:45,840
loop of a typical connected medical

113
00:04:43,800 --> 00:04:48,389
device looks like so the device in

114
00:04:45,840 --> 00:04:51,150
itself is in constant monitoring mode

115
00:04:48,389 --> 00:04:53,069
using the sensor and then in case it

116
00:04:51,150 --> 00:04:55,258
detects an event it creates a trigger

117
00:04:53,069 --> 00:04:57,689
trigger using the onboard ship which

118
00:04:55,259 --> 00:05:00,150
takes an action and then the data is

119
00:04:57,689 --> 00:05:02,159
aggregated and analyzed and I think that

120
00:05:00,150 --> 00:05:04,500
the part where the data is aggregated

121
00:05:02,159 --> 00:05:06,960
and analyzed is going to be the key for

122
00:05:04,500 --> 00:05:09,029
connected medical devices because that

123
00:05:06,960 --> 00:05:11,008
data can then be used by device

124
00:05:09,029 --> 00:05:12,539
manufacturers medical practitioners to

125
00:05:11,009 --> 00:05:15,330
provide a better experience for the

126
00:05:12,539 --> 00:05:17,099
patient so if you take example of a

127
00:05:15,330 --> 00:05:19,710
simple insulin pump it constantly

128
00:05:17,099 --> 00:05:21,419
monitors the patient's insulin level and

129
00:05:19,710 --> 00:05:23,460
if it sees there's a drop in patient's

130
00:05:21,419 --> 00:05:26,520
insulin level that then it uses the

131
00:05:23,460 --> 00:05:28,258
onboard ship to inject insulin in

132
00:05:26,520 --> 00:05:30,599
patients body which is done using the

133
00:05:28,259 --> 00:05:32,939
catheter that is usually placed under

134
00:05:30,599 --> 00:05:37,770
patients skin and then that data is

135
00:05:32,939 --> 00:05:40,259
aggregated and analyzed so in terms of

136
00:05:37,770 --> 00:05:43,948
architecture the medical device itself

137
00:05:40,259 --> 00:05:46,710
which is on my side has a lot of

138
00:05:43,949 --> 00:05:49,110
subsystems as I mentioned it can talk

139
00:05:46,710 --> 00:05:51,020
over a lot of different protocols it

140
00:05:49,110 --> 00:05:55,319
would have in sensors and actuators to

141
00:05:51,020 --> 00:05:57,740
detect a variation in pattern it would

142
00:05:55,319 --> 00:06:00,389
have a display it might have a location

143
00:05:57,740 --> 00:06:02,909
tracker like if it's the device that's

144
00:06:00,389 --> 00:06:06,120
monitoring your your location tracking

145
00:06:02,909 --> 00:06:08,490
your steps and so on survive association

146
00:06:06,120 --> 00:06:10,589
is the module that handles the

147
00:06:08,490 --> 00:06:14,610
authentication and authorization of a

148
00:06:10,589 --> 00:06:17,069
device to different connected systems it

149
00:06:14,610 --> 00:06:19,889
would have the small storage to store

150
00:06:17,069 --> 00:06:22,560
data temporarily event architecture is

151
00:06:19,889 --> 00:06:25,319
the key module which basically takes

152
00:06:22,560 --> 00:06:28,199
data and then creates an event based on

153
00:06:25,319 --> 00:06:30,750
that data and then for some of the

154
00:06:28,199 --> 00:06:32,189
devices are well actually most of the

155
00:06:30,750 --> 00:06:34,020
connected medical devices there will be

156
00:06:32,189 --> 00:06:36,000
some sort of command and control module

157
00:06:34,020 --> 00:06:38,099
which would allow manufacturers to

158
00:06:36,000 --> 00:06:40,769
remotely maintain the device and upgrade

159
00:06:38,099 --> 00:06:41,289
it and so on could also be used by the

160
00:06:40,769 --> 00:06:44,259
attacker

161
00:06:41,289 --> 00:06:46,509
sometimes then there's middleware and

162
00:06:44,259 --> 00:06:47,919
you can think of middleware as the

163
00:06:46,509 --> 00:06:50,680
application server for your medical

164
00:06:47,919 --> 00:06:53,248
device and that has most of the logic

165
00:06:50,680 --> 00:06:56,649
for for authentication authorization

166
00:06:53,249 --> 00:06:59,050
remote access and so on but the most

167
00:06:56,649 --> 00:07:00,909
important part of middleware is going to

168
00:06:59,050 --> 00:07:03,819
be the storage processing in order to

169
00:07:00,909 --> 00:07:07,360
the data storage part of it because that

170
00:07:03,819 --> 00:07:09,159
module takes or aggregates data from all

171
00:07:07,360 --> 00:07:12,729
these different medical devices and then

172
00:07:09,159 --> 00:07:15,279
outputs a consumable data which then can

173
00:07:12,729 --> 00:07:17,889
be fed into like different different

174
00:07:15,279 --> 00:07:19,869
kind of portals so device manufacturers

175
00:07:17,889 --> 00:07:21,580
can access that data to see how the

176
00:07:19,869 --> 00:07:24,039
device is behaving in different

177
00:07:21,580 --> 00:07:26,709
scenarios and then better the device you

178
00:07:24,039 --> 00:07:29,498
think that data can be used by security

179
00:07:26,709 --> 00:07:31,719
researcher across the globe can be used

180
00:07:29,499 --> 00:07:33,819
by our doctors to take preventative

181
00:07:31,719 --> 00:07:39,248
measures based on your condition and so

182
00:07:33,819 --> 00:07:40,959
on and so forth up so why do we need

183
00:07:39,249 --> 00:07:43,059
connected medical devices and there are

184
00:07:40,959 --> 00:07:44,439
several reasons behind it so first of

185
00:07:43,059 --> 00:07:47,409
all it allows for remote health

186
00:07:44,439 --> 00:07:48,759
monitoring so which means that if you

187
00:07:47,409 --> 00:07:50,620
have a connected medical device you

188
00:07:48,759 --> 00:07:53,349
won't have to go for a doctor's visit

189
00:07:50,620 --> 00:07:56,080
that often which cuts down and cost and

190
00:07:53,349 --> 00:07:58,360
time and not just on the patients but

191
00:07:56,080 --> 00:08:01,089
because medical practitioners are almost

192
00:07:58,360 --> 00:08:03,430
almost always overstressed

193
00:08:01,089 --> 00:08:05,680
it'll also cut down effort on their side

194
00:08:03,430 --> 00:08:08,409
it will also lead to less expenditure

195
00:08:05,680 --> 00:08:11,139
because you don't have to go to visit

196
00:08:08,409 --> 00:08:13,119
the doctor which might incur a fee they

197
00:08:11,139 --> 00:08:15,789
could be faster response time so the

198
00:08:13,119 --> 00:08:18,159
devices itself may alert you for certain

199
00:08:15,789 --> 00:08:19,539
certain conditions doctors may take

200
00:08:18,159 --> 00:08:22,899
preventive measures based on your

201
00:08:19,539 --> 00:08:24,759
situation Global Health Care is another

202
00:08:22,899 --> 00:08:28,419
big factor and it's not happening that

203
00:08:24,759 --> 00:08:29,979
much right now but think of the

204
00:08:28,419 --> 00:08:32,649
application of connected medical devices

205
00:08:29,979 --> 00:08:36,838
in underdeveloped countries where the

206
00:08:32,649 --> 00:08:39,159
medical staff is is always a scarcity

207
00:08:36,839 --> 00:08:41,259
since all these medical devices are

208
00:08:39,159 --> 00:08:43,419
connected to a central system it becomes

209
00:08:41,259 --> 00:08:47,560
very easy to maintain them and upgrade

210
00:08:43,419 --> 00:08:50,199
them if need be alert so for example

211
00:08:47,560 --> 00:08:52,899
insulin pump is monitoring patients

212
00:08:50,199 --> 00:08:54,910
insulin levels so it sees a deviation

213
00:08:52,899 --> 00:08:58,480
from the normality

214
00:08:54,910 --> 00:09:01,480
and it can it can inform a patient and

215
00:08:58,480 --> 00:09:04,780
they can take preventive action based on

216
00:09:01,480 --> 00:09:06,790
that alert and then the future of

217
00:09:04,780 --> 00:09:09,280
connected medical devices are going to

218
00:09:06,790 --> 00:09:11,410
be EHR and our ths and EHR our

219
00:09:09,280 --> 00:09:13,150
electronic health record systems where

220
00:09:11,410 --> 00:09:15,640
all this data is activated and then

221
00:09:13,150 --> 00:09:19,390
saved for future analysis but each other

222
00:09:15,640 --> 00:09:21,100
never meant to interact with medical

223
00:09:19,390 --> 00:09:22,810
devices in real time so that they're

224
00:09:21,100 --> 00:09:25,330
limited in their capability as to what

225
00:09:22,810 --> 00:09:30,189
they can do but ipho such as real-time

226
00:09:25,330 --> 00:09:31,600
health systems are are more able to take

227
00:09:30,190 --> 00:09:38,170
that kind of action and interact with

228
00:09:31,600 --> 00:09:39,460
different devices up so just a while

229
00:09:38,170 --> 00:09:41,740
back I mentioned that some of the

230
00:09:39,460 --> 00:09:43,330
devices are considered legacy devices in

231
00:09:41,740 --> 00:09:46,060
the sense that they were never meant to

232
00:09:43,330 --> 00:09:48,370
be connected to the network right and so

233
00:09:46,060 --> 00:09:50,290
the way these devices are connected to a

234
00:09:48,370 --> 00:09:53,440
network are using serial to Ethernet

235
00:09:50,290 --> 00:09:55,660
converters and cedar to Ethernet

236
00:09:53,440 --> 00:09:57,100
converters using those device are just

237
00:09:55,660 --> 00:09:59,350
generally a bad idea because there are

238
00:09:57,100 --> 00:10:01,060
tons of Willamette E's in them the talk

239
00:09:59,350 --> 00:10:04,030
over the signal communication port which

240
00:10:01,060 --> 00:10:05,619
never had any security built into it so

241
00:10:04,030 --> 00:10:10,810
the Department of Homeland Security last

242
00:10:05,620 --> 00:10:12,670
in 2015 they issued an alert against one

243
00:10:10,810 --> 00:10:14,619
of the most commonly used sealed

244
00:10:12,670 --> 00:10:18,660
internet converters which is in port

245
00:10:14,620 --> 00:10:21,010
developed by a company called MRSA and

246
00:10:18,660 --> 00:10:22,900
so there were a bunch of all images that

247
00:10:21,010 --> 00:10:26,020
were that were discovered and reported

248
00:10:22,900 --> 00:10:28,540
in in input and one was that it would

249
00:10:26,020 --> 00:10:30,819
allow an attacker to extract sensitive

250
00:10:28,540 --> 00:10:33,910
information from these devices remotely

251
00:10:30,820 --> 00:10:36,280
and unauthenticated the other one would

252
00:10:33,910 --> 00:10:38,290
allow an attacker to to upgrade or

253
00:10:36,280 --> 00:10:40,180
downgrade a firmware on one of these

254
00:10:38,290 --> 00:10:42,670
devices also remotely also

255
00:10:40,180 --> 00:10:44,800
unauthenticated and as if that was not

256
00:10:42,670 --> 00:10:46,540
enough there was also up of row of local

257
00:10:44,800 --> 00:10:50,740
immunity that I would allow an attacker

258
00:10:46,540 --> 00:10:52,900
to to execute code remotely without any

259
00:10:50,740 --> 00:10:55,360
authentication so generally a bad idea

260
00:10:52,900 --> 00:10:57,340
and I don't know if you remembered there

261
00:10:55,360 --> 00:11:00,700
was a massive power outage in Ukraine in

262
00:10:57,340 --> 00:11:03,339
2015 and as per DHS that was also caused

263
00:11:00,700 --> 00:11:04,720
by attackers corrupting firmware on one

264
00:11:03,339 --> 00:11:07,470
of the serial ethernet serial cheater

265
00:11:04,720 --> 00:11:07,470
net converters

266
00:11:08,870 --> 00:11:13,860
so in terms of the attack service but

267
00:11:11,940 --> 00:11:16,200
like depending on the size of the

268
00:11:13,860 --> 00:11:18,390
medical device like insulin pump isn't

269
00:11:16,200 --> 00:11:19,830
that bigger device and so like if you

270
00:11:18,390 --> 00:11:22,500
look at them they look like small

271
00:11:19,830 --> 00:11:24,089
trivial devices but if you look at the

272
00:11:22,500 --> 00:11:26,130
attack surface so like they have a lot

273
00:11:24,089 --> 00:11:26,910
of subsystems so there's Network part of

274
00:11:26,130 --> 00:11:29,010
it

275
00:11:26,910 --> 00:11:30,930
then there's application associated with

276
00:11:29,010 --> 00:11:33,839
the medical device there's the physical

277
00:11:30,930 --> 00:11:35,939
device hardware itself there could be a

278
00:11:33,839 --> 00:11:37,589
mobile application associated with the

279
00:11:35,940 --> 00:11:39,720
medical device and then there's cloud

280
00:11:37,589 --> 00:11:41,370
infrastructure which is supporting the

281
00:11:39,720 --> 00:11:42,690
particular medical device so if if you

282
00:11:41,370 --> 00:11:45,000
look at the attacks if it's like

283
00:11:42,690 --> 00:11:47,640
actually quite large and like well

284
00:11:45,000 --> 00:11:49,680
abilities from different platforms could

285
00:11:47,640 --> 00:11:55,439
be exposed to a single small medical

286
00:11:49,680 --> 00:11:57,870
device so there have been a lot of

287
00:11:55,440 --> 00:11:59,940
horror stories or incidents associated

288
00:11:57,870 --> 00:12:02,010
with connected medical devices I just

289
00:11:59,940 --> 00:12:04,020
basically wanted to talk about mid shock

290
00:12:02,010 --> 00:12:06,420
and major activity because they had the

291
00:12:04,020 --> 00:12:09,569
most impact they came they were most

292
00:12:06,420 --> 00:12:12,300
noticeable among others so magic or

293
00:12:09,570 --> 00:12:13,530
medical device hijack was a malware that

294
00:12:12,300 --> 00:12:16,949
came out in 2015

295
00:12:13,530 --> 00:12:19,589
lived through 2016 majek 2 is basically

296
00:12:16,950 --> 00:12:24,390
more evolved in sophisticated version of

297
00:12:19,589 --> 00:12:26,370
magic it came out in 2017 and so the one

298
00:12:24,390 --> 00:12:29,189
of the tricky thing about magic was that

299
00:12:26,370 --> 00:12:31,410
it went almost undetected by a endpoint

300
00:12:29,190 --> 00:12:34,100
security solutions and the reason it

301
00:12:31,410 --> 00:12:36,150
happened was because magic was

302
00:12:34,100 --> 00:12:38,040
specifically targeting older operating

303
00:12:36,150 --> 00:12:41,280
systems and older volume ities so

304
00:12:38,040 --> 00:12:43,260
operating systems like Windows XP 2023

305
00:12:41,280 --> 00:12:45,120
and we are talking about Willamette is

306
00:12:43,260 --> 00:12:48,510
like m/s zero eight zero six seven and

307
00:12:45,120 --> 00:12:51,000
wide got undetected because the newer

308
00:12:48,510 --> 00:12:52,800
operating systems they are protected

309
00:12:51,000 --> 00:12:55,140
against well old over-limit is like m/s

310
00:12:52,800 --> 00:12:56,550
zero eight zero six seven so they would

311
00:12:55,140 --> 00:12:58,740
just simply discard the malicious

312
00:12:56,550 --> 00:13:01,349
package so the packet won't even reach

313
00:12:58,740 --> 00:13:02,520
the end point secure solution and the

314
00:13:01,350 --> 00:13:05,190
older operating system which were

315
00:13:02,520 --> 00:13:07,650
running on these medical devices they

316
00:13:05,190 --> 00:13:10,110
did not have an endpoint solution on the

317
00:13:07,650 --> 00:13:12,390
devices the it was able to compromise

318
00:13:10,110 --> 00:13:14,820
tons of medical devices and then used to

319
00:13:12,390 --> 00:13:17,069
compromise devices to then pivot and

320
00:13:14,820 --> 00:13:19,350
compromise for the systems so I think it

321
00:13:17,070 --> 00:13:20,880
used federal infused malware for

322
00:13:19,350 --> 00:13:22,860
horizontal movement and

323
00:13:20,880 --> 00:13:27,930
compromise other systems on the hospital

324
00:13:22,860 --> 00:13:30,360
network all right so I think I'm done

325
00:13:27,930 --> 00:13:33,359
with time filler slides and just going

326
00:13:30,360 --> 00:13:35,480
to jump on to case studies now so the

327
00:13:33,360 --> 00:13:39,180
first medical device that we looked at

328
00:13:35,480 --> 00:13:42,690
was an IV infusion pump and infusion

329
00:13:39,180 --> 00:13:45,270
pump is usually used to inject fluid

330
00:13:42,690 --> 00:13:48,660
nutrients medication into patient's body

331
00:13:45,270 --> 00:13:50,310
in a control in appropriate dosage it's

332
00:13:48,660 --> 00:13:52,650
got some safety features built into it

333
00:13:50,310 --> 00:13:55,260
so like medical practitioners can set

334
00:13:52,650 --> 00:13:58,140
soft and hard limits on an effusion from

335
00:13:55,260 --> 00:14:00,990
say for example a doctor can come in and

336
00:13:58,140 --> 00:14:02,939
set morphine to be milligram milligrams

337
00:14:00,990 --> 00:14:04,560
as the maximum limit and then events

338
00:14:02,940 --> 00:14:06,240
that is said even if patient wanted to

339
00:14:04,560 --> 00:14:10,739
inject more morphine they won't be able

340
00:14:06,240 --> 00:14:13,620
to it used to be a standalone device but

341
00:14:10,740 --> 00:14:15,840
now it's connected to the network also

342
00:14:13,620 --> 00:14:20,240
this image is completely random I am NOT

343
00:14:15,840 --> 00:14:20,240
able capable of taking that good picture

344
00:14:20,270 --> 00:14:26,460
in terms of architecture so this is what

345
00:14:24,300 --> 00:14:28,800
an infusion pump would look like in a

346
00:14:26,460 --> 00:14:30,720
hospital network so it will connect to

347
00:14:28,800 --> 00:14:33,719
the hospital network either via ethernet

348
00:14:30,720 --> 00:14:36,540
or or wireless it will talk to different

349
00:14:33,720 --> 00:14:38,670
subsystems on on the hospital network so

350
00:14:36,540 --> 00:14:40,500
pump server is something that infusion

351
00:14:38,670 --> 00:14:42,860
pump often talks to to retrieve

352
00:14:40,500 --> 00:14:47,090
configurations and then save data onto

353
00:14:42,860 --> 00:14:49,260
and then if the hospital decides to

354
00:14:47,090 --> 00:14:51,570
share the data collected from the

355
00:14:49,260 --> 00:14:53,790
infusion pump they can do so by pushing

356
00:14:51,570 --> 00:14:56,390
the data out onto the cloud server or

357
00:14:53,790 --> 00:15:01,490
then giving or giving researchers access

358
00:14:56,390 --> 00:15:01,490
via VPN so we've seen both kind of cases

359
00:15:01,790 --> 00:15:06,810
well in our labs that have just had an

360
00:15:04,890 --> 00:15:08,370
infusion pump so it wasn't connected to

361
00:15:06,810 --> 00:15:09,810
any network but didn't have any pump

362
00:15:08,370 --> 00:15:12,120
server or any other components that

363
00:15:09,810 --> 00:15:16,140
usually talked to the infusion terms of

364
00:15:12,120 --> 00:15:17,190
all we had was an infusion pump so in

365
00:15:16,140 --> 00:15:18,090
the lab we made some initial

366
00:15:17,190 --> 00:15:19,680
observations

367
00:15:18,090 --> 00:15:23,790
it had capability to connect over

368
00:15:19,680 --> 00:15:26,069
wireless it ought to be zero 2.11 it had

369
00:15:23,790 --> 00:15:28,050
proprietary power connectors it also

370
00:15:26,070 --> 00:15:30,420
exposed an IR D a port there was a

371
00:15:28,050 --> 00:15:32,490
display and keypad and oh there was a

372
00:15:30,420 --> 00:15:34,498
maintenance mode so as soon as we found

373
00:15:32,490 --> 00:15:36,449
out about dimensions for maintenance

374
00:15:34,499 --> 00:15:37,919
Marisa's frantically started googling to

375
00:15:36,449 --> 00:15:40,228
see if there's some sort of

376
00:15:37,919 --> 00:15:43,379
manufacturer's guide out there which

377
00:15:40,229 --> 00:15:46,259
might expose the default password and

378
00:15:43,379 --> 00:15:49,019
surely there was and like so we got the

379
00:15:46,259 --> 00:15:50,699
default password and we tried to pass it

380
00:15:49,019 --> 00:15:52,169
on and of course it worked because you

381
00:15:50,699 --> 00:15:54,598
have no idea how much effort goes into

382
00:15:52,169 --> 00:16:01,019
changing the default passwords it's just

383
00:15:54,599 --> 00:16:03,739
madness so so when we once we had the

384
00:16:01,019 --> 00:16:06,029
password we were able to gain access to

385
00:16:03,739 --> 00:16:08,489
shoot some of the network configurations

386
00:16:06,029 --> 00:16:10,079
but there were it was only read-only

387
00:16:08,489 --> 00:16:12,179
access so we could read some

388
00:16:10,079 --> 00:16:15,628
configurations but we couldn't write any

389
00:16:12,179 --> 00:16:18,539
tighter onto it also there was an option

390
00:16:15,629 --> 00:16:20,429
to upgrade or downgrade the software but

391
00:16:18,539 --> 00:16:25,739
I'm not that technical and I have a life

392
00:16:20,429 --> 00:16:27,839
so I didn't go that route so we took the

393
00:16:25,739 --> 00:16:29,339
very obvious logical step because we

394
00:16:27,839 --> 00:16:32,519
noticed that there was an IR deport

395
00:16:29,339 --> 00:16:35,729
exposed so from a pen testers

396
00:16:32,519 --> 00:16:37,559
perspective our next goal was to connect

397
00:16:35,729 --> 00:16:40,019
this infusion pump to our wireless

398
00:16:37,559 --> 00:16:41,848
network right so we brought up our own

399
00:16:40,019 --> 00:16:44,939
access point configure it with the same

400
00:16:41,849 --> 00:16:46,859
settings as on the infusion pump but it

401
00:16:44,939 --> 00:16:49,858
didn't connect and the reason it did not

402
00:16:46,859 --> 00:16:51,179
connect was because we did not have it

403
00:16:49,859 --> 00:16:52,979
was it came pre-configured with a

404
00:16:51,179 --> 00:16:54,539
username and password and we didn't know

405
00:16:52,979 --> 00:16:56,819
that username password and we couldn't

406
00:16:54,539 --> 00:16:59,879
change that username and password on the

407
00:16:56,819 --> 00:17:02,098
infusion pump so we're kind of stuck so

408
00:16:59,879 --> 00:17:04,439
we remember that there's an IR D a port

409
00:17:02,099 --> 00:17:07,139
that is exposed so we took like obvious

410
00:17:04,439 --> 00:17:11,579
next step we want to rent an e ba and

411
00:17:07,138 --> 00:17:13,349
bought a PDA so the P D is the idea

412
00:17:11,579 --> 00:17:16,349
behind buying a PDA was to just buy a

413
00:17:13,349 --> 00:17:17,398
PDA and then get it to talk to the

414
00:17:16,349 --> 00:17:19,559
infusion pump over

415
00:17:17,398 --> 00:17:21,868
irda and so we brought it back to our

416
00:17:19,559 --> 00:17:23,459
lab we tried to make them connect to

417
00:17:21,868 --> 00:17:26,009
each other and it just magically were

418
00:17:23,459 --> 00:17:27,419
like there were no questions asked PDA

419
00:17:26,009 --> 00:17:29,399
was like hey bro do you want to talk

420
00:17:27,419 --> 00:17:31,409
infusion pump was like yeah sure why not

421
00:17:29,399 --> 00:17:34,289
be same talk the same language so let's

422
00:17:31,409 --> 00:17:38,460
just talk so that worked out pretty well

423
00:17:34,289 --> 00:17:42,570
for us and so once it was connected to

424
00:17:38,460 --> 00:17:44,519
the infusion pump there was an option to

425
00:17:42,570 --> 00:17:48,270
export the network configurations

426
00:17:44,519 --> 00:17:50,010
through irda onto the PDA device night

427
00:17:48,270 --> 00:17:51,480
so we were like really excited we're

428
00:17:50,010 --> 00:17:53,190
like yeah this option is pretty cool

429
00:17:51,480 --> 00:17:55,500
because we needed her to connect to a

430
00:17:53,190 --> 00:17:59,940
wireless network so that's allowed we

431
00:17:55,500 --> 00:18:02,970
tried so what we did was once we had the

432
00:17:59,940 --> 00:18:05,130
PDA connected to the infusion pump we

433
00:18:02,970 --> 00:18:07,650
try to export to divide configuration

434
00:18:05,130 --> 00:18:09,510
settings onto the PDA and we were super

435
00:18:07,650 --> 00:18:11,790
pumped at this time and we got it

436
00:18:09,510 --> 00:18:15,000
exported and now we are like opening

437
00:18:11,790 --> 00:18:18,090
this application on our PDA to bring up

438
00:18:15,000 --> 00:18:22,200
the template that was exported and it

439
00:18:18,090 --> 00:18:24,000
was blank so the template that we got on

440
00:18:22,200 --> 00:18:26,490
the PD it didn't have any relevant

441
00:18:24,000 --> 00:18:28,710
information it had some information but

442
00:18:26,490 --> 00:18:30,960
no sensitive information like user name

443
00:18:28,710 --> 00:18:32,820
and password so I guess someone from the

444
00:18:30,960 --> 00:18:34,590
manufacturers site figured that it's

445
00:18:32,820 --> 00:18:36,720
generally not a good idea to export

446
00:18:34,590 --> 00:18:40,379
sensitive information to a foreign

447
00:18:36,720 --> 00:18:43,260
device which is good so we're kind of

448
00:18:40,380 --> 00:18:45,270
stuck again and at this point of time we

449
00:18:43,260 --> 00:18:48,570
did what you typically do to a template

450
00:18:45,270 --> 00:18:51,320
so we we filled it we filled it with our

451
00:18:48,570 --> 00:18:54,149
favorite Wireless settings and then and

452
00:18:51,320 --> 00:18:54,990
imported it back to the infusion pump

453
00:18:54,150 --> 00:18:57,810
over irda

454
00:18:54,990 --> 00:18:59,850
and out of everything else that worked

455
00:18:57,810 --> 00:19:02,370
so like once we ported it back to the

456
00:18:59,850 --> 00:19:04,439
infusion pump it just over wrote all its

457
00:19:02,370 --> 00:19:06,750
Wireless settings from the settings from

458
00:19:04,440 --> 00:19:08,130
a template so at this point of time we

459
00:19:06,750 --> 00:19:11,250
configured it with the username and

460
00:19:08,130 --> 00:19:15,030
password it got connected to a wireless

461
00:19:11,250 --> 00:19:17,400
access point it was all good so we made

462
00:19:15,030 --> 00:19:21,660
some more observations so it exposed

463
00:19:17,400 --> 00:19:24,150
telnet FTP and SSH and we try to brute

464
00:19:21,660 --> 00:19:25,620
force login for these services but that

465
00:19:24,150 --> 00:19:29,250
didn't seem to work I guess we need

466
00:19:25,620 --> 00:19:30,959
better word list to that we also noticed

467
00:19:29,250 --> 00:19:34,200
that as soon as it got connected to the

468
00:19:30,960 --> 00:19:35,970
network it started to look for a pump

469
00:19:34,200 --> 00:19:38,340
server and from a previous knowledge we

470
00:19:35,970 --> 00:19:40,680
knew that infusion pumps usually talked

471
00:19:38,340 --> 00:19:43,020
to pump servers and so that that

472
00:19:40,680 --> 00:19:45,630
conferred confirm what we already knew

473
00:19:43,020 --> 00:19:49,050
but the problem was that we did not have

474
00:19:45,630 --> 00:19:50,850
a pump server in our lab so we spun up a

475
00:19:49,050 --> 00:19:53,430
virtual machine gave it the same NetBIOS

476
00:19:50,850 --> 00:19:55,649
name as the infusion pump was looking

477
00:19:53,430 --> 00:19:58,560
for and just brought it up in the

478
00:19:55,650 --> 00:20:01,410
network and as soon as that happened the

479
00:19:58,560 --> 00:20:05,730
infusion pump started to send packets

480
00:20:01,410 --> 00:20:07,320
to the pump server and we studied the

481
00:20:05,730 --> 00:20:10,530
packets for a while and then it looked

482
00:20:07,320 --> 00:20:12,270
like it was loosely based on XML and we

483
00:20:10,530 --> 00:20:14,850
were able to extract certain parameters

484
00:20:12,270 --> 00:20:16,590
so if you look at the packet here we

485
00:20:14,850 --> 00:20:18,780
could see the pump serial number the

486
00:20:16,590 --> 00:20:21,929
current time wireless access point data

487
00:20:18,780 --> 00:20:24,149
IP Mac information maintenance due date

488
00:20:21,930 --> 00:20:26,340
and in the end there were some random

489
00:20:24,150 --> 00:20:28,650
string and which took us a while but we

490
00:20:26,340 --> 00:20:31,470
figured that that that random string is

491
00:20:28,650 --> 00:20:33,540
actually x mode and checksum and because

492
00:20:31,470 --> 00:20:35,850
it's an X modem checksum it was easy to

493
00:20:33,540 --> 00:20:39,120
spoof that so we were able to retrieve

494
00:20:35,850 --> 00:20:41,639
package receive package modify them and

495
00:20:39,120 --> 00:20:44,760
then push it back to the pump server by

496
00:20:41,640 --> 00:20:46,260
after fixing the X modem checksum so

497
00:20:44,760 --> 00:20:47,790
initially we started doing it manually

498
00:20:46,260 --> 00:20:49,320
but we figured that it might be a good

499
00:20:47,790 --> 00:20:50,639
idea at this point of time to start

500
00:20:49,320 --> 00:20:53,520
furthering this thing with different

501
00:20:50,640 --> 00:20:56,400
kind of packets so we wrote a python

502
00:20:53,520 --> 00:20:59,700
library which would receive messages

503
00:20:56,400 --> 00:21:01,260
from the infusion forum and then create

504
00:20:59,700 --> 00:21:06,780
different kind of responses and then

505
00:21:01,260 --> 00:21:08,460
send it back to to the infusion pump and

506
00:21:06,780 --> 00:21:10,530
so after doing this for a while we

507
00:21:08,460 --> 00:21:13,350
started deciphering some of the mythos

508
00:21:10,530 --> 00:21:15,480
types so there was amethyst type 2 which

509
00:21:13,350 --> 00:21:17,280
confirmed to the pump that it's now

510
00:21:15,480 --> 00:21:18,750
connected to the pump server so like if

511
00:21:17,280 --> 00:21:21,090
you receive a packet from

512
00:21:18,750 --> 00:21:23,250
infusion pump we modify it's entered

513
00:21:21,090 --> 00:21:25,110
message type 2 it will confirm to the

514
00:21:23,250 --> 00:21:28,080
pump that it is now connected to the

515
00:21:25,110 --> 00:21:30,510
pump server there was method type 7 and

516
00:21:28,080 --> 00:21:34,230
31 which were not really sure what they

517
00:21:30,510 --> 00:21:37,530
were message type 8 was usually followed

518
00:21:34,230 --> 00:21:39,870
by method type 2 and then when we send

519
00:21:37,530 --> 00:21:42,930
those messages it changed the status on

520
00:21:39,870 --> 00:21:46,679
the infusion prompt from listening to

521
00:21:42,930 --> 00:21:49,230
confirmed message type 20 was something

522
00:21:46,680 --> 00:21:51,360
to do with Network commands in the

523
00:21:49,230 --> 00:21:54,390
mythos type 2 0 8 and 238 we're not

524
00:21:51,360 --> 00:21:56,520
really sure so we we we did a whole

525
00:21:54,390 --> 00:21:59,640
iteration of fuzzing trying out

526
00:21:56,520 --> 00:22:01,590
different messages and with one of the

527
00:21:59,640 --> 00:22:04,170
combinations we were able to retrieve

528
00:22:01,590 --> 00:22:05,730
this packet if you look here there are

529
00:22:04,170 --> 00:22:07,080
different parameters which are quite

530
00:22:05,730 --> 00:22:10,530
sensitive information so we're talking

531
00:22:07,080 --> 00:22:13,860
about there's a the drug name parameter

532
00:22:10,530 --> 00:22:15,570
in their dosage care area there's

533
00:22:13,860 --> 00:22:19,240
caregiver in from

534
00:22:15,570 --> 00:22:21,490
patient information location route site

535
00:22:19,240 --> 00:22:23,230
and you will see that all these fields

536
00:22:21,490 --> 00:22:26,050
here are empty but that's just because

537
00:22:23,230 --> 00:22:28,150
our infusion pump didn't have real data

538
00:22:26,050 --> 00:22:30,310
so in a real environment where it's

539
00:22:28,150 --> 00:22:32,320
deployed at a hospital it will contain

540
00:22:30,310 --> 00:22:34,090
all that information and once you

541
00:22:32,320 --> 00:22:36,399
receive that information you can aqui

542
00:22:34,090 --> 00:22:38,350
and update all that information and then

543
00:22:36,400 --> 00:22:42,280
fix the X modem checksum and then push

544
00:22:38,350 --> 00:22:43,929
it back to the infusion pump and so so

545
00:22:42,280 --> 00:22:45,520
we were able to do that and one of the

546
00:22:43,930 --> 00:22:47,530
other things we were able to do through

547
00:22:45,520 --> 00:22:49,920
packet manipulation was gain access to

548
00:22:47,530 --> 00:22:53,290
something called master drug list and

549
00:22:49,920 --> 00:22:56,380
remember how I talked about there was a

550
00:22:53,290 --> 00:22:59,320
case where doctors can set soft and hard

551
00:22:56,380 --> 00:23:00,580
limits on the dosage and it's a hundred

552
00:22:59,320 --> 00:23:03,189
milligrams of morphine would be the

553
00:23:00,580 --> 00:23:05,320
upper limit and so all that data is

554
00:23:03,190 --> 00:23:07,000
stored in the master drug list and we

555
00:23:05,320 --> 00:23:08,530
weren't able to confirm this because we

556
00:23:07,000 --> 00:23:10,540
didn't have a real pump server in our

557
00:23:08,530 --> 00:23:12,220
lab environment but there was strong

558
00:23:10,540 --> 00:23:14,200
indication that he can manipulate that

559
00:23:12,220 --> 00:23:17,830
data and then push it back to the

560
00:23:14,200 --> 00:23:20,050
infusion pump and then in an override

561
00:23:17,830 --> 00:23:23,379
the master drug list in that case it

562
00:23:20,050 --> 00:23:24,700
should be pretty fatal so these are some

563
00:23:23,380 --> 00:23:31,240
of the findings that we found in the

564
00:23:24,700 --> 00:23:36,700
infusion pump the second device that we

565
00:23:31,240 --> 00:23:38,050
looked at it was a digital pen and the

566
00:23:36,700 --> 00:23:41,050
doctors would use it to write

567
00:23:38,050 --> 00:23:43,210
prescription electronically so think of

568
00:23:41,050 --> 00:23:45,310
it as like a glorified fax machine

569
00:23:43,210 --> 00:23:45,880
because doctors would write prescription

570
00:23:45,310 --> 00:23:47,530
with it

571
00:23:45,880 --> 00:23:49,690
electronically we transferred to

572
00:23:47,530 --> 00:23:52,570
different pharmacies and the idea is

573
00:23:49,690 --> 00:23:54,940
that by the time patient reaches the

574
00:23:52,570 --> 00:23:56,610
pharmacy they would already have their

575
00:23:54,940 --> 00:24:00,400
prescriptions ready for pickup

576
00:23:56,610 --> 00:24:02,830
so these pens are again manufactured by

577
00:24:00,400 --> 00:24:05,950
multiple manufacturers we only looked at

578
00:24:02,830 --> 00:24:09,159
one device from one manufacturer also

579
00:24:05,950 --> 00:24:13,120
this image image is random as well so

580
00:24:09,160 --> 00:24:16,000
from the workflow perspective that the

581
00:24:13,120 --> 00:24:19,750
pen or the device would connect to the

582
00:24:16,000 --> 00:24:23,260
hospital network using wired or wired or

583
00:24:19,750 --> 00:24:24,730
wireless protocols and then it will take

584
00:24:23,260 --> 00:24:27,580
the information which is written by the

585
00:24:24,730 --> 00:24:28,960
doctors it will transmit it over SSL to

586
00:24:27,580 --> 00:24:32,470
the applications

587
00:24:28,960 --> 00:24:34,600
also expose data through a web portal so

588
00:24:32,470 --> 00:24:36,909
like web portal would allow patients to

589
00:24:34,600 --> 00:24:39,100
view their own prescriptions there would

590
00:24:36,909 --> 00:24:40,690
be a login for pharmacies to gain access

591
00:24:39,100 --> 00:24:42,820
to the prescription there would be a

592
00:24:40,690 --> 00:24:44,980
login for manufacturers and there would

593
00:24:42,820 --> 00:24:48,990
be a login for medical practitioners to

594
00:24:44,980 --> 00:24:51,669
look at that data so we noticed that

595
00:24:48,990 --> 00:24:52,899
that the pen came with Windows 10

596
00:24:51,669 --> 00:24:54,580
operating system

597
00:24:52,899 --> 00:24:56,439
it came pre-configured with two

598
00:24:54,580 --> 00:24:58,960
different accounts learned was the nurse

599
00:24:56,440 --> 00:25:00,730
slash physicians account the other one

600
00:24:58,960 --> 00:25:03,039
was an administrator account and I

601
00:25:00,730 --> 00:25:05,230
suppose administrator one would be used

602
00:25:03,039 --> 00:25:07,120
by manufacturers to upgrade or downgrade

603
00:25:05,230 --> 00:25:10,630
the device think I'm the only other

604
00:25:07,120 --> 00:25:13,000
person who uses that account it exposed

605
00:25:10,630 --> 00:25:13,840
us be it could connect over Ethernet and

606
00:25:13,000 --> 00:25:17,440
Wi-Fi

607
00:25:13,840 --> 00:25:20,678
it had HDMI and VGA interfaces I did the

608
00:25:17,440 --> 00:25:22,809
digital display audio pods it came with

609
00:25:20,679 --> 00:25:24,130
fully updated Windows Defender there was

610
00:25:22,809 --> 00:25:26,168
a docking station the docking station

611
00:25:24,130 --> 00:25:29,260
had most of the functionality so docking

612
00:25:26,169 --> 00:25:32,289
station is the one that had the USB port

613
00:25:29,260 --> 00:25:33,580
in VGA ports and all that then there was

614
00:25:32,289 --> 00:25:36,039
a software layer which basically

615
00:25:33,580 --> 00:25:42,370
comprised of two applications that came

616
00:25:36,039 --> 00:25:45,158
from manufacturer since it had USB and

617
00:25:42,370 --> 00:25:47,918
HDMI and VGA we could connect a keyboard

618
00:25:45,159 --> 00:25:49,510
a mouse and monitor to it we noticed

619
00:25:47,919 --> 00:25:51,580
that when she put up the pen it

620
00:25:49,510 --> 00:25:53,559
automatically locks into nurse /

621
00:25:51,580 --> 00:25:55,000
physician account so you don't need to

622
00:25:53,559 --> 00:25:57,129
provide a username and password is

623
00:25:55,000 --> 00:25:58,720
pre-configured to log in but it would

624
00:25:57,130 --> 00:26:02,039
login in lockdown mode so you can't

625
00:25:58,720 --> 00:26:05,409
really do much with that with that mode

626
00:26:02,039 --> 00:26:07,960
we notice a couple of soft manufacturer

627
00:26:05,409 --> 00:26:11,230
applications and services running on on

628
00:26:07,960 --> 00:26:13,419
the pen itself while writing the

629
00:26:11,230 --> 00:26:15,820
prescription if the pen is connected to

630
00:26:13,419 --> 00:26:18,039
the Internet it will transfer the data

631
00:26:15,820 --> 00:26:19,539
to the forms in real time but if it's

632
00:26:18,039 --> 00:26:22,270
not connected to the net into the

633
00:26:19,539 --> 00:26:23,890
Internet then it'll store that

634
00:26:22,270 --> 00:26:26,379
prescription and encrypted manner on the

635
00:26:23,890 --> 00:26:27,880
disk of the pen and then once you talk

636
00:26:26,380 --> 00:26:30,010
it and it connects the Internet then

637
00:26:27,880 --> 00:26:32,440
it'll transfer data the data was

638
00:26:30,010 --> 00:26:34,570
transmitted using SSL so we looked at it

639
00:26:32,440 --> 00:26:37,120
but there wasn't much in there there was

640
00:26:34,570 --> 00:26:38,950
also a remote access component where it

641
00:26:37,120 --> 00:26:41,110
had team beaver installed where

642
00:26:38,950 --> 00:26:43,140
manufacturers could log in remotely and

643
00:26:41,110 --> 00:26:46,840
connect to it to upgrade the device

644
00:26:43,140 --> 00:26:49,000
so again from pen testers perspective we

645
00:26:46,840 --> 00:26:51,250
were able to login as a nurse physician

646
00:26:49,000 --> 00:26:52,900
in a lockdown mode but the goal was to

647
00:26:51,250 --> 00:26:55,180
escalate privileges to local

648
00:26:52,900 --> 00:26:57,730
administrator second we can do much more

649
00:26:55,180 --> 00:27:00,100
stuff so we look at different avenues

650
00:26:57,730 --> 00:27:01,840
like we tried different exploit that are

651
00:27:00,100 --> 00:27:05,800
out there for Windows 10 that didn't

652
00:27:01,840 --> 00:27:07,149
work we looked at different services we

653
00:27:05,800 --> 00:27:08,980
couldn't find any service which you

654
00:27:07,150 --> 00:27:11,950
could start stop or modify properties

655
00:27:08,980 --> 00:27:13,600
for but we found one service and

656
00:27:11,950 --> 00:27:16,780
ironically it is one of the

657
00:27:13,600 --> 00:27:18,939
manufacturers application which it did

658
00:27:16,780 --> 00:27:21,430
allow us to restart the service but it

659
00:27:18,940 --> 00:27:24,100
allowed us to change the service binary

660
00:27:21,430 --> 00:27:26,110
on the operating system so again typical

661
00:27:24,100 --> 00:27:28,149
pentester stuff we created a malicious

662
00:27:26,110 --> 00:27:30,550
payload that would just create a local

663
00:27:28,150 --> 00:27:33,550
admin when executed and we replaced it

664
00:27:30,550 --> 00:27:36,520
with with actual binary for that

665
00:27:33,550 --> 00:27:37,899
particular service and since we couldn't

666
00:27:36,520 --> 00:27:40,060
start to stop the service we just

667
00:27:37,900 --> 00:27:43,690
rebooted the pen and when it came back

668
00:27:40,060 --> 00:27:45,639
up it created a local admin account so

669
00:27:43,690 --> 00:27:47,140
at this point of time we could do a lot

670
00:27:45,640 --> 00:27:49,030
more stuff in the sense that we could

671
00:27:47,140 --> 00:27:51,310
install a lot of tools on this

672
00:27:49,030 --> 00:27:53,050
particular pen so we started off with

673
00:27:51,310 --> 00:27:54,760
some packet capturing tools like

674
00:27:53,050 --> 00:27:58,090
Wireshark started looking at the traffic

675
00:27:54,760 --> 00:28:01,780
but because it was using Excel we didn't

676
00:27:58,090 --> 00:28:04,179
find much there to do the other thing we

677
00:28:01,780 --> 00:28:07,120
did was we installed proc Mon which is

678
00:28:04,180 --> 00:28:08,680
part of system internals utility and if

679
00:28:07,120 --> 00:28:10,989
you work with proc Mon before you will

680
00:28:08,680 --> 00:28:13,540
see that it captures tons of events like

681
00:28:10,990 --> 00:28:15,250
surely you can you can filter it for

682
00:28:13,540 --> 00:28:17,260
applications but still there are a lot

683
00:28:15,250 --> 00:28:19,510
of events that are captured by proc Mon

684
00:28:17,260 --> 00:28:22,480
and so it basically monitors like file

685
00:28:19,510 --> 00:28:24,510
operations memory operations registry

686
00:28:22,480 --> 00:28:27,880
operations performed by an application

687
00:28:24,510 --> 00:28:30,550
so we started monitoring that and after

688
00:28:27,880 --> 00:28:32,770
a while we thought we observed that the

689
00:28:30,550 --> 00:28:34,780
application was accessing trying to

690
00:28:32,770 --> 00:28:37,300
access a file with the extension

691
00:28:34,780 --> 00:28:39,970
ENC which looked like an encrypted file

692
00:28:37,300 --> 00:28:41,800
we located the file we verified it we

693
00:28:39,970 --> 00:28:47,110
opened it with all garbage string so

694
00:28:41,800 --> 00:28:48,909
definitely encrypted so because I'm

695
00:28:47,110 --> 00:28:50,590
wanna be reverse engineer I thought this

696
00:28:48,910 --> 00:28:53,290
is my chance to start doing some reverse

697
00:28:50,590 --> 00:28:55,270
engineering so I loaded up a

698
00:28:53,290 --> 00:28:56,350
system-level debugger on the operating

699
00:28:55,270 --> 00:28:58,629
system

700
00:28:56,350 --> 00:28:59,949
started reverse sensing the logic of the

701
00:28:58,630 --> 00:29:02,020
particular applications I was doing

702
00:28:59,950 --> 00:29:04,810
doing both static and dynamic reverse

703
00:29:02,020 --> 00:29:06,850
engineering and basically so on on the

704
00:29:04,810 --> 00:29:08,260
left side I look is this a piece of

705
00:29:06,850 --> 00:29:11,260
assembly which is basically responsible

706
00:29:08,260 --> 00:29:14,680
for loading the file in memory and

707
00:29:11,260 --> 00:29:18,190
decrypting the content so what I ended

708
00:29:14,680 --> 00:29:19,960
up doing was reversing the logic for for

709
00:29:18,190 --> 00:29:21,940
encrypting or decrypting the file and

710
00:29:19,960 --> 00:29:23,980
just wrote a Python script that would

711
00:29:21,940 --> 00:29:25,660
just load the file and then decrypt the

712
00:29:23,980 --> 00:29:28,780
content of the file and save it on to

713
00:29:25,660 --> 00:29:31,450
another file what I could have also done

714
00:29:28,780 --> 00:29:33,760
was just read the decrypted content from

715
00:29:31,450 --> 00:29:35,770
the buffer down there but that didn't

716
00:29:33,760 --> 00:29:41,230
sound so fancy so I just wrote my own

717
00:29:35,770 --> 00:29:42,370
Python scripts to do that so okay so at

718
00:29:41,230 --> 00:29:44,470
this point of time we were able to

719
00:29:42,370 --> 00:29:47,050
decrypt the content of the file and so

720
00:29:44,470 --> 00:29:49,510
we we noticed that it contains database

721
00:29:47,050 --> 00:29:51,760
connection string so it contain like a

722
00:29:49,510 --> 00:29:53,650
username and password it contain IP

723
00:29:51,760 --> 00:29:55,390
address of the my sequel database I'm

724
00:29:53,650 --> 00:29:57,820
like sure okay like this data is in

725
00:29:55,390 --> 00:29:59,830
there it's probably redundant there's no

726
00:29:57,820 --> 00:30:02,470
way they're using it and even if they

727
00:29:59,830 --> 00:30:04,090
are it's most likely that's never going

728
00:30:02,470 --> 00:30:06,400
to happen that they will expose the my

729
00:30:04,090 --> 00:30:08,320
sequel database to the Internet but out

730
00:30:06,400 --> 00:30:10,990
of curiosity I had to do a course scan

731
00:30:08,320 --> 00:30:14,679
and surely that the my sequel later with

732
00:30:10,990 --> 00:30:16,180
was exposed to the Internet and so even

733
00:30:14,680 --> 00:30:20,140
at this point of time I'm thinking this

734
00:30:16,180 --> 00:30:21,820
is one of those osep type CTF situations

735
00:30:20,140 --> 00:30:23,740
where like they want you to think that

736
00:30:21,820 --> 00:30:26,950
there's a vulnerability but super there

737
00:30:23,740 --> 00:30:28,870
isn't of an ability but then we provide

738
00:30:26,950 --> 00:30:31,270
the username and password it connected

739
00:30:28,870 --> 00:30:32,439
and like I'm looking at my golden

740
00:30:31,270 --> 00:30:33,700
retriever like because she's always

741
00:30:32,440 --> 00:30:38,310
watching me when I'm doing something

742
00:30:33,700 --> 00:30:38,310
interesting and like ok and she's like

743
00:30:38,970 --> 00:30:44,770
and so he so now we were able to connect

744
00:30:42,970 --> 00:30:46,720
to the back in database and honestly

745
00:30:44,770 --> 00:30:49,030
when I started looking at device I'm

746
00:30:46,720 --> 00:30:51,040
like it looks like a small pen in the

747
00:30:49,030 --> 00:30:54,460
best-case scenario I might just be able

748
00:30:51,040 --> 00:30:55,899
to capture some prescriptions that are

749
00:30:54,460 --> 00:30:58,150
stored on the device but nothing more

750
00:30:55,900 --> 00:30:59,470
than that but at this point of time we

751
00:30:58,150 --> 00:31:02,890
were connected to the back-end database

752
00:30:59,470 --> 00:31:04,750
as routes and we could access all the

753
00:31:02,890 --> 00:31:06,490
patient data from all the medical

754
00:31:04,750 --> 00:31:09,320
institutions this these pens were

755
00:31:06,490 --> 00:31:11,150
deployed at and not just at has been

756
00:31:09,320 --> 00:31:14,060
so if you look at some of the database

757
00:31:11,150 --> 00:31:15,740
content there's patient code there's

758
00:31:14,060 --> 00:31:17,510
another patient code for some reason

759
00:31:15,740 --> 00:31:20,510
then there's patient first name last

760
00:31:17,510 --> 00:31:23,540
name date of birth gender of the patient

761
00:31:20,510 --> 00:31:25,730
and so on tons of interesting table it's

762
00:31:23,540 --> 00:31:28,220
like I couldn't include screenshots for

763
00:31:25,730 --> 00:31:29,660
for all these tables but here you can

764
00:31:28,220 --> 00:31:31,880
see that it's a column for username

765
00:31:29,660 --> 00:31:35,900
password obviously password was in plain

766
00:31:31,880 --> 00:31:39,590
text and then there is something called

767
00:31:35,900 --> 00:31:42,310
a code so that code tells you if that

768
00:31:39,590 --> 00:31:45,290
particular user if a patient a

769
00:31:42,310 --> 00:31:47,360
manufacturer an administrator a doctor

770
00:31:45,290 --> 00:31:49,100
or a pharmacist so like you can take

771
00:31:47,360 --> 00:31:51,649
these logins and logon to the portal as

772
00:31:49,100 --> 00:31:54,709
like different users and gain access to

773
00:31:51,650 --> 00:31:57,320
even more medical records so another

774
00:31:54,710 --> 00:31:59,060
thing we came across was you can see the

775
00:31:57,320 --> 00:32:01,340
resident name so this is now from a

776
00:31:59,060 --> 00:32:03,679
particular health institution so you can

777
00:32:01,340 --> 00:32:05,659
see resident name the unit they're

778
00:32:03,680 --> 00:32:08,270
staying in their home address their room

779
00:32:05,660 --> 00:32:10,550
number and HCN is basically the health

780
00:32:08,270 --> 00:32:14,450
card number which is always obviously in

781
00:32:10,550 --> 00:32:16,639
plain text as well and finally we were

782
00:32:14,450 --> 00:32:19,340
also able to retrieve tons of

783
00:32:16,640 --> 00:32:21,560
prescriptions that were they were

784
00:32:19,340 --> 00:32:24,860
written by doctors for four different

785
00:32:21,560 --> 00:32:29,780
patients which we thought was not very

786
00:32:24,860 --> 00:32:31,310
cool right so yeah so just summarize all

787
00:32:29,780 --> 00:32:33,550
the wannabes that we found in these two

788
00:32:31,310 --> 00:32:37,070
medical devices just want to talk about

789
00:32:33,550 --> 00:32:39,139
talk a bit about the challenges and I

790
00:32:37,070 --> 00:32:40,790
think medical devices are going to grow

791
00:32:39,140 --> 00:32:42,950
and they're going to go up in number and

792
00:32:40,790 --> 00:32:45,590
one of the challenges for the medical

793
00:32:42,950 --> 00:32:46,970
institutions going forward would be that

794
00:32:45,590 --> 00:32:48,590
there will be tons of medical devices

795
00:32:46,970 --> 00:32:50,360
and they need to make sure that they

796
00:32:48,590 --> 00:32:53,060
would have enough bandwidth to support

797
00:32:50,360 --> 00:32:54,409
all these medical devices they would

798
00:32:53,060 --> 00:32:56,450
also need to make sure that there's

799
00:32:54,410 --> 00:32:58,280
enough segregation because there are

800
00:32:56,450 --> 00:33:00,890
going to be so many medical devices how

801
00:32:58,280 --> 00:33:03,770
do you segregate the network I was

802
00:33:00,890 --> 00:33:05,630
talking to a couple of people who work

803
00:33:03,770 --> 00:33:08,900
in the medical industry are responsible

804
00:33:05,630 --> 00:33:10,580
of managing these networks and one of

805
00:33:08,900 --> 00:33:13,220
them mentioned that how they do it is

806
00:33:10,580 --> 00:33:15,560
they put all the medical devices in one

807
00:33:13,220 --> 00:33:17,990
VLAN and in the hospital system so none

808
00:33:15,560 --> 00:33:19,909
of the VLAN which is cool but still

809
00:33:17,990 --> 00:33:22,370
doesn't solve the problem because if one

810
00:33:19,910 --> 00:33:24,200
medical device gets compromised then the

811
00:33:22,370 --> 00:33:26,239
it can be used to compromise all other

812
00:33:24,200 --> 00:33:27,679
medical devices right and probably there

813
00:33:26,240 --> 00:33:31,610
will be a jump box somewhere which will

814
00:33:27,679 --> 00:33:34,100
allow you to jump on to the other system

815
00:33:31,610 --> 00:33:36,678
Network and then I suggested that

816
00:33:34,100 --> 00:33:38,240
perhaps we could because in North

817
00:33:36,679 --> 00:33:40,669
America in large hospitals that are

818
00:33:38,240 --> 00:33:45,110
already around 1213 medical devices

819
00:33:40,669 --> 00:33:47,720
hotbed so I'm like why can't we just do

820
00:33:45,110 --> 00:33:50,149
segregation part bed or per rooms and

821
00:33:47,720 --> 00:33:52,370
that that'll in that case if the device

822
00:33:50,150 --> 00:33:53,419
is compromised there's only going to be

823
00:33:52,370 --> 00:33:55,158
one poor bastard

824
00:33:53,419 --> 00:33:58,940
but rest of the other people would be

825
00:33:55,159 --> 00:34:01,539
safe but he's like yeah it would be cool

826
00:33:58,940 --> 00:34:03,950
to do that but that's not very

827
00:34:01,539 --> 00:34:05,600
functional so like that it will need a

828
00:34:03,950 --> 00:34:08,690
lot of budget it'll need a lot of

829
00:34:05,600 --> 00:34:10,520
management so I think in order to figure

830
00:34:08,690 --> 00:34:13,550
this out that's gonna need to be a

831
00:34:10,520 --> 00:34:15,800
better more elaborate debate on how to

832
00:34:13,550 --> 00:34:17,659
best segregate the networks also he

833
00:34:15,800 --> 00:34:20,589
mentioned that from their teeth or

834
00:34:17,659 --> 00:34:22,940
perspective because they still have

835
00:34:20,589 --> 00:34:25,460
unpassed systems older operating systems

836
00:34:22,940 --> 00:34:28,010
on their medical devices the CSIs

837
00:34:25,460 --> 00:34:30,619
priority is to pass those systems their

838
00:34:28,010 --> 00:34:33,290
priority is to patch or get rid of

839
00:34:30,619 --> 00:34:34,609
Windows XP Windows 2000 2003 and not the

840
00:34:33,290 --> 00:34:36,710
medical devices so we'll get to the

841
00:34:34,609 --> 00:34:38,480
medical devices but it's going to take a

842
00:34:36,710 --> 00:34:39,918
long time to get there which is an

843
00:34:38,480 --> 00:34:43,159
interesting interesting conversation to

844
00:34:39,918 --> 00:34:44,989
have interoperability is going to be

845
00:34:43,159 --> 00:34:47,030
another issue because tons of devices

846
00:34:44,989 --> 00:34:49,279
especially from different manufacturers

847
00:34:47,030 --> 00:34:50,750
they talk in different protocols so to

848
00:34:49,280 --> 00:34:53,240
get them to talk to each other it's also

849
00:34:50,750 --> 00:34:55,369
going to be a challenge authentication

850
00:34:53,239 --> 00:34:56,330
and authorization could be a big

851
00:34:55,369 --> 00:34:58,099
challenge because I think we are

852
00:34:56,330 --> 00:35:00,650
approaching a time but and I think it's

853
00:34:58,099 --> 00:35:02,990
still happening in some of the medical

854
00:35:00,650 --> 00:35:04,880
institutions where patients can bringing

855
00:35:02,990 --> 00:35:07,700
their own device in which is connecting

856
00:35:04,880 --> 00:35:09,589
to the medical institutions Network and

857
00:35:07,700 --> 00:35:11,060
then transferring data so how do you

858
00:35:09,589 --> 00:35:15,290
differentiate between a legitimate

859
00:35:11,060 --> 00:35:16,910
device from a malicious device and you

860
00:35:15,290 --> 00:35:19,369
can think of medical devices more like

861
00:35:16,910 --> 00:35:21,799
SCADA systems where functionality is

862
00:35:19,369 --> 00:35:24,290
priority over security so they have to

863
00:35:21,800 --> 00:35:26,240
be online most of the time so patching

864
00:35:24,290 --> 00:35:31,490
these devices isn't going to be an easy

865
00:35:26,240 --> 00:35:33,049
task to do as a closing remark these are

866
00:35:31,490 --> 00:35:34,310
pretty generic generic I would say that

867
00:35:33,050 --> 00:35:35,930
because there's a lot of raise in

868
00:35:34,310 --> 00:35:38,299
getting these devices out

869
00:35:35,930 --> 00:35:40,490
Hiyori he's bolted on rather than built

870
00:35:38,300 --> 00:35:43,430
into the devices so the device has come

871
00:35:40,490 --> 00:35:45,919
out and then someone post voluntary

872
00:35:43,430 --> 00:35:47,480
disclosure for certain medical device

873
00:35:45,920 --> 00:35:49,880
and then they try to implement security

874
00:35:47,480 --> 00:35:54,260
on top of it which has never actually

875
00:35:49,880 --> 00:35:55,849
worked it's hard to trust devices it's

876
00:35:54,260 --> 00:35:58,160
hard to differentiate between legitimate

877
00:35:55,849 --> 00:35:59,720
medical devices and and malicious or

878
00:35:58,160 --> 00:36:01,069
compromised medical devices so that's

879
00:35:59,720 --> 00:36:03,529
another problem because network

880
00:36:01,069 --> 00:36:06,349
segmentation is going to be a problem

881
00:36:03,530 --> 00:36:09,319
I think FDA has started to do a lot in

882
00:36:06,349 --> 00:36:10,700
terms of betterment of standards and

883
00:36:09,319 --> 00:36:12,980
regulations and the defining

884
00:36:10,700 --> 00:36:14,899
requirements for device manufacturers

885
00:36:12,980 --> 00:36:17,900
but again like we've seen time and again

886
00:36:14,900 --> 00:36:21,109
that getting compliant or just adhering

887
00:36:17,900 --> 00:36:24,170
to regulations isn't going to do it so

888
00:36:21,109 --> 00:36:27,140
we need to go beyond that and most

889
00:36:24,170 --> 00:36:29,000
importantly that we've learned issues

890
00:36:27,140 --> 00:36:30,290
from other mistakes so if none of the

891
00:36:29,000 --> 00:36:32,420
issues actually I've talked about today

892
00:36:30,290 --> 00:36:35,808
are like exactly zero days they're

893
00:36:32,420 --> 00:36:37,160
pretty lame findings and so we've seen

894
00:36:35,809 --> 00:36:39,880
those findings with web applications

895
00:36:37,160 --> 00:36:41,899
mobile applications are the hardware and

896
00:36:39,880 --> 00:36:43,640
we're making the same mistake again

897
00:36:41,900 --> 00:36:45,859
where we think we're starting with a new

898
00:36:43,640 --> 00:36:47,690
product or new product line or domain

899
00:36:45,859 --> 00:36:49,339
and not learning from the past mistakes

900
00:36:47,690 --> 00:36:50,930
because the one liberties are still

901
00:36:49,339 --> 00:36:55,009
going to be the same even in medical

902
00:36:50,930 --> 00:36:56,480
devices and with that I end my

903
00:36:55,010 --> 00:36:58,950
presentation if you have any questions

904
00:36:56,480 --> 00:37:03,850
please let me know

905
00:36:58,950 --> 00:37:03,850
[Applause]

