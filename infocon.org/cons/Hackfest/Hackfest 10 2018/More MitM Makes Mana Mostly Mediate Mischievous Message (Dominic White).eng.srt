1
00:00:00,160 --> 00:00:04,470
[Applause]

2
00:00:01,730 --> 00:00:06,270
hello thank you for thank you for coming

3
00:00:04,470 --> 00:00:08,340
to this talk so today I'm gonna be

4
00:00:06,270 --> 00:00:10,829
talking about practical Wi-Fi hacking or

5
00:00:08,340 --> 00:00:13,170
how I think you need to hack why I find

6
00:00:10,830 --> 00:00:14,879
2018 there's if you read stuff on the

7
00:00:13,170 --> 00:00:17,070
internet there's a lot of approaches

8
00:00:14,880 --> 00:00:18,510
that people talk about that are dated

9
00:00:17,070 --> 00:00:21,060
they're not sort of up to date with our

10
00:00:18,510 --> 00:00:23,789
modern enterprise Wi-Fi access points

11
00:00:21,060 --> 00:00:25,799
are deployed or how you'd hack modern

12
00:00:23,789 --> 00:00:29,640
enterprise Wi-Fi so this is what this

13
00:00:25,800 --> 00:00:31,080
talks about so in 2014 I built a set of

14
00:00:29,640 --> 00:00:32,460
tools that we called the manna toolkit

15
00:00:31,080 --> 00:00:34,920
which is about rogue access point

16
00:00:32,460 --> 00:00:38,820
attacks this is also about the updates

17
00:00:34,920 --> 00:00:40,950
that we've made to it since so my name

18
00:00:38,820 --> 00:00:42,840
is Dominic white on Twitter I'm at cinge

19
00:00:40,950 --> 00:00:46,500
which turns out mean something in French

20
00:00:42,840 --> 00:00:47,670
and he found that out recently and I

21
00:00:46,500 --> 00:00:49,950
work for a company called sense post

22
00:00:47,670 --> 00:00:50,730
with South African penetration testing

23
00:00:49,950 --> 00:00:52,920
company

24
00:00:50,730 --> 00:00:57,269
it took me 36 hours door-to-door to get

25
00:00:52,920 --> 00:01:00,000
here yeah thanks for thanks for having

26
00:00:57,270 --> 00:01:01,530
me and I did this talk in conjunction

27
00:01:00,000 --> 00:01:03,390
with a colleague of mine is not here a

28
00:01:01,530 --> 00:01:04,680
guy named Michael at sense pose so if

29
00:01:03,390 --> 00:01:05,939
you want to say nice things about this

30
00:01:04,680 --> 00:01:07,140
talk please do it on Twitter and if you

31
00:01:05,939 --> 00:01:10,830
want to tell me I'm wrong and you hate

32
00:01:07,140 --> 00:01:13,020
me do it on email you know all right so

33
00:01:10,830 --> 00:01:14,340
to make your life a little easier if you

34
00:01:13,020 --> 00:01:15,899
want to get access to all of the tools

35
00:01:14,340 --> 00:01:18,990
I'm talking about you can go to that URL

36
00:01:15,900 --> 00:01:20,790
Wi-Fi dotnet with a1 there's a link to a

37
00:01:18,990 --> 00:01:23,369
wiki which is written up a bunch of of

38
00:01:20,790 --> 00:01:25,500
the how to do these things so I'm gonna

39
00:01:23,369 --> 00:01:27,180
have a little less of the technical type

40
00:01:25,500 --> 00:01:28,860
this into your command line here and

41
00:01:27,180 --> 00:01:30,360
rather tell you why you'd want to do it

42
00:01:28,860 --> 00:01:32,070
and what you get out of doing it and

43
00:01:30,360 --> 00:01:35,700
then you could look at how to do it on

44
00:01:32,070 --> 00:01:37,710
the website there okay so I've broken

45
00:01:35,700 --> 00:01:39,000
this talk into three scenarios because I

46
00:01:37,710 --> 00:01:40,589
think it's a nice way of talking about

47
00:01:39,000 --> 00:01:41,759
the ins and outs that you'll have to

48
00:01:40,590 --> 00:01:43,770
deal with when you're doing Wi-Fi

49
00:01:41,759 --> 00:01:46,170
hacking in those scenarios now you might

50
00:01:43,770 --> 00:01:48,000
not be in exactly that situation but

51
00:01:46,170 --> 00:01:50,159
hopefully you can take away the points

52
00:01:48,000 --> 00:01:51,899
I'm trying to make about if this then

53
00:01:50,159 --> 00:01:53,310
that and to apply to the situation

54
00:01:51,899 --> 00:01:55,409
you're in because I think a lot of the

55
00:01:53,310 --> 00:01:56,640
time people don't take the time to

56
00:01:55,409 --> 00:01:58,320
figure out what's going on when they're

57
00:01:56,640 --> 00:02:00,030
doing Wi-Fi hacking so you just download

58
00:01:58,320 --> 00:02:01,949
a Python script you run Wi-Fi to your an

59
00:02:00,030 --> 00:02:03,689
e Pama you don't know what's going on

60
00:02:01,950 --> 00:02:05,159
underneath and then stuff doesn't work

61
00:02:03,689 --> 00:02:06,869
and you're like oh well there's no

62
00:02:05,159 --> 00:02:08,629
vulnerabilities but actually if you

63
00:02:06,869 --> 00:02:12,060
understand what you're doing there's

64
00:02:08,628 --> 00:02:14,299
Wi-Fi is a really really vulnerable and

65
00:02:12,060 --> 00:02:16,140
poorly deployed in general

66
00:02:14,300 --> 00:02:18,030
infrastructure and you can get a lot out

67
00:02:16,140 --> 00:02:20,369
of it for red teaming for penetration

68
00:02:18,030 --> 00:02:23,700
testing it's the gift that keeps on

69
00:02:20,370 --> 00:02:26,220
giving for me since so since 2013 I use

70
00:02:23,700 --> 00:02:28,859
this in every engagement and it nearly

71
00:02:26,220 --> 00:02:30,630
always gives me some joy okay so the

72
00:02:28,860 --> 00:02:32,520
first scenario is about tracking did

73
00:02:30,630 --> 00:02:34,019
anyone here has anyone ever played was

74
00:02:32,520 --> 00:02:36,660
something called Snoopy it was a toolkit

75
00:02:34,020 --> 00:02:41,430
released in 2011 for tracking devices

76
00:02:36,660 --> 00:02:44,340
around so anyone recognize it okay so

77
00:02:41,430 --> 00:02:45,660
the idea was that and you'll know this

78
00:02:44,340 --> 00:02:47,700
if you've been playing with Wi-Fi that

79
00:02:45,660 --> 00:02:48,870
when your your devices look for networks

80
00:02:47,700 --> 00:02:50,820
nearby they send out these probe

81
00:02:48,870 --> 00:02:53,370
requests and those probe requests can

82
00:02:50,820 --> 00:02:57,420
tell you where that device has been so

83
00:02:53,370 --> 00:03:01,830
if soggies phone is probing for what's

84
00:02:57,420 --> 00:03:04,109
something suitably inappropriate you

85
00:03:01,830 --> 00:03:06,900
have the Bob's Bob's House of Pain

86
00:03:04,110 --> 00:03:08,580
Emporium and then we can tell that Sagi

87
00:03:06,900 --> 00:03:10,320
at some point went there and if it's

88
00:03:08,580 --> 00:03:12,450
telling us it's probing for something in

89
00:03:10,320 --> 00:03:13,980
the UK maybe gogo in-flight it I can

90
00:03:12,450 --> 00:03:15,899
start to build up the picture that he's

91
00:03:13,980 --> 00:03:18,000
been on a plane things like that so what

92
00:03:15,900 --> 00:03:20,520
happened was manufacturers have changed

93
00:03:18,000 --> 00:03:22,560
the way devices probe so that it's

94
00:03:20,520 --> 00:03:26,520
harder to identify devices because

95
00:03:22,560 --> 00:03:28,500
there's randomization and so the and so

96
00:03:26,520 --> 00:03:30,660
Snoopy's dead that kind of tracking

97
00:03:28,500 --> 00:03:32,459
looking at MAC addresses and progresses

98
00:03:30,660 --> 00:03:34,890
to track somebody around doesn't really

99
00:03:32,459 --> 00:03:37,890
work anymore people have built defenses

100
00:03:34,890 --> 00:03:40,170
against it and and so the way you can

101
00:03:37,890 --> 00:03:42,359
now track people around you need to bear

102
00:03:40,170 --> 00:03:43,829
some things in mind so this is a

103
00:03:42,360 --> 00:03:46,200
screenshot from a tool called Wi-Fi

104
00:03:43,830 --> 00:03:48,030
explorer if you want to learn how Wi-Fi

105
00:03:46,200 --> 00:03:49,440
works and you have a Mac this is a

106
00:03:48,030 --> 00:03:51,930
fantastic tool it's fairly inexpensive

107
00:03:49,440 --> 00:03:53,280
for the the entry-level version and it

108
00:03:51,930 --> 00:03:55,140
just gives you all sorts of fantastic

109
00:03:53,280 --> 00:03:57,060
information about what this thing is and

110
00:03:55,140 --> 00:03:58,890
how it works and stuff like that okay so

111
00:03:57,060 --> 00:04:00,870
this is obviously the networks around

112
00:03:58,890 --> 00:04:02,880
here and not right at the moment this

113
00:04:00,870 --> 00:04:04,739
was in my room earlier and if you check

114
00:04:02,880 --> 00:04:08,130
the tops got 2.4 gigahertz and the

115
00:04:04,739 --> 00:04:11,370
bottoms got it got 5 gigahertz sorry I

116
00:04:08,130 --> 00:04:13,230
didn't start my timer start there and

117
00:04:11,370 --> 00:04:14,670
when you look at a picture like this you

118
00:04:13,230 --> 00:04:17,010
get this idea that ok there's a little

119
00:04:14,670 --> 00:04:18,418
bit more 5 gigahertz spectrum but you

120
00:04:17,010 --> 00:04:20,880
know it's sort of roughly the same size

121
00:04:18,418 --> 00:04:23,310
of the 2.4 gigahertz spectrum and if

122
00:04:20,880 --> 00:04:24,450
you've ever done passive Wi-Fi hacking

123
00:04:23,310 --> 00:04:26,490
where you're sitting there hopping

124
00:04:24,450 --> 00:04:27,479
across channels and monitoring stuff

125
00:04:26,490 --> 00:04:29,310
going on the network

126
00:04:27,480 --> 00:04:31,590
you know there's about 13 channels in

127
00:04:29,310 --> 00:04:33,480
the 2.4 gigahertz range and then there's

128
00:04:31,590 --> 00:04:35,310
a bunch more channels in the 5 gigahertz

129
00:04:33,480 --> 00:04:37,500
range so if you're gonna do passive

130
00:04:35,310 --> 00:04:39,660
monitoring adding 2.4 gigahertz and 5

131
00:04:37,500 --> 00:04:41,220
gigahertz you're like okay it's gonna be

132
00:04:39,660 --> 00:04:43,530
a bit more work maybe slightly more than

133
00:04:41,220 --> 00:04:45,480
double you know based on this picture in

134
00:04:43,530 --> 00:04:47,549
reality that's how that stuff looks

135
00:04:45,480 --> 00:04:49,830
there is way more 5 gigahertz Wi-Fi

136
00:04:47,550 --> 00:04:52,020
spectrum than it is 2.4 gig Wi-Fi

137
00:04:49,830 --> 00:04:54,090
spectrum so you can't with one card

138
00:04:52,020 --> 00:04:55,590
practically channel hop through all of

139
00:04:54,090 --> 00:04:58,109
these and hope to see some kind of

140
00:04:55,590 --> 00:04:59,369
reasonable interaction every couple of

141
00:04:58,110 --> 00:05:01,620
seconds you'll be on a channel long

142
00:04:59,370 --> 00:05:03,660
enough to see something and so that's

143
00:05:01,620 --> 00:05:05,730
where things like the Wi-Fi cactus come

144
00:05:03,660 --> 00:05:07,320
from you know if you want to practically

145
00:05:05,730 --> 00:05:09,330
monitor across all of these channels

146
00:05:07,320 --> 00:05:12,300
simultaneously you need crazy stuff like

147
00:05:09,330 --> 00:05:14,310
and the stuff dark-matter built now most

148
00:05:12,300 --> 00:05:16,260
of us you know on the one hands a lot of

149
00:05:14,310 --> 00:05:17,910
work to build and on the other you're

150
00:05:16,260 --> 00:05:19,020
probably gonna look suspicious if you

151
00:05:17,910 --> 00:05:22,350
arrive at a client with that on your

152
00:05:19,020 --> 00:05:26,070
back and I'm just here to check the

153
00:05:22,350 --> 00:05:28,200
plumbing so if you wanted to do Wi-Fi

154
00:05:26,070 --> 00:05:32,099
hacking and this is all you have then

155
00:05:28,200 --> 00:05:33,810
you need a way to attract devices to you

156
00:05:32,100 --> 00:05:35,340
rather than having to monitor the whole

157
00:05:33,810 --> 00:05:37,260
spectrum and that's where rogue access

158
00:05:35,340 --> 00:05:39,840
points come in by running a rogue access

159
00:05:37,260 --> 00:05:41,250
point devices have algorithms in to find

160
00:05:39,840 --> 00:05:43,049
nearby access points let's get they've

161
00:05:41,250 --> 00:05:44,550
got the same spectrum problem it's not

162
00:05:43,050 --> 00:05:47,010
like your iPhone can monitor all of that

163
00:05:44,550 --> 00:05:48,390
spectrum with 100 radios it's gonna go

164
00:05:47,010 --> 00:05:50,310
show me where the Wi-Fi networks are

165
00:05:48,390 --> 00:05:52,020
based on beacons coming out from these

166
00:05:50,310 --> 00:05:53,610
things all right there's one I'm gonna

167
00:05:52,020 --> 00:05:57,000
send a broadcast probe request at that

168
00:05:53,610 --> 00:05:59,370
and see what it responds with I have so

169
00:05:57,000 --> 00:06:01,530
the general theory is don't don't go to

170
00:05:59,370 --> 00:06:03,690
them make them come to you and rogue

171
00:06:01,530 --> 00:06:05,250
access points before this this reason

172
00:06:03,690 --> 00:06:07,110
the lone rogue access points are almost

173
00:06:05,250 --> 00:06:07,950
essential for modern Wi-Fi hacking if

174
00:06:07,110 --> 00:06:10,650
you think about it if you want to

175
00:06:07,950 --> 00:06:12,510
capture wpa2 handshakes you gotta like

176
00:06:10,650 --> 00:06:13,919
do them off their enterprise ap and

177
00:06:12,510 --> 00:06:16,200
you've got some crappy little antenna

178
00:06:13,920 --> 00:06:19,200
and they've got fancy Cisco Meraki kits

179
00:06:16,200 --> 00:06:22,110
or Aruba's or something like that and if

180
00:06:19,200 --> 00:06:24,060
you want to monitor a bunch of spectrum

181
00:06:22,110 --> 00:06:25,950
if you're just pretty much anything

182
00:06:24,060 --> 00:06:27,690
you're doing you run your own AP the

183
00:06:25,950 --> 00:06:29,670
devices will come to you and then you

184
00:06:27,690 --> 00:06:32,070
can manipulate the clients so if you run

185
00:06:29,670 --> 00:06:35,220
like an evil twin attack pretending to

186
00:06:32,070 --> 00:06:38,070
be a WPA PSK Network you can capture

187
00:06:35,220 --> 00:06:39,540
posh enough of the handshake to care to

188
00:06:38,070 --> 00:06:41,010
crack those credentials you don't

189
00:06:39,540 --> 00:06:41,340
actually have to capture the handshake

190
00:06:41,010 --> 00:06:44,490
when it

191
00:06:41,340 --> 00:06:45,750
an extra wk to AP and that's great

192
00:06:44,490 --> 00:06:47,100
because it now also frees you from the

193
00:06:45,750 --> 00:06:48,449
restraints of having to be near the

194
00:06:47,100 --> 00:06:50,040
actual access point that you're

195
00:06:48,449 --> 00:06:51,630
targeting you're not targeting clients

196
00:06:50,040 --> 00:06:53,460
so I can start targeting people in this

197
00:06:51,630 --> 00:06:55,500
room instead of having to go to their

198
00:06:53,460 --> 00:06:57,750
places of work to target that you can

199
00:06:55,500 --> 00:07:01,889
target the nearby coffee shop so be an

200
00:06:57,750 --> 00:07:03,240
AP now that probably we have with the

201
00:07:01,889 --> 00:07:05,820
tracking in particular is this

202
00:07:03,240 --> 00:07:09,030
anonymization thing so the MAC addresses

203
00:07:05,820 --> 00:07:10,919
are randomized every time they probe so

204
00:07:09,030 --> 00:07:12,479
you can't tell you know from one probe

205
00:07:10,919 --> 00:07:14,340
to another is this the same device and

206
00:07:12,479 --> 00:07:17,190
then the other problem that you have is

207
00:07:14,340 --> 00:07:19,349
the they're not probing for the specific

208
00:07:17,190 --> 00:07:21,120
network anymore for the most part what

209
00:07:19,350 --> 00:07:23,370
devices modern devices will do is I'll

210
00:07:21,120 --> 00:07:25,320
say hey Wi-Fi network

211
00:07:23,370 --> 00:07:26,669
what Wi-Fi networks are out there then

212
00:07:25,320 --> 00:07:28,500
they'll match on an internal list

213
00:07:26,669 --> 00:07:30,900
privately whether any of those networks

214
00:07:28,500 --> 00:07:32,880
are on their pl their preferred network

215
00:07:30,900 --> 00:07:34,138
list so if you imagine your device order

216
00:07:32,880 --> 00:07:36,060
connects to work when you get to work

217
00:07:34,139 --> 00:07:37,350
and home when you get a home it'll come

218
00:07:36,060 --> 00:07:39,419
arrive in a place that will say hey

219
00:07:37,350 --> 00:07:41,610
Wi-Fi networks what are your names and

220
00:07:39,419 --> 00:07:43,710
something says well I'm home then little

221
00:07:41,610 --> 00:07:44,910
probe for home something says I'm work

222
00:07:43,710 --> 00:07:46,888
then little probe for work it's not

223
00:07:44,910 --> 00:07:48,180
going to reveal those probes proactively

224
00:07:46,889 --> 00:07:50,400
like it used to that's why I say

225
00:07:48,180 --> 00:07:51,930
Snoopy's dead so the problem we have is

226
00:07:50,400 --> 00:07:54,150
we need to do naanum eyes these devices

227
00:07:51,930 --> 00:07:56,669
if we're tracking them and there was

228
00:07:54,150 --> 00:07:58,888
some fantastic work by Gannon Denton

229
00:07:56,669 --> 00:08:00,870
Gentry or gent and Gentry he's an

230
00:07:58,889 --> 00:08:03,570
ex-googler where he came up with a

231
00:08:00,870 --> 00:08:05,220
signature of unique aspects of Wi-Fi

232
00:08:03,570 --> 00:08:09,599
interactions and he calls it Wi-Fi

233
00:08:05,220 --> 00:08:12,630
taxonomy so based on like the extensions

234
00:08:09,599 --> 00:08:14,280
the HF extensions or their specific

235
00:08:12,630 --> 00:08:16,169
aspects of how that device probes you

236
00:08:14,280 --> 00:08:18,090
can create a unique signature and then

237
00:08:16,169 --> 00:08:21,120
you can do naanum eyes devices can you

238
00:08:18,090 --> 00:08:22,289
tell that I drew that myself so let me

239
00:08:21,120 --> 00:08:23,849
give you a practical example of what

240
00:08:22,289 --> 00:08:25,770
that looks like so I'm using multi go

241
00:08:23,849 --> 00:08:28,289
here and I take I've taken the raw

242
00:08:25,770 --> 00:08:29,940
output from manner and shunted it into

243
00:08:28,289 --> 00:08:31,650
Motyka I haven't like manipulated this

244
00:08:29,940 --> 00:08:34,860
file at all so this is something it's

245
00:08:31,650 --> 00:08:36,659
really easy that you can do so let's say

246
00:08:34,860 --> 00:08:38,010
we see four devices for different MAC

247
00:08:36,659 --> 00:08:39,718
addresses and they're probing for a

248
00:08:38,010 --> 00:08:41,159
network called internet now the reason

249
00:08:39,719 --> 00:08:42,690
we can see their probes with mana is

250
00:08:41,159 --> 00:08:45,390
because I'm an actual access point

251
00:08:42,690 --> 00:08:47,610
they'll send a broadcast probe at me and

252
00:08:45,390 --> 00:08:50,100
I'll respond saying hey I'm this network

253
00:08:47,610 --> 00:08:51,450
so the trick is how do I know to respond

254
00:08:50,100 --> 00:08:53,970
as Internet well maybe it's just a

255
00:08:51,450 --> 00:08:54,750
common SSID that will be included in

256
00:08:53,970 --> 00:08:56,760
there

257
00:08:54,750 --> 00:08:58,200
or with loud mode what manner does is it

258
00:08:56,760 --> 00:09:01,020
learns the names of networks from

259
00:08:58,200 --> 00:09:03,000
devices around it so maybe you've got an

260
00:09:01,020 --> 00:09:04,650
older tablet that's still probing for

261
00:09:03,000 --> 00:09:06,270
network names the second it sees that

262
00:09:04,650 --> 00:09:08,040
manner will rebroadcast that network

263
00:09:06,270 --> 00:09:09,810
name in response to a broadcast from

264
00:09:08,040 --> 00:09:11,130
someone else so man is really good at

265
00:09:09,810 --> 00:09:13,140
figuring out network names nearby

266
00:09:11,130 --> 00:09:15,330
automatically and then broadcasting

267
00:09:13,140 --> 00:09:16,530
those two to people I'm not going to

268
00:09:15,330 --> 00:09:19,500
that too much detail because that's kind

269
00:09:16,530 --> 00:09:20,819
of standard like our talk in 2014 went

270
00:09:19,500 --> 00:09:22,950
through that okay so let's say you've

271
00:09:20,820 --> 00:09:25,560
got four devices now some of those are

272
00:09:22,950 --> 00:09:26,940
randomized MAC addresses some aren't we

273
00:09:25,560 --> 00:09:27,989
don't really know how do we do naanum

274
00:09:26,940 --> 00:09:29,940
eyes them well the first thing is let's

275
00:09:27,990 --> 00:09:31,890
add that marker what's random and what's

276
00:09:29,940 --> 00:09:33,690
not in manner there's just a CSV that it

277
00:09:31,890 --> 00:09:34,620
outputs with a 0 1 whether it's

278
00:09:33,690 --> 00:09:36,690
randomized or not

279
00:09:34,620 --> 00:09:38,400
so because randomized MAC addresses have

280
00:09:36,690 --> 00:09:40,020
a sync the second bit of the first octet

281
00:09:38,400 --> 00:09:42,630
sets called locally administered Mac's

282
00:09:40,020 --> 00:09:43,770
we can tell whether it's randomized but

283
00:09:42,630 --> 00:09:46,170
that still doesn't help us because we

284
00:09:43,770 --> 00:09:47,760
don't know are there so because there's

285
00:09:46,170 --> 00:09:50,010
two non-random devices we know there's

286
00:09:47,760 --> 00:09:51,720
at least two physical devices but which

287
00:09:50,010 --> 00:09:54,090
of those random pros belongs to which of

288
00:09:51,720 --> 00:09:55,680
those physical devices and all those

289
00:09:54,090 --> 00:09:56,970
random probes even associated to those

290
00:09:55,680 --> 00:09:59,729
physical devices they could be from

291
00:09:56,970 --> 00:10:01,680
other devices that we don't have here so

292
00:09:59,730 --> 00:10:04,320
if the taxonomy stuff you can

293
00:10:01,680 --> 00:10:06,030
effectively D anonymize this so we can

294
00:10:04,320 --> 00:10:08,790
see that there's two devices the one

295
00:10:06,030 --> 00:10:09,930
random probe belongs to the one device

296
00:10:08,790 --> 00:10:11,459
and the other one to the other so with

297
00:10:09,930 --> 00:10:13,170
these these taxonomy x' we can

298
00:10:11,460 --> 00:10:15,930
effectively come up with unique

299
00:10:13,170 --> 00:10:17,189
signatures per device and so Nana

300
00:10:15,930 --> 00:10:19,260
supports all this stuff what I did is I

301
00:10:17,190 --> 00:10:21,240
took Denton's work and I extended it to

302
00:10:19,260 --> 00:10:22,589
word pre Association so he would only

303
00:10:21,240 --> 00:10:24,390
generate these signatures once you a

304
00:10:22,589 --> 00:10:26,490
device that associated to the network i

305
00:10:24,390 --> 00:10:27,900
generate the signatures before the

306
00:10:26,490 --> 00:10:30,330
device associated on the network so that

307
00:10:27,900 --> 00:10:31,980
you can do naanum eyes devices and track

308
00:10:30,330 --> 00:10:32,880
them around so this is really good in

309
00:10:31,980 --> 00:10:34,650
the beginning we're just trying to

310
00:10:32,880 --> 00:10:35,939
figure out what's going on or maybe

311
00:10:34,650 --> 00:10:36,959
there's a particular person you want to

312
00:10:35,940 --> 00:10:40,200
target you want to see how they're using

313
00:10:36,960 --> 00:10:41,580
Windows device or a Mac because they've

314
00:10:40,200 --> 00:10:45,750
got different sort of randomized probing

315
00:10:41,580 --> 00:10:47,220
behavior and like I said there's a whole

316
00:10:45,750 --> 00:10:48,810
bunch of things you need to do to make

317
00:10:47,220 --> 00:10:50,310
this work well not a lot of things you

318
00:10:48,810 --> 00:10:51,540
need to do make it work and I put it all

319
00:10:50,310 --> 00:10:53,520
in a wiki I decided to write

320
00:10:51,540 --> 00:10:55,829
documentation for a change it's rare for

321
00:10:53,520 --> 00:10:57,839
me and so if you go to that Wi-Fi dotnet

322
00:10:55,830 --> 00:10:59,610
website on the top right there's a link

323
00:10:57,839 --> 00:11:01,350
to the wiki and it's got detailed

324
00:10:59,610 --> 00:11:03,839
information about about how to configure

325
00:11:01,350 --> 00:11:04,760
this but people get like really confused

326
00:11:03,839 --> 00:11:07,110
with hostapd

327
00:11:04,760 --> 00:11:08,579
and its configuration files normally

328
00:11:07,110 --> 00:11:10,110
because like the default configuration

329
00:11:08,579 --> 00:11:12,420
file is about a thousand two hundred

330
00:11:10,110 --> 00:11:15,689
lines long and people look at it an icon

331
00:11:12,420 --> 00:11:17,899
wrong so this is with those four lines

332
00:11:15,689 --> 00:11:20,279
you can run an access point with hostapd

333
00:11:17,899 --> 00:11:22,019
vanilla hostapd you just give it a

334
00:11:20,279 --> 00:11:23,999
channel you go to network name you give

335
00:11:22,019 --> 00:11:25,410
it a device and a hardware mode you need

336
00:11:23,999 --> 00:11:27,449
to have a Wi-Fi adapter that supports

337
00:11:25,410 --> 00:11:28,499
master mode but away you go four lines

338
00:11:27,449 --> 00:11:30,118
you've got an access point you want to

339
00:11:28,499 --> 00:11:32,759
run an AP at your house there you go

340
00:11:30,119 --> 00:11:34,829
four lines stop buying de links and

341
00:11:32,759 --> 00:11:37,230
things like that if you want to enable

342
00:11:34,829 --> 00:11:39,359
manners basic options you add those two

343
00:11:37,230 --> 00:11:41,399
commands there so enable manor will

344
00:11:39,360 --> 00:11:43,499
respond to people's so it's effectively

345
00:11:41,399 --> 00:11:46,410
old karma style attack but it'll do it

346
00:11:43,499 --> 00:11:47,850
at a probe level and then loud mode is

347
00:11:46,410 --> 00:11:49,799
that thing where it learns from the

348
00:11:47,850 --> 00:11:51,689
networks that are nearby and rebroadcast

349
00:11:49,799 --> 00:11:52,049
them to two other devices so there you

350
00:11:51,689 --> 00:11:54,149
go

351
00:11:52,049 --> 00:11:56,249
you've got modern karma attacks working

352
00:11:54,149 --> 00:11:58,769
with two extra for the cost of two extra

353
00:11:56,249 --> 00:12:01,259
things if you want to log the stuff to a

354
00:11:58,769 --> 00:12:03,839
file and do the taxonomy tracking then

355
00:12:01,259 --> 00:12:05,939
it's these three extra lines so for the

356
00:12:03,839 --> 00:12:07,559
cost of nine lines there you go you've

357
00:12:05,939 --> 00:12:09,540
got a you've got an access point that

358
00:12:07,559 --> 00:12:11,399
can do all of the stuff I just spoke

359
00:12:09,540 --> 00:12:12,959
about and it dumps it to a single CSV

360
00:12:11,399 --> 00:12:16,619
file you don't have to be like a crazy

361
00:12:12,959 --> 00:12:17,849
UNIX guru to pause CSV files and so yeah

362
00:12:16,619 --> 00:12:20,129
people I don't know why they get really

363
00:12:17,850 --> 00:12:23,759
scared about hostapd but it's actually

364
00:12:20,129 --> 00:12:26,309
really simple okay so the the next

365
00:12:23,759 --> 00:12:27,749
scenario would be enterprise networks so

366
00:12:26,309 --> 00:12:29,519
things that are using extensible

367
00:12:27,749 --> 00:12:31,470
authentication protocol EEP so the most

368
00:12:29,519 --> 00:12:33,209
common one being peep or some people

369
00:12:31,470 --> 00:12:35,419
will have ETLs where their certificates

370
00:12:33,209 --> 00:12:37,888
involved and so the the most common

371
00:12:35,419 --> 00:12:39,959
attack in that is the evil to an attack

372
00:12:37,889 --> 00:12:44,779
there's anyone young enough not to get

373
00:12:39,959 --> 00:12:49,138
this this is Spock's evil twin from the

374
00:12:44,779 --> 00:12:51,509
what the what dimension which one Mirror

375
00:12:49,139 --> 00:12:55,559
Universe thank you I knew that I'd have

376
00:12:51,509 --> 00:12:57,299
a fella fella Trek in here okay so so

377
00:12:55,559 --> 00:12:59,069
the one stuff that like just triggers me

378
00:12:57,299 --> 00:13:00,480
a little is I read these write-ups about

379
00:12:59,069 --> 00:13:02,069
how to do evil twin attacks and people

380
00:13:00,480 --> 00:13:03,509
like yo you just use your alpha card and

381
00:13:02,069 --> 00:13:05,248
you make your network name the same as

382
00:13:03,509 --> 00:13:07,769
the enterprise one but you make it an

383
00:13:05,249 --> 00:13:09,149
open network like Wi-Fi Fisher the

384
00:13:07,769 --> 00:13:10,230
principle is that you make an open

385
00:13:09,149 --> 00:13:11,610
network of the same name as the

386
00:13:10,230 --> 00:13:13,169
corporate one and then you pop up a

387
00:13:11,610 --> 00:13:14,970
captive portal and people type in their

388
00:13:13,169 --> 00:13:16,319
creds the problem with that kind of

389
00:13:14,970 --> 00:13:19,049
stuff is like I said before you're

390
00:13:16,319 --> 00:13:20,459
racing a corporate access point and you

391
00:13:19,049 --> 00:13:22,230
know it's more like a fairly big company

392
00:13:20,459 --> 00:13:24,689
they're gonna have sometimes

393
00:13:22,230 --> 00:13:26,520
access points they've done Wi-Fi surveys

394
00:13:24,690 --> 00:13:28,710
these are fancy antennas with like

395
00:13:26,520 --> 00:13:30,210
decent power and you're coming along

396
00:13:28,710 --> 00:13:32,070
with your crappy you Alfa card that's

397
00:13:30,210 --> 00:13:33,510
probably like behind the table somewhere

398
00:13:32,070 --> 00:13:35,850
you know you're not going to have the

399
00:13:33,510 --> 00:13:38,790
same sort of access to the spectrum and

400
00:13:35,850 --> 00:13:40,350
quality signal and then so this device

401
00:13:38,790 --> 00:13:42,540
will automatically connect to a network

402
00:13:40,350 --> 00:13:44,550
in its pl if it looks the same so that

403
00:13:42,540 --> 00:13:45,750
means got the same security options so

404
00:13:44,550 --> 00:13:47,760
if you're popping up a network that's an

405
00:13:45,750 --> 00:13:49,350
open Wi-Fi access point it's not going

406
00:13:47,760 --> 00:13:51,300
to automatically connect so somebody has

407
00:13:49,350 --> 00:13:52,500
to pick up their phone and click on it

408
00:13:51,300 --> 00:13:54,390
but why would they do that because their

409
00:13:52,500 --> 00:13:55,920
device is already on Wi-Fi so now you

410
00:13:54,390 --> 00:13:57,900
better like D or thumb off their

411
00:13:55,920 --> 00:13:59,520
existing Wi-Fi but because there's like

412
00:13:57,900 --> 00:14:00,930
20 access points you have to try and

413
00:13:59,520 --> 00:14:03,689
denial-of-service everyone on their

414
00:14:00,930 --> 00:14:05,099
Wi-Fi and then like that's not even the

415
00:14:03,690 --> 00:14:06,390
security guys like the the network

416
00:14:05,100 --> 00:14:08,490
admins just gonna come hit you with a

417
00:14:06,390 --> 00:14:09,810
stick and say stop it and so it's not

418
00:14:08,490 --> 00:14:11,310
particularly stealthy you've got

419
00:14:09,810 --> 00:14:13,560
wireless intrusion prevention systems

420
00:14:11,310 --> 00:14:15,479
that come along and just it gives you a

421
00:14:13,560 --> 00:14:17,099
bad time now you can do this but just

422
00:14:15,480 --> 00:14:20,280
make your life easy go buy an enterprise

423
00:14:17,100 --> 00:14:21,840
access point and Aruba or a ruckus or

424
00:14:20,280 --> 00:14:24,449
hell steal one of theirs reset the

425
00:14:21,840 --> 00:14:25,890
firmware and then make it talk to your

426
00:14:24,450 --> 00:14:27,960
manner manner can run as a standalone

427
00:14:25,890 --> 00:14:29,310
radio server it can talk to that and

428
00:14:27,960 --> 00:14:31,530
then it can capture the credits that way

429
00:14:29,310 --> 00:14:32,969
but still you've still gotta like deal

430
00:14:31,530 --> 00:14:34,110
with all of the potentials getting

431
00:14:32,970 --> 00:14:36,270
caught what's much easier and I

432
00:14:34,110 --> 00:14:38,520
mentioned it earlier don't race there

433
00:14:36,270 --> 00:14:40,500
Enterprise AP dude at the nearby coffee

434
00:14:38,520 --> 00:14:41,880
shop that they all go to somewhere where

435
00:14:40,500 --> 00:14:43,710
they don't have Wi-Fi coverage but their

436
00:14:41,880 --> 00:14:45,510
employees are becomes a target-rich

437
00:14:43,710 --> 00:14:47,580
environment and if you run this stuff on

438
00:14:45,510 --> 00:14:48,689
a pie with a battery you can leave it

439
00:14:47,580 --> 00:14:51,390
there for a couple of days you don't

440
00:14:48,690 --> 00:14:54,200
need this - and to be with you the whole

441
00:14:51,390 --> 00:14:57,480
time okay so the way that stuff works is

442
00:14:54,200 --> 00:14:59,850
I stole from a guy named Brad Antonio

443
00:14:57,480 --> 00:15:01,800
vich and and Joshua right in 2004 they

444
00:14:59,850 --> 00:15:03,450
wrote free radius WP Wireless pwnage

445
00:15:01,800 --> 00:15:04,410
edition is anyone here familiar with

446
00:15:03,450 --> 00:15:06,360
Celeste Barbour

447
00:15:04,410 --> 00:15:08,790
yeah Celeste Barbara's awesome so she

448
00:15:06,360 --> 00:15:11,130
does she'd like these disease these

449
00:15:08,790 --> 00:15:12,449
ripoffs of celebrity celebrities were

450
00:15:11,130 --> 00:15:13,770
trying to look all cool and then she'll

451
00:15:12,450 --> 00:15:15,750
be there and Underpants with like a

452
00:15:13,770 --> 00:15:17,189
bottle of wine recreating the same

453
00:15:15,750 --> 00:15:19,800
picture so this was like one of the few

454
00:15:17,190 --> 00:15:22,500
of her not in her underpants and so the

455
00:15:19,800 --> 00:15:24,359
free radius wpe stuff that Joshua and

456
00:15:22,500 --> 00:15:26,490
Brad and Tony Rich did in 2004 they like

457
00:15:24,360 --> 00:15:28,830
the the Justin Bieber under Celeste

458
00:15:26,490 --> 00:15:30,870
Barbour to their Justin Bieber and so

459
00:15:28,830 --> 00:15:32,640
we've we've implemented wpe stuff I

460
00:15:30,870 --> 00:15:35,310
still called it WP is a homage to the

461
00:15:32,640 --> 00:15:36,119
work that they've done in mana that's

462
00:15:35,310 --> 00:15:39,358
been this and

463
00:15:36,119 --> 00:15:41,039
since 2014 when we first built Manor but

464
00:15:39,359 --> 00:15:43,619
I've now extended it and taken it quite

465
00:15:41,039 --> 00:15:45,359
a lot further so on the one hand I've

466
00:15:43,619 --> 00:15:48,209
just cleaned up the output so it'll

467
00:15:45,359 --> 00:15:50,159
neatly output John hashes or hash cat

468
00:15:48,209 --> 00:15:52,138
hashes or give you the asleep command

469
00:15:50,159 --> 00:15:54,119
and stuff like that so you don't have to

470
00:15:52,139 --> 00:15:55,889
people had scripts for turning it from

471
00:15:54,119 --> 00:15:57,839
one hash to another this just gives it

472
00:15:55,889 --> 00:16:02,069
to you and the other cool thing is it

473
00:15:57,839 --> 00:16:03,629
does it has 13 different eat modes it's

474
00:16:02,069 --> 00:16:05,759
a bit of an eye chart it's on the wiki I

475
00:16:03,629 --> 00:16:08,999
mean realistically you don't run into

476
00:16:05,759 --> 00:16:11,039
this but it can do GTC you can do md5 it

477
00:16:08,999 --> 00:16:13,679
can do mschap version one mschap version

478
00:16:11,039 --> 00:16:15,329
two can do path all of that stuff so

479
00:16:13,679 --> 00:16:17,549
there's there's a pretty good chance

480
00:16:15,329 --> 00:16:19,199
that for whatever up mode you're gonna

481
00:16:17,549 --> 00:16:21,419
run into it a client it'll be able to

482
00:16:19,199 --> 00:16:23,309
intercept the the credentials or the

483
00:16:21,419 --> 00:16:25,499
hashes and it'll dump it up in a nice

484
00:16:23,309 --> 00:16:27,118
format that you can just Auto send to

485
00:16:25,499 --> 00:16:28,409
John and hash cat but this is

486
00:16:27,119 --> 00:16:30,419
realistically it's just the same

487
00:16:28,409 --> 00:16:32,729
functionality that's been in wpe or

488
00:16:30,419 --> 00:16:34,559
hostapd wpe for a couple of years and in

489
00:16:32,729 --> 00:16:36,449
mana and it's to enable it it's just

490
00:16:34,559 --> 00:16:39,419
that single command at the top in your

491
00:16:36,449 --> 00:16:41,699
host a PE country file manner WP equals

492
00:16:39,419 --> 00:16:43,919
one done so now you've got ten lines in

493
00:16:41,699 --> 00:16:45,358
your config file realistically you're

494
00:16:43,919 --> 00:16:47,639
still gonna have to set it up to be an

495
00:16:45,359 --> 00:16:49,739
EP access point with certificates and

496
00:16:47,639 --> 00:16:51,359
things the wiki's got information for

497
00:16:49,739 --> 00:16:53,279
how to do that it's really not too

498
00:16:51,359 --> 00:16:56,309
complicated you just need to generate a

499
00:16:53,279 --> 00:16:57,839
certificate and but I'll tell you I'm

500
00:16:56,309 --> 00:16:59,509
gonna go into certificates shortly

501
00:16:57,839 --> 00:17:02,009
because there's some some new ones there

502
00:16:59,509 --> 00:17:03,359
okay so this is the way people works as

503
00:17:02,009 --> 00:17:06,829
you can tell this is a highly technical

504
00:17:03,359 --> 00:17:09,689
diagram taken from the ITF and

505
00:17:06,829 --> 00:17:11,339
essentially PEEP stands for protected

506
00:17:09,689 --> 00:17:12,809
extensible authentication protocol and

507
00:17:11,339 --> 00:17:15,119
the protected part just means it's

508
00:17:12,809 --> 00:17:18,209
wrapped in TLS so there's this internal

509
00:17:15,119 --> 00:17:20,219
mschap exchange no one really cares that

510
00:17:18,209 --> 00:17:23,579
it's mschap because the the security

511
00:17:20,220 --> 00:17:24,769
comes from the TLS outer tunnel layer so

512
00:17:23,579 --> 00:17:29,039
this is a type of tunneled

513
00:17:24,769 --> 00:17:30,809
authentication protocol so look what

514
00:17:29,039 --> 00:17:32,279
that happens with TLS is much like your

515
00:17:30,809 --> 00:17:34,678
browser would if you connect to a

516
00:17:32,279 --> 00:17:36,240
website certificates presented to your

517
00:17:34,679 --> 00:17:37,710
browser your browser to make some

518
00:17:36,240 --> 00:17:40,559
decisions based on the validity of that

519
00:17:37,710 --> 00:17:42,750
website and then goes in and did anyone

520
00:17:40,559 --> 00:17:44,509
here watch parisa to Bruce's blackhat

521
00:17:42,750 --> 00:17:46,649
keynote

522
00:17:44,509 --> 00:17:49,440
anyone here familiar with person tuber

523
00:17:46,649 --> 00:17:51,419
is in the work that she's doing Google

524
00:17:49,440 --> 00:17:53,940
so person to pers runs like project zero

525
00:17:51,420 --> 00:17:56,370
and the Chrome security team so she

526
00:17:53,940 --> 00:17:58,560
quite a legend and they embarked on us

527
00:17:56,370 --> 00:18:02,219
like two year project to fix the

528
00:17:58,560 --> 00:18:03,750
iconography around SSL on the web they

529
00:18:02,220 --> 00:18:05,760
were like how do we display the right

530
00:18:03,750 --> 00:18:07,290
things to users that make them make the

531
00:18:05,760 --> 00:18:10,379
right decisions now if you think about

532
00:18:07,290 --> 00:18:12,000
in a web browser it checks that the the

533
00:18:10,380 --> 00:18:13,350
common name of the certificate matches

534
00:18:12,000 --> 00:18:15,270
the hostname that you're connecting to

535
00:18:13,350 --> 00:18:17,129
it checks that it's signed by valid

536
00:18:15,270 --> 00:18:18,480
certificate authority and there's some

537
00:18:17,130 --> 00:18:21,570
other checks like time checks things

538
00:18:18,480 --> 00:18:24,510
like that in Wi-Fi you don't have any of

539
00:18:21,570 --> 00:18:27,120
that stuff so this is an example of so

540
00:18:24,510 --> 00:18:30,210
DEFCON runs their of their Wi-Fi network

541
00:18:27,120 --> 00:18:31,949
and they send they give you all these

542
00:18:30,210 --> 00:18:33,390
configurations to make sure that if you

543
00:18:31,950 --> 00:18:35,610
connect to their Wi-Fi that stuff's

544
00:18:33,390 --> 00:18:38,130
protected so they bought a certificate

545
00:18:35,610 --> 00:18:40,409
from digi digi cert so that's the one on

546
00:18:38,130 --> 00:18:42,330
the left and on the right I've just used

547
00:18:40,410 --> 00:18:44,670
a tool of ours called a faux steel so on

548
00:18:42,330 --> 00:18:47,610
github sense boast to just clone the

549
00:18:44,670 --> 00:18:48,810
certificate chain of that so now there's

550
00:18:47,610 --> 00:18:52,409
different behavior on different devices

551
00:18:48,810 --> 00:18:54,000
so on a on a Linux or Android device the

552
00:18:52,410 --> 00:18:55,830
way you validate that the access point

553
00:18:54,000 --> 00:18:57,600
you're talking to is legit is based on

554
00:18:55,830 --> 00:18:59,699
the CA server now unless you provide

555
00:18:57,600 --> 00:19:01,169
that line it doesn't happen by default

556
00:18:59,700 --> 00:19:02,790
you have to say hey check the CA

557
00:19:01,170 --> 00:19:05,490
certificate make sure it's legitimate

558
00:19:02,790 --> 00:19:08,280
does anyone see a potential attack you

559
00:19:05,490 --> 00:19:10,560
can do against something like that it's

560
00:19:08,280 --> 00:19:12,240
a publicly publicly bought certificate

561
00:19:10,560 --> 00:19:14,399
so you can go buy a third from digi cert

562
00:19:12,240 --> 00:19:16,290
and now you two can run a legitimate

563
00:19:14,400 --> 00:19:18,390
access point and that's like all of

564
00:19:16,290 --> 00:19:20,040
Linux and Android unless they've built

565
00:19:18,390 --> 00:19:20,640
additional supplicant things WPA

566
00:19:20,040 --> 00:19:22,710
supplicant

567
00:19:20,640 --> 00:19:25,830
which is the way the client Associates

568
00:19:22,710 --> 00:19:28,200
has no ability to look at the leaf cert

569
00:19:25,830 --> 00:19:29,939
it can only look at the CI cert so you

570
00:19:28,200 --> 00:19:32,820
literally can't secure against if you

571
00:19:29,940 --> 00:19:34,380
bought a a dizzy cert global certificate

572
00:19:32,820 --> 00:19:37,080
well did you search signed certificate

573
00:19:34,380 --> 00:19:38,910
you could have gotten access to any

574
00:19:37,080 --> 00:19:41,639
network that's using keep on a public

575
00:19:38,910 --> 00:19:42,630
and a fee and this is if they've

576
00:19:41,640 --> 00:19:44,010
configured it that way because

577
00:19:42,630 --> 00:19:45,120
truthfully most of the time users just

578
00:19:44,010 --> 00:19:48,390
click on things right they're not

579
00:19:45,120 --> 00:19:50,820
setting things up that way then in

580
00:19:48,390 --> 00:19:52,950
Windows by default also it doesn't

581
00:19:50,820 --> 00:19:54,600
validate but you can also validate on CA

582
00:19:52,950 --> 00:19:55,980
so you might be familiar in Windows you

583
00:19:54,600 --> 00:19:57,480
can choose which certificate authority

584
00:19:55,980 --> 00:20:00,270
so most of the time people use an

585
00:19:57,480 --> 00:20:01,920
internal PKI and they'll validate on

586
00:20:00,270 --> 00:20:03,360
that CA that's pretty good that'll save

587
00:20:01,920 --> 00:20:04,530
you but if you use a hair

588
00:20:03,360 --> 00:20:06,299
to connect to this thing because it's

589
00:20:04,530 --> 00:20:07,590
it's not something you can enforce

590
00:20:06,299 --> 00:20:09,510
server-side it needs to be done per

591
00:20:07,590 --> 00:20:10,799
client and the second we get patching

592
00:20:09,510 --> 00:20:13,110
right is the day I'll believe that we

593
00:20:10,799 --> 00:20:14,400
can get this right across all clients it

594
00:20:13,110 --> 00:20:17,040
realistically some user is going to

595
00:20:14,400 --> 00:20:18,420
click on your network and and use it

596
00:20:17,040 --> 00:20:20,639
without having gone through your

597
00:20:18,420 --> 00:20:22,290
certificate validation thing and you can

598
00:20:20,640 --> 00:20:23,670
go after those people and maybe their

599
00:20:22,290 --> 00:20:26,700
laptops are configured well but their

600
00:20:23,670 --> 00:20:29,549
handhelds might not be and then Mac is a

601
00:20:26,700 --> 00:20:31,500
little better in that it'll look at the

602
00:20:29,549 --> 00:20:33,389
exact cert that's prevented and if it

603
00:20:31,500 --> 00:20:36,179
connects to that network again it'll pop

604
00:20:33,390 --> 00:20:37,980
it up and make the user decide which at

605
00:20:36,179 --> 00:20:39,720
least gives you the option but it

606
00:20:37,980 --> 00:20:41,010
doesn't like say hey the certs changed

607
00:20:39,720 --> 00:20:42,240
or you should watch out for this so this

608
00:20:41,010 --> 00:20:44,850
is how you could validate a cert on

609
00:20:42,240 --> 00:20:46,740
Wi-Fi so on Mac I was presented with a

610
00:20:44,850 --> 00:20:49,080
certificate like that I'd be like yeah

611
00:20:46,740 --> 00:20:50,850
and even a validly signed certificate so

612
00:20:49,080 --> 00:20:52,530
a certificate signed by valid CA on a

613
00:20:50,850 --> 00:20:53,760
Mac it'll still prompt you because

614
00:20:52,530 --> 00:20:56,730
there's no such thing as a science here

615
00:20:53,760 --> 00:20:58,799
because I see I can't say that Internet

616
00:20:56,730 --> 00:21:01,080
is a globally unique Wi-Fi name you know

617
00:20:58,799 --> 00:21:03,270
this the common name on a certificate

618
00:21:01,080 --> 00:21:05,309
can match a host name in a on a webpage

619
00:21:03,270 --> 00:21:08,340
you don't have that with Wi-Fi it's not

620
00:21:05,309 --> 00:21:10,740
like you can get hackfest CA as a

621
00:21:08,340 --> 00:21:12,659
globally unique Wi-Fi SSID that you'll

622
00:21:10,740 --> 00:21:13,830
get a certificate for so you can't match

623
00:21:12,660 --> 00:21:15,540
on common name you could only really

624
00:21:13,830 --> 00:21:17,490
match on CA and then in Windows you can

625
00:21:15,540 --> 00:21:19,290
say look match on the host name so it

626
00:21:17,490 --> 00:21:20,970
doesn't validate the knee cert but

627
00:21:19,290 --> 00:21:22,649
nobody configures that stuff I mean I've

628
00:21:20,970 --> 00:21:23,429
I've probably seen this at like two of

629
00:21:22,650 --> 00:21:24,840
our clients what they've actually

630
00:21:23,429 --> 00:21:25,890
configured it and that's mostly after

631
00:21:24,840 --> 00:21:28,439
we've done 10 tests where we had

632
00:21:25,890 --> 00:21:30,059
findings around it so you can generally

633
00:21:28,440 --> 00:21:32,309
rely on the fact that somebody in the

634
00:21:30,059 --> 00:21:33,570
organ doesn't have their certificate

635
00:21:32,309 --> 00:21:36,389
stuff configured right which is why the

636
00:21:33,570 --> 00:21:38,549
WPE stuff works and if it doesn't then

637
00:21:36,390 --> 00:21:40,530
you can just grab the certificate by

638
00:21:38,549 --> 00:21:42,150
watching passively you can pull the with

639
00:21:40,530 --> 00:21:43,889
Wireshark you can see the certificate

640
00:21:42,150 --> 00:21:45,780
that goes across and then just either

641
00:21:43,890 --> 00:21:47,250
clone it or make other decisions about

642
00:21:45,780 --> 00:21:49,260
what kind of certificate attack that

643
00:21:47,250 --> 00:21:50,910
you'll you'll do and then if they're

644
00:21:49,260 --> 00:21:52,290
using internal peaky eyes if you can get

645
00:21:50,910 --> 00:21:55,049
a certificate from somewhere else so in

646
00:21:52,290 --> 00:21:57,480
one case we've managed to fish someone I

647
00:21:55,049 --> 00:21:59,160
extracted their private certificate so

648
00:21:57,480 --> 00:22:02,400
the and certificate they'll be issued by

649
00:21:59,160 --> 00:22:03,900
ad to them and I used that as the

650
00:22:02,400 --> 00:22:06,510
certificate by the AP and because it was

651
00:22:03,900 --> 00:22:07,830
signed by the internal PK I everyone

652
00:22:06,510 --> 00:22:08,940
happily connected to that Wi-Fi access

653
00:22:07,830 --> 00:22:11,159
point even those are completely

654
00:22:08,940 --> 00:22:13,980
inappropriate certificate and so that

655
00:22:11,160 --> 00:22:16,690
stuff can work too so then the general

656
00:22:13,980 --> 00:22:18,190
solution is you should use EEP TLS

657
00:22:16,690 --> 00:22:19,930
TLS will save you you don't have any of

658
00:22:18,190 --> 00:22:21,310
these problems so eat TLS you've got the

659
00:22:19,930 --> 00:22:23,890
service lights a certificate but the

660
00:22:21,310 --> 00:22:25,060
client also has the certificate but the

661
00:22:23,890 --> 00:22:27,790
problem is if you're being a rogue

662
00:22:25,060 --> 00:22:29,110
access point you if if they are

663
00:22:27,790 --> 00:22:30,610
accepting your invalid service

664
00:22:29,110 --> 00:22:32,620
certificate then you can just accept the

665
00:22:30,610 --> 00:22:33,969
client certificate they presented you so

666
00:22:32,620 --> 00:22:36,010
the client certificate gives you trust

667
00:22:33,970 --> 00:22:37,120
to make sure you don't have bad clients

668
00:22:36,010 --> 00:22:38,920
connecting to your legitimate network

669
00:22:37,120 --> 00:22:41,050
the client certificate does nothing for

670
00:22:38,920 --> 00:22:43,570
a legitimate client connecting to a bad

671
00:22:41,050 --> 00:22:44,620
network that's what the other exchange

672
00:22:43,570 --> 00:22:47,439
is for but we've already talked about

673
00:22:44,620 --> 00:22:50,199
those problems so manners had since

674
00:22:47,440 --> 00:22:52,420
about 2015 the ability to say you know

675
00:22:50,200 --> 00:22:53,500
whatever client certificates fine so now

676
00:22:52,420 --> 00:22:55,840
you're not going to get a password with

677
00:22:53,500 --> 00:22:57,190
ETLs but you will get you'll be able to

678
00:22:55,840 --> 00:22:58,030
get them to connect your network and you

679
00:22:57,190 --> 00:22:59,380
can man in the middle of their

680
00:22:58,030 --> 00:23:00,790
communications they'll think they're

681
00:22:59,380 --> 00:23:03,130
connected to the corporate network and

682
00:23:00,790 --> 00:23:04,750
meanwhile you're going after them and

683
00:23:03,130 --> 00:23:07,210
again this is a single option in in

684
00:23:04,750 --> 00:23:12,760
manners manner underscore ETLs equals

685
00:23:07,210 --> 00:23:14,290
one so this is just kind of standard eep

686
00:23:12,760 --> 00:23:17,410
stuff but lots of people don't know this

687
00:23:14,290 --> 00:23:19,000
yeah when you see people going off to

688
00:23:17,410 --> 00:23:20,530
Wi-Fi or building scripts around it they

689
00:23:19,000 --> 00:23:22,000
aren't using these attacks and this is

690
00:23:20,530 --> 00:23:24,940
the attacks that work against enterprise

691
00:23:22,000 --> 00:23:26,080
customers so we then decided let's see

692
00:23:24,940 --> 00:23:27,730
if we can take it a bit further and we

693
00:23:26,080 --> 00:23:30,159
built something called sycophant and the

694
00:23:27,730 --> 00:23:32,290
idea behind sycophant is can we relay

695
00:23:30,160 --> 00:23:34,600
the inner mschap part of the tunnel to

696
00:23:32,290 --> 00:23:37,480
authentication from a legitimate client

697
00:23:34,600 --> 00:23:39,100
to a legitimate access point and this

698
00:23:37,480 --> 00:23:39,970
was somewhat ignorant we're like I mean

699
00:23:39,100 --> 00:23:41,679
if we can intercept the

700
00:23:39,970 --> 00:23:43,660
challenge-response surely we can we can

701
00:23:41,680 --> 00:23:45,280
relay it so if you remember the security

702
00:23:43,660 --> 00:23:47,830
of this thing comes down to that outer

703
00:23:45,280 --> 00:23:49,810
TLS so if we bypass that outer TLS and

704
00:23:47,830 --> 00:23:51,520
just relay that that tunnel the internal

705
00:23:49,810 --> 00:23:54,610
challenge that should work right we

706
00:23:51,520 --> 00:23:56,290
should be able to connect to the

707
00:23:54,610 --> 00:23:58,990
legitimate corporate corporate network

708
00:23:56,290 --> 00:24:00,100
and so Michael the guy is not here he he

709
00:23:58,990 --> 00:24:01,810
built this thing and he got it working

710
00:24:00,100 --> 00:24:03,070
and lo and behold it it worked

711
00:24:01,810 --> 00:24:04,629
and we're like now we're definitely

712
00:24:03,070 --> 00:24:05,950
doing something wrong aha this should

713
00:24:04,630 --> 00:24:07,390
not work maybe it's our testing setup

714
00:24:05,950 --> 00:24:09,460
and then we went and ran it at a client

715
00:24:07,390 --> 00:24:11,260
and it had worked and so the advantage

716
00:24:09,460 --> 00:24:15,100
here with this attack what makes it cool

717
00:24:11,260 --> 00:24:17,410
is that you can for the price of man in

718
00:24:15,100 --> 00:24:19,240
the middling the person you're targeting

719
00:24:17,410 --> 00:24:21,160
you can also authenticate to the network

720
00:24:19,240 --> 00:24:22,900
without needing to crack that hash so

721
00:24:21,160 --> 00:24:24,370
it's like a really complicated password

722
00:24:22,900 --> 00:24:26,920
cracking Emma's chat can take a little

723
00:24:24,370 --> 00:24:28,179
longer keep Moxie Marlinspike and I

724
00:24:26,920 --> 00:24:30,100
forgot the guy's name

725
00:24:28,180 --> 00:24:30,429
Def Con I think 2013 showed how you can

726
00:24:30,100 --> 00:24:31,990
like

727
00:24:30,429 --> 00:24:33,789
guarantee cracked that stuff within 24

728
00:24:31,990 --> 00:24:36,429
hours because Emma's chaps based off of

729
00:24:33,789 --> 00:24:38,110
some dead stuff but realistically you're

730
00:24:36,429 --> 00:24:39,759
on site you want to get to the network

731
00:24:38,110 --> 00:24:41,320
now you don't want to wait 24 hours well

732
00:24:39,759 --> 00:24:43,119
now you can you get instant connected to

733
00:24:41,320 --> 00:24:45,220
the network whoo-hoo and then you can

734
00:24:43,119 --> 00:24:45,820
clack crack the hash in your in your

735
00:24:45,220 --> 00:24:50,049
spare time

736
00:24:45,820 --> 00:24:51,519
um and so here's just a little demo of

737
00:24:50,049 --> 00:24:53,980
that working so I've actually cleaned up

738
00:24:51,519 --> 00:24:55,840
a lot of this it doesn't it's not so

739
00:24:53,980 --> 00:24:56,950
noisy when you run the actual code I

740
00:24:55,840 --> 00:24:59,110
just didn't get around to recording

741
00:24:56,950 --> 00:25:00,850
another video so this is running

742
00:24:59,110 --> 00:25:03,100
sycophant so this is the malicious

743
00:25:00,850 --> 00:25:04,449
supplicant and what you can see is a

744
00:25:03,100 --> 00:25:06,340
device just connected we've got the

745
00:25:04,450 --> 00:25:08,679
outer identity and the inner identity

746
00:25:06,340 --> 00:25:11,678
which is the domain testing and the user

747
00:25:08,679 --> 00:25:14,830
identity Michael and then what we'll see

748
00:25:11,679 --> 00:25:16,539
is it's now done the inner part and this

749
00:25:14,830 --> 00:25:18,939
is the challenge response and we're just

750
00:25:16,539 --> 00:25:23,019
taking that stuff and we're relaying it

751
00:25:18,940 --> 00:25:25,330
to tamanna sorry this is mana side and

752
00:25:23,019 --> 00:25:27,340
which is then had the device connected

753
00:25:25,330 --> 00:25:27,699
this is sycophant getting this wrong way

754
00:25:27,340 --> 00:25:30,279
around

755
00:25:27,700 --> 00:25:32,789
now these things actually run

756
00:25:30,279 --> 00:25:34,809
simultaneously whoops

757
00:25:32,789 --> 00:25:37,269
these things actually run simultaneously

758
00:25:34,809 --> 00:25:39,009
I'm just showing you the stuff broken up

759
00:25:37,269 --> 00:25:40,360
so that we can kind of keep track of it

760
00:25:39,009 --> 00:25:42,970
so first we run on malicious access

761
00:25:40,360 --> 00:25:45,758
point we get a connection and we relay

762
00:25:42,970 --> 00:25:47,529
it to our legitimate supplicants here

763
00:25:45,759 --> 00:25:49,720
we're running our malicious supplicant

764
00:25:47,529 --> 00:25:51,999
and we're actually connecting to the

765
00:25:49,720 --> 00:25:54,639
legitimate network or that side and

766
00:25:51,999 --> 00:25:58,809
there you can see we've connected now

767
00:25:54,639 --> 00:26:00,490
we'll look at the IP address of that

768
00:25:58,809 --> 00:26:02,168
adapter it's obviously not there because

769
00:26:00,490 --> 00:26:04,480
we haven't run DHCP but we are

770
00:26:02,169 --> 00:26:05,259
associated to the legitimate networks

771
00:26:04,480 --> 00:26:08,529
access point

772
00:26:05,259 --> 00:26:14,379
I'm gonna run th client and that's going

773
00:26:08,529 --> 00:26:16,919
to get us an IP address there we go

774
00:26:14,379 --> 00:26:20,139
we've got an IP address and then gonna

775
00:26:16,919 --> 00:26:22,179
and switch over to the browser and make

776
00:26:20,139 --> 00:26:24,490
a network connection over there so this

777
00:26:22,179 --> 00:26:25,509
is a an actual attack that works we've

778
00:26:24,490 --> 00:26:27,610
used it in a couple of client

779
00:26:25,509 --> 00:26:29,289
engagements if you can if you can get

780
00:26:27,610 --> 00:26:31,899
access to the credentials by doing WP e

781
00:26:29,289 --> 00:26:33,009
attacks you can probably do a relay and

782
00:26:31,899 --> 00:26:36,248
this is the kind of thing that's

783
00:26:33,009 --> 00:26:37,419
automated happens instantly and it's a

784
00:26:36,249 --> 00:26:40,440
really quick way to get on a network

785
00:26:37,419 --> 00:26:43,149
without needing to do too much work so

786
00:26:40,440 --> 00:26:44,409
that's available now it's called WPS

787
00:26:43,149 --> 00:26:46,418
sycophant

788
00:26:44,409 --> 00:26:48,429
and I asked Michael hey would you know

789
00:26:46,419 --> 00:26:50,049
some modern stuff we need a logo for it

790
00:26:48,429 --> 00:26:53,620
so he's like I think this logo would be

791
00:26:50,049 --> 00:26:55,629
would be fantastic and and he meant it

792
00:26:53,620 --> 00:26:58,000
as a joke but it's now been been

793
00:26:55,630 --> 00:27:00,220
immortalized so this is a squirtle boy

794
00:26:58,000 --> 00:27:01,720
so if you ever meet Michael or you want

795
00:27:00,220 --> 00:27:03,370
to talk about Michael hashtag squirtle

796
00:27:01,720 --> 00:27:06,340
boy with an I would be an appropriate

797
00:27:03,370 --> 00:27:07,870
way to refer to him and so he's writing

798
00:27:06,340 --> 00:27:09,970
and maintaining sycophants if you go to

799
00:27:07,870 --> 00:27:12,399
that Wi-Fi page you can grab it it works

800
00:27:09,970 --> 00:27:14,049
with Nana right now and and it and it

801
00:27:12,399 --> 00:27:18,459
works well so what's interesting about

802
00:27:14,049 --> 00:27:21,039
this is in 2002 Osaka eme and Nyberg

803
00:27:18,460 --> 00:27:23,320
proposed from Nokia proposed this exact

804
00:27:21,039 --> 00:27:24,970
attack they said hey there's this a risk

805
00:27:23,320 --> 00:27:29,129
with tunnelled authentication modes that

806
00:27:24,970 --> 00:27:34,059
you might relay the the inner part so in

807
00:27:29,130 --> 00:27:35,980
2000 and in 20 in 2004 when they

808
00:27:34,059 --> 00:27:37,360
actually ITF released the standard they

809
00:27:35,980 --> 00:27:40,690
had a whole section in it talking about

810
00:27:37,360 --> 00:27:43,689
crypto binding so crypto binding is

811
00:27:40,690 --> 00:27:44,889
making sure that the outer tunnel the

812
00:27:43,690 --> 00:27:46,059
outer part of the Sam on the inner part

813
00:27:44,889 --> 00:27:48,100
of the tunnel happened between the same

814
00:27:46,059 --> 00:27:49,690
devices reusing some key material

815
00:27:48,100 --> 00:27:52,600
between one or the other so there's a

816
00:27:49,690 --> 00:27:54,159
defense against this thing and but

817
00:27:52,600 --> 00:27:56,949
what's interesting about it is there's a

818
00:27:54,159 --> 00:27:58,570
lack of practical attacks so we I mean

819
00:27:56,950 --> 00:28:00,490
the attacks been written up in detail we

820
00:27:58,570 --> 00:28:01,809
found that after the fact it was built

821
00:28:00,490 --> 00:28:04,510
into the standard so the stuff shouldn't

822
00:28:01,809 --> 00:28:07,240
work why does it work well so this is

823
00:28:04,510 --> 00:28:09,669
our windows radius server and by default

824
00:28:07,240 --> 00:28:11,409
it's got an option to disconnect clients

825
00:28:09,669 --> 00:28:12,940
with our crypto binding but it doesn't

826
00:28:11,409 --> 00:28:14,559
so from a server side you could actually

827
00:28:12,940 --> 00:28:16,929
prevent a client from connecting if it

828
00:28:14,559 --> 00:28:18,100
doesn't support crypto binding but by

829
00:28:16,929 --> 00:28:19,750
default you don't do that because people

830
00:28:18,100 --> 00:28:22,000
don't have stopped clients from

831
00:28:19,750 --> 00:28:23,860
associating to their network and in

832
00:28:22,000 --> 00:28:25,860
addition to that sorry I see you're

833
00:28:23,860 --> 00:28:28,120
taking a picture there and wait a little

834
00:28:25,860 --> 00:28:31,149
if you look at the default Windows

835
00:28:28,120 --> 00:28:34,000
Windows 10 latest updates you can also

836
00:28:31,149 --> 00:28:35,289
tell your client to disconnect if the

837
00:28:34,000 --> 00:28:37,960
server doesn't support crypto binding

838
00:28:35,289 --> 00:28:40,120
but again that's not it's not done by

839
00:28:37,960 --> 00:28:41,649
default and what we found is that pretty

840
00:28:40,120 --> 00:28:44,139
much all clients will not do crypto

841
00:28:41,649 --> 00:28:46,870
binding by default interestingly while

842
00:28:44,139 --> 00:28:48,549
WPS applicant is a bit terrible with

843
00:28:46,870 --> 00:28:50,799
certificates it does enable crypto

844
00:28:48,549 --> 00:28:52,720
binding by default so it looks like

845
00:28:50,799 --> 00:28:54,279
Android devices get some free protection

846
00:28:52,720 --> 00:28:56,740
because of that Android and Linux

847
00:28:54,279 --> 00:28:58,090
devices but most of the time we're going

848
00:28:56,740 --> 00:29:00,130
off to Windows devices and the

849
00:28:58,090 --> 00:29:01,928
stuff isn't enabled so the easy thought

850
00:29:00,130 --> 00:29:04,390
is well if I'm a server admin I could

851
00:29:01,929 --> 00:29:05,770
just tick this box and away we go the

852
00:29:04,390 --> 00:29:07,330
problem with that is now misconfigured

853
00:29:05,770 --> 00:29:08,980
devices can't connect to the network and

854
00:29:07,330 --> 00:29:11,649
as much as we'd like to think that

855
00:29:08,980 --> 00:29:12,520
security should be a blocker it really

856
00:29:11,650 --> 00:29:15,250
shouldn't be you're just gonna have

857
00:29:12,520 --> 00:29:16,480
people throwing things at you and so

858
00:29:15,250 --> 00:29:17,799
this is probably gonna exist for a

859
00:29:16,480 --> 00:29:19,360
little while and there were some

860
00:29:17,799 --> 00:29:21,010
practical implementations that came

861
00:29:19,360 --> 00:29:22,959
close but nothing that you can run now

862
00:29:21,010 --> 00:29:25,080
that you can run into n so this is the

863
00:29:22,960 --> 00:29:28,179
first practical implementation of a

864
00:29:25,080 --> 00:29:29,439
decade and a half year old proposed idea

865
00:29:28,179 --> 00:29:32,679
so we made the theoretical practical

866
00:29:29,440 --> 00:29:34,809
works really really well okay so the

867
00:29:32,679 --> 00:29:39,010
third scenario is Mallory in the middle

868
00:29:34,809 --> 00:29:40,840
and the idea here is once the device is

869
00:29:39,010 --> 00:29:43,600
connected you now want to start doing

870
00:29:40,840 --> 00:29:45,129
some stuff so in in 2014 when we first

871
00:29:43,600 --> 00:29:46,629
released the manna toolkit we released

872
00:29:45,130 --> 00:29:49,299
it was a whole bunch of scripts that

873
00:29:46,630 --> 00:29:51,640
would set up networks that would run SSL

874
00:29:49,299 --> 00:29:53,500
strip and they were all tested to

875
00:29:51,640 --> 00:29:55,149
actually work with modern devices so

876
00:29:53,500 --> 00:29:57,039
that you could get passwords and that

877
00:29:55,149 --> 00:29:59,439
stuff mostly worked quite well the

878
00:29:57,039 --> 00:30:01,330
problem is it kind of tried to automate

879
00:29:59,440 --> 00:30:03,010
a bunch of stuff that like if you didn't

880
00:30:01,330 --> 00:30:06,039
understand basic networking you're gonna

881
00:30:03,010 --> 00:30:07,629
have a bad day and maybe like using

882
00:30:06,039 --> 00:30:09,129
automated ascription understand wasn't

883
00:30:07,630 --> 00:30:10,720
the best idea so people just like

884
00:30:09,130 --> 00:30:17,169
flooded me with help requests of like

885
00:30:10,720 --> 00:30:18,010
what is a DHCP so since then a better

886
00:30:17,169 --> 00:30:20,559
cap came along

887
00:30:18,010 --> 00:30:21,610
it's a toolkit and built by evil socket

888
00:30:20,559 --> 00:30:23,590
and it's awesome

889
00:30:21,610 --> 00:30:26,520
and it just does all of this stuff in a

890
00:30:23,590 --> 00:30:27,850
nice go framework with decent plugins

891
00:30:26,520 --> 00:30:29,830
everything works

892
00:30:27,850 --> 00:30:31,539
so I've deprecated manna toolkit and

893
00:30:29,830 --> 00:30:33,908
what I'm saying is just use just use

894
00:30:31,539 --> 00:30:35,740
better cap and there's nothing there's

895
00:30:33,909 --> 00:30:37,539
no magic that manna does with better cap

896
00:30:35,740 --> 00:30:39,159
they just work really well together if

897
00:30:37,539 --> 00:30:41,830
you follow evil socket stuff you'll see

898
00:30:39,159 --> 00:30:43,510
he regularly uses Manitou and to get to

899
00:30:41,830 --> 00:30:45,340
an interception point to test things

900
00:30:43,510 --> 00:30:47,440
with with better cap so they work really

901
00:30:45,340 --> 00:30:49,389
well together once man is running on an

902
00:30:47,440 --> 00:30:50,890
interface you just point better cap to

903
00:30:49,390 --> 00:30:53,110
that interface wlan0

904
00:30:50,890 --> 00:30:54,789
or whatever what we're still left with

905
00:30:53,110 --> 00:30:57,370
though is the problem of orchestrating

906
00:30:54,789 --> 00:30:58,750
the networking behind access points so a

907
00:30:57,370 --> 00:31:00,309
lot of what manna toolkit was doing is

908
00:30:58,750 --> 00:31:02,860
saying well I create an enterprise API

909
00:31:00,309 --> 00:31:04,389
or create an open network and what a lot

910
00:31:02,860 --> 00:31:06,129
of the Python scripts that are out there

911
00:31:04,390 --> 00:31:08,380
or go scripts that people are writing or

912
00:31:06,130 --> 00:31:11,810
to do that stuff so if anyone's familiar

913
00:31:08,380 --> 00:31:13,160
with this project create ap and so

914
00:31:11,810 --> 00:31:15,350
like it's not for creating evil access

915
00:31:13,160 --> 00:31:19,370
points this is just for automating host

916
00:31:15,350 --> 00:31:20,959
AP and I think it's from the forgotten

917
00:31:19,370 --> 00:31:22,429
Jeff it's one of the distributions

918
00:31:20,960 --> 00:31:24,080
anyway it works really well if you need

919
00:31:22,430 --> 00:31:25,580
to create access points like you can run

920
00:31:24,080 --> 00:31:27,050
a one line a simple one line and you've

921
00:31:25,580 --> 00:31:28,399
got an access point so we thought well

922
00:31:27,050 --> 00:31:30,800
it'd be really cool if we could use this

923
00:31:28,400 --> 00:31:32,270
to do the orchestration for manner so

924
00:31:30,800 --> 00:31:34,550
you know the most important thing is

925
00:31:32,270 --> 00:31:37,280
first to name it and so we just called

926
00:31:34,550 --> 00:31:39,409
it berate AP and like what's really cool

927
00:31:37,280 --> 00:31:43,160
about it is that command if you wanted

928
00:31:39,410 --> 00:31:44,750
to do an evil evil twin attack like

929
00:31:43,160 --> 00:31:47,210
that's the command that'll do it plus a

930
00:31:44,750 --> 00:31:48,860
little enable manner so you know it'll

931
00:31:47,210 --> 00:31:51,440
set up the networking for you it'll

932
00:31:48,860 --> 00:31:53,449
generate the hostapd configuration for

933
00:31:51,440 --> 00:31:56,210
you and all of that stuff it's also got

934
00:31:53,450 --> 00:31:58,850
other options so you can do all of this

935
00:31:56,210 --> 00:32:00,410
stuff but this the sycophants not stuffs

936
00:31:58,850 --> 00:32:02,719
not quite working there yet it's still a

937
00:32:00,410 --> 00:32:05,120
little manual and but it just makes a

938
00:32:02,720 --> 00:32:07,130
point-and-click easy not point-and-click

939
00:32:05,120 --> 00:32:09,110
but its straightforward and you can and

940
00:32:07,130 --> 00:32:11,240
you can do this without getting into the

941
00:32:09,110 --> 00:32:12,919
guts of the hostapd configurations that

942
00:32:11,240 --> 00:32:14,510
said I would really encourage you to get

943
00:32:12,920 --> 00:32:15,740
into the guts of hostapd configurations

944
00:32:14,510 --> 00:32:18,080
and don't be scared like I pointed out

945
00:32:15,740 --> 00:32:20,510
four lines gives you an access point so

946
00:32:18,080 --> 00:32:21,679
this isn't hugely confirmed difficult if

947
00:32:20,510 --> 00:32:23,900
you don't understand how things like

948
00:32:21,680 --> 00:32:26,150
DHCP work how networking and routing

949
00:32:23,900 --> 00:32:27,410
works or firewalls work it's useful to

950
00:32:26,150 --> 00:32:29,060
look at the stuff this is generating

951
00:32:27,410 --> 00:32:31,370
it's really simple math configurations

952
00:32:29,060 --> 00:32:32,659
really simple DHCP configurations but

953
00:32:31,370 --> 00:32:34,070
it's a nice way to get into networking

954
00:32:32,660 --> 00:32:35,300
and that's part of the problem with

955
00:32:34,070 --> 00:32:37,700
Wi-Fi hacking is it requires you to

956
00:32:35,300 --> 00:32:40,010
understand you know RF it requires you

957
00:32:37,700 --> 00:32:41,780
to understand layer 3 fact networking

958
00:32:40,010 --> 00:32:43,879
stuff plus it requires you to understand

959
00:32:41,780 --> 00:32:45,350
sort of protocol interception and so

960
00:32:43,880 --> 00:32:47,090
there's a lot to get into so take the

961
00:32:45,350 --> 00:32:48,800
automated tools and rather like unpack

962
00:32:47,090 --> 00:32:51,490
what's actually going on instead of just

963
00:32:48,800 --> 00:32:55,220
going they'll do the magic for me

964
00:32:51,490 --> 00:32:56,600
and so it's what we say is if if you if

965
00:32:55,220 --> 00:32:57,710
you don't figure out how tool works then

966
00:32:56,600 --> 00:32:59,419
the tools limitations are your

967
00:32:57,710 --> 00:33:01,070
limitation but if you figure out how the

968
00:32:59,420 --> 00:33:02,810
tools work them that their tools your

969
00:33:01,070 --> 00:33:07,490
jumping off point for like creating new

970
00:33:02,810 --> 00:33:09,379
things ok so by default man is quite a

971
00:33:07,490 --> 00:33:11,210
flame syrup so like particularly in loud

972
00:33:09,380 --> 00:33:13,310
mode it's literally looking at every

973
00:33:11,210 --> 00:33:15,230
probe coming from every device around it

974
00:33:13,310 --> 00:33:17,330
and as rebroadcasting that at every one

975
00:33:15,230 --> 00:33:19,160
and and it works really well like I've

976
00:33:17,330 --> 00:33:21,110
spent years now optimizing that to make

977
00:33:19,160 --> 00:33:24,050
sure it can reasonably like blanket a

978
00:33:21,110 --> 00:33:25,649
room like this and respond to all of the

979
00:33:24,050 --> 00:33:29,070
the probe requests that are happening

980
00:33:25,650 --> 00:33:31,410
and not fall over and like it you know

981
00:33:29,070 --> 00:33:33,480
if you look at things like hostapd wpe

982
00:33:31,410 --> 00:33:35,309
it's got comma in and what that does

983
00:33:33,480 --> 00:33:36,720
like the way it changes beacons that

984
00:33:35,309 --> 00:33:38,610
doesn't scale beyond two or three

985
00:33:36,720 --> 00:33:40,830
devices or it certainly doesn't scale

986
00:33:38,610 --> 00:33:44,340
beyond five devices like manna can do a

987
00:33:40,830 --> 00:33:45,929
rumor it can it can handle I haven't

988
00:33:44,340 --> 00:33:47,250
done like extensive tests but like if

989
00:33:45,930 --> 00:33:49,530
there's a hundred devices it's not gonna

990
00:33:47,250 --> 00:33:50,970
fall over it becomes more of an RF

991
00:33:49,530 --> 00:33:52,350
problem there's this something called

992
00:33:50,970 --> 00:33:53,430
the hidden node problem so if you can

993
00:33:52,350 --> 00:33:54,809
imagine if I'm standing next to you

994
00:33:53,430 --> 00:33:56,820
screaming you're probably not gonna be

995
00:33:54,809 --> 00:33:57,629
able to hear the person whispering at

996
00:33:56,820 --> 00:33:59,129
the background

997
00:33:57,630 --> 00:34:00,840
similarly if I've got an access point

998
00:33:59,130 --> 00:34:03,059
here that screaming probes at everyone

999
00:34:00,840 --> 00:34:04,949
it's probably not going to hear somebody

1000
00:34:03,059 --> 00:34:06,600
in the the back of the room so that's

1001
00:34:04,950 --> 00:34:09,990
why I say use Enterprise APs and make

1002
00:34:06,600 --> 00:34:11,969
sure you you place things correctly but

1003
00:34:09,989 --> 00:34:13,620
one of the problems we ran into is this

1004
00:34:11,969 --> 00:34:15,330
concept of proportionality I mean it

1005
00:34:13,620 --> 00:34:17,549
would be illegal to target people who

1006
00:34:15,330 --> 00:34:20,129
aren't in scope for for the penetration

1007
00:34:17,550 --> 00:34:23,700
test so we built some proportionality

1008
00:34:20,129 --> 00:34:25,589
options in the so there's some really

1009
00:34:23,699 --> 00:34:28,350
obvious proportionality options are like

1010
00:34:25,590 --> 00:34:30,320
SSID whitelisting things like that but

1011
00:34:28,350 --> 00:34:34,589
the one I'm really proud of is

1012
00:34:30,320 --> 00:34:36,330
management frame ACLs so any of you

1013
00:34:34,590 --> 00:34:38,070
configured a wireless network before

1014
00:34:36,330 --> 00:34:39,960
we'll know at your home you've got the

1015
00:34:38,070 --> 00:34:41,940
option to restrict by MAC address who

1016
00:34:39,960 --> 00:34:43,110
can associate to it and anyone who's

1017
00:34:41,940 --> 00:34:44,639
done Wi-Fi hacking before will know

1018
00:34:43,110 --> 00:34:45,870
that's a really stupid restriction

1019
00:34:44,639 --> 00:34:48,090
because you can just go into monitor

1020
00:34:45,870 --> 00:34:52,350
mode and see what the MAC address is and

1021
00:34:48,090 --> 00:34:53,790
connect and and then even people who use

1022
00:34:52,350 --> 00:34:55,199
MAC addresses aren't authorized they'll

1023
00:34:53,790 --> 00:34:56,399
still see that network in their list

1024
00:34:55,199 --> 00:34:58,319
they'll look at their phone and there's

1025
00:34:56,399 --> 00:34:58,830
your home network there and you can make

1026
00:34:58,320 --> 00:35:00,540
it hidden

1027
00:34:58,830 --> 00:35:01,770
but then the devices end up probing for

1028
00:35:00,540 --> 00:35:03,840
the network the whole time so you end up

1029
00:35:01,770 --> 00:35:06,540
with a sort of imperfect world so what I

1030
00:35:03,840 --> 00:35:08,250
did is I extended MAC address ACLs down

1031
00:35:06,540 --> 00:35:10,560
to the management frames so what that

1032
00:35:08,250 --> 00:35:13,230
means is if your MAC address is either

1033
00:35:10,560 --> 00:35:15,360
blacklisted or not in the whitelist then

1034
00:35:13,230 --> 00:35:16,650
manna won't even respond to your probe

1035
00:35:15,360 --> 00:35:18,750
request so just gonna ignore your probe

1036
00:35:16,650 --> 00:35:20,400
requests so that means that it's not

1037
00:35:18,750 --> 00:35:23,490
going to see that network even show up

1038
00:35:20,400 --> 00:35:25,320
and on the flip side and a loud device

1039
00:35:23,490 --> 00:35:26,970
will but the other problem we run into

1040
00:35:25,320 --> 00:35:28,410
is well these randomized MAC addresses

1041
00:35:26,970 --> 00:35:30,689
if you only whitelist

1042
00:35:28,410 --> 00:35:32,399
the the MAC addresses of the people

1043
00:35:30,690 --> 00:35:33,600
you're targeting the randomized MAC

1044
00:35:32,400 --> 00:35:35,760
addresses are going to be blacklisted

1045
00:35:33,600 --> 00:35:37,529
and that's a problem

1046
00:35:35,760 --> 00:35:39,120
so if you've ever played with Advanced

1047
00:35:37,530 --> 00:35:39,570
Options in Aero dump they've got this

1048
00:35:39,120 --> 00:35:41,730
idea

1049
00:35:39,570 --> 00:35:43,770
like a binary netmask that you can apply

1050
00:35:41,730 --> 00:35:46,440
to MAC addresses so I've brought that

1051
00:35:43,770 --> 00:35:48,750
into the Mac the general ACL for hostapd

1052
00:35:46,440 --> 00:35:50,070
so you can use it at the association

1053
00:35:48,750 --> 00:35:53,130
level or at this management frame level

1054
00:35:50,070 --> 00:35:54,900
and so you can say for example all

1055
00:35:53,130 --> 00:35:57,180
randomized MAC addresses are white

1056
00:35:54,900 --> 00:36:00,450
listed but then only this MAC address is

1057
00:35:57,180 --> 00:36:02,819
white listed - to associate but

1058
00:36:00,450 --> 00:36:04,740
depending on the randomization that's

1059
00:36:02,820 --> 00:36:08,310
being being used so like Windows will

1060
00:36:04,740 --> 00:36:10,859
randomize per network whereas Mac or iOS

1061
00:36:08,310 --> 00:36:12,180
devices will randomize per probe that

1062
00:36:10,860 --> 00:36:13,770
they're doing so you can choose your

1063
00:36:12,180 --> 00:36:16,500
strategy based on on what you're

1064
00:36:13,770 --> 00:36:17,790
targeting but with that that means that

1065
00:36:16,500 --> 00:36:20,310
you can sort of for example do partial

1066
00:36:17,790 --> 00:36:21,840
loud mode hey I want to see and respond

1067
00:36:20,310 --> 00:36:24,600
to every Pro but only allow this device

1068
00:36:21,840 --> 00:36:25,650
to associate and even though it's

1069
00:36:24,600 --> 00:36:27,150
responding to the randomized MAC

1070
00:36:25,650 --> 00:36:29,430
addresses just saw only the allowed

1071
00:36:27,150 --> 00:36:31,260
device on a Mac or an iOS device will

1072
00:36:29,430 --> 00:36:32,850
see that Network show up and they're

1073
00:36:31,260 --> 00:36:35,070
allowed network lists so that's also

1074
00:36:32,850 --> 00:36:36,480
really great if you're like historically

1075
00:36:35,070 --> 00:36:37,650
running loud mode was really obvious to

1076
00:36:36,480 --> 00:36:39,510
any security people who might be

1077
00:36:37,650 --> 00:36:41,790
watching you because they'd see like 200

1078
00:36:39,510 --> 00:36:43,890
networks appear in the nearby network

1079
00:36:41,790 --> 00:36:44,970
list now you can hide that from them or

1080
00:36:43,890 --> 00:36:46,529
if there's wireless intrusion prevention

1081
00:36:44,970 --> 00:36:48,689
systems you can hide the stuff from them

1082
00:36:46,530 --> 00:36:50,670
and nobody has implemented this anywhere

1083
00:36:48,690 --> 00:36:55,650
I don't know why and so it looks

1084
00:36:50,670 --> 00:36:56,940
different enough that you can most

1085
00:36:55,650 --> 00:36:58,170
wireless intrusion prevention systems

1086
00:36:56,940 --> 00:37:00,110
haven't caught up with it you can kind

1087
00:36:58,170 --> 00:37:02,670
of hide in plain sight

1088
00:37:00,110 --> 00:37:04,200
alright now the other problem I think

1089
00:37:02,670 --> 00:37:06,120
that people have with Wi-Fi hacking is

1090
00:37:04,200 --> 00:37:07,200
you've got to buy hardware and you got

1091
00:37:06,120 --> 00:37:09,509
to make sure you aren't like running

1092
00:37:07,200 --> 00:37:11,129
afoul of FCC laws and things like that

1093
00:37:09,510 --> 00:37:13,110
it's just kind of hard to get into and

1094
00:37:11,130 --> 00:37:14,700
then you like you buy the latest elf or

1095
00:37:13,110 --> 00:37:16,950
black at DEFCON and it turns out it

1096
00:37:14,700 --> 00:37:19,200
doesn't work with mana stuff because of

1097
00:37:16,950 --> 00:37:23,279
the way the firmware runs on the device

1098
00:37:19,200 --> 00:37:24,600
rather than on the the software

1099
00:37:23,280 --> 00:37:26,540
therefore it's worth on the wiki it's

1100
00:37:24,600 --> 00:37:28,830
got a list of hardware that that works

1101
00:37:26,540 --> 00:37:32,220
with the staff or at least known to work

1102
00:37:28,830 --> 00:37:33,930
or partially works so Michael the guy

1103
00:37:32,220 --> 00:37:37,259
that I did this with he's a kendo nerd

1104
00:37:33,930 --> 00:37:39,299
and if you are a kendo nerd - you'll

1105
00:37:37,260 --> 00:37:40,830
know that those wooden bamboo swords are

1106
00:37:39,300 --> 00:37:41,850
called Shan eyes so they practice swords

1107
00:37:40,830 --> 00:37:44,100
you're not gonna cut someone's ear off

1108
00:37:41,850 --> 00:37:45,690
you just like hit their stupid thing

1109
00:37:44,100 --> 00:37:49,049
that they were as you can tell I have

1110
00:37:45,690 --> 00:37:50,940
deep respect for Kenda I'm sorry and so

1111
00:37:49,050 --> 00:37:53,160
what a couple of years ago we do a bunch

1112
00:37:50,940 --> 00:37:54,450
of commercial trainings and we

1113
00:37:53,160 --> 00:37:56,520
entered the stuff we called Wi-Fi in the

1114
00:37:54,450 --> 00:37:58,410
cloud which is if it like how do on our

1115
00:37:56,520 --> 00:37:59,700
challenge was how do we present AWS

1116
00:37:58,410 --> 00:38:01,348
environments to students so that they

1117
00:37:59,700 --> 00:38:03,210
could practice Wi-Fi hacking without

1118
00:38:01,349 --> 00:38:04,859
actually like giving them hardware and

1119
00:38:03,210 --> 00:38:06,780
making the stuff repeatable so he came

1120
00:38:04,859 --> 00:38:09,299
up with stuff that worked I'm still sort

1121
00:38:06,780 --> 00:38:10,650
of amazed that it does work but the

1122
00:38:09,299 --> 00:38:12,720
problem was it was kind of buried away

1123
00:38:10,650 --> 00:38:14,430
in our commercial training so I've

1124
00:38:12,720 --> 00:38:18,598
created a docker image called Shanaya

1125
00:38:14,430 --> 00:38:19,828
and it allows you to and to practice

1126
00:38:18,599 --> 00:38:22,890
Wi-Fi hacking without needing any

1127
00:38:19,829 --> 00:38:24,569
hardware so it uses a module a Linux

1128
00:38:22,890 --> 00:38:26,609
kernel module called Mac ADA to 11 under

1129
00:38:24,569 --> 00:38:28,950
school HW sim so if you're running Linux

1130
00:38:26,609 --> 00:38:30,270
yourself you can just modprobe that that

1131
00:38:28,950 --> 00:38:32,038
module in it's part of the default

1132
00:38:30,270 --> 00:38:35,009
kernels nothing fancy and then you get

1133
00:38:32,039 --> 00:38:38,609
these two simulated hardware devices

1134
00:38:35,010 --> 00:38:41,339
wireless devices and if you're running

1135
00:38:38,609 --> 00:38:43,500
Kali that stuff works out of the box if

1136
00:38:41,339 --> 00:38:45,500
you're running docker on Windows or Mac

1137
00:38:43,500 --> 00:38:49,559
it's a little more complicated because

1138
00:38:45,500 --> 00:38:51,390
they use an interstitial VM effectively

1139
00:38:49,559 --> 00:38:53,069
that functions is the docker host and

1140
00:38:51,390 --> 00:38:54,420
you've got a like rebuild the kernel and

1141
00:38:53,069 --> 00:38:56,279
I may have gotten a cease and desist

1142
00:38:54,420 --> 00:38:58,740
from darker telling me not to do the

1143
00:38:56,280 --> 00:39:00,329
reverse engineering on their staff you

1144
00:38:58,740 --> 00:39:04,140
may be able to ignore that on github.com

1145
00:39:00,329 --> 00:39:05,849
forward slash singe and but anyway just

1146
00:39:04,140 --> 00:39:06,569
yeah run it on a Linux VM it'll make

1147
00:39:05,849 --> 00:39:09,900
your life easier

1148
00:39:06,569 --> 00:39:12,058
but all you do is you so you would do

1149
00:39:09,900 --> 00:39:14,490
docker pull scintillate forward slash

1150
00:39:12,059 --> 00:39:17,730
and I Phi and you can grab it right now

1151
00:39:14,490 --> 00:39:20,160
and then this is this is that container

1152
00:39:17,730 --> 00:39:23,160
running and with no hardware attached to

1153
00:39:20,160 --> 00:39:25,700
it so I'm saying show me a Wi-Fi adapter

1154
00:39:23,160 --> 00:39:28,319
you can see there's a Wi-Fi adapter and

1155
00:39:25,700 --> 00:39:30,868
I'd then put it into monitor mode I mean

1156
00:39:28,319 --> 00:39:31,680
this is bog-standard this is that ten

1157
00:39:30,869 --> 00:39:34,730
minutes okay

1158
00:39:31,680 --> 00:39:37,368
I just want to double high-five yeah

1159
00:39:34,730 --> 00:39:39,270
okay so putting it into monitor mode and

1160
00:39:37,369 --> 00:39:41,819
you can see there it says software

1161
00:39:39,270 --> 00:39:43,770
simulated beta 211 radios and then we

1162
00:39:41,819 --> 00:39:46,440
run arrow dump so this would normally

1163
00:39:43,770 --> 00:39:48,660
show you traffic nearby which it's doing

1164
00:39:46,440 --> 00:39:51,180
even though this is all fake so in the

1165
00:39:48,660 --> 00:39:52,950
backend I've got like cron jobs and TCP

1166
00:39:51,180 --> 00:39:55,140
replay but the star surprisingly robust

1167
00:39:52,950 --> 00:39:56,609
like it actually works and I've run it

1168
00:39:55,140 --> 00:39:59,038
for enough years that I figured out all

1169
00:39:56,609 --> 00:40:02,190
of the the weird states that things get

1170
00:39:59,039 --> 00:40:04,740
into and so yeah if you want to this is

1171
00:40:02,190 --> 00:40:06,870
again the the docker file is all on and

1172
00:40:04,740 --> 00:40:08,339
github you can check out hearts put

1173
00:40:06,870 --> 00:40:10,650
if you want to build your own CTS using

1174
00:40:08,340 --> 00:40:12,480
the stuff and you just literally replace

1175
00:40:10,650 --> 00:40:14,820
the cap file and from a monitor mode

1176
00:40:12,480 --> 00:40:16,590
level you'd get this but it's also got

1177
00:40:14,820 --> 00:40:18,030
like if you're running if you run an

1178
00:40:16,590 --> 00:40:19,680
access point clients will try and

1179
00:40:18,030 --> 00:40:22,350
connect you with people and things like

1180
00:40:19,680 --> 00:40:23,640
that so you can practice a whole bunch

1181
00:40:22,350 --> 00:40:25,710
of this stuff without needing the actual

1182
00:40:23,640 --> 00:40:29,850
hardware and I'm hoping it gets more

1183
00:40:25,710 --> 00:40:30,860
people into you into Wi-Fi hacking yeah

1184
00:40:29,850 --> 00:40:32,910
where are we here

1185
00:40:30,860 --> 00:40:35,610
that was just my screenshot in case the

1186
00:40:32,910 --> 00:40:37,830
video didn't work okay so that's the

1187
00:40:35,610 --> 00:40:39,420
kind of the end of our talk like I said

1188
00:40:37,830 --> 00:40:39,870
the Wi-Fi dotnet is where you can get

1189
00:40:39,420 --> 00:40:41,580
this

1190
00:40:39,870 --> 00:40:43,500
I'm from sense post and those are our

1191
00:40:41,580 --> 00:40:46,020
twitter handles and really what i was

1192
00:40:43,500 --> 00:40:48,000
just what ideally like to take you to

1193
00:40:46,020 --> 00:40:49,380
take away from this is on the one hand

1194
00:40:48,000 --> 00:40:51,870
this is how like modern Wi-Fi hacking

1195
00:40:49,380 --> 00:40:53,330
needs to happen we can't rely on some of

1196
00:40:51,870 --> 00:40:56,430
the old stuff it's going to be very

1197
00:40:53,330 --> 00:40:57,720
rogue access point based but but more

1198
00:40:56,430 --> 00:40:59,430
importantly what I'd like to take is

1199
00:40:57,720 --> 00:41:01,379
that go and tinker with this stuff it

1200
00:40:59,430 --> 00:41:02,490
works really well if you're a defender

1201
00:41:01,380 --> 00:41:04,380
figure out where your networks are

1202
00:41:02,490 --> 00:41:07,350
vulnerable like peep is not the way to

1203
00:41:04,380 --> 00:41:08,760
go and ETLs is not a panacea understand

1204
00:41:07,350 --> 00:41:11,460
those constraints and builds better

1205
00:41:08,760 --> 00:41:13,530
networks by by targeting yourself and if

1206
00:41:11,460 --> 00:41:14,670
you're a penetration tester and then you

1207
00:41:13,530 --> 00:41:16,440
should absolutely be using this because

1208
00:41:14,670 --> 00:41:17,940
it works against enterprise networks and

1209
00:41:16,440 --> 00:41:19,020
if you want to get into penetration

1210
00:41:17,940 --> 00:41:22,620
testing Wi-Fi is a really easy

1211
00:41:19,020 --> 00:41:26,280
accessible way to get into this and and

1212
00:41:22,620 --> 00:41:28,170
it's it's like a lifelong lifelong field

1213
00:41:26,280 --> 00:41:30,210
if you're interested in the specifics of

1214
00:41:28,170 --> 00:41:32,580
this so thank you very much for your

1215
00:41:30,210 --> 00:41:33,180
time and thank you hack fest for having

1216
00:41:32,580 --> 00:41:36,840
you

1217
00:41:33,180 --> 00:41:36,839
[Applause]

1218
00:41:39,720 --> 00:41:47,709
anyone want to ask any questions anyone

1219
00:41:43,990 --> 00:41:49,330
want to throw any rotten fruit Canadians

1220
00:41:47,710 --> 00:41:53,140
are both too polite to ask questions or

1221
00:41:49,330 --> 00:41:54,970
throw fruit okay otherwise I'll be here

1222
00:41:53,140 --> 00:41:57,390
afterwards and if you want to talk about

1223
00:41:54,970 --> 00:41:57,390
it thank you

