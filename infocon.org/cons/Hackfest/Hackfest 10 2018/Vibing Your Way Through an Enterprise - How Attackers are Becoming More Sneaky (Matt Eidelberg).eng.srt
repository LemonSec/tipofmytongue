1
00:00:00,030 --> 00:00:03,899
so as I mentioned it's my talk fighting

2
00:00:02,520 --> 00:00:06,990
your way through an enterprise how

3
00:00:03,899 --> 00:00:11,540
attackers are becoming more sneaking bit

4
00:00:06,990 --> 00:00:11,540
about myself before we get into

5
00:00:13,400 --> 00:00:19,590
attacking penetration team my roles in

6
00:00:16,710 --> 00:00:21,960
this team are to primarily care out red

7
00:00:19,590 --> 00:00:25,009
team engagements social engineering

8
00:00:21,960 --> 00:00:28,529
campaigns including both tailgating

9
00:00:25,010 --> 00:00:32,219
pretexting as well as email campaigns as

10
00:00:28,529 --> 00:00:34,019
well as carrying out targeted internal

11
00:00:32,219 --> 00:00:36,840
and external penetration tests and

12
00:00:34,020 --> 00:00:37,950
physical breach assessments a lot of the

13
00:00:36,840 --> 00:00:40,770
information we're gonna be discussing

14
00:00:37,950 --> 00:00:42,960
here is coming from years of experience

15
00:00:40,770 --> 00:00:48,090
doing these types of engagements as well

16
00:00:42,960 --> 00:00:50,910
as my own research so this is a great

17
00:00:48,090 --> 00:00:53,460
analogy to describe kind of the

18
00:00:50,910 --> 00:00:54,449
traditional defenses in place and how

19
00:00:53,460 --> 00:00:56,969
they're not really that effective

20
00:00:54,449 --> 00:01:00,680
against the modern attacks that we are

21
00:00:56,969 --> 00:01:02,789
seeing over and over again through

22
00:01:00,680 --> 00:01:06,390
various different things nation-state

23
00:01:02,789 --> 00:01:11,130
actors internal threats corporate

24
00:01:06,390 --> 00:01:13,549
espionage and the reason is is because

25
00:01:11,130 --> 00:01:16,408
they're these defenses are great at

26
00:01:13,549 --> 00:01:18,090
stopping and detecting what they know or

27
00:01:16,409 --> 00:01:21,090
what they've been programmed to look for

28
00:01:18,090 --> 00:01:23,299
but attackers can deviate by just

29
00:01:21,090 --> 00:01:25,619
changing modification obfuscation

30
00:01:23,299 --> 00:01:28,080
modifying headers doing anything like

31
00:01:25,619 --> 00:01:30,150
that and these same payloads these

32
00:01:28,080 --> 00:01:34,200
attack techniques slip right through the

33
00:01:30,150 --> 00:01:36,210
sieve and part of the problem is is that

34
00:01:34,200 --> 00:01:38,180
companies need to start realizing that

35
00:01:36,210 --> 00:01:40,740
it's a matter of if

36
00:01:38,180 --> 00:01:41,640
sorry it's a matter of when not if their

37
00:01:40,740 --> 00:01:44,039
company's going to be breached

38
00:01:41,640 --> 00:01:45,600
oftentimes companies don't realize

39
00:01:44,040 --> 00:01:48,509
they've been breached until it's public

40
00:01:45,600 --> 00:01:49,860
news some information that shows up on

41
00:01:48,509 --> 00:01:53,070
public sites like pastebin or anything

42
00:01:49,860 --> 00:01:55,229
like that and then reaction happens so

43
00:01:53,070 --> 00:01:56,309
to be proactive is one of the key is key

44
00:01:55,229 --> 00:01:59,340
things and it's also one of the hardest

45
00:01:56,310 --> 00:02:01,369
things the sad truth is is that

46
00:01:59,340 --> 00:02:04,200
attackers will always get in

47
00:02:01,369 --> 00:02:07,380
we know that sphere fishes work really

48
00:02:04,200 --> 00:02:08,789
well any one who works in a corporate

49
00:02:07,380 --> 00:02:10,889
environment you see you're inundated

50
00:02:08,788 --> 00:02:12,670
with tons of emails you know benefits

51
00:02:10,889 --> 00:02:14,950
enrollment

52
00:02:12,670 --> 00:02:18,579
got to click this got to go here and

53
00:02:14,950 --> 00:02:20,980
these steps of spear fishes you know we

54
00:02:18,580 --> 00:02:23,350
can course users to either click on a

55
00:02:20,980 --> 00:02:24,929
link to download an executable ode thus

56
00:02:23,350 --> 00:02:27,400
giving us access into the environment

57
00:02:24,930 --> 00:02:29,590
disclosed credentials through maybe a

58
00:02:27,400 --> 00:02:31,720
portal or some kind of other social

59
00:02:29,590 --> 00:02:34,120
engineering technique or essentially

60
00:02:31,720 --> 00:02:37,780
just expose a company to unnecessary

61
00:02:34,120 --> 00:02:39,130
security risk other things very common

62
00:02:37,780 --> 00:02:41,490
it's always one of the hardest hurdles

63
00:02:39,130 --> 00:02:46,030
we hear about and work with clients is

64
00:02:41,490 --> 00:02:47,950
weak passwords so companies are always

65
00:02:46,030 --> 00:02:50,380
inundated and have this always this huge

66
00:02:47,950 --> 00:02:53,109
problem with trying to find a balance

67
00:02:50,380 --> 00:02:55,299
between what a user can do to enter in a

68
00:02:53,110 --> 00:02:59,110
password complexity wise and length and

69
00:02:55,300 --> 00:03:01,090
what can't be guessed so I'm gonna start

70
00:02:59,110 --> 00:03:02,020
off by asking who here you know at the

71
00:03:01,090 --> 00:03:03,160
raise your hand or anything like that I

72
00:03:02,020 --> 00:03:05,560
don't want the information but in your

73
00:03:03,160 --> 00:03:08,890
head who here knows their company's

74
00:03:05,560 --> 00:03:11,680
password policy and how many of them

75
00:03:08,890 --> 00:03:13,359
would say that the password when you

76
00:03:11,680 --> 00:03:15,910
looked at it would be a minimum of eight

77
00:03:13,360 --> 00:03:20,380
characters and it uses Akamai curse off

78
00:03:15,910 --> 00:03:23,980
complex option then we know what that

79
00:03:20,380 --> 00:03:26,320
complex option actually does it just

80
00:03:23,980 --> 00:03:28,959
mandates two things the password has to

81
00:03:26,320 --> 00:03:30,459
be seven to fourteen characters if I'm

82
00:03:28,959 --> 00:03:33,370
not mistaken feel free to correct me but

83
00:03:30,459 --> 00:03:35,830
I believe it's fourteen and it has to

84
00:03:33,370 --> 00:03:39,310
contain one of it has to contain three

85
00:03:35,830 --> 00:03:42,340
out of four things capitals lowercase

86
00:03:39,310 --> 00:03:45,310
characters a number or a special

87
00:03:42,340 --> 00:03:49,480
character so exactly great examples that

88
00:03:45,310 --> 00:03:52,420
meet these complexities winter 2018 as a

89
00:03:49,480 --> 00:03:56,079
capital for the W lowercase for the rest

90
00:03:52,420 --> 00:03:59,109
of the word winter 2018 that's three and

91
00:03:56,080 --> 00:04:01,930
it's more than seven how easy is that to

92
00:03:59,110 --> 00:04:04,930
predict pretty easy and a lot of

93
00:04:01,930 --> 00:04:07,450
companies fall prey to this and of

94
00:04:04,930 --> 00:04:10,750
course the more complex the more sexy

95
00:04:07,450 --> 00:04:12,640
thing is you know new exploits zero days

96
00:04:10,750 --> 00:04:15,100
that are released that expose a company

97
00:04:12,640 --> 00:04:16,959
join necessary risk you know examples we

98
00:04:15,100 --> 00:04:21,399
see this a lot we've we all read the

99
00:04:16,959 --> 00:04:23,410
news of Apache struts eternal blue but

100
00:04:21,399 --> 00:04:26,080
companies companies still are plagued by

101
00:04:23,410 --> 00:04:28,090
you know ms eight zero six seven

102
00:04:26,080 --> 00:04:32,349
a vulnerability that was released 10

103
00:04:28,090 --> 00:04:34,568
years ago so they're going to get it and

104
00:04:32,349 --> 00:04:36,520
once they're in they're going to perform

105
00:04:34,569 --> 00:04:38,139
a series of techniques to move

106
00:04:36,520 --> 00:04:42,280
throughout the network this is known as

107
00:04:38,139 --> 00:04:44,830
lateral movement so lateral movement is

108
00:04:42,280 --> 00:04:46,599
a series of techniques where an attacker

109
00:04:44,830 --> 00:04:48,400
is going to move throughout a network

110
00:04:46,599 --> 00:04:50,050
with the goal of either you know

111
00:04:48,400 --> 00:04:52,539
compromising the entire domain

112
00:04:50,050 --> 00:04:56,289
maybe accessing some of the sensitive

113
00:04:52,539 --> 00:04:57,909
business data such as trade secrets

114
00:04:56,289 --> 00:04:59,919
credit card information if you're a

115
00:04:57,909 --> 00:05:01,960
medical company it could be as simple as

116
00:04:59,919 --> 00:05:05,590
patient records but this is you know

117
00:05:01,960 --> 00:05:07,810
they have a goal and for them moving

118
00:05:05,590 --> 00:05:09,940
throughout this they have to figure out

119
00:05:07,810 --> 00:05:14,830
this best way the shortest path to get

120
00:05:09,940 --> 00:05:17,080
to this goal these techniques often use

121
00:05:14,830 --> 00:05:19,500
credentials and the biggest thing is

122
00:05:17,080 --> 00:05:22,810
that they're not using like exploits

123
00:05:19,500 --> 00:05:24,580
it's really simple you can acquire other

124
00:05:22,810 --> 00:05:25,930
compromised other credentials to move

125
00:05:24,580 --> 00:05:28,779
throughout the network and that's the

126
00:05:25,930 --> 00:05:30,550
typical modus operandi they go from one

127
00:05:28,779 --> 00:05:32,979
user to another user with the guys that

128
00:05:30,550 --> 00:05:35,620
they have higher privileges until they

129
00:05:32,979 --> 00:05:38,229
get where they need and these techniques

130
00:05:35,620 --> 00:05:41,529
that they abuse are actually not really

131
00:05:38,229 --> 00:05:43,360
bugs or flaws in an environment these

132
00:05:41,529 --> 00:05:45,789
are actually Windows administrative

133
00:05:43,360 --> 00:05:49,029
features or business related ones that

134
00:05:45,789 --> 00:05:51,669
allow users to perform their tasks or IT

135
00:05:49,029 --> 00:05:53,409
admins to administrate these machines

136
00:05:51,669 --> 00:05:57,609
and this can be a great example

137
00:05:53,409 --> 00:05:59,560
WMI it's built into Windows it has a

138
00:05:57,610 --> 00:06:03,210
robust amount of features to allow

139
00:05:59,560 --> 00:06:06,699
network administrator's the ability to

140
00:06:03,210 --> 00:06:09,969
assess remotely services processes

141
00:06:06,699 --> 00:06:12,789
running maybe even create services bat

142
00:06:09,969 --> 00:06:15,430
files to do specific tasks an attacker

143
00:06:12,789 --> 00:06:17,830
can do the same thing but with a very

144
00:06:15,430 --> 00:06:19,719
malicious intent and it's really hard

145
00:06:17,830 --> 00:06:22,300
for system administrators to just

146
00:06:19,719 --> 00:06:27,879
disable these without crippling their

147
00:06:22,300 --> 00:06:29,889
business's ability to function so when I

148
00:06:27,879 --> 00:06:32,050
talk about lateral movement I like to

149
00:06:29,889 --> 00:06:34,719
talk about in three phases you have your

150
00:06:32,050 --> 00:06:38,740
domain reconnaissance your compromise

151
00:06:34,719 --> 00:06:39,700
phase and your credential theft this is

152
00:06:38,740 --> 00:06:42,220
like

153
00:06:39,700 --> 00:06:46,330
and repeat as it goes through until an

154
00:06:42,220 --> 00:06:49,270
an adversary or attacker is successful a

155
00:06:46,330 --> 00:06:51,010
lot of research talks development have

156
00:06:49,270 --> 00:06:52,570
always gone into compromising credential

157
00:06:51,010 --> 00:06:55,270
theft where if you're all familiar with

158
00:06:52,570 --> 00:06:57,490
you know the PS exec cobalt strike

159
00:06:55,270 --> 00:07:02,320
utilizing a lot of these techniques me

160
00:06:57,490 --> 00:07:04,780
me cats or even PowerShell PS attack all

161
00:07:02,320 --> 00:07:08,650
these types of power up tools a lot of

162
00:07:04,780 --> 00:07:10,510
these focus on those two this type of

163
00:07:08,650 --> 00:07:11,710
talk is really going to be focusing more

164
00:07:10,510 --> 00:07:16,150
on the domain reconnaissance side

165
00:07:11,710 --> 00:07:17,289
because it's crucial and so important

166
00:07:16,150 --> 00:07:18,909
for an attacker to know where they need

167
00:07:17,290 --> 00:07:23,650
to go they need to formulate in a plan

168
00:07:18,910 --> 00:07:26,290
they can't go in there blind so what is

169
00:07:23,650 --> 00:07:29,109
domain reconnaissance in a nutshell it's

170
00:07:26,290 --> 00:07:33,070
the act of learning what users exist

171
00:07:29,110 --> 00:07:33,700
what groups computers who belongs to

172
00:07:33,070 --> 00:07:35,800
what group

173
00:07:33,700 --> 00:07:37,300
what are those groups role and functions

174
00:07:35,800 --> 00:07:38,650
what does it give you access to what is

175
00:07:37,300 --> 00:07:41,590
what is the intended purpose of this

176
00:07:38,650 --> 00:07:44,229
group what tasks are running this in the

177
00:07:41,590 --> 00:07:47,349
environment what systems who has read

178
00:07:44,230 --> 00:07:49,720
privileges who has write who can who's

179
00:07:47,350 --> 00:07:53,170
remotely logged in on what using this

180
00:07:49,720 --> 00:07:54,370
information an attacker can figure out

181
00:07:53,170 --> 00:07:56,440
where they need to go to get elevated

182
00:07:54,370 --> 00:07:58,720
privileges maybe they need to get domain

183
00:07:56,440 --> 00:08:01,390
administrative rights the as we like to

184
00:07:58,720 --> 00:08:03,520
call it the whole you know the key once

185
00:08:01,390 --> 00:08:05,860
you have administrator rights any box

186
00:08:03,520 --> 00:08:07,890
any service you can open you're good to

187
00:08:05,860 --> 00:08:07,890
go

188
00:08:08,130 --> 00:08:15,550
so all right Joe sorry I jumped ahead so

189
00:08:13,630 --> 00:08:19,980
what I just described kind of relates to

190
00:08:15,550 --> 00:08:22,180
this slide so this is a great example of

191
00:08:19,980 --> 00:08:23,530
what it would look like you see you have

192
00:08:22,180 --> 00:08:25,180
a computer that's been compromised

193
00:08:23,530 --> 00:08:28,710
possibly through a spear fish or some

194
00:08:25,180 --> 00:08:31,990
kind of malicious attack scenario and

195
00:08:28,710 --> 00:08:34,840
from there the adversary is learning

196
00:08:31,990 --> 00:08:37,060
through you know net commands who isn't

197
00:08:34,840 --> 00:08:39,760
them maybe a particular group like net

198
00:08:37,059 --> 00:08:41,829
group domain admins who's in there what

199
00:08:39,760 --> 00:08:48,010
shares are available where they have

200
00:08:41,830 --> 00:08:49,870
access who's currently logged in so why

201
00:08:48,010 --> 00:08:53,230
do we care about domain reconnaissance

202
00:08:49,870 --> 00:08:53,590
so it's often overlooked I've mentioned

203
00:08:53,230 --> 00:08:54,700
I mentioned

204
00:08:53,590 --> 00:08:56,440
before that there's been a lot of

205
00:08:54,700 --> 00:09:00,640
research and focus on the other two

206
00:08:56,440 --> 00:09:03,220
phases but if a defender or a blue

207
00:09:00,640 --> 00:09:05,410
team's ability to detect these types of

208
00:09:03,220 --> 00:09:07,540
activities right off the bat and they

209
00:09:05,410 --> 00:09:09,490
can systematically create a timeline to

210
00:09:07,540 --> 00:09:12,699
figure out where and how they got in

211
00:09:09,490 --> 00:09:15,850
they can shut down these adversaries

212
00:09:12,700 --> 00:09:18,360
before they get further in and that

213
00:09:15,850 --> 00:09:21,430
really plays to this new philosophy

214
00:09:18,360 --> 00:09:25,590
defense has been adapting over the past

215
00:09:21,430 --> 00:09:30,069
few years which is called assume breach

216
00:09:25,590 --> 00:09:32,110
so assume breach is a concept in a

217
00:09:30,070 --> 00:09:33,670
practice where you've just accepted that

218
00:09:32,110 --> 00:09:35,500
you're always breached your

219
00:09:33,670 --> 00:09:38,979
twenty-four-seven you're under fire and

220
00:09:35,500 --> 00:09:42,730
this mentality changes how you fortify

221
00:09:38,980 --> 00:09:44,290
it and maybe invest in your security if

222
00:09:42,730 --> 00:09:45,880
you know that somehow someone's gonna

223
00:09:44,290 --> 00:09:48,099
get in maybe you're not going to invest

224
00:09:45,880 --> 00:09:49,720
so much on hardening your perimeter but

225
00:09:48,100 --> 00:09:51,700
you're gonna worry about what's on the

226
00:09:49,720 --> 00:09:54,040
inside so there's always been this

227
00:09:51,700 --> 00:09:56,320
concept of hardened shell gooey inside

228
00:09:54,040 --> 00:09:58,199
and we're looking at that gooey inside

229
00:09:56,320 --> 00:10:01,420
and really trying to harden that up

230
00:09:58,200 --> 00:10:04,510
focusing on how to mitigate and cut off

231
00:10:01,420 --> 00:10:07,089
an attacker before they get to where

232
00:10:04,510 --> 00:10:10,420
ever they want to so assume breach looks

233
00:10:07,090 --> 00:10:13,050
at four different things how did it

234
00:10:10,420 --> 00:10:16,030
check the threat how to respond to it

235
00:10:13,050 --> 00:10:19,569
how to mitigate any data loss or leakage

236
00:10:16,030 --> 00:10:22,120
or tampering and then creating rules and

237
00:10:19,570 --> 00:10:24,130
hardening procedures to prevent this

238
00:10:22,120 --> 00:10:29,080
type of attacked chain from happening

239
00:10:24,130 --> 00:10:29,770
again now there are tools we all love

240
00:10:29,080 --> 00:10:32,320
our tools

241
00:10:29,770 --> 00:10:34,300
there's appliances Network behavioral

242
00:10:32,320 --> 00:10:37,600
ones are the biggest ones in this type

243
00:10:34,300 --> 00:10:40,750
of niche field and they focus on looking

244
00:10:37,600 --> 00:10:43,060
at not only signature-based events but

245
00:10:40,750 --> 00:10:45,760
also characteristics and what that means

246
00:10:43,060 --> 00:10:48,130
is we're all familiar with what a

247
00:10:45,760 --> 00:10:51,250
signature base is if it has it looks

248
00:10:48,130 --> 00:10:53,920
like it's Metasploit payload and it

249
00:10:51,250 --> 00:10:55,840
calls out or something along those lines

250
00:10:53,920 --> 00:10:58,689
that meets a certain criteria that to be

251
00:10:55,840 --> 00:11:00,640
flagged as malicious but characteristics

252
00:10:58,690 --> 00:11:03,010
are looking at a baseline in your

253
00:11:00,640 --> 00:11:05,949
environment so they take lots of the

254
00:11:03,010 --> 00:11:07,569
lots of data and look at how each of

255
00:11:05,950 --> 00:11:11,019
your users integrate

256
00:11:07,570 --> 00:11:14,800
so let's just say Sally from HR she

257
00:11:11,019 --> 00:11:17,769
always comes in nine to five works on

258
00:11:14,800 --> 00:11:20,079
our machine access to applications once

259
00:11:17,769 --> 00:11:23,170
a month she uploads some new stuff

260
00:11:20,079 --> 00:11:25,630
through an RDP session okay

261
00:11:23,170 --> 00:11:28,569
that's been her job for two years one

262
00:11:25,630 --> 00:11:30,339
night she logs in at 9:00 p.m. starts

263
00:11:28,569 --> 00:11:32,680
you know sending erroneous commands

264
00:11:30,339 --> 00:11:35,319
looking to see who's in what group

265
00:11:32,680 --> 00:11:38,489
looking at certain file systems starts

266
00:11:35,319 --> 00:11:40,810
requesting you know IT shares what

267
00:11:38,490 --> 00:11:42,880
that's out of her norm that's out of her

268
00:11:40,810 --> 00:11:44,229
purview so right there those types of

269
00:11:42,880 --> 00:11:45,779
different correct characteristics this

270
00:11:44,230 --> 00:11:50,110
users logging in at a different time

271
00:11:45,779 --> 00:11:51,699
she's requesting different stuff this is

272
00:11:50,110 --> 00:11:54,329
all suspicious and a lot of these

273
00:11:51,699 --> 00:11:58,209
activities relate to what an attacker

274
00:11:54,329 --> 00:11:59,979
would do if they were to compromise so

275
00:11:58,209 --> 00:12:02,560
these tools I'll show you an example so

276
00:11:59,980 --> 00:12:04,509
here's an example of a net just command

277
00:12:02,560 --> 00:12:07,719
prompt looking to see what privileges

278
00:12:04,509 --> 00:12:12,430
who's in what group these tools can

279
00:12:07,720 --> 00:12:15,130
detect and analyze what a user what

280
00:12:12,430 --> 00:12:16,599
machine what commands and from that

281
00:12:15,130 --> 00:12:18,790
point you can start your timeline of

282
00:12:16,600 --> 00:12:21,040
events to see your indicators of

283
00:12:18,790 --> 00:12:23,589
compromised and those are what led to

284
00:12:21,040 --> 00:12:24,969
the compromise how are they moving along

285
00:12:23,589 --> 00:12:25,569
where are they going what are they

286
00:12:24,970 --> 00:12:26,860
looking for

287
00:12:25,569 --> 00:12:29,219
because if you know where they're going

288
00:12:26,860 --> 00:12:33,519
you can stop them before they get there

289
00:12:29,220 --> 00:12:35,769
another example powerful tool looking

290
00:12:33,519 --> 00:12:37,360
for sessions you know this one you see

291
00:12:35,769 --> 00:12:39,639
who's logged in that way if you need to

292
00:12:37,360 --> 00:12:41,500
get a specific user you can compromise

293
00:12:39,639 --> 00:12:43,329
that user because they're on that box if

294
00:12:41,500 --> 00:12:45,190
you have access to that box you can

295
00:12:43,329 --> 00:12:46,899
compromise their credentials hijack

296
00:12:45,190 --> 00:12:50,230
their session so that type of

297
00:12:46,899 --> 00:12:52,779
reconnaissance can be detected you can

298
00:12:50,230 --> 00:12:55,180
see what machine this request is coming

299
00:12:52,779 --> 00:12:57,670
from what information was leaked so you

300
00:12:55,180 --> 00:13:00,599
better understand another example and

301
00:12:57,670 --> 00:13:04,990
using PowerShell same sort of thing

302
00:13:00,600 --> 00:13:06,310
we're able to see who where and what

303
00:13:04,990 --> 00:13:08,019
information they were able to a gather

304
00:13:06,310 --> 00:13:09,430
these tools also have a great

305
00:13:08,019 --> 00:13:11,410
functionality like I mentioned before

306
00:13:09,430 --> 00:13:13,329
about timelines it's very important to

307
00:13:11,410 --> 00:13:15,069
understand how they're moving through

308
00:13:13,329 --> 00:13:17,319
when did they get compromised to create

309
00:13:15,069 --> 00:13:18,790
a timeline of events to know what

310
00:13:17,319 --> 00:13:21,579
they've touched what they've compromised

311
00:13:18,790 --> 00:13:24,160
and so you can see right here in the

312
00:13:21,580 --> 00:13:26,380
example you can see who's touching what

313
00:13:24,160 --> 00:13:27,910
machine who's accessing what resources

314
00:13:26,380 --> 00:13:30,640
and it's very important to understand

315
00:13:27,910 --> 00:13:35,219
maybe by looking at this where they're

316
00:13:30,640 --> 00:13:38,830
going so with this paradigm shift in an

317
00:13:35,220 --> 00:13:42,880
in the environments attackers have to

318
00:13:38,830 --> 00:13:44,320
become more clever stealthy attack these

319
00:13:42,880 --> 00:13:47,230
types of Network behavioral analytics

320
00:13:44,320 --> 00:13:50,710
software's have made it a huge hurdle in

321
00:13:47,230 --> 00:13:52,870
a pane for breach simulation red teamers

322
00:13:50,710 --> 00:13:55,930
or even nation-state actors from

323
00:13:52,870 --> 00:13:58,960
performing post decks and before they

324
00:13:55,930 --> 00:14:02,050
get lopped off so attackers are moving

325
00:13:58,960 --> 00:14:03,730
towards a philosophy of moving living

326
00:14:02,050 --> 00:14:06,099
off the land where they're not using

327
00:14:03,730 --> 00:14:08,590
things like command prompt or PowerShell

328
00:14:06,100 --> 00:14:10,960
or tools they want to try to use what

329
00:14:08,590 --> 00:14:13,840
resources are built into the environment

330
00:14:10,960 --> 00:14:17,100
and one of the most common one that's

331
00:14:13,840 --> 00:14:23,290
often overlooked from both attackers and

332
00:14:17,100 --> 00:14:25,720
sis administrators is LDAP so LDAP is a

333
00:14:23,290 --> 00:14:27,790
protocol that really integrates well

334
00:14:25,720 --> 00:14:29,950
with Active Directory pulls on the same

335
00:14:27,790 --> 00:14:32,110
type of information as designed as a

336
00:14:29,950 --> 00:14:34,570
higher key based platform so you can

337
00:14:32,110 --> 00:14:36,400
understand and essentially pull down the

338
00:14:34,570 --> 00:14:39,370
same information you would buy just by

339
00:14:36,400 --> 00:14:43,480
simply going net user blah blah group or

340
00:14:39,370 --> 00:14:45,580
net user whatever you need to but one of

341
00:14:43,480 --> 00:14:48,220
the big features and why it's commonly

342
00:14:45,580 --> 00:14:49,630
used in a domain is because we have

343
00:14:48,220 --> 00:14:51,850
there a lot of non windows-based

344
00:14:49,630 --> 00:14:55,630
machines these could be Linux

345
00:14:51,850 --> 00:14:57,790
environments PCI segmented environments

346
00:14:55,630 --> 00:14:59,680
that are not windows-based even printers

347
00:14:57,790 --> 00:15:01,390
they need you to be able to coordinate a

348
00:14:59,680 --> 00:15:04,239
lot of things I'm sure we're all

349
00:15:01,390 --> 00:15:07,330
familiar here show hands who's ever seen

350
00:15:04,240 --> 00:15:11,500
those YouTube videos from HP about the

351
00:15:07,330 --> 00:15:14,920
wolf ok I definitely take a look at

352
00:15:11,500 --> 00:15:16,870
those they're quite funny christian

353
00:15:14,920 --> 00:15:19,300
slater being is all hacker mr. robot

354
00:15:16,870 --> 00:15:21,850
advertising this next-gen printer

355
00:15:19,300 --> 00:15:24,540
security but they still need to be able

356
00:15:21,850 --> 00:15:27,040
to verify what users and who can print

357
00:15:24,540 --> 00:15:30,099
how did i do that can't join it to a

358
00:15:27,040 --> 00:15:31,719
domain so they use LDAP so why am I

359
00:15:30,100 --> 00:15:34,660
talking about all that it's because it's

360
00:15:31,720 --> 00:15:35,470
really hard to detect malicious activity

361
00:15:34,660 --> 00:15:37,569
going on when

362
00:15:35,470 --> 00:15:40,990
LDAP is involved the reason for that is

363
00:15:37,570 --> 00:15:42,940
once an authentication occurs that's the

364
00:15:40,990 --> 00:15:45,760
only event that's ever generated or

365
00:15:42,940 --> 00:15:48,730
logged you can't see if through an event

366
00:15:45,760 --> 00:15:51,250
log what is being requested or what is

367
00:15:48,730 --> 00:15:53,380
being pulled down at the most if they're

368
00:15:51,250 --> 00:15:56,920
using an unsecure so they're not using

369
00:15:53,380 --> 00:15:58,689
the encryption you can see by basically

370
00:15:56,920 --> 00:16:01,209
monitoring the traffic in that local

371
00:15:58,690 --> 00:16:01,930
range what data is coming across in

372
00:16:01,210 --> 00:16:04,270
clear-text

373
00:16:01,930 --> 00:16:07,089
but you can but attackers obviously it's

374
00:16:04,270 --> 00:16:10,560
very simple encrypt it can't see it

375
00:16:07,090 --> 00:16:12,490
can't see it you can't trigger an alert

376
00:16:10,560 --> 00:16:14,199
here's our greetings and here's what

377
00:16:12,490 --> 00:16:17,470
kind of a diagram you can see you have

378
00:16:14,200 --> 00:16:20,500
on the left a compromised box doing the

379
00:16:17,470 --> 00:16:21,850
same type of network commands built into

380
00:16:20,500 --> 00:16:24,940
Windows just trying to get understand

381
00:16:21,850 --> 00:16:26,770
the lay of the land those logs then get

382
00:16:24,940 --> 00:16:29,560
forward to a security monitoring center

383
00:16:26,770 --> 00:16:33,100
which generates an alert and your team

384
00:16:29,560 --> 00:16:35,890
is then begins their IR process or

385
00:16:33,100 --> 00:16:39,130
whatever procedures on the right you can

386
00:16:35,890 --> 00:16:41,470
see there's a TLS base in connection to

387
00:16:39,130 --> 00:16:43,030
a domain controller at which point this

388
00:16:41,470 --> 00:16:45,820
information is pulled down locally and

389
00:16:43,030 --> 00:16:48,610
they can just query it on their end so

390
00:16:45,820 --> 00:16:49,750
none of those logs are ever generate

391
00:16:48,610 --> 00:16:51,370
there's none of these net commands and

392
00:16:49,750 --> 00:16:52,870
all that stuff the same information is

393
00:16:51,370 --> 00:16:55,240
being able to be viewed and access but

394
00:16:52,870 --> 00:16:57,430
nothing is being sent to the Security

395
00:16:55,240 --> 00:17:00,940
Center therefore no events are being

396
00:16:57,430 --> 00:17:06,790
triggered the other big thing is network

397
00:17:00,940 --> 00:17:08,770
windows api's so these libraries are

398
00:17:06,790 --> 00:17:11,079
becoming more and more popular for

399
00:17:08,770 --> 00:17:13,510
adversaries to use because they're on

400
00:17:11,079 --> 00:17:16,210
every Windows machine they provide a

401
00:17:13,510 --> 00:17:19,270
sleuth of functionality and features and

402
00:17:16,210 --> 00:17:23,170
one of the key things is that you it

403
00:17:19,270 --> 00:17:25,930
makes their traffic look benign and it

404
00:17:23,170 --> 00:17:28,090
makes defenders job nearly impossible to

405
00:17:25,930 --> 00:17:31,090
detect between malicious and normal

406
00:17:28,089 --> 00:17:32,889
activity by using the features and

407
00:17:31,090 --> 00:17:35,139
command a P eyes that are built into

408
00:17:32,890 --> 00:17:36,460
each Windows box so I'm going to talk

409
00:17:35,140 --> 00:17:38,230
about a about a few of them that are

410
00:17:36,460 --> 00:17:43,300
commonly used and what we use and we've

411
00:17:38,230 --> 00:17:47,560
seen the first one is net API so this

412
00:17:43,300 --> 00:17:49,030
net share API so this API essentially

413
00:17:47,560 --> 00:17:50,440
reviews and pull

414
00:17:49,030 --> 00:17:53,320
down information related to remote

415
00:17:50,440 --> 00:17:54,460
shares this information is garnered by

416
00:17:53,320 --> 00:17:55,720
five different levels

417
00:17:54,460 --> 00:17:58,720
and you request that level with each

418
00:17:55,720 --> 00:18:02,770
request you can go from just basic the

419
00:17:58,720 --> 00:18:05,110
name to the name description privileges

420
00:18:02,770 --> 00:18:07,450
do you the user requesting it as has

421
00:18:05,110 --> 00:18:09,340
access who's currently looking at it but

422
00:18:07,450 --> 00:18:12,520
those higher levels require additional

423
00:18:09,340 --> 00:18:14,199
privileges however the first two zero

424
00:18:12,520 --> 00:18:16,060
and one they don't actually require

425
00:18:14,200 --> 00:18:18,430
anything besides valid credentials you

426
00:18:16,060 --> 00:18:21,669
could be you know a low level user may

427
00:18:18,430 --> 00:18:24,130
be a contractor even and still pull down

428
00:18:21,670 --> 00:18:25,360
this information with this information

429
00:18:24,130 --> 00:18:27,370
then they can figure out okay which

430
00:18:25,360 --> 00:18:29,520
shares involved and then the next step

431
00:18:27,370 --> 00:18:33,790
is to figure out what access they have

432
00:18:29,520 --> 00:18:35,230
so you wouldn't this access by looking

433
00:18:33,790 --> 00:18:38,350
to see what readwrite commands you have

434
00:18:35,230 --> 00:18:41,410
so rage is quite obvious you just try to

435
00:18:38,350 --> 00:18:43,270
using the API do a read request to see

436
00:18:41,410 --> 00:18:45,550
if you can read any data from that share

437
00:18:43,270 --> 00:18:48,190
if you're successful you know you have

438
00:18:45,550 --> 00:18:49,930
read data when it comes down to right

439
00:18:48,190 --> 00:18:53,290
it's a bit more tricky and we all know

440
00:18:49,930 --> 00:18:55,240
that because endpoint solutions a V's

441
00:18:53,290 --> 00:18:57,040
they're getting more advanced with

442
00:18:55,240 --> 00:18:59,680
regards to how they're detecting files

443
00:18:57,040 --> 00:19:03,399
being written to disk they know

444
00:18:59,680 --> 00:19:05,410
signatures files as well as any

445
00:19:03,400 --> 00:19:07,120
malicious payload any techniques if the

446
00:19:05,410 --> 00:19:09,100
file is written to a certain place and

447
00:19:07,120 --> 00:19:11,139
then it's called subsequently that could

448
00:19:09,100 --> 00:19:13,840
be an indication of you know it W my

449
00:19:11,140 --> 00:19:18,220
exact or what have you there's a lot of

450
00:19:13,840 --> 00:19:19,720
different ways however a folder you can

451
00:19:18,220 --> 00:19:23,380
write a folder requires the same

452
00:19:19,720 --> 00:19:26,080
privileges as a file to drop to disk but

453
00:19:23,380 --> 00:19:27,670
a folder has no size it has no bit

454
00:19:26,080 --> 00:19:30,460
length there's no data in a folder

455
00:19:27,670 --> 00:19:33,040
besides its name so it's really hard for

456
00:19:30,460 --> 00:19:35,350
those AVS and endpoint solutions to

457
00:19:33,040 --> 00:19:42,250
detect a folder being pretty or creating

458
00:19:35,350 --> 00:19:44,139
instead of a file the second one is work

459
00:19:42,250 --> 00:19:47,110
it's the workstation enumerate user

460
00:19:44,140 --> 00:19:48,400
enumeration that name you try to

461
00:19:47,110 --> 00:19:49,870
pronounce it good luck

462
00:19:48,400 --> 00:19:51,730
I have never been able to successfully

463
00:19:49,870 --> 00:19:56,770
from talking to a lot of Microsoft

464
00:19:51,730 --> 00:20:00,130
vendors this API is designed to pull

465
00:19:56,770 --> 00:20:01,990
down all active users information so

466
00:20:00,130 --> 00:20:02,860
who's logged in who has an active

467
00:20:01,990 --> 00:20:05,890
session already

468
00:20:02,860 --> 00:20:09,010
P it does this by whenever someone

469
00:20:05,890 --> 00:20:11,500
connects it creates a user token this

470
00:20:09,010 --> 00:20:14,500
token can then be read by this API

471
00:20:11,500 --> 00:20:16,540
remotely the only caveat is you have to

472
00:20:14,500 --> 00:20:18,940
have administrator privileges on the Box

473
00:20:16,540 --> 00:20:20,500
to see all this information the reason

474
00:20:18,940 --> 00:20:25,510
why I bring this up is for it's more

475
00:20:20,500 --> 00:20:28,030
commonly used and known API net session

476
00:20:25,510 --> 00:20:30,340
enumeration so it functions the same way

477
00:20:28,030 --> 00:20:33,100
where you can pull down the same level

478
00:20:30,340 --> 00:20:34,870
information the difference is you don't

479
00:20:33,100 --> 00:20:37,389
need to have elevated privileges or

480
00:20:34,870 --> 00:20:39,219
admin rights on the Box you can be any

481
00:20:37,390 --> 00:20:43,090
user so long as they're valid domain

482
00:20:39,220 --> 00:20:46,030
users this API is more commonly used and

483
00:20:43,090 --> 00:20:47,559
the reason why I left it for last is

484
00:20:46,030 --> 00:20:51,700
because there's a lot of problems with

485
00:20:47,559 --> 00:20:54,100
it is most commonly abused lots of tool

486
00:20:51,700 --> 00:20:55,510
suites use this it's kind of like we'd

487
00:20:54,100 --> 00:20:58,809
like to say a little dirty to use

488
00:20:55,510 --> 00:21:01,090
because it's so easy to detect and user

489
00:20:58,809 --> 00:21:03,399
and a lot of teams just write generic

490
00:21:01,090 --> 00:21:05,260
profiles or alerts if this is ever

491
00:21:03,400 --> 00:21:08,049
called and then they try to eliminate

492
00:21:05,260 --> 00:21:10,000
the ones that are legit hoping that half

493
00:21:08,049 --> 00:21:11,530
the time they're probably be false

494
00:21:10,000 --> 00:21:13,390
positives but maybe that one a few times

495
00:21:11,530 --> 00:21:16,059
they'll get a hits of something

496
00:21:13,390 --> 00:21:17,710
malicious so with that little bit of

497
00:21:16,059 --> 00:21:19,928
information how do attackers go around

498
00:21:17,710 --> 00:21:24,669
it they use a combination of the first

499
00:21:19,929 --> 00:21:27,370
two they look at reading the C Drive to

500
00:21:24,669 --> 00:21:30,760
see if the who's been logged in look at

501
00:21:27,370 --> 00:21:31,840
the curt of the profiles if they have

502
00:21:30,760 --> 00:21:35,860
administrative rights they'll try the

503
00:21:31,840 --> 00:21:36,760
workstation administrative one and if

504
00:21:35,860 --> 00:21:39,070
they have write access

505
00:21:36,760 --> 00:21:40,870
they'll drop a file and remotely execute

506
00:21:39,070 --> 00:21:43,480
it because if you have write access to

507
00:21:40,870 --> 00:21:45,850
see dollar sign or admin dollar sign you

508
00:21:43,480 --> 00:21:49,240
have the ability to execute commands and

509
00:21:45,850 --> 00:21:51,909
you're also an administrator so with all

510
00:21:49,240 --> 00:21:54,669
this information let's talk about vibe

511
00:21:51,910 --> 00:21:57,010
survive is a tool I created to framework

512
00:21:54,669 --> 00:21:58,809
where you can perform all these tasks we

513
00:21:57,010 --> 00:22:00,760
just talked about by pulling down

514
00:21:58,809 --> 00:22:03,549
through LDAP without being detected

515
00:22:00,760 --> 00:22:07,600
all this information about the groups

516
00:22:03,549 --> 00:22:09,610
the users the systems perform the same

517
00:22:07,600 --> 00:22:12,550
type of net based commands you would do

518
00:22:09,610 --> 00:22:14,678
through CMD or a numeraire domain

519
00:22:12,550 --> 00:22:17,020
reconnaissance using PowerShell without

520
00:22:14,679 --> 00:22:18,460
being caught the other cavities you can

521
00:22:17,020 --> 00:22:21,550
form additional queries and advanced

522
00:22:18,460 --> 00:22:25,120
lookups as well as look to see what

523
00:22:21,550 --> 00:22:26,649
shares and permissions you have and if

524
00:22:25,120 --> 00:22:28,649
you have elevated privileges we'll let

525
00:22:26,650 --> 00:22:33,010
you know what sessions who's logged in

526
00:22:28,650 --> 00:22:35,890
this tool uses no PowerShell and we've

527
00:22:33,010 --> 00:22:38,620
tested it against numerous systems and

528
00:22:35,890 --> 00:22:40,600
vendors without being caught so I've

529
00:22:38,620 --> 00:22:43,620
been talking for a while so let me show

530
00:22:40,600 --> 00:22:43,620
you a demonstration

531
00:22:54,070 --> 00:22:58,929
so you can see that right now what we're

532
00:22:57,190 --> 00:23:00,250
doing is we're pulling down the contents

533
00:22:58,930 --> 00:23:02,860
of the domain we're pulling down all the

534
00:23:00,250 --> 00:23:05,170
users the workstations and the groups

535
00:23:02,860 --> 00:23:07,330
and the affiliations and all the

536
00:23:05,170 --> 00:23:16,360
information you can see that right here

537
00:23:07,330 --> 00:23:18,639
displayed you can pull down all it pulls

538
00:23:16,360 --> 00:23:21,399
down every single groups computers and

539
00:23:18,640 --> 00:23:30,700
users profile so any single thing that

540
00:23:21,400 --> 00:23:31,600
is stored or in an ad it pulls down you

541
00:23:30,700 --> 00:23:33,610
can see right here here are their

542
00:23:31,600 --> 00:23:35,379
computers you can see what version I

543
00:23:33,610 --> 00:23:40,510
know it looks a little blurry on my end

544
00:23:35,380 --> 00:23:44,680
as well what I'll do is I'll post this

545
00:23:40,510 --> 00:23:46,480
video online so it might be clear and we

546
00:23:44,680 --> 00:23:48,610
can also see the file systems that are

547
00:23:46,480 --> 00:23:50,650
associated so which ones file systems

548
00:23:48,610 --> 00:23:52,060
have tons of data so this information is

549
00:23:50,650 --> 00:23:53,500
pulled down pass lis through Active

550
00:23:52,060 --> 00:23:58,679
Directory looking to see which ones are

551
00:23:53,500 --> 00:23:58,680
mapped drives profile paths are stored

552
00:24:01,800 --> 00:24:06,460
we can also function forms the same net

553
00:24:04,690 --> 00:24:08,470
command so if you're familiar with net

554
00:24:06,460 --> 00:24:10,750
commands you can perform these net user

555
00:24:08,470 --> 00:24:12,570
bla and it will still execute the same

556
00:24:10,750 --> 00:24:15,520
information display it all for you and

557
00:24:12,570 --> 00:24:17,260
you're never touching the environment so

558
00:24:15,520 --> 00:24:19,030
none of these none of this traffic is

559
00:24:17,260 --> 00:24:25,210
ever to leaving outside of your team

560
00:24:19,030 --> 00:24:26,680
server your c2 environment we can you

561
00:24:25,210 --> 00:24:29,500
can add multiple credentials as you

562
00:24:26,680 --> 00:24:31,390
harvest more and more that way as you

563
00:24:29,500 --> 00:24:33,010
get elevated and get more privileges in

564
00:24:31,390 --> 00:24:34,540
the environment you can change your

565
00:24:33,010 --> 00:24:38,470
tactics and start looking to see who

566
00:24:34,540 --> 00:24:41,080
where and what they have access to so

567
00:24:38,470 --> 00:24:42,760
right here we're going to see who where

568
00:24:41,080 --> 00:24:46,960
this user has access to we're going to

569
00:24:42,760 --> 00:24:48,670
look at first at the shares this

570
00:24:46,960 --> 00:24:50,140
function also has a jitter and a sleep

571
00:24:48,670 --> 00:24:52,390
function so either way you can obfuscate

572
00:24:50,140 --> 00:24:54,430
and kind of control based on your your

573
00:24:52,390 --> 00:24:56,050
beak in your session also that way

574
00:24:54,430 --> 00:24:58,930
you're not hitting them sequentially it

575
00:24:56,050 --> 00:25:03,970
randomizes each request so that way it's

576
00:24:58,930 --> 00:25:05,500
not like 192 168 1 1 9 6 2 3 it doesn't

577
00:25:03,970 --> 00:25:07,870
go down and randomize this what makes it

578
00:25:05,500 --> 00:25:09,909
really hard for blue teams to kind of

579
00:25:07,870 --> 00:25:15,850
these signatures that we've been talking

580
00:25:09,909 --> 00:25:17,470
about so once we found out that we have

581
00:25:15,850 --> 00:25:19,539
privileges you can see right here we can

582
00:25:17,470 --> 00:25:21,130
see who's logged in I know it's a little

583
00:25:19,539 --> 00:25:23,470
blurry but if you can see who's logged

584
00:25:21,130 --> 00:25:38,440
in and what permission and users had

585
00:25:23,470 --> 00:25:39,850
created profiles so once we've added

586
00:25:38,440 --> 00:25:43,840
those new credentials and we can then

587
00:25:39,850 --> 00:25:45,789
see what this user has access to so

588
00:25:43,840 --> 00:25:48,399
first thing I normally do is I would run

589
00:25:45,789 --> 00:25:49,480
see what groups they have access to and

590
00:25:48,399 --> 00:25:51,129
I know it's really hard to see but it

591
00:25:49,480 --> 00:25:53,620
actually had an administrator group for

592
00:25:51,130 --> 00:25:56,409
a server we discovered once again I will

593
00:25:53,620 --> 00:25:59,408
post this on YouTube and that way you

594
00:25:56,409 --> 00:26:01,210
guys can clearly see it better and we

595
00:25:59,409 --> 00:26:03,940
can see by using a search that there is

596
00:26:01,210 --> 00:26:08,350
this computer a group were associated

597
00:26:03,940 --> 00:26:11,110
and a user so if we just do the session

598
00:26:08,350 --> 00:26:13,000
command we can see that the admin the

599
00:26:11,110 --> 00:26:15,549
domain admin is logged in on this box

600
00:26:13,000 --> 00:26:24,429
just by doing all this we've done this

601
00:26:15,549 --> 00:26:26,559
all without triggering any alerts a few

602
00:26:24,429 --> 00:26:29,260
additional features that I've just added

603
00:26:26,559 --> 00:26:32,200
just for pack fest as a special release

604
00:26:29,260 --> 00:26:34,480
is a list functionality so this can list

605
00:26:32,200 --> 00:26:36,070
out all every single user group or

606
00:26:34,480 --> 00:26:37,929
computer depending on which command you

607
00:26:36,070 --> 00:26:40,480
choose list user list group list

608
00:26:37,929 --> 00:26:45,480
computer you can also export it to a

609
00:26:40,480 --> 00:26:49,870
file oh sorry

610
00:26:45,480 --> 00:26:52,600
so with the F command - F you can

611
00:26:49,870 --> 00:26:53,918
actually pipe the contents to a file at

612
00:26:52,600 --> 00:26:55,629
which point you can then use it for

613
00:26:53,919 --> 00:26:57,760
other types of attacks maybe a password

614
00:26:55,630 --> 00:26:59,890
guessing in a secondary domain or

615
00:26:57,760 --> 00:27:02,200
something along the lines I mentioned a

616
00:26:59,890 --> 00:27:04,779
little bit about passively pulling down

617
00:27:02,200 --> 00:27:07,120
in file systems file systems are always

618
00:27:04,779 --> 00:27:09,970
a great place personally i it's one of

619
00:27:07,120 --> 00:27:12,010
the biggest places I look for you'd be

620
00:27:09,970 --> 00:27:14,730
surprised how much sensitive data

621
00:27:12,010 --> 00:27:18,000
you know PII Social Security numbers

622
00:27:14,730 --> 00:27:21,130
diagrams network diagrams even you know

623
00:27:18,000 --> 00:27:21,730
bat files that have domain administrator

624
00:27:21,130 --> 00:27:24,279
or service

625
00:27:21,730 --> 00:27:26,409
accounts credentials and clear text so

626
00:27:24,279 --> 00:27:28,029
by pulling that down you can then see

627
00:27:26,409 --> 00:27:29,940
every single target and you can start

628
00:27:28,029 --> 00:27:34,090
profiling and looking through them as

629
00:27:29,940 --> 00:27:36,460
well as looking at extracting fine-grain

630
00:27:34,090 --> 00:27:38,740
group policies so fine-grained group

631
00:27:36,460 --> 00:27:41,350
policies are policies that are exempt

632
00:27:38,740 --> 00:27:43,779
from the standard domain policy for

633
00:27:41,350 --> 00:27:46,539
passwords we see this a lot with

634
00:27:43,779 --> 00:27:49,120
companies usually ones that are in the

635
00:27:46,539 --> 00:27:50,980
medical field or ones that have a you

636
00:27:49,120 --> 00:27:52,299
have multiple different companies bought

637
00:27:50,980 --> 00:27:54,850
into them and have sister companies

638
00:27:52,299 --> 00:27:57,429
where there's different rules so users

639
00:27:54,850 --> 00:27:59,799
can set up different reset dates based

640
00:27:57,429 --> 00:28:04,679
on a group or a user or password length

641
00:27:59,799 --> 00:28:08,110
or require complexity requirements so

642
00:28:04,679 --> 00:28:10,269
with all this said this tool vibe is

643
00:28:08,110 --> 00:28:12,428
designed not just for red teamers but

644
00:28:10,269 --> 00:28:13,570
also for blue teamers to help kind of

645
00:28:12,429 --> 00:28:15,700
see where these gaps are in their

646
00:28:13,570 --> 00:28:19,418
environments and we can help also by

647
00:28:15,700 --> 00:28:22,630
combating these things so first off how

648
00:28:19,419 --> 00:28:25,389
do you stop LDAP abuse first thing would

649
00:28:22,630 --> 00:28:27,700
be you have to look at monitoring the

650
00:28:25,389 --> 00:28:30,070
amount and the traffic between a host

651
00:28:27,700 --> 00:28:32,970
and your domain controllers your LDAP

652
00:28:30,070 --> 00:28:35,230
server and look at the size of the

653
00:28:32,970 --> 00:28:37,450
request it's a lot of data being

654
00:28:35,230 --> 00:28:40,690
transferred over is it outside of the

655
00:28:37,450 --> 00:28:43,419
norm another thing which can be

656
00:28:40,690 --> 00:28:46,149
sometimes more costly is implementing

657
00:28:43,419 --> 00:28:48,570
firewalls to us isolate these boxes off

658
00:28:46,149 --> 00:28:53,549
and only allowing through firewall rules

659
00:28:48,570 --> 00:28:53,549
certain services on certain boxes access

660
00:28:53,669 --> 00:28:59,889
next one is net net share so I mentioned

661
00:28:57,610 --> 00:29:01,928
about trying to disable before without

662
00:28:59,889 --> 00:29:03,699
crippling an environment it's really

663
00:29:01,929 --> 00:29:06,789
hard especially with these windows api

664
00:29:03,700 --> 00:29:09,760
commands and calls so one of the things

665
00:29:06,789 --> 00:29:11,529
is is to really focus and narrow down

666
00:29:09,760 --> 00:29:13,389
the scope to understand what you're

667
00:29:11,529 --> 00:29:17,799
looking at one of the things I like to

668
00:29:13,389 --> 00:29:20,080
tell clients is to look at a request to

669
00:29:17,799 --> 00:29:21,820
see dollar sign admin dollar sign I

670
00:29:20,080 --> 00:29:24,820
talked about how those are usually key

671
00:29:21,820 --> 00:29:26,350
indicators if you have privileges to the

672
00:29:24,820 --> 00:29:29,080
administrative privileges or the ability

673
00:29:26,350 --> 00:29:30,699
to execute code on the box as well as

674
00:29:29,080 --> 00:29:35,470
any sensitive shares that may be

675
00:29:30,700 --> 00:29:38,860
business-related I've also seen this

676
00:29:35,470 --> 00:29:40,899
success SMB based firewalls on on the

677
00:29:38,860 --> 00:29:42,340
actual systems that can be sometimes

678
00:29:40,899 --> 00:29:44,799
more complex depending on the scale of

679
00:29:42,340 --> 00:29:46,449
your environment where you write rules

680
00:29:44,799 --> 00:29:48,940
only allowing string systems access

681
00:29:46,450 --> 00:29:51,519
turns other systems and it can be

682
00:29:48,940 --> 00:29:55,389
sometimes really hard and to manage and

683
00:29:51,519 --> 00:29:58,029
monitor as your company grows the next

684
00:29:55,389 --> 00:30:00,158
one would be net session so in that

685
00:29:58,029 --> 00:30:01,600
session really easy I said it's really

686
00:30:00,159 --> 00:30:05,049
easy to detect as well but it's also

687
00:30:01,600 --> 00:30:08,019
really easy to mitigate so that registry

688
00:30:05,049 --> 00:30:10,658
key up there that controls who has the

689
00:30:08,019 --> 00:30:15,370
ability to call this API windows ships

690
00:30:10,659 --> 00:30:16,960
by default with any user but you can set

691
00:30:15,370 --> 00:30:19,418
it to either of those three domain

692
00:30:16,960 --> 00:30:22,960
administrators server users power users

693
00:30:19,419 --> 00:30:29,230
and that will prevent certain as a large

694
00:30:22,960 --> 00:30:30,759
amount of abuse from this API so this

695
00:30:29,230 --> 00:30:32,259
tool this research has been an ongoing

696
00:30:30,759 --> 00:30:33,309
thing it's been a passion project for

697
00:30:32,259 --> 00:30:35,019
mine

698
00:30:33,309 --> 00:30:37,269
the next steps I'm looking at are

699
00:30:35,019 --> 00:30:38,679
developing more tools for both blue

700
00:30:37,269 --> 00:30:41,200
teams and red team's to help each other

701
00:30:38,679 --> 00:30:44,740
out that will be towards looking at

702
00:30:41,200 --> 00:30:46,779
local domain groups group policy abuse

703
00:30:44,740 --> 00:30:48,240
other things like that I'm always

704
00:30:46,779 --> 00:30:51,759
looking for more feedback information

705
00:30:48,240 --> 00:30:53,679
but I've had a lot of great response

706
00:30:51,759 --> 00:30:58,539
from the community looking at things and

707
00:30:53,679 --> 00:31:03,100
what really matters to both teams so

708
00:30:58,539 --> 00:31:04,929
recap adversaries are going become more

709
00:31:03,100 --> 00:31:08,129
stealthy living off the land using less

710
00:31:04,929 --> 00:31:13,269
noisy tools scripts powershell or even

711
00:31:08,129 --> 00:31:15,759
command-line arguments and as security

712
00:31:13,269 --> 00:31:18,669
pen testers it's our job to match it we

713
00:31:15,759 --> 00:31:20,350
train as hard as we fight so let's look

714
00:31:18,669 --> 00:31:21,850
at that let's see what they're doing

715
00:31:20,350 --> 00:31:26,740
what nation-state actors are doing and

716
00:31:21,850 --> 00:31:28,779
then we can help out defense in our way

717
00:31:26,740 --> 00:31:32,490
this tool vibe is not just meant as an

718
00:31:28,779 --> 00:31:32,490
offensive tool but also for defense

719
00:31:33,240 --> 00:31:37,960
posted a link it's live on github right

720
00:31:37,029 --> 00:31:39,639
now

721
00:31:37,960 --> 00:31:41,049
feel free to ever hit me up feel free to

722
00:31:39,639 --> 00:31:43,059
let me know if you have any questions or

723
00:31:41,049 --> 00:31:45,658
if you have an idea but at this point

724
00:31:43,059 --> 00:31:45,658
I'd like to take questions

725
00:31:50,419 --> 00:31:57,649
no questions yes

726
00:32:00,320 --> 00:32:09,330
so which technique per se there's lots

727
00:32:02,700 --> 00:32:13,230
of them so I would say I didn't create

728
00:32:09,330 --> 00:32:14,879
this technique there are some act ATP's

729
00:32:13,230 --> 00:32:17,279
out there where they do some limited

730
00:32:14,880 --> 00:32:19,409
stuff with LDAP I kind of tried to push

731
00:32:17,279 --> 00:32:21,450
the envelope and see how far their

732
00:32:19,409 --> 00:32:24,000
techniques would go in the sense of how

733
00:32:21,450 --> 00:32:27,570
much data we could pull down before we

734
00:32:24,000 --> 00:32:29,640
get detected so it becomes - a lot of

735
00:32:27,570 --> 00:32:31,649
the research and stuff we've seen in the

736
00:32:29,640 --> 00:32:36,020
real world out in the wild and then kind

737
00:32:31,649 --> 00:32:36,020
of pushing the boundaries for both teams

738
00:32:38,390 --> 00:32:44,060
any other questions okay thank you

739
00:32:43,250 --> 00:32:46,609
[Music]

740
00:32:44,060 --> 00:32:46,609
[Applause]

