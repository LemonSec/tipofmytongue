1
00:00:01,050 --> 00:00:02,669
alright thanks for everybody for for

2
00:00:02,669 --> 00:00:04,140
showing up I really appreciate it and a

3
00:00:04,140 --> 00:00:05,819
big thanks to the hackfest organizers

4
00:00:05,819 --> 00:00:08,309
this is I really enjoyed going to

5
00:00:08,309 --> 00:00:10,410
conferences and really well organized so

6
00:00:10,410 --> 00:00:15,540
thanks yes can't excuse me while I talk

7
00:00:15,540 --> 00:00:18,990
ok I get a dry mouth often get the water

8
00:00:18,990 --> 00:00:22,350
I've known alright so my name is passing

9
00:00:22,350 --> 00:00:25,170
pusle I please take a minute look me up

10
00:00:25,170 --> 00:00:26,400
on the internet always enjoy connecting

11
00:00:26,400 --> 00:00:32,700
with with new people so I am a

12
00:00:32,700 --> 00:00:35,520
penetration tester that's my my day job

13
00:00:35,520 --> 00:00:37,760
at least I work for a company at PSC

14
00:00:37,760 --> 00:00:42,059
kisi is primarily a PCI company as I

15
00:00:42,059 --> 00:00:43,440
miss my role within that company is a

16
00:00:43,440 --> 00:00:46,079
penetration tester I've been doing this

17
00:00:46,079 --> 00:00:49,140
for about 4 years now and probably about

18
00:00:49,140 --> 00:00:51,449
four years before that as a security

19
00:00:51,449 --> 00:00:54,930
analyst this is a really great pen test

20
00:00:54,930 --> 00:00:57,719
gig securely because of the methodology

21
00:00:57,719 --> 00:01:01,230
we have in place we tend to use a goal

22
00:01:01,230 --> 00:01:03,660
base pen test methodology so I can do

23
00:01:03,660 --> 00:01:07,110
lots of fun post exploitation work just

24
00:01:07,110 --> 00:01:09,240
that kind of a a full disclosure for the

25
00:01:09,240 --> 00:01:11,610
community I think most of the things are

26
00:01:11,610 --> 00:01:14,549
or I say nothing here is original for me

27
00:01:14,549 --> 00:01:15,600
these are the things that are inspired

28
00:01:15,600 --> 00:01:17,100
from people that I've met community my

29
00:01:17,100 --> 00:01:18,960
co-workers have really great team and

30
00:01:18,960 --> 00:01:21,270
other friends I have in the InfoSec

31
00:01:21,270 --> 00:01:23,310
community so so thanks everybody who

32
00:01:23,310 --> 00:01:25,500
gives me great information and helps me

33
00:01:25,500 --> 00:01:28,860
learn just as you guys know what to what

34
00:01:28,860 --> 00:01:31,500
to expect here today I want to go a

35
00:01:31,500 --> 00:01:33,210
couple terms so that we all are talking

36
00:01:33,210 --> 00:01:35,790
about the same thing review a couple of

37
00:01:35,790 --> 00:01:38,479
common implementations for separating

38
00:01:38,479 --> 00:01:41,640
security zones and then the end I'm

39
00:01:41,640 --> 00:01:43,020
gonna just go over a couple of what I

40
00:01:43,020 --> 00:01:45,060
call secure design concepts that sort of

41
00:01:45,060 --> 00:01:47,579
relate back to those those common

42
00:01:47,579 --> 00:01:52,680
implementations so InfoSec is is sort of

43
00:01:52,680 --> 00:01:54,540
rife with terminology and concepts that

44
00:01:54,540 --> 00:01:56,399
they get used in lots of different ways

45
00:01:56,399 --> 00:01:58,170
by different people I'm sure you guys

46
00:01:58,170 --> 00:02:00,210
I've run into lots of buzzwords that

47
00:02:00,210 --> 00:02:02,700
everybody wants to hear like DevOps and

48
00:02:02,700 --> 00:02:06,570
the cloud that makes us all happy so

49
00:02:06,570 --> 00:02:08,128
whether your blue team red team purple

50
00:02:08,128 --> 00:02:09,989
team whatever you want to call it you

51
00:02:09,989 --> 00:02:11,489
might use this term term differently it

52
00:02:11,489 --> 00:02:12,480
causes confusion

53
00:02:12,480 --> 00:02:14,610
I'm not suggesting that the way that I'm

54
00:02:14,610 --> 00:02:16,230
presenting me here is the right way I

55
00:02:16,230 --> 00:02:17,280
just want to make sure that we're all in

56
00:02:17,280 --> 00:02:20,069
the same page so that what I think I'm

57
00:02:20,069 --> 00:02:21,150
talking about is what you think I'm

58
00:02:21,150 --> 00:02:29,720
talking about so like I said before

59
00:02:29,720 --> 00:02:32,940
pissy company I work for is primarily a

60
00:02:32,940 --> 00:02:35,489
PCI company for those of you who aren't

61
00:02:35,489 --> 00:02:37,799
familiar with PCI PCI is the payment

62
00:02:37,799 --> 00:02:40,200
card industry so we're concerned with

63
00:02:40,200 --> 00:02:43,310
protecting your credit card information

64
00:02:43,310 --> 00:02:46,890
so often our goal for a penetration test

65
00:02:46,890 --> 00:02:50,340
is the cardholder data environment so

66
00:02:50,340 --> 00:02:52,230
most of our contesting the form of

67
00:02:52,230 --> 00:02:54,870
starting from some unprivileged portion

68
00:02:54,870 --> 00:02:57,510
of the network that might be sort of the

69
00:02:57,510 --> 00:02:59,940
standard user or maybe I think guest

70
00:02:59,940 --> 00:03:02,459
zone this might be something like the

71
00:03:02,459 --> 00:03:05,940
wireless we would then gain a foothold

72
00:03:05,940 --> 00:03:07,829
from there in your environment and then

73
00:03:07,829 --> 00:03:09,390
escalates we can ask for ssin of the

74
00:03:09,390 --> 00:03:12,540
network that has our target data for our

75
00:03:12,540 --> 00:03:14,010
purposes that's again that it's usually

76
00:03:14,010 --> 00:03:16,019
called the the carboard data environment

77
00:03:16,019 --> 00:03:17,819
but this might lots of different things

78
00:03:17,819 --> 00:03:22,440
depending on what the exact target is so

79
00:03:22,440 --> 00:03:24,389
lots of organizations get hacked I think

80
00:03:24,389 --> 00:03:26,280
we could all agree on that and just the

81
00:03:26,280 --> 00:03:28,290
side note this is a real book you guys

82
00:03:28,290 --> 00:03:32,359
can get that on Amazon those

83
00:03:32,359 --> 00:03:35,370
organizations that get hacked I think a

84
00:03:35,370 --> 00:03:37,530
lot of times some portion of the

85
00:03:37,530 --> 00:03:39,480
personnel that organization thought that

86
00:03:39,480 --> 00:03:43,019
they were secure however if you go speak

87
00:03:43,019 --> 00:03:46,200
to any any network or sysadmin they

88
00:03:46,200 --> 00:03:47,430
won't tell you that their network is

89
00:03:47,430 --> 00:03:50,579
impenetrable so there still seems to be

90
00:03:50,579 --> 00:03:52,799
a lot of buy-in and to what what I call

91
00:03:52,799 --> 00:03:54,180
anything effort of the people reference

92
00:03:54,180 --> 00:03:56,489
the yeah the imminence security model or

93
00:03:56,489 --> 00:03:59,129
we pretend like we're secure because we

94
00:03:59,129 --> 00:04:01,500
have a next-gen firewall we're hard on

95
00:04:01,500 --> 00:04:06,180
the outside soft gooey on the inside so

96
00:04:06,180 --> 00:04:08,940
what's the point everybody can get ax

97
00:04:08,940 --> 00:04:10,379
for potential there's potential there

98
00:04:10,379 --> 00:04:12,959
for anybody to get hacked taking into

99
00:04:12,959 --> 00:04:14,879
account the the hiring success that in

100
00:04:14,879 --> 00:04:16,228
privilege escalation that we have within

101
00:04:16,228 --> 00:04:18,870
my team and apparently the high rate of

102
00:04:18,870 --> 00:04:20,640
success that actual bad guys are having

103
00:04:20,640 --> 00:04:23,310
I felt was fair to push the initial

104
00:04:23,310 --> 00:04:25,289
system compromise type material out of

105
00:04:25,289 --> 00:04:26,280
scope for for the

106
00:04:26,280 --> 00:04:27,900
presentation and I'm going to kind of

107
00:04:27,900 --> 00:04:30,960
talk from a past the initial compromise

108
00:04:30,960 --> 00:04:32,970
stage so a sort of an assumed for each

109
00:04:32,970 --> 00:04:39,210
standpoint so a common paradigm is dated

110
00:04:39,210 --> 00:04:40,860
resources are classified differently

111
00:04:40,860 --> 00:04:43,400
from others depending on their use

112
00:04:43,400 --> 00:04:45,960
we like to designate systems and

113
00:04:45,960 --> 00:04:47,580
resources with labels based on the roles

114
00:04:47,580 --> 00:04:50,730
so QA dev whatever it might be

115
00:04:50,730 --> 00:04:55,590
everybody's networks different you might

116
00:04:55,590 --> 00:04:57,090
have an o'er segment represents

117
00:04:57,090 --> 00:04:59,330
marketing one for free human resources

118
00:04:59,330 --> 00:05:02,220
in terms of creating a security zone the

119
00:05:02,220 --> 00:05:03,960
question that that I think you start

120
00:05:03,960 --> 00:05:06,300
with is do the resources and marketing

121
00:05:06,300 --> 00:05:08,010
eat to be able to access resources in

122
00:05:08,010 --> 00:05:13,710
human resources or maybe does IT need to

123
00:05:13,710 --> 00:05:15,060
be it would access everything in the

124
00:05:15,060 --> 00:05:17,760
call center advanced probably yes but

125
00:05:17,760 --> 00:05:19,530
when you're thinking about the security

126
00:05:19,530 --> 00:05:23,040
zones yes you have to ask a question and

127
00:05:23,040 --> 00:05:24,450
for the purposes of this talk we are

128
00:05:24,450 --> 00:05:26,310
reviewing environments where divisions

129
00:05:26,310 --> 00:05:28,350
exists that have security requirements

130
00:05:28,350 --> 00:05:30,900
of varying degrees so talking about

131
00:05:30,900 --> 00:05:32,310
networks where everybody doesn't need

132
00:05:32,310 --> 00:05:34,620
access to everything basically if that's

133
00:05:34,620 --> 00:05:36,390
not the case for you then then I suppose

134
00:05:36,390 --> 00:05:38,430
and your life is simpler than everybody

135
00:05:38,430 --> 00:05:43,470
else and finally production is just a

136
00:05:43,470 --> 00:05:46,110
label for that we've seen here for the

137
00:05:46,110 --> 00:05:48,150
zone that contains high value SS might

138
00:05:48,150 --> 00:05:50,460
have several of these it might be serve

139
00:05:50,460 --> 00:05:52,020
different functions but I felt like

140
00:05:52,020 --> 00:05:53,550
production was labeled it would make

141
00:05:53,550 --> 00:05:55,200
sense to everybody in referencing some

142
00:05:55,200 --> 00:05:56,789
some zone we want to protect from

143
00:05:56,789 --> 00:06:03,690
everybody being able to access so next

144
00:06:03,690 --> 00:06:05,910
we just have to consider the boundaries

145
00:06:05,910 --> 00:06:07,770
and access between zones so for instance

146
00:06:07,770 --> 00:06:09,539
it's a lot of logical to imagine that

147
00:06:09,539 --> 00:06:12,650
some privileged users and your your ite

148
00:06:12,650 --> 00:06:15,539
segment would actually need to access

149
00:06:15,539 --> 00:06:17,520
the production network stocks going to

150
00:06:17,520 --> 00:06:18,810
investigate some of the barriers that

151
00:06:18,810 --> 00:06:20,400
are implemented so that only those

152
00:06:20,400 --> 00:06:23,220
intended users are accessing that that

153
00:06:23,220 --> 00:06:27,840
zone okay so starting off with some of

154
00:06:27,840 --> 00:06:30,000
the the common implications there flaws

155
00:06:30,000 --> 00:06:35,880
and bypasses so when I gave this for to

156
00:06:35,880 --> 00:06:37,890
some of my friends to review they

157
00:06:37,890 --> 00:06:39,000
mentioned that I didn't have enough cat

158
00:06:39,000 --> 00:06:39,689
me

159
00:06:39,689 --> 00:06:42,180
I ran into this meme at a different

160
00:06:42,180 --> 00:06:45,949
conference and I can't stop watching it

161
00:06:46,280 --> 00:06:48,479
you guys gonna Google this afterwards

162
00:06:48,479 --> 00:06:51,419
stare at it for a while I'm sure so so

163
00:06:51,419 --> 00:06:53,310
this is my this is my cat meme

164
00:06:53,310 --> 00:06:56,580
transistor slide just a quick note I'm

165
00:06:56,580 --> 00:06:58,139
gonna focus on a simplified version of

166
00:06:58,139 --> 00:06:59,460
these technologies for this talk I

167
00:06:59,460 --> 00:07:00,870
understand that their actual

168
00:07:00,870 --> 00:07:02,879
implementation in the real world is real

169
00:07:02,879 --> 00:07:08,180
world is more complex and nuanced I I

170
00:07:08,180 --> 00:07:10,379
and so you know don't don't get

171
00:07:10,379 --> 00:07:12,960
distracted by just sort of quickness or

172
00:07:12,960 --> 00:07:16,439
a low level of these in terms of a

173
00:07:16,439 --> 00:07:18,330
compromise we're talking about you know

174
00:07:18,330 --> 00:07:19,889
exporting many pieces of of an

175
00:07:19,889 --> 00:07:23,849
environment and we're not going to these

176
00:07:23,849 --> 00:07:26,729
are loosely broken up with the first

177
00:07:26,729 --> 00:07:28,590
view focusing on the network boundary

178
00:07:28,590 --> 00:07:29,939
and the rest bonusing on the

179
00:07:29,939 --> 00:07:31,650
authentication boundary that's good

180
00:07:31,650 --> 00:07:33,539
looked like the identity management is

181
00:07:33,539 --> 00:07:36,569
the the network segmentation of 21st

182
00:07:36,569 --> 00:07:41,759
century so the the first lucien i want

183
00:07:41,759 --> 00:07:44,370
to jump into is what i'm calling a

184
00:07:44,370 --> 00:07:47,669
fireball so broadly fired call might be

185
00:07:47,669 --> 00:07:49,379
might describe any method provide

186
00:07:49,379 --> 00:07:51,150
temporary emergency access to a secure

187
00:07:51,150 --> 00:07:54,120
system i want to focus on those

188
00:07:54,120 --> 00:07:55,710
implementations where an organization

189
00:07:55,710 --> 00:07:58,080
allows or denies access through a

190
00:07:58,080 --> 00:07:59,940
network boundary through some sort of

191
00:07:59,940 --> 00:08:01,500
manual or automated changes to the

192
00:08:01,500 --> 00:08:04,169
network access controls so maybe this

193
00:08:04,169 --> 00:08:05,729
takes the form of submitting a submit

194
00:08:05,729 --> 00:08:07,830
request to IT though they change your

195
00:08:07,830 --> 00:08:10,889
network ACLs or maybe something the

196
00:08:10,889 --> 00:08:12,539
fancier we have an application that

197
00:08:12,539 --> 00:08:15,599
makes dynamic firewall rule changes some

198
00:08:15,599 --> 00:08:21,360
mixture somewhere in between those so

199
00:08:21,360 --> 00:08:23,009
the the first issue I want to talk about

200
00:08:23,009 --> 00:08:27,050
with this with the solution is a

201
00:08:27,050 --> 00:08:29,969
situation where an organization lies on

202
00:08:29,969 --> 00:08:32,490
manual firewall rule of manipulation to

203
00:08:32,490 --> 00:08:35,990
control access between different zones

204
00:08:35,990 --> 00:08:38,698
and think about complexity of management

205
00:08:38,698 --> 00:08:41,309
over time so networks that start out and

206
00:08:41,309 --> 00:08:42,448
they're designed looking like this with

207
00:08:42,448 --> 00:08:44,219
lots of great well-defined pieces and

208
00:08:44,219 --> 00:08:46,829
great network diagrams because the

209
00:08:46,829 --> 00:08:48,420
challenge of management these complex

210
00:08:48,420 --> 00:08:50,490
environments over time they migrate from

211
00:08:50,490 --> 00:08:52,140
something that looks like this

212
00:08:52,140 --> 00:08:53,490
something that looks a little bit more

213
00:08:53,490 --> 00:08:55,910
like this

214
00:08:56,450 --> 00:08:58,830
and what I want you to consider is that

215
00:08:58,830 --> 00:09:00,870
having even one exception that permits

216
00:09:00,870 --> 00:09:03,150
access to control network environment

217
00:09:03,150 --> 00:09:04,410
that you aren't aware of as

218
00:09:04,410 --> 00:09:06,600
administrator presents a very

219
00:09:06,600 --> 00:09:09,120
significant risk I think when you

220
00:09:09,120 --> 00:09:11,040
consider some of the exploitation areas

221
00:09:11,040 --> 00:09:13,890
though the security flaws present in the

222
00:09:13,890 --> 00:09:15,510
solution are a little bit more inherent

223
00:09:15,510 --> 00:09:17,700
to its functionality because these

224
00:09:17,700 --> 00:09:19,740
exceptions effectively create a bridge

225
00:09:19,740 --> 00:09:35,340
between zones so so all attacker needs

226
00:09:35,340 --> 00:09:39,570
to to exploit this is a to compromise a

227
00:09:39,570 --> 00:09:41,580
host that's the beneficiary of modified

228
00:09:41,580 --> 00:09:44,100
rules in the situation and this bridge

229
00:09:44,100 --> 00:09:45,210
is easily traversed by an attacker

230
00:09:45,210 --> 00:09:47,610
commonly refer to it as pivoting I think

231
00:09:47,610 --> 00:09:50,400
anybody who's read anything about

232
00:09:50,400 --> 00:09:51,720
hacking is probably running that that

233
00:09:51,720 --> 00:09:53,850
term at some point so essentially

234
00:09:53,850 --> 00:09:55,380
compromise at the low security zone

235
00:09:55,380 --> 00:09:57,120
means a direct path to that higher

236
00:09:57,120 --> 00:10:02,700
security zone and just to kind of talk

237
00:10:02,700 --> 00:10:05,930
about a basic representation of this in

238
00:10:05,930 --> 00:10:10,620
which my see in a basic pen test the

239
00:10:10,620 --> 00:10:12,000
attacker might start off by detecting

240
00:10:12,000 --> 00:10:15,540
holes collecting network connection data

241
00:10:15,540 --> 00:10:17,850
from a range of target systems this is

242
00:10:17,850 --> 00:10:19,290
what we're demonstrating here it's just

243
00:10:19,290 --> 00:10:23,250
the output of maybe a net step then we

244
00:10:23,250 --> 00:10:24,780
want to use something like the super

245
00:10:24,780 --> 00:10:26,700
hacker tool grep to sort through that

246
00:10:26,700 --> 00:10:28,350
data to enumerate anything that might

247
00:10:28,350 --> 00:10:29,880
indicate the president of those presence

248
00:10:29,880 --> 00:10:32,850
of this firewall exceptions so you know

249
00:10:32,850 --> 00:10:35,400
we've escalated we've dumped net stats

250
00:10:35,400 --> 00:10:36,870
from arrange systems and then we want to

251
00:10:36,870 --> 00:10:38,610
see is anybody connected to a host that

252
00:10:38,610 --> 00:10:41,100
I want to be able to connect to it's as

253
00:10:41,100 --> 00:10:42,410
simple as that

254
00:10:42,410 --> 00:10:44,940
then we just fall back to you a hacking

255
00:10:44,940 --> 00:10:48,000
class 101 we use meterpreter for traffic

256
00:10:48,000 --> 00:10:49,560
through a compromised system and this

257
00:10:49,560 --> 00:10:50,790
could be any sort of post exploitation

258
00:10:50,790 --> 00:10:53,250
agent or maybe using a Windows system

259
00:10:53,250 --> 00:10:56,490
that Sh there's a great possibility that

260
00:10:56,490 --> 00:10:58,170
I just used meterpreter in this example

261
00:10:58,170 --> 00:11:01,800
because it's fairly ubiquitous so we we

262
00:11:01,800 --> 00:11:03,270
use interpreter for traffic through our

263
00:11:03,270 --> 00:11:04,740
optimize system to the production

264
00:11:04,740 --> 00:11:05,700
network

265
00:11:05,700 --> 00:11:08,280
another situation to consider is if an

266
00:11:08,280 --> 00:11:10,350
attacker has compromised a machine that

267
00:11:10,350 --> 00:11:12,750
they know can or will access the target

268
00:11:12,750 --> 00:11:15,690
environment they just needed to create

269
00:11:15,690 --> 00:11:18,210
the situation where the fire calls that

270
00:11:18,210 --> 00:11:20,130
will be you just order to take advantage

271
00:11:20,130 --> 00:11:29,370
of this and that's a pretty

272
00:11:29,370 --> 00:11:31,170
straightforward I think anybody's done a

273
00:11:31,170 --> 00:11:32,850
pen test or has been involved in the pen

274
00:11:32,850 --> 00:11:34,290
test has probably seen something like

275
00:11:34,290 --> 00:11:56,190
this that happened so all right back to

276
00:11:56,190 --> 00:12:03,420
a professional cool so the takeaways

277
00:12:03,420 --> 00:12:05,940
here like I said I think that the sort

278
00:12:05,940 --> 00:12:06,750
of the some of the built-in

279
00:12:06,750 --> 00:12:08,190
characteristics I just make it very hard

280
00:12:08,190 --> 00:12:11,220
to make secure a couple of thoughts if

281
00:12:11,220 --> 00:12:13,590
if you are going to to use this as a

282
00:12:13,590 --> 00:12:15,570
solution where if this is your solution

283
00:12:15,570 --> 00:12:18,000
if a company where you work at the

284
00:12:18,000 --> 00:12:19,230
smaller you can make the winner of

285
00:12:19,230 --> 00:12:22,500
exposure the better off you are this set

286
00:12:22,500 --> 00:12:23,700
up seems to make the most sense for

287
00:12:23,700 --> 00:12:25,830
organizations where there's a very

288
00:12:25,830 --> 00:12:28,190
limited number of users systems

289
00:12:28,190 --> 00:12:31,350
accessing those high-value assets so so

290
00:12:31,350 --> 00:12:32,730
you can place the strict controls around

291
00:12:32,730 --> 00:12:34,890
them a couple of thoughts limiting and

292
00:12:34,890 --> 00:12:37,620
exposure restrict client decline and

293
00:12:37,620 --> 00:12:39,090
communication for the network do your

294
00:12:39,090 --> 00:12:40,230
workstations really need to be able to

295
00:12:40,230 --> 00:12:41,550
you indicate with each other probably

296
00:12:41,550 --> 00:12:45,060
not any holes that you poke have

297
00:12:45,060 --> 00:12:47,280
built-in automated close if possible so

298
00:12:47,280 --> 00:12:49,290
shorter and more specific time windows

299
00:12:49,290 --> 00:12:50,970
where that exposure happens a better

300
00:12:50,970 --> 00:12:52,980
regular testing and confirmation of

301
00:12:52,980 --> 00:12:56,370
segmentation consider or maybe if you

302
00:12:56,370 --> 00:12:58,770
want to go the next step consider any

303
00:12:58,770 --> 00:13:00,330
administration of those high security

304
00:13:00,330 --> 00:13:02,190
zones to take place over some sort of

305
00:13:02,190 --> 00:13:09,090
true air gap all right up next VPN I'm

306
00:13:09,090 --> 00:13:10,650
sure this is a term that everybody is

307
00:13:10,650 --> 00:13:12,930
familiar with but just to make sure

308
00:13:12,930 --> 00:13:14,820
we're all on the same page it's talking

309
00:13:14,820 --> 00:13:16,500
about a tunnel between your private

310
00:13:16,500 --> 00:13:17,970
network and a remote private network

311
00:13:17,970 --> 00:13:20,890
probably over the Internet

312
00:13:20,890 --> 00:13:23,500
this is a very common for connecting

313
00:13:23,500 --> 00:13:24,910
production networks and remote data

314
00:13:24,910 --> 00:13:27,250
centers I felt like this was

315
00:13:27,250 --> 00:13:29,830
particularly timely because I've seen

316
00:13:29,830 --> 00:13:31,420
more and more production networks move

317
00:13:31,420 --> 00:13:34,420
move all or partially into something

318
00:13:34,420 --> 00:13:37,930
like AWS and those room was always

319
00:13:37,930 --> 00:13:42,580
accessed over VPN so the first

320
00:13:42,580 --> 00:13:43,750
implementation issue we're talking about

321
00:13:43,750 --> 00:13:49,120
is at the split tunnel so with the split

322
00:13:49,120 --> 00:13:50,950
tunnel we start with an open face on our

323
00:13:50,950 --> 00:13:52,900
local land it's pretty straightforward

324
00:13:52,900 --> 00:13:55,000
then we essentially just adding another

325
00:13:55,000 --> 00:13:56,920
network interface that connects to our

326
00:13:56,920 --> 00:13:59,410
remote network so this configuration

327
00:13:59,410 --> 00:14:01,240
effectively creates a bridge between the

328
00:14:01,240 --> 00:14:04,390
local and remote network this is useful

329
00:14:04,390 --> 00:14:07,810
because it allows allows local network

330
00:14:07,810 --> 00:14:11,230
resources and to access allows you to

331
00:14:11,230 --> 00:14:13,120
access local network resources walking

332
00:14:13,120 --> 00:14:16,090
into your remote network or maybe if you

333
00:14:16,090 --> 00:14:18,160
need internet browsing you don't want

334
00:14:18,160 --> 00:14:19,990
traffic from that remote network I'm

335
00:14:19,990 --> 00:14:23,220
just great functionality wise this is

336
00:14:23,220 --> 00:14:26,530
also useful to an attacker because this

337
00:14:26,530 --> 00:14:28,780
is easy to protect and the exploitation

338
00:14:28,780 --> 00:14:31,180
error scenario is identical to that of a

339
00:14:31,180 --> 00:14:34,920
network where there is not a boundaries

340
00:14:35,820 --> 00:14:40,390
so what's the sort of alternative but

341
00:14:40,390 --> 00:14:42,610
the full tunnel VPN assured that when

342
00:14:42,610 --> 00:14:45,070
the VPN connection is active that no but

343
00:14:45,070 --> 00:14:46,540
the host no longer has to activity to

344
00:14:46,540 --> 00:14:48,580
the local network so eliminating that

345
00:14:48,580 --> 00:14:52,030
bridge so security wise this is

346
00:14:52,030 --> 00:14:54,280
definitely a superior situation from

347
00:14:54,280 --> 00:14:58,660
that just splits on so for instance we

348
00:14:58,660 --> 00:15:00,460
talked about you know using her Berta

349
00:15:00,460 --> 00:15:03,370
for traffic before if we had some sort

350
00:15:03,370 --> 00:15:04,930
of post exploitation she'll open on the

351
00:15:04,930 --> 00:15:08,440
target host the VPN is activated pardon

352
00:15:08,440 --> 00:15:11,830
me the connective connectivity would be

353
00:15:11,830 --> 00:15:14,080
lost when that Vuk goes up because now

354
00:15:14,080 --> 00:15:15,700
we don't see direct access into that

355
00:15:15,700 --> 00:15:22,990
level Lane so the full tunnel makes a a

356
00:15:22,990 --> 00:15:24,640
bypass harder is still reasonably

357
00:15:24,640 --> 00:15:27,820
possible to get around and I just want

358
00:15:27,820 --> 00:15:29,950
to cover how how that might look

359
00:15:29,950 --> 00:15:33,370
so what perspective to consider for for

360
00:15:33,370 --> 00:15:36,160
the bypass is now where or for a

361
00:15:36,160 --> 00:15:38,290
penthouse room I called a they specially

362
00:15:38,290 --> 00:15:40,210
crafted post exploit payload that could

363
00:15:40,210 --> 00:15:42,430
detect changes in network interfaces for

364
00:15:42,430 --> 00:15:44,080
firing off a connection to load

365
00:15:44,080 --> 00:15:46,930
additional post exploitable Network

366
00:15:46,930 --> 00:15:48,850
maybe something on the internet or

367
00:15:48,850 --> 00:15:50,950
something on some other internal network

368
00:15:50,950 --> 00:15:55,089
that allows a lot from our target

369
00:15:55,089 --> 00:15:58,630
networks so in this scenario need a tart

370
00:15:58,630 --> 00:16:00,220
user that we know can access the secure

371
00:16:00,220 --> 00:16:03,550
environment this might this might be

372
00:16:03,550 --> 00:16:05,110
something like review writing processes

373
00:16:05,110 --> 00:16:09,370
on on several hosts or see who has a VPN

374
00:16:09,370 --> 00:16:11,380
client what sort of network connectivity

375
00:16:11,380 --> 00:16:15,550
they have up checking vo ad group

376
00:16:15,550 --> 00:16:18,670
memberships so once we have our expertly

377
00:16:18,670 --> 00:16:23,950
crafted we need to get it running one

378
00:16:23,950 --> 00:16:26,440
way that I like to accomplish this is to

379
00:16:26,440 --> 00:16:29,140
use to create a service on the remote

380
00:16:29,140 --> 00:16:31,270
system and just have it run next jubal

381
00:16:31,270 --> 00:16:33,640
it's handy and it will continue to run

382
00:16:33,640 --> 00:16:38,020
and then we wait for our show to happen

383
00:16:38,020 --> 00:16:40,420
so it in this scenario we're just

384
00:16:40,420 --> 00:16:42,850
looking for some some situation scenario

385
00:16:42,850 --> 00:16:45,940
to happen so we see that VPN go up or

386
00:16:45,940 --> 00:16:47,380
the network interface changes the week

387
00:16:47,380 --> 00:16:49,060
you know about and the binary is looking

388
00:16:49,060 --> 00:16:51,160
for that's that state changed to happen

389
00:16:51,160 --> 00:16:54,220
that happens it does whatever we've you

390
00:16:54,220 --> 00:16:56,500
know for decided to do so reaching out

391
00:16:56,500 --> 00:16:58,420
to whatever our target network is now

392
00:16:58,420 --> 00:17:00,220
obviously this takes a lot of recon and

393
00:17:00,220 --> 00:17:02,770
thought but it's it's certainly possible

394
00:17:02,770 --> 00:17:07,270
and then we've connected to our tired

395
00:17:07,270 --> 00:17:10,379
network so we're good to go

396
00:17:13,709 --> 00:17:17,349
so takeaways I think I seem that we're

397
00:17:17,349 --> 00:17:18,880
seeing here it was once the attacker has

398
00:17:18,880 --> 00:17:20,319
an administrative access to the system

399
00:17:20,319 --> 00:17:21,970
the rest of the bypass is only limited

400
00:17:21,970 --> 00:17:24,579
by creativity just like with firewall

401
00:17:24,579 --> 00:17:26,199
it's at all possible we go to limit

402
00:17:26,199 --> 00:17:27,790
local network exposure of users that

403
00:17:27,790 --> 00:17:29,560
have evening access to high security

404
00:17:29,560 --> 00:17:32,679
environments definitely willing to avoid

405
00:17:32,679 --> 00:17:34,120
any situation work trading direct

406
00:17:34,120 --> 00:17:36,820
register between zones so that's where

407
00:17:36,820 --> 00:17:39,350
that that full tunnel comes in play

408
00:17:39,350 --> 00:17:41,120
and multi-factor authentication without

409
00:17:41,120 --> 00:17:43,940
a band conformation is certainly an

410
00:17:43,940 --> 00:17:46,159
option you want consider probably

411
00:17:46,159 --> 00:17:48,200
scenario but uh places place a little

412
00:17:48,200 --> 00:17:52,880
here and I'll touch LeBron on FFA when

413
00:17:52,880 --> 00:17:57,649
the next section alright so uh

414
00:17:57,649 --> 00:18:00,440
up next is jump box I don't know if I

415
00:18:00,440 --> 00:18:01,429
think different people use different

416
00:18:01,429 --> 00:18:03,409
terms for this may be some sort of

417
00:18:03,409 --> 00:18:05,210
fashion host the the jump boxing could

418
00:18:05,210 --> 00:18:13,610
be the most most common so jump box for

419
00:18:13,610 --> 00:18:15,440
our purposes is gonna be a device that

420
00:18:15,440 --> 00:18:18,110
spans two to similar security zones and

421
00:18:18,110 --> 00:18:20,750
typically we see this built with SSH or

422
00:18:20,750 --> 00:18:23,570
remote desktop pending on technologies

423
00:18:23,570 --> 00:18:26,809
you want to employ so it provides a nice

424
00:18:26,809 --> 00:18:29,059
way to implement and network boundary by

425
00:18:29,059 --> 00:18:31,039
restricting connections between zones no

426
00:18:31,039 --> 00:18:35,960
one or a few hosts and also a place to

427
00:18:35,960 --> 00:18:38,899
implement off in the case of boundary so

428
00:18:38,899 --> 00:18:41,330
so you gives you a way to do both and

429
00:18:41,330 --> 00:18:47,000
not one solution so the first sort of

430
00:18:47,000 --> 00:18:50,929
but flaw or maybe implementation issue

431
00:18:50,929 --> 00:18:53,570
that we see here is what we call stale

432
00:18:53,570 --> 00:18:56,419
sessions so let's imagine that we've

433
00:18:56,419 --> 00:18:59,059
compromised a user that has that where

434
00:18:59,059 --> 00:19:01,159
they're using RDP to connect to our our

435
00:19:01,159 --> 00:19:03,740
target zone Becky user locks our

436
00:19:03,740 --> 00:19:06,500
computer on walks away for the day maybe

437
00:19:06,500 --> 00:19:08,480
they just go to lunch if we compromised

438
00:19:08,480 --> 00:19:09,830
that user system or we already had

439
00:19:09,830 --> 00:19:11,960
access to it when they walk away we can

440
00:19:11,960 --> 00:19:16,070
simply login now in this in this

441
00:19:16,070 --> 00:19:19,370
compromised scenario you know obviously

442
00:19:19,370 --> 00:19:20,389
someone was to walk back to their

443
00:19:20,389 --> 00:19:22,879
computer and do something they would see

444
00:19:22,879 --> 00:19:24,409
that I'm messing around with her that's

445
00:19:24,409 --> 00:19:27,049
not session that would be that give way

446
00:19:27,049 --> 00:19:30,169
and that's kind of a game over however I

447
00:19:30,169 --> 00:19:32,659
I think it's reasonable to imagine you

448
00:19:32,659 --> 00:19:34,120
could script something up that would

449
00:19:34,120 --> 00:19:37,159
that would exploit the scenario and you

450
00:19:37,159 --> 00:19:39,019
know just a couple of seconds so you

451
00:19:39,019 --> 00:19:40,159
know it's not like a mistakes that

452
00:19:40,159 --> 00:19:41,059
they're a player with remote desktop

453
00:19:41,059 --> 00:19:47,750
session all day so the next inflammation

454
00:19:47,750 --> 00:19:49,460
flaw have been accounted with with this

455
00:19:49,460 --> 00:19:53,309
is which single authentication zone so

456
00:19:53,309 --> 00:19:55,740
just like to go back to our GP because

457
00:19:55,740 --> 00:19:59,279
it's so common if we have one of Active

458
00:19:59,279 --> 00:20:01,289
Directory domain that's controlling both

459
00:20:01,289 --> 00:20:03,870
these zones I think the most obvious

460
00:20:03,870 --> 00:20:05,370
problem here is that if you're

461
00:20:05,370 --> 00:20:07,470
authenticating with same set of friends

462
00:20:07,470 --> 00:20:10,049
with credentials two to two zones they

463
00:20:10,049 --> 00:20:13,019
aren't really two zones so the attack

464
00:20:13,019 --> 00:20:15,330
surface can vary greatly based on

465
00:20:15,330 --> 00:20:17,610
exactly what the implementation is but

466
00:20:17,610 --> 00:20:20,009
but even if the use of the jump-off

467
00:20:20,009 --> 00:20:21,360
provides an effective way it created

468
00:20:21,360 --> 00:20:23,779
strong Network boundary Oh

469
00:20:23,779 --> 00:20:26,279
one way attacker might leverage this

470
00:20:26,279 --> 00:20:28,259
shared infrastructure in Africa

471
00:20:28,259 --> 00:20:34,289
is something like user logon scripts if

472
00:20:34,289 --> 00:20:36,330
you're not familiar with logon scripts

473
00:20:36,330 --> 00:20:38,039
in Active Directory it's essentially

474
00:20:38,039 --> 00:20:39,720
just a way to set something that runs

475
00:20:39,720 --> 00:20:43,169
when a when a user logs in so you can

476
00:20:43,169 --> 00:20:46,049
assign tasks or and there's testing and

477
00:20:46,049 --> 00:20:48,210
for something like an executable so

478
00:20:48,210 --> 00:20:50,639
potentially we didn't design a script

479
00:20:50,639 --> 00:20:53,879
that will execute and it's would be

480
00:20:53,879 --> 00:20:56,249
something that we've we generated and we

481
00:20:56,249 --> 00:20:58,200
designed that script so that it fires

482
00:20:58,200 --> 00:21:01,110
off some sort of additional code to our

483
00:21:01,110 --> 00:21:03,960
target host and we just have to target

484
00:21:03,960 --> 00:21:05,340
user we know it's going to access the

485
00:21:05,340 --> 00:21:08,639
zone that we want to get to so so we're

486
00:21:08,639 --> 00:21:10,320
essentially like leveraging a curious

487
00:21:10,320 --> 00:21:13,789
substance to do some of the work for us

488
00:21:14,700 --> 00:21:16,369
[Music]

489
00:21:16,369 --> 00:21:19,830
in the factor authentication this is

490
00:21:19,830 --> 00:21:21,539
quite this comes into play seems like

491
00:21:21,539 --> 00:21:23,610
the most often and in this jump box

492
00:21:23,610 --> 00:21:26,549
architecture so there's definitely

493
00:21:26,549 --> 00:21:28,470
strengthens that authentication boundary

494
00:21:28,470 --> 00:21:30,240
between the zones by making the exploit

495
00:21:30,240 --> 00:21:33,090
process far more complex and we we

496
00:21:33,090 --> 00:21:34,559
definitely recommend that this is the

497
00:21:34,559 --> 00:21:37,799
technology to use but it certainly comes

498
00:21:37,799 --> 00:21:39,480
with its own set of limitation

499
00:21:39,480 --> 00:21:42,389
challenges like everything in the fake

500
00:21:42,389 --> 00:21:44,279
can be deployed in a way that makes it

501
00:21:44,279 --> 00:21:47,519
prone to attack or bypass so one miss

502
00:21:47,519 --> 00:21:48,990
configuration I've seen here when in the

503
00:21:48,990 --> 00:21:51,899
FAA is it's in place is making the MFA

504
00:21:51,899 --> 00:21:53,639
server itself accessible accessible and

505
00:21:53,639 --> 00:22:00,179
lower security zone so just to kind of

506
00:22:00,179 --> 00:22:02,159
walk through a an exploit scenario where

507
00:22:02,159 --> 00:22:04,559
this is the case at one for I like to

508
00:22:04,559 --> 00:22:06,090
look for during initial sort of scanning

509
00:22:06,090 --> 00:22:06,780
and enumeration

510
00:22:06,780 --> 00:22:09,330
is anything that's associated with mfa

511
00:22:09,330 --> 00:22:12,750
management like just for example the RSA

512
00:22:12,750 --> 00:22:15,930
console has supports it will run on or a

513
00:22:15,930 --> 00:22:20,390
signature that you can see with SSH so

514
00:22:20,390 --> 00:22:22,650
if the management console is accessible

515
00:22:22,650 --> 00:22:24,930
from the low security zone we just have

516
00:22:24,930 --> 00:22:30,870
to be able to log in right and kind of

517
00:22:30,870 --> 00:22:32,220
going hand-in-hand part of the

518
00:22:32,220 --> 00:22:35,100
application problem is allowing log on

519
00:22:35,100 --> 00:22:37,800
to the MFA console using to make fences

520
00:22:37,800 --> 00:22:40,140
for your lowest rate zone or maybe you

521
00:22:40,140 --> 00:22:42,920
don't have to separate separate domains

522
00:22:42,920 --> 00:22:45,420
so in that instance you already have our

523
00:22:45,420 --> 00:22:48,540
username and password in any case we

524
00:22:48,540 --> 00:22:50,960
target our user gain access to the login

525
00:22:50,960 --> 00:22:52,860
and I'm not gonna say that getting

526
00:22:52,860 --> 00:22:54,510
traditions for something like this is a

527
00:22:54,510 --> 00:22:55,590
foregone conclusion

528
00:22:55,590 --> 00:22:58,800
but typically by the time I'm ready to

529
00:22:58,800 --> 00:23:00,270
think about bypassing that they already

530
00:23:00,270 --> 00:23:01,740
have the credentials I need whether it's

531
00:23:01,740 --> 00:23:03,870
just hiring a local user and do some

532
00:23:03,870 --> 00:23:06,000
route for us or using 80 trenches that

533
00:23:06,000 --> 00:23:08,250
we've stolen through something into yes

534
00:23:08,250 --> 00:23:12,030
I did or something like that so once we

535
00:23:12,030 --> 00:23:13,530
have our credentials we can log in to do

536
00:23:13,530 --> 00:23:15,200
interesting things on the RSA console

537
00:23:15,200 --> 00:23:17,880
like is yourself top of the soft token

538
00:23:17,880 --> 00:23:20,130
and if you already have a Miss we need

539
00:23:20,130 --> 00:23:26,130
now we can get past your MFA if you're

540
00:23:26,130 --> 00:23:29,000
really interested it's up stuff like MFA

541
00:23:29,000 --> 00:23:31,830
bypasses this is a talk I highly

542
00:23:31,830 --> 00:23:34,230
recommend a co-worker of mine he gave a

543
00:23:34,230 --> 00:23:36,090
talk in at Derby con it's with 2015

544
00:23:36,090 --> 00:23:38,250
called practical taxi it's multi-factor

545
00:23:38,250 --> 00:23:42,050
I definitely recommend looking that up

546
00:23:43,010 --> 00:23:45,380
so just a couple of takeaways here

547
00:23:45,380 --> 00:23:47,790
consider the tenant controls around how

548
00:23:47,790 --> 00:23:49,770
users access high-security zones for

549
00:23:49,770 --> 00:23:51,990
instance session timeouts on remote

550
00:23:51,990 --> 00:23:54,780
desktop sessions consider the

551
00:23:54,780 --> 00:23:56,850
implications of compromise for critical

552
00:23:56,850 --> 00:23:58,950
systems if you're not thinking about

553
00:23:58,950 --> 00:24:01,200
this from the assumed compromise or

554
00:24:01,200 --> 00:24:03,000
assume breach perspective you're missing

555
00:24:03,000 --> 00:24:05,490
opportunities to really secure your and

556
00:24:05,490 --> 00:24:10,640
harden your systems okay next up is BDI

557
00:24:10,640 --> 00:24:13,650
so for if you're not familiar virtual

558
00:24:13,650 --> 00:24:18,390
desktop infrastructure it's a solution

559
00:24:18,390 --> 00:24:20,370
just lets you deliver application

560
00:24:20,370 --> 00:24:22,580
quite often full desktop environments

561
00:24:22,580 --> 00:24:24,990
when it's used to deliver a desktop

562
00:24:24,990 --> 00:24:26,730
environment it's essentially a variation

563
00:24:26,730 --> 00:24:28,260
on the jump box we just discussed

564
00:24:28,260 --> 00:24:30,390
just like the jump box design VDS

565
00:24:30,390 --> 00:24:34,230
typically still violates a true

566
00:24:34,230 --> 00:24:37,440
separation of zones so the first issue

567
00:24:37,440 --> 00:24:39,600
I'm going to talk about with VDI is the

568
00:24:39,600 --> 00:24:42,390
abandoned sessions without screen locks

569
00:24:42,390 --> 00:24:45,570
so just like in the previous that just

570
00:24:45,570 --> 00:24:50,070
like in the previous section but I do

571
00:24:50,070 --> 00:24:51,450
want to mention here because it's such a

572
00:24:51,450 --> 00:24:53,460
great attack it's so common it's so easy

573
00:24:53,460 --> 00:24:57,870
to use probably maybe 30 or 40 percent

574
00:24:57,870 --> 00:24:59,340
of the time that we see somebody using

575
00:24:59,340 --> 00:25:02,600
something like VDI or something like

576
00:25:02,600 --> 00:25:04,800
jump box and we know that they're using

577
00:25:04,800 --> 00:25:06,809
something complex like in the fav we

578
00:25:06,809 --> 00:25:09,510
want to start with though the low-tech

579
00:25:09,510 --> 00:25:11,910
attack to get around those and obviously

580
00:25:11,910 --> 00:25:13,679
if if they're doing cool things like

581
00:25:13,679 --> 00:25:15,210
climbing out sessions and their users

582
00:25:15,210 --> 00:25:16,260
walking estranged then we'll move

583
00:25:16,260 --> 00:25:18,300
something more complex but like again

584
00:25:18,300 --> 00:25:20,370
that's that's less common don't see that

585
00:25:20,370 --> 00:25:26,190
very often so the next issue won't talk

586
00:25:26,190 --> 00:25:27,809
about what VDI is in secure session

587
00:25:27,809 --> 00:25:30,480
brokers so the scenario here we've

588
00:25:30,480 --> 00:25:32,220
compromised a host that you see is

589
00:25:32,220 --> 00:25:33,809
connecting this secure environment B is

590
00:25:33,809 --> 00:25:35,460
something like the horizon client which

591
00:25:35,460 --> 00:25:38,429
is VMware's VDI client one of the

592
00:25:38,429 --> 00:25:40,200
interesting setters settings that an

593
00:25:40,200 --> 00:25:42,240
attack from I observe here is the

594
00:25:42,240 --> 00:25:44,550
ability to have the client not verify

595
00:25:44,550 --> 00:25:46,860
those certificates so you won't even get

596
00:25:46,860 --> 00:25:54,690
an alert so we we know that we can't

597
00:25:54,690 --> 00:25:56,610
rely on users to stop trying potentially

598
00:25:56,610 --> 00:25:58,520
because the certificate is isn't valid

599
00:25:58,520 --> 00:26:01,559
because we see that there's something

600
00:26:01,559 --> 00:26:03,179
untrusted period you know the users

601
00:26:03,179 --> 00:26:07,190
gonna type type it in anyway so

602
00:26:07,820 --> 00:26:11,100
continuing on this exploit path we can

603
00:26:11,100 --> 00:26:13,559
go to the settings for a user and now I

604
00:26:13,559 --> 00:26:16,440
use this the settings screen from via

605
00:26:16,440 --> 00:26:18,420
from Horizon client here but these

606
00:26:18,420 --> 00:26:19,679
settings can all be done through the

607
00:26:19,679 --> 00:26:21,809
registry so you could you can do this

608
00:26:21,809 --> 00:26:23,520
potentially without you know opening up

609
00:26:23,520 --> 00:26:25,020
or more desktop session on your car

610
00:26:25,020 --> 00:26:25,890
users

611
00:26:25,890 --> 00:26:27,870
host

612
00:26:27,870 --> 00:26:30,490
so now we just have to you set ourself

613
00:26:30,490 --> 00:26:33,460
as the as the gateway now we just have

614
00:26:33,460 --> 00:26:34,720
to hack together some code to run a

615
00:26:34,720 --> 00:26:35,980
listener they capture their credentials

616
00:26:35,980 --> 00:26:38,290
so that you complete the session so when

617
00:26:38,290 --> 00:26:41,800
the user types in there you know

618
00:26:41,800 --> 00:26:43,720
normally we see that it's a username and

619
00:26:43,720 --> 00:26:46,120
then the password plus maybe their like

620
00:26:46,120 --> 00:26:48,220
their RSA token so some combination of

621
00:26:48,220 --> 00:26:48,850
those

622
00:26:48,850 --> 00:26:51,610
once they've once they type those things

623
00:26:51,610 --> 00:26:54,580
in they hit enter we will see them pop

624
00:26:54,580 --> 00:26:56,530
up on our screen that we can steal valid

625
00:26:56,530 --> 00:26:57,160
credentials

626
00:26:57,160 --> 00:26:58,990
this would include that that took in

627
00:26:58,990 --> 00:27:00,760
value then we would reuse those to

628
00:27:00,760 --> 00:27:04,420
actually execute the login I think that

629
00:27:04,420 --> 00:27:05,380
you know from a technical perspective

630
00:27:05,380 --> 00:27:07,120
the users probably just gonna say oh

631
00:27:07,120 --> 00:27:08,950
that log it didn't work or I figured

632
00:27:08,950 --> 00:27:11,620
something and though don't try again but

633
00:27:11,620 --> 00:27:13,240
that we find school already have such an

634
00:27:13,240 --> 00:27:18,220
open we'll just cancel theirs so another

635
00:27:18,220 --> 00:27:20,320
example of the the flock configuration

636
00:27:20,320 --> 00:27:21,280
here I think the highlights the

637
00:27:21,280 --> 00:27:22,830
challenge of running complex network

638
00:27:22,830 --> 00:27:25,330
environments where high availability is

639
00:27:25,330 --> 00:27:27,190
critical during the scanning portion of

640
00:27:27,190 --> 00:27:28,240
the engagement we detect that there's

641
00:27:28,240 --> 00:27:30,220
two VDI servers so again looking for

642
00:27:30,220 --> 00:27:31,510
this port so might be associated with

643
00:27:31,510 --> 00:27:35,710
with MFA but if we take a look we

644
00:27:35,710 --> 00:27:37,390
actually take a minute to log in to take

645
00:27:37,390 --> 00:27:38,860
a look at the login for each one of

646
00:27:38,860 --> 00:27:41,770
those maybe one's a failover and doesn't

647
00:27:41,770 --> 00:27:44,140
require anything so this seems like a

648
00:27:44,140 --> 00:27:46,390
really obvious flaw right but this is

649
00:27:46,390 --> 00:27:48,520
exactly the type of thing that we see on

650
00:27:48,520 --> 00:27:51,460
on pin tests that is very this is this

651
00:27:51,460 --> 00:27:52,930
is low-tech we already have credentials

652
00:27:52,930 --> 00:27:55,210
and we just need to find the right way

653
00:27:55,210 --> 00:27:57,460
to login now so is this is incredibly

654
00:27:57,460 --> 00:28:02,440
common so just like other implementation

655
00:28:02,440 --> 00:28:04,300
and discovered this solution violates

656
00:28:04,300 --> 00:28:06,610
that cleans first principle that we're

657
00:28:06,610 --> 00:28:08,020
actually sorry we'll talk about that in

658
00:28:08,020 --> 00:28:10,120
just a minute but it breaks that

659
00:28:10,120 --> 00:28:12,790
separation of boundaries in a way that

660
00:28:12,790 --> 00:28:14,500
that lets us reuse traditions

661
00:28:14,500 --> 00:28:18,490
use network connections it's probably

662
00:28:18,490 --> 00:28:20,470
worse the enforcement use of science

663
00:28:20,470 --> 00:28:23,110
certificates in it were possible evening

664
00:28:23,110 --> 00:28:24,880
on even on the internal network even

665
00:28:24,880 --> 00:28:26,440
though that I think don't like to do

666
00:28:26,440 --> 00:28:33,130
that so I hate using the word cloud but

667
00:28:33,130 --> 00:28:37,270
it kind of fit here so the last concept

668
00:28:37,270 --> 00:28:38,860
I want to touch on is organization to

669
00:28:38,860 --> 00:28:41,200
offload everything into the cloud so

670
00:28:41,200 --> 00:28:43,389
service providers are hosting things

671
00:28:43,389 --> 00:28:44,919
like single sign-on or something for

672
00:28:44,919 --> 00:28:49,090
them have you even seen you know people

673
00:28:49,090 --> 00:28:50,440
with doing things like Active Directory

674
00:28:50,440 --> 00:28:53,559
in the cloud which is great so I've been

675
00:28:53,559 --> 00:28:55,240
fortunate to have a chance to do do pen

676
00:28:55,240 --> 00:28:57,070
test or sell for smaller companies this

677
00:28:57,070 --> 00:28:59,590
year and in comparison to our standard

678
00:28:59,590 --> 00:29:02,470
large enterprise it sparked a very

679
00:29:02,470 --> 00:29:04,299
different approach in terms of pen test

680
00:29:04,299 --> 00:29:06,250
so many of the organizations are in

681
00:29:06,250 --> 00:29:08,320
small offices that have little local

682
00:29:08,320 --> 00:29:11,049
infrastructure so they're the most part

683
00:29:11,049 --> 00:29:12,220
there's just office where people are

684
00:29:12,220 --> 00:29:14,019
connected you know the Internet

685
00:29:14,019 --> 00:29:17,500
connectivity only and so they mention

686
00:29:17,500 --> 00:29:19,539
things like user accounts email and data

687
00:29:19,539 --> 00:29:23,519
alive during these third-party providers

688
00:29:23,760 --> 00:29:26,620
so one of these that I ran into recently

689
00:29:26,620 --> 00:29:29,049
was an internal pin test was just they

690
00:29:29,049 --> 00:29:30,549
had they were using a a single sign-on

691
00:29:30,549 --> 00:29:32,679
application that could tie together all

692
00:29:32,679 --> 00:29:34,539
the other service providers into sort of

693
00:29:34,539 --> 00:29:36,880
one dashboard for them and I think that

694
00:29:36,880 --> 00:29:39,370
yeah I should see it here I believe this

695
00:29:39,370 --> 00:29:42,850
one's actually called one login so this

696
00:29:42,850 --> 00:29:44,620
is really handy for users and makes

697
00:29:44,620 --> 00:29:45,940
their life here for they log in once and

698
00:29:45,940 --> 00:29:47,289
have access to everything this is also

699
00:29:47,289 --> 00:29:49,419
handy in terms of the for the

700
00:29:49,419 --> 00:29:53,080
penetration tester so in this sort of

701
00:29:53,080 --> 00:29:54,789
exploit scenario maybe we do some

702
00:29:54,789 --> 00:29:56,590
intelligence gathering collect email

703
00:29:56,590 --> 00:29:58,360
addresses figure out who the email

704
00:29:58,360 --> 00:30:01,029
provider is on this you know there's

705
00:30:01,029 --> 00:30:02,380
much really easy way to do this but

706
00:30:02,380 --> 00:30:03,850
might be as simple as just looking at

707
00:30:03,850 --> 00:30:06,130
the email headers one handy tip here I

708
00:30:06,130 --> 00:30:08,529
noticed that at the Gmail login page is

709
00:30:08,529 --> 00:30:09,909
a great place for checking about email

710
00:30:09,909 --> 00:30:12,010
addresses so as long as you're

711
00:30:12,010 --> 00:30:14,289
throttling your request rate you can

712
00:30:14,289 --> 00:30:15,370
just submit that and we'll give you

713
00:30:15,370 --> 00:30:17,230
thought you have emails ballots if you

714
00:30:17,230 --> 00:30:19,809
have like 300 potential names or or

715
00:30:19,809 --> 00:30:21,880
names you've compiled a few potential

716
00:30:21,880 --> 00:30:23,889
users you can turn that into a great

717
00:30:23,889 --> 00:30:28,720
list of actual email addresses so we we

718
00:30:28,720 --> 00:30:30,610
enumerate some some list of email

719
00:30:30,610 --> 00:30:33,010
addresses now we just run it password

720
00:30:33,010 --> 00:30:35,169
again see passing you guess that that

721
00:30:35,169 --> 00:30:38,289
single sign-on application page this is

722
00:30:38,289 --> 00:30:40,179
all very simple and because it's exposed

723
00:30:40,179 --> 00:30:41,440
to the Internet you do it from anywhere

724
00:30:41,440 --> 00:30:45,460
and typically they are less restrictive

725
00:30:45,460 --> 00:30:47,830
about how often you know lockouts or

726
00:30:47,830 --> 00:30:50,350
less strict it's about how many guest

727
00:30:50,350 --> 00:30:54,279
templates you can run once you find a

728
00:30:54,279 --> 00:30:55,090
valid login

729
00:30:55,090 --> 00:30:57,760
just by looking at those responses in

730
00:30:57,760 --> 00:30:59,680
something like first week we get access

731
00:30:59,680 --> 00:31:03,490
to applications and this is in in this

732
00:31:03,490 --> 00:31:07,960
scenario the the sort of lab movement

733
00:31:07,960 --> 00:31:08,950
piece is a little bit different than

734
00:31:08,950 --> 00:31:10,840
your typical pin test it becomes an

735
00:31:10,840 --> 00:31:13,150
information gathering challenge up if

736
00:31:13,150 --> 00:31:16,780
you have lots of applications github is

737
00:31:16,780 --> 00:31:19,870
obviously a great one if lots of data in

738
00:31:19,870 --> 00:31:22,120
mount and in this actual scenario that

739
00:31:22,120 --> 00:31:24,160
the first time I did this I poked around

740
00:31:24,160 --> 00:31:29,230
a code repo and found AWS API keys and

741
00:31:29,230 --> 00:31:30,610
that's fantastic because as you know

742
00:31:30,610 --> 00:31:32,080
maybe that's might puts all kinds of

743
00:31:32,080 --> 00:31:34,330
interesting data with API key do things

744
00:31:34,330 --> 00:31:38,260
like download a copy of ec2 instances

745
00:31:38,260 --> 00:31:40,390
and if there's data on there that wants

746
00:31:40,390 --> 00:31:41,680
their production network then that could

747
00:31:41,680 --> 00:31:44,310
be a goldmine

748
00:31:44,760 --> 00:31:48,910
so takeaway here the bounce you come

749
00:31:48,910 --> 00:31:50,770
very fuzzy and hard to define in this

750
00:31:50,770 --> 00:31:52,210
sort of cloud environment if you're

751
00:31:52,210 --> 00:31:54,070
relying on on these services to make

752
00:31:54,070 --> 00:31:56,440
sure your make sure you apply the same

753
00:31:56,440 --> 00:31:58,150
rigor separating zones you would on the

754
00:31:58,150 --> 00:31:59,710
more traditional enterprise network and

755
00:31:59,710 --> 00:32:02,380
should be very aware of where that

756
00:32:02,380 --> 00:32:05,290
authentication boundary is managing

757
00:32:05,290 --> 00:32:08,500
those identities sugar if it's exposed

758
00:32:08,500 --> 00:32:12,400
to the Internet all right so the last

759
00:32:12,400 --> 00:32:13,750
piece on this one touch on a couple of

760
00:32:13,750 --> 00:32:16,060
secure design concepts and things that I

761
00:32:16,060 --> 00:32:17,710
see that people do particularly well

762
00:32:17,710 --> 00:32:19,600
make it hard to get around some of these

763
00:32:19,600 --> 00:32:22,870
these solutions so the first is the

764
00:32:22,870 --> 00:32:24,070
clean source principle which I've

765
00:32:24,070 --> 00:32:26,230
mentioned a second ago

766
00:32:26,230 --> 00:32:27,640
I'll leave the long sort of longer

767
00:32:27,640 --> 00:32:29,680
winded technical definition to Microsoft

768
00:32:29,680 --> 00:32:32,110
you say Google it's really interesting

769
00:32:32,110 --> 00:32:34,750
reading but the shorter version is if an

770
00:32:34,750 --> 00:32:36,910
adversary can control anything effective

771
00:32:36,910 --> 00:32:38,230
control of the parking object they

772
00:32:38,230 --> 00:32:40,480
control of that target object because of

773
00:32:40,480 --> 00:32:42,280
this you must ensure that all assurances

774
00:32:42,280 --> 00:32:44,020
for all stringy dependencies or adder

775
00:32:44,020 --> 00:32:45,910
above the desired circle the object

776
00:32:45,910 --> 00:32:48,490
itself may be the sort of watered down

777
00:32:48,490 --> 00:32:50,620
version would be if an attacker control

778
00:32:50,620 --> 00:32:52,750
and operating system has numerous ways

779
00:32:52,750 --> 00:32:54,400
to listen again access to all the

780
00:32:54,400 --> 00:32:56,110
activity on that workstation impersonate

781
00:32:56,110 --> 00:32:58,540
a legitimate account so then they can

782
00:32:58,540 --> 00:33:00,370
abused that workstation to get to

783
00:33:00,370 --> 00:33:05,320
anything that that workstation get to I

784
00:33:05,320 --> 00:33:07,480
think this is this is pretty simple and

785
00:33:07,480 --> 00:33:08,530
in principle but if

786
00:33:08,530 --> 00:33:10,300
this requires understanding control

787
00:33:10,300 --> 00:33:12,670
relationships of an asset which would

788
00:33:12,670 --> 00:33:14,190
gets pretty tricky when talking about

789
00:33:14,190 --> 00:33:16,960
some of the attractions that live in

790
00:33:16,960 --> 00:33:22,200
something like Active Directory so the

791
00:33:22,200 --> 00:33:24,250
the moderate that environment requires

792
00:33:24,250 --> 00:33:26,200
organization to adopt a and assume

793
00:33:26,200 --> 00:33:29,110
breach security posture when signing

794
00:33:29,110 --> 00:33:31,360
protections for high value assets so in

795
00:33:31,360 --> 00:33:32,740
other words we approach the system

796
00:33:32,740 --> 00:33:34,360
security from the perspective that we've

797
00:33:34,360 --> 00:33:35,710
already been compromised just haven't

798
00:33:35,710 --> 00:33:37,900
discovered that compromise yet you

799
00:33:37,900 --> 00:33:38,950
always want to consider the

800
00:33:38,950 --> 00:33:40,510
ramifications of compromises from the

801
00:33:40,510 --> 00:33:42,040
perspective of those privileged users

802
00:33:42,040 --> 00:33:44,290
and workstations so if you've logged in

803
00:33:44,290 --> 00:33:45,910
to a user's workstation with domain

804
00:33:45,910 --> 00:33:47,920
admin creds then an attacker comes

805
00:33:47,920 --> 00:33:50,020
behind you compromise that system you've

806
00:33:50,020 --> 00:33:51,760
traded potential for the credentials to

807
00:33:51,760 --> 00:33:55,090
be stolen or reused so the question you

808
00:33:55,090 --> 00:33:56,620
have to ask is can those drenches be

809
00:33:56,620 --> 00:33:57,730
used to gain access to your

810
00:33:57,730 --> 00:34:00,310
high-security zones or your restricted

811
00:34:00,310 --> 00:34:05,470
assets your ex's workstation and pause

812
00:34:05,470 --> 00:34:07,840
is the model that Microsoft uses again

813
00:34:07,840 --> 00:34:09,129
if you want to google that it's really

814
00:34:09,129 --> 00:34:12,399
great reading I love this model consider

815
00:34:12,399 --> 00:34:14,590
any system that haxon access high-value

816
00:34:14,590 --> 00:34:16,780
assets as a special class system so that

817
00:34:16,780 --> 00:34:18,790
you can avoid cross contaminating access

818
00:34:18,790 --> 00:34:20,980
privileges twin zones a couple ways to

819
00:34:20,980 --> 00:34:23,230
go about this maybe provide a high

820
00:34:23,230 --> 00:34:24,699
security workstation to your privileged

821
00:34:24,699 --> 00:34:27,280
users so a sip it literally a second

822
00:34:27,280 --> 00:34:28,719
computer that they would access those

823
00:34:28,719 --> 00:34:31,870
those systems from or perhaps you

824
00:34:31,870 --> 00:34:33,940
leverage virtualization so to accomplish

825
00:34:33,940 --> 00:34:37,360
this so if you're usually in

826
00:34:37,360 --> 00:34:39,040
virtualization it's critical that we're

827
00:34:39,040 --> 00:34:41,050
never logging into the lower security

828
00:34:41,050 --> 00:34:42,790
system to access our higher security

829
00:34:42,790 --> 00:34:44,500
system because that's when we violate

830
00:34:44,500 --> 00:34:50,770
that that means for us this is a big one

831
00:34:50,770 --> 00:34:53,050
for me just as a pen tester I see that

832
00:34:53,050 --> 00:34:55,570
admin creds were refused or employed in

833
00:34:55,570 --> 00:34:57,490
a way to make them easy to gain access

834
00:34:57,490 --> 00:35:01,060
to so the security of most are all

835
00:35:01,060 --> 00:35:02,500
business assets in an organization

836
00:35:02,500 --> 00:35:04,660
depend on the integrity of the

837
00:35:04,660 --> 00:35:06,340
privileged accounts that administer a

838
00:35:06,340 --> 00:35:09,430
managed IT systems so securing

839
00:35:09,430 --> 00:35:11,440
privileged access is a critical step in

840
00:35:11,440 --> 00:35:13,890
establishing a security assurances

841
00:35:13,890 --> 00:35:16,180
basically lots of admin credentials and

842
00:35:16,180 --> 00:35:18,040
admin credential use means lots of

843
00:35:18,040 --> 00:35:19,450
chances for attacker to capture those

844
00:35:19,450 --> 00:35:21,410
privileged accounts

845
00:35:21,410 --> 00:35:23,000
so a couple of things to consider there

846
00:35:23,000 --> 00:35:25,490
nowhere and you're in this a pivotal

847
00:35:25,490 --> 00:35:27,620
game used and that the teams were

848
00:35:27,620 --> 00:35:29,870
fencing both cross contaminate a limit

849
00:35:29,870 --> 00:35:31,990
roll privilege to the minimum required

850
00:35:31,990 --> 00:35:34,100
limit the number of hosts on which

851
00:35:34,100 --> 00:35:35,810
administrative credentials are exposed

852
00:35:35,810 --> 00:35:38,060
and assured that mr. tasks are not

853
00:35:38,060 --> 00:35:39,980
performing hosts used for standard

854
00:35:39,980 --> 00:35:45,710
activities like like web browsing poking

855
00:35:45,710 --> 00:35:47,990
holes to your high by assets one

856
00:35:47,990 --> 00:35:49,640
critical thing to consider is any design

857
00:35:49,640 --> 00:35:52,160
plexy of management so juggling demands

858
00:35:52,160 --> 00:35:54,920
of environments can be a pretty massive

859
00:35:54,920 --> 00:35:57,530
challenge many pitfalls that I find

860
00:35:57,530 --> 00:36:00,110
during a pen test tie back to this one

861
00:36:00,110 --> 00:36:01,670
changed I made this for this one guy

862
00:36:01,670 --> 00:36:03,440
named Henry marketing at one time and

863
00:36:03,440 --> 00:36:06,230
then we never put back those exceptions

864
00:36:06,230 --> 00:36:07,910
can add up and bad guys are very good at

865
00:36:07,910 --> 00:36:09,500
finding that's it it's almost like the

866
00:36:09,500 --> 00:36:12,680
definition of my day-to-day job is is

867
00:36:12,680 --> 00:36:17,090
finding those exceptions one approach I

868
00:36:17,090 --> 00:36:19,940
think to this this challenge is using

869
00:36:19,940 --> 00:36:22,280
something like concepts that are being

870
00:36:22,280 --> 00:36:24,320
developed and DevOps right now to manage

871
00:36:24,320 --> 00:36:26,540
changes so create strictly defined

872
00:36:26,540 --> 00:36:28,340
programmatic methods for managing system

873
00:36:28,340 --> 00:36:29,960
and service configurations to ensure

874
00:36:29,960 --> 00:36:33,260
that even if something gets changed to

875
00:36:33,260 --> 00:36:35,360
some insecure state that there's some

876
00:36:35,360 --> 00:36:37,430
automated way thing that that control

877
00:36:37,430 --> 00:36:38,930
that put it back into them the more

878
00:36:38,930 --> 00:36:44,630
secure state okay so kind of does a

879
00:36:44,630 --> 00:36:47,360
little bit of a wrap-up my goals are to

880
00:36:47,360 --> 00:36:50,180
present a strong texture from the bad

881
00:36:50,180 --> 00:36:51,920
guy perspective and give a little bit of

882
00:36:51,920 --> 00:36:53,570
insight that I seen that I've gained

883
00:36:53,570 --> 00:36:57,310
through lots of big enterprise pin tests

884
00:36:57,310 --> 00:37:00,200
for you know problems that we see and we

885
00:37:00,200 --> 00:37:04,550
but that bypass load rolling I again

886
00:37:04,550 --> 00:37:05,570
just kind of addressing some of the

887
00:37:05,570 --> 00:37:07,910
shortcomings here the rowdy of any

888
00:37:07,910 --> 00:37:10,070
implementation is very complex I think

889
00:37:10,070 --> 00:37:11,930
you could write probably a whole book

890
00:37:11,930 --> 00:37:13,700
about some of these top some of these

891
00:37:13,700 --> 00:37:16,550
these topics and that would be probably

892
00:37:16,550 --> 00:37:18,950
good books I had to water these down for

893
00:37:18,950 --> 00:37:20,780
these purposes but hopefully I still

894
00:37:20,780 --> 00:37:22,010
gave you that that sort of attacker

895
00:37:22,010 --> 00:37:24,620
perspective on bypassing these these

896
00:37:24,620 --> 00:37:29,170
solutions cool so my favorite part about

897
00:37:29,170 --> 00:37:31,400
going to the conference and giving talks

898
00:37:31,400 --> 00:37:33,980
is people that I tend to meet after I do

899
00:37:33,980 --> 00:37:35,220
presentation

900
00:37:35,220 --> 00:37:36,240
I get to learn lots of new things

901
00:37:36,240 --> 00:37:37,260
because everybody has their own

902
00:37:37,260 --> 00:37:39,000
perspective so you guys are probably all

903
00:37:39,000 --> 00:37:42,690
seen these solutions in place in ways

904
00:37:42,690 --> 00:37:43,920
that I haven't or have interesting

905
00:37:43,920 --> 00:37:46,590
perspectives on them and I take that and

906
00:37:46,590 --> 00:37:50,880
use it and in my work and I please come

907
00:37:50,880 --> 00:37:52,980
talk to me afterwards or ask question or

908
00:37:52,980 --> 00:37:56,369
whatever and and please feel free to add

909
00:37:56,369 --> 00:37:57,660
me on on Twitter or send me a message

910
00:37:57,660 --> 00:38:01,549
always like to have discussions

