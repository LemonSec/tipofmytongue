1
00:01:31,180 --> 00:01:37,490
all right baby you got quits messing

2
00:01:33,890 --> 00:01:41,570
with me are we recording awesome all

3
00:01:37,490 --> 00:01:43,460
right yay thanks for the one guy who

4
00:01:41,570 --> 00:01:46,158
potted in the room for getting the a/v

5
00:01:43,460 --> 00:01:48,410
fixed so again now that we have AV going

6
00:01:46,159 --> 00:01:51,670
my name is Matt Scheer

7
00:01:48,410 --> 00:01:55,220
you may follow me on twitter c3 arc aah

8
00:01:51,670 --> 00:01:58,540
or on LinkedIn and also the slide deck

9
00:01:55,220 --> 00:02:01,640
is available so check it out if you want

10
00:01:58,540 --> 00:02:03,800
today's talk is called lend me your irs

11
00:02:01,640 --> 00:02:06,289
so I'm gonna have to kind of go in fast

12
00:02:03,800 --> 00:02:08,570
mode here since we lost some time but

13
00:02:06,289 --> 00:02:11,330
I'm a senior system security engineer at

14
00:02:08,570 --> 00:02:14,420
First Financial Bank in Cincinnati Ohio

15
00:02:11,330 --> 00:02:16,250
I run the simple security sig if you're

16
00:02:14,420 --> 00:02:20,149
ever around Cincinnati third Thursday of

17
00:02:16,250 --> 00:02:23,540
any month we meet in have awesome sort

18
00:02:20,150 --> 00:02:24,620
of visa it's quality meetings and I'm

19
00:02:23,540 --> 00:02:27,890
also a bugcrowd

20
00:02:24,620 --> 00:02:29,480
ambassador and security researcher so

21
00:02:27,890 --> 00:02:31,458
today's objectives are we're going to

22
00:02:29,480 --> 00:02:33,829
show live demo reenactments of real

23
00:02:31,459 --> 00:02:35,989
attacks and it's gonna be on how these

24
00:02:33,830 --> 00:02:39,019
real-world attacks worked how and why

25
00:02:35,989 --> 00:02:39,830
they defeated security solutions and

26
00:02:39,019 --> 00:02:41,810
then we're going to show if the

27
00:02:39,830 --> 00:02:44,209
responses to these attacks demoing the

28
00:02:41,810 --> 00:02:46,070
investigation tools and techniques as

29
00:02:44,209 --> 00:02:48,950
well as discuss lessons learned and key

30
00:02:46,070 --> 00:02:51,230
takeaways so we're all on the same page

31
00:02:48,950 --> 00:02:53,570
to start it off with the acronyms I'm

32
00:02:51,230 --> 00:02:56,060
gonna use and throw about here or IOC

33
00:02:53,570 --> 00:02:59,030
which is indicator of compromise IR

34
00:02:56,060 --> 00:03:00,829
which is Incident Response and D F IR

35
00:02:59,030 --> 00:03:03,019
which is digital forensics and Incident

36
00:03:00,829 --> 00:03:05,630
Response so you may hear these bandied

37
00:03:03,019 --> 00:03:07,820
about throughout today's talk so some

38
00:03:05,630 --> 00:03:11,480
quick disclaimers here that the demos

39
00:03:07,820 --> 00:03:13,459
are all based on 100% true stories they

40
00:03:11,480 --> 00:03:15,530
dutifully recreate actual attacks

41
00:03:13,459 --> 00:03:18,739
however I've altered a lot of the

42
00:03:15,530 --> 00:03:20,660
details so the investigation demos are

43
00:03:18,739 --> 00:03:24,470
sped up considerably in the interest of

44
00:03:20,660 --> 00:03:28,100
time and also when you do these

45
00:03:24,470 --> 00:03:31,070
techniques only do so on a dedicated

46
00:03:28,100 --> 00:03:32,780
securely isolated in volatile sandbox

47
00:03:31,070 --> 00:03:35,329
and if you're like me if you have a

48
00:03:32,780 --> 00:03:38,570
commercial sandbox use that if you don't

49
00:03:35,329 --> 00:03:40,669
have that then use something like sift

50
00:03:38,570 --> 00:03:43,040
or REM knucks or build out your own

51
00:03:40,669 --> 00:03:44,440
whatever you want to do there I'm just

52
00:03:43,040 --> 00:03:46,900
here to give you an informative info

53
00:03:44,440 --> 00:03:48,480
SEC Talk I'm not your parent and I'm not

54
00:03:46,900 --> 00:03:50,890
here to tell you how to live your life

55
00:03:48,480 --> 00:03:53,619
so with that let's go ahead and pick it

56
00:03:50,890 --> 00:03:55,440
off I don't know how many speakers here

57
00:03:53,620 --> 00:03:59,110
at hacker Con are doing live demos

58
00:03:55,440 --> 00:04:07,120
however I am one doing them and it's

59
00:03:59,110 --> 00:04:09,300
either because I'm bold fearless or

60
00:04:07,120 --> 00:04:15,299
crazy

61
00:04:09,300 --> 00:04:18,040
please pick two so I'm not just crazy

62
00:04:15,299 --> 00:04:21,730
all right so my first scenario is called

63
00:04:18,040 --> 00:04:24,580
the mystery attachment so going back to

64
00:04:21,730 --> 00:04:27,940
a news headline on August 17th of 2018

65
00:04:24,580 --> 00:04:31,270
mouth spam campaigns target banks using

66
00:04:27,940 --> 00:04:32,950
Microsoft Publisher the flawed Amy rat

67
00:04:31,270 --> 00:04:35,440
was part of the nickers botnet is

68
00:04:32,950 --> 00:04:36,849
reported by researchers at Trustwave and

69
00:04:35,440 --> 00:04:38,320
if you get the slide deck here's the

70
00:04:36,850 --> 00:04:42,100
link to the article down at the bottom

71
00:04:38,320 --> 00:04:44,740
got reported numerous places but best I

72
00:04:42,100 --> 00:04:48,370
could tell they were the ones who put it

73
00:04:44,740 --> 00:04:50,470
out first so to set the table

74
00:04:48,370 --> 00:04:52,630
one day I'm diligently working my desk

75
00:04:50,470 --> 00:04:55,150
probably on like half a dozen things at

76
00:04:52,630 --> 00:04:56,830
one time and all of a sudden in the

77
00:04:55,150 --> 00:05:00,429
midst of my working on whatever I was

78
00:04:56,830 --> 00:05:04,960
working on have a important person

79
00:05:00,430 --> 00:05:07,570
running up to my desk and say Matt help

80
00:05:04,960 --> 00:05:09,549
one of our VIPs with access to lots of

81
00:05:07,570 --> 00:05:11,680
sensitive information just got hit in

82
00:05:09,550 --> 00:05:12,910
that recent mouth spam campaign

83
00:05:11,680 --> 00:05:15,010
targeting banks

84
00:05:12,910 --> 00:05:17,320
it matches I OCS from reports of that

85
00:05:15,010 --> 00:05:20,230
new flawed Amy rat which is part of the

86
00:05:17,320 --> 00:05:22,240
Dicker's botnet the recipient attempted

87
00:05:20,230 --> 00:05:24,730
to open the MS publisher attachment on

88
00:05:22,240 --> 00:05:26,440
their smartphone I need you to drop

89
00:05:24,730 --> 00:05:28,510
whatever you were doing and investigate

90
00:05:26,440 --> 00:05:31,000
this will get the attachment to you as

91
00:05:28,510 --> 00:05:33,990
soon as possible now I am NOT a mobile

92
00:05:31,000 --> 00:05:37,419
forensics expert we don't necessarily

93
00:05:33,990 --> 00:05:40,570
maybe have great tools for that but I'm

94
00:05:37,419 --> 00:05:42,700
the closest person we have and that can

95
00:05:40,570 --> 00:05:45,880
look at it so all right we'll take a

96
00:05:42,700 --> 00:05:48,580
look see if we can figure out here so I

97
00:05:45,880 --> 00:05:51,490
get the attachment and we'll go ahead

98
00:05:48,580 --> 00:05:54,310
and open it now when I'm demoing stuff

99
00:05:51,490 --> 00:05:56,770
here we have to pretend that I'm using a

100
00:05:54,310 --> 00:05:58,240
sandbox these are live demos I've built

101
00:05:56,770 --> 00:05:59,830
a custom environment here

102
00:05:58,240 --> 00:06:02,110
and in the interest of time I don't have

103
00:05:59,830 --> 00:06:04,060
time to fire up a proper sandbox so when

104
00:06:02,110 --> 00:06:07,389
you see me doing this stuff in the talk

105
00:06:04,060 --> 00:06:10,840
just imagine if you will that I'm doing

106
00:06:07,389 --> 00:06:11,860
this in a sandbox like in real life so

107
00:06:10,840 --> 00:06:16,258
I'm going to go ahead and open it up

108
00:06:11,860 --> 00:06:18,849
here and let me see if I can get the

109
00:06:16,259 --> 00:06:23,229
optimal width so it's not such an eye

110
00:06:18,849 --> 00:06:26,020
chart so open up this publisher file in

111
00:06:23,229 --> 00:06:28,000
the sandbox and I see this text that the

112
00:06:26,020 --> 00:06:30,669
macro is basically have to be enabled to

113
00:06:28,000 --> 00:06:33,009
display the contents click the enable

114
00:06:30,669 --> 00:06:35,109
content button what was really

115
00:06:33,009 --> 00:06:37,780
interesting is I couldn't actually get

116
00:06:35,110 --> 00:06:39,610
that to pop up and execute the macker I

117
00:06:37,780 --> 00:06:41,710
couldn't get the prompt to make it

118
00:06:39,610 --> 00:06:43,660
happen and I thought well this is odd

119
00:06:41,710 --> 00:06:45,549
because clearly that's how this thing

120
00:06:43,660 --> 00:06:47,800
would appear to be staged I've seen this

121
00:06:45,550 --> 00:06:49,750
type of thing before chances are a lot

122
00:06:47,800 --> 00:06:51,270
of people through m-- have seen this

123
00:06:49,750 --> 00:06:53,800
kind of thing before

124
00:06:51,270 --> 00:06:56,830
so anyway I'm dedicating at the sandbox

125
00:06:53,800 --> 00:06:58,590
to get the analysis on it and when I get

126
00:06:56,830 --> 00:07:00,520
the detailed analysis report on it

127
00:06:58,590 --> 00:07:03,310
didn't really necessarily look

128
00:07:00,520 --> 00:07:05,289
particularly bad I couldn't really find

129
00:07:03,310 --> 00:07:07,990
any signs of here's something malicious

130
00:07:05,289 --> 00:07:11,440
so I'm thinking well that's definitely

131
00:07:07,990 --> 00:07:15,159
odd but let's try to understand you know

132
00:07:11,440 --> 00:07:17,320
sort of what's happening with it so I'm

133
00:07:15,159 --> 00:07:21,789
going to go ahead and switch back into

134
00:07:17,320 --> 00:07:23,349
my folder and I will maximize this and

135
00:07:21,789 --> 00:07:28,360
blow it up so everybody can see it

136
00:07:23,349 --> 00:07:31,840
better so there's my publisher file

137
00:07:28,360 --> 00:07:34,139
hopefully folks can see that okay I can

138
00:07:31,840 --> 00:07:36,280
maybe expand it just a little bit more

139
00:07:34,139 --> 00:07:38,860
so what I want to do is run through

140
00:07:36,280 --> 00:07:41,619
strings just as hoop helps my tab

141
00:07:38,860 --> 00:07:49,139
complete that so one news run this thing

142
00:07:41,620 --> 00:07:49,139
through strings oh you know what

143
00:07:50,910 --> 00:07:56,960
I'm gonna pipe it out to less now I

144
00:07:52,980 --> 00:08:00,180
could basically direct this output to a

145
00:07:56,960 --> 00:08:01,560
text file and open open an editor of my

146
00:08:00,180 --> 00:08:04,650
choosing

147
00:08:01,560 --> 00:08:07,470
I or if I don't redirect it to a file I

148
00:08:04,650 --> 00:08:09,810
can basically pipe it out to less and

149
00:08:07,470 --> 00:08:11,550
just kind of scroll through it here and

150
00:08:09,810 --> 00:08:13,380
see if there's anything that stands out

151
00:08:11,550 --> 00:08:15,660
you know maybe some sort of an artifact

152
00:08:13,380 --> 00:08:17,370
left in there in plain text or maybe

153
00:08:15,660 --> 00:08:19,830
some sort of a character string I can

154
00:08:17,370 --> 00:08:22,470
basically search on I'd figure out who's

155
00:08:19,830 --> 00:08:24,780
done this I don't I didn't find anything

156
00:08:22,470 --> 00:08:28,410
crazy in here nothing told me like hey

157
00:08:24,780 --> 00:08:36,419
this is necessarily awful so good and

158
00:08:28,410 --> 00:08:38,010
quit out of there so cuz I'm looking at

159
00:08:36,419 --> 00:08:40,978
that I'm thinking well let's go ahead

160
00:08:38,010 --> 00:08:43,169
and get a hash of this file since I'm

161
00:08:40,979 --> 00:08:45,450
not understanding at this point exactly

162
00:08:43,169 --> 00:08:49,470
what it's doing so I'm gonna go ahead

163
00:08:45,450 --> 00:08:52,470
and so I type in there in communion shot

164
00:08:49,470 --> 00:08:59,130
tivity physics um and the file name in

165
00:08:52,470 --> 00:09:03,960
here I have the hash for the file so

166
00:08:59,130 --> 00:09:07,040
anybody sees that think alright let's go

167
00:09:03,960 --> 00:09:12,270
ahead and do some searching on this

168
00:09:07,040 --> 00:09:16,349
click the wrong thing there so I know

169
00:09:12,270 --> 00:09:18,300
that you're not gonna see the URL but

170
00:09:16,350 --> 00:09:20,340
there's the hash value the same one we

171
00:09:18,300 --> 00:09:24,410
were just looking at this is virustotal

172
00:09:20,340 --> 00:09:26,640
which has about 70 some-odd AV scanners

173
00:09:24,410 --> 00:09:28,800
nothing has seen this particular file

174
00:09:26,640 --> 00:09:30,120
which I found interesting because

175
00:09:28,800 --> 00:09:33,870
usually that's kind of attachment

176
00:09:30,120 --> 00:09:35,640
that'll get repurposed it could be you

177
00:09:33,870 --> 00:09:37,680
know customized the new variant of it

178
00:09:35,640 --> 00:09:39,270
something like that but I really thought

179
00:09:37,680 --> 00:09:41,040
you know had a good chance of finding a

180
00:09:39,270 --> 00:09:47,310
result so here you can see a little

181
00:09:41,040 --> 00:09:49,319
better with an insight here you see a

182
00:09:47,310 --> 00:09:51,359
little better with the hash value but

183
00:09:49,320 --> 00:09:55,560
you can also see nothing again was found

184
00:09:51,360 --> 00:09:58,080
so the question is you know what else

185
00:09:55,560 --> 00:10:00,000
let's take a look on hybrid analysis a

186
00:09:58,080 --> 00:10:02,610
lot of people submit to their to see if

187
00:10:00,000 --> 00:10:04,770
they can find stuff again no results

188
00:10:02,610 --> 00:10:06,780
found

189
00:10:04,770 --> 00:10:09,240
you can see here see it Rolo but

190
00:10:06,780 --> 00:10:13,079
basically the hash value and the URL up

191
00:10:09,240 --> 00:10:15,870
above says last resort let's just search

192
00:10:13,080 --> 00:10:17,820
for it on Google and again absolutely no

193
00:10:15,870 --> 00:10:19,650
results at this point I'm not really

194
00:10:17,820 --> 00:10:21,600
sure what I have I can't really

195
00:10:19,650 --> 00:10:23,880
understand what it's doing it's

196
00:10:21,600 --> 00:10:25,800
basically defeating every security

197
00:10:23,880 --> 00:10:29,040
scanner app that I'm throwing at it and

198
00:10:25,800 --> 00:10:30,990
I found nothing in strings never seen

199
00:10:29,040 --> 00:10:32,430
the hash anywhere and I'm really

200
00:10:30,990 --> 00:10:35,370
contemplating like you know what's my

201
00:10:32,430 --> 00:10:40,229
next step now on this mobile device

202
00:10:35,370 --> 00:10:43,650
and I'm just thinking well you know do

203
00:10:40,230 --> 00:10:45,990
we say well chances a publisher file is

204
00:10:43,650 --> 00:10:49,680
going to do something super malicious on

205
00:10:45,990 --> 00:10:52,020
a an iPhone for example is unlikely and

206
00:10:49,680 --> 00:10:54,180
I think it's an acceptable risk it seems

207
00:10:52,020 --> 00:10:57,540
like a really bad idea so I kind of

208
00:10:54,180 --> 00:10:59,520
instantly set that one aside and then I

209
00:10:57,540 --> 00:11:02,280
think well what if we did a security

210
00:10:59,520 --> 00:11:03,720
wipe with a mobile device and then gave

211
00:11:02,280 --> 00:11:07,589
it back to the user would that be

212
00:11:03,720 --> 00:11:09,240
adequate enough to safely say risk is

213
00:11:07,590 --> 00:11:11,730
pretty low that something happened here

214
00:11:09,240 --> 00:11:13,830
but again thinking who this is then the

215
00:11:11,730 --> 00:11:15,300
type of information they could have it

216
00:11:13,830 --> 00:11:17,220
doesn't seem like a good idea now they

217
00:11:15,300 --> 00:11:19,380
weren't ready for a refresh quite yet

218
00:11:17,220 --> 00:11:21,420
but they were pretty close to it so I'm

219
00:11:19,380 --> 00:11:23,990
thinking well perhaps what we want to do

220
00:11:21,420 --> 00:11:26,640
here is actually comedy or the device

221
00:11:23,990 --> 00:11:29,760
shut it down throw it in the forensics

222
00:11:26,640 --> 00:11:32,340
lab and essentially order them an

223
00:11:29,760 --> 00:11:34,790
updated model and go ahead and replenish

224
00:11:32,340 --> 00:11:36,960
that user with a new device anyway

225
00:11:34,790 --> 00:11:39,360
thinking through all these thoughts in

226
00:11:36,960 --> 00:11:42,060
my head I thought well this is kind of

227
00:11:39,360 --> 00:11:43,980
lame but you know I didn't actually look

228
00:11:42,060 --> 00:11:45,719
at the exit data and it windows it's

229
00:11:43,980 --> 00:11:47,460
pretty simple you right-click on the

230
00:11:45,720 --> 00:11:50,010
file you go into the properties and you

231
00:11:47,460 --> 00:11:52,140
look on the details tab and you look for

232
00:11:50,010 --> 00:11:54,330
you know things like author or other

233
00:11:52,140 --> 00:11:56,189
hints you always have to take that stuff

234
00:11:54,330 --> 00:12:00,870
with a grain of salt but it's pretty

235
00:11:56,190 --> 00:12:05,070
easy to do in Linux if I use the Pearl

236
00:12:00,870 --> 00:12:08,730
exit tool I can take a look at that so

237
00:12:05,070 --> 00:12:10,400
go ahead and pull up the file here and

238
00:12:08,730 --> 00:12:12,780
[Music]

239
00:12:10,400 --> 00:12:14,850
as I'm looking at it

240
00:12:12,780 --> 00:12:17,310
all of these things that seem like a

241
00:12:14,850 --> 00:12:17,950
little weird on the on the file type and

242
00:12:17,310 --> 00:12:21,489
the

243
00:12:17,950 --> 00:12:24,880
and the mimetype all that matches

244
00:12:21,490 --> 00:12:26,500
Microsoft Publisher to a tee so it's

245
00:12:24,880 --> 00:12:28,360
definitely a genuine publisher file no

246
00:12:26,500 --> 00:12:31,210
doubt about that now the author didn't

247
00:12:28,360 --> 00:12:34,630
say test fish but I will give you an

248
00:12:31,210 --> 00:12:37,090
idea what it did actually show me let me

249
00:12:34,630 --> 00:12:40,390
go ahead and pull up the next slide what

250
00:12:37,090 --> 00:12:42,100
it was was a facepalm moment because it

251
00:12:40,390 --> 00:12:47,350
was our test fishing vendor was the

252
00:12:42,100 --> 00:12:48,790
author now I spent hours looking into

253
00:12:47,350 --> 00:12:51,040
this trying to understand what it did

254
00:12:48,790 --> 00:12:54,010
online research I mean you name it I was

255
00:12:51,040 --> 00:12:56,589
looking at details around you know the

256
00:12:54,010 --> 00:12:58,930
bad Amy fall looking for i/o sees that I

257
00:12:56,590 --> 00:13:00,940
could you sort of look at what traits

258
00:12:58,930 --> 00:13:02,199
characteristics you know it's

259
00:13:00,940 --> 00:13:03,910
contemplating doing some memory

260
00:13:02,200 --> 00:13:05,680
forensics on it even though it's not my

261
00:13:03,910 --> 00:13:09,480
bread-and-butter I dabbled in it a

262
00:13:05,680 --> 00:13:11,560
little bit so I spent all that time but

263
00:13:09,480 --> 00:13:13,600
not taking that as a grain of salt

264
00:13:11,560 --> 00:13:17,709
because obviously the EXIF data could be

265
00:13:13,600 --> 00:13:20,680
spoofed I went to the mail server and I

266
00:13:17,710 --> 00:13:24,940
looked at the headers and sure enough it

267
00:13:20,680 --> 00:13:27,849
came from the mail server at our fishing

268
00:13:24,940 --> 00:13:30,220
vendor test fishing vendor what I saw

269
00:13:27,850 --> 00:13:32,710
for the IP address is yes Matt this

270
00:13:30,220 --> 00:13:36,010
really is your test fishing vendors IP

271
00:13:32,710 --> 00:13:39,370
address you don't so it's okay you can

272
00:13:36,010 --> 00:13:42,189
laugh at my pain but let's talk about

273
00:13:39,370 --> 00:13:43,900
what went wrong so what went wrong is I

274
00:13:42,190 --> 00:13:46,380
got caught up in the moment

275
00:13:43,900 --> 00:13:50,110
subconsciously letting somebody else

276
00:13:46,380 --> 00:13:52,270
influence my investigation their anxiety

277
00:13:50,110 --> 00:13:54,430
and their bad assumptions I wore off on

278
00:13:52,270 --> 00:13:56,530
me they were like super amped up about

279
00:13:54,430 --> 00:13:57,969
it and it got me worked up as a result

280
00:13:56,530 --> 00:14:00,040
and they were talking about the

281
00:13:57,970 --> 00:14:02,080
attachment I got so honed in to focus

282
00:14:00,040 --> 00:14:04,750
the attachment there really I lost sight

283
00:14:02,080 --> 00:14:07,210
of my own processes and procedures which

284
00:14:04,750 --> 00:14:08,860
namely and I've given a lot of fishing

285
00:14:07,210 --> 00:14:12,550
forensics talks a lot of different

286
00:14:08,860 --> 00:14:15,370
conferences was you know always start

287
00:14:12,550 --> 00:14:17,319
with the email headers and so I abandon

288
00:14:15,370 --> 00:14:18,880
at this one time I lost focus on what I

289
00:14:17,320 --> 00:14:21,670
was doing

290
00:14:18,880 --> 00:14:23,950
so the road to redemption here was

291
00:14:21,670 --> 00:14:25,479
people lessons learned for reminders and

292
00:14:23,950 --> 00:14:27,730
stick to my standard investigative

293
00:14:25,480 --> 00:14:29,590
processes and procedures if I would have

294
00:14:27,730 --> 00:14:31,540
started by looking at the headers first

295
00:14:29,590 --> 00:14:33,190
instead of getting buried in Thea

296
00:14:31,540 --> 00:14:35,110
attachment I could have closed out this

297
00:14:33,190 --> 00:14:38,050
investigation in minutes instead of

298
00:14:35,110 --> 00:14:40,630
hours but since it was a false alarm in

299
00:14:38,050 --> 00:14:43,810
a sense there are no further technical

300
00:14:40,630 --> 00:14:47,620
actions required on this one so scenario

301
00:14:43,810 --> 00:14:50,258
two is security scanner evasion so what

302
00:14:47,620 --> 00:14:52,420
happened in the environment is identical

303
00:14:50,259 --> 00:14:55,810
identical phishing emails started

304
00:14:52,420 --> 00:14:58,449
hitting inboxes in wild scaled reports

305
00:14:55,810 --> 00:15:00,040
of phishing came pouring in the phishing

306
00:14:58,449 --> 00:15:02,410
page linked no longer appeared to be

307
00:15:00,040 --> 00:15:04,149
working and my security scanner was the

308
00:15:02,410 --> 00:15:07,810
malicious site taken offline already

309
00:15:04,149 --> 00:15:09,490
what's investigate and find out so the

310
00:15:07,810 --> 00:15:11,979
investigation will start by looking at

311
00:15:09,490 --> 00:15:13,810
the message source and looking for

312
00:15:11,980 --> 00:15:16,149
hyperlinks then we're going to look at

313
00:15:13,810 --> 00:15:19,719
the demo page with a or the landing page

314
00:15:16,149 --> 00:15:21,759
rather with a security skier solution or

315
00:15:19,720 --> 00:15:23,350
a pretend one in this case and then

316
00:15:21,759 --> 00:15:26,350
we're gonna look at the source code and

317
00:15:23,350 --> 00:15:28,959
open the phishing page in our sandbox so

318
00:15:26,350 --> 00:15:30,970
let's go ahead and do those things so

319
00:15:28,959 --> 00:15:40,599
let me go ahead and pull up the phishing

320
00:15:30,970 --> 00:15:44,560
email here and I will blow this up so

321
00:15:40,600 --> 00:15:45,790
everybody can see it here now there are

322
00:15:44,560 --> 00:15:46,899
parts of this you won't be able to see

323
00:15:45,790 --> 00:15:49,599
in the room and the headers

324
00:15:46,899 --> 00:15:51,990
unfortunately but it's from evil that's

325
00:15:49,600 --> 00:15:56,010
the Emirate promise we are legit calm

326
00:15:51,990 --> 00:15:59,680
the subject is this link is totally safe

327
00:15:56,010 --> 00:16:02,199
and it's through phishing target which

328
00:15:59,680 --> 00:16:04,569
is unwitting victim at random target org

329
00:16:02,199 --> 00:16:07,089
and the emails you see says hello

330
00:16:04,569 --> 00:16:09,010
phishing target we have a really

331
00:16:07,089 --> 00:16:12,220
important message for you to retrieve

332
00:16:09,010 --> 00:16:15,970
your message click here real subtle

333
00:16:12,220 --> 00:16:17,290
right regards spoof sender now in spite

334
00:16:15,970 --> 00:16:20,439
of the fact that there were more red

335
00:16:17,290 --> 00:16:22,889
flags in this message that he could find

336
00:16:20,439 --> 00:16:26,439
inside of vladimir putin's garage as

337
00:16:22,889 --> 00:16:27,970
souvenirs from his old KGB days you know

338
00:16:26,439 --> 00:16:29,769
if i set this out as a test phishing

339
00:16:27,970 --> 00:16:32,439
campaign there's probably at least that

340
00:16:29,769 --> 00:16:33,759
one person and everybody's organization

341
00:16:32,439 --> 00:16:36,550
it's still gonna click on that link

342
00:16:33,759 --> 00:16:39,250
right so let's go ahead and take a look

343
00:16:36,550 --> 00:16:41,740
at the source code here in thunderbird

344
00:16:39,250 --> 00:16:44,130
we would do that under view and message

345
00:16:41,740 --> 00:16:44,130
source

346
00:16:45,220 --> 00:16:48,330
you know make that a little bit bigger

347
00:16:58,470 --> 00:17:15,030
all right so here's our URL from the

348
00:17:03,030 --> 00:17:19,550
efficient email so Athens when we look

349
00:17:15,030 --> 00:17:19,550
at that inside of a security scanner

350
00:17:20,869 --> 00:17:28,590
pull this up so pull it in get a

351
00:17:24,660 --> 00:17:30,450
screenshot of it for for air we've all

352
00:17:28,590 --> 00:17:32,310
seen this right so when a resource is

353
00:17:30,450 --> 00:17:35,370
taken offline it's not available

354
00:17:32,310 --> 00:17:36,000
something's happened to the server you

355
00:17:35,370 --> 00:17:39,629
name it

356
00:17:36,000 --> 00:17:41,790
essentially this 404 message is hey it's

357
00:17:39,630 --> 00:17:43,740
already gone so nothing to work about

358
00:17:41,790 --> 00:17:46,710
right we just pose this case and and

359
00:17:43,740 --> 00:17:48,480
move on or at least you know we could do

360
00:17:46,710 --> 00:17:56,840
that but we might want to dig just a

361
00:17:48,480 --> 00:17:56,840
little bit deeper so clear that up

362
00:18:00,500 --> 00:18:07,940
and so what we want to do is go ahead

363
00:18:04,980 --> 00:18:12,630
and see if we can grab this information

364
00:18:07,940 --> 00:18:15,000
so well go ahead and do curl you know

365
00:18:12,630 --> 00:18:19,860
still got the website address copied in

366
00:18:15,000 --> 00:18:25,860
here then we'll do output and we'll call

367
00:18:19,860 --> 00:18:28,320
it unknown dot HTML that's one way you

368
00:18:25,860 --> 00:18:30,889
can retrieve it we could also use W get

369
00:18:28,320 --> 00:18:38,419
so let me go ahead and do W get and

370
00:18:30,890 --> 00:18:38,420
paste in the URL now

371
00:18:48,090 --> 00:18:54,870
we look at these we'll notice that

372
00:18:51,390 --> 00:19:04,090
they're the same file size if I

373
00:18:54,870 --> 00:19:06,820
basically do a sha-256 sum both of these

374
00:19:04,090 --> 00:19:09,280
files have the same sha-256 hash value

375
00:19:06,820 --> 00:19:11,379
so forensically it doesn't really matter

376
00:19:09,280 --> 00:19:13,180
a whole lot which we're using now some

377
00:19:11,380 --> 00:19:14,470
of you might say well the timestamps

378
00:19:13,180 --> 00:19:16,450
differ we got one from today's date

379
00:19:14,470 --> 00:19:18,400
that's only because the demo environment

380
00:19:16,450 --> 00:19:21,160
in real life it's going to show you

381
00:19:18,400 --> 00:19:22,690
whatever the if you use W gets gonna

382
00:19:21,160 --> 00:19:24,970
show you the time that you retrieved it

383
00:19:22,690 --> 00:19:26,590
since this is grabbing a local copy in

384
00:19:24,970 --> 00:19:28,390
this case it doesn't actually change

385
00:19:26,590 --> 00:19:30,760
that so in real life you wouldn't have

386
00:19:28,390 --> 00:19:33,040
that benefit of seeing the original date

387
00:19:30,760 --> 00:19:34,900
but you can tell from the hash value in

388
00:19:33,040 --> 00:19:37,149
the file size these are basically the

389
00:19:34,900 --> 00:19:40,060
same file so doesn't matter which method

390
00:19:37,150 --> 00:19:42,760
you use in this case they both work the

391
00:19:40,060 --> 00:19:45,820
same for our purposes so let's go ahead

392
00:19:42,760 --> 00:19:48,900
and pull up the index.html file to see

393
00:19:45,820 --> 00:19:48,899
what was going on with it

394
00:19:57,660 --> 00:20:02,010
so I'll blow this up here a little bit

395
00:19:59,610 --> 00:20:05,219
and I've made this as easy under State

396
00:20:02,010 --> 00:20:07,860
as possible but basically what's going

397
00:20:05,220 --> 00:20:10,200
on is we're doing some user agent checks

398
00:20:07,860 --> 00:20:13,469
in the source code here and it's looking

399
00:20:10,200 --> 00:20:16,530
for things like chrome edge Firefox

400
00:20:13,470 --> 00:20:19,380
Internet Explorer opera and Safari and

401
00:20:16,530 --> 00:20:23,420
if it matches one of those user agent

402
00:20:19,380 --> 00:20:28,470
strings it sends it to a different page

403
00:20:23,420 --> 00:20:31,020
if it is not matching one of those it

404
00:20:28,470 --> 00:20:32,970
sends a traffic to a 404 error page I

405
00:20:31,020 --> 00:20:35,190
thought that was pretty clever because

406
00:20:32,970 --> 00:20:37,620
that actually did pool at least one

407
00:20:35,190 --> 00:20:39,810
security skater that I threw at it was

408
00:20:37,620 --> 00:20:44,850
it actually opened up the website

409
00:20:39,810 --> 00:20:49,500
address in a new browser that it came

410
00:20:44,850 --> 00:20:55,230
through so we're good and do that and

411
00:20:49,500 --> 00:20:59,100
see what that looks like and so in the

412
00:20:55,230 --> 00:21:01,350
sandbox when I pull it up you know what

413
00:20:59,100 --> 00:21:04,139
we essentially have is an office 365

414
00:21:01,350 --> 00:21:05,669
credential harvesting site so the site's

415
00:21:04,140 --> 00:21:07,230
still live in spite of the first

416
00:21:05,670 --> 00:21:10,200
impression that looks like hey this

417
00:21:07,230 --> 00:21:11,640
thing was actually taken down so by

418
00:21:10,200 --> 00:21:14,340
digging a little bit deeper we could see

419
00:21:11,640 --> 00:21:17,070
what happened so let's go ahead and talk

420
00:21:14,340 --> 00:21:28,139
about it a little more just some

421
00:21:17,070 --> 00:21:30,389
observations I had from that so we

422
00:21:28,140 --> 00:21:32,970
talked about the user agent Reede string

423
00:21:30,390 --> 00:21:35,160
based redirection I got lucky in this

424
00:21:32,970 --> 00:21:39,450
case they use JavaScript because if they

425
00:21:35,160 --> 00:21:42,090
had used a server-side language like PHP

426
00:21:39,450 --> 00:21:44,550
or Python or any number of them that's

427
00:21:42,090 --> 00:21:47,850
not even a full representative list but

428
00:21:44,550 --> 00:21:49,409
some of the popular ones I wouldn't have

429
00:21:47,850 --> 00:21:51,870
seen it because you need you know

430
00:21:49,410 --> 00:21:53,430
essentially privilege server access if

431
00:21:51,870 --> 00:21:54,989
you actually see that on the server side

432
00:21:53,430 --> 00:21:56,790
if it's not your server that was

433
00:21:54,990 --> 00:21:59,370
compromised probably not going to get

434
00:21:56,790 --> 00:22:00,810
that at least not legally in most places

435
00:21:59,370 --> 00:22:03,000
aren't just gonna let you hop on their

436
00:22:00,810 --> 00:22:05,129
server and take a ride to see hey can I

437
00:22:03,000 --> 00:22:07,230
see what your hacked web server code

438
00:22:05,130 --> 00:22:08,760
looks like probably not going to be too

439
00:22:07,230 --> 00:22:11,400
supportive unless you have to work like

440
00:22:08,760 --> 00:22:15,870
law enforcement maybe

441
00:22:11,400 --> 00:22:17,130
so something I've thought about is you

442
00:22:15,870 --> 00:22:18,570
know this technique could actually be

443
00:22:17,130 --> 00:22:19,980
used by threat actors let's say they had

444
00:22:18,570 --> 00:22:22,860
an exploit kit that only worked on

445
00:22:19,980 --> 00:22:23,840
Firefox is an arbitrary example what

446
00:22:22,860 --> 00:22:26,490
they could do is they could actually

447
00:22:23,840 --> 00:22:29,010
check to see if visitors have the

448
00:22:26,490 --> 00:22:31,290
Firefox browser if they do direct them

449
00:22:29,010 --> 00:22:33,090
to the exploit payload page and then

450
00:22:31,290 --> 00:22:35,520
round-robin redirect them back to the

451
00:22:33,090 --> 00:22:37,980
real page those browser redirects happen

452
00:22:35,520 --> 00:22:39,900
so fast most users aren't gonna notice

453
00:22:37,980 --> 00:22:42,930
probably need to see it it's gonna

454
00:22:39,900 --> 00:22:45,270
happen so fast and then meanwhile it

455
00:22:42,930 --> 00:22:47,190
would direct everything else to the you

456
00:22:45,270 --> 00:22:48,780
know the actual page it's gonna get

457
00:22:47,190 --> 00:22:51,809
really hard to detect because unless

458
00:22:48,780 --> 00:22:54,870
your security school tools are sending

459
00:22:51,809 --> 00:22:57,300
user agent strings of Firefox for in our

460
00:22:54,870 --> 00:23:00,449
example it's not necessarily gonna hit

461
00:22:57,300 --> 00:23:01,830
that and you could get very detailed

462
00:23:00,450 --> 00:23:03,900
with that you could even look for

463
00:23:01,830 --> 00:23:06,570
specific vulnerable versions and do the

464
00:23:03,900 --> 00:23:09,870
same thing so thread actors could really

465
00:23:06,570 --> 00:23:11,820
sort of take that to the next level in

466
00:23:09,870 --> 00:23:13,500
terms of the first one server-side

467
00:23:11,820 --> 00:23:15,530
languages I think I've actually seen

468
00:23:13,500 --> 00:23:18,179
that one in the wild just a month ago

469
00:23:15,530 --> 00:23:20,670
where one browser took me to one page

470
00:23:18,179 --> 00:23:22,800
and another browser took me to a

471
00:23:20,670 --> 00:23:24,210
different page and I couldn't tell from

472
00:23:22,800 --> 00:23:27,178
the source code what was happening so I

473
00:23:24,210 --> 00:23:29,520
suspect that they actually were using

474
00:23:27,179 --> 00:23:31,440
that first technique that I was talking

475
00:23:29,520 --> 00:23:33,660
about there

476
00:23:31,440 --> 00:23:36,270
so our remediation plan for this was we

477
00:23:33,660 --> 00:23:38,040
determined where the actual phishing

478
00:23:36,270 --> 00:23:40,440
landing page was at and we blocked it

479
00:23:38,040 --> 00:23:42,330
through web content filtering and then

480
00:23:40,440 --> 00:23:44,040
this wide-scale phishing campaign we

481
00:23:42,330 --> 00:23:46,379
worked with our secure email gateway

482
00:23:44,040 --> 00:23:50,040
vendor to block the active phishing

483
00:23:46,380 --> 00:23:51,929
campaign the last scenario I'm going to

484
00:23:50,040 --> 00:23:55,200
talk about is called or I call it the

485
00:23:51,929 --> 00:23:56,970
rabbit hole and so to preface this one I

486
00:23:55,200 --> 00:23:59,460
received a request from a user to

487
00:23:56,970 --> 00:24:01,410
investigate an email message they

488
00:23:59,460 --> 00:24:03,480
received to determine if it's legitimate

489
00:24:01,410 --> 00:24:07,200
or not email certainly looked like it

490
00:24:03,480 --> 00:24:09,720
could be fishy at first glance but is it

491
00:24:07,200 --> 00:24:11,580
just suspicious or is it malicious and I

492
00:24:09,720 --> 00:24:13,290
gave it talk by this title my favorite

493
00:24:11,580 --> 00:24:14,970
version is besides Cleveland if you

494
00:24:13,290 --> 00:24:16,770
search YouTube when East Side's

495
00:24:14,970 --> 00:24:18,570
Cleveland is it just suspicious or is it

496
00:24:16,770 --> 00:24:21,720
malicious you can find that talk if

497
00:24:18,570 --> 00:24:24,270
you're interested to seeing it so the

498
00:24:21,720 --> 00:24:25,290
investigation side I could tell and

499
00:24:24,270 --> 00:24:26,910
we'll take a look at this in a minute

500
00:24:25,290 --> 00:24:30,780
from the message headers the source IP

501
00:24:26,910 --> 00:24:32,520
was was a mismatch but the message

502
00:24:30,780 --> 00:24:35,250
source code was particularly interesting

503
00:24:32,520 --> 00:24:36,810
I noticed that the hyperlink didn't

504
00:24:35,250 --> 00:24:39,150
actually go to where the link text said

505
00:24:36,810 --> 00:24:41,370
it did we'll look at that here in just a

506
00:24:39,150 --> 00:24:42,870
second and then the licious threat

507
00:24:41,370 --> 00:24:45,030
actors objective appeared to be a

508
00:24:42,870 --> 00:24:47,189
credential harvesting site for the

509
00:24:45,030 --> 00:24:48,270
purposes of account takeover so let's

510
00:24:47,190 --> 00:24:50,370
look at this stuff

511
00:24:48,270 --> 00:25:01,620
let me go ahead and open up our phishing

512
00:24:50,370 --> 00:25:05,459
email here and from PayPal support you

513
00:25:01,620 --> 00:25:08,340
know PP support at pwned - server org

514
00:25:05,460 --> 00:25:11,220
and the subject is PayPal bank account

515
00:25:08,340 --> 00:25:13,919
changed confirmation and against to our

516
00:25:11,220 --> 00:25:16,680
unwitting victim phishing target your

517
00:25:13,920 --> 00:25:18,780
PayPal customer your request update your

518
00:25:16,680 --> 00:25:20,250
bank account on file will complete in

519
00:25:18,780 --> 00:25:21,990
the next four hours if you didn't

520
00:25:20,250 --> 00:25:24,090
request this change log in to your

521
00:25:21,990 --> 00:25:25,680
PayPal account account to reject the

522
00:25:24,090 --> 00:25:27,149
pending activity now if you have a

523
00:25:25,680 --> 00:25:28,920
PayPal account and you're an

524
00:25:27,150 --> 00:25:31,530
unsuspecting user you think wait a

525
00:25:28,920 --> 00:25:34,620
minute this is crazy man I didn't

526
00:25:31,530 --> 00:25:37,379
initiate a bank account change I need to

527
00:25:34,620 --> 00:25:39,239
log in and refute this or reject the

528
00:25:37,380 --> 00:25:41,130
change because I've only got four hour

529
00:25:39,240 --> 00:25:43,560
window to do it right that sense of

530
00:25:41,130 --> 00:25:44,880
urgency that's that lure any look at the

531
00:25:43,560 --> 00:25:49,530
URL and it's like yeah that's the

532
00:25:44,880 --> 00:25:51,690
legitimate PayPal login page link looks

533
00:25:49,530 --> 00:25:53,520
good but let's go ahead and take a look

534
00:25:51,690 --> 00:26:01,920
at the message source on this one as

535
00:25:53,520 --> 00:26:05,129
well make a little bigger so notice the

536
00:26:01,920 --> 00:26:07,620
link text actually shows you know the

537
00:26:05,130 --> 00:26:11,730
PayPal sign in but we look at the actual

538
00:26:07,620 --> 00:26:15,830
hyperlink it's you know some de site

539
00:26:11,730 --> 00:26:19,110
which is in Belgium and in this case a

540
00:26:15,830 --> 00:26:22,080
demo attack destination one so we look

541
00:26:19,110 --> 00:26:23,280
at that and we think well hopefully

542
00:26:22,080 --> 00:26:25,560
we've got our first layer of obfuscation

543
00:26:23,280 --> 00:26:28,560
because the link text doesn't match the

544
00:26:25,560 --> 00:26:30,629
actual hyperlink obviously we're not

545
00:26:28,560 --> 00:26:33,510
going to gain anything by copying the

546
00:26:30,630 --> 00:26:37,830
legitimate PayPal address so we'll go

547
00:26:33,510 --> 00:26:39,250
ahead and grab the phishing link to

548
00:26:37,830 --> 00:26:45,399
understand what's happening

549
00:26:39,250 --> 00:26:54,700
here and to sort of show everybody what

550
00:26:45,400 --> 00:26:59,920
that would look like oh I see what

551
00:26:54,700 --> 00:27:01,420
happened had to eat ruff sorry folks I

552
00:26:59,920 --> 00:27:06,850
copied too much all right so here we go

553
00:27:01,420 --> 00:27:09,040
so fake PayPal login page looks like the

554
00:27:06,850 --> 00:27:13,270
PayPal login page you know so people

555
00:27:09,040 --> 00:27:14,740
enter their credentials in here and go

556
00:27:13,270 --> 00:27:16,690
through that process now the threat

557
00:27:14,740 --> 00:27:19,180
actors have their PayPal username and

558
00:27:16,690 --> 00:27:20,830
password anybody think that they our

559
00:27:19,180 --> 00:27:23,590
next step is going to be the log into

560
00:27:20,830 --> 00:27:25,659
PayPal and transfer some funds probably

561
00:27:23,590 --> 00:27:30,040
pretty good chance or go on a shopping

562
00:27:25,660 --> 00:27:31,870
strip for a fake store also maybe use

563
00:27:30,040 --> 00:27:33,370
these credentials to find other payment

564
00:27:31,870 --> 00:27:36,310
services hey are they using the same

565
00:27:33,370 --> 00:27:37,899
password username password and Amazon

566
00:27:36,310 --> 00:27:40,270
probably gonna try some you know

567
00:27:37,900 --> 00:27:42,670
credential stuffing they've got account

568
00:27:40,270 --> 00:27:50,889
credentials for one site service

569
00:27:42,670 --> 00:27:53,890
probably go to the others yeah so

570
00:27:50,890 --> 00:27:56,200
actually it you know the address does

571
00:27:53,890 --> 00:27:59,170
sort of display with interesting as we

572
00:27:56,200 --> 00:28:01,150
started off in Belgium but what we have

573
00:27:59,170 --> 00:28:05,020
here what we're looking at we're looking

574
00:28:01,150 --> 00:28:08,230
at a compromised server in Germany it's

575
00:28:05,020 --> 00:28:10,120
a dot de domain so already we've sort of

576
00:28:08,230 --> 00:28:12,870
got another weird office keishon going

577
00:28:10,120 --> 00:28:14,830
on here where it's not the first page

578
00:28:12,870 --> 00:28:18,429
but we're actually looking at something

579
00:28:14,830 --> 00:28:28,090
else so let's go ahead and good and curl

580
00:28:18,430 --> 00:28:33,010
and we'll grab that URL here and we'll

581
00:28:28,090 --> 00:28:38,639
output that to a first file output - -

582
00:28:33,010 --> 00:28:38,640
output we'll call it first page HTML

583
00:28:43,860 --> 00:28:52,199
and we'll go ahead and open this up so

584
00:28:47,350 --> 00:28:55,090
everybody can see it inside of editor

585
00:28:52,200 --> 00:28:56,880
now this was the URL from the actual

586
00:28:55,090 --> 00:28:59,199
fishing email the actual hyperlink

587
00:28:56,880 --> 00:28:59,980
what's interesting is I log in and look

588
00:28:59,200 --> 00:29:02,200
at it here

589
00:28:59,980 --> 00:29:05,170
and it's actually doing HTTP meta

590
00:29:02,200 --> 00:29:07,660
refresh that's how we got from the

591
00:29:05,170 --> 00:29:09,370
request in Belgium

592
00:29:07,660 --> 00:29:12,730
now it's redirecting to another

593
00:29:09,370 --> 00:29:14,739
compromised web host in Germany so very

594
00:29:12,730 --> 00:29:16,120
interesting and what we want to do to

595
00:29:14,740 --> 00:29:19,390
understand is kind of repeat that

596
00:29:16,120 --> 00:29:22,719
process and look at the source code at

597
00:29:19,390 --> 00:29:25,570
the the German page so we'll go ahead

598
00:29:22,720 --> 00:29:33,250
and repeat that process will do another

599
00:29:25,570 --> 00:29:36,909
curl and we'll put in that web URL - -

600
00:29:33,250 --> 00:29:42,670
output and we'll call it second page dot

601
00:29:36,910 --> 00:29:46,750
HTML we have that so good and do G edit

602
00:29:42,670 --> 00:29:55,810
and we'll do second page the ampersand

603
00:29:46,750 --> 00:29:58,720
so it's in a detached window we'll blow

604
00:29:55,810 --> 00:30:00,990
that up what's interesting is it look

605
00:29:58,720 --> 00:30:03,760
like we were on that German page right

606
00:30:00,990 --> 00:30:07,560
but actually we really weren't because

607
00:30:03,760 --> 00:30:11,830
what had inside the code was actually a

608
00:30:07,560 --> 00:30:13,389
iframe iframe going to another host

609
00:30:11,830 --> 00:30:15,220
so there's another compromised web

610
00:30:13,390 --> 00:30:16,840
server and it's in another different

611
00:30:15,220 --> 00:30:18,820
country now we're in the Netherlands now

612
00:30:16,840 --> 00:30:20,709
we're doing a whole European tour on

613
00:30:18,820 --> 00:30:22,419
this one phishing email so we've gone

614
00:30:20,710 --> 00:30:25,480
for the first layer of obfuscation of

615
00:30:22,420 --> 00:30:27,130
hyperlink text not matching the or the

616
00:30:25,480 --> 00:30:30,010
link text not matching the hyperlink

617
00:30:27,130 --> 00:30:33,840
we've got a meta refresh and then we've

618
00:30:30,010 --> 00:30:37,030
got a word an iframe so now we've got

619
00:30:33,840 --> 00:30:38,649
another layer of obfuscation this is

620
00:30:37,030 --> 00:30:41,560
really becoming the rabbit hole which is

621
00:30:38,650 --> 00:30:45,400
why I titled the attack that for that

622
00:30:41,560 --> 00:30:48,550
reason so we'll go ahead and get the

623
00:30:45,400 --> 00:30:52,620
final destination and see what that

624
00:30:48,550 --> 00:30:56,759
looks like so we'll go ahead and curl

625
00:30:52,620 --> 00:31:04,979
will pick that in here again

626
00:30:56,759 --> 00:31:04,980
will do with - - output third page HTML

627
00:31:05,399 --> 00:31:13,029
now let's go into ug edit here because

628
00:31:09,970 --> 00:31:14,100
it's easy for me to make that readable

629
00:31:13,029 --> 00:31:17,380
oops

630
00:31:14,100 --> 00:31:20,860
paste in that URL we copied from you

631
00:31:17,380 --> 00:31:29,340
know again the second country server now

632
00:31:20,860 --> 00:31:41,229
we're on the third Oh need a third page

633
00:31:29,340 --> 00:31:43,480
third page so bunch of gobbledygook that

634
00:31:41,230 --> 00:31:45,639
we're looking at here I think this is a

635
00:31:43,480 --> 00:31:47,590
readable like we're no longer

636
00:31:45,639 --> 00:31:49,870
redirecting and eye framing and stuff

637
00:31:47,590 --> 00:31:51,908
like that we've got basically what boils

638
00:31:49,870 --> 00:31:53,739
down to a mess so let's go and see what

639
00:31:51,909 --> 00:32:02,919
that looks like in real life when we

640
00:31:53,740 --> 00:32:04,919
punch in that URL and we'll use Google's

641
00:32:02,919 --> 00:32:06,840
built-in developer tools to help us out

642
00:32:04,919 --> 00:32:09,460
which are really great

643
00:32:06,840 --> 00:32:14,019
someday I'd love to do just to talk on

644
00:32:09,460 --> 00:32:18,700
using built in browser developer tools

645
00:32:14,019 --> 00:32:21,700
for forensics so we'll take a look at

646
00:32:18,700 --> 00:32:27,129
the HTML and see if I can make this a

647
00:32:21,700 --> 00:32:28,539
little better so it's like great what

648
00:32:27,129 --> 00:32:31,928
we're kind of looking at here so we've

649
00:32:28,539 --> 00:32:34,360
got a document right in an unescape and

650
00:32:31,929 --> 00:32:36,549
we got a big sequence here and then

651
00:32:34,360 --> 00:32:38,258
that's followed by this DF and another

652
00:32:36,549 --> 00:32:40,029
big sequence now I've intentionally put

653
00:32:38,259 --> 00:32:42,309
whitespace in to make this more readable

654
00:32:40,029 --> 00:32:45,610
and I know looking at it some of you're

655
00:32:42,309 --> 00:32:47,529
thinking that's readable well it kind of

656
00:32:45,610 --> 00:32:48,789
isn't but just to kind of break it down

657
00:32:47,529 --> 00:32:51,509
a little bit a little bit what we're

658
00:32:48,789 --> 00:32:53,769
looking at here so we've got the

659
00:32:51,509 --> 00:32:56,500
document right the own escape sequence

660
00:32:53,769 --> 00:32:59,019
what we can guess is that this is

661
00:32:56,500 --> 00:33:02,340
creating the sequence and it's feeding

662
00:32:59,019 --> 00:33:05,379
in a function into it the sequence here

663
00:33:02,340 --> 00:33:08,320
to basically produce the output now in

664
00:33:05,379 --> 00:33:10,219
the olden days used to have two unescape

665
00:33:08,320 --> 00:33:12,678
this two basically under

666
00:33:10,220 --> 00:33:15,320
the formula that makes the rest of the

667
00:33:12,679 --> 00:33:18,049
stuff work fortunately now the browser

668
00:33:15,320 --> 00:33:19,970
developer tools are so good the best

669
00:33:18,049 --> 00:33:22,220
important thing to remember is that if

670
00:33:19,970 --> 00:33:25,549
it's renderable in a browser has to be

671
00:33:22,220 --> 00:33:27,289
something that can be decoded the good

672
00:33:25,549 --> 00:33:29,929
news is we don't have to necessarily all

673
00:33:27,289 --> 00:33:32,809
that stuff by hand anymore

674
00:33:29,929 --> 00:33:35,929
we can actually scroll down past all the

675
00:33:32,809 --> 00:33:39,250
encoded stuff and now we can actually

676
00:33:35,929 --> 00:33:41,960
see using the browser developer tools

677
00:33:39,250 --> 00:33:45,100
what was in there and so here's the

678
00:33:41,960 --> 00:33:47,539
formula that's nice and decoded for us

679
00:33:45,100 --> 00:33:51,080
we can actually see the HTML code that

680
00:33:47,539 --> 00:33:52,100
makes that work something that's more

681
00:33:51,080 --> 00:33:53,980
interesting like well I thought you

682
00:33:52,100 --> 00:33:57,649
decoded it there's more gobbledygook

683
00:33:53,980 --> 00:33:59,600
actually what this is is there's base64

684
00:33:57,650 --> 00:34:02,090
encoding inside of this JavaScript

685
00:33:59,600 --> 00:34:04,939
encoded page so now we have encoded

686
00:34:02,090 --> 00:34:07,490
elements inside of an encoded page so

687
00:34:04,940 --> 00:34:10,460
this is getting really deep we'll talk

688
00:34:07,490 --> 00:34:13,369
about the stuff here in a moment we'll

689
00:34:10,460 --> 00:34:17,839
keep kind of looking at it and all of a

690
00:34:13,369 --> 00:34:21,290
sudden we've got another base64 encoded

691
00:34:17,839 --> 00:34:23,540
item and we can guess based on the on

692
00:34:21,290 --> 00:34:27,199
the mime type here that's an image file

693
00:34:23,540 --> 00:34:31,580
that's basic ste 4 encoded and just kind

694
00:34:27,199 --> 00:34:34,250
of looking at it we'll go ahead and take

695
00:34:31,580 --> 00:34:37,359
a look at the sources the good thing is

696
00:34:34,250 --> 00:34:40,159
that with I'm sorry the network tab and

697
00:34:37,359 --> 00:34:46,989
look at the image we're going to reload

698
00:34:40,159 --> 00:34:46,990
that page real quick here come back in

699
00:34:54,330 --> 00:35:04,590
what think it's because hold on Lee get

700
00:35:01,470 --> 00:35:07,319
that link out of here and paste it back

701
00:35:04,590 --> 00:35:09,090
in it's not actually rendering it there

702
00:35:07,320 --> 00:35:13,290
because it's that that's that I frame

703
00:35:09,090 --> 00:35:15,060
that we were looking at yeah just

704
00:35:13,290 --> 00:35:16,740
relaunching the Google window here just

705
00:35:15,060 --> 00:35:26,640
to make sure fire up developer tools

706
00:35:16,740 --> 00:35:28,350
again come back paste in again this is

707
00:35:26,640 --> 00:35:33,089
the actual final landing page that we

708
00:35:28,350 --> 00:35:38,640
found through our forensic trail all

709
00:35:33,090 --> 00:35:40,500
right so now here we find within the

710
00:35:38,640 --> 00:35:43,620
headers we can look at the data image

711
00:35:40,500 --> 00:35:46,530
and here's that base64 image and the

712
00:35:43,620 --> 00:35:48,060
nice thing is we hit the preview tab up

713
00:35:46,530 --> 00:35:50,130
the top and actually shows us what the

714
00:35:48,060 --> 00:35:52,259
image file is it decodes it for us

715
00:35:50,130 --> 00:35:55,200
automatically which is fantastic that's

716
00:35:52,260 --> 00:35:57,150
just you know saving us work right there

717
00:35:55,200 --> 00:35:59,129
but you'll notice it only finds one

718
00:35:57,150 --> 00:36:01,860
image there are actually two base64

719
00:35:59,130 --> 00:36:03,530
encoded elements inside of this so let's

720
00:36:01,860 --> 00:36:06,180
go back and take a quick look at that

721
00:36:03,530 --> 00:36:07,830
and just kind of show you if we do this

722
00:36:06,180 --> 00:36:10,109
stuff by he and what that looks like

723
00:36:07,830 --> 00:36:13,920
so our first item didn't show up in that

724
00:36:10,110 --> 00:36:17,910
list which is uh you know basically this

725
00:36:13,920 --> 00:36:19,440
long base64 encoded string so what I

726
00:36:17,910 --> 00:36:22,190
want to do is go ahead and just copy

727
00:36:19,440 --> 00:36:22,190
this out

728
00:36:36,690 --> 00:36:43,210
to the bottom you back off so I'm

729
00:36:41,680 --> 00:36:46,810
grabbing the stuff inside the quotes

730
00:36:43,210 --> 00:36:50,890
here last two you there we go all right

731
00:36:46,810 --> 00:36:53,740
the open up new G edit and just create a

732
00:36:50,890 --> 00:36:56,049
new tab paste all the stuff in here and

733
00:36:53,740 --> 00:36:57,850
we'll go ahead and save it to our d fi

734
00:36:56,050 --> 00:37:07,330
our folder and we'll just call it

735
00:36:57,850 --> 00:37:09,790
unknown dot ICO save it out and so what

736
00:37:07,330 --> 00:37:13,540
I'm thinking again based on the the mime

737
00:37:09,790 --> 00:37:16,779
type here and what we're seeing is you

738
00:37:13,540 --> 00:37:20,200
can see in here shortcut icon' theta for

739
00:37:16,780 --> 00:37:23,110
the mime type data image X icon base64

740
00:37:20,200 --> 00:37:26,970
so I'm guessing this is an icon file so

741
00:37:23,110 --> 00:37:26,970
let's go ahead and now that we have it

742
00:37:30,900 --> 00:37:36,670
here's our file but we can't just look

743
00:37:33,520 --> 00:37:44,009
at it as this so we have to decode that

744
00:37:36,670 --> 00:37:51,100
so we'll go ahead and base64 dash D and

745
00:37:44,010 --> 00:37:53,680
you know it's unknown dot ICO and we'll

746
00:37:51,100 --> 00:38:05,670
put will basically redirect that output

747
00:37:53,680 --> 00:38:05,669
to fav icon that I see oh I did

748
00:38:08,180 --> 00:38:12,948
yeah there we go thank you for that

749
00:38:10,259 --> 00:38:18,509
that's a typo thanks for a good catch

750
00:38:12,949 --> 00:38:21,289
all right so let's see what that looks

751
00:38:18,509 --> 00:38:32,339
like so I'm just gonna launch Chrome and

752
00:38:21,289 --> 00:38:33,509
we'll call up the Save icon I see a file

753
00:38:32,339 --> 00:38:35,549
and there it is

754
00:38:33,509 --> 00:38:41,130
I'm sure enough well if we go back to

755
00:38:35,549 --> 00:38:44,309
the compromised website oops that was on

756
00:38:41,130 --> 00:38:47,099
the first tab you can see I know it's

757
00:38:44,309 --> 00:38:48,839
really tiny but up here in the top you

758
00:38:47,099 --> 00:38:51,119
see it real well but yeah sure enough

759
00:38:48,839 --> 00:38:52,828
it's our fav icon for the page so that's

760
00:38:51,119 --> 00:38:59,009
how we would sort of go back and do that

761
00:38:52,829 --> 00:39:03,109
stuff by hand they didn't pull this back

762
00:38:59,009 --> 00:39:03,109
up oops

763
00:39:03,709 --> 00:39:08,989
so the first destination we talked about

764
00:39:06,359 --> 00:39:12,089
it went to a page in one corn country

765
00:39:08,989 --> 00:39:14,519
the second page was in yet another

766
00:39:12,089 --> 00:39:16,380
foreign country and then landing page

767
00:39:14,519 --> 00:39:17,218
went to a compromise web host in another

768
00:39:16,380 --> 00:39:19,920
foreign country

769
00:39:17,219 --> 00:39:21,630
we got the source code on that stuff the

770
00:39:19,920 --> 00:39:23,400
malicious thread actors use JavaScript

771
00:39:21,630 --> 00:39:26,190
encoding to avoid analysis and detection

772
00:39:23,400 --> 00:39:28,019
while hiding the page source and we

773
00:39:26,190 --> 00:39:29,699
certainly saw that in action so we

774
00:39:28,019 --> 00:39:32,758
decoded the source page using built-in

775
00:39:29,699 --> 00:39:34,920
browser developer tools and so the

776
00:39:32,759 --> 00:39:36,930
encoded elements you know whether the

777
00:39:34,920 --> 00:39:39,690
thread actors used encoded elements to

778
00:39:36,930 --> 00:39:42,569
avoid analysis and detection or keep the

779
00:39:39,690 --> 00:39:45,299
entire site as a single page file they

780
00:39:42,569 --> 00:39:49,619
use base64 encoded elements within their

781
00:39:45,299 --> 00:39:51,479
JavaScript encoded page so by decoding

782
00:39:49,619 --> 00:39:53,519
the elements using the developer tools

783
00:39:51,479 --> 00:39:55,919
we could see what the image files or at

784
00:39:53,519 --> 00:39:59,189
least the one was and then looked at

785
00:39:55,920 --> 00:40:01,229
doing that by hand a remediation plan in

786
00:39:59,190 --> 00:40:02,549
this instance we determined the final

787
00:40:01,229 --> 00:40:04,649
landing page because that third

788
00:40:02,549 --> 00:40:05,759
compromised server in the foreign

789
00:40:04,650 --> 00:40:07,829
country and I was the first thing I

790
00:40:05,759 --> 00:40:09,989
blocked and then went back through and

791
00:40:07,829 --> 00:40:12,150
got the intermediary one so we blocked

792
00:40:09,989 --> 00:40:15,569
the other to you as well and then I

793
00:40:12,150 --> 00:40:18,209
reported the web compromises through the

794
00:40:15,569 --> 00:40:20,759
Whois contacts I don't think I heard

795
00:40:18,209 --> 00:40:22,649
back from any of them but I may at least

796
00:40:20,759 --> 00:40:27,020
the effort of my part

797
00:40:22,650 --> 00:40:29,849
and they were blocked for our users so

798
00:40:27,020 --> 00:40:32,640
with that that's really the demos and

799
00:40:29,849 --> 00:40:34,109
the scenarios I had for you today but as

800
00:40:32,640 --> 00:40:36,450
you see me wandering around hacker con

801
00:40:34,109 --> 00:40:38,759
and I'll be here all weekend

802
00:40:36,450 --> 00:40:40,740
please stop by talk to me share your own

803
00:40:38,760 --> 00:40:42,839
digital forensic incident response

804
00:40:40,740 --> 00:40:46,348
stories with that

805
00:40:42,839 --> 00:40:53,849
friends Romans hacker Con attendees lend

806
00:40:46,349 --> 00:40:58,760
me your irs so if that was going to open

807
00:40:53,849 --> 00:40:58,760
up for questions anybody have anything

808
00:41:02,900 --> 00:41:10,339
all right going once going twice

809
00:41:06,170 --> 00:41:10,339
thanks everybody appreciate it

810
00:41:15,650 --> 00:41:17,710
you

