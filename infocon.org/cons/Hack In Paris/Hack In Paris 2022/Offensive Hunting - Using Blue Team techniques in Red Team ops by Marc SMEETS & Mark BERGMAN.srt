1
00:00:00,880 --> 00:00:03,439
thank you sir

2
00:00:05,680 --> 00:00:07,279
that's cool that wind saved us five

3
00:00:07,279 --> 00:00:09,120
minutes of time i think we'll uh we'll

4
00:00:09,120 --> 00:00:11,120
use that straight away and we hope to be

5
00:00:11,120 --> 00:00:13,519
in time for the next speaker as well

6
00:00:13,519 --> 00:00:15,280
so we've got a challenge there

7
00:00:15,280 --> 00:00:17,440
i was here in 2019 and it's really cool

8
00:00:17,440 --> 00:00:20,160
to be back on stage in person

9
00:00:20,160 --> 00:00:21,920
three years later

10
00:00:21,920 --> 00:00:23,359
it's good to see that the room is very

11
00:00:23,359 --> 00:00:24,640
well filled

12
00:00:24,640 --> 00:00:26,960
we've gone we're going to talk to you on

13
00:00:26,960 --> 00:00:28,960
offensive hunting

14
00:00:28,960 --> 00:00:31,279
and how we use blue team techniques to

15
00:00:31,279 --> 00:00:33,440
do red team ops because

16
00:00:33,440 --> 00:00:35,360
let's be clear usually the blue teams

17
00:00:35,360 --> 00:00:37,680
are well ahead of us in in structured

18
00:00:37,680 --> 00:00:39,200
way of thinking and how they approach

19
00:00:39,200 --> 00:00:41,200
their problems so why not learn from the

20
00:00:41,200 --> 00:00:43,040
blue teams as i hope that blue teams

21
00:00:43,040 --> 00:00:45,360
will learn from us in the end

22
00:00:45,360 --> 00:00:47,200
the first a short introduction from

23
00:00:47,200 --> 00:00:50,160
myself my name is mike bergman i started

24
00:00:50,160 --> 00:00:53,280
in in 1999 as a coder on

25
00:00:53,280 --> 00:00:55,920
mainframes i wrote cobalt i don't have

26
00:00:55,920 --> 00:00:57,440
gray here yet well they're starting to

27
00:00:57,440 --> 00:00:59,039
get there but

28
00:00:59,039 --> 00:01:01,440
i started writing cobalt still regularly

29
00:01:01,440 --> 00:01:03,199
get called do you still write coldwall

30
00:01:03,199 --> 00:01:05,040
can we hire you because apparently

31
00:01:05,040 --> 00:01:07,040
there's a big demand i didn't really

32
00:01:07,040 --> 00:01:09,360
like it so i moved to offensive security

33
00:01:09,360 --> 00:01:10,720
in 204

34
00:01:10,720 --> 00:01:13,600
which puts me already up to 18 yeah up

35
00:01:13,600 --> 00:01:15,759
to 18 years of offensive security

36
00:01:15,759 --> 00:01:17,119
experience

37
00:01:17,119 --> 00:01:20,400
at this moment i'm working for outflank

38
00:01:20,400 --> 00:01:23,119
where i do red teaming

39
00:01:23,119 --> 00:01:24,880
and with do red teaming i mean we

40
00:01:24,880 --> 00:01:26,799
perform the red team itself so we are

41
00:01:26,799 --> 00:01:29,200
hands on keyboard red teamers but we

42
00:01:29,200 --> 00:01:31,840
also talk to the business

43
00:01:31,840 --> 00:01:33,759
do all the aftercare so we talk to the

44
00:01:33,759 --> 00:01:35,439
blue teams that's usually the people we

45
00:01:35,439 --> 00:01:38,159
heard during the red team and we try and

46
00:01:38,159 --> 00:01:40,159
make sure that they get the maximum

47
00:01:40,159 --> 00:01:42,240
benefit out of the out of the red team

48
00:01:42,240 --> 00:01:43,920
because i think one of our

49
00:01:43,920 --> 00:01:45,600
main lines is that the blue team needs

50
00:01:45,600 --> 00:01:47,360
to learn from the red team and if the

51
00:01:47,360 --> 00:01:49,360
blue team doesn't learn the red team

52
00:01:49,360 --> 00:01:51,600
failed

53
00:01:51,600 --> 00:01:52,799
yeah okay

54
00:01:52,799 --> 00:01:55,200
my name is mark smades pretty easy marco

55
00:01:55,200 --> 00:01:56,079
mark

56
00:01:56,079 --> 00:01:58,640
also colleagues of each other so

57
00:01:58,640 --> 00:02:00,240
interesting discussions in team meetings

58
00:02:00,240 --> 00:02:02,719
marker mark

59
00:02:02,719 --> 00:02:05,600
going back i would say i'm infosec class

60
00:02:05,600 --> 00:02:08,720
of 1998 hobby-wise just poking around on

61
00:02:08,720 --> 00:02:10,878
the internet to see what's what's there

62
00:02:10,878 --> 00:02:14,160
professionally 2006 when i graduated

63
00:02:14,160 --> 00:02:15,599
from university i went to a big

64
00:02:15,599 --> 00:02:17,840
consulting and advisory

65
00:02:17,840 --> 00:02:18,879
firm

66
00:02:18,879 --> 00:02:22,560
where i also co-worked with with mark

67
00:02:22,560 --> 00:02:25,200
a lot of big fun big clients corporates

68
00:02:25,200 --> 00:02:27,440
all over the world advising

69
00:02:27,440 --> 00:02:29,840
back then it was still called pen

70
00:02:29,840 --> 00:02:33,280
testing i guess and nowadays we have

71
00:02:33,280 --> 00:02:35,200
got this brand new environment called

72
00:02:35,200 --> 00:02:38,239
red teaming coupled with blue teaming or

73
00:02:38,239 --> 00:02:41,599
adversary simulation whatever you like

74
00:02:41,599 --> 00:02:43,920
i'm a red team operator i like to build

75
00:02:43,920 --> 00:02:46,480
all kinds of tools that make our life

76
00:02:46,480 --> 00:02:48,160
easier

77
00:02:48,160 --> 00:02:50,239
i'm also a vivid trainer we have lots of

78
00:02:50,239 --> 00:02:52,160
trainings that we do i really enjoy

79
00:02:52,160 --> 00:02:53,920
bringing that knowledge over to other

80
00:02:53,920 --> 00:02:55,040
people

81
00:02:55,040 --> 00:02:56,319
and one of the

82
00:02:56,319 --> 00:02:58,800
stints that i did at a bigger bank and

83
00:02:58,800 --> 00:03:00,400
some other clients is

84
00:03:00,400 --> 00:03:03,599
jump from the red side to the blue side

85
00:03:03,599 --> 00:03:05,920
and just see how

86
00:03:05,920 --> 00:03:08,480
defensive units work and bring that

87
00:03:08,480 --> 00:03:10,640
offensive mindset to

88
00:03:10,640 --> 00:03:13,599
the defensive guys

89
00:03:14,319 --> 00:03:16,480
and like when said

90
00:03:16,480 --> 00:03:19,360
we're not really into the blue versus

91
00:03:19,360 --> 00:03:22,080
red we see this as as one and it's also

92
00:03:22,080 --> 00:03:23,920
one of the core values when

93
00:03:23,920 --> 00:03:26,560
in 2016 when we uh

94
00:03:26,560 --> 00:03:28,560
we're two of the four founders of the

95
00:03:28,560 --> 00:03:30,239
company called outflank

96
00:03:30,239 --> 00:03:32,720
we are an amsterdam-based company solely

97
00:03:32,720 --> 00:03:34,879
focused on red teaming doing offensive

98
00:03:34,879 --> 00:03:36,560
security or adversary simulation

99
00:03:36,560 --> 00:03:37,840
whatever you like

100
00:03:37,840 --> 00:03:39,840
uh and along the way we also brought in

101
00:03:39,840 --> 00:03:41,840
some trainings and we have a commercial

102
00:03:41,840 --> 00:03:45,280
offensive security tooling product

103
00:03:45,280 --> 00:03:47,120
but the reason that we jumped on red

104
00:03:47,120 --> 00:03:50,560
teaming in 2016 is that the market was

105
00:03:50,560 --> 00:03:52,080
ready for

106
00:03:52,080 --> 00:03:53,200
proper

107
00:03:53,200 --> 00:03:56,080
adversary simulation

108
00:03:56,080 --> 00:03:57,280
and

109
00:03:57,280 --> 00:03:59,280
we also find it very important to share

110
00:03:59,280 --> 00:04:01,280
the knowledge that we do by putting out

111
00:04:01,280 --> 00:04:04,319
the blogs by doing the research by

112
00:04:04,319 --> 00:04:05,280
sharing

113
00:04:05,280 --> 00:04:07,519
code about proof of concept tooling all

114
00:04:07,519 --> 00:04:09,519
kinds of stuff by putting it out there

115
00:04:09,519 --> 00:04:13,599
we help the blue teams to evolve as well

116
00:04:13,599 --> 00:04:15,920
and you can go to the websites that are

117
00:04:15,920 --> 00:04:18,000
listed over there uh you will find all

118
00:04:18,000 --> 00:04:19,199
kinds of different tools one of the

119
00:04:19,199 --> 00:04:21,358
tools that we um

120
00:04:21,358 --> 00:04:23,280
have released and i'm thinking into this

121
00:04:23,280 --> 00:04:26,720
in 1819-ish is called red elk

122
00:04:26,720 --> 00:04:27,759
and that's one of the tools we'll be

123
00:04:27,759 --> 00:04:29,360
discussing in this presentation it's a

124
00:04:29,360 --> 00:04:30,960
core

125
00:04:30,960 --> 00:04:34,799
aspect of our daily operations

126
00:04:36,560 --> 00:04:38,639
seems the reach is just a little bit

127
00:04:38,639 --> 00:04:40,639
short

128
00:04:40,639 --> 00:04:42,479
okay i think there you go

129
00:04:42,479 --> 00:04:45,120
if there's one thing that you are about

130
00:04:45,120 --> 00:04:47,120
to remember from this presentation

131
00:04:47,120 --> 00:04:49,199
hopefully it is this

132
00:04:49,199 --> 00:04:51,360
it's not red versus blue it's together

133
00:04:51,360 --> 00:04:53,199
it's together it's it's sparring it's

134
00:04:53,199 --> 00:04:55,919
preparing the blue team for the actual

135
00:04:55,919 --> 00:04:58,320
threats the sole purpose of the red team

136
00:04:58,320 --> 00:05:00,479
is to improve blue

137
00:05:00,479 --> 00:05:02,400
yes we do this by sparring yes we do

138
00:05:02,400 --> 00:05:04,320
this bit real punches it really hurts

139
00:05:04,320 --> 00:05:06,960
when we're in operation and we

140
00:05:06,960 --> 00:05:08,720
get to do that strike

141
00:05:08,720 --> 00:05:11,039
we also get hit bet but

142
00:05:11,039 --> 00:05:12,720
head back but it's important to

143
00:05:12,720 --> 00:05:14,560
understand that the whole purpose is to

144
00:05:14,560 --> 00:05:17,039
improve the blue team

145
00:05:17,039 --> 00:05:19,759
and you can resemble this with sort of a

146
00:05:19,759 --> 00:05:21,280
sparring match

147
00:05:21,280 --> 00:05:23,759
it's core value of a company it's not

148
00:05:23,759 --> 00:05:26,479
that we want to come along

149
00:05:26,479 --> 00:05:28,880
smash the opponent down get the goal run

150
00:05:28,880 --> 00:05:30,560
away and start laughing no it's about

151
00:05:30,560 --> 00:05:32,240
improving both in operation as well as

152
00:05:32,240 --> 00:05:36,000
in documentation reporting afterwards

153
00:05:36,400 --> 00:05:39,360
think of boxing this is how our boxing

154
00:05:39,360 --> 00:05:41,120
ring looks like

155
00:05:41,120 --> 00:05:42,720
it's a lot of stuff in there i want to

156
00:05:42,720 --> 00:05:44,880
give you an overview of how our

157
00:05:44,880 --> 00:05:46,800
offensive infrastructure looks like

158
00:05:46,800 --> 00:05:49,759
during one typical operation

159
00:05:49,759 --> 00:05:51,360
and we have multiple operations running

160
00:05:51,360 --> 00:05:53,199
in parallel just to give you an idea we

161
00:05:53,199 --> 00:05:54,880
have multiple command and control

162
00:05:54,880 --> 00:05:57,199
servers coupled together with multiple

163
00:05:57,199 --> 00:05:59,680
redirectors or reverse proxies something

164
00:05:59,680 --> 00:06:03,039
in between to hide rc2 server we make

165
00:06:03,039 --> 00:06:04,800
use of domain fronting all the time we

166
00:06:04,800 --> 00:06:07,039
create lots of fake identities

167
00:06:07,039 --> 00:06:09,280
multiple different websites we create

168
00:06:09,280 --> 00:06:11,840
we track with pixels everything every

169
00:06:11,840 --> 00:06:13,680
email send out every action sent to the

170
00:06:13,680 --> 00:06:15,520
to to our target

171
00:06:15,520 --> 00:06:17,360
all kinds of different web servers

172
00:06:17,360 --> 00:06:19,360
different delivery methods

173
00:06:19,360 --> 00:06:20,880
and there are some back-end systems as

174
00:06:20,880 --> 00:06:21,680
well

175
00:06:21,680 --> 00:06:24,960
one operation roughly 30 infrastructure

176
00:06:24,960 --> 00:06:26,880
components

177
00:06:26,880 --> 00:06:28,960
multiple operations parallel

178
00:06:28,960 --> 00:06:30,639
this is becoming a problem in that sense

179
00:06:30,639 --> 00:06:33,440
so we have lots of data to get track of

180
00:06:33,440 --> 00:06:36,440
now let's jump back to

181
00:06:36,440 --> 00:06:38,080
2018

182
00:06:38,080 --> 00:06:40,639
when we released a tool called red elk

183
00:06:40,639 --> 00:06:42,639
red being offensive elk standing for

184
00:06:42,639 --> 00:06:46,240
elasticsearch logstash kibana

185
00:06:46,240 --> 00:06:48,720
this was presented in 2019 as well here

186
00:06:48,720 --> 00:06:50,319
in hacker in paris i want to give you a

187
00:06:50,319 --> 00:06:52,560
quick overview of what the old tool or

188
00:06:52,560 --> 00:06:55,440
the old concept actually looks like

189
00:06:55,440 --> 00:06:56,720
we have typical challenges and the

190
00:06:56,720 --> 00:06:58,720
typical challenges can be divided on two

191
00:06:58,720 --> 00:07:00,560
aspects we're having difficulty with

192
00:07:00,560 --> 00:07:02,240
having oversight and difficulty with

193
00:07:02,240 --> 00:07:06,160
having insight oversight as in

194
00:07:06,160 --> 00:07:09,360
30 components per operation multiple in

195
00:07:09,360 --> 00:07:11,919
parallel it's just too much in that

196
00:07:11,919 --> 00:07:14,639
sense to keep track of every operational

197
00:07:14,639 --> 00:07:17,199
infrastructure component

198
00:07:17,199 --> 00:07:19,120
if you look at

199
00:07:19,120 --> 00:07:21,280
analogy would be to we're having

200
00:07:21,280 --> 00:07:23,360
difficulty managing the herd of

201
00:07:23,360 --> 00:07:26,400
infrastructure components

202
00:07:26,479 --> 00:07:29,120
and if we have so many sensors out there

203
00:07:29,120 --> 00:07:31,599
on the internet part of operation

204
00:07:31,599 --> 00:07:34,160
scans gone by but also blue teams start

205
00:07:34,160 --> 00:07:36,319
poking at our infrastructure

206
00:07:36,319 --> 00:07:37,919
and this is where i want to introduce to

207
00:07:37,919 --> 00:07:41,919
you mr edmund lukach a french forensic

208
00:07:41,919 --> 00:07:43,520
science a person back in the 19th

209
00:07:43,520 --> 00:07:46,400
century he introduced forensic science

210
00:07:46,400 --> 00:07:48,240
and he is most known for his adagio

211
00:07:48,240 --> 00:07:50,960
called every contact leaves a trace the

212
00:07:50,960 --> 00:07:54,239
luca exchange principle

213
00:07:55,039 --> 00:07:57,360
if we have so many sensors out there on

214
00:07:57,360 --> 00:07:59,599
the internet part of our operation and

215
00:07:59,599 --> 00:08:02,010
it's technically impossible to

216
00:08:02,010 --> 00:08:03,199
[Music]

217
00:08:03,199 --> 00:08:06,000
do a contact to well on a crime scene

218
00:08:06,000 --> 00:08:08,560
but as well as on a

219
00:08:08,560 --> 00:08:11,199
technical operation

220
00:08:11,199 --> 00:08:13,840
it's impossible to not leave a trace so

221
00:08:13,840 --> 00:08:16,800
that goes both ways we as offensive

222
00:08:16,800 --> 00:08:19,280
red team as we try to hack into

223
00:08:19,280 --> 00:08:20,479
a network

224
00:08:20,479 --> 00:08:22,479
we cannot touch those systems without

225
00:08:22,479 --> 00:08:24,319
leaving a trace and that's why blue gets

226
00:08:24,319 --> 00:08:26,400
triggered and tried to find us and do

227
00:08:26,400 --> 00:08:27,360
stuff

228
00:08:27,360 --> 00:08:28,800
get us out of there

229
00:08:28,800 --> 00:08:30,560
the same thing applies the other way

230
00:08:30,560 --> 00:08:33,039
around as well as soon as blue starts

231
00:08:33,039 --> 00:08:34,320
investigating

232
00:08:34,320 --> 00:08:36,080
they interact with systems they interact

233
00:08:36,080 --> 00:08:37,760
with our infrastructure and they will

234
00:08:37,760 --> 00:08:39,440
leave traces

235
00:08:39,440 --> 00:08:42,479
so this is where we start thinking well

236
00:08:42,479 --> 00:08:44,640
is there a way to have better oversight

237
00:08:44,640 --> 00:08:46,720
over systems and have better insight on

238
00:08:46,720 --> 00:08:49,680
what blue is doing during our operation

239
00:08:49,680 --> 00:08:51,839
we are in that sparring match we want to

240
00:08:51,839 --> 00:08:54,560
see that punch from blue coming before

241
00:08:54,560 --> 00:08:56,800
it's actually on our face we want to be

242
00:08:56,800 --> 00:08:58,800
one step ahead

243
00:08:58,800 --> 00:09:00,880
we looked at the public uh code

244
00:09:00,880 --> 00:09:02,480
repository there was nothing like that

245
00:09:02,480 --> 00:09:04,240
we need something to manage to hurt we

246
00:09:04,240 --> 00:09:06,320
need need something to get insight into

247
00:09:06,320 --> 00:09:07,839
what's happening this is where we create

248
00:09:07,839 --> 00:09:09,440
a red elk there are multiple links in

249
00:09:09,440 --> 00:09:10,640
the slides where you can get the

250
00:09:10,640 --> 00:09:13,600
background information

251
00:09:13,600 --> 00:09:14,959
on a more

252
00:09:14,959 --> 00:09:16,959
architectural overview

253
00:09:16,959 --> 00:09:19,360
just to give you an idea where red elk

254
00:09:19,360 --> 00:09:21,680
actually fits into our operation on the

255
00:09:21,680 --> 00:09:24,720
left you see the target implant on the

256
00:09:24,720 --> 00:09:26,720
target network

257
00:09:26,720 --> 00:09:29,040
normal operation it connects back to our

258
00:09:29,040 --> 00:09:31,760
c2 servers via redirectors or reverse

259
00:09:31,760 --> 00:09:34,959
proxies and stuff like that

260
00:09:35,600 --> 00:09:38,880
let me try this one again

261
00:09:39,600 --> 00:09:42,240
simply doesn't work okay

262
00:09:42,240 --> 00:09:44,640
this is where red dot fits in uh it's an

263
00:09:44,640 --> 00:09:46,720
elastic search log stash kibana it has

264
00:09:46,720 --> 00:09:48,560
all kinds of data indexes it does

265
00:09:48,560 --> 00:09:50,000
enrichment of all kinds of data it

266
00:09:50,000 --> 00:09:52,399
allows you to do searching it has fancy

267
00:09:52,399 --> 00:09:53,600
dashboards

268
00:09:53,600 --> 00:09:55,920
it gets a day it's data from all kinds

269
00:09:55,920 --> 00:09:59,120
of data feeds coming from redirectors

270
00:09:59,120 --> 00:10:01,360
traffic data and both the c2 servers

271
00:10:01,360 --> 00:10:04,079
operational red teaming

272
00:10:04,079 --> 00:10:05,440
data

273
00:10:05,440 --> 00:10:08,079
and also copies stuff like

274
00:10:08,079 --> 00:10:10,000
screenshots

275
00:10:10,000 --> 00:10:11,839
collected downloads from all kinds of c2

276
00:10:11,839 --> 00:10:15,440
servers and still things like that

277
00:10:16,079 --> 00:10:17,360
it allows the white team and the red

278
00:10:17,360 --> 00:10:19,920
team to do easy searching with there

279
00:10:19,920 --> 00:10:20,959
and

280
00:10:20,959 --> 00:10:22,480
this is where the fun happens as soon as

281
00:10:22,480 --> 00:10:25,120
the target blue team starts to do some

282
00:10:25,120 --> 00:10:27,519
type of investigation

283
00:10:27,519 --> 00:10:28,720
um

284
00:10:28,720 --> 00:10:30,800
things happen they cannot interact

285
00:10:30,800 --> 00:10:33,360
without leaving traces so they start

286
00:10:33,360 --> 00:10:35,440
interacting with our redirectors from

287
00:10:35,440 --> 00:10:37,519
their point of view the implant connects

288
00:10:37,519 --> 00:10:39,440
back to a specific ip address or a

289
00:10:39,440 --> 00:10:41,200
domain name and they start investigating

290
00:10:41,200 --> 00:10:42,480
in there

291
00:10:42,480 --> 00:10:44,000
if you have insight into that

292
00:10:44,000 --> 00:10:46,480
operational traffic data you get the

293
00:10:46,480 --> 00:10:49,680
same type of information as well

294
00:10:49,680 --> 00:10:51,680
they also make use of

295
00:10:51,680 --> 00:10:53,200
public

296
00:10:53,200 --> 00:10:55,760
threat scanning security sources

297
00:10:55,760 --> 00:10:57,680
security service providers spamhouse

298
00:10:57,680 --> 00:11:01,120
virus.org ibm x4 is domain classifiers

299
00:11:01,120 --> 00:11:02,880
all kinds of

300
00:11:02,880 --> 00:11:04,959
publicly available security vendors that

301
00:11:04,959 --> 00:11:07,519
give you ratings about fb addresses and

302
00:11:07,519 --> 00:11:09,200
all kinds of other stuff

303
00:11:09,200 --> 00:11:11,120
the funny thing is again every contact

304
00:11:11,120 --> 00:11:12,800
lease it trace those security service

305
00:11:12,800 --> 00:11:15,279
providers get that data by querying our

306
00:11:15,279 --> 00:11:18,720
infrastructure so when we know

307
00:11:18,720 --> 00:11:20,399
a traffic that

308
00:11:20,399 --> 00:11:22,399
some virus total things are happening on

309
00:11:22,399 --> 00:11:24,800
our great characters or ibm exports is

310
00:11:24,800 --> 00:11:26,560
again scanning our infrastructure and if

311
00:11:26,560 --> 00:11:28,000
you have the possibility to have that

312
00:11:28,000 --> 00:11:29,680
insight

313
00:11:29,680 --> 00:11:32,320
you're one step ahead

314
00:11:32,320 --> 00:11:33,680
that's where the whole scene

315
00:11:33,680 --> 00:11:35,600
functionality comes into play so we

316
00:11:35,600 --> 00:11:37,600
query those security service providers

317
00:11:37,600 --> 00:11:39,279
we gather the data from all kinds of

318
00:11:39,279 --> 00:11:41,680
free director traffic data etc etc and

319
00:11:41,680 --> 00:11:42,880
this is where

320
00:11:42,880 --> 00:11:45,680
we are one step ahead

321
00:11:45,680 --> 00:11:47,440
allow me to

322
00:11:47,440 --> 00:11:51,839
switch just to a different screen

323
00:11:54,399 --> 00:11:55,279
yeah

324
00:11:55,279 --> 00:11:56,959
you might wonder why is it so important

325
00:11:56,959 --> 00:11:58,399
to have all this data in a red team

326
00:11:58,399 --> 00:11:59,440
operation

327
00:11:59,440 --> 00:12:02,399
on one hand uh an attacker gets better

328
00:12:02,399 --> 00:12:03,760
when he knows everything that's

329
00:12:03,760 --> 00:12:05,440
happening on his own infrastructure so

330
00:12:05,440 --> 00:12:07,279
you can adjust to what the blue team

331
00:12:07,279 --> 00:12:09,519
does and how to respond to you but also

332
00:12:09,519 --> 00:12:11,279
as said we're trying to service our

333
00:12:11,279 --> 00:12:12,639
clients we want to make the blue team

334
00:12:12,639 --> 00:12:14,959
better so also from a consulting point

335
00:12:14,959 --> 00:12:16,959
of view it's very important to have this

336
00:12:16,959 --> 00:12:19,040
data so quite often we can phone the

337
00:12:19,040 --> 00:12:21,519
customer meaning the board member that

338
00:12:21,519 --> 00:12:24,079
gave us the assignment and tell them we

339
00:12:24,079 --> 00:12:26,240
think your blue team is on to something

340
00:12:26,240 --> 00:12:28,160
and if they dig hard enough they might

341
00:12:28,160 --> 00:12:30,399
find us now within a few hours

342
00:12:30,399 --> 00:12:32,000
so even if we

343
00:12:32,000 --> 00:12:33,680
deliberately

344
00:12:33,680 --> 00:12:35,839
expose ourselves to being found we can

345
00:12:35,839 --> 00:12:38,639
still manage when and how we are found

346
00:12:38,639 --> 00:12:41,120
and inform the customer even before the

347
00:12:41,120 --> 00:12:43,200
red the blue team really escalates that

348
00:12:43,200 --> 00:12:45,760
an attack is going on which helps us to

349
00:12:45,760 --> 00:12:47,680
optimize the exercise we're doing with

350
00:12:47,680 --> 00:12:50,240
that with that client

351
00:12:50,240 --> 00:12:52,480
exactly yeah what you're looking at here

352
00:12:52,480 --> 00:12:54,959
is the kibana graphical interface over

353
00:12:54,959 --> 00:12:56,560
red elk instance

354
00:12:56,560 --> 00:12:58,560
and it has a dashboard view and it has

355
00:12:58,560 --> 00:13:00,880
as well a discover view i will first

356
00:13:00,880 --> 00:13:02,000
talk a little bit about the dashboard

357
00:13:02,000 --> 00:13:04,160
view it gives you in one oversight

358
00:13:04,160 --> 00:13:05,440
a proper

359
00:13:05,440 --> 00:13:06,959
oversight of the entire operation like

360
00:13:06,959 --> 00:13:08,880
the amount of unique hosts you've got

361
00:13:08,880 --> 00:13:11,200
beacons on the the hosting the systems

362
00:13:11,200 --> 00:13:13,600
the entire uh period of operations all

363
00:13:13,600 --> 00:13:16,240
kinds of different

364
00:13:16,320 --> 00:13:18,240
primary data that might be of interest

365
00:13:18,240 --> 00:13:20,000
um

366
00:13:20,000 --> 00:13:22,639
i talked about all kinds of alarms stuff

367
00:13:22,639 --> 00:13:23,519
um

368
00:13:23,519 --> 00:13:25,839
if i click on this area it will

369
00:13:25,839 --> 00:13:28,160
give you an overview of the alarms that

370
00:13:28,160 --> 00:13:30,480
somehow get generated and those alarms

371
00:13:30,480 --> 00:13:31,440
could be

372
00:13:31,440 --> 00:13:34,639
as you see right here

373
00:13:35,760 --> 00:13:37,279
maybe just a little text a little bit

374
00:13:37,279 --> 00:13:38,480
bigger

375
00:13:38,480 --> 00:13:41,040
we're talking about traffic alarms ip

376
00:13:41,040 --> 00:13:42,560
addresses over time hitting your

377
00:13:42,560 --> 00:13:45,199
infrastructure

378
00:13:45,600 --> 00:13:47,920
it also talks about different files or

379
00:13:47,920 --> 00:13:51,279
different services which have a md5 hash

380
00:13:51,279 --> 00:13:53,279
and that md5 hash got queried by

381
00:13:53,279 --> 00:13:55,839
virustotal and virustotal or hybrid

382
00:13:55,839 --> 00:13:58,399
analysis said well yes i am aware of

383
00:13:58,399 --> 00:14:00,839
this hash if this hash is known by

384
00:14:00,839 --> 00:14:03,680
virustotal and that hash is specific to

385
00:14:03,680 --> 00:14:05,600
our operation and we did not upload it

386
00:14:05,600 --> 00:14:08,639
to virustotal guess who uploaded that

387
00:14:08,639 --> 00:14:11,440
specific file well the target did so a

388
00:14:11,440 --> 00:14:14,959
pretty big alarm that something went on

389
00:14:14,959 --> 00:14:16,720
there's also other type of data

390
00:14:16,720 --> 00:14:18,240
regarding your

391
00:14:18,240 --> 00:14:19,760
reader vector the traffic or the

392
00:14:19,760 --> 00:14:21,120
different ip address that are accessing

393
00:14:21,120 --> 00:14:22,959
your infrastructure if you provide the

394
00:14:22,959 --> 00:14:25,040
configuration to a network of all the

395
00:14:25,040 --> 00:14:27,120
known ip addresses that are allowed to

396
00:14:27,120 --> 00:14:28,639
connect to the

397
00:14:28,639 --> 00:14:31,040
actual redirector infrastructure

398
00:14:31,040 --> 00:14:34,560
and allowed to go to the sea to back end

399
00:14:34,560 --> 00:14:36,079
all of a sudden a different ip address

400
00:14:36,079 --> 00:14:38,160
comes in you get an alarm and you can

401
00:14:38,160 --> 00:14:39,760
even deflect the traffic still on your

402
00:14:39,760 --> 00:14:41,920
redirector but you still get the alarm

403
00:14:41,920 --> 00:14:43,519
giving you a heads up in that in that

404
00:14:43,519 --> 00:14:46,160
battle so you have to see that the url

405
00:14:46,160 --> 00:14:48,000
our implants talk to is really unique no

406
00:14:48,000 --> 00:14:49,760
one can guess that it's only the implant

407
00:14:49,760 --> 00:14:51,839
that knows this url and when we start

408
00:14:51,839 --> 00:14:53,040
our engagement

409
00:14:53,040 --> 00:14:54,959
any ip address is allowed to talk to our

410
00:14:54,959 --> 00:14:56,800
infrastructure and as soon as we

411
00:14:56,800 --> 00:14:58,959
determine it's indeed the laptop of the

412
00:14:58,959 --> 00:15:00,720
victim of the client

413
00:15:00,720 --> 00:15:02,800
we will narrow down the ip scope that is

414
00:15:02,800 --> 00:15:04,480
allowed to talk to our infrastructure

415
00:15:04,480 --> 00:15:06,079
and being allowed in

416
00:15:06,079 --> 00:15:07,680
and then if we certainly see the same

417
00:15:07,680 --> 00:15:09,600
query from a total different area in the

418
00:15:09,600 --> 00:15:12,000
world to our infrastructure that only

419
00:15:12,000 --> 00:15:13,839
the victim can know it's pretty clear

420
00:15:13,839 --> 00:15:15,920
that some investigation is going on an

421
00:15:15,920 --> 00:15:18,079
alarm is raised here and if we deem it

422
00:15:18,079 --> 00:15:19,839
important enough we usually also

423
00:15:19,839 --> 00:15:22,160
configure that we get an email stating

424
00:15:22,160 --> 00:15:25,120
that in our inbox saying hey your your

425
00:15:25,120 --> 00:15:27,920
operation might be compromised act now

426
00:15:27,920 --> 00:15:30,079
and then we can choose sometimes we

427
00:15:30,079 --> 00:15:32,880
choose to disappear so make a new c2

428
00:15:32,880 --> 00:15:34,800
framework if the

429
00:15:34,800 --> 00:15:37,040
customer wants us to play an aggressive

430
00:15:37,040 --> 00:15:38,959
but very sophisticated game that's what

431
00:15:38,959 --> 00:15:40,880
we'll do we'll just make that c2 channel

432
00:15:40,880 --> 00:15:42,880
drop that and move to the next and we're

433
00:15:42,880 --> 00:15:44,560
still in the game

434
00:15:44,560 --> 00:15:46,320
but also we have often customers say

435
00:15:46,320 --> 00:15:47,680
i'll let them investigate let them play

436
00:15:47,680 --> 00:15:49,759
around with it for three four days and

437
00:15:49,759 --> 00:15:51,920
then we'll reveal that a red team is

438
00:15:51,920 --> 00:15:54,079
going on so it really gives us the steer

439
00:15:54,079 --> 00:15:56,000
in the operation on how we want to

440
00:15:56,000 --> 00:15:57,839
proceed with this with this attack and

441
00:15:57,839 --> 00:15:58,560
this

442
00:15:58,560 --> 00:16:01,040
this test

443
00:16:01,040 --> 00:16:03,040
i switched to a different view no longer

444
00:16:03,040 --> 00:16:05,040
dashboard this is the straight discover

445
00:16:05,040 --> 00:16:06,560
interface of kibana and what you're

446
00:16:06,560 --> 00:16:08,800
looking at right here is what they call

447
00:16:08,800 --> 00:16:11,120
the redirector traffic index and right

448
00:16:11,120 --> 00:16:14,079
here i have filtered on a specific url

449
00:16:14,079 --> 00:16:16,560
which was in our case for this example

450
00:16:16,560 --> 00:16:18,959
this specific url the training beacon

451
00:16:18,959 --> 00:16:21,199
and i have focused on a specific attack

452
00:16:21,199 --> 00:16:23,120
scenario during an operation we have

453
00:16:23,120 --> 00:16:24,959
multiple scenarios running on parallel

454
00:16:24,959 --> 00:16:27,600
this one is called dump to 12.

455
00:16:27,600 --> 00:16:29,120
so you see that filtered in here there's

456
00:16:29,120 --> 00:16:30,079
a pretty

457
00:16:30,079 --> 00:16:32,399
standard view you can open up such

458
00:16:32,399 --> 00:16:34,800
events and in there i just gonna gloss

459
00:16:34,800 --> 00:16:36,160
over this just to give you an idea on

460
00:16:36,160 --> 00:16:38,399
the enrichment that we do for example

461
00:16:38,399 --> 00:16:41,120
because we configured our directors to

462
00:16:41,120 --> 00:16:43,440
put in extra data in there we have for

463
00:16:43,440 --> 00:16:45,759
example all kinds of header information

464
00:16:45,759 --> 00:16:47,680
and we extract the user agent we extract

465
00:16:47,680 --> 00:16:50,800
the exported four we extract the status

466
00:16:50,800 --> 00:16:52,959
codes all kinds of different extra

467
00:16:52,959 --> 00:16:55,040
information that gives us

468
00:16:55,040 --> 00:16:57,120
more things to

469
00:16:57,120 --> 00:17:00,880
act on so let's say we could exclude all

470
00:17:00,880 --> 00:17:02,880
the user agents which are specifically

471
00:17:02,880 --> 00:17:05,199
this it's a simple interface i just hit

472
00:17:05,199 --> 00:17:07,919
the minus mark it does re querying and

473
00:17:07,919 --> 00:17:09,599
all of a sudden i see

474
00:17:09,599 --> 00:17:12,480
all kinds of other implants or other

475
00:17:12,480 --> 00:17:14,799
systems that were connecting to the

476
00:17:14,799 --> 00:17:18,079
same url and the same attack scenario

477
00:17:18,079 --> 00:17:19,919
with a different user agent and it

478
00:17:19,919 --> 00:17:21,280
becomes interesting because all of a

479
00:17:21,280 --> 00:17:22,559
sudden we have different source of view

480
00:17:22,559 --> 00:17:23,520
addresses

481
00:17:23,520 --> 00:17:25,359
this is more manual searching but it

482
00:17:25,359 --> 00:17:27,520
does give you oversight if you have 10

483
00:17:27,520 --> 00:17:29,520
different infrastructure traffic

484
00:17:29,520 --> 00:17:31,679
components one central interface to see

485
00:17:31,679 --> 00:17:33,679
what is going on

486
00:17:33,679 --> 00:17:35,520
there are multiple different views in

487
00:17:35,520 --> 00:17:37,360
here i'm switching to what the what we

488
00:17:37,360 --> 00:17:39,600
call the red team operations index and

489
00:17:39,600 --> 00:17:40,559
i've

490
00:17:40,559 --> 00:17:43,520
exfiltrated or filtered out some types

491
00:17:43,520 --> 00:17:45,200
of information i just want to give you a

492
00:17:45,200 --> 00:17:48,080
quick overview in here let's open this

493
00:17:48,080 --> 00:17:50,320
event again it says an attack scenario

494
00:17:50,320 --> 00:17:51,440
it

495
00:17:51,440 --> 00:17:54,240
tells you for this specific implant

496
00:17:54,240 --> 00:17:57,360
traffic uh it is for this username with

497
00:17:57,360 --> 00:17:59,120
this host name and this was the actual

498
00:17:59,120 --> 00:18:01,039
output of the message

499
00:18:01,039 --> 00:18:03,039
scrolling just a little bit it tells us

500
00:18:03,039 --> 00:18:04,799
in this case that the c2 program is

501
00:18:04,799 --> 00:18:06,720
cobalt strike and this was the output

502
00:18:06,720 --> 00:18:09,760
that the implant gave back at that time

503
00:18:09,760 --> 00:18:11,520
if i scroll down a bit there is more

504
00:18:11,520 --> 00:18:13,840
type of information shared here the

505
00:18:13,840 --> 00:18:15,360
external ip address

506
00:18:15,360 --> 00:18:17,760
guip information enriched from there it

507
00:18:17,760 --> 00:18:20,400
has all kinds of information about the

508
00:18:20,400 --> 00:18:22,880
windows version all data that is within

509
00:18:22,880 --> 00:18:24,960
the logging of your c2

510
00:18:24,960 --> 00:18:27,440
framework

511
00:18:27,679 --> 00:18:30,799
quick oversight there are multiple views

512
00:18:30,799 --> 00:18:33,360
but sometimes you just want to have easy

513
00:18:33,360 --> 00:18:36,000
access to the full

514
00:18:36,000 --> 00:18:37,760
implant log file that's why there's an

515
00:18:37,760 --> 00:18:39,360
easy

516
00:18:39,360 --> 00:18:41,760
direct link to the full log and here you

517
00:18:41,760 --> 00:18:44,080
have i'm not asking you to try to read

518
00:18:44,080 --> 00:18:46,480
this but it shows you the raw

519
00:18:46,480 --> 00:18:48,720
beacon log file and here on you can just

520
00:18:48,720 --> 00:18:49,679
hit

521
00:18:49,679 --> 00:18:51,919
your typical control f and you can

522
00:18:51,919 --> 00:18:53,200
search to the specific thing that you

523
00:18:53,200 --> 00:18:54,960
want within you this output by the way

524
00:18:54,960 --> 00:18:57,600
is a cobbled strike implant i guess i

525
00:18:57,600 --> 00:18:59,280
hope most of you are familiar with

526
00:18:59,280 --> 00:19:01,760
cobbled strike as a red teaming tool

527
00:19:01,760 --> 00:19:02,720
uh

528
00:19:02,720 --> 00:19:04,080
either though the gui is quite

529
00:19:04,080 --> 00:19:06,960
responsive searching back in data for a

530
00:19:06,960 --> 00:19:09,360
command that you commissioned

531
00:19:09,360 --> 00:19:11,679
eight hours ago or even days before

532
00:19:11,679 --> 00:19:13,760
usually as a hell so as a red team

533
00:19:13,760 --> 00:19:15,679
operator we're also working in red elk

534
00:19:15,679 --> 00:19:18,080
constantly during our gigs because why

535
00:19:18,080 --> 00:19:19,440
execute a command if you already

536
00:19:19,440 --> 00:19:21,120
executed the same command yesterday you

537
00:19:21,120 --> 00:19:23,440
can simply look it up

538
00:19:23,440 --> 00:19:25,039
we used this

539
00:19:25,039 --> 00:19:27,440
google-like interface pretty easily

540
00:19:27,440 --> 00:19:30,320
i do not know if which specific beacon i

541
00:19:30,320 --> 00:19:32,480
entered that specific command was the

542
00:19:32,480 --> 00:19:34,960
abc or one of the other 20 beacons this

543
00:19:34,960 --> 00:19:37,919
is one centralized view simple quick

544
00:19:37,919 --> 00:19:39,280
query style

545
00:19:39,280 --> 00:19:40,960
there's a few more

546
00:19:40,960 --> 00:19:43,440
different types of views in here easy to

547
00:19:43,440 --> 00:19:44,320
use

548
00:19:44,320 --> 00:19:46,480
it's a quick overview of all kinds of c2

549
00:19:46,480 --> 00:19:48,799
credentials all downloads all specific

550
00:19:48,799 --> 00:19:51,360
iocs you go to that you click the

551
00:19:51,360 --> 00:19:53,200
download generate report and you get a

552
00:19:53,200 --> 00:19:55,120
full overview of all the iocs of your

553
00:19:55,120 --> 00:19:58,400
operation screenshots keystrokes all

554
00:19:58,400 --> 00:20:01,280
kinds of as well as what we call signals

555
00:20:01,280 --> 00:20:03,440
and here it gathers the specific

556
00:20:03,440 --> 00:20:05,760
attack miter attack t numbers that you

557
00:20:05,760 --> 00:20:07,280
can plot into a

558
00:20:07,280 --> 00:20:09,600
navigator interface and tell your blue

559
00:20:09,600 --> 00:20:13,520
team or your wide team what was going on

560
00:20:13,520 --> 00:20:16,080
nothing new here this is default tooling

561
00:20:16,080 --> 00:20:21,000
that was existing for quite some time

562
00:20:22,240 --> 00:20:24,640
indicator of investigations is how we

563
00:20:24,640 --> 00:20:26,640
like to call them let's say if we make a

564
00:20:26,640 --> 00:20:29,280
division between the direct actions to

565
00:20:29,280 --> 00:20:31,440
our infrastructure we can easily get

566
00:20:31,440 --> 00:20:32,880
alarms for

567
00:20:32,880 --> 00:20:35,360
let's say rogue user agents blue teamers

568
00:20:35,360 --> 00:20:37,440
using curl or python command line stuff

569
00:20:37,440 --> 00:20:40,000
to investigate our infrastructure

570
00:20:40,000 --> 00:20:42,799
boom immediate uh alarms if that if that

571
00:20:42,799 --> 00:20:44,880
happens rock rp addresses like already

572
00:20:44,880 --> 00:20:47,120
mentioned deflected traffic if you have

573
00:20:47,120 --> 00:20:49,840
your redirector with some smart uh

574
00:20:49,840 --> 00:20:52,000
logic in there deflecting to a certain

575
00:20:52,000 --> 00:20:53,840
endpoint with an alarm tag in there you

576
00:20:53,840 --> 00:20:55,440
get an automatic alarm

577
00:20:55,440 --> 00:20:57,440
and if you have a range of known ip

578
00:20:57,440 --> 00:20:59,520
addresses of blue teams you can put it

579
00:20:59,520 --> 00:21:01,840
in there any action coming from known

580
00:21:01,840 --> 00:21:04,559
blue ip addresses is immediate alarm

581
00:21:04,559 --> 00:21:07,120
stuff worthy

582
00:21:07,120 --> 00:21:09,360
indirect more talking about security

583
00:21:09,360 --> 00:21:10,880
service providers let's say the

584
00:21:10,880 --> 00:21:12,799
anti-virus hash or the nd5 azure for

585
00:21:12,799 --> 00:21:15,200
file but also blacklisting of ip

586
00:21:15,200 --> 00:21:17,120
addresses of our infrastructure and

587
00:21:17,120 --> 00:21:19,200
domain classifications if it changes

588
00:21:19,200 --> 00:21:21,280
things like that immediate alarms this

589
00:21:21,280 --> 00:21:25,520
is basic seem like functionality

590
00:21:26,240 --> 00:21:28,400
i see we missed with three minutes so

591
00:21:28,400 --> 00:21:30,960
the timing

592
00:21:30,960 --> 00:21:32,240
awesome

593
00:21:32,240 --> 00:21:33,919
yeah let's go back to the the current

594
00:21:33,919 --> 00:21:36,480
time we made some additions to redder

595
00:21:36,480 --> 00:21:37,840
because well

596
00:21:37,840 --> 00:21:39,600
we started thinking if we've been using

597
00:21:39,600 --> 00:21:41,520
this in operation

598
00:21:41,520 --> 00:21:45,600
with happiness um we're using it to give

599
00:21:45,600 --> 00:21:46,799
better

600
00:21:46,799 --> 00:21:49,120
oversight and better insight

601
00:21:49,120 --> 00:21:50,799
we want to have we want to optimize

602
00:21:50,799 --> 00:21:52,640
operation and we want to do more stuff

603
00:21:52,640 --> 00:21:55,440
to detect blue let's look at how blue

604
00:21:55,440 --> 00:21:57,600
has evolved over the last few years and

605
00:21:57,600 --> 00:21:59,679
if you look at how blue teams operate or

606
00:21:59,679 --> 00:22:01,200
sock or whatever

607
00:22:01,200 --> 00:22:04,480
they generally progress over two main

608
00:22:04,480 --> 00:22:06,000
access one

609
00:22:06,000 --> 00:22:09,919
more data just connect more data sources

610
00:22:09,919 --> 00:22:12,159
more is better is bigger it's it's all

611
00:22:12,159 --> 00:22:13,760
good maybe some something to mention

612
00:22:13,760 --> 00:22:15,120
there are there any blue team is in the

613
00:22:15,120 --> 00:22:16,400
room here

614
00:22:16,400 --> 00:22:17,360
of course

615
00:22:17,360 --> 00:22:19,840
yeah i must say that that i'm surprised

616
00:22:19,840 --> 00:22:21,760
with how aggressively and fast the blue

617
00:22:21,760 --> 00:22:23,760
teams have progressed over the last few

618
00:22:23,760 --> 00:22:26,400
years so kudos for that it's really

619
00:22:26,400 --> 00:22:27,919
going fast and

620
00:22:27,919 --> 00:22:30,080
making our operations and

621
00:22:30,080 --> 00:22:32,000
actions and the criminals actions a lot

622
00:22:32,000 --> 00:22:33,600
harder which of course is the goal in

623
00:22:33,600 --> 00:22:36,080
the end for the blue team so

624
00:22:36,080 --> 00:22:37,200
um

625
00:22:37,200 --> 00:22:38,960
you can call it detection engineering

626
00:22:38,960 --> 00:22:40,400
threat detection whatever just

627
00:22:40,400 --> 00:22:42,400
connecting more data sources it's easy

628
00:22:42,400 --> 00:22:44,720
for us with the redoc concept

629
00:22:44,720 --> 00:22:46,320
another area what's really interesting

630
00:22:46,320 --> 00:22:47,919
is what they call threat hunting a more

631
00:22:47,919 --> 00:22:50,480
of a hypothesis based approach to catch

632
00:22:50,480 --> 00:22:52,640
well known attackers that somehow

633
00:22:52,640 --> 00:22:55,679
slipped through current defenses

634
00:22:55,679 --> 00:22:57,520
it's a bit more free format search you

635
00:22:57,520 --> 00:22:59,280
require different tools if you put it

636
00:22:59,280 --> 00:23:00,880
into our perspective

637
00:23:00,880 --> 00:23:02,720
so that's what got us thinking

638
00:23:02,720 --> 00:23:05,280
remember this image we added a few

639
00:23:05,280 --> 00:23:07,520
things on the left side we have added

640
00:23:07,520 --> 00:23:09,280
the ability to do

641
00:23:09,280 --> 00:23:12,320
more queries on the implant side more

642
00:23:12,320 --> 00:23:14,880
queries on the inside of the attackers

643
00:23:14,880 --> 00:23:17,120
or the targets and network

644
00:23:17,120 --> 00:23:18,960
and on the right side you see two things

645
00:23:18,960 --> 00:23:22,080
neo4j allowing you to import the output

646
00:23:22,080 --> 00:23:25,200
of bloodhound for attack path

647
00:23:25,200 --> 00:23:27,360
measuring within your target

648
00:23:27,360 --> 00:23:29,679
and also jupyter notebooks allowing you

649
00:23:29,679 --> 00:23:32,400
a bit free format more searching in all

650
00:23:32,400 --> 00:23:34,480
the different data sources that are out

651
00:23:34,480 --> 00:23:36,159
there

652
00:23:36,159 --> 00:23:37,679
and that's exactly what

653
00:23:37,679 --> 00:23:39,679
mark will be telling you first before we

654
00:23:39,679 --> 00:23:41,279
move on uh

655
00:23:41,279 --> 00:23:42,640
do you does

656
00:23:42,640 --> 00:23:44,559
i want to see some hands who does not

657
00:23:44,559 --> 00:23:46,159
know bloodhound because then i'm going

658
00:23:46,159 --> 00:23:48,480
to explain what it is to keep you on

659
00:23:48,480 --> 00:23:50,400
board it's bloodhound familiar tool i

660
00:23:50,400 --> 00:23:52,640
see a few hands who is familiar with

661
00:23:52,640 --> 00:23:54,559
bloodhound then i expect to see the rest

662
00:23:54,559 --> 00:23:56,000
of the hands

663
00:23:56,000 --> 00:23:57,600
cool yeah okay gives me an impression

664
00:23:57,600 --> 00:23:59,840
i'll i'll do a very short introduction

665
00:23:59,840 --> 00:24:01,840
bloodhound is a tool developed by

666
00:24:01,840 --> 00:24:04,639
spectres ops

667
00:24:04,960 --> 00:24:06,720
what it does you drop

668
00:24:06,720 --> 00:24:08,799
some code in the customer's network and

669
00:24:08,799 --> 00:24:10,640
this code will start querying active

670
00:24:10,640 --> 00:24:12,720
directory so it will gather all data it

671
00:24:12,720 --> 00:24:16,320
can on users you have groups you have

672
00:24:16,320 --> 00:24:18,480
sessions that might be there so people

673
00:24:18,480 --> 00:24:20,559
being logged on to machines

674
00:24:20,559 --> 00:24:22,480
information on these machines themselves

675
00:24:22,480 --> 00:24:24,080
and so on and so on it gets all this

676
00:24:24,080 --> 00:24:24,960
data

677
00:24:24,960 --> 00:24:26,640
basically your whole active directory

678
00:24:26,640 --> 00:24:29,120
puts it in a database and you can ask it

679
00:24:29,120 --> 00:24:31,840
to draw a path so you can ask it i've

680
00:24:31,840 --> 00:24:34,480
got this user i want to go to domain

681
00:24:34,480 --> 00:24:37,360
admin is there a path in between

682
00:24:37,360 --> 00:24:39,520
and if there is it will say yes there is

683
00:24:39,520 --> 00:24:41,760
this user has local admin to that

684
00:24:41,760 --> 00:24:43,919
machine where there is a session of an

685
00:24:43,919 --> 00:24:46,240
admin who's also admin to this machine

686
00:24:46,240 --> 00:24:47,600
and on that machine there's a domain

687
00:24:47,600 --> 00:24:49,520
admin administrator logged in and if you

688
00:24:49,520 --> 00:24:51,679
steal his creds your domain admin so

689
00:24:51,679 --> 00:24:53,520
that's roughly what bloodhound does gets

690
00:24:53,520 --> 00:24:56,000
data and allows you to draw a path from

691
00:24:56,000 --> 00:24:57,679
point a to point b

692
00:24:57,679 --> 00:24:59,600
a different way of saying that it's

693
00:24:59,600 --> 00:25:02,240
google maps like navigation within a

694
00:25:02,240 --> 00:25:04,640
target network i'm here i want to go

695
00:25:04,640 --> 00:25:06,559
there i've got this

696
00:25:06,559 --> 00:25:08,559
information about possible routes

697
00:25:08,559 --> 00:25:09,840
just

698
00:25:09,840 --> 00:25:11,360
bring me to it

699
00:25:11,360 --> 00:25:13,840
yeah so so bloodhound there's a lot of

700
00:25:13,840 --> 00:25:16,480
data on what parts could exist or are

701
00:25:16,480 --> 00:25:18,080
existing in the network but you don't

702
00:25:18,080 --> 00:25:20,400
have the starting point yet but red elk

703
00:25:20,400 --> 00:25:21,600
on the other hand has a lot of

704
00:25:21,600 --> 00:25:22,799
information

705
00:25:22,799 --> 00:25:24,640
live during your operation every step

706
00:25:24,640 --> 00:25:27,440
you make on every command you type

707
00:25:27,440 --> 00:25:29,039
bloodhound knows about that so if we

708
00:25:29,039 --> 00:25:30,960
combine this combination you get sort of

709
00:25:30,960 --> 00:25:33,279
a golden marriage and we're trying to go

710
00:25:33,279 --> 00:25:34,720
there in a bit

711
00:25:34,720 --> 00:25:36,480
uh this would you don't have to read

712
00:25:36,480 --> 00:25:38,559
this all it's just uh in couple strikes

713
00:25:38,559 --> 00:25:41,520
someone types ps give me a process list

714
00:25:41,520 --> 00:25:44,000
and this process list shows a lot of

715
00:25:44,000 --> 00:25:47,039
processes including one of the user a

716
00:25:47,039 --> 00:25:49,200
johnson and you want to know

717
00:25:49,200 --> 00:25:52,640
does a johnson have by any means a path

718
00:25:52,640 --> 00:25:54,880
to the main admin because if he has i'm

719
00:25:54,880 --> 00:25:57,039
going to inject into that process and

720
00:25:57,039 --> 00:25:58,720
walk down the path

721
00:25:58,720 --> 00:26:00,720
and on domain admin and that's the goal

722
00:26:00,720 --> 00:26:03,120
uh where the technical red team at that

723
00:26:03,120 --> 00:26:05,279
point is so what do we do at least what

724
00:26:05,279 --> 00:26:07,039
did i do in the past and i expect most

725
00:26:07,039 --> 00:26:10,159
of you you copy and paste i i johnson

726
00:26:10,159 --> 00:26:12,559
into your bloodhound

727
00:26:12,559 --> 00:26:14,159
interface and see if there's a path and

728
00:26:14,159 --> 00:26:15,760
there might be a part that might not be

729
00:26:15,760 --> 00:26:16,960
a part

730
00:26:16,960 --> 00:26:18,960
next you'll land on a citrix machine and

731
00:26:18,960 --> 00:26:21,760
there's 25 users there does that mean

732
00:26:21,760 --> 00:26:23,200
you really have to spend the next one

733
00:26:23,200 --> 00:26:24,960
and a half hour copy and paste user

734
00:26:24,960 --> 00:26:27,679
names to see if there's a path

735
00:26:27,679 --> 00:26:29,279
from one of these processes to the main

736
00:26:29,279 --> 00:26:32,400
admin is that why we became red teamers

737
00:26:32,400 --> 00:26:34,480
we thought not

738
00:26:34,480 --> 00:26:36,320
so we decided

739
00:26:36,320 --> 00:26:38,640
as mentioned here i'm not going into the

740
00:26:38,640 --> 00:26:40,400
details there we didn't only include

741
00:26:40,400 --> 00:26:43,120
neo4j we also included jupyter notebooks

742
00:26:43,120 --> 00:26:44,320
basically

743
00:26:44,320 --> 00:26:46,000
a web interface where you can run cool

744
00:26:46,000 --> 00:26:47,840
python snippets it's way more than that

745
00:26:47,840 --> 00:26:49,200
but for this talk

746
00:26:49,200 --> 00:26:52,320
that will that will be sufficient

747
00:26:52,320 --> 00:26:54,159
so we thought let's see if we can make

748
00:26:54,159 --> 00:26:56,080
it work together so let's make red elk

749
00:26:56,080 --> 00:26:58,159
and bloodhound play together first we

750
00:26:58,159 --> 00:27:00,000
note this jupiter notebooks where we can

751
00:27:00,000 --> 00:27:02,640
write snippets of code then we write a

752
00:27:02,640 --> 00:27:04,480
small snippet of code that says connect

753
00:27:04,480 --> 00:27:07,279
to red elk and allow me to run any query

754
00:27:07,279 --> 00:27:08,720
then we write another snippet of code it

755
00:27:08,720 --> 00:27:11,440
says connect to neo4j the the graph

756
00:27:11,440 --> 00:27:13,600
database behind bloodhound and let me

757
00:27:13,600 --> 00:27:15,039
run any query

758
00:27:15,039 --> 00:27:16,799
and then you write a query

759
00:27:16,799 --> 00:27:18,240
i'm not good at writing so i'm really

760
00:27:18,240 --> 00:27:19,919
happy you cannot read this this source

761
00:27:19,919 --> 00:27:21,279
because i'm not a good developer there's

762
00:27:21,279 --> 00:27:23,360
a reason i quit that job quite early in

763
00:27:23,360 --> 00:27:24,559
my career

764
00:27:24,559 --> 00:27:26,080
but hey it works

765
00:27:26,080 --> 00:27:28,640
so first we query in red elk for all com

766
00:27:28,640 --> 00:27:31,679
all pps commands so we'll get a lot of

767
00:27:31,679 --> 00:27:33,840
lines back with every line that includes

768
00:27:33,840 --> 00:27:36,080
a ps we parse all of these lines so just

769
00:27:36,080 --> 00:27:38,240
some hacking and string cutting it up

770
00:27:38,240 --> 00:27:39,840
putting it in the table

771
00:27:39,840 --> 00:27:42,799
and once we have a very structured way

772
00:27:42,799 --> 00:27:44,720
of showing all the ps or all the

773
00:27:44,720 --> 00:27:47,039
processes in all the ps's we've done so

774
00:27:47,039 --> 00:27:49,840
far we can and for each of these lines

775
00:27:49,840 --> 00:27:52,000
for each of these processes run a query

776
00:27:52,000 --> 00:27:54,799
against bloodhound seeing is there any

777
00:27:54,799 --> 00:27:57,120
way that we might have domain already

778
00:27:57,120 --> 00:27:59,679
already a domain admin already so first

779
00:27:59,679 --> 00:28:03,440
we the first query is at a 09 94

780
00:28:03,440 --> 00:28:06,000
a johnson nothing found you move to

781
00:28:06,000 --> 00:28:07,600
another box or something changes on the

782
00:28:07,600 --> 00:28:09,520
box you run ps again and the tool for

783
00:28:09,520 --> 00:28:12,240
you will just run this this path second

784
00:28:12,240 --> 00:28:14,399
round nothing found then you move to

785
00:28:14,399 --> 00:28:17,520
another box and you find admin a johnson

786
00:28:17,520 --> 00:28:20,240
at strobe.local and voila it will alarm

787
00:28:20,240 --> 00:28:22,960
you straight away domain admin is found

788
00:28:22,960 --> 00:28:25,120
maybe with this name it's quite obvious

789
00:28:25,120 --> 00:28:27,120
but quite often you can find really

790
00:28:27,120 --> 00:28:30,159
obscure parts with bloodhounds and i

791
00:28:30,159 --> 00:28:32,480
think in 99 of the times this tool is

792
00:28:32,480 --> 00:28:35,440
way faster than us doing copy paste into

793
00:28:35,440 --> 00:28:36,480
uh

794
00:28:36,480 --> 00:28:38,159
into near 4g

795
00:28:38,159 --> 00:28:40,559
so that's one way and one addition we

796
00:28:40,559 --> 00:28:44,880
we brought to red elk

797
00:28:44,880 --> 00:28:47,200
and as said what our goal is with red

798
00:28:47,200 --> 00:28:49,120
elk is one

799
00:28:49,120 --> 00:28:51,360
to optimize our operation i think this

800
00:28:51,360 --> 00:28:54,240
was a clear example of optimization

801
00:28:54,240 --> 00:28:55,840
where you can perform your red team

802
00:28:55,840 --> 00:28:58,080
better and faster but there was another

803
00:28:58,080 --> 00:29:00,080
important thing detecting the blue team

804
00:29:00,080 --> 00:29:02,000
we want to detect whether or not the

805
00:29:02,000 --> 00:29:04,240
blue team sees us doing stuff so we can

806
00:29:04,240 --> 00:29:06,880
either adjust the course of the attack

807
00:29:06,880 --> 00:29:08,720
or we can inform the customer management

808
00:29:08,720 --> 00:29:10,880
saying they are on to something good

809
00:29:10,880 --> 00:29:12,399
that's a good learning experience what

810
00:29:12,399 --> 00:29:15,279
do we do now what do you want us to do

811
00:29:15,279 --> 00:29:17,200
so let's dive into that how can we

812
00:29:17,200 --> 00:29:20,000
detect if blue team is on to us

813
00:29:20,000 --> 00:29:22,880
one of those might be a reset of the krb

814
00:29:22,880 --> 00:29:24,159
tgt

815
00:29:24,159 --> 00:29:26,320
not necessarily we have it already had

816
00:29:26,320 --> 00:29:28,880
the the golden key of the of the domain

817
00:29:28,880 --> 00:29:30,880
controller so to say not necessarily we

818
00:29:30,880 --> 00:29:32,720
have it already but if they get nervous

819
00:29:32,720 --> 00:29:34,720
domain admins they have a tendency to

820
00:29:34,720 --> 00:29:36,559
change their own passwords and change

821
00:29:36,559 --> 00:29:38,480
the password of other important items in

822
00:29:38,480 --> 00:29:40,640
the network so if that suddenly changes

823
00:29:40,640 --> 00:29:42,880
that might be a very clear indicator

824
00:29:42,880 --> 00:29:44,640
that something's going on what you see

825
00:29:44,640 --> 00:29:46,960
here is the powershell to to request

826
00:29:46,960 --> 00:29:49,919
from the domain controller what this

827
00:29:49,919 --> 00:29:52,480
what this reset date is and we decided

828
00:29:52,480 --> 00:29:54,480
to build our own dll our own piece of c

829
00:29:54,480 --> 00:29:57,120
code that does the same thing

830
00:29:57,120 --> 00:29:58,559
through the active directory servers

831
00:29:58,559 --> 00:30:01,279
interface rc interface which is

832
00:30:01,279 --> 00:30:02,159
quite

833
00:30:02,159 --> 00:30:04,240
safe to query as it's really hard to

834
00:30:04,240 --> 00:30:07,039
detect such a query and we can ask out

835
00:30:07,039 --> 00:30:09,279
for example kbtct but also all the

836
00:30:09,279 --> 00:30:10,960
members of domain admins

837
00:30:10,960 --> 00:30:13,440
and if you have a rough idea how long

838
00:30:13,440 --> 00:30:15,279
these passwords are valid

839
00:30:15,279 --> 00:30:17,279
and if someone changes his password

840
00:30:17,279 --> 00:30:19,039
halfway that might also be a reason to

841
00:30:19,039 --> 00:30:21,200
be alert like i'm doing this move i just

842
00:30:21,200 --> 00:30:22,960
compromised this account and there's one

843
00:30:22,960 --> 00:30:25,200
admin certainly getting shaky and

844
00:30:25,200 --> 00:30:27,360
changing passwords it doesn't mean we're

845
00:30:27,360 --> 00:30:29,039
detected but at least it means we have

846
00:30:29,039 --> 00:30:32,080
to be on high alert as well

847
00:30:32,080 --> 00:30:34,080
so we wrote some some code around that

848
00:30:34,080 --> 00:30:35,440
as well

849
00:30:35,440 --> 00:30:37,840
so first we again we prepare elk we

850
00:30:37,840 --> 00:30:40,880
prepare neo4j and we download all the

851
00:30:40,880 --> 00:30:42,960
security tools that have been queried

852
00:30:42,960 --> 00:30:44,399
because you can run the

853
00:30:44,399 --> 00:30:46,080
this kind of blue checks you can run

854
00:30:46,080 --> 00:30:49,720
them all the time

855
00:30:50,399 --> 00:30:52,320
we also have a similar

856
00:30:52,320 --> 00:30:55,039
dll written not for password changes but

857
00:30:55,039 --> 00:30:58,240
for security tooling so we query

858
00:30:58,240 --> 00:30:59,440
on a system

859
00:30:59,440 --> 00:31:01,600
what kind of security tooling is is

860
00:31:01,600 --> 00:31:03,760
present usually it's an av there might

861
00:31:03,760 --> 00:31:05,840
be some some

862
00:31:05,840 --> 00:31:07,840
edr tooling presence and we take that as

863
00:31:07,840 --> 00:31:10,640
a baseline so your first query and what

864
00:31:10,640 --> 00:31:12,399
we find in the first one two or three

865
00:31:12,399 --> 00:31:14,240
hits and if they're similar we take that

866
00:31:14,240 --> 00:31:16,240
as a baseline and then we keep the code

867
00:31:16,240 --> 00:31:17,120
running

868
00:31:17,120 --> 00:31:19,360
and as soon as we see extra security

869
00:31:19,360 --> 00:31:20,960
components pop up

870
00:31:20,960 --> 00:31:24,240
then we need to raise an alarm

871
00:31:24,720 --> 00:31:25,760
trying to

872
00:31:25,760 --> 00:31:27,600
enhance the zooming just a little bit

873
00:31:27,600 --> 00:31:30,240
things like defender things like

874
00:31:30,240 --> 00:31:32,559
all kinds of cis internal tools things

875
00:31:32,559 --> 00:31:34,879
like that

876
00:31:38,960 --> 00:31:40,399
so first we uh

877
00:31:40,399 --> 00:31:42,000
the baseline we said was a system

878
00:31:42,000 --> 00:31:43,519
activity monitor and windows defender

879
00:31:43,519 --> 00:31:46,080
smart screen and over time we see

880
00:31:46,080 --> 00:31:47,360
there's nothing there's nothing new

881
00:31:47,360 --> 00:31:49,760
there and then suddenly a new tool is

882
00:31:49,760 --> 00:31:52,480
found this is internal process explorer

883
00:31:52,480 --> 00:31:54,240
and that's a reason to raise an alarm

884
00:31:54,240 --> 00:31:56,240
like saying hey we've got internal on

885
00:31:56,240 --> 00:31:57,600
the machine where you were performing

886
00:31:57,600 --> 00:31:59,760
actions the blue team might be might be

887
00:31:59,760 --> 00:32:04,000
on your tail so act accordingly

888
00:32:07,440 --> 00:32:08,880
and there's a third example which we

889
00:32:08,880 --> 00:32:10,559
haven't written out yet but we're

890
00:32:10,559 --> 00:32:11,840
working on that

891
00:32:11,840 --> 00:32:13,519
another thing we quite often see that if

892
00:32:13,519 --> 00:32:15,919
we do stupid stuff we make a mistake on

893
00:32:15,919 --> 00:32:18,559
a laptop or an end user device they tend

894
00:32:18,559 --> 00:32:20,799
to one isolate the machine so completely

895
00:32:20,799 --> 00:32:23,039
block it off or sometimes they tend to

896
00:32:23,039 --> 00:32:25,279
move the machine behind the proxy so

897
00:32:25,279 --> 00:32:27,760
they can do ssl inspection trying to

898
00:32:27,760 --> 00:32:30,399
figure out if and what kind of c2

899
00:32:30,399 --> 00:32:32,880
channel is being built to the outside

900
00:32:32,880 --> 00:32:33,919
world

901
00:32:33,919 --> 00:32:35,679
another reason might be that another

902
00:32:35,679 --> 00:32:37,039
thing might that might be that they

903
00:32:37,039 --> 00:32:38,559
won't pick the whole machine and put it

904
00:32:38,559 --> 00:32:40,480
behind a proxy but they found either our

905
00:32:40,480 --> 00:32:42,720
persistent code or the initial code we

906
00:32:42,720 --> 00:32:44,559
used and put that behind the proxy as an

907
00:32:44,559 --> 00:32:46,240
investigation

908
00:32:46,240 --> 00:32:48,159
so one of the checks is check the

909
00:32:48,159 --> 00:32:50,799
certificate so do one ping to one one uh

910
00:32:50,799 --> 00:32:53,279
do one reach out to a domain

911
00:32:53,279 --> 00:32:54,080
name

912
00:32:54,080 --> 00:32:56,640
check for the uh the certificate that's

913
00:32:56,640 --> 00:32:57,760
on there

914
00:32:57,760 --> 00:33:00,000
keep that in mind and as soon as we see

915
00:33:00,000 --> 00:33:01,679
the certificate change

916
00:33:01,679 --> 00:33:03,760
raise an alarm apparently someone is

917
00:33:03,760 --> 00:33:06,000
playing around with the stuff we put out

918
00:33:06,000 --> 00:33:07,840
there and that might be a valid reason

919
00:33:07,840 --> 00:33:10,159
for us to stay on high alert an

920
00:33:10,159 --> 00:33:13,919
investigation might be our way

921
00:33:14,000 --> 00:33:16,240
so we've got we got a few more picks up

922
00:33:16,240 --> 00:33:18,640
our sleeve for the upcoming time

923
00:33:18,640 --> 00:33:20,640
password resets we mentioned that tls

924
00:33:20,640 --> 00:33:22,880
interception was mentioned the security

925
00:33:22,880 --> 00:33:25,200
tooling was mentioned log forwarding as

926
00:33:25,200 --> 00:33:27,200
we if we certainly see a change on one

927
00:33:27,200 --> 00:33:29,840
of the systems that we're on where logs

928
00:33:29,840 --> 00:33:32,880
are either forwarded somewhere else or

929
00:33:32,880 --> 00:33:34,240
more logging

930
00:33:34,240 --> 00:33:36,320
is enabled that's also reason for us to

931
00:33:36,320 --> 00:33:38,399
stay on higher alert because there might

932
00:33:38,399 --> 00:33:40,080
be some changes at hand

933
00:33:40,080 --> 00:33:42,159
changes of security config is also a

934
00:33:42,159 --> 00:33:44,000
reason to stay on high alert and

935
00:33:44,000 --> 00:33:45,360
accounts log in

936
00:33:45,360 --> 00:33:48,240
if we certainly see a local admin log

937
00:33:48,240 --> 00:33:49,760
into a machine where we've been messing

938
00:33:49,760 --> 00:33:51,919
around that might be a clear indicator

939
00:33:51,919 --> 00:33:53,200
that someone is trying to do some

940
00:33:53,200 --> 00:33:55,360
investigation if you're in a blue team

941
00:33:55,360 --> 00:33:57,760
though be aware that logging in with a

942
00:33:57,760 --> 00:33:59,360
high privileged account to a machine

943
00:33:59,360 --> 00:34:00,720
that you

944
00:34:00,720 --> 00:34:03,039
consider owned is the same as giving

945
00:34:03,039 --> 00:34:05,039
away that account so take care there and

946
00:34:05,039 --> 00:34:06,960
don't don't do that but if you do will

947
00:34:06,960 --> 00:34:10,320
likely see it think of the whole tiering

948
00:34:10,320 --> 00:34:11,760
aspect the tiering architecture that

949
00:34:11,760 --> 00:34:13,119
microsoft has put out as well as the

950
00:34:13,119 --> 00:34:15,280
clean source principle

951
00:34:15,280 --> 00:34:18,000
never log on to a lower tier system

952
00:34:18,000 --> 00:34:19,599
because you will need credentials on

953
00:34:19,599 --> 00:34:21,839
that remote system on that untrusted

954
00:34:21,839 --> 00:34:24,159
system

955
00:34:24,399 --> 00:34:26,079
so after giving you a lot of information

956
00:34:26,079 --> 00:34:28,879
on how we uh progressed as red team i

957
00:34:28,879 --> 00:34:30,639
think it's time also for a shout out and

958
00:34:30,639 --> 00:34:32,320
thanks to the blue team because we were

959
00:34:32,320 --> 00:34:33,918
merely looking at the techniques you

960
00:34:33,918 --> 00:34:36,159
guys deploy as a blue team and how we

961
00:34:36,159 --> 00:34:38,239
can mimic those because there's there's

962
00:34:38,239 --> 00:34:39,918
a lot of lessons learned in the progress

963
00:34:39,918 --> 00:34:41,280
that the blue teams make and we just

964
00:34:41,280 --> 00:34:43,199
want to copy what blue is doing so take

965
00:34:43,199 --> 00:34:46,079
the concept they're doing to get insight

966
00:34:46,079 --> 00:34:48,639
in their environment and do the same on

967
00:34:48,639 --> 00:34:50,560
at least on the machines we own by the

968
00:34:50,560 --> 00:34:53,040
time we are halfway during the operation

969
00:34:53,040 --> 00:34:54,800
so i think there's a list

970
00:34:54,800 --> 00:34:56,560
that we see happening on the blue team

971
00:34:56,560 --> 00:34:58,720
and how we want to implement those one

972
00:34:58,720 --> 00:35:00,839
is sending samples to the cloud for

973
00:35:00,839 --> 00:35:03,359
analysis that's a cool thing and that's

974
00:35:03,359 --> 00:35:06,000
also a heavy measure against any malware

975
00:35:06,000 --> 00:35:07,599
that's reused because if customer a

976
00:35:07,599 --> 00:35:09,520
submits it to the cloud already

977
00:35:09,520 --> 00:35:11,359
an attacker cannot reuse the same

978
00:35:11,359 --> 00:35:12,480
malware

979
00:35:12,480 --> 00:35:14,400
at customer b because the cloud will

980
00:35:14,400 --> 00:35:16,000
already know it's evil and kill it

981
00:35:16,000 --> 00:35:17,599
straight away

982
00:35:17,599 --> 00:35:19,839
heuristic analysis so behavioral

983
00:35:19,839 --> 00:35:21,680
monitoring

984
00:35:21,680 --> 00:35:22,880
that's also what we're trying to do

985
00:35:22,880 --> 00:35:24,800
we're trying to monitor the hosts we're

986
00:35:24,800 --> 00:35:26,960
working on and if one of them pops out

987
00:35:26,960 --> 00:35:28,880
and for some reason that might be a

988
00:35:28,880 --> 00:35:30,880
reason for us to be more alert

989
00:35:30,880 --> 00:35:32,560
application whitelisting very common

990
00:35:32,560 --> 00:35:34,560
technique on the blue team part we're

991
00:35:34,560 --> 00:35:36,560
doing the same on on our side we have

992
00:35:36,560 --> 00:35:38,720
whitelisting on either the c2 channel

993
00:35:38,720 --> 00:35:41,200
and the ips that we allow in or even on

994
00:35:41,200 --> 00:35:42,880
giving out our payloads if there's a

995
00:35:42,880 --> 00:35:44,400
payload on a web server you would only

996
00:35:44,400 --> 00:35:46,160
be allowed to download that if you come

997
00:35:46,160 --> 00:35:48,400
from a range or if you send a query that

998
00:35:48,400 --> 00:35:50,560
we expect we don't want any random

999
00:35:50,560 --> 00:35:52,480
sandbox downloading our code all the

1000
00:35:52,480 --> 00:35:53,359
time

1001
00:35:53,359 --> 00:35:55,040
because that wouldn't work and i think

1002
00:35:55,040 --> 00:35:56,839
last on the list is artificial

1003
00:35:56,839 --> 00:35:58,880
intelligence that's the buzzword guys

1004
00:35:58,880 --> 00:36:00,560
we're not going to implement on the red

1005
00:36:00,560 --> 00:36:02,400
team side and we don't hear them even

1006
00:36:02,400 --> 00:36:03,440
even the blue teams have not

1007
00:36:03,440 --> 00:36:05,599
successfully implemented it

1008
00:36:05,599 --> 00:36:08,720
i dubbed it i highly doubt it

1009
00:36:08,720 --> 00:36:10,720
so the summary of this talk i think most

1010
00:36:10,720 --> 00:36:13,119
important is and people everyone for to

1011
00:36:13,119 --> 00:36:14,800
the blue teams and the red teams in the

1012
00:36:14,800 --> 00:36:17,119
in this room remember the goal of the

1013
00:36:17,119 --> 00:36:18,720
red team is make the blue team better

1014
00:36:18,720 --> 00:36:20,880
yesterday at dinner i got asked if you

1015
00:36:20,880 --> 00:36:22,480
do your best to be just below the

1016
00:36:22,480 --> 00:36:24,079
surface and give the blue team a chance

1017
00:36:24,079 --> 00:36:25,440
to detect you

1018
00:36:25,440 --> 00:36:27,119
don't you consider the red team failed

1019
00:36:27,119 --> 00:36:29,760
if they catch you hell no

1020
00:36:29,760 --> 00:36:32,000
i consider the red team failed

1021
00:36:32,000 --> 00:36:34,960
if the blue team learned nothing

1022
00:36:34,960 --> 00:36:36,960
it doesn't matter if i get caught or not

1023
00:36:36,960 --> 00:36:38,720
the end goal is the blue team being

1024
00:36:38,720 --> 00:36:39,599
better

1025
00:36:39,599 --> 00:36:41,280
the bigger end goal is the company not

1026
00:36:41,280 --> 00:36:44,000
being ransomed in half a year

1027
00:36:44,000 --> 00:36:46,000
so essentially blue teams and red teams

1028
00:36:46,000 --> 00:36:47,760
are not against each other

1029
00:36:47,760 --> 00:36:49,760
there might be some

1030
00:36:49,760 --> 00:36:51,839
angry faces now and then but it's like

1031
00:36:51,839 --> 00:36:53,440
that's like a strong soccer match

1032
00:36:53,440 --> 00:36:55,040
sometimes a bit of pain is needed to

1033
00:36:55,040 --> 00:36:56,320
improve

1034
00:36:56,320 --> 00:36:58,240
but the blue teams are there to serve

1035
00:36:58,240 --> 00:36:59,680
i'm sorry the red teams are there to

1036
00:36:59,680 --> 00:37:01,520
serve the blue teams in getting better

1037
00:37:01,520 --> 00:37:03,200
and please blue teams if you feel you've

1038
00:37:03,200 --> 00:37:05,040
got a red team on the other side that's

1039
00:37:05,040 --> 00:37:07,359
only punching you and never gives you

1040
00:37:07,359 --> 00:37:09,040
anything back

1041
00:37:09,040 --> 00:37:12,000
report it work on it improve that and if

1042
00:37:12,000 --> 00:37:13,920
you're a red team and you think you feel

1043
00:37:13,920 --> 00:37:16,400
if you get caught forget about it you

1044
00:37:16,400 --> 00:37:17,680
feel if the blue team doesn't learn

1045
00:37:17,680 --> 00:37:19,599
anything keep that in mind and ask your

1046
00:37:19,599 --> 00:37:21,119
customer as well if you do a red team

1047
00:37:21,119 --> 00:37:23,440
engagement the end query the query at

1048
00:37:23,440 --> 00:37:25,040
the beginning should be what do you want

1049
00:37:25,040 --> 00:37:27,760
to learn what do you want me to simulate

1050
00:37:27,760 --> 00:37:29,359
if you do red teaming without flank you

1051
00:37:29,359 --> 00:37:31,119
don't want to know if outflank can break

1052
00:37:31,119 --> 00:37:32,240
in

1053
00:37:32,240 --> 00:37:33,680
i can almost say we're confident that in

1054
00:37:33,680 --> 00:37:35,280
most cases we can

1055
00:37:35,280 --> 00:37:37,760
no you want to learn if an average

1056
00:37:37,760 --> 00:37:40,000
ransomware guy from a certain area in

1057
00:37:40,000 --> 00:37:41,839
the world can do a very aggressive

1058
00:37:41,839 --> 00:37:43,839
attack and succeed or maybe you want to

1059
00:37:43,839 --> 00:37:46,160
learn if a very skilled adversary that

1060
00:37:46,160 --> 00:37:48,160
takes five months and builds his own

1061
00:37:48,160 --> 00:37:50,320
tool can make a persistent connection

1062
00:37:50,320 --> 00:37:52,560
and listening on your data over the next

1063
00:37:52,560 --> 00:37:54,480
few years two totally different

1064
00:37:54,480 --> 00:37:56,240
questions to totally different

1065
00:37:56,240 --> 00:37:58,560
approaches for the red team for us

1066
00:37:58,560 --> 00:38:00,800
and and still it's important that we

1067
00:38:00,800 --> 00:38:02,880
mimic what the customer asks and stay

1068
00:38:02,880 --> 00:38:04,720
close to those adversaries so the blue

1069
00:38:04,720 --> 00:38:06,720
team can improve the blue team is not

1070
00:38:06,720 --> 00:38:08,640
there to kick out the red team

1071
00:38:08,640 --> 00:38:10,400
the blue team is there to kick out the

1072
00:38:10,400 --> 00:38:11,599
criminal

1073
00:38:11,599 --> 00:38:14,000
so please keep that in mind

1074
00:38:14,000 --> 00:38:16,240
red elk is here to help you

1075
00:38:16,240 --> 00:38:17,680
for the blue for the red teams but in

1076
00:38:17,680 --> 00:38:18,960
the end also for the blue teams because

1077
00:38:18,960 --> 00:38:20,720
in the end of the operation we can give

1078
00:38:20,720 --> 00:38:22,960
the blue team a list of every command

1079
00:38:22,960 --> 00:38:25,040
when we did it how we did it what the

1080
00:38:25,040 --> 00:38:26,880
parameters were and there can they can

1081
00:38:26,880 --> 00:38:29,040
tune their defenses to make sure that

1082
00:38:29,040 --> 00:38:30,480
next time we do such a thing it's

1083
00:38:30,480 --> 00:38:32,960
detected so that's one go to get up

1084
00:38:32,960 --> 00:38:34,960
check on the alarms codes that's in

1085
00:38:34,960 --> 00:38:36,800
there just the simple checks that we can

1086
00:38:36,800 --> 00:38:40,000
do to spot the traces left by blue it's

1087
00:38:40,000 --> 00:38:41,599
for your knowledge as well but

1088
00:38:41,599 --> 00:38:43,119
essentially red dark is of course

1089
00:38:43,119 --> 00:38:45,440
created for red teams it's here to help

1090
00:38:45,440 --> 00:38:48,000
you and even and as a blue team you get

1091
00:38:48,000 --> 00:38:49,440
most of the tools you can just download

1092
00:38:49,440 --> 00:38:51,040
and repeat the steps

1093
00:38:51,040 --> 00:38:52,720
do it yourself make sure that the alarm

1094
00:38:52,720 --> 00:38:53,680
triggers

1095
00:38:53,680 --> 00:38:56,400
how how a waste would it if a next red

1096
00:38:56,400 --> 00:38:57,760
team can do the same trick and still

1097
00:38:57,760 --> 00:38:59,599
succeed

1098
00:38:59,599 --> 00:39:00,560
and then

1099
00:39:00,560 --> 00:39:02,640
the ioc overview from red elk quite

1100
00:39:02,640 --> 00:39:04,880
often either during the operation if

1101
00:39:04,880 --> 00:39:06,560
management gets stressed that some real

1102
00:39:06,560 --> 00:39:08,400
attack might be going on it's a piece of

1103
00:39:08,400 --> 00:39:10,640
cake for us to check was that us give me

1104
00:39:10,640 --> 00:39:13,200
a username give me an md5 a file name

1105
00:39:13,200 --> 00:39:14,480
anything and i'll look it up and i can

1106
00:39:14,480 --> 00:39:16,240
tell you exactly whether or not we touch

1107
00:39:16,240 --> 00:39:18,240
that machine during our op

1108
00:39:18,240 --> 00:39:20,079
and in the end while cleaning up the

1109
00:39:20,079 --> 00:39:22,240
iocs also really help to clean up the

1110
00:39:22,240 --> 00:39:24,560
stuff that might be left behind

1111
00:39:24,560 --> 00:39:26,640
quite quite often we find leftovers from

1112
00:39:26,640 --> 00:39:28,880
other red teams clean up your stuff and

1113
00:39:28,880 --> 00:39:30,960
if you can't ask the blue team to do so

1114
00:39:30,960 --> 00:39:33,440
and give them the information they need

1115
00:39:33,440 --> 00:39:35,280
and then of course blue team think of

1116
00:39:35,280 --> 00:39:36,560
your opsec

1117
00:39:36,560 --> 00:39:38,400
if we can monitor what you guys are

1118
00:39:38,400 --> 00:39:41,040
doing the criminals can as well and we

1119
00:39:41,040 --> 00:39:43,440
might use red elk for the benefit of the

1120
00:39:43,440 --> 00:39:45,760
engagement and for your benefit if a

1121
00:39:45,760 --> 00:39:47,680
criminal would use something like red

1122
00:39:47,680 --> 00:39:49,680
elk it's not going to benefit you it's

1123
00:39:49,680 --> 00:39:51,680
only going to make your life harder

1124
00:39:51,680 --> 00:39:53,520
and the attack more advanced if we have

1125
00:39:53,520 --> 00:39:56,079
to give a penny to every blue team that

1126
00:39:56,079 --> 00:39:58,000
tries to investigate

1127
00:39:58,000 --> 00:39:59,280
a certain

1128
00:39:59,280 --> 00:40:02,079
url of our c2 implant

1129
00:40:02,079 --> 00:40:04,640
by first accessing it with the actual

1130
00:40:04,640 --> 00:40:06,960
implant and then trying with python from

1131
00:40:06,960 --> 00:40:08,720
the same ip address of the corporate

1132
00:40:08,720 --> 00:40:10,560
network and then switching all of a

1133
00:40:10,560 --> 00:40:13,040
sudden going to talk

1134
00:40:13,040 --> 00:40:14,800
and we see traffic coming in front door

1135
00:40:14,800 --> 00:40:17,119
to that specific ap address

1136
00:40:17,119 --> 00:40:19,040
please think of your offset don't don't

1137
00:40:19,040 --> 00:40:20,800
don't send the url by whatsapp to the

1138
00:40:20,800 --> 00:40:23,200
team members whatsapp will query the url

1139
00:40:23,200 --> 00:40:25,760
and we'll see what's up coming in okay

1140
00:40:25,760 --> 00:40:27,920
someone found our our c2 url and

1141
00:40:27,920 --> 00:40:29,920
forwards it to a colleague

1142
00:40:29,920 --> 00:40:31,839
please don't okay

1143
00:40:31,839 --> 00:40:33,920
i think that's it for now any questions

1144
00:40:33,920 --> 00:40:36,560
we've got five got a few minutes left so

1145
00:40:36,560 --> 00:40:38,400
if not we're going to to give the five

1146
00:40:38,400 --> 00:40:39,920
minutes that wind saves us to the next

1147
00:40:39,920 --> 00:40:42,480
speaker and he can you can use those

1148
00:40:42,480 --> 00:40:45,440
i see it's just ready

1149
00:40:50,480 --> 00:40:53,040
yeah the question is do we only uh which

1150
00:40:53,040 --> 00:40:55,200
c2 frameworks do we support actually

1151
00:40:55,200 --> 00:40:56,560
well corporal strike is a very big one

1152
00:40:56,560 --> 00:40:58,240
that we support we have our own c2

1153
00:40:58,240 --> 00:41:00,240
framework which we support we're working

1154
00:41:00,240 --> 00:41:02,400
on several others which have partly

1155
00:41:02,400 --> 00:41:05,520
support like uh porsche c2

1156
00:41:05,520 --> 00:41:07,200
and i'm interested in i have basic

1157
00:41:07,200 --> 00:41:09,440
support from mythic and i'm looking at

1158
00:41:09,440 --> 00:41:11,040
sliver as well but

1159
00:41:11,040 --> 00:41:12,240
it's

1160
00:41:12,240 --> 00:41:14,480
it's an open source project i'm

1161
00:41:14,480 --> 00:41:18,160
welcoming any type of help on this

1162
00:41:18,160 --> 00:41:21,560
any more questions

1163
00:41:22,560 --> 00:41:24,319
either i was dead clear or i was dead

1164
00:41:24,319 --> 00:41:24,710
boring

1165
00:41:24,710 --> 00:41:27,119
[Laughter]

1166
00:41:27,119 --> 00:41:29,040
thanks a lot for your time we will be

1167
00:41:29,040 --> 00:41:30,960
around for the remaining of the

1168
00:41:30,960 --> 00:41:32,560
conference if you still have questions

1169
00:41:32,560 --> 00:41:34,720
hook us up somewhere in the

1170
00:41:34,720 --> 00:41:36,960
outside thank you all for your attention

1171
00:41:36,960 --> 00:41:39,960
thanks

