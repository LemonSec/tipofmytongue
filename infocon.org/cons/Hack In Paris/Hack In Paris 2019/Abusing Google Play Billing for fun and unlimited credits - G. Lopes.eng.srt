1
00:00:05,629 --> 00:00:12,500
okay hello guys I hope you hear me well

2
00:00:09,809 --> 00:00:16,139
I'm sorry my voice is a little bit

3
00:00:12,500 --> 00:00:19,680
because of the party last night so I'll

4
00:00:16,139 --> 00:00:22,619
try to do my best to give to give this

5
00:00:19,680 --> 00:00:25,500
tool so today yes we are going to talk

6
00:00:22,619 --> 00:00:28,769
about the Google Play bidding so as

7
00:00:25,500 --> 00:00:31,769
usual a slide about me so I'm a senior

8
00:00:28,769 --> 00:00:33,930
penetration tester at rendre SEC it's an

9
00:00:31,769 --> 00:00:36,420
offensive security company based in in

10
00:00:33,930 --> 00:00:38,910
Paris I have a lot of experience in a

11
00:00:36,420 --> 00:00:41,940
penetration testing in different areas

12
00:00:38,910 --> 00:00:45,959
such as Windows Linux web application

13
00:00:41,940 --> 00:00:48,000
and Wi-Fi and of course on rail I'm also

14
00:00:45,960 --> 00:00:49,770
a member a member of the check marks

15
00:00:48,000 --> 00:00:52,739
application security research team I

16
00:00:49,770 --> 00:00:55,289
don't know if you know this team but one

17
00:00:52,739 --> 00:00:59,070
of the famous things this team performed

18
00:00:55,289 --> 00:01:02,399
is about a research regarding tinder in

19
00:00:59,070 --> 00:01:06,930
the application so yes if you want to

20
00:01:02,399 --> 00:01:09,720
dig more you can look at the blog I also

21
00:01:06,930 --> 00:01:13,470
a cost security researcher at Cobalt and

22
00:01:09,720 --> 00:01:19,140
I like playing CTF but for work in Paris

23
00:01:13,470 --> 00:01:21,090
I didn't get time to to play a lot so

24
00:01:19,140 --> 00:01:24,200
let's start I'm going to present you

25
00:01:21,090 --> 00:01:26,790
briefly what is a Google Play being

26
00:01:24,200 --> 00:01:30,479
present also some known celebrities

27
00:01:26,790 --> 00:01:34,340
about this IP I show you how I exploited

28
00:01:30,479 --> 00:01:39,329
these issues on several application and

29
00:01:34,340 --> 00:01:42,240
also some some results about my my

30
00:01:39,329 --> 00:01:46,639
research maybe before to start how many

31
00:01:42,240 --> 00:01:49,619
people are are using an Android device

32
00:01:46,640 --> 00:01:52,710
ok so many people and how many people

33
00:01:49,619 --> 00:01:57,960
are already performed in a payment using

34
00:01:52,710 --> 00:02:03,389
the device ok I guess mostly for games

35
00:01:57,960 --> 00:02:06,309
no yes no no ok

36
00:02:03,390 --> 00:02:09,340
so let's have a look at google play

37
00:02:06,310 --> 00:02:11,350
bidding so if you look at the Android

38
00:02:09,340 --> 00:02:13,390
documentation the Google Play bidding is

39
00:02:11,350 --> 00:02:16,540
a service that lets you sell digital

40
00:02:13,390 --> 00:02:19,660
content on Android so yes it's a good

41
00:02:16,540 --> 00:02:22,510
film framework for for developers

42
00:02:19,660 --> 00:02:25,990
because you can use it for in-app

43
00:02:22,510 --> 00:02:28,660
purchases but also for subscriptions so

44
00:02:25,990 --> 00:02:30,610
for instance two magazines or to have

45
00:02:28,660 --> 00:02:32,740
some premium features if you want to

46
00:02:30,610 --> 00:02:37,240
remove advertisement on your Android

47
00:02:32,740 --> 00:02:39,010
application or like most specifically in

48
00:02:37,240 --> 00:02:42,850
all three games to have some extra

49
00:02:39,010 --> 00:02:45,299
content for instance okay for tonight

50
00:02:42,850 --> 00:02:47,710
it's not a good good example because

51
00:02:45,300 --> 00:02:51,040
they are not using the Google Play Store

52
00:02:47,710 --> 00:02:52,720
to publish a application but you get the

53
00:02:51,040 --> 00:02:57,160
idea if you want to buy some stuff on

54
00:02:52,720 --> 00:03:01,530
for tonight if you if AP games wanted

55
00:02:57,160 --> 00:03:04,209
they can use a Google Play billing API

56
00:03:01,530 --> 00:03:06,760
another advantage is that the payment is

57
00:03:04,209 --> 00:03:09,220
completely undal by Google so for deploy

58
00:03:06,760 --> 00:03:12,640
for developers it means they don't have

59
00:03:09,220 --> 00:03:17,650
to under lowest credit cards tracking

60
00:03:12,640 --> 00:03:20,018
truck as the transactions and so it's

61
00:03:17,650 --> 00:03:24,250
it's easy for our two to implement this

62
00:03:20,019 --> 00:03:26,830
API you just need to define the projects

63
00:03:24,250 --> 00:03:28,450
on the Google Play console so you say ok

64
00:03:26,830 --> 00:03:31,810
I'm on this application I'm going to

65
00:03:28,450 --> 00:03:34,540
sell this kind of products or this kind

66
00:03:31,810 --> 00:03:36,640
of sub tree subscription the price for

67
00:03:34,540 --> 00:03:40,030
each product of course and that's all

68
00:03:36,640 --> 00:03:42,160
and the only requirement on the user you

69
00:03:40,030 --> 00:03:44,530
need to have Google Play installed on

70
00:03:42,160 --> 00:03:48,070
your device which is normally the case

71
00:03:44,530 --> 00:03:55,600
if you are not if you are if you are not

72
00:03:48,070 --> 00:03:57,209
rooted your your device so yes if you

73
00:03:55,600 --> 00:04:02,950
look at this image just to have more

74
00:03:57,209 --> 00:04:04,600
understanding so on in orange here you

75
00:04:02,950 --> 00:04:07,510
have your application you just need to

76
00:04:04,600 --> 00:04:10,388
embed the Google Play billing library in

77
00:04:07,510 --> 00:04:11,459
your application and then you have to

78
00:04:10,389 --> 00:04:15,090
main

79
00:04:11,459 --> 00:04:19,560
in two important components as we said

80
00:04:15,090 --> 00:04:21,209
before the google play up which with the

81
00:04:19,560 --> 00:04:25,080
application your application is going to

82
00:04:21,209 --> 00:04:28,199
to talk about with sorry and the google

83
00:04:25,080 --> 00:04:31,469
play back in so in fact in fact when you

84
00:04:28,199 --> 00:04:33,240
start the process of in-app payment the

85
00:04:31,470 --> 00:04:37,139
application is going to send a message

86
00:04:33,240 --> 00:04:40,169
to the google play up saying okay this

87
00:04:37,139 --> 00:04:44,430
user wants to buy this specific product

88
00:04:40,169 --> 00:04:49,198
and then the Google Play app is going to

89
00:04:44,430 --> 00:04:51,539
send request to the back end for for for

90
00:04:49,199 --> 00:04:56,009
validating I mean formulas sorry for

91
00:04:51,539 --> 00:04:58,289
ending the process payment so you back

92
00:04:56,009 --> 00:05:00,360
end is not use only for that but also to

93
00:04:58,289 --> 00:05:04,259
retrieve the product list that you up

94
00:05:00,360 --> 00:05:06,570
judge your app is setting and also for

95
00:05:04,259 --> 00:05:09,389
tracking the transaction for instance

96
00:05:06,570 --> 00:05:12,570
you can machine you're buying a magazine

97
00:05:09,389 --> 00:05:17,729
if you already buy it you can retrieve

98
00:05:12,570 --> 00:05:21,150
it without by buying it again and then

99
00:05:17,729 --> 00:05:26,219
optionally see developers app can have

100
00:05:21,150 --> 00:05:30,870
server to perform the payment validation

101
00:05:26,220 --> 00:05:33,360
or to deliver the product if it's not if

102
00:05:30,870 --> 00:05:35,630
you need to deliver the product we with

103
00:05:33,360 --> 00:05:44,099
a third party

104
00:05:35,630 --> 00:05:45,659
so just to if you never use it it is

105
00:05:44,099 --> 00:05:48,900
something like that so on this example

106
00:05:45,659 --> 00:05:51,419
is a trivial Drive application provided

107
00:05:48,900 --> 00:05:55,258
by Google and set commutation so if you

108
00:05:51,419 --> 00:05:57,659
click buy here for instance in fact you

109
00:05:55,259 --> 00:06:00,150
have kind of a pop-up saying okay do you

110
00:05:57,659 --> 00:06:02,909
want to buy this product so price is

111
00:06:00,150 --> 00:06:07,020
this and you just need to click buy and

112
00:06:02,909 --> 00:06:10,800
then see payment method is asked so if

113
00:06:07,020 --> 00:06:13,859
you pay by credit card or voucher code

114
00:06:10,800 --> 00:06:16,860
or something else so in fact this pop-up

115
00:06:13,860 --> 00:06:19,080
is already so Google Play app in fact

116
00:06:16,860 --> 00:06:21,240
when you see this pop up you're kind of

117
00:06:19,080 --> 00:06:24,240
not anymore on your own your own trade

118
00:06:21,240 --> 00:06:24,689
application and so if the payment goes

119
00:06:24,240 --> 00:06:28,289
well

120
00:06:24,689 --> 00:06:30,659
and this successful then you go back to

121
00:06:28,289 --> 00:06:34,229
your application and then your

122
00:06:30,659 --> 00:06:36,659
application need to under this this this

123
00:06:34,229 --> 00:06:42,360
successful payment to deliver the

124
00:06:36,659 --> 00:06:46,259
product so let's let's have a look

125
00:06:42,360 --> 00:06:48,360
deeper on what Google is giving to to

126
00:06:46,259 --> 00:06:51,449
the application in fact it just the

127
00:06:48,360 --> 00:06:53,279
design object containing several values

128
00:06:51,449 --> 00:06:56,029
but the most interesting one is a

129
00:06:53,279 --> 00:06:58,558
project state which indicates if the

130
00:06:56,029 --> 00:07:01,649
payment was successful or not so you

131
00:06:58,559 --> 00:07:05,129
have only two possible values 0 for

132
00:07:01,649 --> 00:07:09,509
project or 1 if the user concerns the

133
00:07:05,129 --> 00:07:11,999
payment a purchase token its it's just

134
00:07:09,509 --> 00:07:16,169
token use to indentify the transaction

135
00:07:11,999 --> 00:07:18,539
for the tracking and a signature in fact

136
00:07:16,169 --> 00:07:22,498
this this string represents a signature

137
00:07:18,539 --> 00:07:27,449
of all the design object returned by by

138
00:07:22,499 --> 00:07:30,300
by Google so for sure the ID is for the

139
00:07:27,449 --> 00:07:35,489
developer to ensure that the signature

140
00:07:30,300 --> 00:07:38,939
returned by by Google Play backend is a

141
00:07:35,489 --> 00:07:41,399
good one so yes to do that you need just

142
00:07:38,939 --> 00:07:43,499
to generate Narus a keeper for its

143
00:07:41,399 --> 00:07:47,759
application you are going to use a

144
00:07:43,499 --> 00:07:51,499
Google Play billing and he has a private

145
00:07:47,759 --> 00:07:53,879
key is used to to perform the signature

146
00:07:51,499 --> 00:07:57,319
so if you look at the code of the

147
00:07:53,879 --> 00:07:59,959
trivial drive v2 which is again the

148
00:07:57,319 --> 00:08:02,729
sample application provided by Google

149
00:07:59,959 --> 00:08:06,749
you can see all the verification is is

150
00:08:02,729 --> 00:08:09,419
performed so yes it yeah so you have a

151
00:08:06,749 --> 00:08:12,809
verified process function and yes you

152
00:08:09,419 --> 00:08:15,899
have some some some verification to see

153
00:08:12,809 --> 00:08:18,749
if the signature is empty and with

154
00:08:15,899 --> 00:08:22,679
public key as a very signature is

155
00:08:18,749 --> 00:08:24,809
verified if it's wet well it returns

156
00:08:22,679 --> 00:08:30,239
true and normally the application

157
00:08:24,809 --> 00:08:34,860
delivers the the product so if you look

158
00:08:30,239 --> 00:08:37,199
at the comment of of this class you see

159
00:08:34,860 --> 00:08:39,539
in small that they recommend saying for

160
00:08:37,200 --> 00:08:41,280
a secure implementation all of this code

161
00:08:39,539 --> 00:08:43,559
should be implemented on a server that

162
00:08:41,280 --> 00:08:44,010
communicates with the application on the

163
00:08:43,559 --> 00:08:46,979
device

164
00:08:44,010 --> 00:08:49,170
so in fact we are looking at the example

165
00:08:46,980 --> 00:08:51,450
provided by Google but they say be

166
00:08:49,170 --> 00:08:55,020
careful no money you shouldn't do that

167
00:08:51,450 --> 00:08:58,590
if you want to secure implementation so

168
00:08:55,020 --> 00:09:01,010
sorry it's a little bit strange if you

169
00:08:58,590 --> 00:09:03,840
look deeper on the Google documentation

170
00:09:01,010 --> 00:09:06,090
they tell you yes in fact we recommend

171
00:09:03,840 --> 00:09:11,550
to validate the process on the server

172
00:09:06,090 --> 00:09:13,380
control by the developer however if you

173
00:09:11,550 --> 00:09:15,569
can't you can still perform a less

174
00:09:13,380 --> 00:09:20,130
secure validation within Europe it's a

175
00:09:15,570 --> 00:09:22,680
load with the design provided by by

176
00:09:20,130 --> 00:09:24,930
Google but they warn you on the warning

177
00:09:22,680 --> 00:09:27,510
this form of verification isn't ready

178
00:09:24,930 --> 00:09:29,790
secure because it requires to mental

179
00:09:27,510 --> 00:09:32,220
process verification logic within your

180
00:09:29,790 --> 00:09:39,839
app so it means if someone reverse

181
00:09:32,220 --> 00:09:42,360
engineering your application is good so

182
00:09:39,840 --> 00:09:44,670
let's have a look on some known

183
00:09:42,360 --> 00:09:49,890
vulnerabilities already found on this

184
00:09:44,670 --> 00:09:52,560
API in fact in 2013 Dominic's Roman from

185
00:09:49,890 --> 00:09:55,140
already - who novelties on on this on

186
00:09:52,560 --> 00:09:57,150
this API so we disclosed the back to

187
00:09:55,140 --> 00:09:59,970
Google it was onesie all of the fame at

188
00:09:57,150 --> 00:10:02,579
at this time yes at this time bug booty

189
00:09:59,970 --> 00:10:06,150
and it was not very popular so we didn't

190
00:10:02,580 --> 00:10:08,730
get any any money for that but you

191
00:10:06,150 --> 00:10:13,650
develop a proof of concept it called the

192
00:10:08,730 --> 00:10:16,650
bidding ACK to to perform the to exploit

193
00:10:13,650 --> 00:10:20,430
sorry so for now it is fun so let's

194
00:10:16,650 --> 00:10:23,490
let's have a look at the first one so in

195
00:10:20,430 --> 00:10:26,069
fact as you as I said before to start a

196
00:10:23,490 --> 00:10:28,560
payment you need to send a message which

197
00:10:26,070 --> 00:10:31,170
is in and ruined world means an intent

198
00:10:28,560 --> 00:10:34,589
to the to the Google Play app to

199
00:10:31,170 --> 00:10:36,540
initiate the process payment in fact in

200
00:10:34,590 --> 00:10:39,000
this at this time I found that if a

201
00:10:36,540 --> 00:10:42,030
malicious application define in this

202
00:10:39,000 --> 00:10:44,580
Underland manifests a specific filter

203
00:10:42,030 --> 00:10:47,280
for photo message sent by by the

204
00:10:44,580 --> 00:10:48,120
application with I priority so it means

205
00:10:47,280 --> 00:10:50,129
what

206
00:10:48,120 --> 00:10:52,319
the system okay if you send this kind of

207
00:10:50,129 --> 00:10:55,439
message I want to be the first in

208
00:10:52,319 --> 00:10:57,410
Croatia to receive it and to to manage

209
00:10:55,439 --> 00:11:00,269
to manage it

210
00:10:57,410 --> 00:11:04,410
so in fact it means you can impersonate

211
00:11:00,269 --> 00:11:08,129
the Google Play app so that was the

212
00:11:04,410 --> 00:11:10,920
first first venality form then when you

213
00:11:08,129 --> 00:11:14,879
look at the signature of verification

214
00:11:10,920 --> 00:11:18,410
method given by by Google I found that

215
00:11:14,879 --> 00:11:21,449
in fact if you return an empty signature

216
00:11:18,410 --> 00:11:25,139
you can see on this con in fact a

217
00:11:21,449 --> 00:11:28,050
function always return true because the

218
00:11:25,139 --> 00:11:32,160
first test is if not empty made the

219
00:11:28,050 --> 00:11:34,258
verification in in the other case if the

220
00:11:32,160 --> 00:11:36,029
signature is empty no verification is

221
00:11:34,259 --> 00:11:41,610
made and by default the function returns

222
00:11:36,029 --> 00:11:45,120
true so to sum up you can just create a

223
00:11:41,610 --> 00:11:47,370
malicious app at this time and set an

224
00:11:45,120 --> 00:11:49,620
intent filter with a priority to

225
00:11:47,370 --> 00:11:52,019
impersonate the Google Play app return

226
00:11:49,620 --> 00:11:56,550
an empty signature and that's all you

227
00:11:52,019 --> 00:11:59,939
can bypass the payment so of course

228
00:11:56,550 --> 00:12:04,290
Google modify this for the first one

229
00:11:59,939 --> 00:12:06,748
it's simple they say ok for now for the

230
00:12:04,290 --> 00:12:09,959
intent you need to specify specifically

231
00:12:06,749 --> 00:12:12,899
that we need to use you need to sensory

232
00:12:09,959 --> 00:12:15,929
this message to the Google Play app so

233
00:12:12,899 --> 00:12:18,089
on the on to redraw the package name of

234
00:12:15,929 --> 00:12:21,899
the Google Play app is come dot Android

235
00:12:18,089 --> 00:12:23,670
that vending so now it's untrue

236
00:12:21,899 --> 00:12:27,269
application wanting to perform in-app

237
00:12:23,670 --> 00:12:29,699
payments need to implement this specific

238
00:12:27,269 --> 00:12:33,240
line you can see so is intent dot set

239
00:12:29,699 --> 00:12:37,050
package and specify come dot intrigued

240
00:12:33,240 --> 00:12:39,300
at Wendy okay so that's all so first one

241
00:12:37,050 --> 00:12:42,809
ok so now we are sending this message

242
00:12:39,300 --> 00:12:47,910
directly to google app Google Play Store

243
00:12:42,809 --> 00:12:51,449
application and for the second second

244
00:12:47,910 --> 00:12:54,329
issue it is I just modify the verify

245
00:12:51,449 --> 00:12:57,130
process method and by default it's

246
00:12:54,329 --> 00:12:59,800
returning false whatever

247
00:12:57,130 --> 00:13:03,910
whatever even even if the signature is

248
00:12:59,800 --> 00:13:07,060
empty so that's good so now the question

249
00:13:03,910 --> 00:13:11,829
is can we remove a client-side issue

250
00:13:07,060 --> 00:13:14,800
using a client-side fix spoiler alert

251
00:13:11,830 --> 00:13:18,600
no in fact you can still bypass the

252
00:13:14,800 --> 00:13:20,890
payment even with those deuce fixes

253
00:13:18,600 --> 00:13:24,400
because if you're on a real application

254
00:13:20,890 --> 00:13:26,470
is still performing a local validation

255
00:13:24,400 --> 00:13:30,880
from the payment you can still modify

256
00:13:26,470 --> 00:13:33,040
the application to set this set the

257
00:13:30,880 --> 00:13:35,560
package to package your tuner an

258
00:13:33,040 --> 00:13:38,199
application in your control and modify

259
00:13:35,560 --> 00:13:40,900
the verify process method to always

260
00:13:38,200 --> 00:13:43,090
return true if you want so in fact I

261
00:13:40,900 --> 00:13:46,390
made the main program the first point is

262
00:13:43,090 --> 00:13:49,840
is simple to to automate and to aim to

263
00:13:46,390 --> 00:13:53,220
do it's just the second one you just

264
00:13:49,840 --> 00:13:56,440
need to find the logic to for the

265
00:13:53,220 --> 00:14:01,960
verification process and just to modify

266
00:13:56,440 --> 00:14:03,820
this this dis logic so I kick steps if

267
00:14:01,960 --> 00:14:06,280
you want to do that it's pretty simple

268
00:14:03,820 --> 00:14:09,340
usually billing ACK provided by

269
00:14:06,280 --> 00:14:12,610
Dominique as a proof of concept is still

270
00:14:09,340 --> 00:14:15,130
available on github you have it on my

271
00:14:12,610 --> 00:14:16,690
slides on the reference at Yin you

272
00:14:15,130 --> 00:14:18,939
decompile the application for instance

273
00:14:16,690 --> 00:14:21,520
with applicator you modify the byte code

274
00:14:18,940 --> 00:14:25,530
to replace a package with with a billing

275
00:14:21,520 --> 00:14:28,390
like application you modify the

276
00:14:25,530 --> 00:14:30,280
signature validation to return always

277
00:14:28,390 --> 00:14:35,160
true recompile the application in

278
00:14:30,280 --> 00:14:35,160
studied new in your device and that's it

279
00:14:36,540 --> 00:14:42,439
so now let's have

280
00:14:38,270 --> 00:14:45,850
gotten some venerable application for

281
00:14:42,440 --> 00:14:49,070
the first one I tried on do the jump in

282
00:14:45,850 --> 00:14:53,390
2015 it was one of the famous games on

283
00:14:49,070 --> 00:14:55,940
Android platform if you don't know this

284
00:14:53,390 --> 00:14:59,960
game you just have to jump the Eiger

285
00:14:55,940 --> 00:15:03,580
possible to win to win the game so in

286
00:14:59,960 --> 00:15:06,380
this game you can buy kind of costumes

287
00:15:03,580 --> 00:15:09,710
but to buy costumes in fact you need

288
00:15:06,380 --> 00:15:13,670
candies so the only item you can buy is

289
00:15:09,710 --> 00:15:15,770
candies if you look at the code of of

290
00:15:13,670 --> 00:15:18,650
the do google doodle jump sorry

291
00:15:15,770 --> 00:15:22,819
application in fact it's like it's a

292
00:15:18,650 --> 00:15:26,420
copy/paste from the pharmacy Android

293
00:15:22,820 --> 00:15:29,690
documentation so as I said well they

294
00:15:26,420 --> 00:15:31,610
they set it well things the set package

295
00:15:29,690 --> 00:15:34,250
to the Google Play app so now it's

296
00:15:31,610 --> 00:15:37,760
moment data resource I can do another

297
00:15:34,250 --> 00:15:41,060
way so on the byte code it's easy to

298
00:15:37,760 --> 00:15:43,790
replace just a string come touch on

299
00:15:41,060 --> 00:15:47,119
drink vending by all dot meeting ACK

300
00:15:43,790 --> 00:15:48,740
okay so no problem for that and if you

301
00:15:47,120 --> 00:15:51,530
look at the Java code yes verify

302
00:15:48,740 --> 00:15:55,100
processes yeah so the verification is

303
00:15:51,530 --> 00:15:58,010
performed locally so no issue on the

304
00:15:55,100 --> 00:16:02,360
bytecode you just modify as visible

305
00:15:58,010 --> 00:16:05,740
register here to to be set to one which

306
00:16:02,360 --> 00:16:09,050
it means true on bytecode bytecode one

307
00:16:05,740 --> 00:16:12,890
so doing that you just have to recompile

308
00:16:09,050 --> 00:16:17,750
the application and to to use it and to

309
00:16:12,890 --> 00:16:23,120
profit just a quick demo to to show you

310
00:16:17,750 --> 00:16:26,480
I'm not I'm not I'm not cheating in fact

311
00:16:23,120 --> 00:16:32,270
yes in soft of I'm sitting but not for

312
00:16:26,480 --> 00:16:36,080
the demo okay so you see I'm not going

313
00:16:32,270 --> 00:16:38,329
to launch do the jump so sorry it's in

314
00:16:36,080 --> 00:16:41,600
French but I'm going to make the

315
00:16:38,330 --> 00:16:43,490
translation so if you look it if you

316
00:16:41,600 --> 00:16:49,350
look here you have the magazine which is

317
00:16:43,490 --> 00:16:54,600
a shop in English okay

318
00:16:49,350 --> 00:16:58,230
and so you can select a character so the

319
00:16:54,600 --> 00:17:01,470
first ones are are free but for instance

320
00:16:58,230 --> 00:17:05,430
this one you need to have 1000 candies

321
00:17:01,470 --> 00:17:08,480
to play with it and you can see I have 0

322
00:17:05,430 --> 00:17:12,000
candies at the moment

323
00:17:08,480 --> 00:17:15,680
ok so let's select one I'm going to

324
00:17:12,000 --> 00:17:19,440
choose the Pupkin one because I like it

325
00:17:15,680 --> 00:17:23,340
ok so you don't see it but I'm going to

326
00:17:19,440 --> 00:17:25,260
click on buy and so now it's telling me

327
00:17:23,339 --> 00:17:27,990
hey you need more candy

328
00:17:25,260 --> 00:17:30,930
of course I have 0 candies so I have

329
00:17:27,990 --> 00:17:33,660
three options I can watch a video to

330
00:17:30,930 --> 00:17:38,100
obtain 200 candies but it's not enough I

331
00:17:33,660 --> 00:17:39,840
can ban by 1000 or 10,000 ok so on this

332
00:17:38,100 --> 00:17:43,340
example I'm going to be reasonable I'm

333
00:17:39,840 --> 00:17:46,620
going to click on Leon 1000 candies and

334
00:17:43,340 --> 00:17:50,040
you'll see a pop up but it will not be

335
00:17:46,620 --> 00:17:52,979
the Google Play pop up we can say but

336
00:17:50,040 --> 00:17:55,470
the billing I'd pop up telling me if I

337
00:17:52,980 --> 00:18:03,600
want to buy this item so yeah so pop up

338
00:17:55,470 --> 00:18:05,160
it just for demo purposes okay so you

339
00:18:03,600 --> 00:18:10,399
see the pop up do you wanna get this

340
00:18:05,160 --> 00:18:10,400
attempt for free for sure Aamir for that

341
00:18:11,180 --> 00:18:17,160
and yes

342
00:18:13,650 --> 00:18:21,300
sorry and so yes now you can see I have

343
00:18:17,160 --> 00:18:25,670
1000 candies so that's cool I can buy

344
00:18:21,300 --> 00:18:27,870
this character so that's to the jump

345
00:18:25,670 --> 00:18:31,710
application asking for that if I'm sure

346
00:18:27,870 --> 00:18:33,179
I want to play with Pupkin and now they

347
00:18:31,710 --> 00:18:36,030
are not asking money anymore

348
00:18:33,180 --> 00:18:38,600
I mean Gandhi's in this case and I can

349
00:18:36,030 --> 00:18:38,600
play with it

350
00:18:49,710 --> 00:18:55,350
okay so that's it for

351
00:18:52,080 --> 00:18:58,800
do the jump so you can see do the jump

352
00:18:55,350 --> 00:19:01,230
is like one one in-app payment

353
00:18:58,800 --> 00:19:03,389
validation they are only using the

354
00:19:01,230 --> 00:19:06,920
documentation and don't thinking about

355
00:19:03,390 --> 00:19:09,120
how to to secure the payment process

356
00:19:06,920 --> 00:19:13,440
let's have a look to another example

357
00:19:09,120 --> 00:19:15,510
Snoopy pop so it's a funny game it's

358
00:19:13,440 --> 00:19:18,540
it's pretty similar to a bubble which if

359
00:19:15,510 --> 00:19:21,660
you you know it in fact it's not similar

360
00:19:18,540 --> 00:19:22,320
the same but it with with you're playing

361
00:19:21,660 --> 00:19:25,380
with Snoopy

362
00:19:22,320 --> 00:19:30,210
it's the only different in this game you

363
00:19:25,380 --> 00:19:35,010
can buy coins and leaves as you can see

364
00:19:30,210 --> 00:19:37,710
on the right so on this case a Snoopy

365
00:19:35,010 --> 00:19:40,590
pop they are using the unity library I

366
00:19:37,710 --> 00:19:43,110
guess if you play a lot or not a lot but

367
00:19:40,590 --> 00:19:46,199
if you play video games you can have

368
00:19:43,110 --> 00:19:51,870
heard about this library because there

369
00:19:46,200 --> 00:19:54,120
they it's used for graphics and in this

370
00:19:51,870 --> 00:19:56,610
ramírez offering kind of an interface

371
00:19:54,120 --> 00:19:58,469
also for the google play bidding if you

372
00:19:56,610 --> 00:20:02,729
look at the documentation they say ok we

373
00:19:58,470 --> 00:20:03,660
have two ways to 200 the payment the

374
00:20:02,730 --> 00:20:07,370
validation sorry

375
00:20:03,660 --> 00:20:10,050
you can do it locally or remotely cool

376
00:20:07,370 --> 00:20:12,060
but if you look at the remote validation

377
00:20:10,050 --> 00:20:14,070
you can see I in fact unity does not

378
00:20:12,060 --> 00:20:17,690
offer support for server-side validation

379
00:20:14,070 --> 00:20:22,560
ah too bad

380
00:20:17,690 --> 00:20:26,400
so in fact unity he in the last versions

381
00:20:22,560 --> 00:20:29,070
our mostly develop in mono dotnet and so

382
00:20:26,400 --> 00:20:31,710
this DLL czar am dead under your Android

383
00:20:29,070 --> 00:20:33,750
application if you look on the assets

384
00:20:31,710 --> 00:20:36,390
directory of the Android application at

385
00:20:33,750 --> 00:20:39,020
some point on the manage sub directory

386
00:20:36,390 --> 00:20:43,400
you'll find a lot of the errors and one

387
00:20:39,020 --> 00:20:47,670
interesting called security dot DL a and

388
00:20:43,400 --> 00:20:50,880
because it's dotnet it's cool because we

389
00:20:47,670 --> 00:20:55,620
can recompile it easily without

390
00:20:50,880 --> 00:20:58,080
debugging assembly code for hours and if

391
00:20:55,620 --> 00:21:01,290
you look at this DLL the user function

392
00:20:58,080 --> 00:21:02,309
called validate with the same purpose of

393
00:21:01,290 --> 00:21:05,129
the

394
00:21:02,309 --> 00:21:08,009
verify process method I show you before

395
00:21:05,129 --> 00:21:12,718
which validates the signature of the

396
00:21:08,009 --> 00:21:16,499
process so we can use for instance a

397
00:21:12,719 --> 00:21:19,590
well-known tool called DNS DNS pi which

398
00:21:16,499 --> 00:21:23,369
is a dotnet g compiler so we can obtain

399
00:21:19,590 --> 00:21:28,199
the a shop code without any issue and in

400
00:21:23,369 --> 00:21:30,418
red here you can see that if signature

401
00:21:28,200 --> 00:21:33,179
verification is not good

402
00:21:30,419 --> 00:21:35,700
an exception is thrown called invalid

403
00:21:33,179 --> 00:21:39,989
signature exception and so the payment

404
00:21:35,700 --> 00:21:42,599
is not done okay so no program with the

405
00:21:39,989 --> 00:21:47,460
NS by we can decompile but we can also

406
00:21:42,599 --> 00:21:51,109
modify the dll without an issue so just

407
00:21:47,460 --> 00:21:55,259
remove the lines flowing the exception

408
00:21:51,109 --> 00:21:59,339
recompiles the dll and emptied it on

409
00:21:55,259 --> 00:22:01,169
your application and you can profit so

410
00:21:59,339 --> 00:22:03,509
another demo just to prove I'm not

411
00:22:01,169 --> 00:22:08,639
cheating so yes I can show you quickly

412
00:22:03,509 --> 00:22:11,940
DNS PI so you know it's a security ll

413
00:22:08,639 --> 00:22:14,449
open the compiled on the Google Play

414
00:22:11,940 --> 00:22:18,119
validator class we find the validate

415
00:22:14,450 --> 00:22:23,700
method you know and now you can see is

416
00:22:18,119 --> 00:22:30,109
if a flag up which will return an

417
00:22:23,700 --> 00:22:30,109
exception so just select the lines edit

418
00:22:34,540 --> 00:22:42,159
[Music]

419
00:22:44,780 --> 00:22:48,120
okay that's okay so now we don't have

420
00:22:47,640 --> 00:22:52,170
anymore

421
00:22:48,120 --> 00:22:56,850
the lines throwing an error if the

422
00:22:52,170 --> 00:23:01,560
payment is not done and so after a

423
00:22:56,850 --> 00:23:04,860
packaging your application top you have

424
00:23:01,560 --> 00:23:06,720
my emulator I hope you see well so of

425
00:23:04,860 --> 00:23:11,070
course you launch billing ACK to

426
00:23:06,720 --> 00:23:16,260
impersonate the Google Play app running

427
00:23:11,070 --> 00:23:18,419
in background you launch Snoopy pop okay

428
00:23:16,260 --> 00:23:25,110
you already see I have a lot of coins

429
00:23:18,420 --> 00:23:28,920
and my lives are full I don't have

430
00:23:25,110 --> 00:23:31,229
connect okay fail okay demo gods are not

431
00:23:28,920 --> 00:23:38,190
with me today I forgot to set up

432
00:23:31,230 --> 00:23:47,460
internet you need internet to to to make

433
00:23:38,190 --> 00:23:49,950
payments okay okay I'm going to set

434
00:23:47,460 --> 00:24:01,140
Internet and I'm going back to this to

435
00:23:49,950 --> 00:24:06,510
this demo sorry about that okay so the

436
00:24:01,140 --> 00:24:09,930
last one is fruit ninja which is a

437
00:24:06,510 --> 00:24:13,650
famous game also more than one one

438
00:24:09,930 --> 00:24:16,650
hundred millions of download and so this

439
00:24:13,650 --> 00:24:19,010
one is more we can say more secure

440
00:24:16,650 --> 00:24:22,050
because they use Java native interface

441
00:24:19,010 --> 00:24:23,879
so if you don't know what is a Java a

442
00:24:22,050 --> 00:24:25,860
missive interface in fact in Android

443
00:24:23,880 --> 00:24:28,050
application you can emulate the native

444
00:24:25,860 --> 00:24:30,959
code it means you can obtain in fact

445
00:24:28,050 --> 00:24:35,700
shell libraries usually those libraries

446
00:24:30,960 --> 00:24:38,520
are written in in C or C++ and so the

447
00:24:35,700 --> 00:24:42,630
idea is from your java code you can call

448
00:24:38,520 --> 00:24:45,600
methods on this channel memory so those

449
00:24:42,630 --> 00:24:47,730
functions are pretty easy to find on the

450
00:24:45,600 --> 00:24:50,070
java code because you just have the

451
00:24:47,730 --> 00:24:53,190
definition of the method and the native

452
00:24:50,070 --> 00:24:56,100
keyword is used so it means if you want

453
00:24:53,190 --> 00:24:58,200
to to see the implementation of this

454
00:24:56,100 --> 00:25:01,530
method you need to reverse engineer

455
00:24:58,200 --> 00:25:04,500
the Shan library and in the case of

456
00:25:01,530 --> 00:25:08,399
fruit ninja all the sensitive functions

457
00:25:04,500 --> 00:25:11,640
for the payment our handled by the share

458
00:25:08,400 --> 00:25:13,980
lab library in fact you can see here the

459
00:25:11,640 --> 00:25:16,500
precise result in native and in the

460
00:25:13,980 --> 00:25:21,600
middle is the one performing the

461
00:25:16,500 --> 00:25:25,230
validation of of the payment so I found

462
00:25:21,600 --> 00:25:28,800
the Shan library is pretty easy you need

463
00:25:25,230 --> 00:25:31,590
to be a good reverse engineer I tried I

464
00:25:28,800 --> 00:25:34,830
fail because it was time-consuming and

465
00:25:31,590 --> 00:25:37,830
as I said I'm not really skilled for for

466
00:25:34,830 --> 00:25:42,810
reverse engineering but at some point I

467
00:25:37,830 --> 00:25:46,110
say ok let's try it and see if if it

468
00:25:42,810 --> 00:25:48,120
works and finally it appears that I

469
00:25:46,110 --> 00:25:50,639
don't know what they are doing in the

470
00:25:48,120 --> 00:25:52,979
shell library but the signature of

471
00:25:50,640 --> 00:25:57,360
validation is poly made and so you can

472
00:25:52,980 --> 00:25:58,560
also bypass the payment so normally if I

473
00:25:57,360 --> 00:26:02,510
have internet access

474
00:25:58,560 --> 00:26:12,050
yes it seems ok I can show you so first

475
00:26:02,510 --> 00:26:12,050
always do the jump killing me

476
00:26:41,130 --> 00:26:47,320
you're lucky

477
00:26:42,620 --> 00:26:47,320
don't have the sound so don't complain

478
00:26:48,160 --> 00:26:52,960
my internet connection is not enough

479
00:27:18,330 --> 00:27:28,550
okay let's

480
00:27:20,160 --> 00:27:28,550
ninja okay

481
00:27:33,250 --> 00:27:38,740
so yes you can

482
00:27:35,470 --> 00:27:43,059
you can buy some golden apples and some

483
00:27:38,740 --> 00:27:49,929
stars and so mama Dee let's try with

484
00:27:43,059 --> 00:27:52,629
golden apples just 250 okay I don't know

485
00:27:49,929 --> 00:27:54,870
why there is a bug with the screen it

486
00:27:52,630 --> 00:28:04,049
comes black but at the end you can see

487
00:27:54,870 --> 00:28:04,049
that it's walking and it is the same

488
00:28:04,890 --> 00:28:13,890
okay it doesn't like it okay

489
00:28:24,710 --> 00:28:33,770
okay and so it works let's try again

490
00:28:29,910 --> 00:28:33,770
just to be sure with some people up

491
00:28:42,440 --> 00:28:44,769
okay

492
00:28:54,010 --> 00:29:02,070
I don't know why okay sorry about that

493
00:29:03,600 --> 00:29:12,790
so that's all for for the venerable

494
00:29:08,950 --> 00:29:16,620
application so let's let's go to the

495
00:29:12,790 --> 00:29:18,879
conclusion so as I tried to show you

496
00:29:16,620 --> 00:29:20,530
developers use different techniques to

497
00:29:18,880 --> 00:29:22,990
protect the Google Play billing payment

498
00:29:20,530 --> 00:29:25,389
so sometimes they tried to use

499
00:29:22,990 --> 00:29:27,630
obfuscation from what I see on the

500
00:29:25,390 --> 00:29:30,820
different Android application I tested

501
00:29:27,630 --> 00:29:34,630
shell library you see some shared

502
00:29:30,820 --> 00:29:37,750
libraries in dotnet and other ones on

503
00:29:34,630 --> 00:29:40,990
using native code and sometimes nothing

504
00:29:37,750 --> 00:29:44,800
at all like doodle jump where it there

505
00:29:40,990 --> 00:29:47,470
is no no improvement in insecurity but

506
00:29:44,800 --> 00:29:49,810
yes unfortunately if the signature

507
00:29:47,470 --> 00:29:53,290
validation is only performed locally

508
00:29:49,810 --> 00:29:56,889
inside your application you have you

509
00:29:53,290 --> 00:30:02,730
have no way to to protect Supremes

510
00:29:56,890 --> 00:30:08,410
payment so I test is roughly more than

511
00:30:02,730 --> 00:30:11,460
40 apps 25 apps were never I was able to

512
00:30:08,410 --> 00:30:14,620
bypass payments I can show you all the

513
00:30:11,460 --> 00:30:17,290
Android apps I I found because some of

514
00:30:14,620 --> 00:30:21,639
them didn't respond at all my

515
00:30:17,290 --> 00:30:24,040
solicitation I find only five apps using

516
00:30:21,640 --> 00:30:28,020
an external endpoint to to perform

517
00:30:24,040 --> 00:30:30,250
additional check regarding the payment

518
00:30:28,020 --> 00:30:32,879
or the application I show you I

519
00:30:30,250 --> 00:30:36,660
contacted the editors I contacted ninja

520
00:30:32,880 --> 00:30:39,580
the Snoopy pop and also doodle jump

521
00:30:36,660 --> 00:30:41,890
doodle jump I got I never got an answer

522
00:30:39,580 --> 00:30:45,850
fruit ninja they told me why yes we are

523
00:30:41,890 --> 00:30:48,030
going to fix it still not but there are

524
00:30:45,850 --> 00:30:53,949
some updates but still not fixing this

525
00:30:48,030 --> 00:31:00,399
particular issue and Snoopy pop no

526
00:30:53,950 --> 00:31:02,860
answer also Otto if you compare the

527
00:31:00,400 --> 00:31:05,080
billing the Google Play billing library

528
00:31:02,860 --> 00:31:07,090
you can see that's good

529
00:31:05,080 --> 00:31:10,119
Google is the only one providing a

530
00:31:07,090 --> 00:31:12,519
design we're allowing the local

531
00:31:10,119 --> 00:31:14,619
validation if you look at the Amazon

532
00:31:12,519 --> 00:31:17,409
in-app purchase or Samsung for instance

533
00:31:14,619 --> 00:31:19,779
in approaches you can see under the

534
00:31:17,409 --> 00:31:23,470
documentation that's a requirement is to

535
00:31:19,779 --> 00:31:28,379
use a server to validate the payment and

536
00:31:23,470 --> 00:31:28,379
to retrieve the product you are selling

537
00:31:28,860 --> 00:31:34,869
okay so I just want to thank my check

538
00:31:33,759 --> 00:31:38,980
marks for the support on this project

539
00:31:34,869 --> 00:31:42,840
and yes I think we have plenty of time

540
00:31:38,980 --> 00:31:42,840
for questions if you have some

541
00:31:51,140 --> 00:31:58,559
yeah in fact what I found for instance

542
00:31:55,230 --> 00:32:00,630
there is a newspaper application in fact

543
00:31:58,559 --> 00:32:03,000
when you make the payment I was able to

544
00:32:00,630 --> 00:32:04,860
bypass it but at some point because you

545
00:32:03,000 --> 00:32:09,480
need an account to be authenticated to

546
00:32:04,860 --> 00:32:12,059
retrieve the magazines or to obtain the

547
00:32:09,480 --> 00:32:13,290
access premium feature premium access

548
00:32:12,059 --> 00:32:16,320
sorry

549
00:32:13,290 --> 00:32:18,720
at some point they make the seller is

550
00:32:16,320 --> 00:32:20,909
making a kind of a request to the Google

551
00:32:18,720 --> 00:32:23,280
back-end to be sure that you made the

552
00:32:20,910 --> 00:32:25,290
payment so even if you bypass it locally

553
00:32:23,280 --> 00:32:28,530
at some point there is another check to

554
00:32:25,290 --> 00:32:30,480
be sure okay your premium user I in fact

555
00:32:28,530 --> 00:32:32,879
it doesn't appear you have paid on on

556
00:32:30,480 --> 00:32:37,530
the Google back-end so we are not going

557
00:32:32,880 --> 00:32:40,220
to accept well okay so the technique

558
00:32:37,530 --> 00:32:43,230
process you demonstrate with

559
00:32:40,220 --> 00:32:46,740
so I guess is the jump is it the same

560
00:32:43,230 --> 00:32:48,809
used by apps like Luca Petro yes in fact

561
00:32:46,740 --> 00:32:51,419
it's the same because Luca Petra is also

562
00:32:48,809 --> 00:32:54,210
based on the walk from Dominic Sherman

563
00:32:51,419 --> 00:32:57,710
so in fact if you look at the Luca

564
00:32:54,210 --> 00:32:57,710
Patrick Asian it

565
00:32:58,080 --> 00:33:03,010
it's easy it's based on the same work as

566
00:33:00,880 --> 00:33:08,200
as Dominic so it's based on the bidding

567
00:33:03,010 --> 00:33:10,050
AK application so sort of Ricky Pecha is

568
00:33:08,200 --> 00:33:13,050
just an improvement of the bidding app

569
00:33:10,050 --> 00:33:13,050
application

570
00:33:13,110 --> 00:33:20,080
Danae did any of the application burn

571
00:33:15,940 --> 00:33:22,300
you at the moment I didn't didn't get

572
00:33:20,080 --> 00:33:25,710
this this point of banishment I mean I

573
00:33:22,300 --> 00:33:28,570
also ninja for several times and I

574
00:33:25,710 --> 00:33:31,030
didn't get banished but I don't think

575
00:33:28,570 --> 00:33:34,120
they can banish me because if you are

576
00:33:31,030 --> 00:33:36,040
not using sometimes application are

577
00:33:34,120 --> 00:33:39,429
asking you to use your Google Account to

578
00:33:36,040 --> 00:33:43,840
save your your status if you didn't

579
00:33:39,430 --> 00:33:46,840
don't don't connect you can still use

580
00:33:43,840 --> 00:33:49,959
the application and make payments so I I

581
00:33:46,840 --> 00:33:52,060
don't see any mean any means to to

582
00:33:49,960 --> 00:33:59,550
banish me on the game

583
00:33:52,060 --> 00:33:59,550
[Applause]

