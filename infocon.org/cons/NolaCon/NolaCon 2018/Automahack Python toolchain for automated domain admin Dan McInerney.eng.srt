1
00:00:00,500 --> 00:00:05,250
<font color="#E5E5E5">all</font><font color="#CCCCCC"> right I</font><font color="#E5E5E5"> am here to talk about</font><font color="#CCCCCC"> a tool</font>

2
00:00:03,540 --> 00:00:06,839
I wrote a little earlier this year and

3
00:00:05,250 --> 00:00:08,700
<font color="#E5E5E5">just released called</font><font color="#CCCCCC"> icebreaker</font><font color="#E5E5E5"> it's a</font>

4
00:00:06,839 --> 00:00:12,179
Python<font color="#E5E5E5"> tool for getting</font><font color="#CCCCCC"> a foothold</font><font color="#E5E5E5"> on</font>

5
00:00:08,700 --> 00:00:13,829
Active Directory<font color="#E5E5E5"> networks my name is Dan</font>

6
00:00:12,179 --> 00:00:15,929
McInerney I'm a senior pen tester and

7
00:00:13,830 --> 00:00:18,570
researcher<font color="#E5E5E5"> at coal fire</font><font color="#CCCCCC"> Coal Fired it'd</font>

8
00:00:15,929 --> 00:00:19,800
give me<font color="#CCCCCC"> quite</font><font color="#E5E5E5"> a bit of time</font><font color="#CCCCCC"> paid</font><font color="#E5E5E5"> to work</font>

9
00:00:18,570 --> 00:00:22,859
on this<font color="#E5E5E5"> which is</font><font color="#CCCCCC"> what I'm giving them a</font>

10
00:00:19,800 --> 00:00:25,109
shout out<font color="#CCCCCC"> about</font><font color="#E5E5E5"> half of it was my own</font>

11
00:00:22,859 --> 00:00:26,400
time half was about<font color="#E5E5E5"> coal fire time I've</font>

12
00:00:25,109 --> 00:00:28,500
been with them for<font color="#CCCCCC"> a few years and</font>

13
00:00:26,400 --> 00:00:31,169
<font color="#E5E5E5">that's my github</font><font color="#CCCCCC"> dan McInerney pretty</font>

14
00:00:28,500 --> 00:00:33,480
<font color="#E5E5E5">simple it's one of the top 100 most</font>

15
00:00:31,170 --> 00:00:34,950
popular Python accounts<font color="#E5E5E5"> in the world</font>

16
00:00:33,480 --> 00:00:37,680
<font color="#CCCCCC">just going to give myself a little pat</font>

17
00:00:34,950 --> 00:00:40,829
<font color="#CCCCCC">on the back there this</font><font color="#E5E5E5"> is the overview</font>

18
00:00:37,680 --> 00:00:43,860
<font color="#E5E5E5">of the tool so in order to set it up all</font>

19
00:00:40,829 --> 00:00:47,670
you do is get clone it<font color="#E5E5E5"> and then you CD</font>

20
00:00:43,860 --> 00:00:49,950
into<font color="#E5E5E5"> the directory and run the setup</font>

21
00:00:47,670 --> 00:00:52,559
script after<font color="#CCCCCC"> you've</font><font color="#E5E5E5"> run the setup script</font>

22
00:00:49,950 --> 00:00:54,180
<font color="#E5E5E5">you do pip end which is a new Python</font>

23
00:00:52,559 --> 00:00:56,519
packaging tool which makes<font color="#CCCCCC"> it easier to</font>

24
00:00:54,180 --> 00:00:57,600
<font color="#E5E5E5">use virtual environments</font><font color="#CCCCCC"> and that way it</font>

25
00:00:56,520 --> 00:00:59,609
doesn't<font color="#E5E5E5"> mess up your system quite so</font>

26
00:00:57,600 --> 00:01:02,520
much<font color="#E5E5E5"> and then hit them shell and then</font>

27
00:00:59,609 --> 00:01:06,720
you can<font color="#CCCCCC"> actually run the tool</font>

28
00:01:02,520 --> 00:01:08,760
one issue that<font color="#CCCCCC"> icebreaker has I'm</font><font color="#E5E5E5"> going</font>

29
00:01:06,720 --> 00:01:09,900
<font color="#E5E5E5">to start off with</font><font color="#CCCCCC"> the disadvantage is</font>

30
00:01:08,760 --> 00:01:12,390
<font color="#E5E5E5">the installation process takes a while</font>

31
00:01:09,900 --> 00:01:16,920
<font color="#E5E5E5">so if you're on a low resource machine</font>

32
00:01:12,390 --> 00:01:18,060
then it can take I mean low resource

33
00:01:16,920 --> 00:01:19,680
with bad internet<font color="#E5E5E5"> connection</font><font color="#CCCCCC"> you're</font>

34
00:01:18,060 --> 00:01:21,750
looking at like a<font color="#E5E5E5"> half an hour for the</font>

35
00:01:19,680 --> 00:01:23,280
install<font color="#CCCCCC"> or more so I'm working on</font>

36
00:01:21,750 --> 00:01:24,030
<font color="#E5E5E5">getting this docker eyes anybody wants</font>

37
00:01:23,280 --> 00:01:25,439
to help<font color="#E5E5E5"> me with</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I don't know</font>

38
00:01:24,030 --> 00:01:27,080
<font color="#E5E5E5">anything about docker but they were</font><font color="#CCCCCC"> just</font>

39
00:01:25,439 --> 00:01:30,179
<font color="#E5E5E5">gonna</font><font color="#CCCCCC"> make this a lot easier to install</font>

40
00:01:27,080 --> 00:01:32,759
the script<font color="#E5E5E5"> is largely just glue between</font>

41
00:01:30,180 --> 00:01:35,850
<font color="#E5E5E5">already known techniques and attacks</font>

42
00:01:32,759 --> 00:01:37,619
it's not brand new<font color="#E5E5E5"> research or attacks</font>

43
00:01:35,850 --> 00:01:39,600
it just makes the<font color="#CCCCCC"> whole</font><font color="#E5E5E5"> process of</font>

44
00:01:37,619 --> 00:01:42,540
getting<font color="#E5E5E5"> Active Directory plaintext</font>

45
00:01:39,600 --> 00:01:45,780
passwords<font color="#CCCCCC"> a lot easier this is sort of</font>

46
00:01:42,540 --> 00:01:47,670
the the base I'm not<font color="#E5E5E5"> gonna do a lot of</font>

47
00:01:45,780 --> 00:01:50,100
<font color="#E5E5E5">Python code teaching here but this is</font>

48
00:01:47,670 --> 00:01:52,350
sort<font color="#E5E5E5"> of what it's what</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> based on</font>

49
00:01:50,100 --> 00:01:54,329
<font color="#CCCCCC">sub-process is a library for python</font><font color="#E5E5E5"> that</font>

50
00:01:52,350 --> 00:01:55,860
lets you<font color="#CCCCCC"> make system calls now I'm</font><font color="#E5E5E5"> sure</font>

51
00:01:54,329 --> 00:01:56,969
if any Python<font color="#CCCCCC"> East Azure in here you're</font>

52
00:01:55,860 --> 00:01:58,649
<font color="#E5E5E5">probably looking at that and</font><font color="#CCCCCC"> thinking</font>

53
00:01:56,969 --> 00:02:00,240
you know<font color="#E5E5E5"> that's not all that impressive</font>

54
00:01:58,649 --> 00:02:01,560
<font color="#CCCCCC">you're you might as</font><font color="#E5E5E5"> well just use a bash</font>

55
00:02:00,240 --> 00:02:03,509
script<font color="#CCCCCC"> if</font><font color="#E5E5E5"> you're just calling a system</font>

56
00:02:01,560 --> 00:02:06,180
calls but there's a lot<font color="#E5E5E5"> of complexities</font>

57
00:02:03,509 --> 00:02:08,160
I added into this that<font color="#E5E5E5"> that make it</font>

58
00:02:06,180 --> 00:02:10,530
worthwhile to<font color="#CCCCCC"> do it in Python</font><font color="#E5E5E5"> namely</font>

59
00:02:08,160 --> 00:02:11,900
<font color="#E5E5E5">asynchronicity</font><font color="#CCCCCC"> so I can do concurrent</font>

60
00:02:10,530 --> 00:02:14,510
programming I can

61
00:02:11,900 --> 00:02:16,549
<font color="#CCCCCC">test</font><font color="#E5E5E5"> usernames concurrently in parallel</font>

62
00:02:14,510 --> 00:02:18,230
<font color="#CCCCCC">so there's a</font><font color="#E5E5E5"> bunch of reasons for why I</font>

63
00:02:16,549 --> 00:02:20,360
wrote<font color="#E5E5E5"> this in Python not just a silly</font>

64
00:02:18,230 --> 00:02:22,640
<font color="#E5E5E5">little batch script but this is the the</font>

65
00:02:20,360 --> 00:02:24,440
basis of how it works<font color="#E5E5E5"> it's calling other</font>

66
00:02:22,640 --> 00:02:25,970
tools and then I also have the whole

67
00:02:24,440 --> 00:02:27,530
thing<font color="#E5E5E5"> packaged up so all those tools</font>

68
00:02:25,970 --> 00:02:29,629
come with<font color="#CCCCCC"> icebreaker</font><font color="#E5E5E5"> you don't have to</font>

69
00:02:27,530 --> 00:02:31,730
go out and<font color="#CCCCCC"> manually get clone responder</font>

70
00:02:29,629 --> 00:02:33,590
and get clone<font color="#E5E5E5"> ready</font><font color="#CCCCCC"> nom and all the</font>

71
00:02:31,730 --> 00:02:35,359
tools<font color="#E5E5E5"> that use this everything just</font>

72
00:02:33,590 --> 00:02:37,310
comes<font color="#E5E5E5"> already built in</font>

73
00:02:35,360 --> 00:02:39,290
including the password cracker<font color="#CCCCCC"> so it</font>

74
00:02:37,310 --> 00:02:40,700
comes with<font color="#E5E5E5"> John the Ripper it will</font>

75
00:02:39,290 --> 00:02:43,250
automatically compile that<font color="#E5E5E5"> through the</font>

76
00:02:40,700 --> 00:02:44,869
setup<font color="#E5E5E5"> script that way it's just</font><font color="#CCCCCC"> nice and</font>

77
00:02:43,250 --> 00:02:46,459
<font color="#E5E5E5">simple the installation is not anything</font>

78
00:02:44,870 --> 00:02:52,250
<font color="#E5E5E5">farther than running the setup script</font>

79
00:02:46,459 --> 00:02:53,870
<font color="#CCCCCC">Pip</font><font color="#E5E5E5"> and Ben stall and pip bombshell so</font>

80
00:02:52,250 --> 00:02:55,760
it does five different<font color="#CCCCCC"> Network attacks</font>

81
00:02:53,870 --> 00:02:57,560
<font color="#CCCCCC">the scenario that</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> want to use</font>

82
00:02:55,760 --> 00:03:00,010
<font color="#CCCCCC">icebreaker for is when you are on an</font>

83
00:02:57,560 --> 00:03:02,989
internal<font color="#CCCCCC"> network that's</font><font color="#E5E5E5"> Active Directory</font>

84
00:03:00,010 --> 00:03:05,000
<font color="#CCCCCC">but you don't have any passwords so like</font>

85
00:03:02,989 --> 00:03:06,680
you're<font color="#E5E5E5"> just a Kali Linux box</font><font color="#CCCCCC"> on an</font>

86
00:03:05,000 --> 00:03:07,430
internal<font color="#E5E5E5"> network</font><font color="#CCCCCC"> but you have no</font><font color="#E5E5E5"> access</font>

87
00:03:06,680 --> 00:03:10,190
to<font color="#E5E5E5"> the Active Directory environment</font>

88
00:03:07,430 --> 00:03:12,440
whatsoever<font color="#CCCCCC"> this will get you access</font><font color="#E5E5E5"> to</font>

89
00:03:10,190 --> 00:03:14,120
the Active<font color="#E5E5E5"> Directory environment it does</font>

90
00:03:12,440 --> 00:03:16,430
five different<font color="#E5E5E5"> attacks to get plaintext</font>

91
00:03:14,120 --> 00:03:17,510
credentials and ntlm hashes<font color="#E5E5E5"> which are</font>

92
00:03:16,430 --> 00:03:19,669
the equipment more<font color="#E5E5E5"> or less the</font>

93
00:03:17,510 --> 00:03:24,290
equivalent<font color="#CCCCCC"> of passwords</font><font color="#E5E5E5"> the first attack</font>

94
00:03:19,669 --> 00:03:25,940
<font color="#E5E5E5">is the nice simple and fast</font><font color="#CCCCCC"> rid cycling</font>

95
00:03:24,290 --> 00:03:27,739
<font color="#E5E5E5">into reverse brute-force so reverse</font>

96
00:03:25,940 --> 00:03:28,579
<font color="#E5E5E5">brute-force is when you take a short</font>

97
00:03:27,739 --> 00:03:30,560
list of names

98
00:03:28,579 --> 00:03:31,940
I'm sorry short list of passwords<font color="#CCCCCC"> and a</font>

99
00:03:30,560 --> 00:03:33,530
long list<font color="#E5E5E5"> of names and you just test</font>

100
00:03:31,940 --> 00:03:34,940
those that short list<font color="#CCCCCC"> of passwords</font>

101
00:03:33,530 --> 00:03:36,560
<font color="#E5E5E5">against those names</font><font color="#CCCCCC"> the reason we're</font>

102
00:03:34,940 --> 00:03:38,209
doing<font color="#CCCCCC"> that and</font><font color="#E5E5E5"> not an actual brute force</font>

103
00:03:36,560 --> 00:03:40,430
<font color="#E5E5E5">is because brute forces tend to lock</font>

104
00:03:38,209 --> 00:03:42,949
systems out so we are<font color="#E5E5E5"> doing just two</font>

105
00:03:40,430 --> 00:03:44,989
<font color="#E5E5E5">passwords per username the way it finds</font>

106
00:03:42,949 --> 00:03:48,169
<font color="#E5E5E5">user names to actually brute force is a</font>

107
00:03:44,989 --> 00:03:52,370
it looks for null sessions<font color="#CCCCCC"> in</font><font color="#E5E5E5"> all SMB</font>

108
00:03:48,169 --> 00:03:54,019
sessions and<font color="#CCCCCC"> be it will if you give it</font>

109
00:03:52,370 --> 00:03:55,669
like a domain name<font color="#E5E5E5"> it'll go out to</font><font color="#CCCCCC"> that</font>

110
00:03:54,019 --> 00:03:57,139
domain<font color="#CCCCCC"> names great email addresses and</font>

111
00:03:55,669 --> 00:03:59,720
<font color="#E5E5E5">then use the email the first half of the</font>

112
00:03:57,139 --> 00:04:02,120
email address as the<font color="#CCCCCC"> username</font><font color="#E5E5E5"> because</font>

113
00:03:59,720 --> 00:04:05,569
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> pretty common in corporate</font>

114
00:04:02,120 --> 00:04:08,180
<font color="#CCCCCC">environments so</font><font color="#E5E5E5"> rid cycling is pretty</font>

115
00:04:05,569 --> 00:04:09,708
cool<font color="#CCCCCC"> it hunts for null sessions</font><font color="#E5E5E5"> first of</font>

116
00:04:08,180 --> 00:04:12,190
all no SMB sessions are when you can

117
00:04:09,709 --> 00:04:14,329
connect to a remote<font color="#E5E5E5"> Windows computer and</font>

118
00:04:12,190 --> 00:04:17,029
query it for information<font color="#CCCCCC"> and stuff</font>

119
00:04:14,329 --> 00:04:19,789
<font color="#E5E5E5">through the SMB protocol you can query</font>

120
00:04:17,029 --> 00:04:21,469
it<font color="#E5E5E5"> for</font><font color="#CCCCCC"> usernames what you do is</font>

121
00:04:19,789 --> 00:04:23,840
something<font color="#E5E5E5"> called</font><font color="#CCCCCC"> read cycling so every</font>

122
00:04:21,469 --> 00:04:25,460
account<font color="#E5E5E5"> on the computer will</font><font color="#CCCCCC"> have a SID</font>

123
00:04:23,840 --> 00:04:26,780
and a Sid<font color="#E5E5E5"> is a thing</font>

124
00:04:25,460 --> 00:04:28,669
<font color="#CCCCCC">you already</font><font color="#E5E5E5"> identify or something and</font>

125
00:04:26,780 --> 00:04:30,650
it's a big long string of<font color="#CCCCCC"> numbers</font><font color="#E5E5E5"> and</font>

126
00:04:28,669 --> 00:04:33,139
<font color="#CCCCCC">letters and</font><font color="#E5E5E5"> at the very end it'll say -</font>

127
00:04:30,650 --> 00:04:34,729
and<font color="#E5E5E5"> then a number and the</font><font color="#CCCCCC"> first</font><font color="#E5E5E5"> number</font>

128
00:04:33,139 --> 00:04:36,830
that<font color="#E5E5E5"> it starts out is 500 that's the</font>

129
00:04:34,729 --> 00:04:40,508
<font color="#CCCCCC">built-in local admin</font><font color="#E5E5E5"> so the</font><font color="#CCCCCC"> SID is</font><font color="#E5E5E5"> this</font>

130
00:04:36,830 --> 00:04:42,979
long string - 500 that's<font color="#E5E5E5"> local admin the</font>

131
00:04:40,509 --> 00:04:44,810
users will start at a thousand<font color="#CCCCCC"> so it'll</font>

132
00:04:42,979 --> 00:04:46,310
<font color="#E5E5E5">be a little</font><font color="#CCCCCC"> bit longer number</font><font color="#E5E5E5"> - 1000</font>

133
00:04:44,810 --> 00:04:48,650
will be a user and you can ask through

134
00:04:46,310 --> 00:04:51,770
null sessions<font color="#E5E5E5"> what is the user</font><font color="#CCCCCC"> name of</font>

135
00:04:48,650 --> 00:04:53,989
this person<font color="#E5E5E5"> with the grid is that final</font>

136
00:04:51,770 --> 00:04:55,969
number<font color="#E5E5E5"> the SID is the full thing rid is</font>

137
00:04:53,990 --> 00:04:57,620
the final<font color="#E5E5E5"> number what's the user name</font>

138
00:04:55,970 --> 00:04:58,910
with that<font color="#E5E5E5"> final</font><font color="#CCCCCC"> writ and you can just</font>

139
00:04:57,620 --> 00:05:00,289
cycle through<font color="#CCCCCC"> all</font><font color="#E5E5E5"> the ribs because you</font>

140
00:04:58,910 --> 00:05:02,240
know they start<font color="#CCCCCC"> at 1000 so you can just</font>

141
00:05:00,289 --> 00:05:04,400
<font color="#E5E5E5">start on 1000 and go up to like 50,000</font>

142
00:05:02,240 --> 00:05:06,289
<font color="#E5E5E5">and get everyone's</font><font color="#CCCCCC"> user names</font><font color="#E5E5E5"> that's how</font>

143
00:05:04,400 --> 00:05:08,239
it finds<font color="#E5E5E5"> user names then we</font>

144
00:05:06,289 --> 00:05:10,789
asynchronously test<font color="#E5E5E5"> all of</font><font color="#CCCCCC"> these user</font>

145
00:05:08,240 --> 00:05:12,800
names<font color="#E5E5E5"> using two passwords</font><font color="#CCCCCC"> and these are</font>

146
00:05:10,789 --> 00:05:14,240
the most effective<font color="#E5E5E5"> two passwords</font><font color="#CCCCCC"> on ADA</font>

147
00:05:12,800 --> 00:05:15,620
environments<font color="#E5E5E5"> that I have ever seen and</font>

148
00:05:14,240 --> 00:05:19,009
<font color="#E5E5E5">I've been working in a tea environments</font>

149
00:05:15,620 --> 00:05:21,949
for<font color="#E5E5E5"> years</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> password with an</font><font color="#CCCCCC"> at and a</font>

150
00:05:19,009 --> 00:05:24,620
zero<font color="#E5E5E5"> and</font><font color="#CCCCCC"> it's season and year like</font>

151
00:05:21,949 --> 00:05:26,360
spring 2018<font color="#CCCCCC"> so this tool has built-in</font>

152
00:05:24,620 --> 00:05:28,000
capabilities to detect what season it is

153
00:05:26,360 --> 00:05:31,820
<font color="#E5E5E5">and then it'll automatically look for</font>

154
00:05:28,000 --> 00:05:34,789
password<font color="#CCCCCC"> user names</font><font color="#E5E5E5"> that allow the</font>

155
00:05:31,820 --> 00:05:36,050
password spring 2018<font color="#E5E5E5"> but right now you</font>

156
00:05:34,789 --> 00:05:36,830
know last season<font color="#E5E5E5"> they would say winter</font>

157
00:05:36,050 --> 00:05:38,990
<font color="#E5E5E5">2018</font>

158
00:05:36,830 --> 00:05:40,609
so it's not statically<font color="#CCCCCC"> spring 2018</font><font color="#E5E5E5"> it's</font>

159
00:05:38,990 --> 00:05:41,180
<font color="#E5E5E5">whatever the actual season is is how</font>

160
00:05:40,610 --> 00:05:43,810
<font color="#E5E5E5">this</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> work</font>

161
00:05:41,180 --> 00:05:46,219
<font color="#E5E5E5">you can also use a custom password list</font>

162
00:05:43,810 --> 00:05:48,289
<font color="#CCCCCC">I'd like just stick into</font><font color="#E5E5E5"> the first two</font>

163
00:05:46,219 --> 00:05:50,000
those first two<font color="#CCCCCC"> passwords are extremely</font>

164
00:05:48,289 --> 00:05:53,719
effective<font color="#CCCCCC"> if you can get a long username</font>

165
00:05:50,000 --> 00:05:56,479
list<font color="#CCCCCC"> man I'm gonna say like if you can</font>

166
00:05:53,719 --> 00:05:58,280
get maybe 30 to<font color="#E5E5E5"> 50 users there's a</font>

167
00:05:56,479 --> 00:05:59,870
excellent<font color="#E5E5E5"> chance</font><font color="#CCCCCC"> that one of those</font><font color="#E5E5E5"> two</font>

168
00:05:58,280 --> 00:06:01,638
<font color="#CCCCCC">passwords is going to pop back out</font><font color="#E5E5E5"> which</font>

169
00:05:59,870 --> 00:06:03,530
is<font color="#CCCCCC"> fantastic and</font><font color="#E5E5E5"> then you have the</font>

170
00:06:01,639 --> 00:06:05,180
<font color="#CCCCCC">plaintext cred for a username</font><font color="#E5E5E5"> and then</font>

171
00:06:03,530 --> 00:06:07,159
you can you know pump those creds<font color="#CCCCCC"> into</font>

172
00:06:05,180 --> 00:06:12,860
bloodhound and work<font color="#E5E5E5"> your way through</font><font color="#CCCCCC"> if</font>

173
00:06:07,159 --> 00:06:14,810
you want to do<font color="#E5E5E5"> that you</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> synchronously</font>

174
00:06:12,860 --> 00:06:18,199
tests it using I think<font color="#CCCCCC"> 10 different jobs</font>

175
00:06:14,810 --> 00:06:19,639
at once<font color="#E5E5E5"> so it's pretty fast</font><font color="#CCCCCC"> it does that</font>

176
00:06:18,199 --> 00:06:21,409
attack first because<font color="#CCCCCC"> of that</font><font color="#E5E5E5"> that attack</font>

177
00:06:19,639 --> 00:06:23,300
is generally<font color="#CCCCCC"> pretty fast</font><font color="#E5E5E5"> this is what it</font>

178
00:06:21,409 --> 00:06:24,530
looks<font color="#E5E5E5"> like in use you can see it'll say</font>

179
00:06:23,300 --> 00:06:26,300
<font color="#E5E5E5">you we're doing attack</font><font color="#CCCCCC"> 1 we're checking</font>

180
00:06:24,530 --> 00:06:29,119
<font color="#CCCCCC">for no</font><font color="#E5E5E5"> no sessions</font><font color="#CCCCCC"> it found an old</font>

181
00:06:26,300 --> 00:06:31,250
session on<font color="#CCCCCC"> tend up 2.0 to 99 which then</font>

182
00:06:29,120 --> 00:06:34,639
gives it the domain name<font color="#CCCCCC"> it also gives</font>

183
00:06:31,250 --> 00:06:36,029
it<font color="#E5E5E5"> the user names and it brute forces</font>

184
00:06:34,639 --> 00:06:38,229
them pretty quick

185
00:06:36,029 --> 00:06:40,689
the second attack it does to<font color="#E5E5E5"> get</font>

186
00:06:38,229 --> 00:06:42,219
<font color="#E5E5E5">plaintext to</font><font color="#CCCCCC"> get passwords is the SCF</font>

187
00:06:40,689 --> 00:06:43,719
attack<font color="#E5E5E5"> this is one that a</font><font color="#CCCCCC"> lot of people</font>

188
00:06:42,219 --> 00:06:47,319
<font color="#E5E5E5">actually don't seem to know this is</font>

189
00:06:43,719 --> 00:06:49,509
<font color="#E5E5E5">probably the most what's the word I</font>

190
00:06:47,319 --> 00:06:52,059
don't know rarest known attack that uses

191
00:06:49,509 --> 00:06:54,579
<font color="#CCCCCC">but</font><font color="#E5E5E5"> it's really simple Windows has a</font>

192
00:06:52,059 --> 00:06:56,709
strange file type called<font color="#CCCCCC"> SCF it stands</font>

193
00:06:54,579 --> 00:06:58,449
for shell command file<font color="#E5E5E5"> and I keep</font>

194
00:06:56,709 --> 00:07:01,359
wanting to<font color="#E5E5E5"> say SDF file but that's like</font>

195
00:06:58,449 --> 00:07:05,169
saying ATM machine<font color="#E5E5E5"> the SCF is a very</font>

196
00:07:01,359 --> 00:07:06,748
short file that you can tell it<font color="#E5E5E5"> to find</font>

197
00:07:05,169 --> 00:07:08,889
an icon<font color="#E5E5E5"> somewhere in the network</font>

198
00:07:06,749 --> 00:07:12,039
<font color="#CCCCCC">normally these files are used</font><font color="#E5E5E5"> for things</font>

199
00:07:08,889 --> 00:07:13,899
like opening<font color="#E5E5E5"> up</font><font color="#CCCCCC"> Explorer</font><font color="#E5E5E5"> just simple</font>

200
00:07:12,039 --> 00:07:15,699
<font color="#E5E5E5">little things like that open Explorer to</font>

201
00:07:13,899 --> 00:07:17,079
a certain folder like<font color="#E5E5E5"> silly little</font>

202
00:07:15,699 --> 00:07:18,759
things<font color="#E5E5E5"> I'm not even sure why this exists</font>

203
00:07:17,079 --> 00:07:20,619
<font color="#E5E5E5">but</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can tell it to have an icon</font>

204
00:07:18,759 --> 00:07:22,419
<font color="#E5E5E5">inside the file and</font><font color="#CCCCCC"> if you tell it to</font>

205
00:07:20,619 --> 00:07:25,659
have that icon hosted on your<font color="#E5E5E5"> own</font>

206
00:07:22,419 --> 00:07:28,539
attacking machine whenever<font color="#E5E5E5"> someone opens</font>

207
00:07:25,659 --> 00:07:31,209
a<font color="#CCCCCC"> user</font><font color="#E5E5E5"> file share that has this SCF file</font>

208
00:07:28,539 --> 00:07:33,729
on<font color="#E5E5E5"> it</font><font color="#CCCCCC"> their SMB hash is being sent to</font>

209
00:07:31,209 --> 00:07:36,489
you which<font color="#CCCCCC"> I don't get</font><font color="#E5E5E5"> it it's it's</font>

210
00:07:33,729 --> 00:07:37,899
absolutely<font color="#CCCCCC"> ridiculous but it is the way</font>

211
00:07:36,489 --> 00:07:39,969
Microsoft did it<font color="#E5E5E5"> so Microsoft patched</font>

212
00:07:37,899 --> 00:07:42,610
this<font color="#CCCCCC"> only</font><font color="#E5E5E5"> for Windows 10 it is not</font>

213
00:07:39,969 --> 00:07:43,539
patched for Windows 8 or<font color="#CCCCCC"> 7 or you know</font>

214
00:07:42,610 --> 00:07:46,209
any of<font color="#CCCCCC"> these other ones</font>

215
00:07:43,539 --> 00:07:47,829
<font color="#E5E5E5">so what</font><font color="#CCCCCC"> Icebreaker does</font><font color="#E5E5E5"> after</font><font color="#CCCCCC"> does a</font>

216
00:07:46,209 --> 00:07:49,239
reverse brute-force finds<font color="#E5E5E5"> username to</font>

217
00:07:47,829 --> 00:07:50,379
the reverse<font color="#E5E5E5"> brute force will say it</font>

218
00:07:49,239 --> 00:07:52,448
<font color="#CCCCCC">doesn't find</font><font color="#E5E5E5"> anything</font><font color="#CCCCCC"> it moves on to</font>

219
00:07:50,379 --> 00:07:54,249
<font color="#E5E5E5">attack - attack - it's gonna find all</font>

220
00:07:52,449 --> 00:07:55,599
anonymously readable and<font color="#CCCCCC"> writable</font>

221
00:07:54,249 --> 00:07:57,189
<font color="#CCCCCC">Network share it's actually just</font>

222
00:07:55,599 --> 00:07:59,049
writable not necessarily readable<font color="#E5E5E5"> but</font>

223
00:07:57,189 --> 00:08:02,889
all anonymously writable<font color="#E5E5E5"> Network shares</font>

224
00:07:59,049 --> 00:08:04,619
<font color="#E5E5E5">and it will upload an</font><font color="#CCCCCC"> SCS SCF file</font><font color="#E5E5E5"> an</font>

225
00:08:02,889 --> 00:08:07,299
<font color="#E5E5E5">SDF this is what it looks like</font>

226
00:08:04,619 --> 00:08:08,769
<font color="#E5E5E5">it just says shell command - and the</font>

227
00:08:07,299 --> 00:08:10,659
icon files where it actually<font color="#CCCCCC"> matters</font>

228
00:08:08,769 --> 00:08:13,689
that's the attacker machine<font color="#CCCCCC"> that's my</font>

229
00:08:10,659 --> 00:08:15,519
machine<font color="#E5E5E5"> the Icebreaker machine so we'll</font>

230
00:08:13,689 --> 00:08:17,169
tell it<font color="#CCCCCC"> so we'll upload that file</font><font color="#E5E5E5"> to all</font>

231
00:08:15,519 --> 00:08:17,859
the file shares<font color="#E5E5E5"> anytime anyone opens up</font>

232
00:08:17,169 --> 00:08:19,299
that file share

233
00:08:17,859 --> 00:08:20,709
they don't even click this link they

234
00:08:19,299 --> 00:08:22,149
don't have to click<font color="#E5E5E5"> on this file</font><font color="#CCCCCC"> they</font>

235
00:08:20,709 --> 00:08:23,739
don't have to even<font color="#E5E5E5"> know this file exists</font>

236
00:08:22,149 --> 00:08:24,999
<font color="#E5E5E5">they just need to</font><font color="#CCCCCC"> open the file share</font>

237
00:08:23,739 --> 00:08:28,209
where this thing<font color="#CCCCCC"> is held and</font><font color="#E5E5E5"> you have</font>

238
00:08:24,999 --> 00:08:31,839
their<font color="#CCCCCC"> SMB hash so Icebreaker</font><font color="#E5E5E5"> you can't</font>

239
00:08:28,209 --> 00:08:33,490
actually pass a net ntlm hash which is

240
00:08:31,839 --> 00:08:35,409
what you're gonna get from<font color="#CCCCCC"> this you can</font>

241
00:08:33,490 --> 00:08:36,549
<font color="#E5E5E5">crack it though so</font><font color="#CCCCCC"> icebreaker</font>

242
00:08:35,409 --> 00:08:38,740
automatically<font color="#E5E5E5"> does password cracking</font>

243
00:08:36,549 --> 00:08:40,058
<font color="#CCCCCC">anytime it gets any kind of net ntlm</font>

244
00:08:38,740 --> 00:08:43,029
hash it'll automatically try and crack

245
00:08:40,058 --> 00:08:44,889
it<font color="#E5E5E5"> using a custom word list and that</font>

246
00:08:43,029 --> 00:08:46,809
custom word list comes from the<font color="#E5E5E5"> github</font>

247
00:08:44,889 --> 00:08:49,570
account<font color="#CCCCCC"> SEK lists</font><font color="#E5E5E5"> I took every password</font>

248
00:08:46,809 --> 00:08:51,880
<font color="#CCCCCC">insect lists and then</font><font color="#E5E5E5"> I</font>

249
00:08:49,570 --> 00:08:55,030
got rid<font color="#CCCCCC"> of everything that</font><font color="#E5E5E5"> was under</font>

250
00:08:51,880 --> 00:08:57,280
<font color="#CCCCCC">seven</font><font color="#E5E5E5"> characters over 32 characters all</font>

251
00:08:55,030 --> 00:08:59,740
lowercase<font color="#CCCCCC"> all uppercase</font><font color="#E5E5E5"> all numbers all</font>

252
00:08:57,280 --> 00:09:01,420
<font color="#E5E5E5">that's gone so now the password list is</font>

253
00:08:59,740 --> 00:09:05,080
down to<font color="#E5E5E5"> about a million passwords</font><font color="#CCCCCC"> and</font>

254
00:09:01,420 --> 00:09:06,699
they're all default<font color="#E5E5E5"> ad compliant we</font>

255
00:09:05,080 --> 00:09:08,350
don't want to be testing passwords<font color="#CCCCCC"> like</font>

256
00:09:06,700 --> 00:09:10,780
<font color="#CCCCCC">one two three four five six</font><font color="#E5E5E5"> that's not</font>

257
00:09:08,350 --> 00:09:12,580
valid on default<font color="#E5E5E5"> ad environments so we</font>

258
00:09:10,780 --> 00:09:14,709
have this nice short concise password

259
00:09:12,580 --> 00:09:15,820
list that<font color="#CCCCCC"> only works</font><font color="#E5E5E5"> that's very</font>

260
00:09:14,710 --> 00:09:17,230
specific<font color="#E5E5E5"> to Active Directory environment</font>

261
00:09:15,820 --> 00:09:21,610
so<font color="#CCCCCC"> that makes password cracking much</font>

262
00:09:17,230 --> 00:09:24,400
much faster this<font color="#E5E5E5"> is what it looks like</font>

263
00:09:21,610 --> 00:09:26,290
<font color="#E5E5E5">in action</font><font color="#CCCCCC"> it'll just say rideable share</font>

264
00:09:24,400 --> 00:09:27,699
found succesfully wrote it

265
00:09:26,290 --> 00:09:29,589
it'll<font color="#E5E5E5"> make sure that the file is</font>

266
00:09:27,700 --> 00:09:32,320
uploaded<font color="#CCCCCC"> by then querying the file share</font>

267
00:09:29,590 --> 00:09:33,580
to see if the file is there and they'll

268
00:09:32,320 --> 00:09:35,710
say<font color="#E5E5E5"> all</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> great everything worked</font>

269
00:09:33,580 --> 00:09:39,340
great<font color="#CCCCCC"> now we're</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> wait</font><font color="#CCCCCC"> for</font>

270
00:09:35,710 --> 00:09:41,800
someone<font color="#E5E5E5"> to open</font><font color="#CCCCCC"> that file share attack</font>

271
00:09:39,340 --> 00:09:43,900
number<font color="#E5E5E5"> three</font><font color="#CCCCCC"> again the first</font><font color="#E5E5E5"> two attacks</font>

272
00:09:41,800 --> 00:09:45,760
<font color="#E5E5E5">are currently fast just expect a minute</font>

273
00:09:43,900 --> 00:09:47,560
or two<font color="#CCCCCC"> of the SCF one</font><font color="#E5E5E5"> doesn't even</font><font color="#CCCCCC"> take</font>

274
00:09:45,760 --> 00:09:48,730
a<font color="#E5E5E5"> minute attack number three to linger a</font>

275
00:09:47,560 --> 00:09:51,969
little<font color="#CCCCCC"> bit this is where it's</font><font color="#E5E5E5"> gonna be</font>

276
00:09:48,730 --> 00:09:54,850
<font color="#E5E5E5">doing responder responder is a really</font>

277
00:09:51,970 --> 00:09:56,050
cool poisoning tool that<font color="#CCCCCC"> Laurel Gaffey</font>

278
00:09:54,850 --> 00:09:57,370
wrote<font color="#E5E5E5"> I don't know if I'm saying</font><font color="#CCCCCC"> that</font>

279
00:09:56,050 --> 00:09:58,180
<font color="#CCCCCC">right but it sounds French someone</font>

280
00:09:57,370 --> 00:10:00,400
<font color="#E5E5E5">pronounce it like that</font>

281
00:09:58,180 --> 00:10:02,050
he wrote it to<font color="#E5E5E5"> do poisoning for</font>

282
00:10:00,400 --> 00:10:03,699
multicast<font color="#E5E5E5"> and broadcast based protocols</font>

283
00:10:02,050 --> 00:10:06,490
<font color="#CCCCCC">multicast and broadcast broadcast</font>

284
00:10:03,700 --> 00:10:08,710
<font color="#E5E5E5">protocols are protocols that send out</font>

285
00:10:06,490 --> 00:10:11,350
<font color="#E5E5E5">messages to either the whole subnet or</font>

286
00:10:08,710 --> 00:10:13,690
just some<font color="#E5E5E5"> of the subnet but it sends out</font>

287
00:10:11,350 --> 00:10:14,800
<font color="#E5E5E5">messages</font><font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of just</font><font color="#CCCCCC"> like blown out</font>

288
00:10:13,690 --> 00:10:17,080
there on the<font color="#E5E5E5"> network for whoever wants</font>

289
00:10:14,800 --> 00:10:19,689
<font color="#CCCCCC">to receive them all of these</font><font color="#E5E5E5"> protocols</font>

290
00:10:17,080 --> 00:10:22,780
<font color="#CCCCCC">eliminar</font><font color="#E5E5E5"> and BTN</font><font color="#CCCCCC"> s and M</font><font color="#E5E5E5"> DNS are all</font>

291
00:10:19,690 --> 00:10:25,450
basically<font color="#E5E5E5"> DNS they attach an IP address</font>

292
00:10:22,780 --> 00:10:26,920
<font color="#E5E5E5">to a</font><font color="#CCCCCC"> host name</font><font color="#E5E5E5"> which means you can</font>

293
00:10:25,450 --> 00:10:29,230
poison<font color="#E5E5E5"> them just like DNS you could be</font>

294
00:10:26,920 --> 00:10:32,680
like you know<font color="#CCCCCC"> their computer spits out a</font>

295
00:10:29,230 --> 00:10:34,030
request for hey who's at you know<font color="#E5E5E5"> slash</font>

296
00:10:32,680 --> 00:10:35,800
<font color="#E5E5E5">slash Google you know who's got the</font>

297
00:10:34,030 --> 00:10:37,569
<font color="#E5E5E5">computer</font><font color="#CCCCCC"> at Google</font><font color="#E5E5E5"> you can be like I got</font>

298
00:10:35,800 --> 00:10:39,670
Google and<font color="#CCCCCC"> they look oh great well</font>

299
00:10:37,570 --> 00:10:42,550
here's my net<font color="#CCCCCC"> NT lan hash and</font><font color="#E5E5E5"> you're</font>

300
00:10:39,670 --> 00:10:44,589
like<font color="#E5E5E5"> okay thanks a lot</font><font color="#CCCCCC"> the responder is</font>

301
00:10:42,550 --> 00:10:48,849
used in the background of<font color="#E5E5E5"> icebreaker to</font>

302
00:10:44,590 --> 00:10:50,500
poison these protocols<font color="#E5E5E5"> and because all</font>

303
00:10:48,850 --> 00:10:52,630
these<font color="#E5E5E5"> protocols implicitly trust the</font>

304
00:10:50,500 --> 00:10:54,550
responses<font color="#CCCCCC"> a piece</font><font color="#E5E5E5"> of cake to poison them</font>

305
00:10:52,630 --> 00:10:56,320
what you get out<font color="#CCCCCC"> of responder are net</font>

306
00:10:54,550 --> 00:11:00,310
ntlm version<font color="#CCCCCC"> two hashes again you do not</font>

307
00:10:56,320 --> 00:11:02,530
<font color="#E5E5E5">get hashes</font><font color="#CCCCCC"> that you can pass you can't</font>

308
00:11:00,310 --> 00:11:03,369
just take the net ntlm hash and then use

309
00:11:02,530 --> 00:11:04,449
that<font color="#E5E5E5"> in</font><font color="#CCCCCC"> place of</font><font color="#E5E5E5"> a</font>

310
00:11:03,370 --> 00:11:07,740
password<font color="#CCCCCC"> but that's okay because</font>

311
00:11:04,450 --> 00:11:11,140
icebreaker will automatically crack it

312
00:11:07,740 --> 00:11:13,930
this<font color="#E5E5E5"> is a kind of how</font><font color="#CCCCCC"> L eliminar</font><font color="#E5E5E5"> and NB</font>

313
00:11:11,140 --> 00:11:15,130
TNS poisoning works<font color="#E5E5E5"> it's pretty simple</font>

314
00:11:13,930 --> 00:11:15,719
you're basically just man in the middle

315
00:11:15,130 --> 00:11:18,010
of them

316
00:11:15,720 --> 00:11:19,210
computer sends out a packet you respond

317
00:11:18,010 --> 00:11:22,000
to it you respond to it faster than the

318
00:11:19,210 --> 00:11:24,940
than anybody else and this<font color="#E5E5E5"> is what it</font>

319
00:11:22,000 --> 00:11:27,850
looks like<font color="#E5E5E5"> in</font><font color="#CCCCCC"> action</font><font color="#E5E5E5"> so you</font><font color="#CCCCCC"> can see the</font>

320
00:11:24,940 --> 00:11:29,680
ntlm password is that long long<font color="#E5E5E5"> string</font>

321
00:11:27,850 --> 00:11:32,920
of<font color="#CCCCCC"> numbers and letters there it says Bob</font>

322
00:11:29,680 --> 00:11:35,589
<font color="#E5E5E5">lab Bob's username labs the domain</font><font color="#CCCCCC"> and</font>

323
00:11:32,920 --> 00:11:36,640
<font color="#E5E5E5">you can it ice breaker ice breaker will</font>

324
00:11:35,589 --> 00:11:38,830
automatically crack that<font color="#CCCCCC"> you can also</font>

325
00:11:36,640 --> 00:11:40,300
skip cracking if you don't want your

326
00:11:38,830 --> 00:11:42,160
<font color="#E5E5E5">resources to be used</font><font color="#CCCCCC"> on that you</font><font color="#E5E5E5"> just</font>

327
00:11:40,300 --> 00:11:44,349
<font color="#E5E5E5">use the - s flag to skip any of these</font>

328
00:11:42,160 --> 00:11:45,819
<font color="#E5E5E5">attacks</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> you can like</font><font color="#CCCCCC"> just use the SCF</font>

329
00:11:44,350 --> 00:11:47,950
attack if<font color="#E5E5E5"> you wanted to or</font><font color="#CCCCCC"> just the</font><font color="#E5E5E5"> NT</font>

330
00:11:45,820 --> 00:11:49,450
<font color="#CCCCCC">line relay but it'll try and crack it</font>

331
00:11:47,950 --> 00:11:51,490
<font color="#CCCCCC">and you'll notice here it's using john</font>

332
00:11:49,450 --> 00:11:55,150
the<font color="#CCCCCC"> ripper and it found the password</font>

333
00:11:51,490 --> 00:12:00,640
which was of course<font color="#E5E5E5"> p @ sign SS</font><font color="#CCCCCC"> w0 r</font><font color="#E5E5E5"> v</font>

334
00:11:55,150 --> 00:12:03,160
one of the most common<font color="#E5E5E5"> ones the fourth</font>

335
00:12:00,640 --> 00:12:04,810
attack<font color="#E5E5E5"> is the one that i think is the</font>

336
00:12:03,160 --> 00:12:08,050
most effective<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> the one where</font>

337
00:12:04,810 --> 00:12:09,459
<font color="#CCCCCC">icebreaker</font><font color="#E5E5E5"> if it lingers on attack</font><font color="#CCCCCC"> 3 for</font>

338
00:12:08,050 --> 00:12:11,319
<font color="#E5E5E5">10 minutes by default it'll just run</font>

339
00:12:09,459 --> 00:12:13,359
responder and wait 10<font color="#E5E5E5"> minutes for</font><font color="#CCCCCC"> two</font>

340
00:12:11,320 --> 00:12:15,820
captures and hashes<font color="#CCCCCC"> if nothing is found</font>

341
00:12:13,360 --> 00:12:18,580
<font color="#E5E5E5">or ten minutes is up it'll move on to</font>

342
00:12:15,820 --> 00:12:21,760
attack<font color="#CCCCCC"> 4 which is ntlm</font><font color="#E5E5E5"> relay ntlm relay</font>

343
00:12:18,580 --> 00:12:23,800
is an awesome awesome<font color="#E5E5E5"> attack</font><font color="#CCCCCC"> it works</font><font color="#E5E5E5"> in</font>

344
00:12:21,760 --> 00:12:26,290
I would<font color="#E5E5E5"> say the</font><font color="#CCCCCC"> majority of</font><font color="#E5E5E5"> Windows</font>

345
00:12:23,800 --> 00:12:27,490
networks<font color="#E5E5E5"> for getting passwords and</font>

346
00:12:26,290 --> 00:12:28,810
command execution<font color="#E5E5E5"> as a local</font>

347
00:12:27,490 --> 00:12:31,029
administrator<font color="#CCCCCC"> which is really what</font>

348
00:12:28,810 --> 00:12:33,069
<font color="#E5E5E5">you're looking for this is a man</font><font color="#CCCCCC"> of the</font>

349
00:12:31,029 --> 00:12:35,170
middle attack gift SMB connections<font color="#CCCCCC"> two</font>

350
00:12:33,070 --> 00:12:37,480
computers are connecting<font color="#CCCCCC"> over SMB and</font>

351
00:12:35,170 --> 00:12:38,800
they're<font color="#E5E5E5"> sharing files back and</font><font color="#CCCCCC"> forth or</font>

352
00:12:37,480 --> 00:12:41,920
they're just<font color="#E5E5E5"> pulling</font><font color="#CCCCCC"> information about</font>

353
00:12:38,800 --> 00:12:44,589
the system<font color="#CCCCCC"> SMB is the file sharing</font>

354
00:12:41,920 --> 00:12:46,380
protocols<font color="#E5E5E5"> it's pretty simple</font><font color="#CCCCCC"> and so</font>

355
00:12:44,589 --> 00:12:49,690
we're going<font color="#CCCCCC"> to be</font><font color="#E5E5E5"> using ntlm relay</font><font color="#CCCCCC"> X</font>

356
00:12:46,380 --> 00:12:52,120
from in packet to be<font color="#CCCCCC"> doing the ntlm</font>

357
00:12:49,690 --> 00:12:54,940
<font color="#CCCCCC">relay so what we are going</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> be doing</font>

358
00:12:52,120 --> 00:12:56,620
<font color="#E5E5E5">is essentially running responder and</font>

359
00:12:54,940 --> 00:12:58,750
ntlm<font color="#E5E5E5"> X at the same time so we're</font>

360
00:12:56,620 --> 00:13:03,100
poisoning the SMB protocol<font color="#E5E5E5"> so when</font><font color="#CCCCCC"> the</font>

361
00:12:58,750 --> 00:13:05,620
<font color="#E5E5E5">computer calls out hey where is exchange</font>

362
00:13:03,100 --> 00:13:07,089
<font color="#E5E5E5">you'll be like</font><font color="#CCCCCC"> imma it'll it'll</font><font color="#E5E5E5"> go</font>

363
00:13:05,620 --> 00:13:09,130
connect to the actual exchange<font color="#E5E5E5"> server</font>

364
00:13:07,089 --> 00:13:10,510
but<font color="#E5E5E5"> you are going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be right</font><font color="#CCCCCC"> in the</font>

365
00:13:09,130 --> 00:13:13,120
<font color="#E5E5E5">middle of that connection</font><font color="#CCCCCC"> so you</font><font color="#E5E5E5"> can</font>

366
00:13:10,510 --> 00:13:15,490
<font color="#CCCCCC">hijack that</font><font color="#E5E5E5"> connection after</font><font color="#CCCCCC"> you hydrate</font>

367
00:13:13,120 --> 00:13:16,570
the connection you can get the net ntlm

368
00:13:15,490 --> 00:13:19,510
version<font color="#CCCCCC"> 2</font>

369
00:13:16,570 --> 00:13:22,240
password credentials<font color="#E5E5E5"> our password hash</font>

370
00:13:19,510 --> 00:13:24,280
and then you can just relay that<font color="#E5E5E5"> to a</font>

371
00:13:22,240 --> 00:13:28,030
machine<font color="#CCCCCC"> so net ntlm version two Pat</font>

372
00:13:24,280 --> 00:13:30,250
hashes<font color="#CCCCCC"> you can't pass</font><font color="#E5E5E5"> but you can relay</font>

373
00:13:28,030 --> 00:13:32,530
<font color="#CCCCCC">so you can take the hash that one</font>

374
00:13:30,250 --> 00:13:34,870
computer sent validly<font color="#E5E5E5"> to another</font>

375
00:13:32,530 --> 00:13:36,280
computer<font color="#CCCCCC"> and then you pass that hash to</font>

376
00:13:34,870 --> 00:13:41,230
that computer<font color="#CCCCCC"> and tell it to run your</font>

377
00:13:36,280 --> 00:13:41,770
commands there's a few caveats with this

378
00:13:41,230 --> 00:13:43,990
one though

379
00:13:41,770 --> 00:13:46,930
number<font color="#E5E5E5"> one SMB version one has to be</font>

380
00:13:43,990 --> 00:13:50,380
enabled<font color="#CCCCCC"> I believe by default now</font><font color="#E5E5E5"> Windows</font>

381
00:13:46,930 --> 00:13:55,260
10 no longer has<font color="#CCCCCC"> that enabled it's still</font>

382
00:13:50,380 --> 00:13:57,939
enabled<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> fantastic</font><font color="#CCCCCC"> Thank You Microsoft</font>

383
00:13:55,260 --> 00:14:00,270
<font color="#CCCCCC">it has to have SMB version 1 enabled</font><font color="#E5E5E5"> and</font>

384
00:13:57,940 --> 00:14:03,550
<font color="#E5E5E5">you have to have SMB signing disabled</font><font color="#CCCCCC"> I</font>

385
00:14:00,270 --> 00:14:06,100
believe that I'm not<font color="#CCCCCC"> sure if Windows 10</font>

386
00:14:03,550 --> 00:14:07,750
now has that enabled by default<font color="#CCCCCC"> too but</font>

387
00:14:06,100 --> 00:14:09,940
it hasn't<font color="#E5E5E5"> been enabled</font><font color="#CCCCCC"> for the last</font>

388
00:14:07,750 --> 00:14:11,080
several versions of Windows SMB signing

389
00:14:09,940 --> 00:14:13,780
actually slows down the<font color="#E5E5E5"> network</font>

390
00:14:11,080 --> 00:14:15,130
connection by<font color="#E5E5E5"> about</font><font color="#CCCCCC"> 15 percent</font><font color="#E5E5E5"> so</font>

391
00:14:13,780 --> 00:14:16,720
there's a valid<font color="#CCCCCC"> reason</font><font color="#E5E5E5"> why you would</font>

392
00:14:15,130 --> 00:14:20,200
want<font color="#CCCCCC"> to disable it</font><font color="#E5E5E5"> so it's disabled all</font>

393
00:14:16,720 --> 00:14:23,200
the time especially<font color="#E5E5E5"> in older systems so</font>

394
00:14:20,200 --> 00:14:25,690
once you have<font color="#E5E5E5"> those two caveats met then</font>

395
00:14:23,200 --> 00:14:29,920
ntlm<font color="#E5E5E5"> relay is just gonna go ham all over</font>

396
00:14:25,690 --> 00:14:32,380
the network so<font color="#CCCCCC"> NTM ntlm hash</font><font color="#E5E5E5"> is the top</font>

397
00:14:29,920 --> 00:14:33,849
hatch<font color="#E5E5E5"> net ntlm version 2 is the bottom</font><font color="#CCCCCC"> -</font>

398
00:14:32,380 --> 00:14:35,050
you'll see the net ntlm version<font color="#E5E5E5"> 2 is</font>

399
00:14:33,850 --> 00:14:36,820
what they use<font color="#CCCCCC"> for usually network</font>

400
00:14:35,050 --> 00:14:39,189
services that are communicating with

401
00:14:36,820 --> 00:14:42,340
servers ntlm hashes are what's<font color="#CCCCCC"> actually</font>

402
00:14:39,190 --> 00:14:44,670
stored<font color="#E5E5E5"> on the</font><font color="#CCCCCC"> computer in LCS so those</font>

403
00:14:42,340 --> 00:14:49,120
are the hashes<font color="#CCCCCC"> that you can just pass</font>

404
00:14:44,670 --> 00:14:51,099
like a password and<font color="#E5E5E5"> then</font><font color="#CCCCCC"> net until i'm</font>

405
00:14:49,120 --> 00:14:53,530
hash you cannot pass that<font color="#E5E5E5"> you have to</font>

406
00:14:51,100 --> 00:14:55,480
relay<font color="#CCCCCC"> that one you'll</font><font color="#E5E5E5"> notice the net</font>

407
00:14:53,530 --> 00:14:57,520
ntlm hash also includes the<font color="#E5E5E5"> username and</font>

408
00:14:55,480 --> 00:14:58,600
<font color="#E5E5E5">domain that is part of the hash so if</font>

409
00:14:57,520 --> 00:15:00,550
you're trying<font color="#CCCCCC"> to crack</font><font color="#E5E5E5"> these in</font><font color="#CCCCCC"> hashed</font>

410
00:14:58,600 --> 00:15:03,070
<font color="#CCCCCC">out yourself you need to</font><font color="#E5E5E5"> include admin</font>

411
00:15:00,550 --> 00:15:07,630
colon colon lab you can't just have<font color="#E5E5E5"> the</font>

412
00:15:03,070 --> 00:15:10,870
actual hash data there<font color="#CCCCCC"> and this</font><font color="#E5E5E5"> is kind</font>

413
00:15:07,630 --> 00:15:12,160
of what a net ntlm hash<font color="#E5E5E5"> looks like it'll</font>

414
00:15:10,870 --> 00:15:13,750
start with the<font color="#CCCCCC"> username</font><font color="#E5E5E5"> and then I'll go</font>

415
00:15:12,160 --> 00:15:16,449
to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> domain</font><font color="#CCCCCC"> and then I'll go to the LM</font>

416
00:15:13,750 --> 00:15:18,040
hash which is disabled<font color="#E5E5E5"> pretty much 100%</font>

417
00:15:16,450 --> 00:15:19,630
of the time you'll never really get<font color="#E5E5E5"> a</font>

418
00:15:18,040 --> 00:15:22,569
valid LM hash and then you'll get the

419
00:15:19,630 --> 00:15:24,220
actual ntlm hash<font color="#CCCCCC"> it's a challenge</font>

420
00:15:22,570 --> 00:15:28,380
<font color="#E5E5E5">response protocol which is</font><font color="#CCCCCC"> why you can't</font>

421
00:15:24,220 --> 00:15:28,380
pass<font color="#CCCCCC"> it you can only relay it</font>

422
00:15:28,560 --> 00:15:32,319
so there's there was<font color="#CCCCCC"> a bit</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> confusion</font>

423
00:15:30,940 --> 00:15:38,110
for<font color="#E5E5E5"> the last few years about exactly</font>

424
00:15:32,320 --> 00:15:41,530
what<font color="#CCCCCC"> the passing the hash accounts</font><font color="#E5E5E5"> you</font>

425
00:15:38,110 --> 00:15:43,330
can<font color="#E5E5E5"> use and it turns out as of today you</font>

426
00:15:41,530 --> 00:15:45,520
can pass the hash with the local

427
00:15:43,330 --> 00:15:48,280
<font color="#E5E5E5">built-in administrator account but rid</font>

428
00:15:45,520 --> 00:15:50,920
<font color="#E5E5E5">500 you cannot pass the hash with the</font>

429
00:15:48,280 --> 00:15:52,750
other administrators on the box<font color="#E5E5E5"> that was</font>

430
00:15:50,920 --> 00:15:55,959
<font color="#CCCCCC">a Microsoft patch they called it the</font>

431
00:15:52,750 --> 00:15:57,490
<font color="#E5E5E5">pass the hash patch but it wasn't I mean</font>

432
00:15:55,960 --> 00:15:59,830
you can still<font color="#E5E5E5"> pass the</font><font color="#CCCCCC"> hatch you just</font>

433
00:15:57,490 --> 00:16:04,240
need to use<font color="#CCCCCC"> the</font><font color="#E5E5E5"> red 500 so Microsoft</font><font color="#CCCCCC"> you</font>

434
00:15:59,830 --> 00:16:05,740
know<font color="#E5E5E5"> I don't know blowing smoke up you</font>

435
00:16:04,240 --> 00:16:07,450
can however pass the hash with other

436
00:16:05,740 --> 00:16:09,280
administrator accounts<font color="#E5E5E5"> if you set a</font>

437
00:16:07,450 --> 00:16:11,320
registry key that<font color="#CCCCCC"> register key is in</font>

438
00:16:09,280 --> 00:16:13,630
<font color="#CCCCCC">local machine</font><font color="#E5E5E5"> filter administrator token</font>

439
00:16:11,320 --> 00:16:15,430
so if you have admin access to a box you

440
00:16:13,630 --> 00:16:16,660
can just<font color="#E5E5E5"> set that key to be one and now</font>

441
00:16:15,430 --> 00:16:20,859
you can pass the hash for everybody

442
00:16:16,660 --> 00:16:23,010
<font color="#E5E5E5">which is pretty cool</font><font color="#CCCCCC"> yeah if you want</font><font color="#E5E5E5"> to</font>

443
00:16:20,860 --> 00:16:25,360
read more<font color="#CCCCCC"> about this</font><font color="#E5E5E5"> harm joy has a blog</font>

444
00:16:23,010 --> 00:16:26,890
<font color="#E5E5E5">that</font><font color="#CCCCCC"> is extremely</font><font color="#E5E5E5"> good there's a little</font>

445
00:16:25,360 --> 00:16:28,960
link<font color="#E5E5E5"> there</font><font color="#CCCCCC"> I doubt you can read it</font><font color="#E5E5E5"> but</font>

446
00:16:26,890 --> 00:16:31,060
I'll post<font color="#E5E5E5"> the slope slides publicly so</font>

447
00:16:28,960 --> 00:16:33,190
you can do that later<font color="#E5E5E5"> if you want to but</font>

448
00:16:31,060 --> 00:16:36,880
he goes<font color="#E5E5E5"> into a exceptional detail about</font>

449
00:16:33,190 --> 00:16:38,470
the<font color="#E5E5E5"> pass the hatch patch that Microsoft</font>

450
00:16:36,880 --> 00:16:41,800
put out and why it's<font color="#E5E5E5"> just a piece</font><font color="#CCCCCC"> of</font>

451
00:16:38,470 --> 00:16:43,750
crap<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is how</font><font color="#CCCCCC"> Intel and relay works</font>

452
00:16:41,800 --> 00:16:45,880
<font color="#CCCCCC">so you've got one computer negotiating</font>

453
00:16:43,750 --> 00:16:47,110
authentication with another<font color="#E5E5E5"> computer</font><font color="#CCCCCC"> you</font>

454
00:16:45,880 --> 00:16:48,910
are<font color="#E5E5E5"> in the middle of that so you are</font>

455
00:16:47,110 --> 00:16:50,620
<font color="#E5E5E5">going</font><font color="#CCCCCC"> to copy the server challenge pass</font>

456
00:16:48,910 --> 00:16:51,969
<font color="#CCCCCC">it back</font><font color="#E5E5E5"> the server challenge is gonna</font>

457
00:16:50,620 --> 00:16:54,960
<font color="#E5E5E5">send it to you you pass that over to the</font>

458
00:16:51,970 --> 00:16:54,960
actual valid<font color="#E5E5E5"> to the</font>

