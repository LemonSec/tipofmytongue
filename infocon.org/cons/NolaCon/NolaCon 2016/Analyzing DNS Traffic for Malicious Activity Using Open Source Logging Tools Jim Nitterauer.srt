1
00:00:00,000 --> 00:00:06,210
heading up the deal also named Jim our I
am from upriver how many of you heard

2
00:00:06,210 --> 00:00:09,550
upriver one person to person to people

3
00:00:09,550 --> 00:00:14,070
ok well that's good everybody knows but
I prefer after we get out of my head I

4
00:00:14,070 --> 00:00:17,320
get here last year i ka mandola converse
want to thank Rob and his team for

5
00:00:17,320 --> 00:00:20,699
putting this together to really great
event so be sure and thank him when you

6
00:00:20,699 --> 00:00:24,400
get a chance so I was here last year and
unfortunately I said some really big

7
00:00:24,400 --> 00:00:27,340
words and acted like I knew I was
talking about and suddenly I'm here

8
00:00:27,340 --> 00:00:34,730
talking so what happens sometimes have
been without power since 2006 I'm Senior

9
00:00:34,730 --> 00:00:39,040
Systems Administrator they're
responsible for network deployments in

10
00:00:39,040 --> 00:00:43,430
11 data centers globally take care of
network security network operations are

11
00:00:43,430 --> 00:00:47,780
two main services are secure safe and
secure tied one is a spam and virus

12
00:00:47,780 --> 00:00:52,590
filtering service the other is a DNS
malware Filtering Service both of them

13
00:00:52,590 --> 00:00:59,199
are global leaf filter messages for
about 850,000 email boxes on a regular

14
00:00:59,199 --> 00:01:03,858
basis when I checked in fact I can't
show you my great live demos today

15
00:01:03,859 --> 00:01:07,920
because we're overwhelmed with spam to
the team about 600,000 messages per

16
00:01:07,920 --> 00:01:12,400
minute going to our spam quarantine so
can thank the virus writers for that

17
00:01:12,400 --> 00:01:17,000
today but in any case I'll do my best to
show you some of the live stuff for some

18
00:01:17,000 --> 00:01:21,900
of the backlog sup have a degree in
microbiology and biochemistry from the

19
00:01:21,900 --> 00:01:25,689
University of Alabama I saw somebody
with an Alabama had a guess he stepped

20
00:01:25,689 --> 00:01:30,360
out roll tide and I've gotten into I T
and trying to speak more time of these

21
00:01:30,360 --> 00:01:35,390
conferences this week I'm working on my
CISSP certification so I should have

22
00:01:35,390 --> 00:01:39,470
that surely so today what I want to do
today is lay out what was my challenge

23
00:01:39,470 --> 00:01:44,079
when I came to a braver what happened
that lead me to looking at some of the

24
00:01:44,079 --> 00:01:48,429
legacy log analysis tools that are out
there in the market I wanna go over some

25
00:01:48,430 --> 00:01:50,790
of the new kids on the block some of the
new

26
00:01:50,790 --> 00:01:55,650
applications and services that are out
there for managing log data when I put

27
00:01:55,650 --> 00:01:58,920
some of those pieces together to show
you how I devised a solution to solve

28
00:01:58,920 --> 00:02:02,340
some of the problems that I had we're
gonna look at some of the common DNS

29
00:02:02,340 --> 00:02:06,480
exploits that we dealt with keep in mind
we're focusing Iran and Open DNS

30
00:02:06,480 --> 00:02:13,820
resolver so think Google or opened and
that's similar to that world examples of

31
00:02:13,820 --> 00:02:17,590
how uncovered some of those attacks so
start with the basics like a nap

32
00:02:17,590 --> 00:02:23,410
wherever we had just had a roll out of
our secure servers service that failed I

33
00:02:23,410 --> 00:02:27,500
wasn't on that team wasn't involved in
that we worked with McAfee and trusted

34
00:02:27,500 --> 00:02:30,910
source on that it didn't work out too
well for us so we decided to roll our

35
00:02:30,910 --> 00:02:35,270
own problem was that guys are not
working team did not know how to secure

36
00:02:35,270 --> 00:02:40,100
DNS we head to head open resolvers that
anybody could used our customers I

37
00:02:40,100 --> 00:02:44,790
travel ago coffee shops do whatever they
need to be able to access our DNS so my

38
00:02:44,790 --> 00:02:49,109
goal is to have an open DNS resolver had
to be resilient had to be globally

39
00:02:49,110 --> 00:02:54,239
redundant had to be fast like Google
fast and had to be quick to secure and

40
00:02:54,239 --> 00:03:01,519
enhance it became across any problems so
I side had this sort of my lap thinking

41
00:03:01,519 --> 00:03:04,940
of us brought to mind the story so far
in 2012 figure out a little story about

42
00:03:04,940 --> 00:03:10,049
a company is not too far from here the
Tabasco company located in ABR Island

43
00:03:10,049 --> 00:03:14,739
their little bit to the west of New
Orleans their main product for many many

44
00:03:14,739 --> 00:03:18,650
years was just Tabasco sauce only one
kind of sauce in the late nineties only

45
00:03:18,650 --> 00:03:22,230
2006 started running some marketing
issues I couldn't their market share

46
00:03:22,230 --> 00:03:26,570
went away because just like craft beer
craft hot sauces came out on the market

47
00:03:26,570 --> 00:03:30,940
and their market share dropped C span
all kinds of money did all kinds of

48
00:03:30,940 --> 00:03:34,510
market surveys hired consultants did all
of this thing all of the stuff to try

49
00:03:34,510 --> 00:03:36,798
and figure out how to increase its
market share

50
00:03:36,799 --> 00:03:40,970
couldn't figure it out for life one day
at factory worker walks up not on the

51
00:03:40,970 --> 00:03:42,010
door

52
00:03:42,010 --> 00:03:47,190
mr CEO I have a good idea for you and I
want to know what that ideas and I guess

53
00:03:48,870 --> 00:03:54,060
he says just make the hole in the bottle
a little bit bigger people still think

54
00:03:54,060 --> 00:03:57,989
45 shakes on the Ramadan their sandwich
whatever will sell more hot sauce and

55
00:03:57,989 --> 00:04:03,580
your problem solved so the moral stories
with difficult problems there's usually

56
00:04:03,580 --> 00:04:07,140
a simple solution so that was what I was
kind of applying what I went through

57
00:04:07,140 --> 00:04:12,700
thinking how can I solve this problem
with DNS I started with the logs I

58
00:04:12,700 --> 00:04:15,109
figured if we can see what's going on

59
00:04:15,110 --> 00:04:18,540
not so much at the DNA level the
application level but at the network

60
00:04:18,540 --> 00:04:23,110
level would be able to protect our
environment and our system ever

61
00:04:23,110 --> 00:04:28,090
obviously you have logged you can log
event log system laws on your Linux

62
00:04:28,090 --> 00:04:31,810
boxes you can turn on Microsoft addr
slot logged data is pretty much

63
00:04:31,810 --> 00:04:34,110
everywhere

64
00:04:34,110 --> 00:04:39,050
problem is when you need the logs it's
usually you're under fire there's an

65
00:04:39,050 --> 00:04:43,669
emergency right everybody's Karunanidhi
Internet's down its not working you're

66
00:04:43,669 --> 00:04:47,198
trying to figure out what's going on in
your life who you're logged as just data

67
00:04:47,199 --> 00:04:51,910
sourced Rosen Rosen information that
doesn't make any sense so the problem is

68
00:04:51,910 --> 00:04:54,910
a lot of data to live now stools are
pretty limited

69
00:04:55,810 --> 00:05:00,260
a lot of good ones out there that you
can use to aggregate your lives you can

70
00:05:00,260 --> 00:05:04,460
use key we used to be an open source
solution that was bought by solar winds

71
00:05:04,460 --> 00:05:08,888
so if you ever get any marketing
information or sign up for a of

72
00:05:08,889 --> 00:05:13,000
SolarWinds free product be prepared to
turn on your spam filter cuz they will

73
00:05:13,000 --> 00:05:17,900
spam the hell out of you how you can use
syslog in G could use any of these other

74
00:05:17,900 --> 00:05:23,388
things P RTG also just syslog data and
will presented in a web interface for

75
00:05:23,389 --> 00:05:24,099
you

76
00:05:24,099 --> 00:05:28,449
the problem with all of this data is
it's just syslog data right its rows of

77
00:05:28,449 --> 00:05:34,010
information in syslog format it really
doesn't give you too much ability or

78
00:05:34,010 --> 00:05:38,050
query and create reports from that data
see what's going on give you information

79
00:05:38,050 --> 00:05:39,700
that really matters

80
00:05:39,700 --> 00:05:43,909
no problem some of these is there a
cheaper free or they're really expensive

81
00:05:43,910 --> 00:05:48,860
we contacted Splunk a few years ago to
see what they would charge us to do just

82
00:05:48,860 --> 00:05:52,900
the portion of our logging and it was
fifty or sixty thousand dollars a month

83
00:05:52,900 --> 00:05:56,049
so we quickly and politely said no
thanks

84
00:05:57,200 --> 00:06:02,990
so a lot of these tools lot of these
tools varying complexity a lot of them

85
00:06:02,990 --> 00:06:07,090
have different support levels a lot of
them are very easy to use and don't give

86
00:06:07,090 --> 00:06:11,409
you much information very complex and
require a lot trained to make the more

87
00:06:11,410 --> 00:06:17,590
common denominators they lack
flexibility if you want to be able to

88
00:06:17,590 --> 00:06:21,270
get the information out you gotta be
able to adjust how that information is

89
00:06:21,270 --> 00:06:25,370
presented in these longing solutions now
don't really percent that kind of

90
00:06:25,370 --> 00:06:30,270
information so what we did is we looked
at some different ways to process laws

91
00:06:30,270 --> 00:06:34,760
and kind of broke it up into bits and
pieces and one of the things that came

92
00:06:34,760 --> 00:06:37,860
out of the same time that we were
looking at all this was the Elks tax

93
00:06:37,860 --> 00:06:41,960
rate this was just getting started so
that includes Caban unlock / in

94
00:06:41,960 --> 00:06:45,940
elasticsearch and few other components
and that's a good foundation that's kind

95
00:06:45,940 --> 00:06:51,260
of what we built our solution around but
we changed it up a little bit but we

96
00:06:51,260 --> 00:06:54,620
decided to do is figure out how to
gather our long data from incoming

97
00:06:54,620 --> 00:07:00,710
queries for our DNS requests so
decidedly our network works as we have

98
00:07:00,710 --> 00:07:05,430
global leader serving DNS servers around
the world all of those VIPs have

99
00:07:05,430 --> 00:07:09,630
basically the same IP address just like
Google different IP address all the

100
00:07:09,630 --> 00:07:13,060
requests come in and we loved literature
class at the network layer so we're able

101
00:07:13,060 --> 00:07:15,740
to see who's making requests in
real-time

102
00:07:15,740 --> 00:07:21,380
the other thing we do is we actually
live eighty DNS logs from internal the

103
00:07:21,380 --> 00:07:23,960
internal site so we can compare those
two and I'll show you how we do that

104
00:07:23,960 --> 00:07:28,979
later on probably run into is how to
reformat data right we don't want to

105
00:07:28,980 --> 00:07:32,520
syslog data because it's pretty
meaningless and it's pretty hard to mind

106
00:07:32,520 --> 00:07:37,049
if you looked at it it takes a whole lot
of time to deal with so what we ended up

107
00:07:37,050 --> 00:07:40,350
doing is we ended up shipping these laws
in real time

108
00:07:40,350 --> 00:07:47,130
I will tell you use f5 load balancers on
our front and solar able to use TCL to

109
00:07:47,130 --> 00:07:51,900
write my rules that would take this data
and distribute it and Greylock has the

110
00:07:51,900 --> 00:07:56,640
ability to do remote lock f5 has the
ability to do remote locking so we're

111
00:07:56,640 --> 00:08:02,039
able to ship those lived to a central
log ingestion cluster and the other

112
00:08:02,040 --> 00:08:06,450
thing we want to do is be able to index
and visualize the data gathering lodging

113
00:08:06,450 --> 00:08:08,070
wasn't anything magical about us

114
00:08:08,070 --> 00:08:11,450
gathering these lives we knew where the
data was we knew what format it was in

115
00:08:11,450 --> 00:08:15,210
the problem was we need is convert from
the format that it was saved into

116
00:08:15,210 --> 00:08:19,849
something that we could use well
Greylock I don't know how many are

117
00:08:19,850 --> 00:08:24,520
familiar with it but it has a formatting
capabilities that you can use the

118
00:08:24,520 --> 00:08:28,789
so-called gulf and when I go over what
that is here in a little bit so the

119
00:08:28,790 --> 00:08:32,890
formatting of your logs can be done at
multiple locations in the chain of where

120
00:08:32,890 --> 00:08:36,890
you're collecting this information the
data can be formatted as you ride it out

121
00:08:36,890 --> 00:08:41,848
to disk where restoring your logs it can
be formatted as your shipping lot so you

122
00:08:41,849 --> 00:08:46,950
can read existing lot of data change the
format and ship it that way or you can

123
00:08:46,950 --> 00:08:51,200
ship the log data and ingested on the
input side and format it before it's

124
00:08:51,200 --> 00:08:57,460
indexed in your indexing solution this
case will be elasticsearch so we decided

125
00:08:57,460 --> 00:09:04,920
and tested this shelf log shipping
packet and if you look at what what is

126
00:09:04,920 --> 00:09:11,060
golf it's not a gnome similar to the
Smurfs it's a method for shipping data

127
00:09:11,060 --> 00:09:14,969
in a JSON packets is really interesting
because it has a you can choose it and

128
00:09:14,970 --> 00:09:19,540
send it directly to rest API's and just
that data that way if you want to or you

129
00:09:19,540 --> 00:09:22,520
can send it to a log or any other

130
00:09:22,520 --> 00:09:27,510
input feet and put system it will take
in that data in that format the nice

131
00:09:27,510 --> 00:09:32,960
thing is phil has several fields that
are defined by the standard that are

132
00:09:32,960 --> 00:09:37,180
built into the JSON packet and the nice
thing is then you can go and you can add

133
00:09:37,180 --> 00:09:42,069
into that your own fields so you can
devise and make your log data fit the

134
00:09:42,070 --> 00:09:44,990
format for the data that you are mine
later on

135
00:09:44,990 --> 00:09:49,510
nice and there's also a bunch of guilt
programming libraries for just about any

136
00:09:49,510 --> 00:09:57,090
languages out there so how do we get
that those live feedback over how to get

137
00:09:57,090 --> 00:10:04,890
those blogs from our locks source to are
logged and put it on our servers that

138
00:10:04,890 --> 00:10:09,370
are basically Windows or Linux servers
we use index logged its Community

139
00:10:09,370 --> 00:10:13,430
Edition is a paid addition the Free
Edition works very well it's basically a

140
00:10:13,430 --> 00:10:17,479
la browder he pointed to the director
where your log files are it will tell

141
00:10:17,480 --> 00:10:19,200
those logged in real time

142
00:10:19,200 --> 00:10:23,640
grab those Laden and send them to some
remote location and I think it has a

143
00:10:23,640 --> 00:10:29,120
built-in formatting capabilities you can
use locks tax that's part of the elstak

144
00:10:29,120 --> 00:10:30,620
that works really well

145
00:10:30,620 --> 00:10:35,200
also it's a little bit too much for what
we use on our window side of things so

146
00:10:35,200 --> 00:10:40,430
decide to stick with an ex log we also
use the again at five remote logging

147
00:10:40,430 --> 00:10:45,130
capabilities we apply filters when we
ship those lives hell

148
00:10:46,880 --> 00:10:51,210
piece of the puzzle very long just
released version 2 has a very cool

149
00:10:51,210 --> 00:10:56,120
feature that it just added and I'm gonna
go over the whole feature set for a

150
00:10:56,120 --> 00:11:00,900
login again I'm just bits and pieces
together so you can see how I put

151
00:11:00,900 --> 00:11:04,790
together pieces to make the whole
solution but what they added to it was

152
00:11:04,790 --> 00:11:10,750
something called the great blog sidebar
so imagine if you have thousands of

153
00:11:10,750 --> 00:11:14,150
servers with an ex lava or whatever
running on those servers you don't have

154
00:11:14,150 --> 00:11:17,350
to touch every one of those servers
every time you wanna a blog or change

155
00:11:17,350 --> 00:11:23,840
logs make a change to help those laws
for formatter ship so what this site car

156
00:11:23,840 --> 00:11:26,089
does it installs on all those and
servers

157
00:11:26,089 --> 00:11:30,189
in it then interacts with whatever log
shipping till you're using other text

158
00:11:30,189 --> 00:11:35,579
log or loud crash but the nice thing is
it allows you then to manage all of

159
00:11:35,579 --> 00:11:40,359
those remote in points through one panel
21 web interface to the grail of web

160
00:11:40,360 --> 00:11:47,129
interface very cool solution to the
latest version of a log a log as as a

161
00:11:47,129 --> 00:11:51,959
collector basically all it is a
consistent web server it consists

162
00:11:51,959 --> 00:11:59,599
collector and points and it consists of
a way to send the data indexing nice

163
00:11:59,600 --> 00:12:03,160
thing about it is it will actually
accumulator laws put them in a journal

164
00:12:03,160 --> 00:12:08,110
The Journal as a cash so what happened
to us today is our elasticsearch cluster

165
00:12:08,110 --> 00:12:12,519
couldn't keep up so the journal files
built up a lot of data is there but

166
00:12:12,519 --> 00:12:17,720
it'll take some time to kill offering it
sent to our elasticsearch cluster you

167
00:12:17,720 --> 00:12:22,749
can also use Greylock to ingest lot of
data and then forward an exact copy of

168
00:12:22,749 --> 00:12:25,949
that lot of data somewhere else if you
already have a lot of solutions in place

169
00:12:25,949 --> 00:12:30,069
so you're not limiting yourself as to
what you can do think of it as an inline

170
00:12:30,069 --> 00:12:34,219
log analysis tool that uses
elasticsearch in the backend for its

171
00:12:34,220 --> 00:12:38,970
database and for indexing the data and
it keeps all of its configurations and

172
00:12:38,970 --> 00:12:46,519
MongoDB database so things are allowed
to has now is ability to archive as your

173
00:12:46,519 --> 00:12:51,410
logs build-up you can take your logs and
archived the ones you don't want and

174
00:12:51,410 --> 00:12:54,709
I'll show you a little bit about this in
a minute I gives you the ability to

175
00:12:54,709 --> 00:12:59,809
monitor alert so you can set streams you
can filter incoming data tagged with a

176
00:12:59,809 --> 00:13:05,379
stream and then alert when certain
incidents happen let's say you could use

177
00:13:05,379 --> 00:13:11,389
it for example we use it for logins to
Linux server trying to force login a

178
00:13:11,389 --> 00:13:15,610
Linux server if they log in more than
three times it'll be tagged in the

179
00:13:15,610 --> 00:13:20,110
stream and alert and send us an email
saying hey this Linux server had three

180
00:13:20,110 --> 00:13:24,100
logins with this user name within this
period of time and that's a problem

181
00:13:25,209 --> 00:13:28,660
gives you the ability to drill down
Analytics which all over a little bit

182
00:13:28,660 --> 00:13:32,790
rates directly with your Active
Directory or LDAP server so if you have

183
00:13:32,790 --> 00:13:37,089
an Active Directory domain you can set
permissions in great log using that

184
00:13:37,089 --> 00:13:41,220
Active Directory domain and the other
cool thing that they often don't talk

185
00:13:41,220 --> 00:13:46,769
about overlooked as the ability to
create custom Java plugins remember I

186
00:13:46,769 --> 00:13:50,290
said you can format your day when you
write it to disk you can format your

187
00:13:50,290 --> 00:13:54,459
data when you ship it from your end
point or you can format your date when

188
00:13:54,459 --> 00:13:59,729
you ingested into gray long that is done
through writing job of plugins those

189
00:13:59,730 --> 00:14:03,929
Java plugin to create an input and just
the data they take the format of that

190
00:14:03,929 --> 00:14:09,600
data and formatted into a gulf packet
that injected into your elasticsearch to

191
00:14:09,600 --> 00:14:13,160
later you can go and look at that data
we're going to look at an example that

192
00:14:13,160 --> 00:14:19,579
here in a minute so elastic searches the
indexing back and for great blog right

193
00:14:19,579 --> 00:14:25,399
now said version 2.2 3.2 I think the one
that they're working on for beta is $5

194
00:14:25,399 --> 00:14:31,629
asked me how they go from 2.3 point to
25 but that's their deal not mine will

195
00:14:31,629 --> 00:14:37,259
tell you if you use Greylock one version
when you have to use elasticsearch

196
00:14:37,259 --> 00:14:41,769
version 1 whatever version 17 I think
was the latest if you're going to grill

197
00:14:41,769 --> 00:14:47,679
out to you can use elasticsearch version
2 they are not interchangeable so if you

198
00:14:47,679 --> 00:14:51,879
do have a guerrilla costs are up and
working and you want to operate you have

199
00:14:51,879 --> 00:14:56,319
to break gridlock and your lesson church
same time the last two churches

200
00:14:56,319 --> 00:14:59,829
basically a clustered index and you can
put as many no doubt there's you want

201
00:14:59,829 --> 00:15:04,599
it's very fast very redundant it is kind
of a pain to get setup once you get it

202
00:15:04,600 --> 00:15:06,059
setup it works very well

203
00:15:06,059 --> 00:15:11,350
the nice thing about getting your data
with gray login you can then go and use

204
00:15:11,350 --> 00:15:16,920
the grail of web interface and used its
functionality to do log analysis and you

205
00:15:16,920 --> 00:15:22,128
can also use the same indexes from
elasticsearch to for example use

206
00:15:22,129 --> 00:15:25,889
combined create more customized
dashboards to look into that data in

207
00:15:25,889 --> 00:15:29,589
real-time and it's the same set of data
you're not duplicating your data in any

208
00:15:29,589 --> 00:15:30,460
way

209
00:15:30,460 --> 00:15:38,620
so both of these support of simple query
format gonna give you some examples of

210
00:15:38,620 --> 00:15:42,860
this later on you create dashboards and
save those that bores of dashboards can

211
00:15:42,860 --> 00:15:49,310
be displayed on screens they update in
real time you can set filtering on

212
00:15:49,310 --> 00:15:52,989
different streams you can do a whole
bunch of different things that you would

213
00:15:52,990 --> 00:15:57,880
never be able to do with some of the
older logging tools so how do we use

214
00:15:57,880 --> 00:16:00,900
this what we ended up looking at the
biggest problem we had with dennis

215
00:16:00,900 --> 00:16:08,780
amplification attacks everybody know
what these are no more quickly so you

216
00:16:08,780 --> 00:16:13,220
wanna take somebody down D toss your
neighbor figure out what their IP

217
00:16:13,220 --> 00:16:21,090
addresses start sending DNS packets out
to some a bunch of a bunch of Open DNS

218
00:16:21,090 --> 00:16:25,310
servers but smooth VIP and put their IP
address on it so you can use about a

219
00:16:25,310 --> 00:16:31,229
megabit of bandwidth and send a small
queries about 50 kilobytes per cent you

220
00:16:31,230 --> 00:16:37,060
ask that DNS server for any query
attacks queria dar are seeing record so

221
00:16:37,060 --> 00:16:38,439
that ends up coming back

222
00:16:38,440 --> 00:16:43,190
maximum size 4096 bytes you look at the
ratio you're getting an amplification of

223
00:16:43,190 --> 00:16:48,050
up to 80% eighty times on that data so
one meg internet connection

224
00:16:49,060 --> 00:16:54,280
candydoll somebody 80 megs right so now
imagine 10,000 servers doing that to

225
00:16:54,280 --> 00:17:02,810
your body next door to Microsoft and
this happened Microsoft year and a half

226
00:17:02,810 --> 00:17:07,300
ago right when they are about to release
the Xbox and then also happen to another

227
00:17:07,300 --> 00:17:11,159
well-known publication that made an
announcement last year they decided that

228
00:17:11,160 --> 00:17:18,850
they were going to pare down the amount
of exposure of the models in the

229
00:17:18,849 --> 00:17:20,030
magazine

230
00:17:20,030 --> 00:17:25,000
the next day they were D dog for about
eight hours and anybody at all today

231
00:17:25,000 --> 00:17:31,750
announced that day was a lot they could
use any other services so in our case

232
00:17:31,750 --> 00:17:35,410
because we're Open DNS resolver we
become the middleman in these kinds of

233
00:17:35,410 --> 00:17:41,790
attacks so people will use specific
domain names will hit our server spoof

234
00:17:41,790 --> 00:17:46,399
the target IP and try and have us send
data back to them so we would end up

235
00:17:46,400 --> 00:17:51,070
participating in this problem with this
thing come in at the rate of I can be a

236
00:17:51,070 --> 00:17:55,810
hundred thousand second alright so they
eat up our resources and they also cause

237
00:17:55,810 --> 00:18:01,710
other people to start blocking us and
when we get through here what we ended

238
00:18:01,710 --> 00:18:06,340
up doing is we ended up figuring out how
to create some that more than I can

239
00:18:06,340 --> 00:18:10,520
assure you this can see it real well on
the screen but I'll bring up the live

240
00:18:10,520 --> 00:18:15,920
web interface for we're able to tag
through searches queries are coming in

241
00:18:15,920 --> 00:18:20,180
from all over endpoint VIPs and a minute
that somebody starts trying to do any

242
00:18:20,180 --> 00:18:25,050
queries text queries and it was large
queries that shouldn't be happening we

243
00:18:25,050 --> 00:18:28,240
see them because they're not release
right they're happening at a frequency

244
00:18:28,240 --> 00:18:31,890
that sway greater than what they should
be happening normally and they were able

245
00:18:31,890 --> 00:18:36,010
to go on the back and threw some other
tricks that we have through my rules on

246
00:18:36,010 --> 00:18:41,500
the f5 at a block for particular domain
let's say that they're using in these

247
00:18:41,500 --> 00:18:46,210
attacks and our DNS oops just drop it
anymore that traffic without impacting

248
00:18:46,210 --> 00:18:51,140
anybody else traffic and fortunately is
most of these attacks are done using

249
00:18:51,140 --> 00:18:54,970
domains that nobody would ever want to
go to any way and there's no reason to

250
00:18:54,970 --> 00:19:00,850
have a thousand any queries coming up
every second you will see some sites on

251
00:19:00,850 --> 00:19:05,250
the internet that use any queries as a
cheap way of testing DNS like DNS stuff

252
00:19:05,250 --> 00:19:08,860
and some of those other places they'll
do it any query against your authority

253
00:19:08,860 --> 00:19:13,240
of server and parts that on their side
but we don't care about that if they

254
00:19:13,240 --> 00:19:15,600
want to do it that way that's fine

255
00:19:15,600 --> 00:19:19,860
the other thing that we see which is
kind of interesting this is a really big

256
00:19:19,860 --> 00:19:23,030
deal

257
00:19:23,030 --> 00:19:29,070
can use DNS to export trade data from
your infected machines this is how it

258
00:19:29,070 --> 00:19:34,110
works so when the various person
registered a domain this is one of them

259
00:19:34,110 --> 00:19:41,270
here this P S seven 80.com the infected
machine with malware the malware starts

260
00:19:41,270 --> 00:19:45,320
then pulling data from wherever it wants
to get it from the disk memory wherever

261
00:19:45,320 --> 00:19:50,559
it creates through some algorithm that
long string and it starts a pending

262
00:19:50,559 --> 00:19:56,320
pieces of that string as a sub domain to
the DNS query sends a query out over the

263
00:19:56,320 --> 00:20:00,399
Internet does your firewall block it
does your DNS server block at the studio

264
00:20:00,400 --> 00:20:04,270
after care right it just sends that data
outright should they go out of network

265
00:20:04,270 --> 00:20:09,889
when it gets to the authoritative server
it answers hey there's the IP address

266
00:20:09,890 --> 00:20:14,820
but it also takes that data and knows
how that data was encrypted and it

267
00:20:14,820 --> 00:20:18,530
starts accumulating that data on the
other side so if you see these kinds of

268
00:20:18,530 --> 00:20:21,490
things happening on a network of
networks infected and somebody's taking

269
00:20:21,490 --> 00:20:26,169
data network we can guarantee that 100%
we don't know the algorithms that they

270
00:20:26,169 --> 00:20:31,010
used to put the data into those
subdomains but we do see it on infected

271
00:20:31,010 --> 00:20:36,010
machines once we clean the machines were
able to see the problems go away so this

272
00:20:36,010 --> 00:20:40,850
is data exfiltration through DNS the
other things that were able to see our

273
00:20:40,850 --> 00:20:47,158
but not commanding control calls when
machines are infected and one of the big

274
00:20:47,159 --> 00:20:52,880
ones if you have browser plug-ins it's
called epic units can that info PC that

275
00:20:52,880 --> 00:20:57,360
DNS query on your network anywhere you
have an effective machine one or more on

276
00:20:57,360 --> 00:21:02,270
their networks and you need to get off
their butts is one of many with this is

277
00:21:02,270 --> 00:21:08,860
an example of using that particular
botnet domain is a rental you can go

278
00:21:08,860 --> 00:21:12,928
find it you can rent time on that button
network it's a browser plug-in that's

279
00:21:12,929 --> 00:21:17,440
installed into chrome I think of one of
the Firefox I know there's one for

280
00:21:17,440 --> 00:21:24,220
Internet Explorer and edge and installs
somebody wants time on a network thing

281
00:21:24,220 --> 00:21:28,520
just sits there and every time the
browser opens every hour it owns home

282
00:21:28,520 --> 00:21:33,168
looks for a new command if a new DNS
command comes in with a certain packet

283
00:21:33,169 --> 00:21:38,590
on it it activates that but not
commanding control inside the plugin the

284
00:21:38,590 --> 00:21:41,610
plugging goes to some remote site
download from our index

285
00:21:41,610 --> 00:21:46,449
machine so if you see these kinds of
things on your network you need to stop

286
00:21:46,450 --> 00:21:53,590
them before they become activated and
were able to see this because our secure

287
00:21:53,590 --> 00:21:57,570
server product has because we feel
they're so many email messages were able

288
00:21:57,570 --> 00:22:03,428
to see every URL in those email messages
and we're able to analyze those URLs for

289
00:22:03,429 --> 00:22:07,150
malicious content so activate these URLs
go out there and see what they do see

290
00:22:07,150 --> 00:22:11,940
what the payload is analyzed that and if
the payload is bad then we'll put that

291
00:22:11,940 --> 00:22:17,490
domain into a block in our DNS and will
generate what's called a CTN or critical

292
00:22:17,490 --> 00:22:21,730
threat notification to our customers
they'll get that and then we'll be able

293
00:22:21,730 --> 00:22:25,909
to work with them analysed which
machines on their network or compromised

294
00:22:25,909 --> 00:22:32,650
or some other things that you can figure
out looking at your DNS logs and I'm

295
00:22:32,650 --> 00:22:37,429
gonna go into some examples here I hope
in a few minutes you can find out

296
00:22:37,429 --> 00:22:41,490
whether your DNS cache is poison now we
haven't gone to this step ya basically

297
00:22:41,490 --> 00:22:47,179
what you have to do in this case is log
DNS query responses from your DNS cache

298
00:22:47,179 --> 00:22:51,490
servers look at those in comparison the
values right and they think that would

299
00:22:51,490 --> 00:22:55,360
flag as a value that was outside of what
it should be

300
00:22:55,360 --> 00:23:00,219
you could look at that and say
somebody's trying to poison my DNS cache

301
00:23:00,220 --> 00:23:04,169
another big one now is dns locked up
this is new

302
00:23:04,860 --> 00:23:10,649
many data servers are realizing that
they cannot take any queries right so in

303
00:23:10,650 --> 00:23:15,540
a way to prevent any queries when it
comes in on UDP and it's in any query

304
00:23:15,540 --> 00:23:20,230
you can set your DNS server to tell it
I'm not gonna answer and UDP ask me

305
00:23:20,230 --> 00:23:26,429
again on TCP so you should have port 53
TCP open if you're going to allow any

306
00:23:26,429 --> 00:23:32,290
queries so the remote DNS server will
then ask on port 53 the bad guys have

307
00:23:32,290 --> 00:23:37,190
figured out that if I asked on port 53 I
can create these half-open connections

308
00:23:37,190 --> 00:23:41,679
to the DNS server through port 53 on TCP
and if they open enough of those

309
00:23:41,679 --> 00:23:47,260
connections bill just shut down the DNS
server has called in a slot that you can

310
00:23:47,260 --> 00:23:52,260
look at DNS hijacking because you can
actually see out mounting US request to

311
00:23:52,260 --> 00:23:56,230
see whether they're going to the right
location and I will tell you that if you

312
00:23:56,230 --> 00:24:01,520
are forwarding DNS requests to your ISP
you're not doing what you need to do if

313
00:24:01,520 --> 00:24:04,510
you have an eighty server any cash
server on your network where should you

314
00:24:04,510 --> 00:24:10,309
forward anybody want to guess the root
servers the route service the root

315
00:24:10,309 --> 00:24:14,970
servers only right never trust your ISP
never trust an upstream company unless

316
00:24:14,970 --> 00:24:18,650
the security company like US Open DNS
Google somebody that's well known that

317
00:24:18,650 --> 00:24:22,620
you can trust you can't trust your ISP's
DNS server you don't know who else is on

318
00:24:22,620 --> 00:24:26,590
that so need to make sure that you're
sending your queries from your servers

319
00:24:26,590 --> 00:24:34,760
to the root or to a known good source I
wanted to grab in DNS laws as you can

320
00:24:34,760 --> 00:24:38,370
look at domain bit flipping several
years ago there was a good talk at

321
00:24:38,370 --> 00:24:43,399
DEFCON talked about bit flipping memory
when it's heated up bits can change in

322
00:24:43,400 --> 00:24:47,809
membrane before so has written to disk
and you can get changes and file that

323
00:24:47,809 --> 00:24:53,480
will change the DNS lookups will change
some things in your DNS lookup so you

324
00:24:53,480 --> 00:24:58,620
can see those another thing we see also
are these domain generation algorithms

325
00:24:58,620 --> 00:25:06,000
malware tries to hide and normal traffic
so I Farias piece of software may just

326
00:25:06,000 --> 00:25:09,789
start making DNS lookups four tons of
random domains

327
00:25:09,789 --> 00:25:14,169
but somewhere dropped in those random
domains as the one bad to me right now

328
00:25:14,169 --> 00:25:18,029
it's trying to hide itself in all of
these DNS lookups and if you have enough

329
00:25:18,029 --> 00:25:23,929
data you can look at DNS lookups and
figure out which domains are the various

330
00:25:23,929 --> 00:25:30,399
ones in this noise in background data
out of it we use this for gray log is

331
00:25:30,399 --> 00:25:33,869
device loggins we can check all of our
routers everything else we can see when

332
00:25:33,869 --> 00:25:36,689
people log in when they log out how many
times

333
00:25:36,690 --> 00:25:42,679
tempt the possibilities of what you can
use this kind of lobbying for are pretty

334
00:25:42,679 --> 00:25:50,269
pretty wide open so now I wanna see if I
can get our environment to come up here

335
00:25:50,269 --> 00:25:57,659
and I'll show you teach samples of what
we looked at the screen to screen

336
00:25:57,659 --> 00:26:15,559
sharing is not working quite right on
this computer you get that ok so I can

337
00:26:15,559 --> 00:26:16,330
see it here

338
00:26:16,330 --> 00:26:20,359
have to move around where I can actually
see what you're looking at here is a

339
00:26:20,359 --> 00:26:25,699
great blog interface in real time it's
actually pulling in data real-time data

340
00:26:25,700 --> 00:26:29,809
and you can see right now wanna come
down there and point out a couple things

341
00:26:29,809 --> 00:26:36,320
don't get feedback from the speaker so
what's happening

342
00:26:37,990 --> 00:26:46,040
unfortunately had a few video problem so
we have no audio

343
00:26:46,040 --> 00:26:50,360
up until about the 29th minute 30
seconds sorry for the inconvenience

344
00:29:36,210 --> 00:29:37,120
think I can

345
00:29:37,120 --> 00:29:38,330
the election

346
00:29:38,330 --> 00:29:43,199
clusters didn't keep up but that's about
all that's what we have used it for and

347
00:29:43,200 --> 00:29:47,250
I think if you're really a whole lot of
detail but hopefully with the little bit

348
00:29:47,250 --> 00:29:50,789
of creative thinking you can start to
use this in ways that will help your

349
00:29:50,789 --> 00:29:54,169
network and one of the problems when
they talk about in the class this week

350
00:29:54,169 --> 00:29:58,019
the CISSP classes at somebody
compromises your machine and your locks

351
00:29:58,019 --> 00:30:01,679
are all on that machine what's the last
thing they're gonna do they're going to

352
00:30:01,679 --> 00:30:05,710
cover their tracks right so if you're
living there not being shipped in real

353
00:30:05,710 --> 00:30:10,159
time from those machines to something
like this how do you know what happened

354
00:30:10,159 --> 00:30:12,269
right you have no integrity of your data

355
00:30:12,269 --> 00:30:16,630
you don't know what happened so this
kind of solution can be really really

356
00:30:16,630 --> 00:30:22,260
powerful for a multitude of things it's
not just looking at DNS traffic ok but

357
00:30:22,260 --> 00:30:26,730
it does give you some insight into how
we used it to solve your problems on our

358
00:30:26,730 --> 00:30:41,960
site so other questions I know a little
bit early but yes we know the domain

359
00:30:41,960 --> 00:30:45,830
name research it we can see the peaks
like that epic units can it doesn't

360
00:30:45,830 --> 00:30:51,340
exactly every hour from customers I can
filter by their IP that's infected I can

361
00:30:51,340 --> 00:31:02,389
see every hour the 450 westwards phone
back home without the domain name you

362
00:31:02,389 --> 00:31:05,918
would have to not really because you
have to know what you're looking for

363
00:31:05,919 --> 00:31:12,769
records in this slot and every request
that hits are publicly it right so we

364
00:31:12,769 --> 00:31:19,350
created a stream and flag that
particular input or you can use regex in

365
00:31:19,350 --> 00:31:24,209
this and you're strange right so you can
find a particular pattern matches and

366
00:31:24,210 --> 00:31:28,139
then flag that is a stream and certain
thresholds met that stream will send you

367
00:31:28,139 --> 00:31:29,269
an email

368
00:31:29,269 --> 00:31:32,399
ok you can do that sort of thing with it

369
00:31:32,399 --> 00:31:37,559
answer your question any other questions

370
00:31:39,250 --> 00:31:54,340
for our customers with their email we
manage their MX records for them so they

371
00:31:54,340 --> 00:31:57,530
don't worry about that which Thomas M
two and then the man is behind the

372
00:31:57,530 --> 00:32:01,270
scenes we can rotate them around any
server or cluster without them knowing

373
00:32:01,270 --> 00:32:16,920
it we haven't done that yet because
10,000 times higher than this so we

374
00:32:16,920 --> 00:32:21,000
haven't built the infrastructure out to
do that that's our next phase of your

375
00:32:21,000 --> 00:32:25,170
working on right now the when somebody
calls our support for email we can go

376
00:32:25,170 --> 00:32:29,310
through news gray log and analyze all
the email across all of our incoming

377
00:32:29,310 --> 00:32:32,740
server then we saw this email from
someone so to your domain at

378
00:32:32,740 --> 00:32:36,270
such-and-such a time and it's lightning
fast it's just a matter of how much

379
00:32:36,270 --> 00:32:38,639
hardware you throw at it to make it work

380
00:32:38,640 --> 00:32:43,380
we just haven't grown it enough yet to
do that but now based on today I would

381
00:32:43,380 --> 00:32:51,750
blow this thing up in five minutes with
any other questions so I'll be around

382
00:32:51,750 --> 00:32:55,760
later appreciate your time and where
little bit early but a little early then

383
00:32:55,760 --> 00:32:58,200
go over so thank you for your time
thanks for coming out

